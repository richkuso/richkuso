<figure>

ichUcle®
Universal Chiplet
Interconnect Express

</figure>

# Universal Chiplet Interconnect Express™ (UCIe™)

Specification

August 5, 2025
Revision 3.0, Version 1.0

# LEGAL NOTICE FOR THIS PUBLICLY AVAILABLE SPECIFICATION FROM UNIVERSAL CHIPLET INTERCONNECT EXPRESS, INC.

@ 2022-2025 UNIVERSAL CHIPLET INTERCONNECT EXPRESS, INC. ALL RIGHTS RESERVED.

This Universal Chiplet Interconnect Express, Inc. Specification (this "UCIe Specification" or this "document") is owned by and
is proprietary to Universal Chiplet Interconnect Express, Inc., a Delaware nonprofit corporation (sometimes referred to as "UCIe"
or the "UCIe Consortium" or the "Company") and/or its successors and assigns.

NOTICE TO USERS WHO ARE MEMBERS OF UNIVERSAL CHIPLET INTERCONNECT EXPRESS, INC .:

If you are a Member of Universal Chiplet Interconnect Express, Inc. (herein referred to as a "UCIe Member"), and even if you
have received this publicly available version of this UCIe Specification after agreeing to the UCIE Consortium's Evaluation Copy
Agreement (a copy of which is available at www.uciexpress.org/specifications, each such UCIE Member must also be in
compliance with all of the following UCIe Consortium documents, policies and/or procedures (collectively, the "UCIe Governing
Documents") in order for such UCIe Member's use and/or implementation of this UCIe Specification to receive and enjoy all of
the rights, benefits, privileges and protections of UCIe Consortium membership: (i) the UCIe Consortium's Intellectual Property
Policy; (ii) the UCIe Consortium's Bylaws; (iii) any and all other UCIe Consortium policies and procedures; and (iv) the UCIe
Member's Participation Agreement.

## NOTICE TO NON-MEMBERS OF UNIVERSAL CHIPLET INTERCONNECT EXPRESS, INC .:

If you are not a UCIe Member and have received this publicly available version of this UCIe Specification, your use of this
document is subject to your compliance with, and is limited by, all of the terms and conditions of the UCIe Consortium's
Evaluation Copy Agreement (a copy of which is available at www.uciexpress.org/specifications).

In addition to the restrictions set forth in the UCIe Consortium's Evaluation Copy Agreement, any references or citations to this
document must acknowledge Universal Chiplet Interconnect Express, Inc.'s sole and exclusive copyright ownership of this UCIe
Specification. The proper copyright citation or reference is as follows: "@ 2022-2025 UNIVERSAL CHIPLET INTERCONNECT
EXPRESS, INC. ALL RIGHTS RESERVED." When making any such citation or reference to this document you are not permitted
to revise, alter, modify, make any derivatives of, or otherwise amend the referenced portion of this document in any way without
the prior express written permission of Universal Chiplet Interconnect Express, Inc.

Except for the limited rights explicitly given to a non-UCIe Member pursuant to the explicit provisions of the UCIe Consortium's
Evaluation Copy Agreement which governs the publicly available version of this UCIe Specification, nothing contained in this UCIe
Specification shall be deemed as granting (either expressly or impliedly) to any party that is not a UCIe Member: (i) any kind of
license to implement or use this UCIe Specification or any portion or content described or contained therein, or any kind of license
in or to any other intellectual property owned or controlled by the UCIe Consortium, including without limitation any trademarks
of the UCIe Consortium; or (ii) any benefits and/or rights as a UCIe Member under any UCIe Governing Documents. For clarity,
and without limiting the foregoing notice in any way, if you are not a UCIe Member but still elect to implement this UCIe
Specification or any portion described herein, you are hereby given notice that your election to do so does not give you any of the
rights, benefits, and/or protections of the UCIe Members, including without limitation any of the rights, benefits, privileges or
protections given to a UCIe Member under the UCIe Consortium's Intellectual Property Policy.

## LEGAL DISCLAIMERS AND ADDITIONAL NOTICE TO ALL PARTIES:

THIS DOCUMENT AND ALL SPECIFICATIONS AND/OR OTHER CONTENT PROVIDED HEREIN IS PROVIDED ON AN "AS IS" BASIS.
TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, UNIVERSAL CHIPLET INTERCONNECT EXPRESS, INC. (ALONG WITH
THE CONTRIBUTORS TO THIS DOCUMENT) HEREBY DISCLAIM ALL REPRESENTATIONS, WARRANTIES AND/OR COVENANTS,
EITHER EXPRESS OR IMPLIED, STATUTORY OR AT COMMON LAW, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE, VALIDITY, AND/OR NON-INFRINGEMENT.

In the event this UCIe Specification makes any references (including without limitation any incorporation by reference) to another
standard's setting organization's or any other party's ("Third Party") content or work, including without limitation any
specifications or standards of any such Third Party ("Third Party Specification"), you are hereby notified that your use or
implementation of any Third Party Specification: (i) is not governed by any of the UCIe Governing Documents; (ii) may require
your use of a Third Party's patents, copyrights or other intellectual property rights, which in turn may require you to
independently obtain a license or other consent from that Third Party in order to have full rights to implement or use that Third
Party Specification; and/or (iii) may be governed by the intellectual property policy or other policies or procedures of the Third
Party which owns the Third Party Specification. Any trademarks or service marks of any Third Party which may be referenced in
this UCIe Specification are owned by the respective owner of such marks.

The UCIe™ and UNIVERSAL CHIPLET INTERCONNECT EXPRESS™ trademarks and logos (the "UCIe Trademarks") are
trademarks owned by the UCIe Consortium. The UCIe Consortium reserves all rights in and to all of its UCIe Trademarks.

NOTICE TO ALL PARTIES REGARDING THE PCI-SIG UNIQUE VALUE PROVIDED IN THIS SPECIFICATION:

NOTICE TO USERS: THE UNIQUE VALUE THAT IS PROVIDED IN THIS SPECIFICATION FOR USE IN VENDOR DEFINED MESSAGE
FIELDS, DESIGNATED VENDOR SPECIFIC EXTENDED CAPABILITIES, AND ALTERNATE PROTOCOL NEGOTIATION ONLY AND MAY
NOT BE USED IN ANY OTHER MANNER, AND A USER OF THE UNIQUE VALUE MAY NOT USE THE UNIQUE VALUE IN A MANNER
THAT (A) ALTERS, MODIFIES, HARMS OR DAMAGES THE TECHNICAL FUNCTIONING, SAFETY OR SECURITY OF THE PCI-SIG
ECOSYSTEM OR ANY PORTION THEREOF, OR (B) COULD OR WOULD REASONABLY BE DETERMINED TO ALTER, MODIFY, HARM OR
DAMAGE THE TECHNICAL FUNCTIONING, SAFETY OR SECURITY OF THE PCI-SIG ECOSYSTEM OR ANY PORTION THEREOF (FOR
PURPOSES OF THIS NOTICE, "PCI-SIG ECOSYSTEM" MEANS THE PCI-SIG SPECIFICATIONS, MEMBERS OF PCI-SIG AND THEIR
ASSOCIATED PRODUCTS AND SERVICES THAT INCORPORATE ALL OR A PORTION OF A PCI-SIG SPECIFICATION AND EXTENDS
TO THOSE PRODUCTS AND SERVICES INTERFACING WITH PCI-SIG MEMBER PRODUCTS AND SERVICES).

# Contents

<table>
<tr>
<td colspan="3">Terminology</td>
<td>28</td>
</tr>
<tr>
<td colspan="3">Reference Documents</td>
<td>37</td>
</tr>
<tr>
<td colspan="3">Revision History</td>
<td>37</td>
</tr>
<tr>
<td>1.0</td>
<td colspan="2">Introduction</td>
<td>38</td>
</tr>
<tr>
<td></td>
<td colspan="2">1.1 UCIe Components</td>
<td>42</td>
</tr>
<tr>
<td></td>
<td colspan="2">1.1.1 Protocol Layer</td>
<td>42</td>
</tr>
<tr>
<td></td>
<td></td>
<td>1.1.2 Die-to-Die (D2D) Adapter</td>
<td>43</td>
</tr>
<tr>
<td></td>
<td></td>
<td>1.1.3 Physical Layer</td>
<td>43</td>
</tr>
<tr>
<td></td>
<td></td>
<td>1.1.4 Interfaces</td>
<td>44</td>
</tr>
<tr>
<td></td>
<td colspan="2">1.2 UCIe Configurations</td>
<td>44</td>
</tr>
<tr>
<td></td>
<td colspan="2">1.2.1 Single Module Configuration</td>
<td>44</td>
</tr>
<tr>
<td></td>
<td colspan="2">1.2.2 Multi-module Configurations</td>
<td>45</td>
</tr>
<tr>
<td></td>
<td colspan="2">1.2.3 Sideband-only Configurations</td>
<td>46</td>
</tr>
<tr>
<td></td>
<td colspan="2">1.3 UCIe Retimers</td>
<td>47</td>
</tr>
<tr>
<td></td>
<td colspan="2">1.4 UCIe Key Performance Targets</td>
<td>49</td>
</tr>
<tr>
<td></td>
<td colspan="2">1.5 Interoperability</td>
<td>50</td>
</tr>
<tr>
<td>2.0</td>
<td colspan="2">Protocol Layer</td>
<td>51</td>
</tr>
<tr>
<td></td>
<td>2.1</td>
<td>PCIe</td>
<td>53</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.1.1 Raw Format</td>
<td>53</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.1.2 Standard 256B End Header Flit Format</td>
<td>53</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.1.3 68B Flit Format</td>
<td>53</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.1.4 Standard 256B Start Header Flit Format</td>
<td>53</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.1.5 Latency-Optimized 256B with Optional Bytes Flit Format.</td>
<td>54</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.2 CXL 256B Flit Mode</td>
<td>54</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.2.1 Raw Format</td>
<td>54</td>
</tr>
<tr>
<td colspan="3">2.2.2 Latency-Optimized 256B Flit Formats</td>
<td>54</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.2.3 Standard 256B Start Header Flit Format</td>
<td>55</td>
</tr>
<tr>
<td colspan="3">2.3 CXL 68B Flit Mode</td>
<td>55</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.3.1 Raw Format</td>
<td>55</td>
</tr>
<tr>
<td></td>
<td></td>
<td>2.3.2 68B Flit Format</td>
<td>55</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.4 Streaming Protocol</td>
<td>56</td>
</tr>
<tr>
<td></td>
<td></td>
<td>2.4.1 Raw Format</td>
<td>56</td>
</tr>
<tr>
<td></td>
<td></td>
<td>2.4.2 68B Flit Format</td>
<td>56</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.4.3 Standard 256B Flit Formats</td>
<td>57</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.4.4 Latency-Optimized 256B Flit Formats</td>
<td>57</td>
</tr>
<tr>
<td></td>
<td colspan="2">2.5 Management Transport Protocol</td>
<td>57</td>
</tr>
<tr>
<td>3.0</td>
<td colspan="2">Die-to-Die Adapter</td>
<td>58</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.1 Stack Multiplexing</td>
<td>59</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.2 Link Initialization</td>
<td>62</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.2.1 Stage 3 of Link Initialization: Adapter Initialization</td>
<td>62</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.2.1.1 Part 1: Determine Local Capabilities</td>
<td>62</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.2.1.2 Part 2: Parameter Exchange with Remote Link Partner</td>
<td>63</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.2.1.3 Part 3: FDI bring up</td>
<td>70</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.3 Operation Formats</td>
<td>71</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.3.1 Raw Format for All Protocols</td>
<td>71</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.3.2 68B Flit Format</td>
<td>71</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.3.2.1 68B Flit Format Alignment and Padding Rules</td>
<td>73</td>
</tr>
<tr>
<td></td>
<td colspan="2">3.3.3 Standard 256B Flit Formats</td>
<td>75</td>
</tr>
<tr>
<td></td>
<td></td>
<td>3.3.4 Latency-Optimized 256B Flit Formats</td>
<td>80</td>
</tr>
</table>

## 4.0

<table>
<tr>
<th></th>
<th></th>
<th>Contents</th>
</tr>
<tr>
<td></td>
<td>3.3.5 Flit Format-related Implementation Requirements</td>
<td></td>
</tr>
<tr>
<td></td>
<td>for Protocol Layer and Adapter</td>
<td>84</td>
</tr>
<tr>
<td>3.4</td>
<td>Decision Table for Flit Format and Protocol</td>
<td>85</td>
</tr>
<tr>
<td>3.5</td>
<td>State Machine Hierarchy</td>
<td>89</td>
</tr>
<tr>
<td>3.6</td>
<td>Power Management Link States</td>
<td>90</td>
</tr>
<tr>
<td>3.7</td>
<td>CRC Computation</td>
<td>92</td>
</tr>
<tr>
<td>3.8</td>
<td>Retry Rules</td>
<td>93</td>
</tr>
<tr>
<td>3.9</td>
<td>Runtime Link Testing using Parity</td>
<td>95</td>
</tr>
<tr>
<td colspan="2">Logical Physical Layer</td>
<td>98</td>
</tr>
<tr>
<td>4.1</td>
<td>Data and Sideband Transmission Flow</td>
<td>98</td>
</tr>
<tr>
<td></td>
<td>4.1.1 Byte to Lane Mapping</td>
<td>98</td>
</tr>
<tr>
<td></td>
<td>4.1.2 Valid Framing</td>
<td>100</td>
</tr>
<tr>
<td></td>
<td>4.1.2.1 Valid Framing for Retimers</td>
<td>101</td>
</tr>
<tr>
<td></td>
<td>4.1.3 Clock Gating</td>
<td>101</td>
</tr>
<tr>
<td colspan="2">4.1.4 Free Running Clock Mode</td>
<td>101</td>
</tr>
<tr>
<td></td>
<td>4.1.5 Sideband transmission</td>
<td>102</td>
</tr>
<tr>
<td></td>
<td>4.1.5.1 Sideband Performant Mode Operation (PMO)</td>
<td>102</td>
</tr>
<tr>
<td></td>
<td>4.1.5.2 Priority Sideband Packet Transfer</td>
<td>103</td>
</tr>
<tr>
<td></td>
<td>4.1.5.2.1 PSPT Rules</td>
<td>103</td>
</tr>
<tr>
<td>4.2</td>
<td>Lane Reversal</td>
<td>104</td>
</tr>
<tr>
<td></td>
<td>4.2.1 Lane ID</td>
<td>105</td>
</tr>
<tr>
<td>4.3</td>
<td>Interconnect redundancy remapping</td>
<td>107</td>
</tr>
<tr>
<td></td>
<td>4.3.1 Data Lane repair</td>
<td>107</td>
</tr>
<tr>
<td></td>
<td>4.3.2 Data Lane repair with Lane reversal</td>
<td>109</td>
</tr>
<tr>
<td></td>
<td>4.3.3 Data Lane repair implementation</td>
<td>109</td>
</tr>
<tr>
<td></td>
<td>4.3.3.1 Single Lane repair</td>
<td>109</td>
</tr>
<tr>
<td></td>
<td>4.3.3.2 Two Lane repair</td>
<td>111</td>
</tr>
<tr>
<td></td>
<td>4.3.3.3 Single Lane repair with Lane reversal</td>
<td>113</td>
</tr>
<tr>
<td></td>
<td>4.3.3.3.1 x64 Advanced Package Pseudo Codes</td>
<td>113</td>
</tr>
<tr>
<td></td>
<td>4.3.3.3.2 x32 Advanced Package Pseudo Codes</td>
<td>113</td>
</tr>
<tr>
<td></td>
<td>4.3.3.4 Two Lane repair with Lane reversal</td>
<td>114</td>
</tr>
<tr>
<td></td>
<td>4.3.3.4.1 x64 Advanced Package Pseudo Codes</td>
<td>114</td>
</tr>
<tr>
<td></td>
<td>4.3.3.4.2 x32 Advanced Package Pseudo Codes</td>
<td>115</td>
</tr>
<tr>
<td></td>
<td>4.3.4 Clock and Track Lane remapping</td>
<td>115</td>
</tr>
<tr>
<td></td>
<td>4.3.5 Clock and Track Lane repair implementation</td>
<td>116</td>
</tr>
<tr>
<td></td>
<td>4.3.6 Valid Repair and implementation</td>
<td>118</td>
</tr>
<tr>
<td></td>
<td>4.3.7 Width Degrade in Standard Package Interfaces</td>
<td>118</td>
</tr>
<tr>
<td>4.4</td>
<td>Data to Clock Training and Test Modes</td>
<td>119</td>
</tr>
<tr>
<td></td>
<td>4.4.1 Scrambling and training pattern generation</td>
<td>120</td>
</tr>
<tr>
<td>4.5</td>
<td>Link Initialization and Training</td>
<td>124</td>
</tr>
<tr>
<td></td>
<td>4.5.1 Link Training Basic Operations</td>
<td>125</td>
</tr>
<tr>
<td></td>
<td>4.5.1.1 Transmitter initiated Data to Clock Point Test</td>
<td>125</td>
</tr>
<tr>
<td></td>
<td>4.5.1.2 Transmitter initiated Data to Clock Eye Width Sweep</td>
<td>127</td>
</tr>
<tr>
<td></td>
<td>4.5.1.3 Receiver initiated Data to Clock point test</td>
<td>128</td>
</tr>
<tr>
<td></td>
<td>4.5.1.4 Receiver initiated Data to Clock Eye Width Sweep</td>
<td>129</td>
</tr>
<tr>
<td colspan="2">4.5.2 Link Training with Retimer</td>
<td>130</td>
</tr>
<tr>
<td></td>
<td>4.5.3 Link Training State Machine</td>
<td>131</td>
</tr>
<tr>
<td></td>
<td>4.5.3.1 RESET</td>
<td>132</td>
</tr>
<tr>
<td></td>
<td>4.5.3.2 Sideband Initialization (SBINIT)</td>
<td>133</td>
</tr>
<tr>
<td></td>
<td>4.5.3.3 MBINIT</td>
<td>136</td>
</tr>
<tr>
<td></td>
<td>4.5.3.3.1 MBINIT.PARAM</td>
<td>137</td>
</tr>
<tr>
<td></td>
<td>4.5.3.3.2 MBINIT. CAL</td>
<td>146</td>
</tr>
<tr>
<td></td>
<td>4.5.3.3.3 MBINIT.REPAIRCLK</td>
<td>146</td>
</tr>
<tr>
<td></td>
<td>4.5.3.3.4 MBINIT.REPAIRVAL</td>
<td>149</td>
</tr>
<tr>
<td></td>
<td>4.5.3.3.5 MBINIT.REVERSALMB</td>
<td>151</td>
</tr>
</table>

4.6

4.7

4.7.1

4.7.2

4.8

5.0

5.1

5.1.1

5.1.2

5.2

5.2.1

5.2.2

5.3

5.3.1

5.3.2

5.3.3

5.3.4

5.4

5.4.1

5.4.2

5.4.3

<table>
<tr>
<th></th>
<th>Contents</th>
</tr>
<tr>
<td>4.5.3.3.6 MBINIT.REPAIRMB</td>
<td>153</td>
</tr>
<tr>
<td>4.5.3.4 MBTRAIN</td>
<td>155</td>
</tr>
<tr>
<td>4.5.3.4.1 MBTRAIN.VALVREF</td>
<td>156</td>
</tr>
<tr>
<td>4.5.3.4.2 MBTRAIN.DATAVREF</td>
<td>157</td>
</tr>
<tr>
<td>4.5.3.4.3 MBTRAIN.SPEEDIDLE</td>
<td>158</td>
</tr>
<tr>
<td>4.5.3.4.4 MBTRAIN.TXSELFCAL</td>
<td>158</td>
</tr>
<tr>
<td>4.5.3.4.5 MBTRAIN.RXCLKCAL</td>
<td>158</td>
</tr>
<tr>
<td>4.5.3.4.6 MBTRAIN.VALTRAINCENTER</td>
<td>159</td>
</tr>
<tr>
<td>4.5.3.4.7 MBTRAIN. VALTRAINVREF</td>
<td>160</td>
</tr>
<tr>
<td>4.5.3.4.8 MBTRAIN.DATATRAINCENTER1</td>
<td>161</td>
</tr>
<tr>
<td>4.5.3.4.9 MBTRAIN.DATATRAINVREF</td>
<td>161</td>
</tr>
<tr>
<td>4.5.3.4.10 MBTRAIN.RXDESKEW</td>
<td>162</td>
</tr>
<tr>
<td>4.5.3.4.11 MBTRAIN.DATATRAINCENTER2</td>
<td>164</td>
</tr>
<tr>
<td>4.5.3.4.12 MBTRAIN.LINKSPEED</td>
<td>164</td>
</tr>
<tr>
<td>$4 . 5 . 3 . 4 . 1 3$ MBTRAIN.REPAIR</td>
<td>167</td>
</tr>
<tr>
<td>4.5.3.5 LINKINIT</td>
<td>168</td>
</tr>
<tr>
<td>4.5.3.6 ACTIVE</td>
<td>168</td>
</tr>
<tr>
<td>4.5.3.7 PHYRETRAIN</td>
<td>168</td>
</tr>
<tr>
<td>4.5.3.7.1 Adapter initiated PHY retrain</td>
<td>170</td>
</tr>
<tr>
<td>4.5.3.7.2 PHY initiated PHY retrain</td>
<td>170</td>
</tr>
<tr>
<td>4.5.3.7.3 Remote Die requested PHY retrain</td>
<td>171</td>
</tr>
<tr>
<td>4.5.3.7.4 PHY retrain from LINKSPEED</td>
<td>171</td>
</tr>
<tr>
<td>4.5.3.8 TRAINERROR</td>
<td>171</td>
</tr>
<tr>
<td>4.5.3.9</td>
<td>172</td>
</tr>
<tr>
<td>{ L 1 / L 2 }<br>{ 4 . 5 . 3 . 9 . 1 } Powering down Sideband in L2 State</td>
<td>172</td>
</tr>
<tr>
<td>Runtime Recalibration</td>
<td>173</td>
</tr>
<tr>
<td>Multi-module Link</td>
<td>175</td>
</tr>
<tr>
<td>Multi-module initialization</td>
<td>175</td>
</tr>
<tr>
<td>4.7.1.1 Sideband Assignment and Retimer Credits for Multi-module</td>
<td></td>
</tr>
<tr>
<td>Configurations</td>
<td>178</td>
</tr>
<tr>
<td>4.7.1.2 Examples of MMPL Synchronization</td>
<td>178</td>
</tr>
<tr>
<td>4.7.1.2.1 Example 1: MMPL Resolution results</td>
<td></td>
</tr>
<tr>
<td>in a Width Degrade per Module</td>
<td>179</td>
</tr>
<tr>
<td>$4 . 7 . 1 . 2 . 2$ Example 2: MMPL Resolution results</td>
<td></td>
</tr>
<tr>
<td>in a Speed Degrade</td>
<td>180</td>
</tr>
<tr>
<td>4.7.1.2.3 Example 3: MMPL Resolution results</td>
<td></td>
</tr>
<tr>
<td>in a Module Disable</td>
<td>180</td>
</tr>
<tr>
<td>Multi-module Interoperability between x64 and x32 Advanced Packages</td>
<td>181</td>
</tr>
<tr>
<td>Sideband PHY Arbitration between MPMs and Link Management Packets</td>
<td>182</td>
</tr>
<tr>
<td>Electrical Layer (2D and 2.5D)</td>
<td>184</td>
</tr>
<tr>
<td>Interoperability</td>
<td>184</td>
</tr>
<tr>
<td>Data rates</td>
<td>184</td>
</tr>
<tr>
<td>Reference Clock (REFCLK)</td>
<td>185</td>
</tr>
<tr>
<td>Overview</td>
<td>186</td>
</tr>
<tr>
<td>Interface Overview</td>
<td>186</td>
</tr>
<tr>
<td>Electrical Summary</td>
<td>188</td>
</tr>
<tr>
<td>Transmitter Specification</td>
<td>190</td>
</tr>
<tr>
<td>Driver Topology</td>
<td>191</td>
</tr>
<tr>
<td>Transmitter Electrical parameters</td>
<td>191</td>
</tr>
<tr>
<td>24 GT/s and 32 GT/s Transmitter Equalization</td>
<td>193</td>
</tr>
<tr>
<td>48 GT/s and 64 GT/s Transmitter Equalization</td>
<td>194</td>
</tr>
<tr>
<td>Receiver Specification</td>
<td>195</td>
</tr>
<tr>
<td>Receiver Electrical Parameters for &lt;= 32 GT/s</td>
<td>196</td>
</tr>
<tr>
<td>Receiver Electrical Parameters for 48 GT/s and 64 GT/s</td>
<td>197</td>
</tr>
<tr>
<td>Rx Termination</td>
<td>197</td>
</tr>
</table>

<table>
<tr>
<th></th>
<th></th>
<th>Contents</th>
</tr>
<tr>
<td></td>
<td>5.4.4 Receiver Equalization &gt; 16 GT/s</td>
<td>200</td>
</tr>
<tr>
<td>5.5</td>
<td>Clocking</td>
<td>201</td>
</tr>
<tr>
<td></td>
<td>5.5.1 Track</td>
<td>202</td>
</tr>
<tr>
<td>5.6</td>
<td>Supply noise and clock skew</td>
<td>205</td>
</tr>
<tr>
<td>5.7</td>
<td>Ball-out and Channel Specification</td>
<td>205</td>
</tr>
<tr>
<td></td>
<td>5.7.1 Voltage Transfer Function</td>
<td>208</td>
</tr>
<tr>
<td></td>
<td>5.7.2 Advanced Package</td>
<td>209</td>
</tr>
<tr>
<td></td>
<td>5.7.2.1 Loss and Crosstalk Mask</td>
<td>210</td>
</tr>
<tr>
<td></td>
<td>5.7.2.2 x64 Advanced Package Module Bump Map</td>
<td>211</td>
</tr>
<tr>
<td></td>
<td>5.7.2.2.1 x64 Advanced Package Module Bump Map</td>
<td></td>
</tr>
<tr>
<td></td>
<td>for 48 GT/s and 64 GT/s</td>
<td>219</td>
</tr>
<tr>
<td></td>
<td>5.7.2.3 x32 Advanced Package Module Bump Map</td>
<td>221</td>
</tr>
<tr>
<td></td>
<td>5.7.2.4 x64 and x32 Advanced Package Module Interoperability</td>
<td>228</td>
</tr>
<tr>
<td></td>
<td>5.7.2.5 Module Naming of Advanced Package Modules</td>
<td>231</td>
</tr>
<tr>
<td></td>
<td>5.7.3 Standard Package</td>
<td>235</td>
</tr>
<tr>
<td></td>
<td>5.7.3.1 x16 Standard Package Module Bump Map</td>
<td>236</td>
</tr>
<tr>
<td></td>
<td>5.7.3.2 x8 Standard Package Module Bump Map</td>
<td>240</td>
</tr>
<tr>
<td></td>
<td>5.7.3.3 x16 and x8 Standard Package Module Interoperability</td>
<td>241</td>
</tr>
<tr>
<td></td>
<td>5.7.3.4 Module Naming of Standard Package Modules</td>
<td>241</td>
</tr>
<tr>
<td></td>
<td>5.7.3.4.1 Module Degrade Rules</td>
<td>246</td>
</tr>
<tr>
<td></td>
<td>5.7.4 UCIe-S Sideband-only Port</td>
<td>248</td>
</tr>
<tr>
<td>5.8</td>
<td>Tightly Coupled Mode</td>
<td>249</td>
</tr>
<tr>
<td>5.9</td>
<td>Interconnect redundancy Remapping</td>
<td>249</td>
</tr>
<tr>
<td></td>
<td>5.9.1 Advanced Package Lane Remapping</td>
<td>249</td>
</tr>
<tr>
<td></td>
<td>5.9.2 Standard Package Lane remapping</td>
<td>250</td>
</tr>
<tr>
<td>5.10</td>
<td>BER Requirements, CRC, and Retry</td>
<td>250</td>
</tr>
<tr>
<td>5.11</td>
<td>Valid and Clock Gating</td>
<td>251</td>
</tr>
<tr>
<td>5.12</td>
<td>Electrical Idle</td>
<td>253</td>
</tr>
<tr>
<td>5.13</td>
<td>Sideband signaling</td>
<td>254</td>
</tr>
<tr>
<td></td>
<td>5.13.1 Sideband Electrical Parameters</td>
<td>254</td>
</tr>
<tr>
<td></td>
<td>5.13.2 Auxiliary Clock (AUXCLK)</td>
<td>255</td>
</tr>
<tr>
<td>5.14</td>
<td>Open Drain</td>
<td>255</td>
</tr>
<tr>
<td></td>
<td>5.14.1 Open Drain Usage</td>
<td>256</td>
</tr>
<tr>
<td></td>
<td>5.14.2 External Open Drain Connections</td>
<td>257</td>
</tr>
<tr>
<td colspan="2">UCIe-3D</td>
<td>258</td>
</tr>
<tr>
<td>6.1</td>
<td>Introduction</td>
<td>258</td>
</tr>
<tr>
<td>6.2</td>
<td>UCIe-3D Features and Summary</td>
<td>258</td>
</tr>
<tr>
<td>6.3</td>
<td>UCIe-3D Tx, $R x _ { 1 } ,$ and Clocking</td>
<td>260</td>
</tr>
<tr>
<td>6.4</td>
<td>Electrical Specification</td>
<td>261</td>
</tr>
<tr>
<td></td>
<td>6.4.1 Timing Budget</td>
<td>261</td>
</tr>
<tr>
<td></td>
<td>6.4.2 ESD and Energy Efficiency</td>
<td>263</td>
</tr>
<tr>
<td></td>
<td>6.4.3 UCIe-3D Module and Bump Map</td>
<td>264</td>
</tr>
<tr>
<td></td>
<td>6.4.4 Repair Strategy</td>
<td>265</td>
</tr>
<tr>
<td></td>
<td>6.4.5 Channel and Data Rate Extension</td>
<td>267</td>
</tr>
<tr>
<td colspan="2">Sideband</td>
<td>268</td>
</tr>
<tr>
<td>7.1</td>
<td>Protocol Specification</td>
<td>268</td>
</tr>
<tr>
<td></td>
<td>7.1.1 Sideband Packet Types</td>
<td>269</td>
</tr>
<tr>
<td></td>
<td>7.1.2 Sideband Packet Formats</td>
<td>272</td>
</tr>
<tr>
<td></td>
<td>7.1.2.1 Register Access Packets</td>
<td>272</td>
</tr>
<tr>
<td></td>
<td>7.1.2.2 Messages without Data</td>
<td>275</td>
</tr>
<tr>
<td></td>
<td>7.1.2.3 Messages with data payloads</td>
<td>282</td>
</tr>
<tr>
<td></td>
<td>7.1.2.4 Management Port Message (MPM) with Data</td>
<td>291</td>
</tr>
<tr>
<td></td>
<td>7.1.2.4.1 Common Fields in MPM Header of MPM</td>
<td></td>
</tr>
<tr>
<td></td>
<td>with Data Messages on Sideband</td>
<td>291</td>
</tr>
<tr>
<td></td>
<td>7.1.2.4.2 Encapsulated MTP Message</td>
<td>292</td>
</tr>
<tr>
<td>UCIe Specification</td>
<td>Revision 3.0, Version 1.0</td>
<td>6</td>
</tr>
<tr>
<td>August 5, 2025</td>
<td>Property of Universal Chiplet Interconnect Express (UCIe) @ 2022-2025</td>
<td></td>
</tr>
</table>

## 6.0

7.0

7.1.2.5

7.1.2.6

7.1.3

7.1.3.1

7.1.3.2

7.1.3.3

### 7.1.4

## 8.0 System Architecture

### 8.1 UCIe Manageability

8.1.1
Overview

8.1.2

8.1.3

8.1.3.1

8.1.3.2

8.1.3.3

8.1.3.4

8.1.3.5

8.1.3.6

8.1.4

8.1.4.1

8.1.4.2

8.1.5

8.1.5.1

<table>
<tr>
<th colspan="2">7.1.2.4.3</th>
<th>Vendor-defined Management Port</th>
<th></th>
</tr>
<tr>
<th colspan="2"></th>
<th>Gateway Message</th>
<th>293</th>
</tr>
<tr>
<td colspan="3">MPMs without Data</td>
<td>293</td>
</tr>
<tr>
<td colspan="2">7.1.2.5.1</td>
<td>Common Header Fields of MPM</td>
<td></td>
</tr>
<tr>
<td colspan="2"></td>
<td>without Data Messages on Sideband</td>
<td>294</td>
</tr>
<tr>
<td colspan="2">7.1.2.5.2</td>
<td>Management Port Gateway Capabilities Message</td>
<td>294</td>
</tr>
<tr>
<td colspan="2">7.1.2.5.3</td>
<td>Credit Return Message</td>
<td>295</td>
</tr>
<tr>
<td colspan="2">7.1.2.5.4</td>
<td>Init Done Message</td>
<td>296</td>
</tr>
<tr>
<td colspan="2">7.1.2.5.5</td>
<td>PM Message</td>
<td>296</td>
</tr>
<tr>
<td colspan="2">7.1.2.5.6</td>
<td>Vendor-defined Management Port</td>
<td></td>
</tr>
<tr>
<td colspan="2"></td>
<td>Gateway Message</td>
<td>296</td>
</tr>
<tr>
<td colspan="3">Priority Sideband Traffic Packets</td>
<td>297</td>
</tr>
<tr>
<td colspan="3">Flow Control and Data Integrity</td>
<td>297</td>
</tr>
<tr>
<td colspan="2">Flow Control</td>
<td>and Data Integrity over FDI and RDI</td>
<td>298</td>
</tr>
<tr>
<td colspan="3">Flow Control and Data Integrity over</td>
<td></td>
</tr>
<tr>
<td colspan="2">UCIe sideband</td>
<td>Link between dies</td>
<td>298</td>
</tr>
<tr>
<td colspan="3">End-to-End flow control and forward progress</td>
<td rowspan="2">298</td>
</tr>
<tr>
<td colspan="3">for UCIe Link sideband</td>
</tr>
<tr>
<td colspan="2">Operation on RDI and</td>
<td>FDI</td>
<td>302</td>
</tr>
<tr>
<td colspan="2"></td>
<td></td>
<td>303</td>
</tr>
<tr>
<td colspan="2"></td>
<td></td>
<td>303</td>
</tr>
<tr>
<td colspan="2"></td>
<td></td>
<td>303</td>
</tr>
<tr>
<td colspan="2">Theory of Operation</td>
<td></td>
<td>304</td>
</tr>
<tr>
<td colspan="3">UCIe Management Transport</td>
<td>307</td>
</tr>
<tr>
<td colspan="3">UCIe Management Transport Packet</td>
<td>307</td>
</tr>
<tr>
<td colspan="2">8.1.3.1.1</td>
<td>Traffic Class and Packet Ordering Requirements</td>
<td>309</td>
</tr>
<tr>
<td colspan="2">8.1.3.1.2</td>
<td>Packet Length</td>
<td>311</td>
</tr>
<tr>
<td colspan="2">8.1.3.1.3</td>
<td>Management Protocol</td>
<td>311</td>
</tr>
<tr>
<td></td>
<td colspan="2">Management Network ID</td>
<td>312</td>
</tr>
<tr>
<td colspan="2">Routing</td>
<td></td>
<td>313</td>
</tr>
<tr>
<td colspan="2">8.1.3.3.1</td>
<td rowspan="2">Routing of a Packet from a Management Entity within the Chiplet</td>
<td rowspan="2">313</td>
</tr>
<tr>
<td colspan="2"></td>
</tr>
<tr>
<td colspan="2">8.1.3.3.2</td>
<td>Routing of a Packet Received on a Management Port</td>
<td>315</td>
</tr>
<tr>
<td></td>
<td colspan="2">Packet Integrity Protection</td>
<td>315</td>
</tr>
<tr>
<td colspan="2">8.1.3.4.1</td>
<td>CRC Integrity Protection</td>
<td>315</td>
</tr>
<tr>
<td colspan="3">Access Control</td>
<td>316</td>
</tr>
<tr>
<td colspan="2">8.1.3.5.1</td>
<td>Standard Asset Classes</td>
<td>318</td>
</tr>
<tr>
<td colspan="2">8.1.3.5.2</td>
<td>Security Director</td>
<td>320</td>
</tr>
<tr>
<td colspan="2">Initialization</td>
<td>and Configuration</td>
<td>320</td>
</tr>
<tr>
<td colspan="2">8.1.3.6.1</td>
<td>Management Capability Directory</td>
<td>323</td>
</tr>
<tr>
<td colspan="2">8.1.3.6.2</td>
<td>Chiplet Capability Structure</td>
<td>325</td>
</tr>
<tr>
<td colspan="2">8.1.3.6.3</td>
<td>Access Control Capability Structure</td>
<td>334</td>
</tr>
<tr>
<td colspan="2">8.1.3.6.4</td>
<td>Security Clearance Group Capability Structure</td>
<td>340</td>
</tr>
<tr>
<td colspan="3">UCIe Memory Access Protocol</td>
<td>341</td>
</tr>
<tr>
<td></td>
<td colspan="2">UCIe Memory Access Protocol Packets</td>
<td>342</td>
</tr>
<tr>
<td colspan="2">8.1.4.1.1</td>
<td>UCIe Memory Request Packet</td>
<td>342</td>
</tr>
<tr>
<td colspan="2">8.1.4.1.2</td>
<td>UCIe Memory Access Response Packet</td>
<td>344</td>
</tr>
<tr>
<td colspan="2">UCIe Memory</td>
<td>Access Protocol Capability Structure</td>
<td>346</td>
</tr>
<tr>
<td colspan="3">Common Data Structures</td>
<td>349</td>
</tr>
<tr>
<td colspan="3">Circular Buffer</td>
<td>349</td>
</tr>
<tr>
<td colspan="2">8.1.5.1.1</td>
<td>Circular Buffer Theory of Operation</td>
<td>349</td>
</tr>
<tr>
<td colspan="2">8.1.5.1.2</td>
<td>Circular Buffer State Machine</td>
<td>350</td>
</tr>
<tr>
<td colspan="2">8.1.5.1.3</td>
<td>Circular Buffer Initialization</td>
<td>352</td>
</tr>
<tr>
<td colspan="2">8.1.5.1.4</td>
<td>Circular Buffer Features</td>
<td>352</td>
</tr>
</table>

#### 8.1.6

8.1.6.1

8.2

8.2.1

8.2.2
$8 . 2 . 2 . 1$

8.2.3

8.2.3.1

8.2.3.2

8.2.4

8.2.4.1

8.2.4.2

8.2.4.3

8.2.5
8.2.4.4

8.2.5.1

8.2.5.2

<table>
<tr>
<th></th>
<th></th>
<th>Contents</th>
</tr>
<tr>
<td>8.1.5.1.5</td>
<td>Circular Buffer State and Errors</td>
<td>352</td>
</tr>
<tr>
<td>8.1.5.1.6</td>
<td>Control Register</td>
<td>355</td>
</tr>
<tr>
<td>8.1.5.1.7</td>
<td>Circular Buffer Common Fields</td>
<td>355</td>
</tr>
<tr>
<td>8.1.5.1.8</td>
<td>Sink Circular Buffer Structure</td>
<td>356</td>
</tr>
<tr>
<td>8.1.5.1.9</td>
<td>Source Circular Buffer Structure</td>
<td>358</td>
</tr>
<tr>
<td>8.1.5.1.10</td>
<td>UMAP Requester Coordination</td>
<td>359</td>
</tr>
<tr>
<td>8.1.5.1.11</td>
<td>How to Use Circular Buffer</td>
<td>359</td>
</tr>
<tr>
<td colspan="2">Open Drain Configuration Structure</td>
<td>359</td>
</tr>
<tr>
<td>Example</td>
<td>Usage</td>
<td>360</td>
</tr>
<tr>
<td colspan="2">Management Transport Packet (MTP) Encapsulation</td>
<td>361</td>
</tr>
<tr>
<td colspan="2">MTP Encapsulation Architecture Overview</td>
<td>361</td>
</tr>
<tr>
<td colspan="2">Management Port Messages</td>
<td>365</td>
</tr>
<tr>
<td>Sideband</td>
<td></td>
<td>365</td>
</tr>
<tr>
<td>Mainband</td>
<td></td>
<td>366</td>
</tr>
<tr>
<td>8.2.2.2.1</td>
<td>MPMs with Data</td>
<td>366</td>
</tr>
<tr>
<td>8.2.2.2.2</td>
<td>MPMs without Data</td>
<td>368</td>
</tr>
<tr>
<td colspan="2">Management Transport Path Setup</td>
<td>371</td>
</tr>
<tr>
<td>Sideband</td>
<td></td>
<td>371</td>
</tr>
<tr>
<td>8.2.3.1.1</td>
<td>Negotiation Phase Steps</td>
<td>371</td>
</tr>
<tr>
<td>8.2.3.1.2</td>
<td>Initialization Phase Steps</td>
<td>371</td>
</tr>
<tr>
<td>8.2.3.1.3</td>
<td>Other Sideband Management Transport</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Path Rules</td>
<td>375</td>
</tr>
<tr>
<td>Mainband</td>
<td></td>
<td>375</td>
</tr>
<tr>
<td>8.2.3.2.1</td>
<td>Negotiation Phase Steps</td>
<td>375</td>
</tr>
<tr>
<td>8.2.3.2.2</td>
<td>Initialization Phase Steps</td>
<td>375</td>
</tr>
<tr>
<td>8.2.3.2.3</td>
<td>Other Mainband Management Transport</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Path Rules</td>
<td>377</td>
</tr>
<tr>
<td colspan="2">Common Rules for Management Transport</td>
<td></td>
</tr>
<tr>
<td colspan="2">over Sideband and Mainband</td>
<td>378</td>
</tr>
<tr>
<td>Management</td>
<td>Packet Flow Control</td>
<td>378</td>
</tr>
<tr>
<td>Segmentation</td>
<td></td>
<td>379</td>
</tr>
<tr>
<td colspan="2">Interleaving and Multi-module Sideband</td>
<td></td>
</tr>
<tr>
<td colspan="2">and Multi-stack Mainband Ordering</td>
<td>380</td>
</tr>
<tr>
<td>8.2.4.3.1</td>
<td>Transmitter Rules</td>
<td>380</td>
</tr>
<tr>
<td>8.2.4.3.2</td>
<td>Receiver Rules</td>
<td>381</td>
</tr>
<tr>
<td>`Init Done'</td>
<td>Timeout Flow</td>
<td>383</td>
</tr>
<tr>
<td colspan="2">Other Management Transport Details</td>
<td>383</td>
</tr>
<tr>
<td>Sideband</td>
<td></td>
<td>383</td>
</tr>
<tr>
<td>8.2.5.1.1</td>
<td>Management Port Gateway Flow Control over</td>
<td>RDI 383</td>
</tr>
<tr>
<td>8.2.5.1.2</td>
<td>MPMs with Data Length Rules</td>
<td>383</td>
</tr>
<tr>
<td>8.2.5.1.3</td>
<td>Sideband Runtime Management Transport Path</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Monitoring - Heartbeat Mechanism</td>
<td>384</td>
</tr>
<tr>
<td>8.2.5.1.4</td>
<td>Sideband Management Path Power</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Management Rules</td>
<td>385</td>
</tr>
<tr>
<td>8.2.5.1.5</td>
<td>Management Port Gateway Mux Arbitration</td>
<td>386</td>
</tr>
<tr>
<td>Mainband</td>
<td></td>
<td>386</td>
</tr>
<tr>
<td>8.2.5.2.1</td>
<td>NOP Message</td>
<td>386</td>
</tr>
<tr>
<td>8.2.5.2.2</td>
<td>Credit Return DWORD Format</td>
<td>386</td>
</tr>
<tr>
<td>8.2.5.2.3</td>
<td>Management Flit Formats</td>
<td>387</td>
</tr>
<tr>
<td>8.2.5.2.4</td>
<td>L1/L2 Link States and Management Transport</td>
<td>390</td>
</tr>
<tr>
<td>8.2.5.2.5</td>
<td>Link Reset/Link Disable and</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Management Transport</td>
<td>390</td>
</tr>
<tr>
<td>Retimers and Management</td>
<td>Transport</td>
<td>391</td>
</tr>
</table>

### 8.2.6

### 8.3

8.3.1

8.3.2

8.3.3

8.3.4

8.3.5

<table>
<tr>
<th colspan="3">UCIe Debug and Test Architecture (UDA)</th>
<th>391</th>
</tr>
<tr>
<td>Overview</td>
<td></td>
<td></td>
<td>391</td>
</tr>
<tr>
<td>8.3.1.1</td>
<td>DFx Management</td>
<td>Hub (DMH)</td>
<td>392</td>
</tr>
<tr>
<td>8.3.1.2</td>
<td colspan="2">DFx Management Spoke (DMS)</td>
<td>392</td>
</tr>
<tr>
<td>8.3.1.3</td>
<td colspan="2">Supported Protocols</td>
<td>393</td>
</tr>
<tr>
<td></td>
<td>8.3.1.3.1</td>
<td>UCIe Memory Access Protocol (UMAP)</td>
<td>393</td>
</tr>
<tr>
<td></td>
<td>8.3.1.3.2</td>
<td>Vendor-defined Test and Debug Protocol</td>
<td>393</td>
</tr>
<tr>
<td>8.3.1.4</td>
<td colspan="2">UDM and UCIe Memory Access Protocol Message</td>
<td></td>
</tr>
<tr>
<td></td>
<td colspan="2">Encapsulation over UCIe</td>
<td>394</td>
</tr>
<tr>
<td>8.3.1.5</td>
<td colspan="2">UCIe Test Port Options and Other Considerations</td>
<td>394</td>
</tr>
<tr>
<td></td>
<td>8.3.1.5.1</td>
<td>Determinism Considerations</td>
<td>394</td>
</tr>
<tr>
<td>8.3.1.6</td>
<td>DFx Security</td>
<td></td>
<td>394</td>
</tr>
<tr>
<td colspan="3">Sort/Pre-bond Chiplet Testing with UDA</td>
<td>395</td>
</tr>
<tr>
<td>SiP-level</td>
<td>Chiplet Testing</td>
<td>with UDA</td>
<td>396</td>
</tr>
<tr>
<td colspan="2">System Debug with</td>
<td>UDA</td>
<td>397</td>
</tr>
<tr>
<td>DMH/DMS</td>
<td>Registers</td>
<td></td>
<td>397</td>
</tr>
<tr>
<td></td>
<td>DMH/DMS</td>
<td>Register Address Space and Access Mechanism</td>
<td>397</td>
</tr>
<tr>
<td>{ 8 . 3 . 5 . 1 }<br>{ 8 . 3 . 5 . 2 }</td>
<td colspan="2">DMH Registers</td>
<td>398</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.1</td>
<td>Ver (Offset 00h)</td>
<td>399</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.2</td>
<td>Capability ID (Offset 02h)</td>
<td>399</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.3</td>
<td>DBG_CAP - Debug Capabilities (Offset 04h)</td>
<td>400</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.4</td>
<td>DBG_CTL - Debug Control (Offset 08h)</td>
<td>400</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.5</td>
<td>DBG_STS - Debug Status (Offset Ah)</td>
<td>400</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.6</td>
<td>DMH_Length_Low - DMH Register Space</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Length Low (Offset 10h)</td>
<td>400</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.7</td>
<td>DMH_Length_High - DMH Register Space</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Length High (Offset 14h)</td>
<td>400</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.8</td>
<td>DMH_Ext_Cap_Low - DMH Extended Capability</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Pointer Low (Offset 18h)</td>
<td>401</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.9</td>
<td>DMH_Ext_Cap_High - DMH Extended Capability</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Pointer High</td>
<td>401</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.10</td>
<td>DMS_Start_Low $- \quad D M S$ Starting Address</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Low (Offset 20h)</td>
<td>401</td>
</tr>
<tr>
<td></td>
<td>8.3.5.2.11</td>
<td>DMS_Start_High - DMS Starting Address</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>High (Offset 24h)</td>
<td>401</td>
</tr>
<tr>
<td>8.3.5.3</td>
<td colspan="2">DMS Registers</td>
<td>401</td>
</tr>
<tr>
<td></td>
<td>8.3.5.3.1</td>
<td>"Empty" Spoke Registers</td>
<td>402</td>
</tr>
<tr>
<td></td>
<td>8.3.5.3.2</td>
<td>Common DMS Registers for</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>All Non-empty Spokes</td>
<td>402</td>
</tr>
<tr>
<td></td>
<td>8.3.5.3.3</td>
<td>DMS Registers of UCIe Spoke Types</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>('Spoke Type' = 0 through 2)</td>
<td>407</td>
</tr>
<tr>
<td></td>
<td>8.3.5.3.4</td>
<td>DMS Registers of Vendor-defined Spoke Types</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>('Spoke Type' = 128 through 255)</td>
<td>411</td>
</tr>
<tr>
<td></td>
<td>8.3.5.3.5</td>
<td>DMS Register Implementation in UCIe Adapter</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>and in UCIe Physical Layer</td>
<td>412</td>
</tr>
<tr>
<td colspan="2">Management Capabilities</td>
<td></td>
<td>412</td>
</tr>
<tr>
<td colspan="2">Early Firmware Download</td>
<td></td>
<td>412</td>
</tr>
<tr>
<td>8.4.1.1</td>
<td colspan="2">Early Firmware Download Guidelines</td>
<td>412</td>
</tr>
<tr>
<td>8.4.1.2</td>
<td colspan="2">Early Firmware Download Capability</td>
<td>413</td>
</tr>
<tr>
<td>8.4.1.3</td>
<td>Early Firmware</td>
<td>Download Asset Class ID</td>
<td>414</td>
</tr>
<tr>
<td>8.4.1.4</td>
<td>Early Firmware</td>
<td>Download Initialization</td>
<td>415</td>
</tr>
<tr>
<td>8.4.1.5</td>
<td>Early Firmware</td>
<td>Download States and Error</td>
<td>415</td>
</tr>
<tr>
<td>8.4.1.6</td>
<td>Early Firmware</td>
<td>Download Capabilities</td>
<td>416</td>
</tr>
<tr>
<td>8.4.1.7</td>
<td colspan="2">Early Firmware Download Control</td>
<td>417</td>
</tr>
<tr>
<td>8.4.1.8</td>
<td colspan="2">Early Firmware Download Flow</td>
<td>417</td>
</tr>
<tr>
<td>8.4.1.9</td>
<td colspan="2">Circular Buffer Requirements for Early Firmware Download</td>
<td>418</td>
</tr>
</table>

8.4

8.4.1

8.4.2

9.0

9.1

9.2

9.3

9.4

9.5

9.5.1

9.5.2

9.5.3

<table>
<tr>
<td colspan="2">Power</td>
<td>Management</td>
<td>418</td>
</tr>
<tr>
<td colspan="2">8.4.2.1</td>
<td>Fast Throttle</td>
<td>418</td>
</tr>
<tr>
<td colspan="2"></td>
<td>8.4.2.1.1 Fast Throttle Overview</td>
<td>418</td>
</tr>
<tr>
<td colspan="2"></td>
<td>$8 . 4 . 2 . 1 . 2$ Fast Throttle Capability Structures</td>
<td>421</td>
</tr>
<tr>
<td colspan="2"></td>
<td>8.4.2.1.3 Fast Throttle Control Structures</td>
<td>428</td>
</tr>
<tr>
<td colspan="2"></td>
<td>8.4.2.1.4 Fast Throttle Logging Structures</td>
<td>434</td>
</tr>
<tr>
<td colspan="2"></td>
<td>8.4.2.1.5 Fast Throttle Address Map</td>
<td>436</td>
</tr>
<tr>
<td colspan="2">8.4.2.2</td>
<td>{ \text { Emergency } }<br>{ 8 4 2 7 1 } Shutdown</td>
<td>437</td>
</tr>
<tr>
<td colspan="2"></td>
<td>Emergency Shutdown Overview</td>
<td>437</td>
</tr>
<tr>
<td colspan="2"></td>
<td>$8 . 4 . 2 . 2 . 2$ Emergency Shutdown Capability Structures</td>
<td>440</td>
</tr>
<tr>
<td colspan="2"></td>
<td>Emergency Shutdown Control Structures</td>
<td>447</td>
</tr>
<tr>
<td colspan="2"></td>
<td>8.4.2.2.4 Emergency Shutdown Logging Structures</td>
<td>453</td>
</tr>
<tr>
<td colspan="2"></td>
<td>8.4.2.2.5 Emergency Shutdown Address Map</td>
<td>455</td>
</tr>
<tr>
<td colspan="3">Configuration and Parameters</td>
<td>456</td>
</tr>
<tr>
<td colspan="2">High-level Software</td>
<td>View of UCIe</td>
<td>456</td>
</tr>
<tr>
<td colspan="2">SW Discovery of</td>
<td>UCIe Links</td>
<td>457</td>
</tr>
<tr>
<td colspan="2">Register Location</td>
<td>Details and Access Mechanism</td>
<td>457</td>
</tr>
<tr>
<td colspan="2">Software view</td>
<td>Examples</td>
<td>459</td>
</tr>
<tr>
<td colspan="2">UCIe Registers</td>
<td></td>
<td>462</td>
</tr>
<tr>
<td colspan="3">UCIe Link DVSEC</td>
<td>462</td>
</tr>
<tr>
<td colspan="2">9.5.1.1</td>
<td>PCI Express Extended Capability Header (Offset 0h)</td>
<td>464</td>
</tr>
<tr>
<td colspan="2">9.5.1.2</td>
<td>Designated Vendor Specific Header 1, 2 (Offsets 4h and 8h)</td>
<td>464</td>
</tr>
<tr>
<td colspan="2"></td>
<td>Capability Descriptor (Offset Ah)</td>
<td>465</td>
</tr>
<tr>
<td colspan="2">{ 9 . 5 . 1 . 3 }<br>{ 9 . 5 . 1 . 4 }</td>
<td>UCIe Link DVSEC - UCIe Link Capability (Offset Ch)</td>
<td>466</td>
</tr>
<tr>
<td colspan="2">9.5.1.5</td>
<td>UCIe Link DVSEC - UCIe Link Control (Offset 10h)</td>
<td>468</td>
</tr>
<tr>
<td colspan="2">9.5.1.6</td>
<td>UCIe Link DVSEC - UCIe Link Status (Offset 14h)</td>
<td>470</td>
</tr>
<tr>
<td colspan="2">9.5.1.7</td>
<td>UCIe Link DVSEC - Link Event Notification Control (Offset 18h)</td>
<td>472</td>
</tr>
<tr>
<td colspan="2">9.5.1.8</td>
<td>UCIe Link DVSEC - Error Notification Control (Offset 1Ah)</td>
<td>473</td>
</tr>
<tr>
<td colspan="2">9.5.1.9</td>
<td>UCIe Link DVSEC - Register Locator 0, 1, 2, 3 Low</td>
<td rowspan="2"></td>
</tr>
<tr>
<td colspan="2" rowspan="2"></td>
<td>(Offset 1Ch and when Register Locators 1, 2, 3</td>
</tr>
<tr>
<td>are present Offsets 24h, 2Ch, and 34h respectively)</td>
<td>476</td>
</tr>
<tr>
<td colspan="2">9.5.1.10</td>
<td rowspan="2">UCIe Link DVSEC - Register Locator 0, 1, 2, 3 High (Offset 20h and when Register Locators 1, 2, 3</td>
<td rowspan="2"></td>
</tr>
<tr>
<td colspan="2"></td>
</tr>
<tr>
<td colspan="2"></td>
<td>Are Present Offsets 28h, 30h, and 38h respectively)</td>
<td>477</td>
</tr>
<tr>
<td colspan="2">9.5.1.11</td>
<td>UCIe Link DVSEC - Sideband Mailbox Index Low (Offset is design dependent)</td>
<td>477</td>
</tr>
<tr>
<td colspan="2">9.5.1.12</td>
<td>UCIe Link DVSEC - Sideband Mailbox Index High (Offset is design dependent)</td>
<td>478</td>
</tr>
<tr>
<td colspan="2">9.5.1.13</td>
<td>UCIe Link DVSEC - Sideband Mailbox Data Low (Offset is design dependent)</td>
<td>478</td>
</tr>
<tr>
<td colspan="2">9.5.1.14</td>
<td>UCIe Link DVSEC - Sideband Mailbox Data High (Offset is design dependent)</td>
<td>478</td>
</tr>
<tr>
<td colspan="2">9.5.1.15</td>
<td>UCIe Link DVSEC - Sideband Mailbox Control</td>
<td></td>
</tr>
<tr>
<td colspan="2"></td>
<td>(Offset is design dependent)</td>
<td>479</td>
</tr>
<tr>
<td colspan="2">9.5.1.16</td>
<td>UCIe Link DVSEC - Sideband Mailbox Status</td>
<td></td>
</tr>
<tr>
<td colspan="2"></td>
<td>(Offset is design dependent)</td>
<td>479</td>
</tr>
<tr>
<td colspan="2">9.5.1.17</td>
<td>- Requester ID (Offset is design dependent)</td>
<td>479</td>
</tr>
<tr>
<td colspan="2">9.5.1.18</td>
<td>\text { UCIe Link DVSEC }<br>\text { UCIe Link DVSEC } - Associated Port Numbers</td>
<td rowspan="2">480</td>
</tr>
<tr>
<td colspan="2"></td>
<td>(Offset is design dependent)</td>
</tr>
<tr>
<td colspan="2">9.5.1.19</td>
<td>Examples of setting the Length field in DVSEC for various Scenarios</td>
<td>480</td>
</tr>
<tr>
<td></td>
<td colspan="2">UCIe Switch Register Block (UiSRB) DVSEC Capability</td>
<td>480</td>
</tr>
<tr>
<td colspan="2">9.5.2.1</td>
<td>PCI Express Extended Capability Header (Offset 0h)</td>
<td>480</td>
</tr>
<tr>
<td colspan="2">9.5.2.2</td>
<td>Designated Vendor Specific Header 1, 2 (Offsets 4h and 8h)</td>
<td>480</td>
</tr>
<tr>
<td colspan="2">9.5.2.3</td>
<td>UCIe Switch Register Block (UiSRB) Base Address (Offset Ch)</td>
<td>481</td>
</tr>
<tr>
<td colspan="2">D2D/PHY</td>
<td>Register Block</td>
<td>482</td>
</tr>
<tr>
<td colspan="2">9.5.3.1</td>
<td>UCIe Register Block Header</td>
<td>482</td>
</tr>
</table>

<table>
<tr>
<th></th>
<th></th>
<th>Contents</th>
</tr>
<tr>
<td>9.5.3.2</td>
<td>Uncorrectable Error Status Register (Offset 10h)</td>
<td>482</td>
</tr>
<tr>
<td>9.5.3.3</td>
<td>Uncorrectable Error Mask Register (Offset 14h)</td>
<td>483</td>
</tr>
<tr>
<td>9.5.3.4</td>
<td>Uncorrectable Error Severity Register (Offset 18h)</td>
<td>484</td>
</tr>
<tr>
<td>9.5.3.5</td>
<td>Correctable Error Status Register (Offset 1Ch)</td>
<td>484</td>
</tr>
<tr>
<td>9.5.3.6</td>
<td>Correctable Error Mask Register (Offset 20h)</td>
<td>485</td>
</tr>
<tr>
<td>9.5.3.7</td>
<td>Header Log 1 Register (Offset 24h)</td>
<td>485</td>
</tr>
<tr>
<td>9.5.3.8</td>
<td>Header Log 2 Register (Offset 2Ch)</td>
<td>486</td>
</tr>
<tr>
<td>9.5.3.9</td>
<td>Error and Link Testing Control Register (Offset 30h)</td>
<td>488</td>
</tr>
<tr>
<td>9.5.3.10</td>
<td>Runtime Link Testing Parity Log 0 (Offset 34h)</td>
<td>489</td>
</tr>
<tr>
<td>9.5.3.11</td>
<td>Runtime Link Testing Parity Log 1 (Offset 3Ch)</td>
<td>489</td>
</tr>
<tr>
<td>9.5.3.12</td>
<td>Runtime Link Testing Parity Log 2 (Offset 44h)</td>
<td>489</td>
</tr>
<tr>
<td>9.5.3.13</td>
<td>Runtime Link Testing Parity Log 3 (Offset 4Ch)</td>
<td>489</td>
</tr>
<tr>
<td>9.5.3.14</td>
<td>Advertised Adapter Capability Log (Offset 54h)</td>
<td>490</td>
</tr>
<tr>
<td>9.5.3.15</td>
<td>Finalized Adapter Capability Log (Offset 5Ch)</td>
<td>490</td>
</tr>
<tr>
<td>$9 . 5 . 3 . 1 6$</td>
<td>Advertised CXL Capability Log (Offset 64h)</td>
<td>490</td>
</tr>
<tr>
<td></td>
<td>Finalized CXL Capability Log (Offset 6Ch)</td>
<td>490</td>
</tr>
<tr>
<td>9.5.3.18</td>
<td>Advertised Multi-Protocol Capability Log Register (Offset 78h)</td>
<td>490</td>
</tr>
<tr>
<td>9.5.3.19</td>
<td>Finalized Multi-Protocol Capability Log Register (Offset 80h)</td>
<td>491</td>
</tr>
<tr>
<td>9.5.3.20</td>
<td>Advertised CXL Capability Log Register for Stack 1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>(Offset 88h)</td>
<td>491</td>
</tr>
<tr>
<td>9.5.3.21</td>
<td>Finalized CXL Capability Log Register for Stack 1 (Offset 90h)</td>
<td>491</td>
</tr>
<tr>
<td>9.5.3.22</td>
<td>PHY Capability (Offset 1000h)</td>
<td>492</td>
</tr>
<tr>
<td>9.5.3.23</td>
<td>PHY Control (Offset 1004h)</td>
<td>493</td>
</tr>
<tr>
<td>9.5.3.24</td>
<td>PHY Status (Offset 1008h)</td>
<td>495</td>
</tr>
<tr>
<td>9.5.3.25</td>
<td>PHY Initialization and Debug (Offset 100Ch)</td>
<td>496</td>
</tr>
<tr>
<td>9.5.3.26</td>
<td>Training Setup 1 (Offset 1010h)</td>
<td>497</td>
</tr>
<tr>
<td>9.5.3.27</td>
<td>Training Setup 2 (Offset 1020h)</td>
<td>497</td>
</tr>
<tr>
<td>9.5.3.28</td>
<td>Training Setup 3 (Offset 1030h)</td>
<td>498</td>
</tr>
<tr>
<td>9.5.3.29</td>
<td>Training Setup 4 (Offset 1050h)</td>
<td>498</td>
</tr>
<tr>
<td>9.5.3.30</td>
<td>Current Lane Map Module 0 (Offset 1060h)</td>
<td>499</td>
</tr>
<tr>
<td>9.5.3.31</td>
<td>Current Lane Map Module 1 (Offset 1068h)</td>
<td>499</td>
</tr>
<tr>
<td>9.5.3.32</td>
<td>Current Lane Map Module 2 (Offset 1070h)</td>
<td>499</td>
</tr>
<tr>
<td>9.5.3.33</td>
<td>Current Lane Map Module 3 (Offset 1078h)</td>
<td>499</td>
</tr>
<tr>
<td>9.5.3.34</td>
<td>Error Log 0 (Offset 1080h)</td>
<td>500</td>
</tr>
<tr>
<td>9.5.3.35</td>
<td>Error Log 1 (Offset 1090h)</td>
<td>501</td>
</tr>
<tr>
<td>9.5.3.36</td>
<td>Runtime Link Test Control (Offset 1100h)</td>
<td>501</td>
</tr>
<tr>
<td>9.5.3.37</td>
<td>Runtime Link Test Status (Offset 1108h)</td>
<td>503</td>
</tr>
<tr>
<td>9.5.3.38</td>
<td>Mainband Data Repair (Offset 110Ch)</td>
<td>503</td>
</tr>
<tr>
<td>9.5.3.39</td>
<td>Clock, Track, Valid and Sideband Repair (Offset 1134h)</td>
<td>504</td>
</tr>
<tr>
<td>9.5.3.40</td>
<td>UCIe Link Health Monitor (UHM) DVSEC</td>
<td>505</td>
</tr>
<tr>
<td></td>
<td>9.5.3.40.1 UHM Status (Offset Eh)</td>
<td>506</td>
</tr>
<tr>
<td></td>
<td>9.5.3.40.2 Eye Margin (Starting Offset 18h)</td>
<td>506</td>
</tr>
<tr>
<td colspan="2">Test/Compliance Register Block</td>
<td>507</td>
</tr>
<tr>
<td>9.5.4.1</td>
<td>UCIe Register Block Header</td>
<td>507</td>
</tr>
<tr>
<td>9.5.4.2</td>
<td>D2D Adapter Test/Compliance Register Block Offset</td>
<td>508</td>
</tr>
<tr>
<td>9.5.4.3</td>
<td>PHY Test/Compliance Register Block Offset</td>
<td>508</td>
</tr>
<tr>
<td>9.5.4.4</td>
<td>D2D Adapter Test/Compliance Register Block</td>
<td>509</td>
</tr>
<tr>
<td></td>
<td>9.5.4.4.1 Adapter Compliance Control</td>
<td>509</td>
</tr>
<tr>
<td></td>
<td>9.5.4.4.2 Flit Tx Injection Control</td>
<td>509</td>
</tr>
<tr>
<td></td>
<td>9.5.4.4.3 Adapter Test Status (Offset 30h from D2DOFF)</td>
<td>511</td>
</tr>
<tr>
<td></td>
<td>9.5.4.4.4 Link State Injection Control Stack 0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>(Offset 34h from D2DOFF)</td>
<td>512</td>
</tr>
<tr>
<td></td>
<td>9.5.4.4.5 Link State Injection Control Stack 1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>(Offset 38h from D2DOFF)</td>
<td>512</td>
</tr>
<tr>
<td></td>
<td>9.5.4.4.6 Retry Injection Control (Offset 40h from D2DOFF)</td>
<td>513</td>
</tr>
<tr>
<td>9.5.4.5</td>
<td>PHY Test/Compliance Register Block</td>
<td>514</td>
</tr>
<tr>
<td colspan="3">9.5.4.5.1 Physical Layer Compliance Control 1 (Offsets 000h,</td>
</tr>
<tr>
<td></td>
<td>400h, 800h, and C00h from PHYOFF)</td>
<td>514</td>
</tr>
</table>

9.5.4

9.5.4.5.2
Physical Layer Compliance Control 2 (Offsets 008h,

408h, 808h, and C08h from PHYOFF)
516

9.5.4.5.3
Physical Layer Compliance Status 1 (Offsets 010h,

410h, 810h, and C10h from PHYOFF)
517

9.5.4.5.4
Physical Layer Compliance Status 2 (Offsets 018h,
518

418h, 818h, and C18h from PHYOFF)

9.5.4.5.5
Physical Layer Compliance Status 3 (Offsets 020h,
420h, 820h, and C20h from PHYOFF)
518

9.6

UCIe Link Registers in Streaming Mode and System SW/FW Implications
519

9.7
MSI and MSI-X Capability in Hosts/Switches for UCIe Interrupt
519

9.8
UCIe Early Discovery Table (UEDT)
520

10.0
0 Interface Definitions
521

10.1
Raw Die-to-Die Interface (RDI)
521

10.1.1
Interface reset requirements
529

10.1.2
Interface clocking requirements
529

10.1.3
Dynamic clock gating
530

10.1.3.1
Rules and description for
Ip_wake_req/pl_wake_ack handshake
530

10.1.3.2
Rules and description for pl_clk_req/lp_clk_ack handshake
530

532

10.1.5
RDI State Machine

533

10.1.6
RDI bring up flow

534

10.1.7
RDI PM flow
535

10.2
Flit-Aware Die-to-Die Interface (FDI)

539

10.2.1
Interface reset requirements
547

10.2.2
Interface clocking requirements
547

10.2.3
Dynamic clock gating
547

10.2.3.1
Rules and description for

Ip_wake_req/pl_wake_ack $P _ { R }$ handshake
547

10.2.3.2
description for pl_clk_req/Ip_clk_ack handshake
548

10.2.4
Data Transfer

549

10.2.5
Examples of pl_flit_cancel Timing Relationships

551

10.2.6
FDI State Machine

552

$1 0 . 2 . 7$
Rx_active_req/Sts Handshake

552

$1 0 . 2 . 9$
FDI PM Flow

555

10.3

Common rules for FDI and RDI

559

10.3.1
Byte Mapping for FDI and RDI

559

10.3.2
Stallreq/Ack Mechanism

563

10.3.3
State Request and Status

564

10.3.3.1
Reset State rules

565

$1 0 . 3 . 3 . 2$
Active State rules

566

10.3.3.4
Retrain State Rules

566

10.3.3.5
LinkReset State Rules

567

10.3.3.6
Disabled State Rules
568

10.3.3.7
LinkError State Rules
568

10.3.3.8
Common State Rules

569

10.3.4
Vendor-defined Signals

572

10.3.5
Example Flow Diagrams

575

10.3.5.1
LinkReset Entry and Exit
575

10.3.5.2
LinkError

576

10.3.5.3
Example of L2 Cross Product with Retrain on RDI
577

PM Entry/Exit Rules
566

FDI Bring up flow

553

10.2.4.1
DLLP transfer rules for 256B Flit Mode

550

10.1.4
Data Transfer

9.5.5
Implementation Specific Register Blocks
518

<table>
<tr>
<th colspan="2"></th>
<th>Contents</th>
</tr>
<tr>
<td></td>
<td>10.3.5.4 L2 Exit Example for RDI</td>
<td>578</td>
</tr>
<tr>
<td colspan="2">11.0 Compliance</td>
<td>579</td>
</tr>
<tr>
<td>11.1</td>
<td>Protocol Layer Compliance</td>
<td>580</td>
</tr>
<tr>
<td colspan="2">11.2 Adapter Compliance</td>
<td>580</td>
</tr>
<tr>
<td colspan="2">11.3 PHY Compliance</td>
<td>581</td>
</tr>
<tr>
<td colspan="2">A CXL/PCIe Register applicability to UCIe</td>
<td>582</td>
</tr>
<tr>
<td>A.1</td>
<td>CXL Registers applicability to UCIe</td>
<td>582</td>
</tr>
<tr>
<td colspan="2">A.2 PCIe Register applicability to UCIe</td>
<td>582</td>
</tr>
<tr>
<td>A.3</td>
<td>PCIe/CXL registers that need to be part of D2D</td>
<td>584</td>
</tr>
<tr>
<td colspan="2">B AIB Interoperability</td>
<td>585</td>
</tr>
<tr>
<td>B.1</td>
<td>AIB Signal Mapping</td>
<td>585</td>
</tr>
<tr>
<td></td>
<td>B.1.1 Data path</td>
<td>585</td>
</tr>
<tr>
<td></td>
<td>B.1.2 Always high Valid</td>
<td>585</td>
</tr>
<tr>
<td></td>
<td>B.1.3 Sideband</td>
<td>585</td>
</tr>
<tr>
<td></td>
<td>B.1.4 Raw Die-to-Die interface</td>
<td>586</td>
</tr>
<tr>
<td colspan="2">B.2 Initialization</td>
<td>587</td>
</tr>
<tr>
<td>B.3</td>
<td>Bump Map</td>
<td>587</td>
</tr>
</table>

#### Figures

<table>
<tr>
<td>1-1</td>
<td>A Package Composed of CPU Dies, Accelerator Die(s), and I/O Tile Die Connected through UCIe</td>
<td>39</td>
</tr>
<tr>
<td>1-2</td>
<td>UCIe enabling long-reach connectivity at Rack/Pod Level</td>
<td>39</td>
</tr>
<tr>
<td>1-3</td>
<td>Standard Package interface</td>
<td>40</td>
</tr>
<tr>
<td>1-4</td>
<td>Advanced Package interface: Example 1</td>
<td>41</td>
</tr>
<tr>
<td>1-5</td>
<td>Advanced Package interface: Example 2</td>
<td>41</td>
</tr>
<tr>
<td>1-6</td>
<td>Advanced Package interface: Example 3</td>
<td>41</td>
</tr>
<tr>
<td>1-7</td>
<td>Example of UCIe-3D</td>
<td>41</td>
</tr>
<tr>
<td>1-8</td>
<td>UCIe Layers and functionalities</td>
<td>42</td>
</tr>
<tr>
<td>1-9</td>
<td>Physical Layer components</td>
<td>43</td>
</tr>
<tr>
<td>1-10</td>
<td>Single module configuration: Advanced Package</td>
<td>44</td>
</tr>
<tr>
<td>1-11</td>
<td>Single module configuration: Standard Package</td>
<td>45</td>
</tr>
<tr>
<td>1-12</td>
<td>Two-module configuration for Standard Package</td>
<td>45</td>
</tr>
<tr>
<td>1-13</td>
<td>Four-module configuration for Standard Package</td>
<td>45</td>
</tr>
<tr>
<td>1-14</td>
<td>Example of a Two-module Configuration for Advanced Package</td>
<td>46</td>
</tr>
<tr>
<td>1-15</td>
<td>One-port Sideband-only Link</td>
<td>46</td>
</tr>
<tr>
<td>1-16</td>
<td>Two-port Sideband-only Link</td>
<td>46</td>
</tr>
<tr>
<td>1-17</td>
<td>Four-port Sideband-only Link</td>
<td>47</td>
</tr>
<tr>
<td>1-18</td>
<td>Block Diagram for UCIe Retimer Connection</td>
<td>47</td>
</tr>
<tr>
<td>2-1</td>
<td>Color-coding Convention in Flit Format Byte Map Figures</td>
<td>52</td>
</tr>
<tr>
<td>2-2</td>
<td>68B Flit Format on FDI</td>
<td>56</td>
</tr>
<tr>
<td></td>
<td>Functionalities in the Die-to-Die Adapter</td>
<td>58</td>
</tr>
<tr>
<td></td>
<td>Example Configurations</td>
<td>61</td>
</tr>
<tr>
<td>{ 3 - 1 }<br>{ 3 - 2 }<br>{ 3 - 3 }<br>{ 3 - 4 }</td>
<td>Stages of UCIe Link Initialization</td>
<td>62</td>
</tr>
<tr>
<td></td>
<td>Parameter Exchange for CXL or PCIe (i.e., "68B Flit Mode" or "CXL 256B Flit Mode" is 1 in {FinCap.Adapter} )</td>
<td>66</td>
</tr>
<tr>
<td>3-5</td>
<td>Both Stacks are CXL or PCIe</td>
<td>68</td>
</tr>
<tr>
<td>3-6</td>
<td>$S t a c k \quad 0 \quad i s \quad P C I e ,$ Stack 1 is Streaming</td>
<td>68</td>
</tr>
<tr>
<td>3-7</td>
<td>Stack 0 is Streaming, Stack 1 is PCIe</td>
<td>69</td>
</tr>
<tr>
<td>3-8</td>
<td>Both Stacks are Streaming</td>
<td>69</td>
</tr>
<tr>
<td>3-9</td>
<td>Stack 0 is Streaming, Stack 1 is CXL</td>
<td>70</td>
</tr>
<tr>
<td>3-10</td>
<td>Format 1: Raw Format</td>
<td>71</td>
</tr>
<tr>
<td>3-11</td>
<td>Format 2: 68B Flit Format</td>
<td>74</td>
</tr>
<tr>
<td>3-12</td>
<td>Format 2: 68B Flit Format PDS Example 1</td>
<td>75</td>
</tr>
<tr>
<td>3-13</td>
<td>Format 2: 68B Flit Format PDS Example 2 - Extra Os Padded to Make the Data Transfer a Multiple of 256B</td>
<td>75</td>
</tr>
<tr>
<td></td>
<td>Format 3: Standard 256B End Header Flit Format for PCIe</td>
<td>77</td>
</tr>
<tr>
<td>{ 3 - 1 4 }<br>{ 3 - 1 5 }<br>{ 3 - 1 6 }</td>
<td>Format 3: Standard 256B End Header Flit Format for Streaming Protocol</td>
<td>77</td>
</tr>
<tr>
<td></td>
<td>Format 3: Standard 256B End Header Flit Format for Management Transport Protocol</td>
<td>77</td>
</tr>
<tr>
<td>3-17</td>
<td>Format 4: Standard 256B Start Header Flit Format for CXL.cachemem or Streaming Protocol</td>
<td>78</td>
</tr>
<tr>
<td>3-18</td>
<td>Format 4: Standard 256B Start Header Flit Format for CXL.io or PCIe</td>
<td>78</td>
</tr>
<tr>
<td>3-19</td>
<td>Format 4: Standard 256B Start Header Flit Format for Management Transport Protocol</td>
<td>78</td>
</tr>
<tr>
<td>3-20</td>
<td>Format 5: Latency-Optimized 256B without Optional Bytes Flit Format for CXL.io</td>
<td>81</td>
</tr>
<tr>
<td>3-21</td>
<td>Format 5: Latency-Optimized 256B without Optional Bytes Flit Format for CXL.cachemem and Streaming Protocol</td>
<td>82</td>
</tr>
<tr>
<td>3-22</td>
<td>Format 5: Latency-Optimized 256B without Optional Bytes Flit Format for Management Transport Protocol</td>
<td>82</td>
</tr>
</table>

<table>
<tr>
<td>3-23</td>
<td>Format 6: Latency-Optimized 256B with Optional Bytes Flit Format for CXL.io or PCIe</td>
<td>82</td>
</tr>
<tr>
<td>3-24</td>
<td>Format 6: Latency-Optimized 256B with Optional Bytes Flit Format for CXL.cachemem</td>
<td>83</td>
</tr>
<tr>
<td>3-25</td>
<td>Format 6: Latency-Optimized 256B with Optional Bytes Flit Format for Streaming Protocol</td>
<td>83</td>
</tr>
<tr>
<td>3-26</td>
<td>Format 6: Latency-Optimized 256B with Optional Bytes Flit Format for Management Transport Protocol</td>
<td>83</td>
</tr>
<tr>
<td>3-27</td>
<td>State Machine Hierarchy Examples</td>
<td>89</td>
</tr>
<tr>
<td>3-28</td>
<td>Example of Hierarchical PM Entry for CXL</td>
<td>91</td>
</tr>
<tr>
<td>3-29</td>
<td>Diagram of CRC Calculation</td>
<td>92</td>
</tr>
<tr>
<td>3-30</td>
<td>Successful Parity Feature negotiation between Die 1 Tx and Die 0 Rx</td>
<td>96</td>
</tr>
<tr>
<td>3-31</td>
<td>Unsuccessful Parity Feature negotiation between Die 1 Tx and Die 0 Rx</td>
<td>97</td>
</tr>
<tr>
<td>4-1</td>
<td>Bit arrangement within a byte transfer</td>
<td>98</td>
</tr>
<tr>
<td>4-2</td>
<td>Byte map for x64 interface</td>
<td>99</td>
</tr>
<tr>
<td>4-3</td>
<td>Byte map for x32 interface</td>
<td>99</td>
</tr>
<tr>
<td>4-4</td>
<td>Byte map for x16 interface</td>
<td>99</td>
</tr>
<tr>
<td>4-5</td>
<td>Byte to Lane mapping for Standard package x16 degraded to x8</td>
<td>100</td>
</tr>
<tr>
<td>4-6</td>
<td>Valid framing example</td>
<td>101</td>
</tr>
<tr>
<td>4-7</td>
<td>Example 64-bit Sideband Serial Packet Transfer</td>
<td>102</td>
</tr>
<tr>
<td>4-8</td>
<td>Sideband Packet Transmission: Back-to-Back</td>
<td>102</td>
</tr>
<tr>
<td>4-9</td>
<td>Example 64-bit Sideband Serial Packet Transfer in Sideband Performant Mode</td>
<td>103</td>
</tr>
<tr>
<td>4-10</td>
<td>Sideband Packet Transmission: Back-to-Back in Sideband Performant Mode</td>
<td>103</td>
</tr>
<tr>
<td>4-11</td>
<td>Example of a Normal Traffic Packet Interrupted by a Single Priority Traffic Packet</td>
<td>104</td>
</tr>
<tr>
<td>4-12</td>
<td>Data Lane remapping possibilities to fix potential defects</td>
<td>107</td>
</tr>
<tr>
<td>4-13</td>
<td>Data Lane remapping: Mux chain</td>
<td>108</td>
</tr>
<tr>
<td>4-14</td>
<td>Example of Single Lane failure remapping</td>
<td>110</td>
</tr>
<tr>
<td>4-15</td>
<td>Example of Single Lane remapping implementation</td>
<td>110</td>
</tr>
<tr>
<td>4-16</td>
<td>Example of Two Lane failure remapping</td>
<td>112</td>
</tr>
<tr>
<td>4-17</td>
<td>Example of Two Lane remapping implementation</td>
<td>112</td>
</tr>
<tr>
<td>4-18</td>
<td>Clock and Track repair</td>
<td>115</td>
</tr>
<tr>
<td>4-19</td>
<td>Clock and track repair: Differential Rx</td>
<td>116</td>
</tr>
<tr>
<td>4-20</td>
<td>Clock and track repair: Pseudo Differential Rx</td>
<td>116</td>
</tr>
<tr>
<td>4-21</td>
<td>Clock and Track Lane repair scheme</td>
<td>117</td>
</tr>
<tr>
<td>4-22</td>
<td>Clock and track repair: CKP repair</td>
<td>117</td>
</tr>
<tr>
<td>4-23</td>
<td>Clock and track repair: CKN repair</td>
<td>117</td>
</tr>
<tr>
<td>4-24</td>
<td>Clock and track repair: Track repair</td>
<td>118</td>
</tr>
<tr>
<td>4-25</td>
<td>Valid repair: Normal Path</td>
<td>118</td>
</tr>
<tr>
<td>4-26</td>
<td>Valid Repair: Repair Path</td>
<td>118</td>
</tr>
<tr>
<td>4-27</td>
<td>Test and training logic</td>
<td>119</td>
</tr>
<tr>
<td>4-28</td>
<td>Lane failure detection</td>
<td>120</td>
</tr>
<tr>
<td>4-29</td>
<td>All Lane error detection</td>
<td>120</td>
</tr>
<tr>
<td>4-30</td>
<td>LFSR implementation</td>
<td>122</td>
</tr>
<tr>
<td>4-31</td>
<td>LFSR alternate implementation</td>
<td>123</td>
</tr>
<tr>
<td>4-32</td>
<td>Example Retimer bring up when performing speed/width match</td>
<td>130</td>
</tr>
<tr>
<td>4-33</td>
<td>Link Training State Machine</td>
<td>131</td>
</tr>
<tr>
<td>4-34</td>
<td>MBINIT: Mainband Initialization and Repair Flow</td>
<td>137</td>
</tr>
<tr>
<td>4-35</td>
<td>Example Sideband Management Transport Protocol Negotiation - Single-module Scenario</td>
<td>140</td>
</tr>
<tr>
<td>$4 - 3 6$</td>
<td>Example Sideband Management Transport Protocol Negotiation - Two-module Scenario</td>
<td>140</td>
</tr>
<tr>
<td>4-37</td>
<td>Example Sideband MPM Logical Flow with Two Modules and No Module Reversal</td>
<td>142</td>
</tr>
<tr>
<td>4-38</td>
<td>Example Sideband MPM Logical Flow with Two Modules and Module Reversal</td>
<td>143</td>
</tr>
<tr>
<td>4-39</td>
<td>MBINIT "Stall" Example 1</td>
<td>144</td>
</tr>
<tr>
<td>4-40</td>
<td>MBINIT "Stall" Example 2</td>
<td>145</td>
</tr>
</table>

<table>
<tr>
<th></th>
<th></th>
<th>Figures</th>
</tr>
<tr>
<td>$4 - 4 1$</td>
<td>Mainband Training</td>
<td>156</td>
</tr>
<tr>
<td>4-42</td>
<td>Example L2 Exit Flow with L2SPD Capability</td>
<td>173</td>
</tr>
<tr>
<td>4-43</td>
<td>Example of Byte Mapping for Matching Module IDs</td>
<td>175</td>
</tr>
<tr>
<td>4-44</td>
<td>Example of Byte Mapping for Differing Module IDs</td>
<td>175</td>
</tr>
<tr>
<td>4-45</td>
<td>Example of Width Degradation with Byte Mapping for Differing Module IDs</td>
<td>176</td>
</tr>
<tr>
<td>4-46</td>
<td>Example of Byte Mapping with Module Disable</td>
<td>176</td>
</tr>
<tr>
<td>4-47</td>
<td>Decision Flow Chart for Multi-module Advanced Package</td>
<td>177</td>
</tr>
<tr>
<td>4-48</td>
<td>Decision Flow Chart for Multi-module Standard Package</td>
<td>178</td>
</tr>
<tr>
<td>4-49</td>
<td>Implementation Example Showing Two Different Operating Modes of the Same Hardware Implementation</td>
<td>181</td>
</tr>
<tr>
<td>4-50</td>
<td>RDI Byte-to-Module Assignment Example for x64 Interop with x32</td>
<td>182</td>
</tr>
<tr>
<td>4-51</td>
<td>Example of Encapsulated MTPs Transmitted on Sideband Link without Sideband PMO</td>
<td>183</td>
</tr>
<tr>
<td>4-52</td>
<td>Example of a Large Management Packet Split into Two Encapsulated MTPs, with No Segmentation, No Sideband PMO, and with</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Two Link Management Packets between the Two Encapsulated MTPs</td>
<td>183</td>
</tr>
<tr>
<td>5-1</td>
<td>Example Common Reference Clock</td>
<td>185</td>
</tr>
<tr>
<td>5-2</td>
<td>x64 or x32 Advanced Package Module</td>
<td>187</td>
</tr>
<tr>
<td>5-3</td>
<td>x16 or x8 Standard Package Module</td>
<td>187</td>
</tr>
<tr>
<td>5-4</td>
<td>Transmitter</td>
<td>190</td>
</tr>
<tr>
<td>5-5</td>
<td>Transmitter driver example circuit</td>
<td>191</td>
</tr>
<tr>
<td>5-6</td>
<td>Transmitter de-emphasis</td>
<td>193</td>
</tr>
<tr>
<td>5-7</td>
<td>Transmitter de-emphasis waveform</td>
<td>193</td>
</tr>
<tr>
<td>5-8</td>
<td>3-tap Transmitter Equalization (Used at 48 GT/s and 64 GT/s)</td>
<td>194</td>
</tr>
<tr>
<td>5-9</td>
<td>Receiver topology</td>
<td>195</td>
</tr>
<tr>
<td>5-10</td>
<td>Receiver Termination Map for Table 5-10 (Tx Swing = 0.4 V)</td>
<td>198</td>
</tr>
<tr>
<td>5-11</td>
<td>Receiver termination</td>
<td>198</td>
</tr>
<tr>
<td>5-12</td>
<td>Receiver termination map for Table 5-11 (TX Swing = 0.85 V)</td>
<td>199</td>
</tr>
<tr>
<td>5-13</td>
<td>Reference Rx CTLE for 24 GT/s</td>
<td>200</td>
</tr>
<tr>
<td>5-14</td>
<td>Reference Rx CTLE for 64 GT/s</td>
<td>201</td>
</tr>
<tr>
<td>5-15</td>
<td>Clocking architecture</td>
<td>202</td>
</tr>
<tr>
<td>5-16</td>
<td>Track Usage Example</td>
<td>204</td>
</tr>
<tr>
<td>5-17</td>
<td>Example Rectangular Eye Mask Diagram for &lt;= 32 GT/s</td>
<td>205</td>
</tr>
<tr>
<td>5-18</td>
<td>Diamond Eye Mask for 48 GT/s and 64 GT/s</td>
<td>206</td>
</tr>
<tr>
<td>5-19</td>
<td>Example Eye Simulation Setup</td>
<td>207</td>
</tr>
<tr>
<td>5-20</td>
<td>Circuit for VTF calculation</td>
<td>208</td>
</tr>
<tr>
<td>5-21</td>
<td>Loss and Crosstalk Mask</td>
<td>211</td>
</tr>
<tr>
<td>5-22</td>
<td>Viewer Orientation Looking at the Defined UCIe Bump Matrix</td>
<td>211</td>
</tr>
<tr>
<td>5-23</td>
<td>10-column x64 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</td>
<td>212</td>
</tr>
<tr>
<td>5-24</td>
<td>16-column x64 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</td>
<td>213</td>
</tr>
<tr>
<td>5-25</td>
<td>8-column x64 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</td>
<td>214</td>
</tr>
<tr>
<td>5-26</td>
<td>10-column x64 Advanced Package Bump map: Signal exit order</td>
<td>215</td>
</tr>
<tr>
<td>5-27</td>
<td>Enhanced 10-column x64 Advanced Package Bump Map Example for 32 GT/s Implementation</td>
<td>216</td>
</tr>
<tr>
<td>5-28</td>
<td>Enhanced 16-column x64 Advanced Package Bump Map Example for 16 GT/s Implementation</td>
<td>217</td>
</tr>
<tr>
<td>5-29</td>
<td>Enhanced 8-column x64 Advanced Package Bump Map Example for 32 GT/s Implementation</td>
<td>218</td>
</tr>
<tr>
<td>5-30</td>
<td>10-column $\times 6 4$ Package Bump Map for 48 GT/s and 64 GT/s</td>
<td>220</td>
</tr>
<tr>
<td>5-31</td>
<td>10-column x32 Package Bump Map for $< = 3 2 \quad G T / s$</td>
<td>222</td>
</tr>
<tr>
<td>5-32</td>
<td>16-column x32 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</td>
<td>222</td>
</tr>
<tr>
<td>5-33</td>
<td>8-column x32 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</td>
<td>223</td>
</tr>
<tr>
<td>5-34</td>
<td>10-column x32 Advanced Package Bump Map: Signal Exit Order</td>
<td>223</td>
</tr>
<tr>
<td>5-35</td>
<td>Enhanced 10-column x32 Advanced Package Bump Map Example for 32 GT/s Implementation</td>
<td>225</td>
</tr>
</table>

<table>
<tr>
<td>5-36</td>
<td>Enhanced 16-column x32 Advanced Package Bump Map Example for 16 GT/s Implementation</td>
<td>226</td>
</tr>
<tr>
<td>5-37</td>
<td>Enhanced 8-column x32 Advanced Package Bump Map Example for 32 GT/s Implementation</td>
<td>227</td>
</tr>
<tr>
<td>5-38</td>
<td>Example of Normal and Mirrored x64-to-x32 Advanced Package Module Connection</td>
<td>230</td>
</tr>
<tr>
<td>5-39</td>
<td>Example of Normal and Mirrored x32-to-x32 Advanced Package Module Connection</td>
<td>231</td>
</tr>
<tr>
<td>$5 - 4 0$</td>
<td>Naming Convention for One-, Two-, and Four-module Advanced Package Paired with "Standard Die Rotate" Configurations</td>
<td>232</td>
</tr>
<tr>
<td>5-41</td>
<td>Naming Convention for One-, Two-, and Four-module Advanced Package Paired with "Mirrored Die Rotate" Configurations</td>
<td>232</td>
</tr>
<tr>
<td>$5 - 4 2$</td>
<td>Examples for Advanced Package Configurations Paired with "Standard Die Rotate" Counterparts, with a Different Number of Modules</td>
<td>233</td>
</tr>
<tr>
<td>$5 - 4 3$</td>
<td>Examples for Advanced Package Configurations Paired with "Mirrored Die Rotate" Counterparts, with a Different Number of Modules</td>
<td>234</td>
</tr>
<tr>
<td>5-44</td>
<td>Standard Package Bump Map: x16 interface</td>
<td>237</td>
</tr>
<tr>
<td>5-45</td>
<td>Standard Package x16 interface: Signal exit order</td>
<td>237</td>
</tr>
<tr>
<td>5-46</td>
<td>Standard Package Bump Map: x32 interface</td>
<td>237</td>
</tr>
<tr>
<td>5-49</td>
<td>Standard Package reference configuration</td>
<td>238</td>
</tr>
<tr>
<td>5-47</td>
<td>Standard Package x32 interface: Signal exit routing</td>
<td>238</td>
</tr>
<tr>
<td>5-48</td>
<td>Standard Package cross section for stacked module</td>
<td>238</td>
</tr>
<tr>
<td>5-50</td>
<td>Standard Package Bump Map: 48 GT/s and 64 GT/s x32 Interface</td>
<td>239</td>
</tr>
<tr>
<td>5-51</td>
<td>x16 Standard Package Potential Bump Map: 48 GT/s and 64 GT/s x16</td>
<td>240</td>
</tr>
<tr>
<td>5-52</td>
<td>Standard Package Bump Map: x8 Interface</td>
<td>241</td>
</tr>
<tr>
<td>5-53</td>
<td>Naming Convention for One-, Two-, and Four-module Standard Package Paired with "Standard Die Rotate" Configurations</td>
<td>242</td>
</tr>
<tr>
<td>$5 - 5 4$</td>
<td>Naming Convention for One-, Two-, and Four-module Standard Package Paired with "Mirrored Die Rotate" Configurations</td>
<td>242</td>
</tr>
<tr>
<td>5-55</td>
<td>Examples for Standard Package Configurations Paired with "Standard Die Rotate" Counterparts, with a Different Number of Modules</td>
<td>244</td>
</tr>
<tr>
<td>5-56</td>
<td>Examples for Standard Package Configurations Paired with "Mirrored Die Rotate" Counterparts, with a Different Number of Modules</td>
<td>245</td>
</tr>
<tr>
<td>5-57</td>
<td>Additional Examples for Standard Package Configurations Paired with "Mirrored Die Rotate" Counterparts, with a Different Number of Modules</td>
<td>245</td>
</tr>
<tr>
<td>5-58</td>
<td>Example of a Configuration for Standard Package, with Some Modules Disabled</td>
<td>247</td>
</tr>
<tr>
<td>5-59</td>
<td>UCIe-S Sideband-only Port Bump Map</td>
<td>248</td>
</tr>
<tr>
<td>5-60</td>
<td>UCIe-S Sideband-only Port Supported Configurations</td>
<td>248</td>
</tr>
<tr>
<td>5-61</td>
<td>Data Lane repair resources</td>
<td>250</td>
</tr>
<tr>
<td>5-62</td>
<td>Data Lane repair</td>
<td>250</td>
</tr>
<tr>
<td>5-63</td>
<td>Valid Framing</td>
<td>251</td>
</tr>
<tr>
<td>5-64</td>
<td>Data, Clock, Valid Levels for Half-rate Clocking: Clock-gated Unterminated Link</td>
<td>251</td>
</tr>
<tr>
<td>5-65</td>
<td>Data, Clock, Valid Levels for Quarter-rate Clocking: Clock-gated Unterminated Link</td>
<td>252</td>
</tr>
<tr>
<td>$5 - 6 6$</td>
<td>Data, Clock, Valid Levels for Half-rate Clocking: Continuous Clock Unterminated Link</td>
<td>252</td>
</tr>
<tr>
<td>$5 - 6 7$</td>
<td>Data, Clock, Valid Gated Levels for Half-rate Clocking: Terminated Link</td>
<td>252</td>
</tr>
<tr>
<td>5-68</td>
<td>Data, Clock, Valid Gated Levels for Quarter-rate Clocking: Terminated Link</td>
<td>253</td>
</tr>
<tr>
<td>$5 - 6 9$</td>
<td>Data, Clock, Valid Gated Levels for Half-rate Clocking: Continuous Clock Terminated Link</td>
<td>253</td>
</tr>
<tr>
<td>5-70</td>
<td>Sideband signaling</td>
<td>254</td>
</tr>
<tr>
<td>5-71</td>
<td>Example Package Route for Open Drain Signal</td>
<td>256</td>
</tr>
<tr>
<td>5-72</td>
<td>Example Bridging between Internal and External Event Pin</td>
<td>257</td>
</tr>
</table>

6-1

6-2

6-3

6-4

6-5

6-6

6-7

6-8

7-1

7-2

7-3

7-4

7-5

7-6

7-7

7-8

7-9

7-10

7-11

7-12

7-13

7-14

7-15

8-1

8-2

8-3

8-4

8-5

8-6

8-7

8-8

8-9

8-10

8-11

8-12

8-13

8-14

8-15

8-16

8-17

8-18

8-19

8-20

8-21

8-22

8-23

8-24

8-25

8-26

8-27

8-28

<table>
<tr>
<th></th>
<th>Figures</th>
</tr>
<tr>
<td>Example of 3D Die Stacking</td>
<td>258</td>
</tr>
<tr>
<td>UCIe-3D Illustration</td>
<td>259</td>
</tr>
<tr>
<td>UCIe-3D PHY</td>
<td>260</td>
</tr>
<tr>
<td>Start Edge and Sample Edge</td>
<td>261</td>
</tr>
<tr>
<td>Dtx and Drx Spec Range for 4 GT/s</td>
<td>263</td>
</tr>
<tr>
<td>UCIe-3D Module Bump Map</td>
<td>264</td>
</tr>
<tr>
<td>x70 Module</td>
<td>265</td>
</tr>
<tr>
<td>Bundle Repair</td>
<td>266</td>
</tr>
<tr>
<td>Format for Register Access Request</td>
<td>273</td>
</tr>
<tr>
<td>Format for Register Access Completions</td>
<td>274</td>
</tr>
<tr>
<td>Format for Messages without Data</td>
<td>275</td>
</tr>
<tr>
<td>Format for Messages with data payloads</td>
<td>283</td>
</tr>
<tr>
<td>Common Fields in MPM Header of all MPM with Data Messages on Sideband</td>
<td>291</td>
</tr>
<tr>
<td>Encapsulated MTP on Sideband</td>
<td>292</td>
</tr>
<tr>
<td>Vendor-defined Management Port Gateway Message with Data on Sideband</td>
<td>293</td>
</tr>
<tr>
<td>Common Fields in MPM Header of all MPM without Data Messages on Sideband</td>
<td>294</td>
</tr>
<tr>
<td>Management Port Gateway Capabilities MPM on Sideband</td>
<td>294</td>
</tr>
<tr>
<td>Credit Return MPM on Sideband</td>
<td>295</td>
</tr>
<tr>
<td>Init Done MPM on Sideband</td>
<td>296</td>
</tr>
<tr>
<td>PM MPM on Sideband</td>
<td>296</td>
</tr>
<tr>
<td>Vendor-defined Management Port Gateway MPM without Data on Sideband</td>
<td>297</td>
</tr>
<tr>
<td>Format for Priority Sideband Traffic Packets</td>
<td>297</td>
</tr>
<tr>
<td>Example Flow for Remote Register Access Request (Local FDI/RDI Credit Checks Are Not Explicitly Shown)</td>
<td>300</td>
</tr>
<tr>
<td>Example UCIe Chiplet that Supports Manageability</td>
<td>304</td>
</tr>
<tr>
<td>Example SiP that Supports Manageability</td>
<td>305</td>
</tr>
<tr>
<td>UCIe Manageability Protocol Hierarchy</td>
<td>306</td>
</tr>
<tr>
<td>Relationship Between the Various Types of Management Entities</td>
<td>307</td>
</tr>
<tr>
<td>UCIe Management Transport Packet</td>
<td>308</td>
</tr>
<tr>
<td>Management Network ID Format</td>
<td>312</td>
</tr>
<tr>
<td>Access Control Determination in a Responder Management Entity</td>
<td>318</td>
</tr>
<tr>
<td>Memory Map for Management Entities</td>
<td>321</td>
</tr>
<tr>
<td>Management Capability Structure Organization</td>
<td>322</td>
</tr>
<tr>
<td>Vendor Defined Management Capability Structure Organization</td>
<td>323</td>
</tr>
<tr>
<td>Management Capability Directory</td>
<td>323</td>
</tr>
<tr>
<td>Capability Pointer</td>
<td>324</td>
</tr>
<tr>
<td>Chiplet Capability Structure Organization</td>
<td>325</td>
</tr>
<tr>
<td>Chiplet Capability Structure</td>
<td>325</td>
</tr>
<tr>
<td>Management Port Structure</td>
<td>328</td>
</tr>
<tr>
<td>Route Entry</td>
<td>333</td>
</tr>
<tr>
<td>Access Control Capability Structure</td>
<td>335</td>
</tr>
<tr>
<td>Standard Asset Class Access Table</td>
<td>337</td>
</tr>
<tr>
<td>Vendor Defined Asset Class Access Table</td>
<td>337</td>
</tr>
<tr>
<td>Security Clearance Group Capability Structure</td>
<td>340</td>
</tr>
<tr>
<td>Security Clearance Group Context</td>
<td>341</td>
</tr>
<tr>
<td>UCIe Memory Access Request Packet Format</td>
<td>342</td>
</tr>
<tr>
<td>UCIe Memory Access Response Packet</td>
<td>346</td>
</tr>
<tr>
<td>UCIe Memory Access Protocol Capability Structure</td>
<td>347</td>
</tr>
<tr>
<td>Empty Circular Buffer</td>
<td>349</td>
</tr>
<tr>
<td>Full Circular Buffer with Write Offset below Read Offset</td>
<td>350</td>
</tr>
<tr>
<td>Full Circular Buffer with Write Offset above Read Offset</td>
<td>350</td>
</tr>
<tr>
<td>Circular Buffer State Machine</td>
<td>351</td>
</tr>
</table>

<table>
<tr>
<td>8-29</td>
<td>Sink Circular Buffer, UMAP Requester Write to and Management Entity Read from</td>
<td>356</td>
</tr>
<tr>
<td>8-30</td>
<td>Source Circular Buffer, UMAP Requester Read from and Management Entity Write to</td>
<td>358</td>
</tr>
<tr>
<td>8-31</td>
<td>Open Drain Detection Capability Structure</td>
<td>360</td>
</tr>
<tr>
<td>8-32</td>
<td>Valid Sample Count Example</td>
<td>361</td>
</tr>
<tr>
<td>8-33</td>
<td>UCIe Sideband Management Path Architecture</td>
<td>362</td>
</tr>
<tr>
<td>8-34</td>
<td>UCIe Mainband Management Path Architecture</td>
<td>363</td>
</tr>
<tr>
<td>8-35</td>
<td>Supported Configurations for Management Port Gateway Connectivity to D2D Adapter on Mainband</td>
<td>365</td>
</tr>
<tr>
<td>8-36</td>
<td>Common Fields in MPM Header of all MPM with Data Messages on Mainband</td>
<td>366</td>
</tr>
<tr>
<td>8-37</td>
<td>Encapsulated MTP on Mainband</td>
<td>367</td>
</tr>
<tr>
<td>8-38</td>
<td>Vendor-defined Management Port Gateway Message with Data on Mainband</td>
<td>368</td>
</tr>
<tr>
<td>8-39</td>
<td>Common Fields in MPM Header of all MPM without Data Messages on Mainband</td>
<td>369</td>
</tr>
<tr>
<td>8-40</td>
<td>Management Port Gateway Capabilities MPM on Mainband</td>
<td>369</td>
</tr>
<tr>
<td>8-41</td>
<td>Init Done MPM on Mainband</td>
<td>370</td>
</tr>
<tr>
<td>8-42</td>
<td>Vendor-defined Management Port Gateway Message without Data on Mainband</td>
<td>370</td>
</tr>
<tr>
<td>8-43</td>
<td>Sideband Management Transport Initialization Phase Example with RxQ-ID=0 and One VC (VC0)</td>
<td>373</td>
</tr>
<tr>
<td>8-44</td>
<td>Sideband Management Transport Initialization Phase Example with RxQ-ID=0, 1 and One VC (VC0)</td>
<td>373</td>
</tr>
<tr>
<td>$8 - 4 5$</td>
<td>Sideband Management Transport Initialization Phase Example with RxQ-ID=0 and Two VCs (VC0, VC1)</td>
<td>374</td>
</tr>
<tr>
<td>$8 - 4 6$</td>
<td>Mainband Management Transport Initialization Phase Example with $R x Q - I D = 0$ and One VC (VC0)</td>
<td>376</td>
</tr>
<tr>
<td>8-47</td>
<td>Mainband Management Transport Initialization Phase Example with RxQ-ID=0, 1 and One VC (VC0)</td>
<td>377</td>
</tr>
<tr>
<td>8-48</td>
<td>Mainband Management Transport Initialization Phase Example with RxQ-ID=0 and Two VCs (VC0, VC1)</td>
<td>377</td>
</tr>
<tr>
<td>8-49</td>
<td>Example Illustration of a Large MTP Transmitted over Multiple RxQ-IDs on Sideband with Segmentation</td>
<td>380</td>
</tr>
<tr>
<td>8-50</td>
<td>Conceptual Illustration of Sideband Multi-module Ordering with Three RxQs</td>
<td>382</td>
</tr>
<tr>
<td>8-51</td>
<td>Example Illustration of a Large MTP Split into Multiple Smaller Encapsulated-MTPs for Transport over Sideband, without Segmentation</td>
<td>384</td>
</tr>
<tr>
<td>8-52</td>
<td>Management Flit NOP Message on Mainband</td>
<td>386</td>
</tr>
<tr>
<td>8-53</td>
<td>Management Transport Credit Return DWORD (CRD) Format on Mainband</td>
<td>386</td>
</tr>
<tr>
<td>8-54</td>
<td>Valid MPM Header Start Locations for Various Flit Formats</td>
<td>388</td>
</tr>
<tr>
<td>8-55</td>
<td>Example Mapping of MPMs and NOPs in Flit of Format 3</td>
<td>389</td>
</tr>
<tr>
<td>8-56</td>
<td>Example Mapping of MPMs and NOPs in Flit of Format 5</td>
<td>389</td>
</tr>
<tr>
<td>8-57</td>
<td>Example MPM Mapping to Management Flit for Format 3 with MPM Rollover to Next Flit</td>
<td>390</td>
</tr>
<tr>
<td>8-58</td>
<td>UDA Overview in Each Chiplet - Illustration</td>
<td>392</td>
</tr>
<tr>
<td>8-59</td>
<td>Vendor-defined Test and Debug UDM</td>
<td>394</td>
</tr>
<tr>
<td>8-60</td>
<td>UCIe-based Chiplet Testing/Debugging at Sort</td>
<td>395</td>
</tr>
<tr>
<td>8-61</td>
<td>UCIe-based Testing of Chiplets in an SiP</td>
<td>396</td>
</tr>
<tr>
<td>8-62</td>
<td>UCIe-based System Testing/Debug</td>
<td>397</td>
</tr>
<tr>
<td>8-63</td>
<td>DMH/DMS Address Mapping</td>
<td>398</td>
</tr>
<tr>
<td>8-64</td>
<td>DMH Capability Register Map</td>
<td>399</td>
</tr>
<tr>
<td>8-65</td>
<td>Empty Spoke Register Map</td>
<td>402</td>
</tr>
<tr>
<td>8-66</td>
<td>Common DMS Registers for All Non-empty Spokes Register Map</td>
<td>403</td>
</tr>
<tr>
<td>8-67</td>
<td>DMS Register Map for UCIe Spoke Types</td>
<td>407</td>
</tr>
<tr>
<td>8-68</td>
<td>DMS Register Map for Vendor-defined Spoke Types</td>
<td>411</td>
</tr>
<tr>
<td>8-69</td>
<td>Early Firmware Download Capability Structure</td>
<td>413</td>
</tr>
<tr>
<td>8-70</td>
<td>Early Firmware Download State Machine</td>
<td>415</td>
</tr>
<tr>
<td>8-71</td>
<td>Example Use of Fast Throttle</td>
<td>419</td>
</tr>
<tr>
<td>8-72</td>
<td>Overview of the Fast Throttle Data Structures</td>
<td>421</td>
</tr>
</table>

<table>
<tr>
<td>8-73</td>
<td>Fast Throttle Trigger Capability Structure</td>
<td>421</td>
</tr>
<tr>
<td>8-74</td>
<td>Fast Throttle Trigger Capability Format</td>
<td>422</td>
</tr>
<tr>
<td>8-75</td>
<td>Fast Throttle Response Capability Structure</td>
<td>424</td>
</tr>
<tr>
<td>8-76</td>
<td>Fast Throttle Response State Format</td>
<td>424</td>
</tr>
<tr>
<td>8-77</td>
<td>Fast Throttle Logging Capability Structure</td>
<td>426</td>
</tr>
<tr>
<td>8-78</td>
<td>Fast Throttle Logging Capability Format</td>
<td>426</td>
</tr>
<tr>
<td>8-79</td>
<td>Fast Throttle Trigger Control Structure</td>
<td>429</td>
</tr>
<tr>
<td>8-80</td>
<td>Fast Throttle Trigger Control Format</td>
<td>429</td>
</tr>
<tr>
<td>8-81</td>
<td>Fast Throttle Trigger Assertion and De-assertion</td>
<td>431</td>
</tr>
<tr>
<td>8-82</td>
<td>Chiplet Fast Throttle Assertion and De-assertion Timing</td>
<td>432</td>
</tr>
<tr>
<td>8-83</td>
<td>Fast Throttle Response Control Structure</td>
<td>432</td>
</tr>
<tr>
<td>8-84</td>
<td>Fast Throttle Logging Control Structure</td>
<td>433</td>
</tr>
<tr>
<td>8-85</td>
<td>Fast Throttle Logging Control Format</td>
<td>433</td>
</tr>
<tr>
<td>8-86</td>
<td>Fast Throttle Logging Structure</td>
<td>435</td>
</tr>
<tr>
<td>8-87</td>
<td>Fast Throttle Address Map</td>
<td>436</td>
</tr>
<tr>
<td>8-88</td>
<td>Example Use of Emergency Shutdown</td>
<td>437</td>
</tr>
<tr>
<td>8-89</td>
<td>Overview of Emergency Shutdown Data Structures</td>
<td>439</td>
</tr>
<tr>
<td>8-90</td>
<td>Emergency Shutdown Trigger Capability Structure</td>
<td>440</td>
</tr>
<tr>
<td>8-91</td>
<td>Emergency Shutdown Trigger Capability Format</td>
<td>440</td>
</tr>
<tr>
<td>8-92</td>
<td>Emergency Shutdown Response Capability Structure</td>
<td>442</td>
</tr>
<tr>
<td>8-93</td>
<td>Emergency Shutdown Response State Format</td>
<td>443</td>
</tr>
<tr>
<td>8-94</td>
<td>Emergency Shutdown Logging Capability Structure</td>
<td>445</td>
</tr>
<tr>
<td>8-95</td>
<td>Emergency Shutdown Logging Capability Format</td>
<td>445</td>
</tr>
<tr>
<td>8-96</td>
<td>Emergency Shutdown Trigger Control Structure</td>
<td>448</td>
</tr>
<tr>
<td>8-97</td>
<td>Emergency Shutdown Trigger Control Format</td>
<td>448</td>
</tr>
<tr>
<td>8-98</td>
<td>Emergency Shutdown Assertion</td>
<td>450</td>
</tr>
<tr>
<td>8-99</td>
<td>Emergency Shutdown Timing Diagram</td>
<td>450</td>
</tr>
<tr>
<td>8-100</td>
<td>Emergency Shutdown Response Control Structure</td>
<td>451</td>
</tr>
<tr>
<td>8-101</td>
<td>Emergency Shutdown Logging Control Structure</td>
<td>452</td>
</tr>
<tr>
<td>8-102</td>
<td>Emergency Shutdown Logging Control Format</td>
<td>452</td>
</tr>
<tr>
<td>8-103</td>
<td>Emergency Shutdown Logging Structure</td>
<td>453</td>
</tr>
<tr>
<td>8-104</td>
<td>Emergency Shutdown Address Map</td>
<td>455</td>
</tr>
<tr>
<td>9-1</td>
<td>Software view Example with Root Ports and Endpoints</td>
<td>459</td>
</tr>
<tr>
<td>9-2</td>
<td>Software view Example with Switch and Endpoints</td>
<td>460</td>
</tr>
<tr>
<td>9-3</td>
<td>Software view Example of UCIe Endpoint</td>
<td>461</td>
</tr>
<tr>
<td>9-4</td>
<td>UCIe Link DVSEC</td>
<td>463</td>
</tr>
<tr>
<td>9-5</td>
<td>UCIe Link Health Monitor (UHM) DVSEC</td>
<td>505</td>
</tr>
<tr>
<td>9-6</td>
<td>UCIe Test/Compliance Register Block</td>
<td>507</td>
</tr>
<tr>
<td>10-1</td>
<td>Example configurations using RDI</td>
<td>522</td>
</tr>
<tr>
<td>10-2</td>
<td>Example Waveform Showing Handling of Level Transition</td>
<td>531</td>
</tr>
<tr>
<td>10-3</td>
<td>Data Transfer from Adapter to Physical Layer</td>
<td>532</td>
</tr>
<tr>
<td>10-4</td>
<td>$I p \_ i r d y \quad a s s e r t i n g$ two cycles before Ip_valid</td>
<td>533</td>
</tr>
<tr>
<td>10-5</td>
<td>lp_irdy asserting at the same cycle as lp_valid</td>
<td>533</td>
</tr>
<tr>
<td>10-6</td>
<td>RDI State Machine</td>
<td>533</td>
</tr>
<tr>
<td>10-7</td>
<td>Example flow of Link bring up on RDI</td>
<td>534</td>
</tr>
<tr>
<td>10-8</td>
<td>Successful PM entry flow</td>
<td>537</td>
</tr>
<tr>
<td>10-9</td>
<td>PM Abort flow</td>
<td>537</td>
</tr>
<tr>
<td>10-10</td>
<td>PM Exit flow</td>
<td>538</td>
</tr>
<tr>
<td>10-11</td>
<td>RDI PM Exit Example Showing Interactions with LTSM</td>
<td>538</td>
</tr>
<tr>
<td>10-12</td>
<td>Example configurations using FDI</td>
<td>539</td>
</tr>
<tr>
<td>10-13</td>
<td>Example Waveform Showing Handling of Level Transition</td>
<td>549</td>
</tr>
<tr>
<td>10-14</td>
<td>Data Transfer from Protocol Layer to Adapter</td>
<td>550</td>
</tr>
<tr>
<td>10-15</td>
<td>Example for pl_flit_cancel for Latency-Optimized Flits</td>
<td></td>
</tr>
<tr>
<td></td>
<td>and CRC Error on First Flit Half</td>
<td>551</td>
</tr>
</table>

<table>
<tr>
<td>10-16</td>
<td>Example for pl_flit_cancel for Latency-Optimized Flits and CRC Error on Second Flit Half</td>
<td>551</td>
</tr>
<tr>
<td>10-17</td>
<td>Example for pl_flit_cancel for Latency-Optimized Flits and CRC Error on Second Flit Half, Alternate Implementation Example</td>
<td>551</td>
</tr>
<tr>
<td>10-18</td>
<td>Example for pl_flit_cancel for Standard 256B Flits</td>
<td>552</td>
</tr>
<tr>
<td>10-19</td>
<td>FDI State Machine</td>
<td>552</td>
</tr>
<tr>
<td>10-20</td>
<td>FDI Bring up flow</td>
<td>554</td>
</tr>
<tr>
<td>10-21</td>
<td>PM Entry example for CXL or PCIe protocols</td>
<td>557</td>
</tr>
<tr>
<td>10-22</td>
<td>PM Entry example for symmetric protocol</td>
<td>557</td>
</tr>
<tr>
<td>10-23</td>
<td>PM Abort Example</td>
<td>558</td>
</tr>
<tr>
<td>10-24</td>
<td>PM Exit Example</td>
<td>558</td>
</tr>
<tr>
<td>10-25</td>
<td>CXL.io Standard 256B Start Header Flit Format Example</td>
<td>559</td>
</tr>
<tr>
<td>10-26</td>
<td>FDI (or RDI) Byte Mapping for 64B Datapath to 256B Flits</td>
<td>560</td>
</tr>
<tr>
<td>10-27</td>
<td>FDI (or RDI) Byte Mapping for 128B Datapath to 256B Flits</td>
<td>560</td>
</tr>
<tr>
<td>10-28</td>
<td>FDI Byte Mapping for 128B Datapath for 68B Flit Format</td>
<td>560</td>
</tr>
<tr>
<td>10-29</td>
<td>RDI Byte Mapping for 128B Datapath for 68B Flit Format</td>
<td>561</td>
</tr>
<tr>
<td>10-30</td>
<td>Example of Byte Transfer on the Rx for One Lane of a Module</td>
<td>574</td>
</tr>
<tr>
<td>10-31</td>
<td>LinkReset Example</td>
<td>575</td>
</tr>
<tr>
<td>10-32</td>
<td>LinkError example</td>
<td>576</td>
</tr>
<tr>
<td>10-33</td>
<td>Example of L2 Cross Product with Retrain on RDI</td>
<td>577</td>
</tr>
<tr>
<td>10-34</td>
<td>L2 Exit Example for RDI</td>
<td>578</td>
</tr>
<tr>
<td>11-1</td>
<td>Examples of Standard and Advanced Package setups for DUT and Golden Die Compliance Testing</td>
<td>580</td>
</tr>
<tr>
<td>B-1</td>
<td>AIB interoperability</td>
<td>585</td>
</tr>
</table>

#### Tables

<table>
<tr>
<td>1</td>
<td>Terms and Definitions</td>
<td>28</td>
</tr>
<tr>
<td>2</td>
<td>Unit of Measure Symbols</td>
<td>36</td>
</tr>
<tr>
<td>3</td>
<td>Reference Documents</td>
<td>37</td>
</tr>
<tr>
<td>4</td>
<td>Revision History</td>
<td>37</td>
</tr>
<tr>
<td>1-1</td>
<td>Characteristics of UCIe on Standard Package</td>
<td>40</td>
</tr>
<tr>
<td>1-2</td>
<td>Characteristics of UCIe on Advanced Package</td>
<td>40</td>
</tr>
<tr>
<td>1-3</td>
<td>Characteristics of UCIe-3D</td>
<td>41</td>
</tr>
<tr>
<td>1-4</td>
<td>UCIe 2D and 2.5D Key Performance Targets</td>
<td>49</td>
</tr>
<tr>
<td>1-5</td>
<td>UCIe-3D Key Performance Targets</td>
<td>49</td>
</tr>
<tr>
<td>1-6</td>
<td>Groups for Different Advanced Package Bump Pitches</td>
<td>50</td>
</tr>
<tr>
<td>2-1</td>
<td>Specification to Protocol Mode Requirements</td>
<td>52</td>
</tr>
<tr>
<td>3-1</td>
<td>Capabilities that Must Be Negotiated between Link Partners</td>
<td>63</td>
</tr>
<tr>
<td>3-2</td>
<td>Flit Header for Format 2 without Retry</td>
<td>72</td>
</tr>
<tr>
<td>3-3</td>
<td>Flit Header for Format 2 with Retry</td>
<td>72</td>
</tr>
<tr>
<td>3-4</td>
<td>Flit Header for Format 3, Format 4, Format 5, and Format 6 without Retry</td>
<td>79</td>
</tr>
<tr>
<td>3-5</td>
<td>Flit Header for Format 3, Format 4, Format 5, and Format 6 with Retry</td>
<td>80</td>
</tr>
<tr>
<td>3-6</td>
<td>Summary of Flit Formats</td>
<td>84</td>
</tr>
<tr>
<td>3-7</td>
<td>Protocol Mapping and Implementation Requirements</td>
<td>85</td>
</tr>
<tr>
<td>3-8</td>
<td>Truth Table for Determining Protocol</td>
<td>86</td>
</tr>
<tr>
<td>3-9</td>
<td>Truth Table 1</td>
<td>88</td>
</tr>
<tr>
<td>3-10</td>
<td>Truth Table 2</td>
<td>88</td>
</tr>
<tr>
<td>4-1</td>
<td>Valid framing for Retimers</td>
<td>101</td>
</tr>
<tr>
<td>4-2</td>
<td>Lane ID: Advanced Package module</td>
<td>105</td>
</tr>
<tr>
<td>4-3</td>
<td>Lane ID: Standard Package Module</td>
<td>106</td>
</tr>
<tr>
<td>4-4</td>
<td>LFSR seed values</td>
<td>121</td>
</tr>
<tr>
<td>4-5</td>
<td>Data-to-Clock Training Parameters</td>
<td>126</td>
</tr>
<tr>
<td>4-6</td>
<td>State Definitions for Initialization</td>
<td>131</td>
</tr>
<tr>
<td>4-7</td>
<td>Per Lane ID Pattern</td>
<td>151</td>
</tr>
<tr>
<td>4-8</td>
<td>Per Lane ID Pattern Examples</td>
<td>152</td>
</tr>
<tr>
<td>4-9</td>
<td>Standard Package Logical Lane Map</td>
<td>155</td>
</tr>
<tr>
<td>4-10</td>
<td>Runtime Link Test Status Register based Retrain encoding</td>
<td>169</td>
</tr>
<tr>
<td>4-11</td>
<td>Retrain encoding</td>
<td>169</td>
</tr>
<tr>
<td>4-12</td>
<td>Retrain exit state resolution</td>
<td>169</td>
</tr>
<tr>
<td>4-13</td>
<td>Messages exchanged that are used to determine resolution for Example 1</td>
<td>179</td>
</tr>
<tr>
<td>4-14</td>
<td>Messages exchanged that are used to determine resolution for Example 2</td>
<td>180</td>
</tr>
<tr>
<td>4-15</td>
<td>Messages exchanged that are used to determine resolution for Example 3</td>
<td>180</td>
</tr>
<tr>
<td rowspan="2">4-16</td>
<td>Capability Register and Link Training Parameter Values</td>
<td></td>
</tr>
<tr>
<td>for RDI Byte-to-Module Assignment Example for x64 Interop with x32</td>
<td>182</td>
</tr>
<tr>
<td>5-1</td>
<td>REFCLK Frequency PPMs and SSC PPMs</td>
<td>185</td>
</tr>
<tr>
<td>5-2</td>
<td>Electrical Summary for 4 GT/s to 32 GT/s</td>
<td>188</td>
</tr>
<tr>
<td>5-3</td>
<td>Electrical Summary for 48 GT/s and 64 GT/s</td>
<td>189</td>
</tr>
<tr>
<td>5-4</td>
<td>Operating Data Rate Ranges for UCIe Link Speed Settings</td>
<td>190</td>
</tr>
<tr>
<td>5-5</td>
<td>Transmitter Electrical Parameters</td>
<td>191</td>
</tr>
<tr>
<td>5-6</td>
<td>Transmitter de-emphasis values</td>
<td>194</td>
</tr>
<tr>
<td>5-7</td>
<td>48 GT/s and 64 GT/s Tx Equalization Coefficient Presets</td>
<td>194</td>
</tr>
<tr>
<td>5-8</td>
<td>Receiver Electrical Parameters for &lt;= 32 GT/s</td>
<td>196</td>
</tr>
<tr>
<td>5-9</td>
<td>Receiver Electrical Parameters for 48 GT/s and 64 GT/s</td>
<td>197</td>
</tr>
<tr>
<td>5-10</td>
<td>Maximum channel reach for unterminated Receiver (Tx = 0.4 V)</td>
<td>197</td>
</tr>
<tr>
<td>5-11</td>
<td>Maximum Channel reach for unterminated Receiver $\left( T X \quad s w i n g = 0 . 8 5 V \right)$</td>
<td>199</td>
</tr>
</table>

<table>
<tr>
<th colspan="2"></th>
<th>Tables</th>
</tr>
<tr>
<td>5-12</td>
<td>Forwarded Clock Frequency and Phase</td>
<td>203</td>
</tr>
<tr>
<td>5-13</td>
<td>I/Q Correction for 48 GT/s and 64 GT/s</td>
<td>203</td>
</tr>
<tr>
<td>5-14</td>
<td>I/O Noise and Clock Skew</td>
<td>205</td>
</tr>
<tr>
<td>5-15</td>
<td>Rectangular Eye Mask Requirements for &lt;= 32 GT/s</td>
<td>206</td>
</tr>
<tr>
<td>5-16</td>
<td>Channel Matching Tolerance of Tx or Rx within a Module</td>
<td>208</td>
</tr>
<tr>
<td>5-17</td>
<td>Channel Characteristics</td>
<td>209</td>
</tr>
<tr>
<td>5-18</td>
<td>x64 Advanced Package Module Signal List</td>
<td>209</td>
</tr>
<tr>
<td>5-19</td>
<td>Bump Map Options and the Recommended Bump Pitch Range and Corresponding Max Speed</td>
<td>215</td>
</tr>
<tr>
<td>5-20</td>
<td>Maximum Systematic Lane-to-lane Length Mismatch in um between the Reference Bump Maps in the Implementation Note</td>
<td>224</td>
</tr>
<tr>
<td>5-21</td>
<td>x64 and x32 Advanced Package Connectivity Matrix</td>
<td>229</td>
</tr>
<tr>
<td>5-22</td>
<td>Summary of Advanced Package Module Connection Combinations with Same Number of Modules on Both Sides</td>
<td>233</td>
</tr>
<tr>
<td>5-23</td>
<td>Summary of Advanced Package Module Connection Combinations with Different Number of Modules on Both Sides</td>
<td>234</td>
</tr>
<tr>
<td>5-24</td>
<td>IL and Crosstalk for Standard Package: With Receiver Termination Enabled</td>
<td>235</td>
</tr>
<tr>
<td>5-25</td>
<td>IL and Crosstalk for Standard Package: No Rx Termination</td>
<td>235</td>
</tr>
<tr>
<td>5-26</td>
<td>Standard Package Module Signal List</td>
<td>235</td>
</tr>
<tr>
<td>5-27</td>
<td>Summary of Standard Package Module Connection Combinations with Same Number of Modules on Both Sides</td>
<td>243</td>
</tr>
<tr>
<td>$5 - 2 8$</td>
<td>Summary of Standard Package Module Connection Combinations with Different Number of Modules on Both Sides</td>
<td>246</td>
</tr>
<tr>
<td>5-29</td>
<td>Summary of Degraded Links when Standard Package Module-pairs Fail</td>
<td>247</td>
</tr>
<tr>
<td>5-30</td>
<td>Tightly Coupled Mode: Eye Mask</td>
<td>249</td>
</tr>
<tr>
<td>5-31</td>
<td>Tightly Coupled Mode Channel for Advanced Package</td>
<td>249</td>
</tr>
<tr>
<td>5-32</td>
<td>Raw BER Requirements</td>
<td>251</td>
</tr>
<tr>
<td>5-33</td>
<td>Sideband Parameters summary</td>
<td>254</td>
</tr>
<tr>
<td>5-34</td>
<td>AUXCLK Frequency Parameters</td>
<td>255</td>
</tr>
<tr>
<td>5-35</td>
<td>Open Drain Specification Summary</td>
<td>256</td>
</tr>
<tr>
<td>6-1</td>
<td>UCIe-3D Key Performance Indicators</td>
<td>259</td>
</tr>
<tr>
<td>6-2</td>
<td>Timing and Mismatch Specification</td>
<td>261</td>
</tr>
<tr>
<td>6-3</td>
<td>ESD Specification for ≤ 10 um Bump Pitch</td>
<td>264</td>
</tr>
<tr>
<td>6-4</td>
<td>Energy Efficiency Target.</td>
<td>264</td>
</tr>
<tr>
<td>7-1</td>
<td>Sideband Packet Opcode Encodings Mapped to Sideband Packet Types</td>
<td>269</td>
</tr>
<tr>
<td>7-2</td>
<td>FDI sideband: srcid and dstid encodings on FDI</td>
<td>270</td>
</tr>
<tr>
<td>7-3</td>
<td>RDI sideband: srcid and dstid encodings on RDI</td>
<td>270</td>
</tr>
<tr>
<td>7-4</td>
<td>UCIe Link sideband: srcid and dstid encodings for UCIe Link</td>
<td>271</td>
</tr>
<tr>
<td>7-5</td>
<td>Field descriptions for Register Access Requests</td>
<td>272</td>
</tr>
<tr>
<td>7-6</td>
<td>Mapping of Addr[23:0] for Different Requests</td>
<td>273</td>
</tr>
<tr>
<td>7-7</td>
<td>Field Descriptions for a Completion</td>
<td>274</td>
</tr>
<tr>
<td>7-8</td>
<td>Message Encodings for Messages without Data</td>
<td>275</td>
</tr>
<tr>
<td>7-9</td>
<td>Link Training State Machine related Message encodings for messages without data</td>
<td>278</td>
</tr>
<tr>
<td>7-10</td>
<td>Message encodings for Messages with Data</td>
<td>283</td>
</tr>
<tr>
<td>7-11</td>
<td>Link Training State Machine related encodings</td>
<td>285</td>
</tr>
<tr>
<td>7-12</td>
<td>Supported MPM with Data Messages on Sideband</td>
<td>291</td>
</tr>
<tr>
<td>7-13</td>
<td>Common Fields in MPM Header of all MPM with Data Messages on Sideband</td>
<td>291</td>
</tr>
<tr>
<td>7-14</td>
<td>Encapsulated MTP on Sideband Fields</td>
<td>292</td>
</tr>
<tr>
<td>7-15</td>
<td>Vendor-defined Management Port Gateway Message with Data on Sideband Fields</td>
<td>293</td>
</tr>
<tr>
<td>7-16</td>
<td>Supported MPM without Data Messages on Sideband</td>
<td>293</td>
</tr>
<tr>
<td>7-17</td>
<td>Common Fields in MPM Header of all MPM without Data Messages on Sideband</td>
<td>294</td>
</tr>
<tr>
<td>7-18</td>
<td>Management Port Gateway Capabilities MPM Header Fields on Sideband</td>
<td>294</td>
</tr>
<tr>
<td>UCIe Specification</td>
<td>Revision 3.0, Version 1.0</td>
<td>23</td>
</tr>
</table>

<table>
<tr>
<td>7-19</td>
<td>Credit Return MPM Header Fields on Sideband</td>
<td>295</td>
</tr>
<tr>
<td>7-20</td>
<td>Init Done MPM Header Fields on Sideband</td>
<td>296</td>
</tr>
<tr>
<td>7-21</td>
<td>PM MPM Header Fields on Sideband</td>
<td>296</td>
</tr>
<tr>
<td>7-22</td>
<td>MPM Header Vendor-defined Management Port Gateway Message without Data on Sideband</td>
<td>297</td>
</tr>
<tr>
<td>8-1</td>
<td>UCIe Management Transport Packet Fields</td>
<td>308</td>
</tr>
<tr>
<td>8-2</td>
<td>Traffic Class Characteristics</td>
<td>310</td>
</tr>
<tr>
<td>8-3</td>
<td>Management Protocol IDs</td>
<td>312</td>
</tr>
<tr>
<td>8-4</td>
<td>Management Protocol use of Access Control Mechanism</td>
<td>316</td>
</tr>
<tr>
<td>8-5</td>
<td>Asset Types</td>
<td>319</td>
</tr>
<tr>
<td>8-6</td>
<td>Asset Contexts</td>
<td>319</td>
</tr>
<tr>
<td>8-7</td>
<td>Standard Security Asset Classes</td>
<td>319</td>
</tr>
<tr>
<td>8-8</td>
<td>UCIe-defined Management Capability IDs</td>
<td>322</td>
</tr>
<tr>
<td>8-9</td>
<td>Management Capability Directory Fields</td>
<td>324</td>
</tr>
<tr>
<td>8-10</td>
<td>Capability Pointer Fields</td>
<td>324</td>
</tr>
<tr>
<td>8-11</td>
<td>Chiplet Capability Structure Fields</td>
<td>326</td>
</tr>
<tr>
<td>8-12</td>
<td>Management Port Structure Fields</td>
<td>328</td>
</tr>
<tr>
<td>8-13</td>
<td>Route Entry Fields</td>
<td>333</td>
</tr>
<tr>
<td>8-14</td>
<td>Access Control Capability Structure Fields</td>
<td>335</td>
</tr>
<tr>
<td>8-15</td>
<td>Read Access Control (RAC) Structure Field Description</td>
<td>338</td>
</tr>
<tr>
<td>8-16</td>
<td>Write Access Control (WAC) Structure Field Description</td>
<td>339</td>
</tr>
<tr>
<td>8-17</td>
<td>Security Clearance Group Capability Structure Fields</td>
<td>340</td>
</tr>
<tr>
<td>8-18</td>
<td>Security Clearance Group Context Fields</td>
<td>341</td>
</tr>
<tr>
<td>8-19</td>
<td>UCIe Memory Access Request Packet Fields</td>
<td>343</td>
</tr>
<tr>
<td>8-20</td>
<td>UCIe Memory Access Response Packet Fields</td>
<td>346</td>
</tr>
<tr>
<td>8-21</td>
<td>UCIe Memory Access Protocol Capability Structure Fields</td>
<td>347</td>
</tr>
<tr>
<td>8-22</td>
<td>CB_CAPABILITIES Circular Buffer Capabilities</td>
<td>352</td>
</tr>
<tr>
<td>8-23</td>
<td>CB_STATE Field Value and Definitions</td>
<td>353</td>
</tr>
<tr>
<td>8-24</td>
<td>CB_ERROR_BITS - Error Vector</td>
<td>353</td>
</tr>
<tr>
<td>8-25</td>
<td>CB_ERROR Values Definitions</td>
<td>353</td>
</tr>
<tr>
<td>8-26</td>
<td>CB_VENDOR_DEFINED_ERROR_STATUS Value Definitions</td>
<td>354</td>
</tr>
<tr>
<td>8-27</td>
<td>CB_CONTROL - Control Register Bit Definition</td>
<td>355</td>
</tr>
<tr>
<td>8-28</td>
<td>Sink and Source Circular Buffer Structure Fields</td>
<td>355</td>
</tr>
<tr>
<td>8-29</td>
<td>Sink Circular Buffer Structure Fields</td>
<td>357</td>
</tr>
<tr>
<td>8-30</td>
<td>Source Circular Buffer Structure Fields</td>
<td>358</td>
</tr>
<tr>
<td>8-31</td>
<td>Open Drain Detection Capability Structure Fields</td>
<td>360</td>
</tr>
<tr>
<td>8-32</td>
<td>MPM Opcodes on Mainband</td>
<td>366</td>
</tr>
<tr>
<td>8-33</td>
<td>Supported MPM with Data Messages on Mainband</td>
<td>366</td>
</tr>
<tr>
<td>8-34</td>
<td>Common Fields in MPM Header of all MPM with Data Messages on Mainband</td>
<td>366</td>
</tr>
<tr>
<td>8-35</td>
<td>Encapsulated MTP on Mainband Fields</td>
<td>367</td>
</tr>
<tr>
<td>8-36</td>
<td>Vendor-defined Management Port Gateway Message with Data on Mainband Fields</td>
<td>368</td>
</tr>
<tr>
<td>8-37</td>
<td>Supported MPM without Data Messages on Mainband</td>
<td>368</td>
</tr>
<tr>
<td>8-38</td>
<td>Common Fields in MPM Header of all MPM without Data Messages on Mainband</td>
<td>369</td>
</tr>
<tr>
<td>8-39</td>
<td>Management Port Gateway Capabilities MPM Header Fields on Mainband</td>
<td>369</td>
</tr>
<tr>
<td>8-40</td>
<td>Init Done MPM Header Fields on Mainband</td>
<td>370</td>
</tr>
<tr>
<td>8-41</td>
<td>MPM Header Vendor-defined Management Port Gateway Message without Data on Mainband</td>
<td>371</td>
</tr>
<tr>
<td>8-42</td>
<td>Version</td>
<td>399</td>
</tr>
<tr>
<td>8-43</td>
<td>Capability ID, Ver</td>
<td>399</td>
</tr>
<tr>
<td>8-44</td>
<td>Debug Capability</td>
<td>400</td>
</tr>
<tr>
<td>8-45</td>
<td>Debug Control</td>
<td>400</td>
</tr>
<tr>
<td>8-46</td>
<td>Debug Status</td>
<td>400</td>
</tr>
<tr>
<td>8-47</td>
<td>DMH_Length_Low</td>
<td>400</td>
</tr>
</table>

<table>
<tr>
<td>8-48</td>
<td>DMH_Length_High</td>
<td>400</td>
</tr>
<tr>
<td>8-49</td>
<td>DMH Extended Capability Pointer Low</td>
<td>401</td>
</tr>
<tr>
<td>8-50</td>
<td>DMH Extended Capability Pointer High</td>
<td>401</td>
</tr>
<tr>
<td>8-51</td>
<td>DMS_Starting_Low</td>
<td>401</td>
</tr>
<tr>
<td>8-52</td>
<td>DMS_Starting_High</td>
<td>401</td>
</tr>
<tr>
<td>8-53</td>
<td>DMS_Next_Low Address</td>
<td>402</td>
</tr>
<tr>
<td>8-54</td>
<td>DMS_Next_High Address</td>
<td>402</td>
</tr>
<tr>
<td>8-55</td>
<td>Spoke Vendor ID</td>
<td>403</td>
</tr>
<tr>
<td>8-56</td>
<td>Spoke Device ID</td>
<td>403</td>
</tr>
<tr>
<td>8-57</td>
<td>DMS_Next_Low Address</td>
<td>404</td>
</tr>
<tr>
<td>8-58</td>
<td>DMS_Next_High Address</td>
<td>404</td>
</tr>
<tr>
<td>8-59</td>
<td>Spoke Revision ID</td>
<td>404</td>
</tr>
<tr>
<td>8-60</td>
<td>DMS-ID</td>
<td>404</td>
</tr>
<tr>
<td>8-61</td>
<td>Associated DMS-ID[0, 1, 2]</td>
<td>404</td>
</tr>
<tr>
<td>8-62</td>
<td>Spoke Capability</td>
<td>405</td>
</tr>
<tr>
<td>8-63</td>
<td>Spoke Control</td>
<td>405</td>
</tr>
<tr>
<td>8-64</td>
<td>Spoke Status</td>
<td>405</td>
</tr>
<tr>
<td>8-65</td>
<td>DMS Register Space Length Low</td>
<td>406</td>
</tr>
<tr>
<td>8-66</td>
<td>DMS Register Space Length High</td>
<td>406</td>
</tr>
<tr>
<td>8-67</td>
<td>DMS Extended Capability Pointer Low</td>
<td>406</td>
</tr>
<tr>
<td>8-68</td>
<td>DMS Extended Capability Pointer High</td>
<td>406</td>
</tr>
<tr>
<td>8-69</td>
<td>Port ID</td>
<td>408</td>
</tr>
<tr>
<td>8-70</td>
<td>Adapter_Physical_Layer_Ptr_Low</td>
<td>408</td>
</tr>
<tr>
<td>8-71</td>
<td>Adapter_Physical_Layer_Ptr_High</td>
<td>408</td>
</tr>
<tr>
<td>8-72</td>
<td>Compliance_Test_Ptr_Low</td>
<td>409</td>
</tr>
<tr>
<td>8-73</td>
<td>Compliance_Test_Ptr_High</td>
<td>409</td>
</tr>
<tr>
<td>8-74</td>
<td>Impl_Spec_Adapter_Ptr_Low</td>
<td>410</td>
</tr>
<tr>
<td>8-75</td>
<td>Impl_Spec_Adapter_Ptr_High</td>
<td>410</td>
</tr>
<tr>
<td>8-76</td>
<td>Impl_Spec_Physical_Layer_Ptr_Low</td>
<td>410</td>
</tr>
<tr>
<td>8-77</td>
<td>Impl_Spec_Physical_Layer_Ptr_High</td>
<td>410</td>
</tr>
<tr>
<td>8-78</td>
<td>Early Firmware Download Capability Structure Fields</td>
<td>414</td>
</tr>
<tr>
<td>8-79</td>
<td>EFD_STATE Field Values Definition</td>
<td>415</td>
</tr>
<tr>
<td>8-80</td>
<td>EFD_ERROR Field Value Definitions</td>
<td>416</td>
</tr>
<tr>
<td>8-81</td>
<td>EFD_VENDOR_DEFINED_ERROR_STATUS Value Definitions</td>
<td>416</td>
</tr>
<tr>
<td>8-82</td>
<td>EFD_CAPABILITIES Bit Definition</td>
<td>416</td>
</tr>
<tr>
<td>8-83</td>
<td>EFD_CONTROL - Early Firmware Download Capability Control Bit Definition</td>
<td>417</td>
</tr>
<tr>
<td>8-84</td>
<td>Fast Throttle Trigger Capability Structure Fields</td>
<td>422</td>
</tr>
<tr>
<td>8-85</td>
<td>Fast Throttle Trigger Capability Format</td>
<td>423</td>
</tr>
<tr>
<td>8-86</td>
<td>Fast Throttle Trigger Type Encoding</td>
<td>423</td>
</tr>
<tr>
<td>8-87</td>
<td>Fast Throttle Response Capability Structure Fields</td>
<td>424</td>
</tr>
<tr>
<td>8-88</td>
<td>Fast Throttle Response State Format</td>
<td>425</td>
</tr>
<tr>
<td>8-89</td>
<td>Fast Throttle Logging Capability Fields</td>
<td>426</td>
</tr>
<tr>
<td>8-90</td>
<td>Fast Throttle Logging Capability Format</td>
<td>427</td>
</tr>
<tr>
<td>8-91</td>
<td>Fast Throttle Logging Capability Types</td>
<td>428</td>
</tr>
<tr>
<td>8-92</td>
<td>Fast Throttle Trigger Control Fields</td>
<td>430</td>
</tr>
<tr>
<td>8-93</td>
<td>Fast Throttle Trigger Control Format</td>
<td>430</td>
</tr>
<tr>
<td>8-94</td>
<td>Fast Throttle Threshold Encoding ID</td>
<td>431</td>
</tr>
<tr>
<td>8-95</td>
<td>Fast Throttle Response Control Fields</td>
<td>433</td>
</tr>
<tr>
<td>8-96</td>
<td>Fast Throttle Logging Control Fields</td>
<td>434</td>
</tr>
<tr>
<td>8-97</td>
<td>Fast Throttle Logging Control Format</td>
<td>434</td>
</tr>
<tr>
<td>8-98</td>
<td>Fast Throttle Logging Fields</td>
<td>435</td>
</tr>
<tr>
<td>8-99</td>
<td>Emergency Shutdown Trigger Capability Structure Fields</td>
<td>440</td>
</tr>
<tr>
<td>8-100</td>
<td>Emergency Shutdown Trigger Capability Format</td>
<td>441</td>
</tr>
<tr>
<td>8-101</td>
<td>Emergency Shutdown Trigger Type Encoding</td>
<td>442</td>
</tr>
<tr>
<td>8-102</td>
<td>Emergency Shutdown Response Capability Structure Fields</td>
<td>443</td>
</tr>
</table>

<table>
<tr>
<th colspan="2"></th>
<th>Tables</th>
</tr>
<tr>
<td>8-103</td>
<td>Emergency Shutdown Response State Format</td>
<td>444</td>
</tr>
<tr>
<td>8-104</td>
<td>Emergency Shutdown Logging Capability Fields</td>
<td>446</td>
</tr>
<tr>
<td>8-105</td>
<td>Emergency Shutdown Logging Capability Format</td>
<td>446</td>
</tr>
<tr>
<td>8-106</td>
<td>Emergency Shutdown Logging Capability Types</td>
<td>447</td>
</tr>
<tr>
<td>8-107</td>
<td>Emergency Shutdown Trigger Control Fields</td>
<td>449</td>
</tr>
<tr>
<td>8-108</td>
<td>Emergency Shutdown Trigger Control Format</td>
<td>449</td>
</tr>
<tr>
<td>8-109</td>
<td>Emergency Shutdown Threshold Encoding ID</td>
<td>450</td>
</tr>
<tr>
<td>8-110</td>
<td>Emergency Shutdown Response Control Fields</td>
<td>451</td>
</tr>
<tr>
<td>8-111</td>
<td>Emergency Shutdown Logging Control Fields</td>
<td>452</td>
</tr>
<tr>
<td>8-112</td>
<td>Emergency Shutdown Logging Control Format</td>
<td>453</td>
</tr>
<tr>
<td>8-113</td>
<td>Emergency Shutdown Logging Fields</td>
<td>454</td>
</tr>
<tr>
<td>9-1</td>
<td>Software view of Upstream and Downstream Device at UCIe interface</td>
<td>456</td>
</tr>
<tr>
<td>9-2</td>
<td>SW discovery of UCIe Links</td>
<td>457</td>
</tr>
<tr>
<td>9-3</td>
<td>Summary of location of various UCIe Link related registers</td>
<td>458</td>
</tr>
<tr>
<td>9-4</td>
<td>Register Attributes</td>
<td>462</td>
</tr>
<tr>
<td>9-5</td>
<td>UCIe Link DVSEC - PCI Express Extended Capability Header</td>
<td>464</td>
</tr>
<tr>
<td>9-6</td>
<td>UCIe Link DVSEC - Designated Vendor Specific Header 1, 2</td>
<td>464</td>
</tr>
<tr>
<td>9-7</td>
<td>UCIe Link DVSEC - Capability Descriptor</td>
<td>465</td>
</tr>
<tr>
<td>9-8</td>
<td>UCIe Link DVSEC - UCIe Link Capability</td>
<td>466</td>
</tr>
<tr>
<td>9-9</td>
<td>UCIe Link DVSEC - UCIe Link Control</td>
<td>468</td>
</tr>
<tr>
<td>9-10</td>
<td>UCIe Link DVSEC - UCIe Link Status</td>
<td>470</td>
</tr>
<tr>
<td>9-11</td>
<td>UCIe Link DVSEC - Link Event Notification Control</td>
<td>472</td>
</tr>
<tr>
<td>9-12</td>
<td>UCIe Link DVSEC - Error Notification Control</td>
<td>473</td>
</tr>
<tr>
<td>9-13</td>
<td>UCIe Link DVSEC - Register Locator 0, 1, 2, 3 Low</td>
<td>476</td>
</tr>
<tr>
<td>9-14</td>
<td>UCIe Link DVSEC - Register Locator 0, 1, 2, 3 High</td>
<td>477</td>
</tr>
<tr>
<td>9-15</td>
<td>UCIe Link DVSEC - Sideband Mailbox Index Low</td>
<td>477</td>
</tr>
<tr>
<td>9-16</td>
<td>UCIe Link DVSEC - Sideband Mailbox Index High</td>
<td>478</td>
</tr>
<tr>
<td>9-17</td>
<td>UCIe Link DVSEC - Sideband Mailbox Data Low</td>
<td>478</td>
</tr>
<tr>
<td>9-18</td>
<td>UCIe Link DVSEC - Sideband Mailbox Data High</td>
<td>478</td>
</tr>
<tr>
<td>9-19</td>
<td>UCIe Link DVSEC - Sideband Mailbox Control</td>
<td>479</td>
</tr>
<tr>
<td>9-20</td>
<td>UCIe Link DVSEC - Sideband Mailbox Status</td>
<td>479</td>
</tr>
<tr>
<td>9-21</td>
<td>UCIe Link DVSEC - Requester ID</td>
<td>479</td>
</tr>
<tr>
<td>9-22</td>
<td>UCIe Link DVSEC - Associated Port Numbers</td>
<td>480</td>
</tr>
<tr>
<td>9-23</td>
<td>UiSRB DVSEC - PCI Express Extended Capability Header</td>
<td>480</td>
</tr>
<tr>
<td>9-24</td>
<td>UiSRB DVSEC - Designated Vendor Specific Header 1, 2</td>
<td>481</td>
</tr>
<tr>
<td>9-25</td>
<td>UiSRB DVSEC - UiSRB Base Address</td>
<td>481</td>
</tr>
<tr>
<td>9-26</td>
<td>D2D/PHY Register Block - UCIe Register Block Header (Offset 0h)</td>
<td>482</td>
</tr>
<tr>
<td>9-27</td>
<td>Uncorrectable Error Status Register</td>
<td>482</td>
</tr>
<tr>
<td>9-28</td>
<td>Uncorrectable Error Mask Register</td>
<td>483</td>
</tr>
<tr>
<td>9-29</td>
<td>Uncorrectable Error Severity Register</td>
<td>484</td>
</tr>
<tr>
<td>9-30</td>
<td>Correctable Error Status Register</td>
<td>484</td>
</tr>
<tr>
<td>9-31</td>
<td>Correctable Error Mask Register</td>
<td>485</td>
</tr>
<tr>
<td>9-32</td>
<td>Header Log 1 Register</td>
<td>485</td>
</tr>
<tr>
<td>9-33</td>
<td>Header Log 2 Register</td>
<td>486</td>
</tr>
<tr>
<td>9-34</td>
<td>Error and Link Testing Control Register</td>
<td>488</td>
</tr>
<tr>
<td>9-35</td>
<td>Runtime Link Testing Parity Log 0 Register</td>
<td>489</td>
</tr>
<tr>
<td>9-36</td>
<td>Runtime Link Testing Parity Log 1 Register</td>
<td>489</td>
</tr>
<tr>
<td>9-37</td>
<td>Runtime Link Testing Parity Log 2 Register</td>
<td>489</td>
</tr>
<tr>
<td>9-38</td>
<td>Runtime Link Testing Parity Log 3 Register</td>
<td>489</td>
</tr>
<tr>
<td>9-39</td>
<td>Advertised Adapter Capability Log Register</td>
<td>490</td>
</tr>
<tr>
<td>9-40</td>
<td>Finalized Adapter Capability Log Register</td>
<td>490</td>
</tr>
<tr>
<td>9-41</td>
<td>Advertised CXL Capability Log Register</td>
<td>490</td>
</tr>
<tr>
<td>9-42</td>
<td>Finalized CXL Capability Log Register</td>
<td>490</td>
</tr>
<tr>
<td>9-43</td>
<td>Advertised Multi-Protocol Capability Log Register</td>
<td>490</td>
</tr>
</table>

<table>
<tr>
<th colspan="2"></th>
<th>Tables</th>
</tr>
<tr>
<td>9-44</td>
<td>Finalized Multi-Protocol Capability Log Register</td>
<td>491</td>
</tr>
<tr>
<td>9-45</td>
<td>Advertised CXL Capability Log Register for Stack 1</td>
<td>491</td>
</tr>
<tr>
<td>9-46</td>
<td>Finalized CXL Capability Log Register for Stack 1</td>
<td>491</td>
</tr>
<tr>
<td>9-47</td>
<td>Physical Layer Capability Register</td>
<td>492</td>
</tr>
<tr>
<td>9-48</td>
<td>Physical Layer Control Register</td>
<td>493</td>
</tr>
<tr>
<td>9-49</td>
<td>Physical Layer Status Register</td>
<td>495</td>
</tr>
<tr>
<td>9-50</td>
<td>Phy Init and Debug Register</td>
<td>496</td>
</tr>
<tr>
<td>9-51</td>
<td>Training Setup 1 Register</td>
<td>497</td>
</tr>
<tr>
<td>9-52</td>
<td>Training Setup 2 Register</td>
<td>497</td>
</tr>
<tr>
<td>9-53</td>
<td>Training Setup 3 Register</td>
<td>498</td>
</tr>
<tr>
<td>9-54</td>
<td>Training Setup 4 Register</td>
<td>498</td>
</tr>
<tr>
<td>9-55</td>
<td>Current Lane Map Module 0 Register</td>
<td>499</td>
</tr>
<tr>
<td>9-56</td>
<td>Current Lane Map Module 1 Register</td>
<td>499</td>
</tr>
<tr>
<td>9-57</td>
<td>Current Lane Map Module 2 Register</td>
<td>499</td>
</tr>
<tr>
<td>9-58</td>
<td>Current Lane Map Module 3 Register</td>
<td>499</td>
</tr>
<tr>
<td>9-59</td>
<td>Error Log 0 Register</td>
<td>500</td>
</tr>
<tr>
<td>9-60</td>
<td>Error Log 1 Register</td>
<td>501</td>
</tr>
<tr>
<td>9-61</td>
<td>Runtime Link Test Control</td>
<td>501</td>
</tr>
<tr>
<td>9-62</td>
<td>Runtime Link Test Status Register</td>
<td>503</td>
</tr>
<tr>
<td>9-63</td>
<td>Mainband Data Repair Register</td>
<td>503</td>
</tr>
<tr>
<td>9-64</td>
<td>Clock, Track, Valid and Sideband Repair Register</td>
<td>504</td>
</tr>
<tr>
<td>9-65</td>
<td>UHM DVSEC - Designated Vendor Specific Header 1, 2 (Offsets 04h and 08h)</td>
<td>506</td>
</tr>
<tr>
<td>9-66</td>
<td>UHM Status</td>
<td>506</td>
</tr>
<tr>
<td>9-67</td>
<td>EML_Lnx_Mody</td>
<td>506</td>
</tr>
<tr>
<td>9-68</td>
<td>EMR_Lnx_Mody</td>
<td>506</td>
</tr>
<tr>
<td>9-69</td>
<td>UCIe Register Block Header (Offset 0h)</td>
<td>507</td>
</tr>
<tr>
<td>9-70</td>
<td>D2D Adapter Test/Compliance Register Block Offset (Offset 10h)</td>
<td>508</td>
</tr>
<tr>
<td>9-71</td>
<td>PHY Test/Compliance Register Block Offset (Offset 14h)</td>
<td>508</td>
</tr>
<tr>
<td>9-72</td>
<td>Adapter Compliance Control (Offset 20h from D2DOFF)</td>
<td>509</td>
</tr>
<tr>
<td>9-73</td>
<td>Flit Tx Injection Control (Offset 28h from D2DOFF)</td>
<td>509</td>
</tr>
<tr>
<td>9-74</td>
<td>Adapter Test Status</td>
<td>511</td>
</tr>
<tr>
<td>9-75</td>
<td>Link State Injection Control Stack 0</td>
<td>512</td>
</tr>
<tr>
<td>9-76</td>
<td>Link State Injection Control Stack 1</td>
<td>512</td>
</tr>
<tr>
<td>9-77</td>
<td>Retry Injection Control</td>
<td>513</td>
</tr>
<tr>
<td>9-78</td>
<td>Physical Layer Compliance Control 1</td>
<td>514</td>
</tr>
<tr>
<td>9-79</td>
<td>Physical Layer Compliance Control 2</td>
<td>516</td>
</tr>
<tr>
<td>9-80</td>
<td>Physical Layer Compliance Status 1</td>
<td>517</td>
</tr>
<tr>
<td>9-81</td>
<td>Physical Layer Compliance Status 2</td>
<td>518</td>
</tr>
<tr>
<td>9-82</td>
<td>Physical Layer Compliance Status 3</td>
<td>518</td>
</tr>
<tr>
<td>9-83</td>
<td>UEDT Header</td>
<td>520</td>
</tr>
<tr>
<td>9-84</td>
<td>UCIe Link Structure (UCLS)</td>
<td>520</td>
</tr>
<tr>
<td>10-1</td>
<td>RDI signal list</td>
<td>522</td>
</tr>
<tr>
<td>10-2</td>
<td>RDI Config interface extensions for Management Transport</td>
<td>527</td>
</tr>
<tr>
<td>10-3</td>
<td>FDI signal list</td>
<td>540</td>
</tr>
<tr>
<td>$1 0 - 4$</td>
<td>Requests Considered in Each State by Lower Layer</td>
<td>565</td>
</tr>
<tr>
<td>{ 1 0 - 5 }<br>{ 1 0 - 6 }</td>
<td>Mapping of Vendor-defined Bits that Use TXVLD/RXVLD Encodings</td>
<td>572</td>
</tr>
<tr>
<td></td>
<td>Example Configurations and Widths</td>
<td>573</td>
</tr>
<tr>
<td>{ A - 1 }<br>{ A - 2 }</td>
<td>CXL Registers for UCIe devices</td>
<td>582</td>
</tr>
<tr>
<td></td>
<td>PCIe Registers for UCIe devices</td>
<td>583</td>
</tr>
<tr>
<td>B-1</td>
<td>AIB 2.0 Datapath mapping for Advanced Package</td>
<td>586</td>
</tr>
<tr>
<td>B-2</td>
<td>AIB 1.0 Datapath mapping for Advanced Package</td>
<td>586</td>
</tr>
</table>

## Terminology

<table>
<caption>Table 1. Terms and Definitions (Sheet 1 of 8)</caption>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
<tr>
<td>Ack</td>
<td>Acknowledge</td>
</tr>
<tr>
<td>ACPI</td>
<td>Advanced Configuration and Power Interface</td>
</tr>
<tr>
<td>Addr</td>
<td>Address</td>
</tr>
<tr>
<td>Advanced Package</td>
<td>This packaging technology is used for performance optimized applications and short reach interconnects.</td>
</tr>
<tr>
<td>AFE</td>
<td>Analog Front End</td>
</tr>
<tr>
<td>ALMP</td>
<td>ARB/MUX Link Management Packet (as defined in CXL Specification)</td>
</tr>
<tr>
<td>APMW</td>
<td>Advanced Package Module Width</td>
</tr>
<tr>
<td>ARB/MUX</td>
<td>Arbiter/Multiplexer (as defined in CXL Specification)</td>
</tr>
<tr>
<td>Asset</td>
<td>Any data or mechanism used to access data that should be protected from illicit access, use, availability, disclosure, alteration, destruction, or theft.</td>
</tr>
<tr>
<td>ATE</td>
<td>Automated Test Equipment</td>
</tr>
<tr>
<td>B2B</td>
<td>Back-to-Back</td>
</tr>
<tr>
<td>BAR</td>
<td>Base Address Register</td>
</tr>
<tr>
<td>BDF</td>
<td>Bus Device Function</td>
</tr>
<tr>
<td>BE</td>
<td>Byte Enable</td>
</tr>
<tr>
<td>BEI</td>
<td>BAR Equivalent Indicator</td>
</tr>
<tr>
<td>BER</td>
<td>Bit Error Ratio</td>
</tr>
<tr>
<td>BFM</td>
<td>Bus Functional Model</td>
</tr>
<tr>
<td>bubble</td>
<td>Gap in data transfer and/or signal transitions. Measured in number of clock cycles.</td>
</tr>
<tr>
<td>bundle</td>
<td>Tx group or Rx group for UCIe-3D interconnects that contains data, clock, power, and ground. A 3D Module consists of a Tx bundle and an Rx bundle.</td>
</tr>
<tr>
<td>C4 bump</td>
<td>Controller Collapse Chip Connect bump</td>
</tr>
<tr>
<td>$\mathrm { C A }$</td>
<td>Completer Abort</td>
</tr>
<tr>
<td>CB</td>
<td>$C i r c u l a r \quad B u f f e r$</td>
</tr>
<tr>
<td>CDM</td>
<td>Charged Device Model</td>
</tr>
<tr>
<td>chiplet</td>
<td>Integrated circuit die that contains a well-defined subset of functionality that is designed to be combined with other chiplets in a package.</td>
</tr>
<tr>
<td>clear cleared</td>
<td>If clear or reset is used and no value is provided for a bit, it is interpreted as 0b.</td>
</tr>
<tr>
<td>CLM</td>
<td>Current Lane Map</td>
</tr>
<tr>
<td>CMLS</td>
<td>Common Maximum Link Speed</td>
</tr>
<tr>
<td>CMPS</td>
<td>Configured Maximum Packet Size</td>
</tr>
<tr>
<td>CoWoS</td>
<td>Chip on Wafer on Substrate</td>
</tr>
<tr>
<td>CPU</td>
<td>Central Processing Unit</td>
</tr>
<tr>
<td>CRC</td>
<td>Cyclic Redundancy Check</td>
</tr>
<tr>
<td>CXL</td>
<td>Compute eXpress Link</td>
</tr>
<tr>
<td>$C X L \quad 6 8 B \quad F l i t \quad M o d e$</td>
<td>This term is used to reference 68B Flit Mode related Protocol features defined in CXL Specification.</td>
</tr>
<tr>
<td>CXL 256B Flit Mode</td>
<td>This term is used to reference 256B Flit Mode related Protocol features defined in CXL Specification.</td>
</tr>
<tr>
<td>D2C</td>
<td>Data-to-Clock</td>
</tr>
</table>

<table>
<caption>Table 1. Terms and Definitions (Sheet 2 of 8)</caption>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
<tr>
<td>D2D</td>
<td>Die-to-Die</td>
</tr>
<tr>
<td>DCC</td>
<td>Duty Cycle Correction</td>
</tr>
<tr>
<td>DDR</td>
<td>Double Data Rate Memory</td>
</tr>
<tr>
<td>DevID</td>
<td>Device ID</td>
</tr>
<tr>
<td>DFx</td>
<td>Design for Debug or Design for Test</td>
</tr>
<tr>
<td>DLLP</td>
<td>Data Link Layer Packet (as defined in PCIe Base Specification)</td>
</tr>
<tr>
<td>DLP</td>
<td>In Flit modes, the Data Link Layer Payload within a flit (as defined in PCIe Base Specification).</td>
</tr>
<tr>
<td>$D M H$</td>
<td>$D F x \quad M a n a g e m e n t \quad H u b .$ DFx entity that provides enumeration/global control/status of DFx</td>
</tr>
<tr>
<td>DMS</td>
<td>DFx Management Spoke. DFx entity that implements a specific test/debug functionality within a DMH.</td>
</tr>
<tr>
<td>DMS-ID</td>
<td>Static design time ID assigned to a DMS for ID-routed messages within a DMH. Interchangeably used with the term Spoke-ID.</td>
</tr>
<tr>
<td>{ \text { Domain Reset } }<br>{ \text { \left(domain reset\right) } }</td>
<td>Used to refer to a hardware mechanism that sets or returns all UCIe registers and state machines associated with a given UCIe Link to their initialization values as specified in this document. It is required for both sides of the Link to have an overlapping time window such that they are both in domain reset concurrently.</td>
</tr>
<tr>
<td>DP</td>
<td>Downstream Port</td>
</tr>
<tr>
<td>DSP</td>
<td>Downstream Switch Port (as defined in CXL Specification)</td>
</tr>
<tr>
<td>DVFS</td>
<td>Dynamic Voltage Frequency Scaling</td>
</tr>
<tr>
<td>DVSEC</td>
<td>Designated Vendor-Specific Extended Capability (as defined in PCIe Base Specification)</td>
</tr>
<tr>
<td>DWORD</td>
<td>Double Word. Four bytes. When used as an addressable quantity, a Double Word is four bytes of data that are aligned on a four-byte boundary (i.e., the least significant two bits of the address are 00b).</td>
</tr>
<tr>
<td>E2E</td>
<td>$E n d \quad t o \quad e n d$</td>
</tr>
<tr>
<td>EM</td>
<td>Eye Margin</td>
</tr>
<tr>
<td>EMIB</td>
<td>Embedded Multi-die Interconnect Bridge</td>
</tr>
<tr>
<td>EML</td>
<td>Eye Margin Left</td>
</tr>
<tr>
<td>EMR</td>
<td>Eye Margin Right</td>
</tr>
<tr>
<td>EMV</td>
<td>Eye Margin Valid</td>
</tr>
<tr>
<td>Encapsulated MTP eMTP</td>
<td>Encapsulated Management Transport Packet. The resulting packet after Encapsulation.</td>
</tr>
<tr>
<td>Encapsulation</td>
<td>Process of splitting an MTP or Vendor defined messages (exchanged between Management Port Gateways on both ends of a link) into smaller pieces to meet any required payload length restrictions or for any other reasons like credit availability, adding a 2-DWORD header to each piece and if required, adding a 1-DWORD data padding at the end of an MTP to transmit the MTP over sideband or mainband UCIe link. In the case of an MTP, the resulting packet after Encapsulation is called the Encapsulated MTP.</td>
</tr>
<tr>
<td>Endpoint EP</td>
<td>As defined in PCIe Base Specification.</td>
</tr>
<tr>
<td>eRCD</td>
<td>Exclusive Restricted CXL Device (as defined in CXL Specification)</td>
</tr>
<tr>
<td>eRCH</td>
<td>Exclusive Restricted CXL Host (as defined in CXL Specification)</td>
</tr>
<tr>
<td>ESD</td>
<td>Electro-Static Discharge</td>
</tr>
<tr>
<td>F2B</td>
<td>Face-to-Back</td>
</tr>
<tr>
<td>F2F</td>
<td>Face-to-Face</td>
</tr>
<tr>
<td>FDI</td>
<td>Flit-Aware Die-to-Die Interface</td>
</tr>
<tr>
<td>FEC</td>
<td>Forward Error Correction</td>
</tr>
</table>

<table>
<caption>Table 1. Terms and Definitions (Sheet 3 of 8)</caption>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
<tr>
<td>$F E X T$</td>
<td>Far-End CrossTalk</td>
</tr>
<tr>
<td>FH</td>
<td>Flit Header</td>
</tr>
<tr>
<td>FIFO</td>
<td>First In, First Out</td>
</tr>
<tr>
<td>FIR</td>
<td>Finite Impulse Response</td>
</tr>
<tr>
<td>$\mathrm { F I T }$</td>
<td>Failure In Time. 1 FIT = 1 device failure in 109 hours.</td>
</tr>
<tr>
<td>$F l i t$</td>
<td>Link Layer unit of transfer (as defined in CXL Specification).</td>
</tr>
<tr>
<td>Flit_Marker $F M$</td>
<td>Flit Marker (as defined in PCIe Base Specification)</td>
</tr>
<tr>
<td>FW</td>
<td>Firmware</td>
</tr>
<tr>
<td>FW-CLK</td>
<td>Forwarded Clock over the UCIe Link for mainband data Lanes</td>
</tr>
<tr>
<td>HMLS</td>
<td>Highest Maximum Link Speed of next-lower configuration.</td>
</tr>
<tr>
<td>Hub</td>
<td>See DMH.</td>
</tr>
<tr>
<td>$H W$</td>
<td>Hardware</td>
</tr>
<tr>
<td>IL</td>
<td>Insertion Loss</td>
</tr>
<tr>
<td>I/O</td>
<td>$I n p u t / O u t p u t$</td>
</tr>
<tr>
<td>IP</td>
<td>Generic term used to refer to architecture blocks that are defined within the specification (e.g., D2D adapter, PHY, etc.).</td>
</tr>
<tr>
<td>IPA</td>
<td>Ignore Prohibited Access</td>
</tr>
<tr>
<td>ISI</td>
<td>Inter-Symbol Interference</td>
</tr>
<tr>
<td>I/Q</td>
<td>in-phase/quadrature</td>
</tr>
<tr>
<td>KPI</td>
<td>Key Performance Indicator</td>
</tr>
<tr>
<td>L2SPD</td>
<td>L2 Sideband Power Down</td>
</tr>
<tr>
<td>Lane</td>
<td>A pair of signals mapped to physical bumps, one for Transmission, and one for Reception. A xN UCIe Link is composed of N Lanes.</td>
</tr>
<tr>
<td>LCLK</td>
<td>Refers to the clock at which the Logical Physical Layer, Adapter and RDI/FDI are operating.</td>
</tr>
<tr>
<td>LCRC</td>
<td>Link CRC</td>
</tr>
<tr>
<td>LFSR</td>
<td>Linear Feedback Shift Register</td>
</tr>
<tr>
<td>Link UCIe Link</td>
<td>A Link or UCIe Link refers to the set of two UCIe components and their interconnecting Lanes which forms a dual-simplex communications path between the two components.</td>
</tr>
<tr>
<td>LSM</td>
<td>Adapter Link State Machine</td>
</tr>
<tr>
<td>$\mathrm { L T S M }$</td>
<td>Link Training State Machine</td>
</tr>
<tr>
<td>LTSSM</td>
<td>Link Training and Status State Machine (as defined in PCIe Base Specification)</td>
</tr>
<tr>
<td>LSB</td>
<td>Least Significant Bit</td>
</tr>
<tr>
<td>Mainband MB</td>
<td>Connection that constitutes the main data path of UCIe. Consists of a forwarded clock, a data valid pin, and N Lanes of data per module.</td>
</tr>
<tr>
<td>Management Bridge</td>
<td>Type of Management Entity that bridges a Management Network within an SiP to another network that may be internal or external to the SiP.</td>
</tr>
<tr>
<td>Management Director</td>
<td>Management Element that is responsible for discovering, configuring, and coordinating the overall management of the SiP and acts as the manageability Root of Trust (ROT).</td>
</tr>
<tr>
<td>Management Domain</td>
<td>One or more chiplets in an SiP that are interconnected by a Management Network and support UCIe Manageability.</td>
</tr>
<tr>
<td>Management Element</td>
<td>Type of Management Entity that can perform one or more management functions.</td>
</tr>
</table>

<table>
<caption>Table 1. Terms and Definitions (Sheet 4 of 8)</caption>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
<tr>
<td>Management Entity</td>
<td>Addressable entity on the Management Network that can send and/or receive UCIe Management Transport packets. A Management Element, a Management Port, and a Management Bridge are all a type of Management Entity.</td>
</tr>
<tr>
<td>Management Flit</td>
<td>A Flit that carries a Management Port Message (MPM).</td>
</tr>
<tr>
<td>Management Link Encapsulation Mechanism</td>
<td>Mechanism that defines how UCIe Management Transport packets are transferred across a point-to- point management link.</td>
</tr>
<tr>
<td>Management Network</td>
<td>Network within and between chiplets that is capable of transporting UCIe Management Transport packets.</td>
</tr>
<tr>
<td>Management Port</td>
<td>Management Entity that facilitates management communication between chiplets using a chiplet- to-chiplet management link.</td>
</tr>
<tr>
<td>Management Port Gateway (MPG)</td>
<td>Entity that provides the bridging functionality when transporting an MTP from/to a local SoC management fabric (which is an SoC-specific implementation) to/from a UCIe link.</td>
</tr>
<tr>
<td>Management Port Message (MPM)</td>
<td>Sideband or mainband message that relates to encapsulation.</td>
</tr>
<tr>
<td>Management Protocol</td>
<td>Protocol carried on top of the UCIe Management Transport.</td>
</tr>
<tr>
<td>Management Reset</td>
<td>Type of reset that causes all UCIe manageability and manageability structures in a chiplet to be reset to their default state.</td>
</tr>
<tr>
<td>MCLS</td>
<td>Number of active Modules Current Link Speed</td>
</tr>
<tr>
<td>MMIO</td>
<td>Memory mapped Input/Output</td>
</tr>
<tr>
<td>MMPL</td>
<td>Multi-module PHY Logic</td>
</tr>
<tr>
<td>Module</td>
<td>UCIe main data path on the physical bumps is organized as a group of Lanes called a Module. For $a \quad s i n g l e \quad M o d u l e .$ 16 Lanes constitute a single Module. For Advanced Package, $6 4 \quad L a n e s \quad c o n s t i t u t e$</td>
</tr>
<tr>
<td>MSB</td>
<td>Most Significant Bit</td>
</tr>
<tr>
<td>MTP</td>
<td>Management Transport Packet</td>
</tr>
<tr>
<td>Nak</td>
<td>Negatively acknowledge</td>
</tr>
<tr>
<td>NEXT</td>
<td>Near-End Cross Talk</td>
</tr>
<tr>
<td>NOP</td>
<td>No Operation</td>
</tr>
<tr>
<td>NVMe</td>
<td>Non-Volatile $M e m o r y \quad e x p r e s s$</td>
</tr>
<tr>
<td>One-Time Programmable</td>
<td>Any data storage mechanism that is capable of being programmed only once (e.g., fuse).</td>
</tr>
<tr>
<td>P2P</td>
<td>Peer to peer</td>
</tr>
<tr>
<td>Packet</td>
<td>A block of data transmitted across a network.</td>
</tr>
<tr>
<td>$P C I e \left( P C I \quad E x p r e s s \right)$</td>
<td>Peripheral Component Interconnect Express (defined in PCIe Base Specification)</td>
</tr>
<tr>
<td>PCIe Flit Mode</td>
<td>This term is used to reference Flit Mode related Protocol features defined in PCIe Base Specification.</td>
</tr>
<tr>
<td>PCIe non-Flit Mode</td>
<td>Specification. This term is used to reference non-Flit Mode related Protocol features defined in PCIe Base</td>
</tr>
<tr>
<td>PDOS</td>
<td>Permanent Denial of Service</td>
</tr>
<tr>
<td>PDS</td>
<td>Pause of Data Stream</td>
</tr>
<tr>
<td>PHY</td>
<td>Physical Layer (PHY and Physical Layer are used interchangeable throughout the Specification)</td>
</tr>
<tr>
<td>PI</td>
<td>Phase Interpolator</td>
</tr>
<tr>
<td>PLL</td>
<td>Phase-Locked Loop</td>
</tr>
<tr>
<td>PM</td>
<td>Power Management states, used to refer to behavior and/or rules related to Power Management states (covers both L1 and L2).</td>
</tr>
<tr>
<td>PMO</td>
<td>Sideband Performant Mode Operation</td>
</tr>
<tr>
<td>Power Management Director</td>
<td>A Management Element that may configure power management parameters.</td>
</tr>
</table>

<table>
<caption>Table 1. Terms and Definitions (Sheet 5 of 8)</caption>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
<tr>
<td>Power Management Element</td>
<td>A type of Management Entity that can perform one or more Power Management functions.</td>
</tr>
<tr>
<td>PSPT</td>
<td>Priority Sideband Packet Transfer</td>
</tr>
<tr>
<td>PSTP</td>
<td>Priority Sideband Traffic Packet</td>
</tr>
<tr>
<td>QWORD</td>
<td>Quad Word. Eight bytes. When used as an addressable quantity, a Quad Word is eight bytes of data that are aligned on an eight-byte boundary (i.e., the least significant three bits of the address are 000b).</td>
</tr>
<tr>
<td>RAC</td>
<td>Read Access Control</td>
</tr>
<tr>
<td>RCD</td>
<td>Restricted CXL Device (as defined in CXL Specification)</td>
</tr>
<tr>
<td>RCH</td>
<td>Restricted CXL Host (as defined in CXL Specification)</td>
</tr>
<tr>
<td>RCIEP</td>
<td>Root Complex Integrated Endpoint</td>
</tr>
<tr>
<td>RCKN_P RXCKN rxckn</td>
<td>Physical Lane for Clock Receiver Phase-2</td>
</tr>
<tr>
<td>RCKP_P RXCKP rxckp</td>
<td>Physical Lane for Clock Receiver Phase-1</td>
</tr>
<tr>
<td>RCRB</td>
<td>Root Complex Register Block</td>
</tr>
<tr>
<td>RDI</td>
<td>Raw Die-to-Die Interface</td>
</tr>
<tr>
<td>$R D _ { - } P \left[ N \right]$ $R D \_ P N$ \mathrm { R X D A I A I N }<br>\mathrm { r e d a t a n }</td>
<td>Nth Physical Lane for Data Receiver</td>
</tr>
<tr>
<td>remote Link partner</td>
<td>This term is used throughout this specification to denote the logic associated with the far side of the UCIe Link; to denote actions or messages sent or received by the Link partner of a UCIe die.</td>
</tr>
<tr>
<td>Replay Retry</td>
<td>Retry and Replay are used interchangeably to refer to the Link level reliability mechanisms.</td>
</tr>
<tr>
<td>Reserved</td>
<td>The contents, states, or information are not defined at this time. Using any Reserved area (for example, packet header bit-fields, configuration register bits) is not permitted. Reserved register fields must be read only and must return 0 (all Os for multi-bit fields) when read. For packets transmitted and received over the UCIe Link (mainband or sideband), the Reserved bits must be cleared to Ob by the sender and ignored by the receiver. Reserved encodings for register and packet fields must not be used. Any implementation dependence on a Reserved field value or encoding will result in an implementation that is not UCIe-compliant. The functionality of such an implementation cannot be guaranteed in this or any future revision of this specification. For registers, UCIe uses the "RsvdP" or "RsvdZ" attributes for reserved fields, as well as Rsvd, and these follow the same definition as PCIe Base Specification for hardware as well as software.</td>
</tr>
<tr>
<td>reset</td>
<td>If reset or clear is used and no value is provided for a bit, it is interpreted as 0b.</td>
</tr>
<tr>
<td>RID</td>
<td>Revision ID</td>
</tr>
<tr>
<td>$R L$</td>
<td>Register Locator</td>
</tr>
<tr>
<td>Root Complex</td>
<td>As defined in PCIe Base Specification.</td>
</tr>
<tr>
<td>Root Port RP</td>
<td>As defined in PCIe Base Specification.</td>
</tr>
<tr>
<td>RoT</td>
<td>Root of Trust</td>
</tr>
<tr>
<td>RRDCK_P RXCKRD rxckRD</td>
<td>Physical Lane for redundant Clock/Track Receiver</td>
</tr>
</table>

<table>
<caption>Table 1. Terms and Definitions (Sheet 6 of 8)</caption>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
<tr>
<td>$R R D \_ P \left[ N \right]$ RRD_PN RXDATARD[N] rxdataRD[N]</td>
<td>Nth Physical Lane for redundant Data Receiver</td>
</tr>
<tr>
<td>RRDVLD_P RXVLDRD rxvldRD</td>
<td>Physical Lane for redundant Valid Receiver</td>
</tr>
<tr>
<td>RTRK_P RXTRK rxtrk</td>
<td>Physical Lane for Track Receiver</td>
</tr>
<tr>
<td>$\mathrm { R V L D }$ RXVLD rxvld</td>
<td>Physical Lane for Valid Receiver</td>
</tr>
<tr>
<td>Rx</td>
<td>Receiver</td>
</tr>
<tr>
<td>RXCKSB rxcksb</td>
<td>Physical Lane for sideband Clock Receiver</td>
</tr>
<tr>
<td>RXCKSBRD $r x c k s b R D$</td>
<td>Physical Lane for redundant sideband Clock Receiver</td>
</tr>
<tr>
<td>RXDATASB rxdatasb</td>
<td>Physical Lane for sideband Data Receiver</td>
</tr>
<tr>
<td>RXDATASBRD rxdatasbRD</td>
<td>Physical Lane for redundant sideband Data Receiver</td>
</tr>
<tr>
<td>SBFE</td>
<td>Sideband Feature Extensions</td>
</tr>
<tr>
<td>$\left\{ < \mathrm { S B M S G } > \right\}$</td>
<td>Sideband message requests or responses are referred to by their names enclosed in curly brackets. See Chapter 7.0 for the mapping of sideband message names to relevant encodings. An asterisk in the &lt;SBMSG&gt; name is used to denote a group of messages with the same prefix or suffix in their name.</td>
</tr>
<tr>
<td>SC</td>
<td>Successful Completion</td>
</tr>
<tr>
<td>SD</td>
<td>Security Director. Management Element that may configure security parameters.</td>
</tr>
<tr>
<td>Segmentation</td>
<td>Process of taking a large MTP, splitting it into smaller "segments" and sending those segments on multiple sideband links or mainband stacks.</td>
</tr>
<tr>
<td>SERDES</td>
<td>Serializer/Deserializer</td>
</tr>
<tr>
<td>serial packet</td>
<td>$A \quad 6 4 - b i t$ serial packet is defined on the sideband I/O interface to the remote chiplet as shown in</td>
</tr>
<tr>
<td>set</td>
<td>If set is used and no value is provided for a bit, it is interpreted as 1b.</td>
</tr>
<tr>
<td>SFES</td>
<td>Sideband Feature Extensions Supported</td>
</tr>
<tr>
<td>Sideband SB</td>
<td>Connection used for parameter exchanges, register accesses for debug/compliance and coordination with remote partner for Link training and management. Consists of a forwarded clock pin and a data pin in each direction. The clock is fixed at 800 MHz regardless of the main data path speed. The sideband logic for the UCIe Physical Layer must be on auxiliary power and an "always on" domain. Each module has its own set of sideband pins.</td>
</tr>
<tr>
<td>SiP</td>
<td>System in Package. Collection of chiplets packaged as a unit.</td>
</tr>
<tr>
<td>SM</td>
<td>State Machine</td>
</tr>
<tr>
<td>SO</td>
<td>Sideband-only</td>
</tr>
<tr>
<td>SoC</td>
<td>System on a Chip</td>
</tr>
<tr>
<td>Spoke</td>
<td>See DMS.</td>
</tr>
<tr>
<td>Standard Package</td>
<td>This packaging technology is used for low cost and long reach interconnects using traces on organic package/substrate</td>
</tr>
<tr>
<td>Strobe</td>
<td>Used interchangeably with clock for sideband clock</td>
</tr>
</table>

<table>
<caption>Table 1. Terms and Definitions (Sheet 7 of 8)</caption>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
<tr>
<td>SW</td>
<td>Software</td>
</tr>
<tr>
<td>TARR</td>
<td>Tx Adjustment during Runtime Recalibration</td>
</tr>
<tr>
<td>TC</td>
<td>Traffic Class</td>
</tr>
<tr>
<td>TCKN_P TXCKN txckn</td>
<td>Physical Lane for Clock Transmitter Phase-2</td>
</tr>
<tr>
<td>TCKP_P TXCKP txckp</td>
<td>Physical Lane for Clock Transmitter Phase-1</td>
</tr>
<tr>
<td>TCM</td>
<td>Tightly coupled mode</td>
</tr>
<tr>
<td>TDPI</td>
<td>Test, Debug, Pattern, and Infrastructure</td>
</tr>
<tr>
<td>$T D _ { - } P \left[ N \right]$ TD_PN TXDATA[N] txdataN</td>
<td>Nth Physical Lane for Data Transmitter</td>
</tr>
<tr>
<td>Throttle Threshold</td>
<td>Threshold associated with a specific Function ID (e.g., power, thermal, etc.) that triggers the throttle function when breached.</td>
</tr>
<tr>
<td>TLP</td>
<td>Transaction Layer Packet (as defined in PCIe Base Specification)</td>
</tr>
<tr>
<td>TRD_P[N] TRD_PN TXDATARD[N] txdataRD[N]</td>
<td>Nth Physical Lane for redundant Data Transmitter</td>
</tr>
<tr>
<td>TRDCK_P TXCKRD txckRD</td>
<td>Physical Lane for redundant Clock/Track Transmitter</td>
</tr>
<tr>
<td>TRDVLD_P TXVLDRD txvldRD</td>
<td>Physical Lane for redundant Valid Transmitter</td>
</tr>
<tr>
<td>Trx</td>
<td>Transceiver</td>
</tr>
<tr>
<td>TSV</td>
<td>Through-Silicon Via</td>
</tr>
<tr>
<td>TTRK_P TXTRK txtrk</td>
<td>Physical Lane for Track Transmitter</td>
</tr>
<tr>
<td>TVLD_P TXVLD txvld</td>
<td>Physical Lane for Valid Transmitter</td>
</tr>
<tr>
<td>Tx</td>
<td>Transmitter</td>
</tr>
<tr>
<td>TXCKSB txcksb</td>
<td>Physical Lane for sideband Clock Transmitter</td>
</tr>
<tr>
<td>TXCKSBRD txcksbRD</td>
<td>Physical Lane for redundant sideband Clock Transmitter</td>
</tr>
<tr>
<td>TXDATASB txdatasb</td>
<td>Physical Lane for sideband Data Transmitter</td>
</tr>
<tr>
<td>TXDATASBRD $\mathrm { t x d a t a s b R D }$</td>
<td>Physical Lane for redundant sideband Data Transmitter</td>
</tr>
<tr>
<td>TXEQ</td>
<td>Transmitter Equalization</td>
</tr>
<tr>
<td>UCIe</td>
<td>Universal Chiplet Interconnect express</td>
</tr>
</table>

<table>
<caption>Table 1. Terms and Definitions (Sheet 8 of 8)</caption>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
<tr>
<td>UCIe-3D</td>
<td>Universal Chiplet Interconnect express for 3D packaging</td>
</tr>
<tr>
<td>UCIe-A</td>
<td>Used to denote x64 Advanced Package module.</td>
</tr>
<tr>
<td>UCIe-A x32</td>
<td>Used to denote x32 Advanced Package module. See Chapter 5.0 for UCIe-A x32 Advanced Package bump matrices, and interoperability between x32 to x32 and x32 to x64 module configurations.</td>
</tr>
<tr>
<td>UCIe-S</td>
<td>Used to denote x16 Standard Package module.</td>
</tr>
<tr>
<td>UCIe chiplet</td>
<td>A chiplet that complies with the UCIe specification.</td>
</tr>
<tr>
<td>UCIe DFx Architecture UDA</td>
<td>DFx architecture specified for chiplets and SiPs that implement UCIe.</td>
</tr>
<tr>
<td>$U C I e \quad D F x \quad M e s s a g e$ UDM</td>
<td>Generic term for all UCIe Management Transport packets with Protocol ID set to 'Test and Debug Protocols'.</td>
</tr>
<tr>
<td>UCIe die</td>
<td>This term is used throughout this specification to denote the logic associated with the UCIe Link on any given chiplet with a UCIe Link connection. It is used as a common noun to denote actions or messages sent or received by an implementation of UCIe.</td>
</tr>
<tr>
<td>UCIe Flit Mode</td>
<td>Operating Mode in which CRC bytes are inserted and checked by the D2D Adapter. If applicable, Retry is also performed by the D2D Adapter.</td>
</tr>
<tr>
<td>UCIe Link</td>
<td>A UCIe connection between two chiplets. These chiplets are Link partners in the context of UCIe since they communicate with each other using a common UCIe Link.</td>
</tr>
<tr>
<td>{ \text { UCIe Mainband } }<br>{ \text { Manaanement Port } }</td>
<td>Chiplet port that implements the Management Link Encapsulation Mechanism and can transfer UCIe Management Transport packets across a point-to-point UCIe mainband link.</td>
</tr>
<tr>
<td>UCIe Management Transport Protocol</td>
<td>Protocol used to transfer UCIe Management Transport packets between management entities.</td>
</tr>
<tr>
<td>UCIe Raw Format</td>
<td>Operating format in which all the bytes of a Flit are populated by the Protocol Layer.</td>
</tr>
<tr>
<td>UCIe Sideband Management Port</td>
<td>Chiplet port that implements the Management Link Encapsulation Mechanism and can transfer UCIe Management Transport packets across a point-to-point UCIe sideband link.</td>
</tr>
<tr>
<td>UCLS</td>
<td>UCIe Link Structure</td>
</tr>
<tr>
<td>UEDT</td>
<td>UCIe Early Discovery Table</td>
</tr>
<tr>
<td>UHM</td>
<td>UCIe Link Health Monitor</td>
</tr>
<tr>
<td>UIE</td>
<td>Uncorrectable Internal Error</td>
</tr>
<tr>
<td>UİRB</td>
<td>UCIe Register Block</td>
</tr>
<tr>
<td>UİSRB</td>
<td>UCIe Structure Register Block</td>
</tr>
<tr>
<td>UMAP</td>
<td>UCIe Memory Access Protocol</td>
</tr>
<tr>
<td>Unit Interval UI</td>
<td>Given a data stream of a repeating pattern of alternating 1 and 0 values, the Unit Interval is the value measured by averaging the time interval between voltage transitions, over a time interval sufficiently long to make all intentional frequency modulation of the source clock negligible.</td>
</tr>
<tr>
<td>UP</td>
<td>Upstream Port</td>
</tr>
<tr>
<td>UR</td>
<td>Unsupported Request</td>
</tr>
<tr>
<td>USP</td>
<td>Upstream Switch Port</td>
</tr>
<tr>
<td>VH</td>
<td>Virtual Hierarchy (as defined in CXL Specification)</td>
</tr>
<tr>
<td>vLSM</td>
<td>Virtual Link State Machine</td>
</tr>
<tr>
<td>Vref</td>
<td>Reference voltage for receivers</td>
</tr>
<tr>
<td>VTF</td>
<td>Voltage Transfer Function</td>
</tr>
<tr>
<td>WAC</td>
<td>Write Access Control</td>
</tr>
<tr>
<td>zero</td>
<td>Numerical value of 0 in a bit, field, or register, of appropriate width for that bit, field, or register.</td>
</tr>
</table>

<table>
<caption>Table 2. Unit of Measure Symbols</caption>
<tr>
<th>Symbol</th>
<th>Unit of Measure</th>
</tr>
<tr>
<td>$b$</td>
<td>bit</td>
</tr>
<tr>
<td>B</td>
<td>byte</td>
</tr>
<tr>
<td>$d B$</td>
<td>decibel</td>
</tr>
<tr>
<td>$f F$</td>
<td>femtofarad</td>
</tr>
<tr>
<td>GB/s</td>
<td>gigabytes per second</td>
</tr>
<tr>
<td>GHZ</td>
<td>gigahertz</td>
</tr>
<tr>
<td>GT/s</td>
<td>gigatransfers per second</td>
</tr>
<tr>
<td>KB/s</td>
<td>kilobytes per second</td>
</tr>
<tr>
<td>MB/s</td>
<td>megabytes per second</td>
</tr>
<tr>
<td>MHz</td>
<td>megahertz</td>
</tr>
<tr>
<td>mm</td>
<td>millimeter</td>
</tr>
<tr>
<td>ms</td>
<td>millisecond</td>
</tr>
<tr>
<td>$M T / s$</td>
<td>megatransfers per second</td>
</tr>
<tr>
<td>mUI</td>
<td>milli-Unit interval</td>
</tr>
<tr>
<td>mV</td>
<td>millivolt</td>
</tr>
<tr>
<td>$m V p p$</td>
<td>millivolt peak-to-peak</td>
</tr>
<tr>
<td>um</td>
<td>micrometer</td>
</tr>
<tr>
<td>us</td>
<td>microsecond</td>
</tr>
<tr>
<td>ns</td>
<td>nanosecond</td>
</tr>
<tr>
<td>$p J$</td>
<td>$\mathrm { p i c o j o u l e }$</td>
</tr>
<tr>
<td>pk</td>
<td>peak</td>
</tr>
<tr>
<td>ppm</td>
<td>parts per million</td>
</tr>
<tr>
<td>$p s$</td>
<td>picosecond</td>
</tr>
<tr>
<td>s</td>
<td>second</td>
</tr>
<tr>
<td>$\frac { T B } { V }$</td>
<td>terabytes per second</td>
</tr>
<tr>
<td>V</td>
<td>volt</td>
</tr>
</table>

## Reference Documents

<table>
<caption>Table 3. Reference Documentsª</caption>
<tr>
<th>Document</th>
<th>Document Location</th>
</tr>
<tr>
<td>PCI Express® Base Specification (PCIe Base Specification) Revision 6.3</td>
<td>www.pcisig.com</td>
</tr>
<tr>
<td>Compute Express Link Specification (CXL Specification) Revision 3.2</td>
<td>computeexpresslink.org</td>
</tr>
<tr>
<td>ACPI Specification (version 6.5 or later)</td>
<td>www.uefi.org</td>
</tr>
<tr>
<td>Industry Council on ESD Targets white papers</td>
<td>www.jedec.org, reference JEP196 www.esdindustrycouncil.org/ic/en, reference White Paper 2 Part II www.esda.org, reference White Paper 2 Part II</td>
</tr>
</table>

a. References to these documents throughout this specification relate to the versions/revisions listed here.

## Revision History

Table 4 lists the significant changes in different revisions.

<table>
<caption>Table 4. Revision History</caption>
<tr>
<th>Revision</th>
<th>Date</th>
<th>Description</th>
</tr>
<tr>
<td>3.0</td>
<td>August 5, 2025</td>
<td>· Support for 48 GT/s and 64 GT/s data rates . Runtime Recalibration enhancement · Extended reach sideband · Enhancements to enable protocols that require continuous transmission · Support for priority sideband packets · Support for Early Firmware Download · Support for Fast Throttle Emergency Shutdown · Incorporation of Errata and bug fixes over 2.0</td>
</tr>
<tr>
<td>2.0</td>
<td>$A u g u s t \quad 6 , 2 0 2 4$</td>
<td>· Chapter 6.0, UCIe-3D and related support for UCIe 3D · Chapter 8.0, System Architecture and related support for: - Section 8.1, "UCIe Manageability" - Section 8.2, "Management Transport Packet (MTP) Encapsulation" - Section 8.3, "UCIe Debug and Test Architecture (UDA)" · di/dt risk mitigation during clock gating · Incorporation of Errata and bug fixes over 1.1</td>
</tr>
<tr>
<td rowspan="2">1.1</td>
<td rowspan="2">$J u l y \quad 1 0 , 2 0 2 3$</td>
<td>· Streaming Flit Format Capabilities (Allows Streaming protocols to use Adapter Retry/CRC) · Enhanced Multi-Protocol Multiplexing (Allows dynamic multiplexing of different protocols on the same Adapter) · Support for x32 Advanced Package Modules . Support for UCIe Link Health Monitoring · Definition of Hardware capabilities to enable Compliance · di/dt risk mitigation during clock gating</td>
</tr>
<tr>
<td>· Incorporation of Errata and bug fixes over 1.0</td>
</tr>
<tr>
<td>1.0</td>
<td>February 17, 2022</td>
<td>Initial release.</td>
</tr>
</table>

## 1.0 Introduction

This chapter provides an overview of the Universal Chiplet Interconnect express (UCIe) architecture.
UCIe is an open, multi-protocol capable, on-package interconnect standard for connecting multiple
dies on the same package. The primary motivation is to enable a vibrant ecosystem supporting
disaggregated die architectures which can be interconnected using UCIe. UCIe supports multiple
protocols (PCIe, CXL, Streaming, and a raw format that can be used to map any protocol of choice as
long as both ends support it) on top of a common physical and Link layer. It encompasses the
elements needed for SoC construction such as the application layer, as well as the form-factors
relevant to the package (e.g., bump location, power delivery, thermal solution, etc.).

UCIe Manageability Architecture is an optional mechanism to manage a UCIe-based System-in-
Package (SiP) by provisioning for a common manageability architecture and hardware/software
infrastructure to be leveraged across implementations. UCIe DFx Architecture (UDA) leverages the
UCIe Manageability Architecture to provide a standardized test and debug infrastructure for a UCIe-
based SiP.

The specification is defined to ensure interoperability across a wide range of devices having different
performance characteristics. A well-defined debug and compliance mechanism is provided to ensure
interoperability. It is expected that the specification will evolve in a backward compatible manner.

While UCIe supports a wide range of usage models, some are provided here as an illustration of the
type of capability and innovation it can unleash in the compute industry. The initial protocols being
mapped to UCIe are PCIe, CXL, and Streaming. The mappings for all protocols are done using a Flit
Format, including the Raw Format. Both PCIe and CXL are widely used and these protocol mappings
will enable more on-package integration by replacing the PCIe SERDES PHY and the PCIe/CXL LogPHY
along with the Link level Retry with a UCIe Adapter and PHY to improve the power and performance
characteristics. UCIe provisions for Streaming protocols to also leverage the Link Level Retry of the
UCIe Adapter, and this can be used to provide reliable transport for protocols other than PCIe or CXL.
UCIe also supports a Raw Format that is protocol-agnostic to enable other protocols to be mapped;
while allowing usages such as integrating a standalone SERDES/transceiver tile (e.g., ethernet) on-
package. When using Raw Format, the Protocol Layer is responsible for reliable transport across the
UCIe Link.

Figure 1-1 demonstrates an SoC package composed of CPU Dies, accelerator Die(s) and I/O Tile
Die(s) connected through UCIe. The accelerator or I/O Tile can use CXL transactions over UCIe when
connected to a CPU - leveraging the I/O, coherency, and memory protocols of CXL. The I/O tile can
provide the external CXL, PCIe, and DDR pins of the package. The accelerator can also use PCIe
transactions over UCIe when connected to a CPU. The CPU to CPU connectivity on-package can also
use the UCIe interconnect, running coherency protocols.

<figure>
<figcaption>Figure 1-1. A Package Composed of CPU Dies, Accelerator Die(s), and I/O Tile Die Connected through UCIe</figcaption>

Mem

CPU

CPU

Mem

UCle

UCle

Mem

Accel-

$I / O$
Tile

$\frac { 3 } { 3 }$

erator

UCle

CXL/ PCle

DDR

</figure>

A UCIe Retimer may be used to extend the UCIe connectivity beyond the package using an Off-
Package Interconnect. Examples of Off-Package Interconnect include electrical cable or optical cable
or any other technology to connect packages at a Rack/Pod level as shown in Figure 1-2. The UCIe
specification requires the UCIe Retimer to implement the UCIe interface to the Die that it connects on
its local package and ensure that the Flits are delivered to the remote UCIe Die interface in the
separate package following UCIe protocol using the channel extension technology of its choice.

Figure 1-2 demonstrates a rack/pod-level disaggregation using CXL protocol. Figure 1-2a shows the
rack level view where multiple compute nodes (virtual hierarchy) from different compute chassis
connect to a CXL switch which connects to multiple CXL accelerators/Type-3 memory devices which
can be placed in one or more separate drawer. The logical view of this connectivity is shown in
Figure 1-2b, where each "host" $\left( H 1 , H 2 , \cdots \right)$ is a compute drawer. Each compute drawer connects to
the switch using an Off-Package Interconnect running CXL protocol through a UCIe Retimer, as shown
in Figure 1-2c. The switch also has co-package Retimers where the Retimer tiles connect to the main
switch die using UCIe and on the other side are the PCIe/CXL physical interconnects to connect to the
accelerators/memory devices, as shown in Figure 1-2c.

<figure>
<figcaption>Figure 1-2. UCIe enabling long-reach connectivity at Rack/Pod Level</figcaption>

Mem

(Off-Package Interconnect)

CPU

CPU

Mem

TORS
Memory/
Accelerator
000000000

H1

H2

HA

H#

UCle

Mem

UCle
CXL

Retimer

0X1

CXI

CXI

CPU

I/O
Tile

UCle

CXI

CXI

(Pooled Memory /
$\left. \mathrm { A c c e l e r a t o r D r a w e r } \right)$

CXL Switch

Compute
CPU

Standardized Fabric Manager

CXL/PČle

DDR
(Interconnects at drawer level)
(CPU Package)

x

CXL

Compute
CPU

CXL

CXL

CXL

CXL

D1

D2

D3

D4

D#

M

(Off-Package Interconnect to CXL Switch)

CPU

Compute
188

1

1

1

UCle
Retimer

UCle

UCle

HDC

HDD

Retimer

UCle (CX

Retimer

(Compute Drawer)

CXL at Rack level
connected using
any long-reach media
(Electrical Cable/Optical,
etc.) through UCle
Retimers on package

(Pooled Memory /Accelerator Drawer)

CXL Switch Die

(CXL/PCle Interconnects at
Pooled Memory/ Accelerator drawer)
(CXL Switch Package)
(2)

(a)

(b)

</figure>

UCIe permits three different packaging options: Standard Package (2D), and Advanced Package
(2.5D), and UCIe-3D. This covers the spectrum from lowest cost to best performance interconnects.

1\. Standard Package - This packaging technology is used for low cost and long reach (10 mm to
25 mm, when measured from a bump on one Die to the connecting bump of the remote Die)
interconnects using traces on organic package/substrate, while still providing significantly better
BER characteristics compared to off-package SERDES. Figure 1-3 shows an example application
using the Standard Package option. Table 1-1 shows a summary of the characteristics of the
Standard Package option with UCIe.

<figure>
<figcaption>Figure 1-3. Standard Package interface</figcaption>

Die-1

Die-0

Die-2

Package Substrate

</figure>

Table 1-1.
Characteristics of UCIe on Standard Package

<table>
<tr>
<th>Index</th>
<th>Value</th>
</tr>
<tr>
<td>Supported speeds (per Lane)</td>
<td>4 GT/s, 8 GT/s, 12 GT/s, 16 GT/s, 24 GT/s, 32 GT/s, 48 GT/s, 64 GT/s</td>
</tr>
<tr>
<td>Bump Pitch</td>
<td>100 um to 130 um</td>
</tr>
<tr>
<td>Channel reach (short reach)</td>
<td>10 mm</td>
</tr>
<tr>
<td>Channel reach (long reach)</td>
<td>25 mm</td>
</tr>
<tr>
<td rowspan="3">Raw Bit Error Rate (BER)ª</td>
<td>1E-27 ( &lt;= 8 GT/s)</td>
</tr>
<tr>
<td>$1 E - 1 5 \left( < = 4 8 \quad G T / s \quad a n d > = 1 2 \quad G T / s \right)$</td>
</tr>
<tr>
<td>1E-12 (&gt; 48 GT/s)</td>
</tr>
</table>

a. See Chapter 5.0 for details about BER characteristics.

2\. Advanced Package - This packaging technology is used for performance optimized
applications. Consequently, the channel reach is short (less than 2 mm, when measured from a
bump on one Die to the connecting bump of the remote Die) and the interconnect is expected to
be optimized for high bandwidth and low latency with best performance and power efficiency
characteristics. Figure 1-4, Figure 1-5, and Figure 1-6 show example applications using the
Advanced Package option.

Table 1-2 shows a summary of the main characteristics of the Advanced Package option.

<table>
<caption>Table 1-2. Characteristics of UCIe on Advanced Package</caption>
<tr>
<th>Index</th>
<th>Value</th>
</tr>
<tr>
<td>Supported speeds (per Lane)</td>
<td>4 GT/s, 8 GT/s, 12 GT/s, 16 GT/s, 24 GT/s, 32 GT/s, 48 GT/s, 64 GT/s</td>
</tr>
<tr>
<td>Bump pitch</td>
<td>25 um to 55 um</td>
</tr>
<tr>
<td>Channel reach</td>
<td>2 mm</td>
</tr>
<tr>
<td rowspan="3">Raw Bit Error Rate (BER)a</td>
<td>1E-27 $\left( < = 1 2 \quad G T / s \right)$</td>
</tr>
<tr>
<td>1E-15 ( &lt;= 48 GT/s and $\left. > = 1 6 \quad G T / s \right)$</td>
</tr>
<tr>
<td>1E-12 (&gt; 48 GT/s)</td>
</tr>
</table>

a. See Chapter 5.0 for details about BER characteristics.

<figure>
<figcaption>Figure 1-4. Advanced Package interface: Example 1</figcaption>

Die-1

Die-0

Die-2

Silicon Bridge
(e.g. EMIB)

Package Substrate

Silicon Bridge
(e.g. EMIB)

Figure 1-5.
Advanced Package interface: Example 2

Die-1

Die-0

Die-2

Interposer (e.g. CoWoS)

Package Substrate

Figure 1-6.
Advanced Package interface: Example 3

Die-1

Die-0

Die-2

Silicon Bridge

Fanout Organic Interposer (e.g., FOCoS-B)

Silicon Bridge

Package Substrate

</figure>

3\. UCIe-3D: This packaging technology uses a two-dimensional array of interconnect bumps for
data transmission between dies where one die is stacked on top of another. A menu of design
options are provided for vendors to develop standard building blocks.

Table 1-3 shows a summary of the main characteristics of UCIe-3D. Figure 1-7 shows an example
of UCIe-3D. See Chapter 6.0 for a detailed description of UCIe-3D.

<table>
<caption>Table 1-3. Characteristics of UCIe-3D</caption>
<tr>
<th>Index</th>
<th>Value</th>
</tr>
<tr>
<td>Supported speed (per Lane)</td>
<td>up to 4 GT/s</td>
</tr>
<tr>
<td>Bump pitch</td>
<td>&lt; 10 um (optimizedª) 10 to 25 um (functionalª)</td>
</tr>
<tr>
<td>Channel</td>
<td>3D vertical</td>
</tr>
<tr>
<td>Raw Bit Error Rate (BER)b</td>
<td>1e-27</td>
</tr>
</table>

a. Circuit Architecture is optimized for < 10 um bump pitches. 10 to 25 um are supported functionally.

b. See Chapter 6.0 for details about BER characteristics.

<figure>
<figcaption>Figure 1-7. Example of UCIe-3D</figcaption>

Face-to-Face Hybrid Bonding

TSVs

Package Substrate

C4 Bumps

</figure>

## 1.1 UCIe Components

UCIe is a layered protocol, with each layer performing a distinct set of functions. Figure 1-8 shows the
three main components of the UCIe stack and the functionality partitioning between the layers. It is
required for every component in the UCIe stack to be capable of supporting the advertised
functionality and bandwidth. Several timeouts and related errors are defined for different handshakes
and state transitions. All timeout values specified are minus 0% and plus 50% unless explicitly stated
otherwise. All timeout values must be set to the specified values after Domain Reset. All counter
values must be set to the specified values after Domain Reset.

<figure>
<figcaption>Figure 1-8. UCIe Layers and functionalities</figcaption>

Protocol Layer

Flit-aware D2D Interface (FDI)

ARB/MUX (when applicable)
CRC/Retry (when applicable)
Link State Management
Parameter Negotiation

Die-to-Die Adapter

Raw D2D Interface (RDI)

Link Training

Physical Layer

$L a n e \quad R e v e r s a l \left( w h e n \quad a p p l i c a b l e \right)$

Scrambling/De-scrambling
Sideband Initialization and Transfers
Analog Front End
Clock Forwarding

</figure>

### 1.1.1 Protocol Layer

While the Protocol Layer may be application specific, UCIe Specification provides examples of
transferring CXL or PCIe protocols over UCIe Links. The following protocols are supported in UCIe for
enabling different applications:

· PCIe from PCIe Base Specification.

· CXL from CXL Specification. Note that RCD/RCH/eRCD/eRCH are not supported.

· Streaming protocol: This offers generic modes for a user defined protocol to be transmitted using
UCIe.

· UCIe Management Transport protocolª: This is an end-to-end media independent protocol(s) for
management communication on the UCIe Management Network within the UCIe Manageability
Architecture.

For each protocol, different optimizations and associated Flit transfers are available for transfer over
UCIe. Chapter 2.0 and Chapter 3.0 cover the relevant details of different modes and Flit Formats.

a. UCIe Management Transport protocol can be encapsulated for transport over the UCIe sideband
or the UCIe mainband. Section 8.1 covers the details of this protocol. Section 8.2 covers the
details around encapsulation of this protocol over the UCIe sideband and the UCIe mainband.

### 1.1.2 Die-to-Die (D2D) Adapter

The D2D Adapter coordinates with the Protocol Layer and the Physical Layer to ensure successful data
transfer across the UCIe Link. It minimizes logic on the main data path as much as possible, thus
providing a low-latency, optimized data path for protocol Flits. When transporting CXL protocol, the
ARB/MUX functionality required for multiple simultaneous protocols is performed by the D2D Adapter.
For options where the Raw BER is more than 1e-27, a CRC and Retry scheme is provided in the UCIe
Specification for PCIe, CXL, or Streaming protocol, which is implemented in the D2D Adapter. See
Section 3.8 for Retry rules.

D2D Adapter is responsible for coordinating higher level Link state machine and bring up, protocol
options related parameter exchanges with remote Link partner, and when supported, power
management coordination with remote Link partner. Chapter 3.0 covers the relevant details for the
D2D Adapter.

### 1.1.3 Physical Layer

The Physical Layer has three sub-components as shown in Figure 1-9.

<figure>
<figcaption>Figure 1-9. Physical Layer components</figcaption>

Raw D2D Interface (RDI)

Link Training

Physical Layer

Lane Repair (when applicable)

Lane Reversal (when applicable)

Scrambling/De-scrambling

Sideband/
Global

Sideband Initialization and Transfers

$\mathrm { E l e c t r i c a l } / \mathrm { A F E } \left[ \mathrm { k } \mathrm { s l i c e s } \right]$

Analog Front End

Clock Forwarding

</figure>

The UCIe main data path on the physical bumps is organized as a group of Lanes called a Module. A
Module forms the atomic granularity for the structural design implementation of the UCIe AFE. The
number of Lanes per Module for Standard and Advanced Packages is specified in Chapter 4.0. A given
instance of Protocol Layer or D2D adapter can send data over multiple modules where bandwidth
scaling is required.

The physical Link of UCIe is composed of two types of connections:

## 1. Sideband:

This connection is used for parameter exchanges, register accesses for debug/compliance and
coordination with remote partner for Link training and management. It consists of a forwarded
clock pin and a data pin in each direction. The clock is fixed at 800 MHz regardless of the
mainband data rate. The sideband logic for the UCIe Physical Layer must be on auxiliary power
and an "always on" domain. Each module has its own set of sideband pins.

For the Advanced Package option, a redundant pair of clock and data pins in each direction is
provided for repair.

## 2. Mainband:

This connection constitutes the main data path of UCIe. It consists of a forwarded clock, a data
valid pin, a track pin, and N Lanes of data per module.

For the Advanced Package option, $N = 6 4$ (also referred to as x64) or $N = 3 2$ (also referred to as
x32) and overall four extra pins for Lane repair are provided in the bump map.

For the Standard Package option, $N = 1 6$ (also referred to as x16) or $N = 8$ (also referred to as x8)
and no extra pins for repair are provided.

The Logical Physical Layer coordinates the different functions and their relative sequencing for proper
Link bring up and management (e.g., sideband transfers, mainband training and repair, etc.).
Chapter 4.0 and Chapter 5.0 cover the details on Physical Layer operation.

### 1.1.4 Interfaces

UCIe defines the interfaces between the Physical Layer and the D2D Adapter (Raw D2D Interface),
and the D2D Adapter and the Protocol Layer (Flit-aware D2D Interface) in Chapter 10.0. A reference
list of signals is also provided to cover the interactions and rules of the Management Transport
protocol between the SoC and the UCIe Stack.

The motivation for this is two-fold:

. Allow vendors and SoC builders to easily mix and match different layers from different IP
providers at low integration cost and faster time to market. (For example, getting a Protocol Layer
to work with the D2D Adapter and Physical Layer from any different vendor that conforms to the
interface handshakes provided in the UCIe Specification.)

· Given that inter-op testing during post-silicon has greater overhead and cost associated with it, a
consistent understanding and development of Bus Functional Models (BFMs) can allow easier IP
development for this stack.

### 1.2 UCIe Configurations

This section describes the different configurations and permutations permitted for UCIe operation.

#### 1.2.1 Single Module Configuration

A single Module configuration is a x64 or x32 data interface in an Advanced Package, as shown in
Figure 1-10. A single module configuration is a x16 or a x8 data interface in a Standard Package, as
shown in Figure 1-11. A x8 Standard Package module is only permitted for a single module
configuration and is primarily provided for pre-bond test purposes. In multiple instantiations of a
single module configuration where each module has its own dedicated Adapter, they operate
independently (e.g., they could be transferring data at different data rates and widths).

<figure>
<figcaption>Figure 1-10. Single module configuration: Advanced Package</figcaption>

Die-to-Die Adapter

PHY Logic

Sideband

Electrical/AFE

x64
or
x32

Valid
Track

Sideband

FW-CLK

</figure>

<figure>
<figcaption>Figure 1-11. Single module configuration: Standard Package</figcaption>

Die-to-Die Adapter

PHY Logic

Sideband

Electrical/ AFE

1

x16
or

1

Valid
Track

Sideband

FW-CLK

×8

</figure>

#### 1.2.2 Multi-module Configurations

This specification allows for two and four module configurations. When operating with a common
Adapter, the modules in two-module and four-module configurations must operate at the same data
rate and width. Examples of two-module and four-module configurations are shown in Figure 1-12
through Figure 1-14.

<figure>
<figcaption>Figure 1-12. Two-module configuration for Standard Package</figcaption>

Die-to-Die Adapter

Multi-Module PHY Logic

PHY Logic

PHY Logic

Sideband

Electrical/ AFE

Sideband

Electrical/ AFE

I

1

I

1
Valid
Track

1

I

1

Sideband

FW-CLK

x16

Sideband

FW-CLK

x16

Valid
Track

</figure>

<figure>
<figcaption>Figure 1-13. Four-module configuration for Standard Package</figcaption>
</figure>

<table>
<tr>
<th colspan="15">Die-to-Die Adapter</th>
<th></th>
<th></th>
</tr>
<tr>
<td colspan="16">Multi-Module PHY Logic</td>
<td></td>
</tr>
<tr>
<th colspan="4">PHY Logic</th>
<th colspan="4">PHY Logic</th>
<th colspan="4">PHY Logic</th>
<th colspan="4">PHY Logic</th>
<th></th>
</tr>
<tr>
<th>Sideband</th>
<th colspan="3">Electrical/AFE</th>
<th>Sideband</th>
<th colspan="3">Electrical/ AFE</th>
<th>Sideband</th>
<th colspan="3">Electrical/ AFE</th>
<th>Sideband</th>
<th colspan="3">Electrical/ AFE</th>
<th></th>
</tr>
<tr>
<td>1 Sideband</td>
<td>FW-CLK</td>
<td>x16</td>
<td>Valid Track</td>
<td>1 Sideband</td>
<td>FW-CLK</td>
<td>x16</td>
<td>Valid Track</td>
<td>1 Sideband</td>
<td>FW-CLK</td>
<td>x16</td>
<td>Valid Track</td>
<td>Sideband</td>
<td>FW-CLK</td>
<td>x16</td>
<td>Valid Track</td>
<td></td>
</tr>
</table>

Figure 1-14. Example of a Two-module Configuration for Advanced Package

<table>
<tr>
<th colspan="8">Die-to-Die Adapter</th>
</tr>
<tr>
<th colspan="8">Multi-Module PHY Logic</th>
</tr>
<tr>
<th colspan="4">PHY Logic</th>
<th colspan="4">PHY Logic</th>
</tr>
<tr>
<td>Sideband</td>
<td colspan="3">Electrical/ AFE</td>
<td>Sideband</td>
<td></td>
<td colspan="2">$\mathrm { E l e c t r i c a l l } / \mathrm { A F E }$</td>
</tr>
<tr>
<td rowspan="2">Sideband</td>
<td rowspan="2">I I FW-CLK</td>
<td>x64 Or</td>
<td>I Valid Track</td>
<td rowspan="2">1 Sideband</td>
<td>1 FW-CLK I</td>
<td>×64 Or</td>
<td rowspan="2">Valid Track</td>
</tr>
<tr>
<td>x32</td>
<td></td>
<td></td>
<td>x32</td>
</tr>
</table>

<figure>
</figure>

#### 1.2.3 Sideband-only Configurations

A Standard Package UCIe sideband-only configuration is permitted for test or manageability
purposes. This can be a one, two, or four sideband-only ports as part of the same UCIe sideband-only
Link. Figure 1-15, Figure 1-16, and Figure 1-17 show examples of these configurations. See
Section 5.7.4 for more details.

<figure>
<figcaption>Figure 1-15. One-port Sideband-only Link</figcaption>

PHY Logic

Sideband

Sideband

</figure>

<figure>
<figcaption>Figure 1-16. Two-port Sideband-only Link</figcaption>

PHY Logic

Sideband

Sideband

Sideband

</figure>

<figure>
<figcaption>Figure 1-17. Four-port Sideband-only Link</figcaption>

PHY Logic

Sideband

Sideband

Sideband

Sideband

Sideband

</figure>

### 1.3 UCIe Retimers

As described previously, UCIe Retimers are used to enable different types of Off Package
Interconnects to extend the channel reach between two UCIe Dies on different packages. Each UCIe
Retimer has a local UCIe Link connection to a UCIe die on-package as well as an external connection
for longer reach. Figure 1-18 shows a high level block diagram demonstrating a system utilizing UCIe
Retimers to enable an Off Package Interconnect between UCIe Die 0 and UCIe Die 1. UCIe Retimer 0
and UCIe Die 0 are connected through UCIe Link 0 within Package 0. UCIe Retimer 1 and UCIe Die 1
are connected through UCIe Link 1 within Package 1. The terminology of "remote Retimer partner" is
used to reference the UCIe Retimer die connected to the far side of the Off Package Interconnect.

<figure>
<figcaption>Figure 1-18. Block Diagram for UCIe Retimer Connection</figcaption>

Package 0

Package 1

SB

Retimer
Receiver Buffer

SB

UCIe Link 0

Off Package
Interconnect

UCIe Link 1

UCIe Die 0

Retimer
Receiver Buffer

UCIe Retimer 0

UCIe Retimer 1

UCIe Die 1

</figure>

The responsibility of a UCIe Retimer include:

· Reliable Flit transfer across the Off Package Interconnect. Three options are available for
achieving this as described below:

\- The Retimer is permitted to use the FEC and CRC natively defined by the underlying
specification of the protocol it carries (e.g., PCIe or CXL) as long as the external interconnect
conforms to the underlying error model (e.g., BER and error correlation) of the specification
corresponding to the protocol it transports. The UCIe Links would be setup to utilize the Raw
Format to tunnel native bits of the protocol it transports (e.g., PCIe or CXL Flits). In this
scenario, the queue sizes (Protocol Layer buffers) must be adjusted on the UCIe Dies to meet
the underlying round trip latency.

\- The Retimer is permitted to provide the necessary FEC, CRC and Retry capabilities to handle
the BER of the Off Package Interconnect. In this case, the Flits undergo three independent
Links; each UCIe Retimer performs an independent ACK/NAK for Retry with the UCIe die
within its package and a separate independent ACK/NAK for Retry with the remote Retimer

partner. For this scenario, protocols are permitted to use any of the applicable Flit Formats for
transport over the UCIe Link.

\- The Retimer provides its own FEC by replacing the native PCIe or CXL defined FEC with its
own, or adding its FEC in addition to the native PCIe or CXL defined FEC, but takes advantage
of the built in CRC and Replay mechanisms of the underlying protocol. In this scenario, the
queue sizes (Protocol Layer buffers, Retry buffers) must be adjusted on the UCIe Dies to meet
the underlying round trip latency.

· Resolution of Link and Protocol Parameters with remote Retimer partner to ensure interoperability
between UCIe Dies end-to-end (E2E). For example, Retimers are permitted to force the same Link
width, speed, protocol (including any relevant protocol specific parameters) and Flit Formats on
both Package 0 and Package 1 in Figure 1-18. The specific mechanism of resolution including
message transfer for parameter exchanges across the Off Package Interconnect is
implementation specific for the Retimers and they must ensure a consistent operational mode
taking into account their own capabilities along with the UCIe Die capabilities on both Package 0
and Package 1. However, for robustness of the UCIe Links to avoid unnecessary timeouts in case
the external interconnect requires a longer time to Link up or resolution of parameters with
remote Retimer partner, UCIe Specification defines a "Stall" response to the relevant sideband
messages that can potentially get delayed. The Retimers must respond with the "Stall" response
within the rules of UCIe Specification to avoid such unnecessary timeouts while waiting for, or
negotiating with remote Retimer partner. It is the responsibility of the Retimer to ensure the UCIe
Link is not stalled indefinitely.

. Resolution of Link States for Adapter Link State Machine (LSM) or the RDI states with remote
Retimer partner to ensure correct E2E operation. See Chapter 3.0 for more details.

· Flow control and back-pressure:

\- Data transmitted from a UCIe Die to a UCIe Retimer is flow-controlled using credits. These
credits are on top of any underlying protocol credit mechanism (such as PH, PD credits in
PCIe). These UCIe D2D credits must be for flow control across the two UCIe Retimers and any
data transmitted to the UCIe Retimer must eventually be consumed by the remote UCIe die
without any other dependency. Every UCIe Retimer must implement a Receiver Buffer for Flits
that it receives from the UCIe die within its package. The Receiver buffer credits are
advertised to the UCIe die during initial parameter exchanges for the D2D Adapter, and the
UCIe die must not send any data to the UCIe Retimer if it does not have a credit for it. One
credit corresponds to 256B of data (including any FEC, CRC, etc.). Credit returns are
overloaded on the Valid framing (see Section 4.1.2). Credit counters at the UCIe Die are re-
assigned to their initial advertised value whenever RDI states transition away from Active.
UCIe Retimer must drain or dump (as applicable) the data in its receiver buffer before re-
entering Active state.

\- Data transmitted from a UCIe Retimer to a UCIe die is not flow-controlled at the D2D adapter
level. The UCIe Retimer may have its independent flow-control with the other UCIe Retimer if
needed, which is beyond the scope of this specification.

### 1.4 UCIe Key Performance Targets

Table 1-4 gives a summary of the performance targets for UCIe Advanced and Standard Package
configurations. Table 1-5 gives a summary of the performance targets for UCIe-3D.

<table>
<caption>Table 1-4. UCIe 2D and 2.5D Key Performance Targets</caption>
<tr>
<th>Metric</th>
<th>Link Speed/ Voltage</th>
<th>Advanced Package (x64)</th>
<th>Standard Package</th>
</tr>
<tr>
<td rowspan="8">Die Edge Bandwidth Densityª (GB/s per mm)</td>
<td>4 GT/s</td>
<td>165</td>
<td>28</td>
</tr>
<tr>
<td>$8 \quad G T / s$</td>
<td>329</td>
<td>56</td>
</tr>
<tr>
<td>12 GT/s</td>
<td>494</td>
<td>84</td>
</tr>
<tr>
<td>$1 6 \quad G T / s$</td>
<td>658</td>
<td>112</td>
</tr>
<tr>
<td>24 GT/s</td>
<td>988</td>
<td>168</td>
</tr>
<tr>
<td>32 GT/s</td>
<td>1317</td>
<td>224</td>
</tr>
<tr>
<td>48 GT/s</td>
<td>$1 9 7 5$</td>
<td>278b</td>
</tr>
<tr>
<td>64 GT/s</td>
<td>2634</td>
<td>370b</td>
</tr>
<tr>
<td rowspan="6">Energy Efficiencyc (pJ/bit)</td>
<td rowspan="3">{ 0 . 7 V }<br>{ \text { \left(Supply voltage } }</td>
<td>$0 . 5 \left( < = 1 2 \quad G T / s \right)$</td>
<td>$0 . 5 \left( 4 \quad G T / s \right)$</td>
</tr>
<tr>
<td>$0 . 6 \left( > = 1 6 \quad G T / s \right)$</td>
<td>1.0 $\left( < = 1 6 \quad G T / s \right)$</td>
</tr>
<tr>
<td>-</td>
<td>$1 . 2 5 \left( > = 2 4 \quad G T / s \right)$</td>
</tr>
<tr>
<td rowspan="3">{ 0 . 5 V }<br>{ \text { \left(Supply Voltage } }</td>
<td>$0 . 2 5 \left( < = 1 2 \quad G T / s \right)$</td>
<td>$0 . 5 \left( < = 1 6 \quad G T / s \right)$</td>
</tr>
<tr>
<td>$0 . 3 \left( > = 1 6 \quad G T / s \right.$ $\mathrm { a n d } < = 3 2$</td>
<td rowspan="2">$0 . 7 5 \left( > = 3 2 \quad G T / s \right)$</td>
</tr>
<tr>
<td>$0 . 5 \left( > = 4 8 \quad G T / s \right)$</td>
</tr>
<tr>
<td>$\text { Latency Target } ^ { 0 }$</td>
<td></td>
<td>$< = 2 n s$</td>
<td></td>
</tr>
</table>

a. Die edge bandwidth density is defined as total I/O bandwidth in GB per sec per mm silicon die edge, with 45-
um (Advanced Package) and 110-um (Standard Package) bump pitch. For a x32 Advanced Package module,
the Die Edge Bandwidth Density is 50% of the corresponding value for

b. Die edge bandwidth density for Standard Package at 48 GT/s and 64 $G T / s \quad i s \quad l e s s \quad t h a n \quad 2 x \quad o f \quad t h a t \quad a t \quad 2 4 \quad G T / s$
and 32 GT/s, respectively. This is because of increased die edge to improve
rates. Future revisions of the specification will look at addressing this.

c. Energy Efficiency (energy consumed per bit to traverse from FDI to bump and back to FDI) includes all the
Adapter and Physical Layer-related circuitry including, but not limited to, Tx, Rx, PLL, Clock Distribution, etc.
Channel reach and termination are discussed in Chapter 5.0.

d. Latency includes the latency of the Adapter and the Physical Layer (FDI to bump delay) on Tx and Rx. See
Chapter 5.0 for details of Physical Layer latency. Latency target is based on 16 GT/s. Latency at other data
rates may differ due to data rate-dependent aspects such as data accumulation and transfer time. Note that
the latency target does not include the accumulation of bits required for processing; either within or across
Flits.

<table>
<caption>Table 1-5. UCIe-3D Key Performance Targets</caption>
<tr>
<th>Metric</th>
<th>Link Speed/Voltage</th>
<th>UCIe-3D</th>
</tr>
<tr>
<td></td>
<td>4 GT/s</td>
<td>4000</td>
</tr>
<tr>
<td>{ \left. \text { \left(GB/s/mm } ^ { 2 } \right) }<br>{ \text { Energy Efficiency^{b } } }<br>{ \text { \left(pJ/bit\right) } }</td>
<td>0.65 V (Supply Voltage)</td>
<td>0.05</td>
</tr>
<tr>
<td>Latency Targetc</td>
<td></td>
<td>$< = 1 2 5 \quad p s$</td>
</tr>
</table>

a. Bandwidth Density is provided for a 9-um bump pitch.

b. Energy Efficiency (energy consumed per bit) includes all the Tx, Rx, PLL, Clock Distribution, etc.

c. Latency includes the latency on Tx and Rx.

## 1.5 Interoperability

Package designers need to ensure that Dies that are connected on a package can inter-operate. This
includes compatible package interconnect (e.g., Advanced vs. Standard), protocols, voltage levels,
etc. It is strongly recommended that a Die adopts Transmitter voltage of less than 0.85 V so that the
Die can inter-operate with a wide range of process nodes in the foreseeable future.

This specification comprehends interoperability across a wide range of bump pitch for Advanced
Packaging options. It is expected that over time, the smaller bump pitches will be predominantly
used. With smaller bump pitch, we expect designs will reduce the maximum advertised data rate
(even though they can go to 64 GT/s) to optimize for area and to address the power delivery and
thermal constraints of high bandwidth with reduced area. Table 1-6 summarizes these bump pitches
across four groups. Interoperability is guaranteed within each group as well as across groups, based
on the PHY dimension specified in Chapter 5.0. The performance targets provided in Table 1-4 are
with the 45 um bump pitch.

<table>
<caption>Table 1-6. Groups for Different Advanced Package Bump Pitches</caption>
<tr>
<th>Bump Pitch (um)</th>
<th>Minimum Data Rate (GT/s)</th>
<th>Expected Maximum Data Rate (GT/s)</th>
</tr>
<tr>
<td>Group 1: 25 - 30</td>
<td>4</td>
<td>24</td>
</tr>
<tr>
<td>Group 2: 31 - 37</td>
<td>4</td>
<td>32</td>
</tr>
<tr>
<td>Group 3: 38 - 44</td>
<td>4</td>
<td>48</td>
</tr>
<tr>
<td>Group 4: 45 - 55</td>
<td>4</td>
<td>64</td>
</tr>
</table>

Interoperability between Standard Package implementations of different die edge measurements
(e.g., a maximum data rate of 64 GT/s implementation connected to a maximum data rate of
32 GT/s implementation) will require a minimum die gap in the package to ensure that there is
sufficient space for the individual Lane connections to adjust for the die edge differences.

## 2.0 Protocol Layer

Universal Chiplet Interconnect express (UCIe) maps PCIe and CXL, as well as any Streaming protocol.
Throughout the UCIe Specification, Protocol-related features are kept separate from Flit Formats and
packetization. This is because UCIe provides different transport mechanisms that are not necessarily
tied to protocol features (e.g., PCIe non-Flit mode packets are transported using CXL.io 68B Flit
Format). Protocol features include the definitions of Transaction Layer and higher layers, as well as
Link Layer features not related to Flit packing/Retry (e.g., Flow Control negotiations etc.).

The following terminology is used throughout this specification to identify Protocol-level features:

· PCIe Flit mode: To reference Flit mode-related Protocol features defined in PCIe Base Specification

· PCIe non-Flit mode: To reference non-Flit mode-related Protocol features defined in PCIe Base
Specification

· CXL 68B Flit mode: To reference 68B Flit mode-related Protocol features defined in CXL
Specification

· CXL 256B Flit mode: To reference 256B Flit mode-related Protocol features defined in $C X L$
Specification

The following protocol mappings are supported over the UCIe mainband:

· PCIe Flit mode

· CXL 68B Flit mode, CXL 256B Flit Mode: If CXL is negotiated, each of CXL.io, CXL.cache, and
CXL.mem protocols are negotiated independently.

· Streaming protocol: This offers generic modes for a user defined protocol to be transmitted using
UCIe.

· Management Transport protocol: This allows transport of manageability packets.

Note:
RCD/RCH/eRCD/eRCH are not supported. PCIe non-Flit Mode is supported using CXL.io
68B Flit Format as the transport mechanism.

The Protocol Layer requirements for interoperability for PCIe and CXL are as follows:

· CXL 68B Flit Mode and PCIe Non-Flit Mode are not supported if the negotiated maximum data rate
(see Section 4.5.3.3.1 to see how the maximum data rate is negotiated) is greater than
32 GT/s.

. A Protocol Layer must support PCIe non-Flit mode if it is advertising the 68B Flit Mode parameter
from Table 3-1.

. If a Protocol Layer supports CXL 256B Flit Mode, it must support PCIe Flit Mode. If a Protocol
Layer supports CXL 256B Flit Mode and the negotiated maximum data rate is less than or equal to
32 GT/s, that Protocol Layer must also support 68B Flit Mode.

. A Protocol Layer advertising CXL is permitted to only support CXL 68B Flit Mode without
supporting CXL 256B Flit Mode or PCIe Flit Mode. If so, the UCIe Link must not negotiate a
maximum data rate greater than 32 GT/s with its remote Link partner.

# IMPLEMENTATION NOTE

$T a b l e \quad 2 - 1$ summarizes the mapping of the above rules from a specification version to a protocol
mode.

<table>
<caption>Table 2-1. Specification to Protocol Mode Requirements</caption>
<tr>
<th>Native Specification Supportedª</th>
<th>Negotiated Maximum Data Rate</th>
<th>PCIe Non-Flit Mode</th>
<th>CXL 68B Flit Mode</th>
<th>CXL 256B Flit Mode</th>
<th>PCIe Flit Mode</th>
</tr>
<tr>
<td rowspan="2">PCIe</td>
<td>&lt;= 32 GT/s</td>
<td>Mandatory</td>
<td>N/A</td>
<td>N/A</td>
<td>Optional</td>
</tr>
<tr>
<td>&gt; 32 GT/s</td>
<td>Not Supported</td>
<td>N/A</td>
<td>N/A</td>
<td>Mandatory</td>
</tr>
<tr>
<td rowspan="2">$\csc 2 . 0$</td>
<td>&lt;= 32 GT/s</td>
<td>Mandatory (for CXL.io)</td>
<td>Mandatory</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr>
<td>&gt; 32 GT/s</td>
<td>Not Supported</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="2">CXL 3.0</td>
<td>&lt;= 32 GT/s</td>
<td>Mandatory (for CXL.io)</td>
<td>Mandatory</td>
<td>Mandatory</td>
<td>Mandatory (for CXL.io)</td>
</tr>
<tr>
<td>&gt; 32 GT/s</td>
<td>Not Supported</td>
<td></td>
<td>Mandatory</td>
<td>{ \text { Mandatory } }<br>{ \text { \left(for cXL.io } }</td>
</tr>
</table>

a. The same table applies to derivative version numbers for the specifications.

The Die-to-Die (D2D) Adapter negotiates the protocol with the remote Link partner and
communicates it to the Protocol Layer(s). For each protocol, UCIe supports multiple modes of
operation (that must be negotiated with the remote Link partner depending on the advertised
capabilities, Physical Layer Status as well as usage models). These modes have different Flit Formats
and are defined to enable different trade-offs around efficiency, bandwidth and interoperability. The
spectrum of supported protocols, advertised modes and Flit Formats must be determined at SoC
integration time or during the Die-specific reset bring up flow. The Die-to-Die Adapter uses this
information to negotiate the operational mode as a part of Link Training and informs the Protocol
Layer over the Flit-aware Die-to-Die Interface (FDI). See Section 3.2 for parameter exchange rules in
the Adapter.

The subsequent sections provide an overview of the different modes from the Protocol Layer's
perspective, hence they cover the supported formats of operation as subsections per protocol. The
Protocol Layer is responsible for transmitting data over FDI in accordance with the negotiated mode
and Flit Format. The illustrations of the Flit Formats in this chapter show an example configuration of
a 64B data path in the Protocol Layer mapped to a 64-Lane module of Advanced Package
configuration on the Physical Link of UCIe. Certain Flit Formats have dedicated bit positions filled in by
the Adapter, and details associated with these are illustrated separately in Chapter 3.0. For other Link
widths, see the Byte to Lane mappings defined in Section 4.1.1. Figure 2-1 shows the legend for
color-coding convention used when showing bytes within a Flit in the Flit Format examples in the UCIe
Specification.

<table>
<caption>Figure 2-1. Color-coding Convention in Flit Format Byte Map Figures</caption>
<tr>
<th>Color Shading</th>
<th>Description</th>
</tr>
<tr>
<td></td>
<td>Some bits populated by the Protocol Layer, some bits populated by the Adapter.</td>
</tr>
<tr>
<td></td>
<td>All bits populated by Adapter.</td>
</tr>
<tr>
<td></td>
<td>All bits populated by the Protocol Layer.</td>
</tr>
</table>

## 2.1 PCIe

UCIe supports the Flit Mode defined in PCIe Base Specification. See PCIe Base Specification for the
protocol definition. UCIe supports the non-Flit Mode using the CXL.io 68B Flit Formats as the transport
mechanism. There are five UCIe operating formats supported for PCIe, and these are defined in the
subsections that follow.

### 2.1.1 Raw Format

This format is optional. All bytes are populated by the Protocol Layer. The intended usage is for UCIe
Retimers transporting PCIe protocol. An example usage of this format is where a CPU and an I/O
Device are in different Rack/chassis and connected through a UCIe Retimer using Off-Package
Interconnect as shown in Figure 1-2. Retry, CRC and FEC (if applicable) are taken care of by the
Protocol Layer when using Raw Format. It is strongly recommended for the UCIe Retimers to check
and count errors using either the parity bits of the 6B FEC or the Flit Mode 8B CRC defined in PCIe
Base Specification for this mode to help characterize the Off Package Interconnect (to characterize or
debug the Link that is the dominant source of errors). See Section 3.3.1 as well.

### 2.1.2 Standard 256B End Header Flit Format

This format is mandatory when PCIe Flit Mode protocol is supported. It is the standard Flit Format
defined in PCIe Base Specification for Flit Mode and the main motivation of supporting this Flit Format
is to enable interoperability with vendors that only support the standard PCIe Flit Formats. The
Protocol Layer must follow the Flit Formats for Flit transfer on FDI, driving 0 on the fields reserved for
Die-to-Die Adapter. The PM and Link Management DLLPs are not used over UCIe. The other DLLPs
(that are applicable for PCIe Flit Mode) and Flit Status definitions follow the same rules including
packing as defined in PCIe Base Specification. It is strongly recommended for implementations to
optimize out any 8b/10b, 128b/130b, and non-Flit Mode related CRC/Retry or framing logic from the
Protocol Layer in order to obtain area and power efficient designs for UCIe applications. Portions of
the DLP bytes must be driven by the Protocol Layer for Flit_Marker assignment; see Section 3.3.3 for
details of the Flit Format.

### 2.1.3 68B Flit Format

This mode is mandatory when PCIe protocol or CXL protocol is supported and the negotiated
maximum data rate is <= 32 GT/s. The transport mechanism for this is the same as CXL.io 68B Flit
Formats. See Section 2.3.2 for the CXL.io DLLP rules that apply for Non-Flit Mode for PCIe as well. It
is strongly recommended for implementations to optimize out any 8b/10b, 128b/130b and non-Flit
Mode related CRC/Retry logic from the Protocol Layer in order to obtain area and power efficient
designs for UCIe applications. To keep the framing rules consistent, Protocol Layer for PCIe non-Flit
mode must still drive the LCRC bytes with a fixed value of 0, and the Receiver must ignore these
bytes and never send any Ack or Nak DLLPs. Framing tokens are applied as defined for CXL.io 68B Flit
Mode operation in CXL Specification. It is recommended for the transmitter to drive the sequence
number, DLLP CRC, Frame CRC and Frame parity in STP to 0; the receiver must ignore these fields.
Given that UCIe Adapter provides reliable Flit transport, framing errors, if detected by the Protocol
Layer, are likely due to uncorrectable internal errors and it is permitted to treat them as such.

### 2.1.4 Standard 256B Start Header Flit Format

This is an optional format for PCIe Flit Mode, supported if Standard Start Header for PCIe protocol
Capability is supported. The Protocol Layer must follow the Flit Formats for Flit transfer on FDI, driving
0 on the fields reserved for Die-to-Die Adapter. The PM and Link Management DLLPs are not used over
UCIe. The other DLLPs (that are applicable for PCIe Flit Mode) and Flit Status definitions follow the
same rules including packing as defined in PCIe Base Specification. It is strongly recommended for

implementations to optimize out any 8b/10b, 128b/130b and non-Flit Mode related CRC/Retry or
framing logic from the Protocol Layer in order to obtain area and power efficient designs for UCIe
applications. Portions of the DLP bytes must be driven by the Protocol Layer for Flit_Marker
assignment; see Section 3.3.3 for details of the Flit Format.

### 2.1.5 Latency-Optimized 256B with Optional Bytes Flit Format

This is an optional format for PCIe Flit Mode, supported if Latency-Optimized Flit with Optional Bytes
for PCIe protocol capability is supported. It is the Latency-Optimized Flit with Optional Bytes Flit
Format for PCIe, as defined in Section 3.3.4. The Protocol Layer must follow the Flit Formats for Flit
transfer on FDI, driving 0 on the fields reserved for Die-to-Die Adapter. The PM and Link Management
DLLPs are not used over UCIe. The other DLLPs (that are applicable for PCIe Flit Mode) and Flit Status
definitions follow the same rules including packing as defined in PCIe Base Specification. It is strongly
recommended for implementations to optimize out any 8b/10b, 128b/130b and non-Flit Mode related
CRC/Retry or framing logic from the Protocol Layer in order to obtain area and power efficient designs
for UCIe applications. Portions of the DLP bytes must be driven by the Protocol Layer for Flit_Marker
assignment; see Section 3.3.4 for details of the Flit Format.

## 2.2 CXL 256B Flit Mode

See CXL Specification for details on the protocol layer messages and slot formats for "CXL 256B Flit
Mode". There are four possible operational formats for this protocol mode (there are two formats in
Section 2.2.3), defined in the subsections that follow. The light orange bytes are inserted by the
Adapter (see Figure 2-1). In cases where these are shown as part of the main data path (e.g., in the
Standard 256B Flit Format), the Protocol Layer must drive 0 on them on the Transmitter, and ignore
them on the Receiver.

### 2.2.1 Raw Format

This format is optional. All bytes are populated by the Protocol Layer. The intended usage is for UCIe
Retimers transporting CXL 256B Flit Mode protocol. An example usage of this format is where a CPU
and an I/O Device are in different Rack/chassis and connected through a UCIe Retimer using Off-
Package Interconnect. Retry, CRC and FEC are taken care of by the Protocol Layer. It is strongly
recommended for the UCIe Retimers to check and count errors using either the parity bits of the 6B
FEC or the Flit Mode 8B CRC or 6B CRC; depending on which Flit Format was enabled. This helps to
characterize and debug the Off-Package Interconnect which is the dominant source of errors. For
CXL.cachemem, Viral or poison containment (if applicable) must be handled within the Protocol Layer
for this format. See Section 3.3.1 as well.

### 2.2.2 Latency-Optimized 256B Flit Formats

The support for this format is strongly recommended for "CXL 256B Flit Mode" over UCIe. Two Flit
Formats are defined, which provide two independent operating points. These formats are derived
from the Latency-Optimized Flits defined in CXL Specification. The only difference for the second Flit
Format is that it gives higher Flit packing efficiency by providing Protocol Layer with extra bytes. For
CXL.io this results in extra 4B of TLP information, and for CXL.cachemem it results in an extra 14B H-
slot that can be packed in the Flit. This slot is ordered between Slots 7 and 8. It is included in both
Groups B and C, similar to Slot 7. See CXL Specification for reference of the packing rules. Support for
the first or second format is negotiated at the time of Link bring up. See Section 3.3.4 for the details
for the Flit Formats.

The Latency-Optimized formats enable the Protocol Layer to consume the Flit at 128B boundary,
reducing the accumulation latency significantly. When this format is negotiated, the Protocol Layer

must follow this Flit Format for Flit transfer on FDI, driving 0 on the fields reserved for Die-to-Die
Adapter.

The Ack, Nak, PM, and Link Management DLLPs are not used over UCIe for CXL.io for any of the 256B
Flit Modes. The other DLLPs and Flit_Marker definitions follow the same rules as defined in CXL
Specification. Portions of the DLP bytes must be driven by the Protocol Layer for Flit_Marker
assignment; see Section 3.3.3 for details on how DLP bytes are driven.

For CXL.cachemem for this mode, FDI provides an lp_corrupt_crc signal to help optimize for
latency while guaranteeing Viral containment. See Chapter 10.0 for details of interface rules for Viral
containment.

### 2.2.3 Standard 256B Start Header Flit Format

This format is mandatory when "CXL 256B Flit Mode" protocol is supported. It is the Standard 256B
Flit Format defined in CXL Specification for 256B Flit Mode and the main motivation of supporting this
Flit Format is to enable interoperability with vendors that only support the Standard 256B Flit
Formats. The Protocol Layer must follow the Flit Formats for Flit transfer on FDI, driving 0 on the
fields reserved for Die-to-Die Adapter. The Ack, Nak, PM, and Link Management DLLPs are not used
over UCIe for CXL.io. The other DLLPs and Flit Status definitions follow the same rules and packing as
defined in CXL Specification. Portions of the DLP bytes must be driven by the Protocol Layer for
Flit_Marker assignment; see Section 3.3.3 for details of the Flit Formats and on how DLP bytes are
driven.

For CXL.cachemem in this format, FDI provides an lp_corrupt_crc signal to help optimize for
latency while guaranteeing Viral containment. See Section 10.2 for details of interface rules for Viral
containment.

See Section 3.3.3 for details about this Flit Format.

## 2.3 CXL 68B Flit Mode

The CXL Specification provides details on the protocol layer messages and slot formats for CXL 68B
Flit Mode. There are two operational formats possible for this protocol, and these are defined in the
subsections that follow. The light orange bytes are inserted by the Adapter (see Figure 2-1). This
protocol is not supported if the negotiated maximum data rate is > 32 GT/s.

### 2.3.1 Raw Format

This format is optional. All bytes are populated by the Protocol Layer. The intended usage is for UCIe
Retimers transporting "CXL 68B Flit Mode" protocol. An example usage of this format is where a CPU
and an I/O Device are in different Rack/chassis and connected through a UCIe Retimer using an Off-
Package Interconnect. Retry and CRC are taken care of by the Protocol Layer. See Section 3.3.1 as
well.

### 2.3.2 68B Flit Format

This format is mandatory when CXL 68B Flit Mode protocol is negotiated and the negotiated maximum
data rate is <= 32 GT/s. When supported, this follows the corresponding 68B Flit Format defined in
CXL Specification and the main motivation of supporting this Flit Format is to enable interoperability
with vendors that only support the baseline CXL formats. The Protocol Layer presents 64B of the Flit
(excluding the Protocol ID and CRC) on FDI (shown in Figure 2-2), and the Die-to-Die Adapter inserts
a 2B Flit Header and 2B CRC and performs the byte shifting required to arrange the Flits in the format
shown in Figure 3-11.

The Ack, Nak, and PM DLLPs are not used for CXL.io in this mode. Credit updates and other remaining
DLLPs for CXL.io are transmitted in the Flits as defined in CXL Specification. For CXL.io, the
Transmitter must not implement Retry in the Protocol Layer (because Retry is handled in the
Adapter). To keep the framing rules consistent, Protocol Layer for CXL.io must still drive the LCRC
bytes with a fixed value of 0, and the Receiver must ignore these bytes and never send any Ack or
Nak DLLPs. Framing tokens are applied as defined for CXL.io 68B Flit Mode operation. It is
recommended for the transmitter to drive the sequence number, DLLP CRC, Frame CRC and Frame
parity in STP to 0. The receiver must ignore these fields. Given that UCIe Adapter provides reliable Flit
transport, framing errors, if detected by the Protocol Layer are likely due to uncorrectable internal
errors and it is permitted to treat them as such.

For CXL.cachemem, the "Ak" field defined by CXL Specification in the Flit is reserved, and the Retry
Flits are not used (because Retry is handled in the Adapter). Link Initialization begins with sending the
INIT.Param Flit without waiting for any received Flits. Viral containment (if applicable) must be
handled within the Protocol Layer for the 68B Flit Mode. CXL Specification introduced Error Isolation
as a way to reduce the blast radius of downstream component fatal errors compared to CXL Viral
Handling and provide a scalable way to handle device failures across a network of switches shared
between multiple Hosts. Specifically, Viral relies on a complete host reset to recover whereas Error
Isolation may recover by resetting the virtual hierarchy below the root port. Because CXL-defined
Retry Flits (which carry the viral notification for 68B Flits in CXL) are not used in 68B Flit mode in
UCIe, it is recommended for implementations to rely on error isolation at the CXL Root Port for fatal
errors on CXL.cachemem downstream components in 68B Flit mode (similar to Downstream Port
Containment for CXL.io).

Figure 2-2. 68B Flit Format on FDIª

+0

Byte 0

64B (from Protocol Layer)
$+ 6 3$

a. See Figure 2-1 for color mapping.

# 2.4 Streaming Protocol

This is the default protocol that must be advertised if none of the PCIe or CXL protocols are going to
be advertised and negotiated with the remote Link partner. If Streaming Flit Format capability is not
supported, then the operational formats that can be used are either Raw Format or vendor defined
extensions. Streaming Flit Format capability is supported if any of 68B Flit Format for Streaming
Protocol, Standard 256B End Header Flit Format for Streaming Protocol, Standard 256B Start Header
Flit Format for Streaming Protocol, Latency-Optimized 256B Flit Format without Optional Bytes for
Streaming Protocol or Latency-Optimized 256B Flit Format with Optional Bytes for Streaming Protocol
bits are set in the UCIe Link Capability register.

## 2.4.1 Raw Format

This is mandatory for Streaming protocol support in Adapter implementations. Protocol Layer
interoperability is vendor defined. All bytes are populated by the Protocol Layer. See Section 3.3.1 as
well.

## 2.4.2 68B Flit Format

This format is only applicable if Streaming Flit Format capability is supported. When the negotiated
maximum data rate is <= 32 GT/s, it is an optional format that permits implementations to utilize the
68B Flit Format from the Adapter for Streaming protocols. This format is not supported when the
negotiated maximum data rate $i s > 3 2 \quad G T / s .$ See Section 3.3.2 for details of the Flit Format.

The Protocol Layer presents 64B per Flit on FDI, and the Die-to-Die Adapter inserts a 2B Flit Header
and 2B CRC and performs the byte shifting required to arrange the Flits in the format shown in
Figure 3-11. On the receive data path, the Adapter strips out the Flit Header and CRC bytes to only
present the 64B per Flit to the Protocol Layer on FDI.

## 2.4.3 Standard 256B Flit Formats

This format is only applicable if Streaming Flit Format capability is supported. Implementations are
permitted to utilize the Standard 256B Start Header Flit Format or Standard 256B End Header Flit
Format from the Adapter for Streaming protocols. See Section 3.3.3 for details of the Flit Format and
to see which of the reserved fields in the Flit Header are driven by the Protocol Layer. The Protocol
Layer presents 256B per Flit on FDI, driving 0b on the bits reserved for the Adapter. The Adapter fills
in the applicable Flit Header and CRC bytes. On the Rx datapath, the Adapter forwards the Flit
received from the Link as it is, and the Protocol Layer must ignore the bits reserved for the Adapter
(for example the CRC bits).

## 2.4.4 Latency-Optimized 256B Flit Formats

This format is applicable only when Streaming Flit Format capability is supported. Implementations
are permitted to utilize the Latency-Optimized 256B with Optional Bytes Flit Format or Latency-
Optimized 256B without Optional Bytes Flit Format for Streaming protocols. See Section 3.3.4 for
details of the Flit Format and to see which of the reserved fields in the Flit Header are driven by the
Protocol Layer. The Protocol Layer presents 256B per Flit on FDI, driving 0b on the bits reserved for
the Adapter. The Adapter fills in the applicable Flit Header and CRC bytes. On the Rx datapath, the
Adapter forwards the Flit received from the Link as is, and the Protocol Layer must ignore the bits
reserved for the Adapter (e.g., the CRC bits).

## 2.5 Management Transport Protocol

This protocol is used to carry management network packets over the mainband. The format for these
packets is shown in Section 8.2.2.2. The 68B Flit Format is not permitted for this protocol. Raw format
and any of the 256B Flit Formats are permitted for this protocol. When using the 256B Flit Formats,
the Protocol Layer presents 256B per Flit on the FDI, driving 0 on the bits that are reserved for the
Adapter. The Adapter fills in the applicable Flit Header and CRC bytes. On the Rx data path, the
Adapter forwards the Flit received from the Link as is, and the Management Port Gateway must ignore
the bits reserved for the Adapter (e.g., the CRC bits).

See Section 8.2.5.2.3 for details of mapping the Management Transport Packets (MTPs) over
Management Flits.

### 3.0 Die-to-Die Adapter

The Die-to-Die Adapter is responsible for:

· Reliable data transfer (performing CRC computation and Retry, or parity computation when
applicable)

· Arbitration and Muxing (in case of multiple Protocol Layers)

· Link State Management

· Protocol and Parameter negotiation with the remote Link partner.

Figure 3-1 shows a high level description of the functionality of the Adapter.

<figure>
<figcaption>Figure 3-1. Functionalities in the Die-to-Die Adapter</figcaption>

Protocol Layer

Flit aware
D2D interface

(FDI)

ARB/MUX (when applicable)
CRC/Retry (when applicable)
Link State Management
Parameter Negotiation

Die-to-Die Adapter

Raw D2D interface (RDI)

Physical Layer

Sideband/
Global

Electrical/AFE [k slices]

</figure>

The Adapter interfaces to the Protocol Layer using one or more instances of the Flit-aware Die-to-Die
interface (FDI), and it interfaces to the Physical Layer using the raw Die-to-Die interface (RDI). See
Chapter 10.0 for interface details and operation.

The D2D Adapter must follow the same rules as the Protocol Layer for protocol interoperability
requirements. Figure 3-2 shows example configurations for the Protocol Layer and the Adapter, where
the Protocol identifiers (e.g., PCIe) only signify the protocol, and not the Flit Formats. To provide cost

and efficiency trade-offs, UCIe allows configurations in which two protocol stacks are multiplexed onto
the same physical Link.

#### 3.1 Stack Multiplexing

If the Multi_Protocol_Enable parameter is negotiated, two stacks multiplexed on the same physical
Link is supported when each protocol stack needs half the bandwidth that the Physical Layer provides.
Both stacks must be of the same protocol with the same protocol capabilities. When
Multi_Protocol_Enable and Management Transport protocol are negotiated for mainband and the
Protocol Layer implements the Management Port Gateway multiplexer (MPG mux), the MPG mux must
be present on both stacks and the same protocols must be present in both stacks. For example, in
Figure 8-35 the Multi_Protocol_Enable parameter can be negotiated for config b if both stacks in this
configuration have PCIe or both stacks have Streaming. Similarly, the Multi_Protocol_Enable
parameter can be negotiated for config d in Figure 8-35 if both CXL stacks are identical.

When Multi_Protocol_Enable is supported and negotiated, the Adapter must guarantee that it will not
send consecutive flits from the same protocol stack on the Link. This applies in all cases including
when Flits are sourced from FDI, from Retry Buffer, and when the data stream is paused and
restarted. Adapter is permitted to insert NOP Flits to guarantee this (these Flits bypass the Tx Retry
buffer, and are not forwarded to the Protocol Layer on the receiver). When Flits are transmitted from
the Retry Buffer, it is required to insert NOP Flits as needed to avoid sending consecutive Flits from
the same Protocol stack. When Management Transport protocol is negotiated for mainband with
Multi_Protocol_Enable, the Management Flit carries the same stack identifier as the Protocol Layer it
is multiplexed with. From the Adapter perspective, for the purposes of throttling and interleaving, it is
treated the same as flits received from the corresponding Protocol Layer. Note that there is no fixed
pattern of Flits alternating from different Protocol Layers. For example, a Flit from Protocol Stack 0
followed by a NOP Flit, followed by a Flit from Protocol Stack 0 is a valid transmit pattern. A NOP Flit
is defined as a Flit where the protocol identifier in the Flit Header corresponds to the D2D Adapter,
and the body of the Flit is filled with all 0 data (the NOP Flit is defined for all Flit Formats supported by
the Adapter, for all cases when it is operating in Raw Format). It is permitted for NOP flits to bypass
the Retry buffer, as long as the Adapter guarantees that it is not sending consecutive Flits for any of
the Protocol Layers. On the receiving side, the Adapter must not forward these NOP flits to the
Protocol Layer. The receiving Protocol Layer must be capable of receiving consecutive chunks of the
same Flit at the maximum Link speed, but it will not receive consecutive Flits. In addition to the
transfer rate, both protocol stacks must operate with the same protocol and Flit Formats.
Multi_Protocol_Enable and Raw Format are mutually exclusive. Each stack is given a single bit stack
identifier that is carried along with the Flit header for de-multiplexing of Flits on the Receiver. The
Stack Mux shown maintains independent Link state machines for each protocol stack. Link State
transition-related sideband messages have unique message codes to identify which stack's Link State
Management is affected by that message.

## IMPLEMENTATION NOTE

The primary motivation for enabling the Multi_Protocol_Enable parameter is to allow
implementations to take advantage of the higher bandwidth provided by the UCIe
Link for lower-bandwidth individual Protocol Layers, without the need to make a lot of
changes to the UCIe Link. For example, two Protocol Layers that support the
maximum bandwidth for CXL 68B Flit Mode (i.e., the equivalent of 32 GT/s CXL
SERDES bandwidth) can be multiplexed over a UCIe Link that supports their
aggregate bandwidth.

If the Enhanced Multi_Protocol_Enable parameter is negotiated, dynamic multiplexing between two
stacks of the same or different protocols on the same physical Link is supported. When Enhanced

Multi_Protocol_Enable and Management Transport protocol are negotiated, each stack can have
different protocols with or without MPG mux. For example, in Figure 8-35, the Enhanced
Multi_Protocol_Enable parameter must be negotiated for configs e, f, and h. The parameter is also
negotiated for configs b and d if the two stacks have different protocol pairs. Both protocol stacks and
the Adapter must support a common Flit Format for this feature to be enabled. "Enhanced
Multi_Protocol_Enable" and Raw Format are mutually exclusive. The Adapter must advertise the
maximum percentage of bandwidth that the receiver for each Protocol Layer can accept. The Adapter
transmitter must support 100% (no throttling) and throttling one or both Protocol Layer(s) to 50% of
maximum bandwidth. When 50% of the maximum bandwidth is advertised for a stack by an Adapter,
the remote Link partner must guarantee that it will not send consecutive Flits for the same stack on
the Link. This applies in all cases including when Flits are sourced from FDI, from Retry Buffer, and
when the data stream is paused and restarted. Adapter is permitted to insert NOP Flits to guarantee
this (these Flits bypass the Tx Retry buffer, and are not forwarded to the Protocol Layer on the
receiver). When Flits are transmitted from the Retry Buffer, it is required to insert NOP Flits as needed
to avoid exceeding the negotiated maximum bandwidth. The receiving Protocol Layer must be capable
of sinking Flits at the advertised maximum bandwidth percentage; in addition, Protocol Layer must be
able to receive consecutive chunks of the same Flit at the maximum advertised Link speed. When this
capability is supported, the Adapter must be capable of allowing each Protocol Layer to independently
utilize 100% of the Link bandwidth. Furthermore, the arbitration is per Flit, and the Adapter must
support round robin arbitration between the Protocol Layers if both of them are permitted to use
100% of the Link bandwidth. Additional implementation specific arbitration schemes are permitted as
long as they are per Flit and do not violate the maximum bandwidth percentage advertised by the
remote Adapter for a given stack. The Flit header has a single bit stack identifier to identify the
destination stack for the flit. The Stack Mux maintains independent Link state machines for each
protocol stack. Link State transition-related sideband messages have unique message codes to
identify which stack's Link State Management is affected by that message.

<figure>
<figcaption>Figure 3-2. Example Configurations</figcaption>

Protocol Layer
(PCe orStreaming )

Protocol Layer
$\left( \mathrm { C } \mathrm { M } . \mathrm { i } \mathrm { o } \right)$

Protocol Layer
$\left( \mathrm { C } \mathrm { X } . \mathrm { c a c h e } \mathrm { m e } \mathrm { m } \right)$

FDI

FDI

Die-to-Die Adapter

$A r b / M u x$
Die-to-Die Adapter

RDI

RDI

(a) Single Protocol

(b) Single CXL Stack

Pro tocol Layer
$1 0 \times 1 0$

Pro toco l Layer
(CXL.cachemem)

Pro toco l Layer
(CXL.io)

Pro toco l Layer
(CXL.cachemem)

FDI

$A r b / M u x$

Arb/Mux

Sta ck Mux

Die-to-Die Adapter

RDI

(c) Two CXL stacks multiplexed inside the adapter

Protocol
Layer A

Protocol
Layer B

FDI

Stack Mux
Die-to-Die Adapter

$R D I$

(d) Two Stacks Multiplexed with Enhanced Multi_Protocol_Enable Negotiated

</figure>

# 3.2 Link Initialization

Link Initialization consists of four stages before protocol Flit transfer can begin on mainband.
Figure 3-3 shows the high-level steps involved in the Link initialization flow for UCIe. Stage 0 is
die-specific and happens independently for each die; the corresponding boxes in Figure 3-3 are of
different sizes to denote that different die can take different amount of time to finish Stage 0. Stage 1
involves sideband initialization. Stage 2 involves mainband training and repair. Details of Stage 1 and
Stage 2 are provided in Chapter 4.0. Stage 3 involves parameter exchanges between Adapters to
negotiate the protocol and Flit Formats and is covered in Section 3.2.1.

<figure>
<figcaption>Figure 3-3. Stages of UCIe Link Initialization</figcaption>

Protocol Layer
Die 0

D2D Adapter
Die 0

Physical Layer
Die 0

D2D
CHANNEL

Physical Layer
Die 1

D2D Adapter Protocol Layer
Die 1
Die 1

Reset flow for Die 0
(independent of Die 1)
Stage 0

Reset flow for Die 1
(independent of Die 0)
Stage 0

Sideband initialization
Stage 1

Training parameter exchanges on sideband
Mainband (Lane Repair and) Training
Stage 2

Protocol parameter exchanges on sideband
Stage 3

Stage 3 Complete; Flit transfer can start

Time Progression

</figure>

## 3.2.1 Stage 3 of Link Initialization: Adapter Initialization

Stage 2 is complete when the RDI state machine moves to Active State. The initialization flow on RDI
to transition the state from Reset to Active is described in Section 10.1.6. Once Stage 2 is complete,
the Adapter must follow a sequence of steps in order to determine Local Capabilities, complete
Parameter Exchanges, and bring FDI state machine to Active.

## 3.2.1.1 Part 1: Determine Local Capabilities

The Adapter must determine the results of Physical Layer training and if Retry is needed for the given
Link speed and configuration. See Section 3.8 for the rules on when Retry must be enabled for Link
operation. If the Adapter is capable of supporting Retry, it must advertise this capability to the remote

Link partner during Parameter Exchanges. For UCIe Retimers, the Adapter must also determine the
credits to be advertised for the Retimer Receiver Buffer. Each credit corresponds to 256B of Mainband
data storage.

## 3.2.1.2 Part 2: Parameter Exchange with Remote Link Partner

The following list of capabilities must be negotiated between Link partners. The capabilities (if
enabled) are transmitted to the remote Link partner using a sideband message. In the section below,
"advertised" means that the corresponding bit is 1b in the {AdvCap.Adapter} sideband message.

<table>
<caption>Table 3-1. Capabilities that Must Be Negotiated between Link Partners (Sheet 1 of 3)</caption>
<tr>
<th>Capability</th>
<th>Description and Requirements</th>
</tr>
<tr>
<td>"Raw Format"</td>
<td>This parameter is advertised if the corresponding bit in the UCIe Link Control register is 1b. Software/ Firmware enables this based on system usage scenario. If the PCIe or CXL protocols are not supported, and Streaming protocol is to be negotiated without any vendor-specific extensions and without Streaming Flit Format capability support, "Raw Format" must be 1b and advertised. If Streaming Flit Format capability or Enhanced Multi-Protocol capability is supported, then this must be advertised as 1b only if Raw Format is the intended format of operation. Software/firmware-based control on setting the corresponding UCIe Link Control is permitted to enable this.</td>
</tr>
<tr>
<td>"68B Flit Mode"</td>
<td>This is a protocol parameter. This must be advertised if the Adapter and Protocol Layer support CXL 68B Flit mode (mandatory for CXL if the negotiated maximum data rate is &lt;= 32 GT/s) or PCIe Non- Flit mode (mandatory for PCIe if the negotiated maximum data rate is &lt;= 32 GT/s). If PCIe Non-Flit mode is the final negotiated protocol, it will use the CXL.io 68B Flit mode formats as defined in CXL Specification. This is an advertised Protocol for Stack 0 if "Enhanced Multi_Protocol_Enable" is supported and enabled. This protocol is not supported and this parameter must be 0 if the negotiated maximum data rate is &gt; 32 GT/s. Note that the negotiation of the maximum data rate occurs during MBINIT.PARAM, which is during Stage 2 of Link Initialization, before any of the Adapter capabilities are determined in Stage 3. The Adapter can use the pl_max_speedmode signal on the RDI to determine the negotiated maximum data rate.</td>
</tr>
<tr>
<td>$C X L \quad 2 5 6 B \quad F l i t \quad M o d e$</td>
<td>This is a protocol parameter. This must be advertised if the Adapter and Protocol Layer support CXL 256B Flit mode. This is an advertised Protocol for Stack 0 if Enhanced Multi-Protocol capability is supported and enabled.</td>
</tr>
<tr>
<td>"PCIe Flit Mode"</td>
<td>This is a protocol parameter. This must be advertised if the Adapter and Protocol Layer support PCIe $F l i t \quad m o d e .$ This is an advertised Protocol for Stack 0 if Enhanced Multi-Protocol capability is supported</td>
</tr>
<tr>
<td>"Streaming"</td>
<td>This is a protocol parameter. This must be advertised if the Adapter and Protocol Layer support Streaming protocol in Raw Format or Streaming Flit Format capability is supported and the corresponding capabilities are enabled. This is an advertised Protocol for Stack 0 if Enhanced Multi- Protocol capability is supported and enabled. PCIe or CXL protocol must not be advertised if Streaming is advertised for a given Protocol Layer.</td>
</tr>
<tr>
<td>"Retry"</td>
<td>This must be advertised if the Adapter supports Retry. With the exception of the Link operating in Raw Format, the Link cannot be operational if the Adapter has determined Retry is needed, but "Retry" is not advertised or negotiated. See also Section 3.8.</td>
</tr>
<tr>
<td>"Multi_Protocol_Enable"</td>
<td>This must only be advertised if the Adapter is connected to multiple FDI instances corresponding to (or SoC firmware in Stage 0 of $\left. L i n k \quad I n i t i a l i z a t i o n \right) h a s \quad d e t e r m i n e d \quad t h a t \quad t h e \quad U C I e \quad L i n k \quad m u s t \quad b e \quad o p e r a t e d \quad i n \quad t h i s \quad m o d e . B o t h$</td>
</tr>
<tr>
<td>"Stack0_Enable"</td>
<td>This must be advertised if the Protocol Layer corresponding to Stack 0 exists and is enabled for operation with support for the advertised protocols.</td>
</tr>
<tr>
<td>"Stack1_Enable"</td>
<td>This must be advertised if the Protocol Layer corresponding to Stack 1 exists and is enabled for operation with support for the advertised protocols.</td>
</tr>
<tr>
<td>"CXL_LatOpt_Fmt5"</td>
<td>This must be advertised if the Adapter and Protocol Layer support Format 5 defined in Section 3.3.4. The Protocol Layer does not take advantage of the spare bytes in this Flit Format. This must not be advertised if CXL protocol and CXL 256B Flit mode are not supported or enabled.</td>
</tr>
<tr>
<td>"CXL_LatOpt_Fmt6"</td>
<td>This must be advertised if the Adapter and Protocol Layer support Format 6 defined in Section 3.3.4. The Protocol Layer takes advantage of the spare bytes in this Flit Format. This must not be advertised if CXL protocol and CXL 256B Flit mode are not supported or enabled.</td>
</tr>
</table>

<table>
<caption>Table 3-1. Capabilities that Must Be Negotiated between Link Partners (Sheet 2 of 3)</caption>
<tr>
<th>Capability</th>
<th>Description and Requirements</th>
</tr>
<tr>
<td>"Retimer"</td>
<td>This must be advertised if the Adapter of a UCIe Retimer is performing Parameter Exchanges with a</td>
</tr>
<tr>
<td>"Retimer_Credits"</td>
<td>$T h i s \quad i s \quad a \quad 9 - b i t \quad v a l u e \quad a d v e r t i s i n g \quad t h e \quad t o t a l \quad c r e d i t s \quad a v a i l a b l e \quad f o r \quad R e t i m e r s \quad R e c e i v e r \quad B u f f e r . E a c h \quad c r e d i t$</td>
</tr>
<tr>
<td>"DP"</td>
<td>This is set by Downstream Ports to inform the remote Link partner that it is a Downstream Port. It is useful for Retimers to identify whether they are connected to a Downstream Port UCIe die. It is currently only applicable for PCIe and CXL protocols; however, Streaming protocols are not precluded from utilizing this bit. If Enhanced Multi-Protocol capability is supported, this bit is applicable if either of the Protocol Layers is PCIe or CXL. This bit must be set to Ob if "Retimer" is set to 1b.</td>
</tr>
<tr>
<td>"UP"</td>
<td>This is set by Upstream Ports to inform the remote Link partner that it is an Upstream Port. It is useful for Retimers to identify whether they are connected to an Upstream Port UCIe die. It is currently only applicable for PCIe and CXL protocols; however, Streaming protocols are not precluded from utilizing this bit. If Enhanced Multi-Protocol capability is supported, this bit is applicable if either of the Protocol Layers is PCIe or CXL. This bit must be set to Ob if "Retimer" is set to 1b.</td>
</tr>
<tr>
<td>"68B Flit Format"</td>
<td>This must be advertised if the negotiated maximum data rate is &lt;= 32 GT/s and any of the following are true: · Enhanced Multi-Protocol capability is supported and enabled, AND the 68B Flit Format is supported and enabled . The 68B Flit Format for Streaming Protocol capability is supported and enabled Otherwise, it must be set to 0b. Note that the negotiation of the maximum data rate occurs during MBINIT.PARAM, which is during Stage 2 of Link Initialization, before any of the Adapter capabilities are determined in Stage 3. The Adapter can use the pl_max_speedmode signal on the RDI to determine the negotiated maximum data rate.</td>
</tr>
<tr>
<td>"Standard 256B End Header Flit Format"</td>
<td>This must be advertised if any of the following are true: · Enhanced Multi-Protocol capability is supported and enabled, AND the Standard 256B End Header Flit Format is supported and enabled . The Standard 256B End Header Flit Format for Streaming Protocol capability is supported and enabled Otherwise, it must be set to 0b.</td>
</tr>
<tr>
<td>"Standard 256B Start Header Flit Format"</td>
<td>This must be advertised if any of the following are true: · PCIe Flit mode is advertised and Standard Start Header for PCIe protocol capability is supported and enabled · Enhanced Multi-Protocol capability is supported and enabled, AND the Standard 256B Start Header Flit Format is supported and enabled · The Standard 256B Start Header Flit Format for Streaming Protocol capability is supported and enabled Otherwise, it must be set to 0b.</td>
</tr>
<tr>
<td>"Latency-Optimized { 2 5 6 B \text { without Optiona } }<br>{ \text { Bytes Fit Format^{\prime\prime } } }</td>
<td>This must be advertised if any of the following are true: . Enhanced Multi-Protocol capability is supported and enabled, AND the Latency-Optimized 256B without Optional Bytes Flit Format is supported and enabled · The Latency-Optimized 256B without Optional Bytes Flit Format for Streaming Protocol capability is supported and enabled Otherwise, it must be set to 0b.</td>
</tr>
<tr>
<td>"Latency-Optimized 256B with Optional Bytes Flit Format"</td>
<td>This must be advertised if any of the following are true: · PCIe Flit mode is advertised and Latency-Optimized Flit with Optional Bytes for PCIe protocol capability is supported and enabled · Enhanced Multi-Protocol capability is supported and enabled, AND the Latency-Optimized 256B with Optional Bytes Flit Format is supported and enabled · The Latency-Optimized 256B with Optional Bytes Flit Format for Streaming Protocol capability is supported and enabled Otherwise, it must be set to 0b.</td>
</tr>
<tr>
<td>"Enhanced Multi_Protocol_Enable"</td>
<td>This must only be advertised if the Adapter is connected to multiple FDI instances corresponding to two sets of Protocol Layers. The two sets of Protocol Layers are permitted to be different protocols, but must support at least one common Flit Format. This must only be advertised if the Enhanced Multi-Protocol capability is supported and enabled; otherwise, it must be set to 0b. Both "Stack0_Enable" and "Stack1_Enable" must be 1b if this bit is advertised.</td>
</tr>
</table>

<table>
<caption>Table 3-1. Capabilities that Must Be Negotiated between Link Partners (Sheet 3 of 3)</caption>
<tr>
<th>Capability</th>
<th>Description and Requirements</th>
</tr>
<tr>
<td>"Stack 0 Maximum Bandwidth_Limit"</td>
<td>This must be advertised if Enhanced Multi_Protocol_Enable is advertised and the Stack 0 protocol Receiver is limited to 50% of the maximum bandwidth; otherwise, it must be set to 0b.</td>
</tr>
<tr>
<td>$S t a c k \quad 1 \quad M a x i m u m$</td>
<td>This must be advertised if Enhanced Multi_Protocol_Enable is advertised and the Stack 1 protocol Receiver is limited to 50% of the maximum bandwidth; otherwise, it must be set to 0b.</td>
</tr>
<tr>
<td>"Management Transport Protocol"</td>
<td>This bit must be set to 1 if the Protocol Layer and Adapter both support Management Transport protocol (either as the only protocol or multiplexed with one of CXL.io, PCIe, or Streaming). The mechanism by which this bit is set to 1 is implementation-specific.</td>
</tr>
</table>

Once local capabilities are established, the Adapter sends the {AdvCap.Adapter} sideband message
advertising its capabilities to the remote Link partner.

If PCIe or CXL protocol support is going to be advertised, the Upstream Port (UP) Adapter must wait
for the first {AdvCap.Adapter} message from the Downstream Port (DP) Adapter, review the
capabilities advertised by DP and then send its own sideband message of advertised capabilities. UP is
permitted to change its advertised capabilities based on DP capabilities. Once the DP receives the
capability advertisement message from the UP, the DP responds with the Finalized Configuration using
{FinCap.Adapter} sideband message to the UP as shown in Figure 3-4. See Section 7.1.2.3 to see the
message format for the relevant sideband messages.

Final determination for Protocol parameters:

· If "68B Flit Mode" is advertised by both Link partners, it is set to 1 in the {FinCap.Adapter}
message

· If "CXL 256B Flit Mode" is advertised by both Link partners, it is set to 1 in the {FinCap.Adapter}
message

· If "PCIe Flit Mode" is advertised by both Link partners, "PCIe Flit Mode" bit is set to 1 in the
{FinCap.Adapter} message

· If Streaming protocol is negotiated, no {FinCap.Adapter} messages are exchanged for that stack.

If "68B Flit Mode" or "CXL 256B Flit Mode" is set in the {FinCap.Adapter} message, there must be
another handshake of Parameter Exchanges using the {AdvCap.CXL} and the {FinCap.CXL}
messages to determine the details associated with this mode. If the negotiated maximum data rate is

negotiated data rates, CXL 68B Flit Mode protocol is mandatory for CXL and PCIe Non-Flit Mode
protocol is mandatory for PCIe. If the negotiated maximum data rate is > 32 GT/s, the 68B Flit
Formats are not supported and the "68B Flit Mode" parameter must be cleared to 0. This additional
handshake is shown in Figure 3-4. The combination of {FinCap.CXL} and {FinCap.Adapter}
determine the Protocol and Flit Format. See Section 7.1.2.3 for the message format of the relevant
sideband messages. See Section 3.4 for how Protocol and Flit Formats are determined.

Final determination for other parameters if CXL or PCIe protocol is negotiated:

· If "Raw Format" is advertised by both Link partners, "Raw Format" is set to 1 in the
{FinCap.Adapter} message.

· If both Link partners advertised "Retry" and "Raw Format" is not negotiated, Adapter Retry is
enabled and "Retry" is set to 1 in the {FinCap.Adapter} message.

. If both Link partners advertised "Enhanced Multi_Protocol_Enable", both Stack 0 and Stack 1 are
enabled by the adapter, and all three parameters ("Enhanced Multi_Protocol_Enable",
"Stack0_Enable" and "Stack1_Enable") are each set to 1 in the {FinCap.Adapter} message (if a
{FinCap.Adapter} message is required to be sent).

. If both Link partners advertised "Multi_Protocol_Enable" and "Enhanced Multi_Protocol_Enable" is
not negotiated, both Stack 0 and Stack 1 are enabled by the Adapter, and all three parameters
("Multi_Protocol_Enable", "Stack0_Enable", and "Stack1_Enable") are each set to 1 in the
{FinCap.Adapter} message.

. If neither "Enhanced Multi_Protocol_Enable" nor "Multi_Protocol_Enable" is negotiated, then the
lowest common denominator is used to determine whether Stack 0 or Stack 1 is enabled, and the
corresponding bit is set to 1 in the {FinCap.Adapter} message. If both Stack enables are
advertised, then Stack 0 is selected for operational mode and only Stack0_Enable is set to 1 in
the {FinCap.Adapter} message.

· If CXL_LatOpt_Fmt5 is advertised by both Link partners, then it is set to 1 in the
{FinCap.Adapter} message.

· If CXL_LatOpt_Fmt6 is advertised by both Link partners, then it is set to 1 in the
{FinCap.Adapter} message.

<figure>
<figcaption>Figure 3-4. Parameter Exchange for CXL or PCIe (i.e., "68B Flit Mode" or "CXL 256B Flit Mode" is 1 in {FinCap.Adapter} )</figcaption>

DP Adapter
Die 0

DP Physical layer CHANNEL UP Physical layer
Die 0
Die 1

UP Adapter
Die 1

SB MSG {AdvCap.Adapter}

SB MSG {AdvCap.Adapter}

$S B \quad M S G F i n C a p . A d a p t e r$

SB MSG {AdvCap.CXL}

$S B \quad M S G A d v C a p . C X L$

SB MSG {FinCap.CXL}

</figure>

If Streaming protocol is negotiated, there is no notion of DP and UP for parameter exchanges and
each side independently advertises its capabilities. Additional Vendor Defined sideband messages are
permitted to be exchanged to negotiate vendor-specific extensions. See Table 7-8 and Table 7-10 for
additional descriptions of Vendor Defined sideband messages. Similarly, if Management Transport
protocol is negotiated on a stack without "Streaming protocol," "CXL 256B Flit mode," or "PCIe Flit
mode," there is no notion of DP and UP for parameter exchanges and each side independently
advertises its capabilities.

The Finalized Configuration is implicitly determined based on the intersection of capabilities
advertised by each side:

· Flit Formats are chosen based on the Truth Table resolution provided in Table 3-10

· If both Link partners advertised Retry, and "Raw Format" is not negotiated, then Adapter Retry is
enabled

. If "Multi_Protocol_Enable" is negotiated, both Stack 0 and Stack 1 are enabled by the adapter

. If neither "Multi_Protocol_Enable" nor "Enhanced Multi_Protocol_Enable" is advertised by at least
one of the Link partners, then the lowest common denominator is used to determine whether
Stack 0 or Stack 1 is enabled (i.e., if both Stack enables are advertised, then Stack 0 is selected
for operational mode)

{FinCap .* } messages are not sent for Streaming protocol. Adapter must determine vendor specific
requirements in an implementation specific manner.

If "Enhanced Multi_Protocol_Enable" is negotiated, the {AdvCap.Adapter} and if applicable, the
{FinCap.Adapter} messages determine the negotiated Flit Format of operation as well as the protocol
for Stack 0. The Adapter uses {MultiProtAdvCap.Adapter} and if applicable, the
{MultiProtFinCap.Adapter} sideband messages to negotiate the Stack 1 protocol. For Stack 1, if PCIe
or CXL protocol support is going to be advertised, the UP Adapter must wait for the first message
from the DP Adapter, review the capabilities advertised by DP and then send its own sideband
message of advertised capabilities. UP is permitted to change its advertised capabilities based on DP
capabilities. In the section below, "advertised" means that the corresponding bit is 1b in the
{MultiProtAdvCap.Adapter} sideband message.

· "68B Flit Mode": If the negotiated maximum data rate is $< = 3 2$ GT/s, this must be advertised
when the Adapter and Protocol Layer support CXL 68B Flit Mode or PCIe Non-Flit Mode on Stack
1.

. "CXL 256B Flit Mode": This must be advertised if the Adapter and Protocol Layer support CXL
256B Flit Mode on Stack 1.

. "PCIe Flit Mode": This must be advertised if the Adapter and Protocol Layer support PCIe Flit Mode
on Stack 1.

. "Streaming": This must be advertised if the Adapter and Protocol Layer support Streaming Flit
Mode on Stack 1.

. "Management Transport Protocol": This must be advertised if the Protocol Layer supports
Management Transport protocol on Stack 1.

If "68B Flit Mode" or "CXL 256B Flit Mode" is set in the {MultiProtFinCap.Adapter} message, there
must be another handshake of Parameter Exchanges using the {AdvCap.CXL} and the {FinCap.CXL}
messages to determine the details associated with this mode. The non-Stall { *. CXL} messages are
sent with a MsgInfo encoding of 0001h indicating that these messages are for Stack 1 negotiation.

Figure 3-5 to Figure 3-9 represent examples of different scenarios where Stack 0 and Stack 1 are of
different protocols.

Figure 3-5.
Both Stacks are CXL or PCIe

<table>
<tr>
<th colspan="4">DP Adapter DP Physical layer CHANNEL UP Physical layer Die 0 Die 0 Die 1 $S B \quad M S G$ {AdvCap.Adapter}</th>
<th>UP Adapter $D i e \quad 1$</th>
</tr>
<tr>
<th colspan="2"></th>
<th>$S B \quad M S G$ {AdvCap.Adapter} SB MSG {FinCap.Adapter} SB MSG {AdvCap.CXL}: MsgInfo=0000h $C A N S G \left\{ A d v C _ { d P } ^ { 1 } , C X L \right\} : M s g l n f o = 0 0 0 0$ SB MSG {Fin Cap.CXL}: MsgInfo=0000h- SB MSG {MultiProtAdvCap.Adapter} SB MSG {MultiProtAdvCap.Adapter}</th>
<th></th>
<th></th>
</tr>
<tr>
<td></td>
<td></td>
<td>SB MSG {MultiProtFinCap.Adapter} SB MSG {AdvCap.CXL}: MsgInfo=0001h- SB MSG {AdvCap.CXL}: $\mathrm { M s g l n f o } = 0 0 0 1$ SB MSG {FinCap.CXL}: MsgInfo=0001h-</td>
<td></td>
<td></td>
</tr>
</table>

<figure>
<figcaption>Figure 3-6. Stack 0 is PCIe, Stack 1 is Streaming</figcaption>
</figure>

<figure>

{ \text { Adapte } }<br>{ \text { Die } 0 }

Physical layer
$D i e \quad 0$
DP

Physical layer
$D i e \quad 1$
UP

Adapter
Die 1
UP

CHANNEL

DP

SB MSG {AdvCap.Adapter}

SB MSG {AdvCap.Adapter}

SB MSG {Fin Cap.Adapter}

SB MSG {AdvCap.CXL}: MsgInfo=0000h-

SB MSG {AdvCap.CXL}: MsgInfo=0000h

SB MSG {Fin Cap.CXL}: $M s g I n f o = 0 0 0 0 h -$

SB MSG {MultiProtAdvCap.Adapter}

SB MSG {MultiProtAdvCap.Adapter}

</figure>

<figure>
<figcaption>Figure 3-7. Stack 0 is Streaming, Stack 1 is PCIe</figcaption>

{ \text { Adapte } }<br>{ \text { Die } 0 }

Physical layer
$D i e \quad 0$
DP

Physical layer
Die 1
$U P$

Adapter
Die 1
UP

CHANNEL

$\mathrm { D P }$

SB MSG {AdvCap.Adapter}

SB MSG {AdvCap.Adapter}

SB MSG {MultiProtAdvCap.Adapter}

SB MSG {Multi ProtAdvCap.Adapter}

SB MSG {MultiProtFinCap.Adapter}

SB MSG {AdvCap.CXL}: MsgInfo=0001h

SB MSG {AdvCap.CXL}: MsgInfo=0001h-

SB MSG {Fin Cap. CXL}: MsgInfo=0001h-

</figure>

<figure>
<figcaption>Figure 3-8. Both Stacks are Streaming</figcaption>

Adapter
Die 0

Physical layer
$D i e \quad 0$

CHANNEL

Physical layer
Die 1

Adapter
$D i e \quad 1$

SB MSG {AdvCap.Adant~}
SB MSG {AdvCap.Adapter}

SB MSG {Multi ProtAdvCap.Adapter}
SB MSG {Multi ProtAdvCap.Adapter}

</figure>

<figure>
<figcaption>Figure 3-9. Stack 0 is Streaming, Stack 1 is CXL</figcaption>

Adapter
$D i e \quad 0$
DP

Physical layer
$D i e \quad 0$
DP

Physical layer
Die 1
UP

Adapter
Die 1
UP

CHANNEL

SB MSG {AdvCap.Adapter}
SB MSG {AdvCap.Adapter}

SB MSG {Multi ProtAdvCap.Adapter}

SB MSG {Multi ProtAdvCap.Adapter}

SB MSG {MultiProtFinCap.Adapter}

SB MSG {AdvCap.CXL}: MsgInfo=0001h-

SB MSG {AdvCap.CXL}: MsgInfo=0001h

SB MSG {FinCap.CXL}: MsgInfo=0001h-

</figure>

The Adapter must implement a timeout of 8 ms $\left( - 0 / + 5 0 \right)$ for successful Parameter Exchange
completion. For the purposes of measuring a timeout for Parameter Exchange completion, all steps in
Part 1 and Part 2 of Stage 3 of Link Initialization are included. The timer only increments while RDI is
in Active state. The timer must reset if the Adapter receives an {AdvCap .\*. Stall}, {FinCap .\*. Stall},
{MultiProtAdvCap .\*. Stall}, or {MultiProtFinCap .\*. Stall} message from the remote Link partner. The
8-ms timeouts for Parameter Exchanges or Link State Machine transitions are treated as UIE and the
Adapter must take the RDI to LinkError state. UCIe Retimers must ensure that they resolve the
capability advertisement with remote Retimer partner (and merge with their own capabilities) before
responding/initiating parameter exchanges with the UCIe die within its package. While resolution is in
progress, they must send the corresponding stall message once every 4 ms to ensure that a timeout
does not occur on the UCIe die within its package.

## 3.2.1.3 Part 3: FDI bring up

Once Parameter Exchanges have successfully completed, the Adapter reflects the result to the
Protocol Layers on FDI, and moves on to carry out the FDI bring up flow as defined in Section 10.2.8.
Once FDI is in Active state, it concludes Stage 3 of Link Initialization and protocol Flit transfer can
begin. When multiple stacks are enabled on the same Adapter, each stack may finish the FDI bring up
flow (see Section 10.2.8) at different times.

The data width on FDI is a function of the frequency of operation of the UCIe stack as well as the total
bandwidth being transferred across the UCIe physical Link (which in turn depends on the number of
Lanes and the speed at which the Lanes are operating). The data width on RDI is fixed to at least one
byte per physical Lane per module that is controlled by the Adapter. The illustrations of the formats in
this chapter are showing an example configuration of RDI mapped to a 64 Lane module of Advanced
Package configuration on the Physical Layer of UCIe.

# 3.3 Operation Formats

In subsequent sections, when referring to CRC computation, a byte mapping of the Flit to CRC
message (CRC message is the 128B input to CRC computation logic) is provided. See Section 3.7 for
more details.

## 3.3.1 Raw Format for All Protocols

Raw Format can only be used for scenarios in which Retry support from the Adapter is not required. If
Raw Format is negotiated for CXL or PCIe protocols, the Adapter transfers data from Protocol Layer to
Physical Layer without any modification. Figure 3-10 shows an example of this for a 64B data path on
FDI and RDI. This is identified as Format 1 during parameter negotiation.

Figure 3-10. Format 1: Raw Formata

+0

$\infty$

Byte 0

64B (from Protocol Layer)

a. See Figure 2-1 for color mapping.

## 3.3.2 68B Flit Format

This Flit Format is identified as Format 2 on UCIe. If the negotiated maximum data rate is
$< = 3 2 \quad G T / s :$

· Support for this is mandatory when CXL 68B Flit Mode protocol or PCIe Non-Flit Mode protocol is
supported

. 68B Flit Format support is optional for Streaming protocols

If the negotiated maximum data rate is > 32 GT/s, 68B Flit Format is not supported.

The Protocol Layer sends 64B of protocol information. The Adapter adds a two byte prefix of Flit
Header and a two byte suffix of CRC. Table 3-3 gives the Flit Header format for Format 2 when Retry
from the Adapter is required. If Retry from the Adapter is not required, then the Flit Header format is
as provided in Table 3-2.

Even if Retry is not required, the Adapter still computes and drives CRC bytes - the Receiver is
strongly recommended to treat a CRC error as an Uncorrectable Internal Error in this situation. For
CRC computation, Flit Byte 0 (i.e., Flit Header Byte 0) is assigned to CRC message Byte 0, Flit Byte 1
(i.e., Flit Header Byte 1) is assigned to CRC message Byte 1 and so on until Flit Byte 65 is assigned to
CRC message Byte 65.

Retry is performed over this 68B Flit.

<table>
<caption>Table 3-2. Flit Header for Format 2 without Retry</caption>
<tr>
<th rowspan="2">Byte</th>
<th rowspan="2">Bit</th>
<th colspan="2">Description</th>
</tr>
<tr>
<th>PCIe or CXL</th>
<th>Streaming Protocol</th>
</tr>
<tr>
<td rowspan="4">Byte 0</td>
<td>[7:6]</td>
<td>Protocol Identifier: 2'b00: D2D Adapter NOP Flit or PDS Flit Header 2'b01: CXL.io Flit 2'b10: CXL.cachemem Flit 2'b11: ARB/MUX Flit (Reserved encoding for PCIe)</td>
<td>Protocol Identifier: 2'b00: D2D Adapter NOP Flit 2'b01: Protocol Layer Flit Remaining encodings are Reserved.</td>
</tr>
<tr>
<td>[5]</td>
<td>Stack Identifier: 1'b0: Stack 0 1'b1: Stack 1</td>
<td></td>
</tr>
<tr>
<td>[4]</td>
<td>1'b0: Regular Flit Header 1'b1: Pause of Data Stream (PDS) Flit Header</td>
<td></td>
</tr>
<tr>
<td>[3:0]</td>
<td>Reserved</td>
<td></td>
</tr>
<tr>
<td rowspan="2">Byte 1ª</td>
<td>[7]</td>
<td>1'b0: Regular Flit Header 1'b1: Pause of Data Stream (PDS) Flit Header</td>
<td></td>
</tr>
<tr>
<td>[6:0]</td>
<td>Reserved</td>
<td></td>
</tr>
</table>

a. For a Test Flit, bits [7:6] of Byte 1 are 01b. See Section 11.2 for more details.

<table>
<caption>Table 3-3. Flit Header for Format 2 with Retry</caption>
<tr>
<th rowspan="2">Byte</th>
<th rowspan="2">Bit</th>
<th colspan="2">Description</th>
</tr>
<tr>
<th>PCIe or CXL</th>
<th>Streaming Protocol</th>
</tr>
<tr>
<td rowspan="4">Byte 0</td>
<td>[7:6]</td>
<td>Protocol Identifier: 2'b00: D2D Adapter NOP Flit or PDS Flit Header 2'b01: CXL.io Flit 2'b10: CXL.cachemem Flit 2'b11: ARB/MUX Flit (Reserved encoding for PCIe)</td>
<td>Protocol Identifier: 2'b00: D2D Adapter NOP Flit 2'b01: Protocol Layer Flit Remaining encodings are Reserved.</td>
</tr>
<tr>
<td>[5]</td>
<td>Stack Identifier: 1'b0: Stack 0 1'b1: Stack 1</td>
<td></td>
</tr>
<tr>
<td>[4]</td>
<td>1'b0: Regular Flit Header 1'b1: Pause of Data Stream (PDS) Flit Header</td>
<td></td>
</tr>
<tr>
<td>[3:0]</td>
<td>The upper four bits of Sequence number "S" (i.e., S[7:4])</td>
<td></td>
</tr>
<tr>
<td rowspan="3">$1 ^ { a }$</td>
<td>[7:6]</td>
<td>2'b00: Regular Flit Header 2'b11: Pause of Data Stream (PDS) Flit Header Other encodings are reserved</td>
<td></td>
</tr>
<tr>
<td>$\left[ 5 : 4 \right]$</td>
<td>Ack or Nak information 2'b00: Explicit Sequence number "S" of Flit if not PDS, "NEXT_TX_FLIT_SEQ_NUM - 1". (See PCIe Base Specification NEXT_TX_FLIT_SEQ_NUM and the subtraction operation 2'b01: Ack. The Sequence number "S" carries the Ack'ed 2'b10: Nak. The Sequence number "S" carries 255 if N=1, Nak'ed sequence number. 2'b11: Reserved</td>
<td>otherwise the bitwise inverted value of for the definition of for sequence numbers) sequence number. otherwise it carries N-1, where N is the</td>
</tr>
<tr>
<td>[3:0]</td>
<td colspan="2">The lower four bits of Sequence number "S" (i.e., S[3:0]) Sequence number 0 is reserved and if present, it implies no Ack or Nak is sent.</td>
</tr>
</table>

a. For a Test Flit, bits [7:6] of Byte 1 are 01b. See Section 11.2 for more details.

## 3.3.2.1 68B Flit Format Alignment and Padding Rules

Because of the four bytes added by D2D Adapter, the alignment of the Flit does not always match the
number of Lanes of the physical Link. The bytes added by D2D Adapter require the Adapter to shift
the data arriving over FDI by four bytes for consecutive Flits transmitted over RDI. Data is always
transferred in multiples of 256B (note that Retimer credits have a 256B data granularity). A
mechanism to Pause the Data Stream is provided as a way to save power when the Link is idle. Before
pausing the data stream, the data stream is terminated with a Pause of Data Stream (PDS) Flit
Header followed by 0b padding to the next 64B count multiple boundary and at least two subsequent
64B chunks of all 0 value data. If the transfer is not at a 256B count multiple boundary, additional 64B
chunks of all 0 value data are required to bring the transferred bytes to a 256B count multiple. The
subsequent transfers of all 0 data mentioned above give the Receiver at least two 64B chunks to reset
the receiving byte shifter. The PDS Flit Header and the 0 padding bytes following it must not be
forwarded to the Protocol Layer. The PDS token is a variable-size Flit that carries a 2B special Flit
Header (referred to as the PDS Flit Header), and 0 bytes padded as described above. The Transmitter
of PDS drives the following on the Flit header:

1\. Bit [4] of Byte 0 as 1

2\. Bit [7] of Byte 1 as 1

3\. Bit [6] of Byte 1 as 1

4\. Bits [5:4] of Byte 1 as 00b and the sequence number[7:0] is matching the expected value for a
PDS Flit Header in this position as defined in Table 3-3.

The Adapter may optionally insert continuous NOPs instead of terminating the data stream with a PDS
when no other flits are available to transmit ("no flits available to transmit" includes any payload flits,
test flits, or flits transmitted to follow the replay rules, as well as any pending ACKs/NAKs, etc.).
There is a trade-off between the longer idle latency for a new flit to be transmitted after a PDS vs. the
power consumption of continuously transmitting NOP flits. It is the responsibility of the transmitting
Adapter to make the determination between transmitting NOP flits vs. inserting a PDS in an
implementation-specific manner. Note that the transmitting Adapter does not de-assert lp_irdy and
lp_valid on the RDI in the middle of a data stream (i.e., until the PDS Flit Header and
corresponding padding of Os has completed transferring across the RDI). If Runtime Link Testing
Parity is enabled (see Section 3.9), any parity bytes that are scheduled for transmission must be sent
immediately and without any gap after the preceding data, including any completed PDS, to ensure
that the parity bytes can be correctly identified by the receiver.

If Retry is enabled, the Receiver must interpret this Flit header as PDS if any two of the above four
conditions are true. If Retry is disabled, the Receiver must interpret this Flit header as a PDS if
conditions (1) and (2) are true.

A PDS must be inserted when Retry is triggered or RDI state goes through Retrain. The transmitter
must insert PDS Flit Header and corresponding padding of 0s as it would for an actual PDS and start
the replayed Flit from fresh alignment (i.e., flit begins from a 256B-aligned boundary). Note that for
Retry, this should occur before the Transmitter begins replaying the Flits from the Retry buffer; and
for Retrain entry, this should occur before asserting lp_stallack to the Physical Layer.

For Retry and Retrain scenarios, the Receiver must also look for the expected sequence number in
Byte 0 and Byte 1 of the received data bus with a corresponding valid Flit (i.e., CRC passes). Note that
for a Retrain scenario, a PDS might not be received at the receiver before the RDI state changes to
Retrain, and the Adapter must discard any partially received 68B Flits after state change.

When resuming the data stream after a PDS token (i.e., a PDS Flit Header and the corresponding
padding of 0s), the first Flit is always 256B aligned; any valid Flit transfer after a PDS token will
resume the data stream. If Retry is disabled, the first Flit that is transmitted to resume the data
stream must be a payload Flit or a test Flit (because NOPs can be all 0 Flit, the receiver could not

distinguish this NOP from a paused data stream). After a PDS Flit Header has been transmitted, the
corresponding padding of 0b to satisfy the PDS token padding requirements must be finished before
resuming the data stream with new Flits. If Runtime Link Testing Parity is enabled (see Section 3.9),
any parity bytes transmitted do not indicate that a data stream is resumed; only a valid Flit resumes
a data stream.

If Retry is enabled, it is permitted to map a PDS error (such as an invalid length or nonzero data
bytes) to trigger Link Retrain. If Retry is disabled, it is permitted to map a PDS error to LinkError.

### IMPLEMENTATION NOTE

#### Bit Errors and Aliasing

When Retry is disabled, the BER of the Link is 1E-27 or lower. In these cases, any bit
error is an uncorrectable error for the Link. As a best practice, it is strongly
recommended for receiver implementations to have an uncorrectable internal error
condition for scenarios in which neither a valid Flit Header nor a valid PDS Flit Header
is detected.

When Retry is enabled, the BER is 1E-15 or lower, which results in the probability of
two or more bit errors within the Flit Header is very low. However, implementations
must consider the following two scenarios:

. PDS Flit Header aliasing to a regular Flit Header: Checking for two out of the
four conditions guarantees that at least three bit errors must occur within the two
bytes of the PDS Flit Header for it to alias to a regular Flit Header. Even for three
bit errors, there will be a CRC which will result in a retry and will be handled
seamlessly through the retry rules.

· Regular Flit Header aliasing to a PDS Flit Header: It is possible for two bit
errors to cause a Regular Flit Header to alias to a PDS Flit Header. This will likely
result in a CRC error for future Flits. However, to reduce the probability of a data
corruption that escapes CRC even further, it is strongly recommended that if a
PDS Flit Header was detected without all four conditions being satisfied (i.e., two
out of four or three out of four were satisfied), the receiver checks for an explicit
sequence number Flit with the expected sequence number in Byte 0 and Byte 1 of
the first received data transfer and that it is a valid Flit (i.e., CRC passes) after
the PDS (including the PDS token and the corresponding padding) have
completed; and triggers a Retry if it does not pass the check. Note that this is the
same check a Receiver performs after a Retry or Retrain.

Figure 3-11 shows the 68B Flit Format. Figure 3-12 and Figure 3-13 provide examples of PDS
insertion.

Figure 3-11. Format 2: 68B Flit Formata

+0

+1

+2

+3

+4

+5

+6

+7

+8
+9

+10

$\infty$

Byte 0

F1H B0b

F1H B1b

62B of Flit 1 (from Protocol Layer)

Byte 64

F1 B62C

F1 B63c

C1 B0d

C1 B1d

F2H B0b

F2H B1b

58B of Flit 2 (from Protocol Layer)

Byte 128

6B of Flit 2
(from Protocol Layer)

C2 B0d

C2 B1ª

F3H B0b

F3H B1b

54B of Flit 3 (Next Flit)

a. See Figure 2-1 for color mapping.

b. Flit 1 Header Byte 0, Flit 1 Header Byte 1, Flit 2 Header Byte 0, Flit 2 Header Byte 1, Flit 3 Header Byte 0, and Flit 3 Header Byte
1 respectively.

c. Flit 1 Byte 62 and Byte 63, respectively (from Protocol Layer).

d. Flit 1 CRC Byte 0, Flit 1 CRC Byte 1, Flit 2 CRC Byte 0, and Flit 2 CRC Byte 1, respectively.

<figure>
<figcaption>Figure 3-12. Format 2: 68B Flit Format PDS Example 1ª</figcaption>

+0

+1

+2

+3

+4

+5

+6

$\infty$

Byte 0

FH B0b

FH B1b

62B (from Protocol Layer)

2B

CRC BOC

CRC B1C

PDS B0d

Byte 64

(from

Protocol
Layer)

PDS B1ª

58B all 0 data

Byte 128

64B all 0 data

Byte 192

64B all 0 data

</figure>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. CRC Byte 0 and Byte 1, respectively.

d. PDS Flit Header Byte 0 and Byte 1, respectively.

<figure>
<figcaption>Figure 3-13. Format 2: 68B Flit Format PDS Example 2 - Extra Os Padded to Make the Data Transfer a Multiple of 256Bª</figcaption>

Byte 0

Byte 64

Byte 128

Byte 192

Byte 256

Byte 320

Byte 384

Byte 448

</figure>

<table>
<tr>
<th>+0</th>
<th>+1</th>
<th>+2</th>
<th>+3</th>
<th>+4</th>
<th>+5</th>
<th>+6</th>
<th>+7</th>
<th>+8</th>
<th>+9 +10</th>
<th></th>
<th>$+ 6 3$</th>
</tr>
<tr>
<td>F1H B0b</td>
<td>F1H B1b</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>62B of Flit 1 (from Protocol Layer)</td>
<td></td>
</tr>
<tr>
<td>F1 B62℃</td>
<td>F1 B63C</td>
<td>C1 B0d</td>
<td>C1 B1ª</td>
<td>F2H B0b</td>
<td>F2H B1b</td>
<td></td>
<td></td>
<td colspan="2"></td>
<td colspan="2">58B of Flit 2 (from Protocol Layer)</td>
</tr>
<tr>
<td>F2 B58e</td>
<td>F2 B59e</td>
<td>F2 B60e</td>
<td>F2 B61e</td>
<td>F2 B62e</td>
<td>F2 B63e</td>
<td>C2 B0d</td>
<td>C2 B1d</td>
<td>PDS B0f</td>
<td>PDS B1f</td>
<td colspan="2">54B all 0 data</td>
</tr>
<tr>
<td colspan="2"></td>
<td colspan="4"></td>
<td></td>
<td colspan="3"></td>
<td colspan="2">64B all 0 data</td>
</tr>
<tr>
<td colspan="7"></td>
<td colspan="3"></td>
<td colspan="2">64B all 0 data</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3"></td>
<td></td>
<td></td>
<td></td>
<td colspan="2">64B all 0 data</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>64B all 0 data</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>64B all 0 data</td>
<td></td>
</tr>
</table>

a. See Figure 2-1 for color mapping.

b. Flit 1 Header Byte 0, Flit 1 Header Byte 1, Flit 2 Header Byte 0, and Flit 2 Header Byte 1, respectively.

c. Flit 1 Byte 62 and Byte 63, respectively (from Protocol Layer).

d. Flit 1 CRC Byte 0, Flit 1 CRC Byte 1, Flit 2 CRC Byte 0, and Flit 2 CRC Byte 1, respectively.

e. Flit 2 Bytes 58 through Byte 63, respectively (from Protocol Layer).

f. PDS Flit Header Byte 0 and Byte, respectively.

## 3.3.3 Standard 256B Flit Formats

These are the Standard Flit Formats defined in PCIe Base Specification for PCIe Flit Mode and CXL
Specification for CXL 256B Flit Mode. These are identified as "Standard 256B End Header Flit Format"
(or Format 3) and "Standard 256B Start Header Flit Format" (or Format 4), respectively. Support for

this is mandatory when PCIe Flit Mode or CXL 256B Flit Mode protocols are negotiated. Standard 256B
Flit Formats (Start Header or End Header) support is optional with Streaming protocols.

The Protocol Layer sends data in 256B Flits, but it drives 0 on the bytes reserved for the Adapter
(shown in light orange in Figure 3-14 through Figure 3-19). The 6B of DLP defined in PCIe Base
Specification exist in Format 3 and Format 4 as well for PCIe and CXL.io protocols. However, since
DLLPs are required to bypass the Tx Retry buffer in PCIe and CXL.io protocols, the DLP bytes end up
being unique since they are partially filled by the Protocol Layer and partially by the Adapter. DLP0
and DLP1 are replaced with the Flit Header for UCIe and are driven by UCIe Adapter. However, if the
Flit carries a Flit Marker, the Protocol Layer must populate bit 4 of Flit Header Byte 0 to 1b, as well as
the relevant information in the Flit_Marker bits (these are driven as defined in PCIe Base
Specification). Protocol Layer must also populate the Protocol Identifier bits in the Flit Header for the
Flits it generates.

For Streaming protocols, Figure 3-17 shows the applicable Flit Format. Protocol Layer only populates
bits [7:6] of Byte 0 of the Flit Header, and it must never set 00b for bits [7:6].

Standard 256B Start Header Flit Format is optional for PCIe Flit Mode protocol. Figure 3-18 shows the
Flit Format example.

FDI provides a separate interface for DLLP transfer from the Protocol Layer to the Adapter and vice-
versa. The Adapter is responsible for inserting DLLP into DLP Bytes 2:5 if a Flit Marker is not present.
The credit update information is transferred as regular Update_FC DLLPs over FDI from the Protocol
Layer to the Adapter. The Adapter is also responsible for formatting these updates as
Optimized_Update_FC format when possible and driving them on the relevant DLP bytes. The Adapter
is also responsible for adhering to all the DLLP rules defined for Flit Mode in PCIe Base Specification.
On the receive path, the Adapter is responsible for extracting the DLLPs or Optimized_Update_FC
from the Flit and driving it on the dedicated DLLP interface provided on FDI.

Two sets of CRC are computed (CRC0 and CRC1). The same 2B over 128B CRC computation as
previous formats is used.

For PCIe, CXL, and Streaming:

· For Format 3, CRCO is computed using Flit Bytes 0 to 127 assigned to the corresponding bytes of
the CRC message input. CRC1 is computed using Flit Bytes 128 to 241 as the message input with
Flit Byte 128 assigned to CRC message Byte 0, Flit Byte 129 assigned to CRC message Byte 1 and
so on until Flit Byte 241 is assigned to CRC message Byte 113 (including the Flit Header bits
inserted by the Adapter, which for PCIe and CXL.io, includes the DLP bytes inserted by the
Adapter).

· For Format 4, CRCO is computed using Flit Bytes 0 to 127 assigned to the corresponding bytes of
the CRC message input (including the Flit Header bits inserted by the Adapter). CRC1 is computed
using Flit Bytes 128 to 241 as the message input with Flit Byte 128 assigned to CRC message
Byte 0, Flit Byte 129 assigned to CRC message Byte 1 and so on until Flit Byte 241 is assigned to
CRC message Byte 113 (for PCIe and CXL.io, this includes the DLP bytes inserted by the Adapter).

If Retry is not required, the Adapter still computes and drives CRC bytes - the Receiver is strongly
recommended to treat a CRC error as an Uncorrectable Internal Error (UIE) in this situation.

The Flit Header byte formats are shown in Table 3-5 when Retry is required; otherwise, it is as shown
in Table 3-4.

The Protocol Layer must drive bits [7:6] in Byte 1 of Flit Header to 00b for CXL/PCIe/Streaming
protocol Flits and to 10b for Management Flits (when successfully negotiated).

For Management Flits, Bytes 238 to 241 are driven from the Protocol Layer with Management
Transport Credit Return DWORD (CRD) Bytes 0 to 3 (see Section 8.2.5.2.2 for CRD format). Bytes

232 to 235 in Format 3 and Bytes 234 to 237 in Format 4 are driven from the Protocol Layer with 0s
for Management Flits. See Figure 3-16 and Figure 3-19 for details of Format 3 and Format 4 for
Management Flits, respectively.

If PCIe/CXL.io is negotiated along with Management Transport protocol on the same stack:

· If bits [7:6] of Byte 1 are 10b, the Adapter passes through Bytes 238 to 241 from the Protocol
Layer to the Link

· If bits [7:6] of Byte 1 are 00b, Bytes 238 to 241 are treated per PCIe/CXL.io DLP rules for this flit
format

<figure>
<figcaption>Figure 3-14. Format 3: Standard 256B End Header Flit Format for PCIeª</figcaption>

+0

+43

+44

+45

+46

+49

+50

+59

+60

$+ 6 3$

Byte 0

Flit Chunk 0 64B (from Protocol Layer)

Byte 64

Flit Chunk 1 64B (from Protocol Layer)

Byte 128

Flit Chunk 2 64B (from Protocol Layer)

Byte 192

44B of Flit Chunk 3 (from Protocol Layer)

FH B0b

FH B1b

DLP B2C

DLP B3c

DLP B4c

DLP B5c

10B
Reserved

C0 B0d

C0 B1d

$\overrightarrow { \mathrm { U } }$ B0d

C1 B1d

</figure>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. DLP Byte 2, Byte 3, Byte 4, and Byte 5, respectively.

d. CRC0 Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

Figure 3-15. Format 3: Standard 256B End Header Flit Format for Streaming Protocola

<figure>

+0

+43

+44

+45

+46

+49

+50

+59

+60

$+ 6 3$

Byte 0

Flit Chunk 0 64B (from Protocol Layer)

Byte 64

Flit Chunk 1 64B (from Protocol Layer)

Byte 128

Flit Chunk 2 64B (from Protocol Layer)

Byte 192

44B of Flit Chunk 3 (from Protocol Layer)

FH B0b

FH B1b

4B
(from Protocol
Layer)

10B
Reserved

CO BOC

C0 B1c

C1 B0c

C1 B1c

</figure>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. CRC0 Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

<figure>
<figcaption>Figure 3-16. Format 3: Standard 256B End Header Flit Format for Management Transport Protocolª</figcaption>

+0

+39

+40

+43

+44

+45

+46

+49

+50

$\frac { n } { t }$

+60

$\infty$

Byte 0

Flit Chunk 0 64B (from Protocol Layer)

Byte 64

Flit Chunk 1 64B (from Protocol Layer)

Byte 128

Flit Chunk 2 64B (from Protocol Layer)

Byte 192

40B of Flit Chunk 3 (from Protocol Layer)

4B
Rsvd

FH B0b

FH B1b

4B CRD
(from Protocol
Layer)

10B
Reserved

CO BOC

C0 B1c

C1 B0c

C1 B1c

</figure>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. CRCO Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

<figure>
<figcaption>Figure 3-17. Format 4: Standard 256B Start Header Flit Format for CXL.cachemem or Streaming Protocolª</figcaption>

+0

+1

+2

+49

+50

$\frac { m } { t }$

+60

$+ 6 3$

Byte 0

FH B0b

FH B1b

62B of Flit Chunk 0 (from Protocol Layer)

Byte 64

Flit Chunk 1 64B (from Protocol Layer)

Byte 128

Flit Chunk 2 64B (from Protocol Layer)

Byte 192

50B of Flit Chunk 3 (from Protocol Layer)

10B
Reserved

CO BOC

C0 B1c

C1 B0c

C1 B1c

</figure>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. CRC0 Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

Figure 3-18. Format 4: Standard 256B Start Header Flit Format for CXL.io or PCIeª

+0

+1

+2

+45

+46

+49

+50

+59

+60

$\infty$

Byte 0

FH B0b

FH B1b

62B of Flit Chunk 0 (from Protocol Layer)

Byte 64

Flit Chunk 1 64B (from Protocol Layer)

Byte 128

Flit Chunk 2 64B (from Protocol Layer)

Byte 192

46B of Flit Chunk 3 (from Protocol Layer)

DLP B2C

DLP B3c

DLP B4c

DLP B5c

10B
Reserved

C0 B0d

C0 B1d

$\overrightarrow { \mathrm { U } }$ B0d

C1 B1d

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. DLP Byte 2, Byte 3, Byte 4, and Byte 5, respectively.

d. CRC0 Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

<figure>
<figcaption>Figure 3-19. Format 4: Standard 256B Start Header Flit Format for Management Transport Protocolª</figcaption>

+0

+1

+2

+41

+42

+45

+46

+49

+50

$\frac { 9 } { 7 }$

+60

$+ 6 3$

Byte 0

FH B0b

FH B1b

62B of Flit Chunk 0 (from Protocol Layer)

Byte 64

Flit Chunk 1 64B (from Protocol Layer)

Byte 128

Flit Chunk 2 64B (from Protocol Layer)

Byte 192

42B of Flit Chunk 3 (from Protocol Layer)

4B
Rsvd

4B CRD
(from Protocol
Layer)

10B
Reserved

CO BOC

C0 B1c

C1 B0c

C1 B1c

</figure>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. CRCO Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

<table>
<caption>Table 3-4. Flit Header for Format 3, Format 4, Format 5, and Format 6 without Retry</caption>
<tr>
<th rowspan="2">Byte</th>
<th rowspan="2">Bit</th>
<th colspan="4">Description</th>
</tr>
<tr>
<th>CXL 256B Flit Mode</th>
<th>PCIe Flit Mode</th>
<th>Streaming Protocol</th>
<th>Management Transport Protocol</th>
</tr>
<tr>
<td rowspan="6">0</td>
<td rowspan="2">[7:6]</td>
<td rowspan="2">Protocol Identifier: 00b: D2D Adapter/CXL.io NOP Flit 01b: CXL.io Flit { 1 0 b : \text { CXL. Cachememem Fli } }<br>{ 1 1 b : \text { ARB/MUX Flit } }</td>
<td rowspan="2">Protocol Identifier: 00b: D2D Adapter/PCIe NOP Flit 01b: PCIe Flit All other encodings are reserved.</td>
<td>Protocol Identifier: 00b: D2D Adapter NOP Flit Remaining encodings are</td>
<td>Protocol Identifier: 00b: D2D Adapter NOP Flit 01b: Management Flit</td>
</tr>
<tr>
<td>permitted to be used by Protocol Layer in a vendor defined manner. Protocol { \text { Layer must never set this } }<br>{ \text { to 00b for Flits sent across } } FDI.</td>
<td>All other encodings are reserved.</td>
</tr>
<tr>
<td rowspan="2">[5]</td>
<td rowspan="2">Stack Identifier: 0: Stack 0 1: Stack 1</td>
<td></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>[4]</td>
<td colspan="2">Reserved for CXL.cachemem For CXL.io or PCIe Flit Mode: 0: DLLP Payload in DLP 2 .. 5 1: Optimized_Update_FC or Flit_Marker in DLP2 .. 5</td>
<td>Reserved</td>
<td></td>
</tr>
<tr>
<td>[3:0]</td>
<td>Reserved</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="2">1</td>
<td>[7:6]</td>
<td colspan="3">Flit Type: 00b: CXL/PCIe/Streaming Flit/D2D Adapter NOP Flit $\left( \mathrm { s e e } S _ { t } \right.$ Section 11.2 for details) 10b: Management Flit 11b: Reserved</td>
<td></td>
</tr>
<tr>
<td>[5:0]</td>
<td>Reserved</td>
<td></td>
<td></td>
<td></td>
</tr>
</table>

<table>
<caption>Table 3-5. Flit Header for Format 3, Format 4, Format 5, and Format 6 with Retry</caption>
<tr>
<th rowspan="2">Byte</th>
<th rowspan="2">Bit</th>
<th colspan="4">Description</th>
</tr>
<tr>
<th>CXL 256B Flit Mode</th>
<th>PCIe Flit Mode</th>
<th>Streaming Protocol</th>
<th>Management Transport Protocol</th>
</tr>
<tr>
<td rowspan="4">0</td>
<td>[7:6]</td>
<td>Protocol Identifier: 00b: D2D Adapter/CXL.io NOP Flit 01b: CXL.io Flit { 1 0 b : \text { CXL. Cachememem Fli } }<br>{ 1 1 b : \text { ARB/MUX Flit } }</td>
<td>Protocol Identifier: 00b: D2D Adapter/PCIe NOP Flit 01b: PCIe Flit All other encodings are reserved</td>
<td>Protocol Identifier: 00b: D2D Adapter NOP Flit Remaining encodings are permitted to be used by Protocol Layer in a vendor defined manner. Protocol Layer must never set this to 00b for Flits sent across FDI.</td>
<td>Protocol Identifier: 00b: D2D Adapter NOP Flit 01b: Management Flit All other encodings are reserved.</td>
</tr>
<tr>
<td>[5]</td>
<td>Stack Identifier: 0: Stack 0 1: Stack 1</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>[4]</td>
<td colspan="2">Reserved for CXL.cachemem For CXL.io or PCIe Flit Mode: 0: DLLP Payload in DLP 2 .. 5 1: Optimized_Update_FC or Flit_Marker in DLP2 .. 5</td>
<td>Reserved</td>
<td></td>
</tr>
<tr>
<td>[3:0]</td>
<td colspan="3">$\bar { T h \epsilon }$ upper four bits of Sequence number "S" (i.e., S[7:4])</td>
<td></td>
</tr>
<tr>
<td rowspan="3">1</td>
<td>[7:6]</td>
<td colspan="3">Flit Type: 00b: CXL/PCIe/Streaming Flit/D2D Adapter NOP Flit 01b: Test Flit (see Section 11.2 for details) { 1 0 b : \text { Management Fil } }<br>{ 1 1 h : \text { Reserved } }</td>
<td></td>
</tr>
<tr>
<td>[5:4]</td>
<td colspan="3">Ack or Nak Information: 00b: Explicit Sequence number "S" of the current Flit is present. 01b: Ack. The sequence number "S" carries the Ack'ed sequence number. 10b: Nak. The sequence number "S" carries 255 if N=1; otherwise, it carries N-1; where number. 11b: Reserved</td>
<td>N is the Nak'ed sequence</td>
</tr>
<tr>
<td>[3:0]</td>
<td colspan="4">The lower four bits of Sequence number "S" (i.e., S[3:0]). Sequence number 0 is reserved and if present, it implies no Ack or Nak is sent.</td>
</tr>
</table>

## 3.3.4 Latency-Optimized 256B Flit Formats

Two Latency-Optimized 256B Flit Formats are defined: Format 5 and Format 6. It is strongly
recommended that UCIe implementations support Format 6 for CXL 256B Flit Mode protocol to get
the best latency benefits.

Both formats look the same from the Adapter perspective, the only difference is whether the Protocol
Layer is filling in the optional bytes of protocol information . The Latency-Optimized 256B without
Optional bytes Flit Format (or Format 5) is when the Protocol Layer is not filling in the optional bytes,
whereas the Latency-Optimized 256B with Optional bytes Flit Format (or Format 6) is when the
Protocol Layer is filling in the optional bytes.

Latency-Optimized 256B Flit Formats (with Optional bytes or without Optional bytes) support is
optional with Streaming protocols. Protocol Layer only populates bits [7:6] of the Flit Header, and it
must never set 00b for bits [7:6].

Latency-Optimized Flit with Optional Bytes Flit Format is optional for PCIe Flit Mode protocol.
Figure 3-23 shows the Flit Format example.

Two sets of CRC are computed. CRC0 is computed using Flit Bytes 0 to 125 assigned to the
corresponding bytes of the CRC message input (including the Flit Header bits and if applicable, the
DLP bits inserted by the Adapter). CRC1 is computed using Flit Bytes 128 to 253 as the message input
with Flit Byte 128 assigned to CRC message Byte 0, Flit Byte 129 assigned to CRC message Byte 1
and so on until Flit Byte 253 assigned to CRC message Byte 125. If Retry is not required, the Adapter
still computes and drives CRC bytes - the Receiver is strongly recommended to treat a CRC error as
UIE in this situation.

For Management Flits (when successfully negotiated), the Protocol Layer must drive bits [7:6] in Byte
1 of Flit Header to 00b for Protocol Flit and to 10b.

For Management Flits using Format 5, Bytes 240 to 243 are driven from the Protocol Layer with
Management Transport Credit Return DWORD (CRD) Bytes 0 to 3 (see Section 8.2.5.2.2 for CRD
format). See Figure 3-22 for details.

If CXL.io is negotiated along with Management Transport protocol on the same stack for Format 5:

· If bits [7:6] of Byte 1 are 10b, the Adapter drives 0 on Bytes 122 to 125 and 244 to 253

· If bits [7:6] of Byte 1 are 00b, then Bytes 122 to 125 are treated per the CXL.io DLP rules of this
flit format and Bytes 250 to 253 are treated per the CXL.io FM rules of this flit format

For Management Flits using Format 6, Bytes 250 to 253 are driven from the Protocol Layer with
Management Transport Credit Return DWORD (CRD) Bytes 0 to 3 (see Section 8.2.5.2.2 for CRD
format). Similarly, Bytes 244 to 249 are driven from the Protocol Layer as 0. See Figure 3-26 for
details.

If PCIe/CXL.io is negotiated along with Management Transport protocol on the same stack for Format
6:

· If bits [7:6] of Byte 1 are 10b, the Adapter passes through Bytes 122 to 125 and 248 to 253

· If bits [7:6] of Byte 1 are 00b, then Bytes 122 to 125 are treated per the PCIe/CXL.io DLP rules of
this flit format, Bytes 250 to 253 are treated per the PCIe/CXL.io FM rules of this flit format, and
the Adapter drives 0 on Bytes 248 and 249

<figure>
<figcaption>Figure 3-20. Format 5: Latency-Optimized 256B without Optional Bytes Flit Format for CXL.ioª</figcaption>

+0

+1

+2

+51

+52

+57

+58

+61

+62

+63

Byte 0

FH B0b

FH B1b

62B of Flit Chunk 0 (from Protocol Layer)

58B of Flit Chunk 1 (from Protocol Layer)

DLP B2C

DLP B3c

DLP B5c

Byte 64

DLP B4c

C0 B0d

C0 B1d

Byte 128

Flit Chunk 2 64B (from Protocol Layer)

Byte 192

52B of Flit Chunk 3 (from Protocol Layer)

6B
Reserved

FM B0e

FM B1e

FM B2e

FM B3e

$\overrightarrow { \mathrm { U } }$ B0d

C1 B1d

</figure>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. DLP Byte 2, Byte 3, Byte 4, and Byte 5, respectively.

d. CRCO Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

e. Flit_Marker or Optimized_Update_FC Byte 0, Byte 1, Byte 2, and Byte 3, respectively.

<figure>
<figcaption>Figure 3-21. Format 5: Latency-Optimized 256B without Optional Bytes Flit Format for CXL.cachemem and Streaming Protocolª</figcaption>

+0

+1

+2

$+ 5 2$

+57

+58

$\frac { 6 } { + }$

+62

$+ 6 3$

Byte 0

FH B0b

FH B1b

62B of Flit Chunk 0 (from Protocol Layer)

Byte 64

58B of Flit Chunk 1 (from Protocol Layer)

4B
Reserved

CO BOC

CO $\frac { - } { m }$

Byte 128

Flit Chunk 2 64B (from Protocol Layer)

Byte 192

52B of Flit Chunk 3 (from Protocol Layer)

10B
Reserved

C1 B0c

C1 B1c

</figure>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. CRCO Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

<figure>
<figcaption>Figure 3-22. Format 5: Latency-Optimized 256B without Optional Bytes Flit Format for Management Transport Protocolª</figcaption>

+0

+1

+2

+47

+48

+51

+52

$+ 5 7$

+58

+61

+62

+63

Byte 0

FH B0b

FH B1b

62B of Flit Chunk 0 (from Protocol Layer)

Byte 64

58B of Flit Chunk 1 (from Protocol Layer)

4B
Reserved

CO BOC

C0 B1c

Byte 128

Flit Chunk 2 64B (from Protocol Layer)

$B y t e \quad 1 9 2$

48B of Flit Chunk 3 (from Protocol Layer)

4B CRD
(from Protocol
Layer)

10B
Reserved

$\bigtriangledown$ B0c

$\overrightarrow { \cup }$ B1c

</figure>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. CRC0 Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

<figure>
<figcaption>Figure 3-23. Format 6: Latency-Optimized 256B with Optional Bytes Flit Format for CXL.io or PCIeª</figcaption>

+0
+1

${ } ^ { N } _ { + }$

+55
+56

+57

+58

+61

+62

+63

Byte 0

FH B0b

FH B1b

62B of Flit Chunk 0 (from Protocol Layer)

DLP B2C

DLP B3c

DLP B4c

DLP B5c

Byte 64

58B of Flit Chunk 1 (from Protocol Layer)

C0 B0d

C0 B1d

$B y t e \quad 1 2 8$

Flit Chunk 2 64B (from Protocol Layer)

Byte 192

56B of Flit Chunk 3 (from Protocol Layer)

2B
Rsvd

FM B0e

FM B1e

FM B2e

FM B3e

C1 B0d

C1 B1d

</figure>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. DLP Byte 2, Byte 3, Byte 4, and Byte 5, respectively.

d. CRC0 Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

e. Flit_Marker Byte 0, Byte 1, Byte 2, and Byte 3, respectively.

$\frac { 9 } { 8 }$ 192

Byte 128

$B y t e$ 64

$\frac { 5 } { 8 }$

<table>
<tr>
<th rowspan="5">52B of Flit</th>
<th rowspan="8"></th>
<th rowspan="6">58B</th>
<th>FH B0b</th>
<th rowspan="2">+0 +1</th>
<th rowspan="3">Figure 3-24. Format for</th>
</tr>
<tr>
<th>$F H B 1 ^ { b }$</th>
</tr>
<tr>
<th rowspan="9"></th>
<th rowspan="2">+2</th>
</tr>
<tr>
<td>6: CXL.cachememª</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>Chunk</td>
<td></td>
<td rowspan="2">Latency-Optimized</td>
</tr>
<tr>
<td></td>
<td>of</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td rowspan="2">Flit</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>(from</td>
<td>Flit</td>
<td>Chunk</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td rowspan="3">62B</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Protocol</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td rowspan="2">Chunk</td>
<td></td>
<td rowspan="3">of Flit</td>
<td></td>
<td>256B</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>2</td>
<td>(from</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td rowspan="2">Chunk</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Layer)</td>
<td>64B</td>
<td>Protocol</td>
<td></td>
<td>with</td>
</tr>
<tr>
<td></td>
<td rowspan="2">(from</td>
<td></td>
<td rowspan="2"></td>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="3"></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="2"></td>
<td></td>
<td rowspan="2">0</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td rowspan="5">Protocol</td>
<td></td>
<td rowspan="3">(from</td>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="5"></td>
<td rowspan="11">Layer)</td>
<td></td>
<td>Optional</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="15">Protocol Layer)</td>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="2">+51</td>
<td></td>
</tr>
<tr>
<td rowspan="13">Layer)</td>
<td></td>
</tr>
<tr>
<td>$H B 4 ^ { c }$</td>
<td>$+ 5 2$</td>
<td>Bytes</td>
</tr>
<tr>
<td>H B5c</td>
<td></td>
<td>Flit</td>
</tr>
<tr>
<td>H B6c</td>
<td rowspan="2"></td>
<td></td>
</tr>
<tr>
<td>H B7c</td>
<td>Format</td>
</tr>
<tr>
<td>H B8c</td>
<td></td>
<td></td>
</tr>
<tr>
<td>H B9c</td>
<td>+57</td>
<td></td>
</tr>
<tr>
<td>H B10c</td>
<td>$H B O ^ { C }$</td>
<td rowspan="2">+58</td>
<td rowspan="2"></td>
</tr>
<tr>
<td>H B11c</td>
<td>H B1c</td>
</tr>
<tr>
<td>H B12c</td>
<td>H B2c</td>
<td></td>
<td></td>
</tr>
<tr>
<td>H B13c</td>
<td>H B3c</td>
<td>+61</td>
<td></td>
</tr>
<tr>
<td>C1 B0d</td>
<td>C0 B0d</td>
<td>+62</td>
<td></td>
</tr>
<tr>
<td>C1 B1d</td>
<td>C0 B1d</td>
<td>+63</td>
<td></td>
</tr>
</table>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. H-slot Byte 0 through Byte 13, respectively (from Protocol Layer).

d. CRC0 Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

<table>
<tr>
<th>$\frac { 8 } { 8 }$ 192</th>
<th>$\frac { 5 } { 8 }$ 128</th>
<th>$\frac { 8 } { 8 }$</th>
<th>Byte 0</th>
<th></th>
<th></th>
<th>Figure</th>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>FH B0b</td>
<td>+0</td>
<td></td>
<td>3-25.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>FH B1b</td>
<td>+1</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+2</td>
<td>for</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td></td>
<td>Streaming</td>
<td>Format</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>6:</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Protocolª</td>
<td>Latency-Optimized</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>62B</td>
<td></td>
<td>62B</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>of</td>
<td>Flit</td>
<td>of</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Flit</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Flit</td>
<td></td>
<td></td>
<td>62B</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Chunk</td>
<td rowspan="2">Chunk 2</td>
<td rowspan="2">Chunk</td>
<td rowspan="2">of Flit</td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2">256B</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>3</td>
<td>64B</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>with</td>
</tr>
<tr>
<td>(from</td>
<td>(from</td>
<td>(from</td>
<td>Chunk</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Protocol</td>
<td>Protocol</td>
<td>Protocol</td>
<td>(from</td>
<td></td>
<td></td>
<td>Optional</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Layer)</td>
<td>Protocol</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Layer)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Layer)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Bytes</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>Layer)</td>
<td></td>
<td></td>
<td>Flit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Format</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+61</td>
<td></td>
<td></td>
</tr>
<tr>
<td>C1 B0c</td>
<td></td>
<td>CO BOC</td>
<td></td>
<td>+62</td>
<td></td>
<td></td>
</tr>
<tr>
<td>C1 B1c</td>
<td></td>
<td>C0 B1c</td>
<td></td>
<td>+63</td>
<td></td>
<td></td>
</tr>
</table>

a. See Figure 2-1 for color mapping.

b. Flit Header Byte 0 and Byte 1, respectively.

c. CRC0 Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively.

<table>
<tr>
<th>c. CRC0 b. Flit Header</th>
<th>a. See Figure</th>
<th>Byte 192</th>
<th>Byte 128</th>
<th>Byte 64</th>
<th>$\frac { 5 } { 8 }$</th>
<th></th>
<th></th>
<th>Figure</th>
</tr>
<tr>
<td>Byte</td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"></td>
<td>FH B0b</td>
<td>+0</td>
<td></td>
<td>3-26.</td>
</tr>
<tr>
<td>0, Byte</td>
<td>2-1</td>
<td></td>
<td></td>
<td>$F H B 1 ^ { b } + 1$</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>CRC0 Byte 0 and</td>
<td>for color</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+2</td>
<td>for Management</td>
<td>Format</td>
</tr>
<tr>
<td>1, Byte</td>
<td>mapping.</td>
<td>52B</td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td></td>
<td></td>
<td>6:</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>CRC1 1,</td>
<td></td>
<td>of</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Flit</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Byte</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0, respectively.</td>
<td></td>
<td>Chunk</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Transport</td>
<td>Latency-Optimized</td>
</tr>
<tr>
<td>and</td>
<td></td>
<td>3</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>62B</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>CRC1</td>
<td></td>
<td>(from</td>
<td>Flit</td>
<td>of</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Flit</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>62B</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Byte</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1,</td>
<td></td>
<td>Protocol</td>
<td>Chunk</td>
<td>Chunk</td>
<td>of</td>
<td></td>
<td>Protocolª</td>
<td>256B</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Layer)</td>
<td>2</td>
<td>1</td>
<td>Flit</td>
<td></td>
<td></td>
<td>with</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>64B</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>respectively.</td>
<td></td>
<td></td>
<td>(from</td>
<td>(from</td>
<td>Chunk 0</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>Protocol</td>
<td>Protocol</td>
<td>(from</td>
<td></td>
<td></td>
<td>Optional</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Protocol</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Layer)</td>
<td></td>
<td>+51</td>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td></td>
<td rowspan="2">Layer)</td>
<td></td>
<td></td>
<td>+52</td>
<td></td>
<td>Bytes</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Flit</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Rsvd 6B</td>
<td></td>
<td></td>
<td>Layer)</td>
<td></td>
<td></td>
<td>Format</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+57</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td rowspan="2"></td>
<td>(from Protocol 4B CRD Layer)</td>
<td></td>
<td></td>
<td></td>
<td>+58</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+61</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>C1 B0c</td>
<td></td>
<td>CO BOC</td>
<td></td>
<td>+62</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>C1 B1c</td>
<td></td>
<td>C0 B1c</td>
<td></td>
<td>+63</td>
<td></td>
<td></td>
</tr>
</table>

The Flit Header byte formats are the same as Table 3-5 when Retry is required; otherwise, they are
the same as Table 3-4. The DLP rules are also the same as defined in Section 3.3.3 for CXL protocol,
except that Flit_Marker/Optimized_Update_FC has dedicated space in the Flit (i.e., bit [4] of Byte 0
corresponds to the Flit_Marker bytes, and not the DLP bytes). If Optimized_Update_FC is sent, the
DLP Bytes 2:5 shown in Figure 3-20 must be reserved. If bit [4] of Byte 0 in the Flit Header is 0b,
then the Flit_Marker bytes are reserved.

## 3.3.5 Flit Format-related Implementation Requirements for Protocol Layer and Adapter

Table 3-6 lists the different Flit Formats supported in UCIe.

<table>
<caption>Table 3-6. Summary of Flit Formats</caption>
<tr>
<th>Format Number</th>
<th>Name</th>
<th>Notes</th>
<th>For Details, See Also</th>
</tr>
<tr>
<td>$F o r m a t$ 1</td>
<td>Raw</td>
<td>Protocol Layer populates all the bytes on FDI. Adapter passes to RDI without modifications or additions.</td>
<td>· Section 3.3.1 · Figure 3-10</td>
</tr>
<tr>
<td>$F o r m a t \quad 2$</td>
<td>68B Flit</td>
<td>Protocol Layer transmits 64B per Flit on FDI. Adapter inserts two bytes of Flit header and two bytes of CRC and performs the required barrel shifting of bytes before transmitting on RDI. On the RX, Adapter strips out the Flit header and CRC only sending the 64B per Flit to the Protocol Layer on FDI.</td>
<td>· Section 3.3.2 · Figure 3-11 · Figure 3-12</td>
</tr>
<tr>
<td>Format 3</td>
<td>$S t a n d a r d \quad 2 5 6 B \quad E n d$ Header Flit</td>
<td>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received modifying any bits applicable Layer must ignore any bits { \text { Jle to the Protocol Layer and Layer without } }<br>{ \text { not applicable for it. Flit Header is located } } on Byte 236 and Byte 237</td>
<td>· Section 3.3.3 · Figure 3-14 · Figure 3-15</td>
</tr>
<tr>
<td>Format 4</td>
<td>$S t a n d a r d \quad 2 5 6 B$ Start Header Flit</td>
<td>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received from the Link to the Protocol Layer without { \text { Layer must ignore any bits nota applicable for iti } . \text { and the protocol } }<br>{ \text { on Byte 0 and Byte 1 of the Flit } }</td>
<td>· Section 3.3.3 · Figure 3-17 · Figure 3-18</td>
</tr>
<tr>
<td>Format 5</td>
<td>Latency-Optimized 256B without Optional Bytes Flit</td>
<td>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received from the Link to the Protocol Layer without $L a y e r \quad m u s t \quad i g n o r e \quad a n y \quad b i t s \quad n o t \quad a p p l i c a b l e \quad f o r \quad i t . C R C \quad b y t e s \quad s e n t \quad w i t h$ in not used by the Protocol Layer.</td>
<td>· Section 3.3.4 · Figure 3-20 · Figure 3-21</td>
</tr>
<tr>
<td>Format 6</td>
<td>Latency-Optimized 256B with Optional Bytes Flit</td>
<td>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the and CRC information before transmitting on RDI. $R x _ { \prime }$ forwards the Flit received from the Link to the Protocol Layer without modifying any bits applicable to the Protocol Layer, and the Protocol Layer must ignore any bits not applicable for it. CRC bytes sent $w i t h$ each 128B of the Flit, and optional bytes are used by the Protocol Layer.</td>
<td>· Section 3.3.4 · $F i g u r e \quad 3 - 2 3$ · Figure 3-24 · Figure 3-25</td>
</tr>
</table>

Table 3-7 gives the implementation requirements and Protocol Mapping for the different Flit Formats.
For PCIe and CXL protocols, the implementation requirements must be followed by the Protocol Layer
as well as the Adapter implementations. For Streaming protocols, the implementation requirements
are for the Adapter only; Protocol Layer interoperability and implementation requirements are vendor
specific.

<table>
<caption>Table 3-7. Protocol Mapping and Implementation Requirements</caption>
<tr>
<th>Format Number</th>
<th>Flit Format Name</th>
<th>PCIe { \text { Non-ril } }<br>{ \text { Mode } }</th>
<th>PCIe Flit Mode</th>
<th>$C X L \quad 6 8 B$</th>
<th>CXL 256B Flit Mode</th>
<th>Streaming Protocol</th>
<th>Management Transport Protocol</th>
</tr>
<tr>
<td>1</td>
<td>Raw</td>
<td>Optional</td>
<td>Optional</td>
<td>Optional</td>
<td>Optional</td>
<td>Mandatory</td>
<td>Optional</td>
</tr>
<tr>
<td rowspan="2">2</td>
<td>68B $\left( < = 3 2 G T / s \right) ^ { a }$</td>
<td>$\mathrm { M a n d a t o r y }$</td>
<td>$N / A$</td>
<td>$\mathrm { M a n d a t o r y }$</td>
<td>$N / A$</td>
<td>$\mathrm { O p t i o n a l } ^ { \mathrm { b } }$</td>
<td>$N / A$</td>
</tr>
<tr>
<td>68B $\left( > 3 2 G T / s \right) ^ { a }$</td>
<td>Not Supported</td>
<td></td>
<td colspan="4"></td>
</tr>
<tr>
<td>3</td>
<td>$S t a n d a r d \quad 2 5 6 B$</td>
<td>$N / A$</td>
<td>Mandatory</td>
<td>$N / A$</td>
<td>$N / A$</td>
<td>$\mathrm { O p t i o n a l } ^ { \mathrm { b } }$</td>
<td>Optional</td>
</tr>
<tr>
<td>4</td>
<td>$S t a n d a r d \quad 2 5 6 B$ $\mathrm { S t a r t } \mathrm { H e a d e r }$</td>
<td>$N / A$</td>
<td>$\mathrm { O p t i o n a l } ^ { \mathrm { C } }$</td>
<td>$N / A$</td>
<td>$\mathrm { M a n d a t o r y }$</td>
<td>$\mathrm { O p t i o n a l } ^ { \mathrm { b } }$</td>
<td>$\mathrm { O p t i o n a l }$</td>
</tr>
<tr>
<td>5</td>
<td>Latency- $\mathrm { O p t i m i z e d }$ 256B without Optional Bytes</td>
<td>$N / A$</td>
<td>$N / A$</td>
<td>$N / A$</td>
<td>Optional</td>
<td>$\mathrm { O p t i o n a l } ^ { b }$</td>
<td>Optional</td>
</tr>
<tr>
<td>6</td>
<td>Latency- $\mathrm { O p t i m i z e d }$ 256B with Optional Bytes</td>
<td>$N / A$</td>
<td>Strongly Recommendedd</td>
<td>$N / A$</td>
<td>$\mathrm { s t r o n g l y }$</td>
<td>Strongly Recommendedb</td>
<td>Optional</td>
</tr>
</table>

a. Refers to the negotiated maximum data rate.

b. If Streaming Flit Format capability is supported, else it is N/A.

c. If Standard Start Header for PCIe protocol capability is supported, else it is N/A.

d. If Latency-Optimized Flit with Optional Bytes for PCIe protocol capability is supported, else it is N/A.
If Enhanced Multi-Protocol capability is supported where at least one of the stacks supports PCIe, this format and the
corresponding capability are strongly recommended.

# 3.4 Decision Table for Flit Format and Protocol

Table 3-8 shows the Truth Table for determining Protocol. Once the protocol and Flit Format have been
negotiated during initial Link bring up, they cannot be changed until the UCIe Physical Layer
transitions to Reset state.

If a valid Protocol and Flit Format are not negotiated, then the Adapter takes the Link down and
reports the error if applicable.

<table>
<caption>Table 3-8. Truth Table for Determining Protocolª</caption>
<tr>
<th colspan="5">{FinCap.Adapter} bits or {MultiProtFinCap.Adapter} bitsb</th>
<th colspan="2">{FinCap.CXL} bits</th>
<th rowspan="2">Protocol</th>
</tr>
<tr>
<th>68B Flit Mode</th>
<th>CXL 256B Flit Mode</th>
<th>PCIe Flit Mode</th>
<th>Streaming Protocol</th>
<th>Management Transport Protocol</th>
<th>PCIe</th>
<th>CXL.io</th>
</tr>
<tr>
<td>1º</td>
<td>0</td>
<td>0</td>
<td>$X$ ☒</td>
<td>☒ x</td>
<td>0</td>
<td>1</td>
<td>CXLd without Management Transport protocol</td>
</tr>
<tr>
<td>a. 1e b. $0 ^ { \text { e } }$</td>
<td>1</td>
<td>1</td>
<td>$X$ ☒</td>
<td>0</td>
<td>0</td>
<td>$1 ^ { f }$</td>
<td>$\mathrm { C X L } ^ { \mathrm { d } } \mathrm { w i t h o u t } \mathrm { M a n a a c m e n t }$ Transport protocol</td>
</tr>
<tr>
<td>a. 1e b. $0 ^ { \text { e } }$</td>
<td>1</td>
<td>1</td>
<td>$X$ ☒</td>
<td>1</td>
<td>0</td>
<td>$1 ^ { f }$</td>
<td>CXLd with Management Transport protocol</td>
</tr>
<tr>
<td>$1 ^ { c }$</td>
<td>0</td>
<td>0</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>1</td>
<td>0</td>
<td>{ \text { PCIe9 without Management } }<br>{ \text { Transoort orotocol } }</td>
</tr>
<tr>
<td>a. 1e b. $0 ^ { \mathrm { e } }$</td>
<td>0</td>
<td>1</td>
<td>$X$ ☒</td>
<td>0</td>
<td>$1 ^ { h }$</td>
<td>0</td>
<td>PCIe without Management Transport protocol</td>
</tr>
<tr>
<td>a. 1e b. $0 ^ { \mathrm { e } }$</td>
<td>0</td>
<td>1</td>
<td>$X$ ☒</td>
<td>1</td>
<td>$1 ^ { h }$</td>
<td>0</td>
<td>$P C I e \quad w i t h \quad M a n a g e m e n t$</td>
</tr>
<tr>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>$N / A$</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>{ \text { Streamingi with or without } }<br>{ \text { Management Transport } } protocol</td>
</tr>
<tr>
<td>N/A</td>
<td>$N / A$</td>
<td>N/A</td>
<td>$N / A$</td>
<td>$N / A$</td>
<td>N/A</td>
<td>$N / A$</td>
<td>Management Transport protocol]</td>
</tr>
</table>

a. x indicates don't care in this Table.

b. If Enhanced_Multi-Protocol capability is negotiated then {MultiProt \*. Adapter} messages are used to determine the protocol for
Stack 1. Stack 0 protocol is determined using the {FinCap .\* } messages.

c. 68B Flit Mode must only be advertised if the negotiated maximum data rate is <= 32 GT/s.

d. For CXL protocol, the specific combination of Single Protocol vs Type 1 vs. Type 2 vs. Type 3 is determined using the CXL.cache
and CXL.mem capable/enable bits in addition to the CXL.io capable/enable bit in {FinCap.CXL}. The rules for that follow CXL
Specification. When CXL is the protocol, if CXL 256B Flit mode is 1, then the protocol follows CXL 256B Flit mode rules; otherwise,
the protocol follows CXL 68B Flit mode rules.

e. 68B Flit Mode must only be advertised if the negotiated maximum data rate is <= 32 GT/s. The value of 1 will be sent if the
negotiated maximum data rate is <= 32 GT/s. The value of 0 will be sent if the negotiated maximum data is > 32 GT/s.

f. CXL.io capable/enable must be 1 if CXL 256B Flit mode is negotiated.

g. For PCIe protocol, if PCIe Flit mode is 1, then the protocol follows PCIe Flit mode rules; otherwise, the protocol follows PCIe Non-
Flit mode rules.

h. PCIe capable/enable must be 1 if PCIe Flit mode is 1 but CXL 256B Flit mode is 0.

i. No sent for Streaming protocol negotiation, Streaming is the negotiated protocol if PCIe or CXL are not
{ \text { \left\{FinCap.*\right\} messayng } }<br>{ \text { vertised, but Streaming } } protocol is advertised. If Management Transport protocol was also advertised along with Streaming
protocol, then Transport protocol is enabled along with Streaming protocol.

j. No {FinCap .* } message is sent for Management Transport protocol negotiation, Management Transport is the negotiated
protocol if PCIe or CXL or Streaming are not advertised, but Management Transport protocol is advertised.

## IMPLEMENTATION NOTE

If the negotiated maximum data rate is <= 32 GT/s, the "68B Flit Mode" parameter is
advertised as set to 1 for both the CXL and PCIe protocols in {AdvCap.Adapter}
sideband messages. As seen in Table 3-8, this parameter is set to 1 in
{FinCap.Adapter} sideband messages whenever the CXL OR PCIe protocols are
negotiated and the negotiated maximum data rate is <= 32 GT/s; otherwise, this
parameter is cleared to 0.

The "CXL.io" and "PCIe" bits in the {AdvCap.CXL} sideband message disambiguate
between CXL support vs. PCIe support. It is permitted to set both to 1 in
{AdvCap.CXL} sideband messages. However, as seen in Table 3-8, only one of these
must be set in the {FinCap.CXL} sideband message to reflect the final negotiated
protocol for the corresponding stack. For example:

· If the DP and UP both support CXL and PCIe protocols, then both "CXL.io" and
"PCIe" will be set to 1 in the {AdvCap.CXL} sideband message

. If the DP decides to operate in CXL, the DP will set "CXL.io" to 1 and clear "PCIe"
to 0 in the {FinCap.CXL} sideband message, in which case the remaining CXL-
related bits in the {FinCap.CXL} sideband message are also applicable and are
assigned as per the negotiation

Table 3-9 (Truth Table 1) shows the truth table for deciding the Flit format in which to operate if PCIe
or CXL protocols are negotiated (with or without Management Transport protocol), and none of the
following are negotiated:

· Enhanced Multi_Protocol_Enable

· Standard 256B Start Header for PCIe protocol capability

· Latency-Optimized Flit with Optional Bytes for PCIe protocol capability

Table 3-10 (Truth Table 2) provides the Truth Table for determining the Flit Format for Streaming
protocols if Streaming Flit Format capability is negotiated or if Management Transport protocol is
negotiated without CXL or PCIe or Streaming protocols on the same stack. Note that for Streaming
protocol negotiation or for Management Transport protocol negotiation without CXL or PCIe protocol
multiplexed on the same stack, there are no {FinCap .* } messages exchanged. Each side of the UCIe
Link advertises its own capabilities in the {AdvCap.Adapter} message it sends. The bits in Table 3-10
represent the logical AND of the corresponding bits in the sent and received {AdvCap.Adapter}
messages. Truth Table 2 must be followed for determining the Flit Format if both sides of the Link
have any of the following capabilities are supported and enabled for both sides of the Link:

· Enhanced Multi-Protocol Capability

· Standard Start Header Flit for PCIe protocol capability

· Latency-Optimized Flit with Optional Bytes for PCIe protocol capability

For situations where {FinCap.Adapter} messages are sent, the bits in the truth table represent the
bits set in the {FinCap.Adapter} message.

It is permitted for the Adapter OR the Protocol Layer to take the Link down to LinkError if the desired
Flit Format is not negotiated or the negotiated Flit format and protocol combination is illegal (e.g., 68B
Flit Format 2 and Management Transport protocol combination).

<table>
<caption>Table 3-9. Truth Table 1</caption>
<tr>
<th colspan="6">{FinCap.Adapter} bitsª</th>
<th rowspan="2">Flit Format</th>
</tr>
<tr>
<th>Raw Format</th>
<th>68B Flit Mode</th>
<th>CXL 256B Flit Mode</th>
<th>PCIe Flit Mode</th>
<th>CXL_LatOpt Fmt5</th>
<th>CXL_LatOpt Fmt6</th>
</tr>
<tr>
<td>1</td>
<td>X ☒</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>Format 1: Raw Format</td>
</tr>
<tr>
<td>0</td>
<td>$x$ ☒</td>
<td>1</td>
<td>$x$ ☒</td>
<td>0</td>
<td>0</td>
<td>{ \text { Format } 4 : \text { Standard } 2 5 6 B \text { Start } }<br>{ \text { Header Flit Format for } C X L }</td>
</tr>
<tr>
<td>0</td>
<td>X ☒</td>
<td>1</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>1</td>
<td>{ \text { Format } 6 : \text { Latency-Optimized } 2 5 6 E }<br>{ \text { with Optional Bytes Flit Format for } }</td>
</tr>
<tr>
<td>0</td>
<td>$X$ ☒</td>
<td>1</td>
<td>$X$ ☒</td>
<td>1</td>
<td>0</td>
<td>{ \text { Format } 5 : \text { Latency- Optimuzed 250E } }<br>{ \text { without Optional Bytes Flit Format } } for CXL</td>
</tr>
<tr>
<td>0</td>
<td>X ☒</td>
<td>0</td>
<td>1</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>$F o r m a t \quad 3 : S t a n d a r d \quad 2 5 6 B \quad E n d$</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>$F o r m a t \quad 2 : 6 8 B \quad F l i t \quad F o r m a t$</td>
</tr>
</table>

a. x indicates don't care.
☒

<table>
<caption>Table 3-10. Truth Table 2</caption>
<tr>
<th colspan="6">Logical AND of Corresponding Bits in the Sent and Received {AdvCap.Adapter} Message OR the Bits Sent in the {FinCap.Adapter} Messagec</th>
<th rowspan="2">Final Negotiated Flit Formatª</th>
</tr>
<tr>
<th>Raw Formatb</th>
<th>68B Flit Formatc</th>
<th>Standard 256B $E n d \quad H e a d e r$</th>
<th>Standard 256B Start Header Flit Format</th>
<th>Latency- Optimized 256B without Optional Bytes Flit Format</th>
<th>Latency- Optimized 256B with Optional Bytes Flit Format</th>
</tr>
<tr>
<td>1</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>☒ x</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>Format 1: Raw Format</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>$X$ ☒</td>
<td>0</td>
<td>Format 2: 68B Flit Format</td>
</tr>
<tr>
<td>0</td>
<td>$X$ ☒</td>
<td>1</td>
<td>0</td>
<td>$X$ ☒</td>
<td>0</td>
<td>{ \text { Format } 3 : \text { Standard } 2 5 6 E }<br>{ \text { End Header Flit Format } }</td>
</tr>
<tr>
<td>0</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>1</td>
<td>$X$ ☒</td>
<td>0</td>
<td>Format 4: Standard 256B Start Header Flit Format</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>Format 5: Latency- Optimized 256B without Optional Bytes Flit Format</td>
</tr>
<tr>
<td>0</td>
<td>X ☒</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>$X$ ☒</td>
<td>1</td>
<td>Format 6: Latency- Optimized 256B with Optional Bytes Flit Format</td>
</tr>
</table>

a. Format 6 is the highest priority format when Raw Format is not advertised because it has the best performance characteristics.
Between Format 4 and Format 3, Format 4 is higher priority because it enables lower latency through the D2D Adapter when
multiplexing different protocols. Format 5 has the highest overhead and therefore has the lowest priority relative to other
formats.

b. Raw Format is always explicitly enabled through UCIe Link Control register and advertised only when it is the required format of
operation to ensure interoperability, and therefore appears as a higher priority in the decision table.

c. x indicates don't care.
☒

# 3.5 State Machine Hierarchy

UCIe has a hierarchical approach to Link state management in order to have well-defined functionality
partitioning between the different layers and also enabling common state transitions or sequencing at
FDI and RDI.

Figure 3-27 shows examples of state machine hierarchy for different configurations. For CXL, the
ARB/MUX vLSMs are exposed on FDI pl_state_sts. The Adapter LSM is used to coordinate Link
states with remote Link Partner and is required for all configurations. Each protocol stack has its
corresponding Adapter LSM. For PCIe or Streaming protocols, the Adapter LSM is exposed on FDI
pl_state_sts.

The RDI state machine (SM) is used to abstract the Physical Layer states for the upper layers. The
Adapter data path and RDI data width can be extended for multi-module configurations; however,
there is a single RDI state machine for this configuration. The Multi-module PHY Logic creates the
abstraction and coordinates between the RDI state and individual modules. The following rules apply:

· vLSM state transitions are coordinated with remote Link partner using ALMPs on mainband data
path. The rules for state transitions follow the CXL 256B Flit Mode rules in the CXL Specification.

· Adapter LSM state transitions are coordinated with remote Link partner using
{LinkMgmt.Adapter*} sideband messages. These messages are originated and received by the
D2D Adapter.

· RDI SM state transitions are coordinated with the remote Link partner using {LinkMgmt.RDI*}
sideband messages. These messages are originated and received by the Physical Layer.

<figure>
<figcaption>Figure 3-27. State Machine Hierarchy Examples</figcaption>

FDI

FDI

FDI

ARB/MUX

vLSM

vLSM

Adapter $L S M$

Adapter $L S M$

-RDI.

RDI SM

RDI-

RDI SM

(a) CXL example

(b) PCIe or Streaming example

</figure>

General rules for State transition hierarchy are captured below. For specific sequencing, see the rules
outlined in Chapter 10.0.

. Active State transitions: RDI SM must be in Active before Adapter LSM can begin negotiation to
transition to Active. Adapter LSM must be in Active before vLSMs can begin negotiations to
transition to Active.

· Retrain State transitions: RDI SM must be in Retrain before propagating Retrain to Adapter LSMs.
If RDI SM is in Retrain, Retrain must be propagated to all Adapter LSMs that are in Active state.

Adapter must not request Retrain exit on RDI before all the relevant Adapter LSMs have
transitioned to Retrain.

· PM State transitions (both L1 and L2): Both CXL.io and CXL.cachemem vLSMs (if CXL), must
transition to PM before the corresponding Adapter LSM can transition to PM. All Adapter LSMs
(if multiple stacks are enabled on the same Adapter) must be in PM before RDI SM is transitioned
to PM.

. LinkError State transitions: RDI SM must be in LinkError before Adapter LSM can transition to
LinkError. RDI SMs coordinate LinkError transition with remote Link partner using sideband, and
each RDI SM propagates LinkError to all enabled Adapter LSMs. Adapter LSM must be in LinkError
before propagating LinkError to both vLSMs if CXL. LinkError transition takes priority over
LinkReset or Disabled transitions. Adapter must not request LinkError exit on RDI before all the
relevant Adapter LSMs and CXL vLSMs have transitioned to LinkError.

· LinkReset or Disabled State transitions: Adapter LSM negotiates LinkReset or Disabled transition
with its remote Link partner using sideband messages. LinkReset or Disabled is propagated to RDI
SM only if all the Adapter LSMs associated with it transition to LinkReset or Disabled. Disabled
transition takes priority over LinkReset transition. If RDI SM moves to LinkReset or Disabled, it
must be propagated to all Adapter LSMs. If Adapter LSM moves to LinkReset or Disabled, it must
propagate it to both vLSMs for CXL protocol.

For UCIe Retimers, it is the responsibility of the Retimer die to negotiate state transitions with the
remote Retimer partner and make sure the different UCIe Die are in sync and do not time out waiting
for a response. As an example, referring to Figure 1-18, if UCIe Die 0 sends an Active Request
message for the Adapter LSM to UCIe Retimer 0, UCIe Retimer 0 must resolve with UCIe Retimer 1
that an Active Request message has been forwarded to UCIe Die 1 and that UCIe Die 1 has responded
with an Active Status message before responding to UCIe Die 0 with an Active Status message. The
Off Package Interconnect cannot be taken to a low power state unless all the relevant states on UCIe
Die 0 AND UCIe Die 1 have reached the low power state. UCIe Retimers must respond with "Stall"
encoding every 4ms while completing resolution with the remote Retimer partner.

## 3.6 Power Management Link States

Power management states are mandatory for PCIe and CXL protocols. FDI supports L1 and L2 power
states which follow the handshake rules and state transitions of CXL 256B Flit Mode. RDI supports L1
and L2 on the interfaces for Physical Layer to perform power management optimizations; however,
the Physical Layer is permitted to internally map both L1 and L2 to a common state. These together
allow for global clock gating and enable system level flows like Package-Level Idle (C-states). Other
Protocols are permitted to disable PM flows by always sending a PMNAK for a PM request from remote
Link partner.

When Management Transport protocol is supported and negotiated with CXL.io/PCIe/Streaming on
the same stack, L1 and L2 entry requests to the Adapter from the Management Port Gateway
multiplexer (MPG mux) must comprehend L1 and L2 entry readiness of the Management Transport
protocol as well as the co-located protocol stack, in an implementation specific manner. Additionally,
the MPG mux must also follow the FDI semantics for PM rules of the co-located CXL.io/PCIe/
Streaming protocol. Similarly, L1 and L2 exit would wake both the Management Transport protocol
and as well as the co-located protocol stack, and exit flow semantics must adhere to the negotiated
CXL.io/PCIe/Streaming protocol.

The Power management state entry sequence is as follows:

1\. Protocol Layer PM entry request: FDI defines a common flow for PM entry request at the
interface that is based on Link idle time. All protocols using UCIe must follow that flow when PM
needs to be supported. For CXL protocol, D2D Adapter implements the ARB/MUX functionality and
follows the handshakes defined in CXL Specification (corresponding to the "CXL 256B Flit Mode",

since all ALMPs also go through the Retry buffer in UCIe). Even CXL 68B Flit Mode over UCIe uses
the "CXL 256B Flit Mode" ALMP formats and flows (but the Flit is truncated to 64B and two bytes
of Flit header and two bytes of CRC are added by the Adapter to make a 68B Flit). For PCIe
protocol in UCIe Flit Mode, PM DLLP handshakes are NOT used. Protocol Layer requests PM entry
on FDI based on Link idle time. The specific algorithm and hysteresis for determining Link idle
time is implementation specific.

2\. Adapter Link State Machine PM entry: The PM transition for this is coordinated over sideband
with remote Link partner. In scenarios where the Adapter is multiplexing between two protocol
stacks, each stack's Link State Machine must transition to PM independently.

3\. PM entry on RDI: Once all the Adapter's LSMs are in a PM state, the Adapter initiates PM entry
on the RDI as defined in Section 10.2.9.

4\. Physical Layer moves to a deeper PM state and takes the necessary actions for power
management. Note that the sideband Link must remain active because the sideband Link is used
to initiate PM exit.

<figure>
<figcaption>Figure 3-28. Example of Hierarchical PM Entry for CXL</figcaption>

ARB/MUX vLSM
Die 0

Adapter LSM
Die 0

Physical Layer SM
Die 0

D2D
CHANNEL

Physical Layer SM
Die 1

Adapter LSM
Die 1

ARB/MUX vLSM
Die 1

vLSM PM handshake using ALMPs
(Mainband)

Once both vLSMs are in PM, Retry buffer empty, then do Adapter LSM handshake
(Sideband)

Once all Adapter LSMs are in PM, Physical Layer handshake
(Sideband)

$P M$ Entry Complete-

</figure>

PM exit follows the reverse sequence of wake up as mentioned below:

1\. Active request from Protocol Layer is transmitted across the FDI and RDI to the local Physical
Layer.

2\. The Physical Layer uses sideband to coordinate wake up and retraining of the physical Link.

3\. Once the physical Link is retrained, the RDI is in Active state on both sides, and the Adapter LSM
PM exit is triggered from both sides (coordinated via sideband messages between Adapters as
outlined in the FDI PM flow). For PCIe or Streaming protocol scenarios, this also transitions the
Protocol Layer to Active state on FDI.

4\. For CXL protocol, this step is followed by ALMP exchanges to bring the required protocol to Active
state and then protocol Flit transfer can begin.

## 3.7 CRC Computation

The CRC generator polynomial is $\left( x + 1 \right) ^ { * } \left( x ^ { 1 5 } + x + 1 \right) = x ^ { 1 6 } + x ^ { 1 5 } + x ^ { 2 } + 1 .$ This gives a 3-bit
detection guarantee for random bit errors: 2 bit detection guarantee is because of the primitive
polynomial $\left( x ^ { 1 5 } + x + 1 \right) ,$ and 1 additional bit error detection guarantee is provided by making it odd
parity because of the (x+1) term in the polynomial.

The CRC is always computed over 128 bytes of the message. For smaller messages, the message is
zero extended in the MSB. Any bytes which are part of the 128B CRC message but are not
transmitted over the Link are assigned to 0b. Whenever non-CRC bytes of the Flit populated by the
Adapter are included for CRC computation (e.g., the Flit Header or DLP bytes), CRC is computed after
the Adapter has assigned those bytes the values that will be sent over the UCIe Link. Any reserved
bits which are part of the Flit are assigned 0b for the purpose of CRC computation.

The initial value of CRC bits for CRC LFSR computation is 0000h. The CRC calculation starts with bit 0
of byte 0 of the message, and proceeds from bit 0 to bit 7 of each byte as shown in Figure 3-29. In
the figure, C[15] is bit 7 of CRC Byte 1, C[14] is bit 6 of CRC Byte 1 and so on; C[7] is bit 7 of CRC
Byte 0, C[6] is bit 6 of CRC Byte 0 and so on.

The Verilog code for CRC code generation is provided in crc_gen.vs (attached to the PDF copy of this
Specification). This Verilog code must be used as the golden reference for implementing the CRC
during encode or decode. The code is provided for the Transmit side. It takes 1024 bits (bit 1023 is bit
7 of message Byte 127, 1022 is bit 6 of message Byte 127 and so on; bit 1015 is bit 7 of message
Byte 126 and so on until bit 0 is bit 0 of message Byte 0) as an input message and outputs 16 bits of
CRC. On the Receiver, the CRC is computed using the received Flit bytes with appropriate zero
padding in the MSB to form a 128B message. If the received CRC does not match the computed CRC,
the flit is declared Invalid and a replay must be requested.

<figure>
<figcaption>Figure 3-29. Diagram of CRC Calculation</figcaption>

Message Byte 127

Message Byte 1

Message Byte 0

76543210

Bit order

Byte Order

\+

\+

\+

$C \left[ 0 \right]$

c[1]

C[2]

C[3]

C[4]

C[5]

C[6]

C[7]

C[8]

C[9]

C[10]

C[11]

C[12]

C[13]

C[14]

C[15]

</figure>

## 3.8 Retry Rules

For configurations where the raw BER is higher than 1e-27, Retry must be supported in the Adapter,
unless the only format of operation is Raw Format. If Retry is not supported by the Adapter, Link
speeds where the raw BER is higher than 1e-27 must NOT be advertised by the Physical Layer during
Link Training, unless the format of operation is Raw Format. See Table 5-32 for the raw BER
characteristics of different configurations. Once Retry has been negotiated during Part 2 of Stage 3 of
Link Initialization described in Section 3.2.1.2, it cannot be disabled even if Link speed degrades
during runtime. Retry can only be re-negotiated at the next Link Initialization (i.e., RDI moves to
Reset). For multiple stacks with a common Adapter, the Tx Retry buffer is shared between the stacks.

The Retry scheme on UCIe is a simplified version of the Retry mechanism for Flit Mode defined in PCIe
Base Specification. The rules that differ from PCIe are as follows:

· Selective Nak and associated rules are not applicable and must not be implemented. Rx Retry
Buffer-related rules are also not applicable and must not be implemented.

· Throughout the duration of Link operation, when not conflicting with PCIe rules of replay, Explicit
Sequence number Flits and Ack/Nak Flits alternate. This allows for faster Ack turnaround and thus
smaller Retry buffer sizes. It is permitted to send consecutive Explicit Sequence number Flits if
there are no pending Ack/Nak Flits to send (see also the Implementation Note below). To meet
this requirement, all Explicit Sequence Number Flit transmissions described by the PCIe rules of
replay that require the condition "CONSECUTIVE_TX_EXPLICIT_SEQ_NUM_FLIT < 3" to be met
require "CONSECUTIVE_TX_EXPLICIT_SEQ_NUM_FLIT < 1" to be met instead, and it is not
required to send three consecutive Flits with Explicit Sequence Number.

· All 10-bit retry related counters are replaced with 8-bit counters, and the maximum-permitted
sequence number is 255 (hence 1023 in all calculations is replaced with 255 and any variables
defined in the "Flit Sequence Number and Retry Mechanism" section of PCIe Base Specification
which had an initial value of 1023 instead have an initial value of 255).

· REPLAY_TIMEOUT_FLIT_COUNT is a 9-bit counter that saturates at 1FFh.

\- In addition to incrementing REPLAY_TIMEOUT_FLIT_COUNT as described in PCIe Base
Specification, the count must also be incremented when in Active state and a Flit Time
(Number of Adapter clock cycles (lclk) that are required to transfer 256B of data at the
current Link speed and width) has elapsed since the last flit was sent and neither a Payload
Flit nor a NOP flit was transmitted. The counter must be incremented for every Flit Time in
which a flit was not sent (this could lead to it being incremented several times in-between flits
or prior to the limit being met). The added requirement compensates for the noncontinuous
transfer of NOP flits. For 68B Flit Format, data transfers are also in 256B granularity (including
the PDS bytes), and thus this counter increments every time 256B of data are transmitted,
OR during idle conditions in Active state, it must be incremented according to the time that is
required to transfer 256B of data at the current Link speed and width.

\- Replay Schedule Rule 0 of PCIe Base Specification must check for
REPLAY_TIMEOUT_FLIT_COUNT ≥ 375. Replay Timer Timeout error is logged in the
Correctable Internal Error in the Adapter for UCIe.

. For the FLIT_REPLAY_NUM counter, it is strongly recommended to follow the rules provided in
PCIe Base Specification for speeds ≤ 32.0 GT/s. This counter tracks the number of times that a
Replay has occurred without making forward progress. Given the significantly lower probability of
Replay for UCIe Links, the rules associated with ≤ 32.0 GT/s PCIe speeds are sufficient for UCIe.

· NAK_WITHDRAWAL_ALLOWED is always cleared to 0. Note that this requires implementations to
set the flag NAK_SCHEDULED=1 in the "Nak Schedule 0" set of rules.

. IDLE Flit Handshake Phase is not applicable. This is because the transition to Link Active
(equivalent to LTSSM being in L0 for PCIe) is managed via handshakes on sideband, and there is
no requirement for IDLE Flits to be exchanged. As per PCIe rules, any Flits received with all 0s in

the Flit Header bytes are discarded by the Adapter. Any variables that are initialized during the
IDLE Flit Handshake Phase in PCIe Base Specification are initialized to the corresponding value
whenever the RDI is in Reset state or Retrain state. Similarly, PCIe rules that indicate relation to
"last entry to IDLE Flit Handshake Phase" would instead apply for UCIe to "last exit from Reset or
Retrain state on RDI".

· Variables applicable to Flit Sequence number and Retry mechanism that are initialized during
DL_Inactive, as with PCIe, would be initialized to their corresponding values when RDI is in Reset
state for UCIe.

· Sequence Number Handshake Phase must be performed as part of every FDI Active Entry
Handshake (see Section 10.2.8). Sequence Number Handshake Phase timeout and exit to Link
Retrain is 128 Flits transmitted without exiting Sequence Number Handshake Phase. As with PCIe,
both NOP flits or Payload flits are permitted to be used to complete the Sequence Number
Handshake Phase. If there are no Payload flits to send, the Adapter must generate NOP flits to
complete the Sequence Number Handshake Phase.

. The variable "Prior Flit was Payload" is always set to 1. This bit does not exist in the Flit Header,
and thus from the Retry perspective, implementations must assume that it is always set to 1.

· MAX_UNACKNOWLEDGED_FLITS is set to the lesser of:

\- Number of Flits that can be stored in the Tx Retry Buffer, or

\- 127

. Flit Discard 2 rule from PCIe does not result in a Data Link Protocol Error condition in UCIe.
Receiving an invalid Flit Sequence number in a received Ack or Nak flit (see the corresponding
conditions in PCIe Base Specification with the adjusted variable widths and values) OR a Payload
Flit with an Explicit Sequence number of 0 results in an Uncorrectable Internal Error in UCIe
(instead of a Data Link Protocol Error).

· Conditions from the "Flit Sequence Number and Retry Mechanism" section in PCIe Base
Specification that led to Recovery for the Port must result in the Adapter initiating Retrain on the
RDI for UCIe.

### IMPLEMENTATION NOTE

In UCIe, to encourage power savings through dynamic clock gating, it is not required
to continuously transmit NOP flits during periods in which there are no Payload flits or
any Ack/Nak pending. Consider an example in which an Adapter's Tx Retry Buffer is
empty and it transmitted a NOP flit with an Ack as the last flit before it stopped
sending additional flits to the Physical Layer. Let's say this flit had a CRC error and
hence the remote Link partner never receives this Ack. Moreover, because the remote
Link partner received a flit with a CRC error, it would transmit a Nak to original
sender. If the Ack is never re-sent and the remote Link partner has a corresponding
Payload flit in its Tx Retry Buffer, eventually a Replay Timeout will trigger from the
remote Link partner and resolve this scenario. However, rather than always relying on
Replay Timeout for these kind of scenarios, it is recommended for implementations to
ensure they have transmitted at least two flits with an Ack (these need not be
consecutive Ack flits) before stopping flit transfer whenever a Nak is received and the
transmitter has completed all the requirements of received Nak processing, including
any Replay related transfers. If no new Payload Flits were received from the remote
Link partner, as per PCIe rules, it is permitted to re-send the last transmitted Ack on
a NOP flit as well to meet this condition.

# 3.9 Runtime Link Testing using Parity

UCIe defines a mechanism to detect Link health during runtime by periodically injecting parity bytes
in the middle of the data stream when this mechanism is enabled. The receiver checks and logs parity
errors for the inserted parity bytes.

When this mechanism is enabled, the Adapter inserts 64\*N Bytes every 256\*256*N Bytes of data,
where N is obtained from the Error and Link Testing Control register (Field name: Number of 64 Byte
Inserts). Software must set N=4 when this feature is enabled during regular Link operation for UCIe
Flit mode because that makes the parity bytes also a multiple of 256B and is more consistent with the
granularity of data transfer. Only bit 0 of the inserted byte has the parity information which is
computed as follows:

ParityByte X, bit 0 = ^((DataByte [X]) ^ (DataByte [X + 64\*N]) ^(DataByte [X +
128\*N])^ .... ^(DataByte [X + (256\*256\*N - 64*N)]))

The remaining 7 bits of the inserted byte are Reserved.

The Transmitter and Receiver in the Adapter must independently keep track of the number of data
bytes elapsed to compute or check the parity information. All data bytes transmitted on the UCIe Link
(excluding the parity bytes themselves) are included for parity computation and count tracking (this
includes NOP Flits, and for 68B Flit Format, it includes the PDS Flit Header and associated zero
padding). If the RDI state moves away from Active state, the data count and parity is reset, and both
sides must renegotiate the enabling of the Parity insertion before next entry to Active from Retrain (if
the mechanism is still enabled in the Error and Link Testing Control register). When entering Active
state with Parity insertion enabled, the number of data bytes elapsed begins counting from 0. On the
transmitter, following the insertion of the parity information, the counter for the number of bytes
elapsed to compute the parity information is reset. On the Receiver, following the receipt and check of
parity bytes, the counter for the number of bytes elapsed to check the parity information is reset.

Parity insertion is independently enabled per direction of data transmission. For each direction of data
transmission, this mechanism is enabled by Software writing 1 to the "Runtime Link Testing Tx
Enable" bit in the "Error and Link Testing Control" register located in the transmitting Adapter (see
Section 9.5.3.9 for register details) and the "Runtime Link Testing Rx Enable" bit in the "Error and
Link Testing Control" register in the receiving Adapter. Parity insertion can be enabled in one direction
only, or simultaneously in both directions. Software must trigger UCIe Link Retrain after changing the
value of the corresponding enable bits on both adapters for the change to take effect. Support for this
feature in Raw Format is beyond the scope of this specification and is implementation-dependent. The
Adapters exchange sideband messages while the Adapter LSMs are in Retrain or L1 to ensure that the
remote Link partner's receiver is prepared to receive the extra parity bytes in the data stream once
the states transition to Active. For Active to Retrain transition, the Adapter that initiates the
{ParityFeature.Req} sideband message must not request Retrain exit to local RDI until a response for
this request has been received from the remote Link partner. For L1 exit, the Adapter that initiates the
{ParityFeature.Req} sideband message must not request L1 exit on the RDI until a response for this
request has been received from the remote Link partner. If an Adapter is only responding to the
{ParityFeature.Req} sideband message (i.e., only "Runtime Link Testing Rx Enable" is set to 1), the
Adapter must not delay the L1 exit or Retrain exit transitions on the RDI. It is permitted to enable
parity insertion during Initial Link bring up, by using sideband to access the remote Link partner's
registers or by other implementation-specific means; however software must trigger Link Retrain for
the feature to take effect. Software is permitted to disable L1 before enabling Runtime Link Testing
Parity.

Adapter sends a {ParityFeature.Req} sideband message to remote Link Partner if its Transmitter is
enabled to send parity bytes ("Runtime Link Testing Tx Enable" bit in Section 9.5.3.9). Remote
Adapter responds with a {ParityFeature.Ack} sideband message if its receiver is enabled and ready to
accept parity bytes ("Runtime Link Testing Rx Enable" bit in Section 9.5.3.9). Figure 3-30 shows an

example of a successful negotiation. If Die 0 Adapter Transmitter is enabled to insert parity bytes, it
must send a {ParityFeature.Req} sideband message from Die 0 to Die 1.

Adapter responds with a {ParityFeature.Nak} sideband message if the Adapter is not ready to accept
parity bytes, or if the feature has not been enabled for it yet. The requesting Adapter must log the
Nak in a status register so that Software can determine that a Nak had occurred. Figure 3-31 shows
an example of an unsuccessful negotiation. A timeout for this explicit Ack/Nak handshake must be
reported in the Header Log 2 register as Adapter Timeout encoding 0001b to indicate that the
parameter exchange flow timed out.

Note:
The Adapters are permitted to transition to a higher latency data path if the Parity
Feature is enabled. The explicit Ack/Nak handshake is provided to ensure both sides
have sufficient time to transition to alternate data path for this mechanism.

The Parity bytes do not consume Retimer receiver buffer credits. The Retimer receiver must not
write the Parity bytes into its receiver buffer or forward these to remote Retimer partner over the Off
Package Interconnect. This mechanism is to help characterize local UCIe Links only.

Parity insertion is disabled in a given direction by programming either "Runtime Link Testing Tx
Enable" in the transmitting Adapter or "Runtime Link Testing Rx Enable" in the receiving Adapter to 0
and then retraining the Link using the Retrain bit in the UCIe Link Control register.

<figure>
<figcaption>Figure 3-30. Successful Parity Feature negotiation between Die 1 Tx and Die 0 Rx</figcaption>

Adapter
Die 0

Physical layer
$D i e \quad 0$

CHANNEL

Physical layer
Die 1

Adapter
Die 1

Adapter LSMs and RDI is in Retrain

SB MSG {ParityFeature.Req}

Die 0 sends
{ParityFeature.Ack} in
response to accept the
request from Die 1. It's
Rx must be ready to
receive the extra
parity bytes before the
response is sent.

Die 1 sends
{ParityFeature.Req} if
it wants to enable
Parity insertion on its
Tx

SB MSG {ParityFeature.Ack}

RDI Active Entry Handshake followed by Adapter LSM Active Entry Handshake

</figure>

<figure>
<figcaption>Figure 3-31. Unsuccessful Parity Feature negotiation between Die 1 Tx and Die 0 Rx</figcaption>

Adapter
Die 0

{ \text { Physical layer } }<br>{ \text { Die } 0 }

CHANNEL

Physical layer
Die 1

Adapter
Die 1

Adapter LSMs and RDI is in Retrain

SB MSG {ParityFeature.Req}

Die 1 sends
{ParityFeature.Req} if
it wants to enable
Parity insertion on its
Tx

$D i e \quad 0 \quad s e n d s$
{ParityFeature.Nak} in
response to reject the
request from Die 1.

SB MSG {ParityFeature.Nak}

RDI Active Entry Handshake followed by Adapter LSM Active Entry Handshake

</figure>

If a parity error is detected by a chiplet, the error is treated as a Correctable error and reported via
the correctable error reporting mechanism. By enabling interrupt on correctable errors, SW can
implement a BER counter in SW, if so desired.

When a Pause Data Stream occurs the Pause Data Stream and corresponding padding bytes are
included in the number of bytes elapsed before parity injection as well as parity computation.

# 4.0 Logical Physical Layer

The Logical PHY comprehends the following functions:

· Link initialization, training and power management states

· Byte to Lane mapping for data transmission over Lanes

· Interconnect redundancy remapping (when required)

· Transmitting and receiving sideband messages

· Scrambling and training pattern generation

· Lane reversal

· Width degradation (when applicable)

## 4.1 Data and Sideband Transmission Flow

This specification defines clock, valid and Data to send and receive data over the physical Lanes. The
transmitted data is framed by the valid signal.

### 4.1.1 Byte to Lane Mapping

Data packets are transmitted in Bytes. Within each Byte, bit [0] is transmitted first. Figure 4-1 shows
an example of bit arrangement within one byte transmission over Lane 0.

<figure>
<figcaption>Figure 4-1. Bit arrangement within a byte transfer</figcaption>

Clock

Valid

Data

B0[0]

B0[1]

B0[2]

B0[3]

B0[4]

B0[5]

B0[6]

B0[7]

8 UI

</figure>

Each Byte is transmitted on a separate Lane. Byte 0 (B0) is transmitted on Lane 0, Byte 1 is
transmitted on Lane 1 and so on.

Figure 4-2 shows an example of a 256B Flit transmitted over a x64 interface (one x64 Advanced
Package module or two x32 Advanced Package modules or four Standard Package modules). If the I/
O width changes to x32 or x16 interface (Standard Package), transmission of one Byte per Lane is
preserved as shown in Figure 4-3 and Figure 4-4 respectively.

Figure 4-5 shows an example for a width degraded Standard Package module.

<table>
<caption>Figure 4-2. Byte map for x64 interface</caption>
<tr>
<th>LANE $U I$</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>...</th>
<th>48</th>
<th>49</th>
<th>50</th>
<th>51</th>
<th>52</th>
<th>53</th>
<th>54</th>
<th>55</th>
<th>56</th>
<th>57</th>
<th>58</th>
<th>59</th>
<th>60</th>
<th>61</th>
<th>62</th>
<th>63</th>
<th></th>
</tr>
<tr>
<td>0 - 7</td>
<td>B00</td>
<td>B01</td>
<td>B02</td>
<td>B03</td>
<td>B04</td>
<td>B05</td>
<td>B06</td>
<td>B07</td>
<td>...</td>
<td>B48</td>
<td>B49</td>
<td>B50</td>
<td>B51</td>
<td>B52</td>
<td>B53</td>
<td>B54</td>
<td>B55</td>
<td>B56</td>
<td>B57</td>
<td>B58</td>
<td>B59</td>
<td>B60</td>
<td>B61</td>
<td>B62</td>
<td>B63</td>
<td></td>
</tr>
<tr>
<td>8 - 15</td>
<td>B64</td>
<td>B65</td>
<td>B66</td>
<td>B67</td>
<td>B68</td>
<td>B69</td>
<td>B70</td>
<td>B71</td>
<td>...</td>
<td>B112</td>
<td>B113</td>
<td>B114</td>
<td>B115</td>
<td>B116</td>
<td>B117</td>
<td>B118</td>
<td>B119</td>
<td>B120</td>
<td>B121</td>
<td>B122</td>
<td>B123</td>
<td>B124</td>
<td>B125</td>
<td>B126</td>
<td>B127</td>
<td></td>
</tr>
<tr>
<td>$1 6 \quad - \quad 2 3$</td>
<td>B128</td>
<td>B129</td>
<td>B130</td>
<td>B131</td>
<td>B132</td>
<td>B133</td>
<td>B134</td>
<td>B135</td>
<td></td>
<td>B176</td>
<td>B177</td>
<td>B178</td>
<td>B179</td>
<td>B180</td>
<td>B181</td>
<td>B182</td>
<td>$B 1 8 3$</td>
<td>B184</td>
<td>B185</td>
<td>B186</td>
<td>B187</td>
<td>B188</td>
<td>B189</td>
<td>B190</td>
<td>B191</td>
<td rowspan="2"></td>
</tr>
<tr>
<td>24 - 31</td>
<td>B192</td>
<td>B193</td>
<td>B194</td>
<td>B195</td>
<td>B196</td>
<td>B197</td>
<td>B198</td>
<td>B199</td>
<td>...</td>
<td>B240</td>
<td>B241</td>
<td>B242</td>
<td>B243</td>
<td>B244</td>
<td>B245</td>
<td>B246</td>
<td>B247</td>
<td>B248</td>
<td>B249</td>
<td>B250</td>
<td>B251</td>
<td>B252</td>
<td>B253</td>
<td>B254</td>
<td>B255</td>
</tr>
</table>

<table>
<caption>Figure 4-3. Byte map for x32 interface</caption>
<tr>
<th>Lane $U I$</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>...</th>
<th>16</th>
<th>17</th>
<th>18</th>
<th>19</th>
<th>20</th>
<th>21</th>
<th>22</th>
<th>23</th>
<th>24</th>
<th>25</th>
<th>26</th>
<th>27</th>
<th>28</th>
<th>29</th>
<th>30</th>
<th>31</th>
</tr>
<tr>
<td>0 -7</td>
<td>BO</td>
<td>B1</td>
<td>B2</td>
<td>B3</td>
<td>B4</td>
<td>B5</td>
<td>B6</td>
<td>B7</td>
<td></td>
<td>B16</td>
<td>B17</td>
<td>B18</td>
<td>B19</td>
<td>B20</td>
<td>B21</td>
<td>B22</td>
<td>B23</td>
<td>B24</td>
<td>B25</td>
<td>B26</td>
<td>B27</td>
<td>B28</td>
<td>B29</td>
<td>B30</td>
<td>B31</td>
</tr>
<tr>
<td>8 - 15</td>
<td>832</td>
<td>833</td>
<td>834</td>
<td>835</td>
<td>B36</td>
<td>837</td>
<td>B38</td>
<td>B39</td>
<td></td>
<td>B48</td>
<td>849</td>
<td>850</td>
<td>B51</td>
<td>B52</td>
<td>853</td>
<td>B54</td>
<td>855</td>
<td>856</td>
<td>857</td>
<td>858</td>
<td>859</td>
<td>B60</td>
<td>861</td>
<td>B62</td>
<td>B63</td>
</tr>
<tr>
<td>16 - 23</td>
<td>864</td>
<td>865</td>
<td>866</td>
<td>867</td>
<td>B68</td>
<td>869</td>
<td>B70</td>
<td>B71</td>
<td></td>
<td>B80</td>
<td>B81</td>
<td>B82</td>
<td>683</td>
<td>684</td>
<td>885</td>
<td>686</td>
<td>887</td>
<td>B88</td>
<td>B89</td>
<td>890</td>
<td>891</td>
<td>892</td>
<td>893</td>
<td>B94</td>
<td>B95</td>
</tr>
<tr>
<td>24- 31</td>
<td>896</td>
<td>897</td>
<td>898</td>
<td>899</td>
<td>B100</td>
<td>8101</td>
<td>B102</td>
<td>B103</td>
<td></td>
<td>B112</td>
<td>8113</td>
<td>8114</td>
<td>8115</td>
<td>8116</td>
<td>8117</td>
<td>B118</td>
<td>8119</td>
<td>B120</td>
<td>B121</td>
<td>B122</td>
<td>B123</td>
<td>B124</td>
<td>B125</td>
<td>B126</td>
<td>B127</td>
</tr>
<tr>
<td>32-39</td>
<td>8128</td>
<td>8129</td>
<td>8130</td>
<td>B131</td>
<td>B132</td>
<td>8133</td>
<td>B134</td>
<td>B135</td>
<td></td>
<td>B144</td>
<td>B145</td>
<td>B146</td>
<td>B147</td>
<td>8148</td>
<td>8149</td>
<td>B150</td>
<td>8151</td>
<td>B152</td>
<td>B153</td>
<td>B154</td>
<td>BISS</td>
<td>B156</td>
<td>B157</td>
<td>B158</td>
<td>B159</td>
</tr>
<tr>
<td>40 - 47</td>
<td>8160</td>
<td>8161</td>
<td>8162</td>
<td>8163</td>
<td>B164</td>
<td>8165</td>
<td>8166</td>
<td>B167</td>
<td></td>
<td>B176</td>
<td>8177</td>
<td>8178</td>
<td>B179</td>
<td>8180</td>
<td>8181</td>
<td>B182</td>
<td>8183</td>
<td>B184</td>
<td>B185</td>
<td>B186</td>
<td>B187</td>
<td>B188</td>
<td>B189</td>
<td>B190</td>
<td>B191</td>
</tr>
<tr>
<td>$4 8 - \quad 5 5$</td>
<td>8192</td>
<td>8193</td>
<td>B194</td>
<td>B195</td>
<td>B196</td>
<td>8197</td>
<td>8198</td>
<td>B199</td>
<td></td>
<td>B208</td>
<td>8209</td>
<td>B210</td>
<td>B211</td>
<td>6212</td>
<td>8213</td>
<td>B214</td>
<td>8215</td>
<td>B216</td>
<td>B217</td>
<td>B218</td>
<td>B219</td>
<td>B220</td>
<td>B221</td>
<td>B222</td>
<td>B223</td>
</tr>
<tr>
<td>$5 6 \quad - 6 3$</td>
<td>B224</td>
<td>B225</td>
<td>B226</td>
<td>B227</td>
<td>B228</td>
<td>B229</td>
<td>B230</td>
<td>B231</td>
<td></td>
<td>B240</td>
<td>B241</td>
<td>B242</td>
<td>B243</td>
<td>6244</td>
<td>B245</td>
<td>B246</td>
<td>B247</td>
<td>B248</td>
<td>B249</td>
<td>B250</td>
<td>8251</td>
<td>B252</td>
<td>B253</td>
<td>B254</td>
<td>B255</td>
</tr>
</table>

<table>
<caption>Figure 4-4. Byte map for x16 interface</caption>
<tr>
<th>Lane UI</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
<th>12</th>
<th>13</th>
<th>14</th>
<th>15</th>
</tr>
<tr>
<td>0 - 7</td>
<td>BO</td>
<td>B1</td>
<td>B2</td>
<td>B3</td>
<td>B4</td>
<td>B5</td>
<td>B6</td>
<td>B7</td>
<td>B8</td>
<td>B9</td>
<td>B10</td>
<td>B11</td>
<td>B12</td>
<td>B13</td>
<td>B14</td>
<td>B15</td>
</tr>
<tr>
<td>8 - 15</td>
<td>B16</td>
<td>B17</td>
<td>B18</td>
<td>B19</td>
<td>B20</td>
<td>B21</td>
<td>B22</td>
<td>B23</td>
<td>B24</td>
<td>B25</td>
<td>B26</td>
<td>B27</td>
<td>B28</td>
<td>B29</td>
<td>B30</td>
<td>B31</td>
</tr>
<tr>
<td>16 - 23</td>
<td>B32</td>
<td>B33</td>
<td>B34</td>
<td>B35</td>
<td>B36</td>
<td>B37</td>
<td>B38</td>
<td>B39</td>
<td>B40</td>
<td>B41</td>
<td>B42</td>
<td>B43</td>
<td>B44</td>
<td>B45</td>
<td>B46</td>
<td>B47</td>
</tr>
<tr>
<td>24 - 31</td>
<td>B48</td>
<td>B49</td>
<td>B50</td>
<td>B51</td>
<td>B52</td>
<td>B53</td>
<td>B54</td>
<td>B55</td>
<td>B56</td>
<td>B57</td>
<td>B58</td>
<td>B59</td>
<td>B60</td>
<td>B61</td>
<td>B62</td>
<td>B63</td>
</tr>
<tr>
<td>32 - 39</td>
<td>B64</td>
<td>B65</td>
<td>B66</td>
<td>B67</td>
<td>B68</td>
<td>B69</td>
<td>B70</td>
<td>B71</td>
<td>B72</td>
<td>B73</td>
<td>B74</td>
<td>B75</td>
<td>B76</td>
<td>B77</td>
<td>B78</td>
<td>B79</td>
</tr>
<tr>
<td>40 - 47</td>
<td>B80</td>
<td>B81</td>
<td>B82</td>
<td>B83</td>
<td>B84</td>
<td>B85</td>
<td>B86</td>
<td>B87</td>
<td>B88</td>
<td>B89</td>
<td>B90</td>
<td>B91</td>
<td>B92</td>
<td>B93</td>
<td>B94</td>
<td>B95</td>
</tr>
<tr>
<td>48 - 55</td>
<td>B96</td>
<td>B97</td>
<td>B98</td>
<td>B99</td>
<td>B100</td>
<td>B101</td>
<td>B102</td>
<td>B103</td>
<td>B104</td>
<td>B105</td>
<td>B106</td>
<td>B107</td>
<td>B108</td>
<td>B109</td>
<td>B110</td>
<td>B111</td>
</tr>
<tr>
<td>56 - 63</td>
<td>B112</td>
<td>B113</td>
<td>B114</td>
<td>B115</td>
<td>B116</td>
<td>B117</td>
<td>B118</td>
<td>B119</td>
<td>B120</td>
<td>B121</td>
<td>B122</td>
<td>B123</td>
<td>B124</td>
<td>B125</td>
<td>B126</td>
<td>B127</td>
</tr>
<tr>
<td>64 - 71</td>
<td>B128</td>
<td>B129</td>
<td>B130</td>
<td>B131</td>
<td>B132</td>
<td>B133</td>
<td>B134</td>
<td>B135</td>
<td>B136</td>
<td>B137</td>
<td>B138</td>
<td>B139</td>
<td>B140</td>
<td>B141</td>
<td>B142</td>
<td>B143</td>
</tr>
<tr>
<td>72 - 79</td>
<td>B144</td>
<td>B145</td>
<td>B146</td>
<td>B147</td>
<td>B148</td>
<td>B149</td>
<td>B150</td>
<td>B151</td>
<td>B152</td>
<td>B153</td>
<td>B154</td>
<td>B155</td>
<td>B156</td>
<td>B157</td>
<td>B158</td>
<td>B159</td>
</tr>
<tr>
<td>80 - 87</td>
<td>B160</td>
<td></td>
<td></td>
<td>B163</td>
<td>B164</td>
<td>B165</td>
<td>B166</td>
<td>B167</td>
<td>B168</td>
<td>B169</td>
<td>B170</td>
<td>B171</td>
<td>B172</td>
<td>B173</td>
<td>B174</td>
<td>B175</td>
</tr>
<tr>
<td>88 - 95</td>
<td>B176</td>
<td>$\frac { B 1 6 1 } { B 1 7 7 } | B 1 6 2<br>B 1 7 8$</td>
<td></td>
<td>B179</td>
<td>B180</td>
<td>B181</td>
<td>B182</td>
<td>B183</td>
<td>B184</td>
<td>B185</td>
<td>B186</td>
<td>B187</td>
<td>B188</td>
<td>B189</td>
<td>B190</td>
<td>B191</td>
</tr>
<tr>
<td>96 - 103</td>
<td>B192</td>
<td>B193</td>
<td>B194</td>
<td>B195</td>
<td>B196</td>
<td>B197</td>
<td>B198</td>
<td>B199</td>
<td>B200</td>
<td>B201</td>
<td>B202</td>
<td>B203</td>
<td>B204</td>
<td>B205</td>
<td>B206</td>
<td>B207</td>
</tr>
<tr>
<td>104 - 111</td>
<td>B208</td>
<td>B209</td>
<td>B210</td>
<td>B211</td>
<td>B212</td>
<td>B213</td>
<td>B214</td>
<td>B215</td>
<td>B216</td>
<td>B217</td>
<td>B218</td>
<td></td>
<td>B220</td>
<td>B221</td>
<td>B222</td>
<td>B223</td>
</tr>
<tr>
<td>$1 1 2 \quad - \quad 1 1 9$</td>
<td>B224</td>
<td>B225</td>
<td>B226</td>
<td>B227</td>
<td>B228</td>
<td>B229</td>
<td>B230</td>
<td>B231</td>
<td>B232</td>
<td>B233</td>
<td>B234</td>
<td>$\frac { B 2 1 9 } { B 2 3 5 }$</td>
<td>B236</td>
<td>B237</td>
<td>B238</td>
<td>B239</td>
</tr>
<tr>
<td>$1 2 0 \quad - \quad 1 2 7$</td>
<td>B240</td>
<td>B241</td>
<td>B242</td>
<td>B243</td>
<td>B244</td>
<td>B245</td>
<td>B246</td>
<td>B247</td>
<td>B248</td>
<td>B249</td>
<td>B250</td>
<td>B251</td>
<td>B252</td>
<td>B253</td>
<td>B254</td>
<td>B255</td>
</tr>
</table>

<table>
<caption>Figure 4-5. Byte to Lane mapping for Standard package x16 degraded to x8</caption>
<tr>
<th>Lane</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
<th>12</th>
<th>13</th>
<th>14</th>
<th>15</th>
</tr>
<tr>
<th></th>
<th colspan="8">or</th>
</tr>
<tr>
<td>Lane Uİ</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
</tr>
<tr>
<td>0 - 7</td>
<td>BO</td>
<td>B1</td>
<td>B2</td>
<td>B3</td>
<td>B4</td>
<td>B5</td>
<td>B6</td>
<td>B7</td>
</tr>
<tr>
<td>8 - 15</td>
<td>B8</td>
<td>B9</td>
<td>B10</td>
<td>B11</td>
<td>B12</td>
<td>B13</td>
<td>B14</td>
<td>B15</td>
</tr>
<tr>
<td>$1 6 - 2 3$</td>
<td>B16</td>
<td>B17</td>
<td>B18</td>
<td>B19</td>
<td>B20</td>
<td>B21</td>
<td>B22</td>
<td>B23</td>
</tr>
<tr>
<td>$2 4 - 3 1$</td>
<td>B24</td>
<td>B25</td>
<td>B26</td>
<td>B27</td>
<td>B28</td>
<td>B29</td>
<td>B30</td>
<td>B31</td>
</tr>
<tr>
<td>$3 2 \quad - 3 9$</td>
<td>B32</td>
<td>B33</td>
<td>B34</td>
<td>B35</td>
<td>B36</td>
<td>B37</td>
<td>B38</td>
<td>B39</td>
</tr>
<tr>
<td>$4 0 - 4 7$</td>
<td>B40</td>
<td>B41</td>
<td>B42</td>
<td>B43</td>
<td>B44</td>
<td>B45</td>
<td>B46</td>
<td>B47</td>
</tr>
<tr>
<td>$4 8 \quad - \quad 5 5$</td>
<td>B48</td>
<td>B49</td>
<td>B50</td>
<td>B51</td>
<td>B52</td>
<td>B53</td>
<td>B54</td>
<td>B55</td>
</tr>
<tr>
<td>$5 6 \quad - \quad 6 3$</td>
<td>B56</td>
<td>B57</td>
<td>B58</td>
<td>B59</td>
<td>B60</td>
<td>B61</td>
<td>B62</td>
<td>B63</td>
</tr>
<tr>
<td>$6 4 \quad - \quad 7 1$</td>
<td>B64</td>
<td>B65</td>
<td>B66</td>
<td>B67</td>
<td>B68</td>
<td>B69</td>
<td>B70</td>
<td>B71</td>
</tr>
<tr>
<td>$7 2 \quad - \quad 7 9$</td>
<td>B72</td>
<td>B73</td>
<td>B74</td>
<td>B75</td>
<td>B76</td>
<td>B77</td>
<td>B78</td>
<td>B79</td>
</tr>
<tr>
<td>80- 87</td>
<td>B80</td>
<td>B81</td>
<td>B82</td>
<td>B83</td>
<td>B84</td>
<td>B85</td>
<td>B86</td>
<td>B87</td>
</tr>
<tr>
<td>$8 8 \quad - \quad 9 5$</td>
<td>B88</td>
<td>B89</td>
<td>890</td>
<td>B91</td>
<td>B92</td>
<td>B93</td>
<td>B94</td>
<td>B95</td>
</tr>
<tr>
<td>$9 6 - 1 0 3$</td>
<td>B96</td>
<td>B97</td>
<td>B98</td>
<td>B99</td>
<td>B100</td>
<td>B101</td>
<td>B102</td>
<td>B103</td>
</tr>
<tr>
<td>$1 0 4 \quad - \quad 1 1 1$</td>
<td>B104</td>
<td>B105</td>
<td>B106</td>
<td>B107</td>
<td>B108</td>
<td>B109</td>
<td>B110</td>
<td>B111</td>
</tr>
<tr>
<td>112 - 119</td>
<td>B112</td>
<td>B113</td>
<td>B114</td>
<td>B115</td>
<td>B116</td>
<td>B117</td>
<td>B118</td>
<td>B119</td>
</tr>
<tr>
<td>120 - 127</td>
<td>B120</td>
<td>B121</td>
<td>B122</td>
<td>B123</td>
<td>B124</td>
<td>B125</td>
<td>B126</td>
<td>B127</td>
</tr>
<tr>
<td>128-135</td>
<td>B128</td>
<td>B129</td>
<td>B130</td>
<td>B131</td>
<td>B132</td>
<td>B133</td>
<td>B134</td>
<td>B135</td>
</tr>
<tr>
<td>136-143</td>
<td>B136</td>
<td>$\frac { B 1 3 7 } { 8 1 1 5 }$</td>
<td>B138</td>
<td></td>
<td>B140</td>
<td>B141</td>
<td>B142</td>
<td>B143</td>
</tr>
<tr>
<td>144-151</td>
<td>B144</td>
<td></td>
<td>B146</td>
<td>$\frac { B 1 3 9 } { B 1 1 7 }$</td>
<td>B148</td>
<td>B149</td>
<td>B150</td>
<td>B151</td>
</tr>
<tr>
<td>152-159</td>
<td>B152</td>
<td>B153</td>
<td>B154</td>
<td>B155</td>
<td>B156</td>
<td>B157</td>
<td>B158</td>
<td>B159</td>
</tr>
<tr>
<td>160-167</td>
<td>B160</td>
<td>B161</td>
<td>B162</td>
<td>B163</td>
<td>B164</td>
<td>B165</td>
<td>B166</td>
<td>B167</td>
</tr>
<tr>
<td>168-175</td>
<td>B168</td>
<td>B169</td>
<td>B170</td>
<td>B171</td>
<td>B172</td>
<td>B173</td>
<td>B174</td>
<td>B175</td>
</tr>
<tr>
<td>176-183</td>
<td>B176</td>
<td>B177</td>
<td>B178</td>
<td>B179</td>
<td>B180</td>
<td>B181</td>
<td>B182</td>
<td>B183</td>
</tr>
<tr>
<td>184-191</td>
<td>B184</td>
<td>B185</td>
<td>B186</td>
<td>B187</td>
<td>B188</td>
<td>B189</td>
<td>B190</td>
<td>B191</td>
</tr>
<tr>
<td>192-199</td>
<td>B192</td>
<td>B193</td>
<td>B194</td>
<td>B195</td>
<td>B196</td>
<td>B197</td>
<td>B198</td>
<td>B199</td>
</tr>
<tr>
<td>200-207</td>
<td>B200</td>
<td>B201</td>
<td>B202</td>
<td>B203</td>
<td>B204</td>
<td>B205</td>
<td>B206</td>
<td>B207</td>
</tr>
<tr>
<td>208-215</td>
<td>B208</td>
<td>B209</td>
<td>B210</td>
<td>B211</td>
<td>B212</td>
<td>B213</td>
<td>B214</td>
<td>B215</td>
</tr>
<tr>
<td>216-223</td>
<td>B216</td>
<td>B217</td>
<td>B218</td>
<td>B219</td>
<td>B220</td>
<td>B221</td>
<td>B222</td>
<td>B223</td>
</tr>
<tr>
<td>224-231</td>
<td>B224</td>
<td>B225</td>
<td>B226</td>
<td>B227</td>
<td>B228</td>
<td>B229</td>
<td>B230</td>
<td>B231</td>
</tr>
<tr>
<td>232-239</td>
<td>B232</td>
<td>B233</td>
<td>B234</td>
<td>B235</td>
<td>B236</td>
<td>B237</td>
<td>B238</td>
<td>B239</td>
</tr>
<tr>
<td>240-247</td>
<td>B240</td>
<td>B241</td>
<td>B242</td>
<td>B243</td>
<td>B244</td>
<td>B245</td>
<td>B246</td>
<td>B247</td>
</tr>
<tr>
<td>248-255</td>
<td>B248</td>
<td>B249</td>
<td>B250</td>
<td>B251</td>
<td>B252</td>
<td>B253</td>
<td>B254</td>
<td>B255</td>
</tr>
</table>

### 4.1.2 Valid Framing

Valid signal is used to frame the transmitted data. For each 8-bit data packet, valid is asserted for the
first 4 UI and de-asserted for 4 UI. This will allow data transfer in Raw Format or various Flit Formats
as described in Chapter 3.0 using one or multiple valid frames. An example is shown in Figure 4-6
where Transfer 1 and Transfer 2 can be from the same Flit or different Flits.

Note:
An 8-UI block assertion is enforced by the Transmitter and tracked by the Receiver
during Active state. This means that following the first valid transfer of data over
mainband in Active state, each subsequent transfer is after an integer multiple of 8 UI
from the rising edge of Valid of the first transfer. Note that for Retimers, this means
that the first transfer after entering the Active state cannot be a 'No Flit data transfer +
1 credit release' encoding; this is acceptable because the Retimer-advertised credits
are replenished or readvertised whenever the state moves away from Active.



---



<figure>
<figcaption>Figure 4-6. Valid framing example</figcaption>

Clock

Valid

Data[N-1:0][7:0]

Data Byte [N-1:0] Transfer 1

Data Byte [N-1:0] Transfer 2

8 UI

8 UI

</figure>

# 4.1.2.1 Valid Framing for Retimers

The UCIe Retimer releases credits to its local UCIe die using the Valid wire, as described in Table 4-1.
Each credit tracks 256 Bytes of data (including any FEC, CRC, etc.). The Valid Framing encodings
ensure triple bit flip detection guarantee.

If the operating speed is <= 48 GT/s, it is permitted for receiver implementations to:

· Trigger Retrain on any bit error (using the triple bit flip detection guarantee)

. Use the encodings listed in Table 4-1 to correct single bit errors (with the understanding that
three bit error detection is lost, and its contribution to overall FIT is negligible)

If the operating speed is > 48 GT/s, receiver implementations must use the encodings listed in
Table 4-1 to correct single-bit errors (three-bit error detection is not possible).

<table>
<caption>Table 4-1. Valid framing for Retimers</caption>
<tr>
<th>8-UI Valida</th>
<th>Encoding</th>
</tr>
<tr>
<td>00000000b</td>
<td>No Flit data transfer + no credit release</td>
</tr>
<tr>
<td>00001111b</td>
<td>Flit data transfer valid + no credit release</td>
</tr>
<tr>
<td>11110000b</td>
<td>No Flit data transfer + 1 credit release</td>
</tr>
<tr>
<td>11111111b</td>
<td>Flit data transfer valid + 1 Credit release</td>
</tr>
</table>

a. Note that the bits above are transmitted on the Link in order from right to left (i.e., bit 0 is transmitted on the
Link first, followed by bit 1 and so on until bit 7).

# 4.1.3 Clock Gating

Forwarded mainband clocks on the UCIe Link must be gated when Valid signal is low after providing
fixed 16 UI (8 cycles) of postamble clock for half-rate clocking and 32 UI (8 cycles) of postamble clock
for quarter-rate clocking, unless free running clock mode is negotiated or Runtime Recalibration has
been requested by the remote Link partner. Data and Clock signal parking levels when clocks are
gated are described in Section 5.11.

Note that the clock postamble is required any time that the clock can toggle with Valid assertion, and
the clock needs to stop toggling, regardless of LTSM state.

# 4.1.4 Free Running Clock Mode

Free running clock mode is defined as the mode where the forwarded clock remains toggling even
when the Transmitter for Valid is held low and there is no data transfer on the interface. This mode
must be supported to allow disabling dynamic clock gating for normal operation or debug. This must
be negotiated prior to mainband Link training through parameter exchange.

## 4.1.5 Sideband transmission

Each module supports a sideband interface with a serial data and clock pin pair. Sideband packet
formats and encodings are shown in Chapter 7.0 and the electrical characteristics are shown in
Section 5.13.

As shown in Section 7.1.2, the sideband message formats are defined as a 64-bit header with no
data, with 32 bits or 64 bits of data. A 64-bit serial packet is defined on the I/O interface to the
remote die as shown in Figure 4-7. 32-bit data is sent using the 64-bit serial packet with MSBs
padded with 0b. Two sideband serial packets on the I/O interface are separated by a minimum of 32
bits low as shown in Figure 4-8. A sideband message with data would be transferred as a 64-bit
header followed by 32 bits of low followed by 64-bit data followed by 32 bits of low.

<figure>
<figcaption>Figure 4-7. Example 64-bit Sideband Serial Packet Transfer</figcaption>

64 UI

$> = 3 2 \quad U I$

SB Clock

SB Message

D0

D1

D62

D63

</figure>

<figure>
<figcaption>Figure 4-8. Sideband Packet Transmission: Back-to-Back</figcaption>

64 UI

\>=32 UI

64 UI

\>=32 UI

SB Clock

SB Message

Sideband Packet 1

Sideband Packet 2

</figure>

### 4.1.5.1 Sideband Performant Mode Operation (PMO)

Sideband designs can negotiate support for 'Sideband Performant Mode Operation (PMO)' by way of
the Sideband Feature Extensions (SBFE) mechanism defined in Section 4.5.3.3.1.1. The Sideband
PMO bit of the {MBINIT.PARAM SBFE req/resp} sideband message (bit 1) is defined for negotiating
this operation (see Table 7-11). When supporting this feature, a UCIe Link must support this
capability on both its transmit and receive direction or not support the capability at all. In a multi-
module Link, all modules must advertise the same capability. A UCIe Link must set the Sideband PMO
bit to 1 on the {MBINIT.PARAM SBFE resp} sideband message that the UCIe Link transmits, but only
if the corresponding Req message also has that bit set to 1 and its receiver is capable of Sideband
PMO. Otherwise, the Sideband PMO bit must be cleared to 0.

When Sideband PMO capability is enabled, the 32-UI dead time between the 64-UI data transfers on
the sideband is no longer applicable and the sideband can transmit 64-UI data back-to-back with no
gaps. See Figure 4-9 and Figure 4-10 for illustration. The transmitter must follow this new mode after
the transmitter has sent and received the {MBINIT.PARAM SBFE resp} sideband message with the
Sideband PMO bit set to 1, across all modules. The receiver must be ready to accept packets in this
mode after the receiver has transmitted the {MBINIT.PARAM SBFE resp} sideband message with the
Sideband PMO bit set to 1. After Sideband PMO is enabled, the transmitter operates in Performant
Mode in all states until entry into the RESET state with the SB_MGMT_UP flag cleared to 0.
Additionally, PMO can then only be renegotiated on a training sequence with the SB_MGMT_UP flag
cleared to 0. Note that from a receiver perspective, due to timing differences, packets might be
received without the Sideband Performant Mode even after the chiplet has transmitted an

{MBINIT.PARAM SBFE resp} sideband message with the PMO bit set to 1. The sideband receiver must
be backward compatible and be able to handle 32 UI of gaps between consecutive 64-UI transfers
over the sideband Link.

<figure>
<figcaption>Figure 4-9. Example 64-bit Sideband Serial Packet Transfer in Sideband Performant Mode</figcaption>

64 UI

SB Clock

SB Message

D0

D1

D62

D63

</figure>

<figure>
<figcaption>Figure 4-10. Sideband Packet Transmission: Back-to-Back in Sideband Performant Mode</figcaption>

64 UI

64 UI

SB Clock

SB Message

Sideband Packet 1

Sideband Packet 2

</figure>

### 4.1.5.2 Priority Sideband Packet Transfer

Implementations are permitted to optionally support Priority Sideband Packet Transfers (PSPT). This
capability is negotiated as a Sideband Feature Extension. If PSPT is supported, PMO must be
supported. When supporting the PSPT capability, an implementation must support the PSPT capability
in both the transmit and receive directions. In a multi-module Link, all the modules must advertise
the same PSPT capability value. See Table 7-11 for the PSPT capability bit assignment during
negotiation in the {MBINIT.PARAM SBFE req/resp} sideband messages. The PSPT bit is set to 1 in the
{MBINIT.PARAM SBFE req} sideband message if the PSPT capability is supported by hardware and
enabled through the corresponding bit in UCIe Link Control register; otherwise, the bit is cleared to 0.
The PSPT bit is set to 1 in the {MBINIT.PARAM SBFE resp} sideband message if the PSPT capability
was advertised in the transmitted, as well as the received, {MBINIT.PARAM SBFE req} sideband
messages; otherwise, the PSPT bit is cleared to 0. The sideband receiver must be enabled to detect
and parse the priority sideband packets before the {MBINIT.PARAM SBFE resp} sideband message
with the PSPT bit set to 1 is transmitted. PMO and PSPT are negotiated as part of the same
handshake, and both must be enabled at the same time at the sideband transmitter. After PSPT is
enabled, PSPT remains enabled until entry into RESET state with the SB_MGMT_UP flag cleared to 0.

### 4.1.5.2.1 PSPT Rules

A priority traffic packet is defined in Section 7.1.2.6. In PSPT rules, all other sideband packets
(including MTP) are referred to as "normal traffic packets". Also, in this section, "idle" inserted by the
transmitter refers to both the sideband clock and data being 0 at the sideband transmitter.

The following rules are applicable when PSPT is enabled:

. A sideband transmitter will not insert any idle UI during a normal traffic packet, except when
inserting a priority traffic packet. A sideband transmitter is permitted to insert idle UI after a
normal packet has been fully transmitted.

. If a sideband transmitter has a priority traffic packet pending while transmitting a normal traffic
packet:

1\. The sideband transmitter must interrupt the normal traffic packet at an 8-UI multiple of the
transfer.

2\. To insert a priority traffic packet during a normal traffic packet transfer, the sideband
transmitter inserts idle for a time equivalent to 8 UI followed by a priority traffic packet. An
example of this is shown in Figure 4-11.

3\. The opcode field in the priority packet can be 11111b or 11110b.

. If the opcode is 11111b, the normal traffic packet resumes immediately after the priority
traffic packet without any idle time.

. If the opcode is 11110b, then another priority traffic packet is transmitted immediately
without any idle insertion.

4\. Rule 3 above applies to all subsequent priority traffic packets that are inserted by interrupting
a normal traffic packet. Thus, the opcode 11110b allows for chaining together of multiple
priority traffic packets with the opcode 11111b ending the chain.

. If the sideband Link is idle, a sideband transmitter is permitted to transmit a priority traffic packet
without any additional idle insertions. This priority packet carries an opcode of 11111b if there is
no subsequent priority packet, and an opcode of 11110b if there is another priority packet
transmitted subsequently and immediately without any idle insertion.

· The sideband receiver must keep track of whether a normal traffic packet was interrupted by a
priority traffic packet and interpret the opcode field in the priority packets accordingly.

# IMPLEMENTATION NOTE

Future ECN(s) will define additional details for priority packets. Implementations are
permitted to instantiate another instance of the RDI configuration bus (\*cfg\* signals)
to route these packets to/from the UCIe Physical Layer.

<figure>
<figcaption>Figure 4-11. Example of a Normal Traffic Packet Interrupted by a Single Priority Traffic Packet</figcaption>

-1

0

1

2

3

4

5

6

7

8

9

10

11

12

13

15

16

17

18

n

48

47

48

49

n

UCle SB Clock

UCle Data

NTO

NT1

NT2

NT3

NT4

NT5

NT6

NT7

PTO

PT1

PT2

PT30

PT31

NT8

$N / A$

$N T = N o r m a l$ Traffic packet, $P T = P r i o r i t y$ Traffic Packet

</figure>

## 4.2 Lane Reversal

In Section 4.2, Section 4.3, and Section 4.5, the following nomenclature is used:

· TD_P: Physical Lane for Data Transmitter

· RD_P: Physical Lane for Data Receiver

. TRD_P: Physical Lane for Redundant Data Transmitter

· RRD_P: Physical Lane for Redundant Data Receiver

. TD_L: Logical Lane for Data Transmit

· RD_L: Logical Lane for Data Receive

· TCKP_P, TCKN_P and TTRK P: Physical Lane for Clock and Track Transmitter

· TCKP_L, TCKN_L and TTRK L: Logical Lane for Clock and Track Transmitter

· RCKP_P, RCKN_P and RTRK_P: Physical Lane for Clock and Track Receiver

. RCKP_L, RCKN_L and RTRK_L: Logical Lane for Clock and Track Receiver

. TRDCK_P: Physical Lane for Redundant Clock/Track Transmitter

· RRDCK_P: Physical Lane for Redundant Clock/Track Receiver

. TRDCK_L: Logical Lane for Redundant Clock/Track Transmitter

. RRDCK_L: Logical Lane for Redundant Clock/Track Receiver

· TVLD_P, RVLD_P: Physical Lane for Valid Transmitter and Receiver

. TRDVLD_P, RRDVLD_P: Physical Lane for Redundant Valid Transmitter and Receiver

· TVLD_L, RVLD_L: Logical Lane for Valid Transmitter and Receiver

. TRDVLD_L, RRDVLD_L: Logical Lane for Redundant Valid Transmitter and Receiver

Devices must support Lane reversal of data Lanes within a Module. An example of Lane reversal is
when physical Data Lane 0 on local die is connected to physical Data Lane (N-1) on the remote die
(physical Data Lane 1 is connected to physical Data Lane N-2 and so on) where $N = 8$ for $a \times 8$
Standard Package, $N = 1 6$ for a x16 Standard Package, $N = 3 2$ for a x32 Advanced Package, and $N =$
64 for a x64 Advanced Package. Redundant Lanes, in case of Advanced Package, are also reversed.
Lane reversal must be implemented on the Transmitter only. The Transmitter reverses the logical Lane
order on Data and Redundant Lanes.

Track, Valid, Clock, and sideband signals must not be reversed.

Lane reversal is discovered and applied during initialization and training (see Section 4.5.3.3.5).

### 4.2.1 Lane ID

To allow Lane reversal discovery, each logical Data and redundant Lane within a module is assigned a
unique Lane ID. The assigned Lane IDs are shown in Table 4-2 and Table 4-3 for Advanced and
Standard Package modules, respectively. Note that logical Lane numbers in Table 4-2 and Table 4-3
represent the logical Transmitter and Receiver Lanes. For example, Logical Lane Number = 0
represents TD_L [0] /RD_L [0] and so on.

In Table 4-2, for a x64 Advanced Package module, logical Lane numbers 64, 65, 66, and 67 represent
Logical redundant Lanes TRD_L [0] /RRD_L [0], TRD_L [1] /RRD_L [1], TRD_L [2] /RRD_L [2],
TRD_L [3]/RRD_L [3], respectively. For a x32 Advanced Package module, the Lane ID for
TD_L [0 : 31] /RD_L [0 :31], TRD_L [0]/RRD_L [0] and TRD_L [1] /RRD_L [1] will be represented
by the set of Lane ID {0 ... 31, 64, 65} respectively.

In Table 4-3, for a x16 Standard Package module, the Lane ID for TD_L [ 0 : 15] /RD_L [0 : 15] will be
represented by the set of Lane ID {0 ... 15} respectively. For a x8 Standard Package module, the Lane
ID for TD_L [0 : 7] /RD_L [0: 7] will be represented by the set of Lane ID {0 ... 7} respectively.

<table>
<caption>Table 4-2. Lane ID: Advanced Package module (Sheet 1 of 2)</caption>
<tr>
<th>Logical Lane Number</th>
<th>Lane ID</th>
<th>Logical Lane Number</th>
<th>Lane ID</th>
</tr>
<tr>
<td>0</td>
<td>00000000b</td>
<td>34</td>
<td>00100010b</td>
</tr>
<tr>
<td>1</td>
<td>00000001b</td>
<td>35</td>
<td>00100011b</td>
</tr>
<tr>
<td>2</td>
<td>00000010b</td>
<td>36</td>
<td>00100100b</td>
</tr>
<tr>
<td>3</td>
<td>00000011b</td>
<td>37</td>
<td>00100101b</td>
</tr>
<tr>
<td>4</td>
<td>00000100b</td>
<td>38</td>
<td>00100110b</td>
</tr>
</table>

<table>
<caption>Table 4-2. Lane ID: Advanced Package module (Sheet 2 of 2)</caption>
<tr>
<th>Logical Lane Number</th>
<th>Lane ID</th>
<th>Logical Lane Number</th>
<th>Lane ID</th>
</tr>
<tr>
<td>5</td>
<td>00000101b</td>
<td>39</td>
<td>00100111b</td>
</tr>
<tr>
<td>6</td>
<td>00000110b</td>
<td>40</td>
<td>00101000b</td>
</tr>
<tr>
<td>7</td>
<td>00000111b</td>
<td>41</td>
<td>00101001b</td>
</tr>
<tr>
<td>8</td>
<td>00001000b</td>
<td>42</td>
<td>00101010b</td>
</tr>
<tr>
<td>9</td>
<td>00001001b</td>
<td>43</td>
<td>00101011b</td>
</tr>
<tr>
<td>10</td>
<td>00001010b</td>
<td>44</td>
<td>00101100b</td>
</tr>
<tr>
<td>11</td>
<td>00001011b</td>
<td>45</td>
<td>00101101b</td>
</tr>
<tr>
<td>12</td>
<td>00001100b</td>
<td>46</td>
<td>00101110b</td>
</tr>
<tr>
<td>13</td>
<td>00001101b</td>
<td>47</td>
<td>00101111b</td>
</tr>
<tr>
<td>14</td>
<td>00001110b</td>
<td>48</td>
<td>00110000b</td>
</tr>
<tr>
<td>15</td>
<td>00001111b</td>
<td>49</td>
<td>00110001b</td>
</tr>
<tr>
<td>16</td>
<td>00010000b</td>
<td>50</td>
<td>00110010b</td>
</tr>
<tr>
<td>17</td>
<td>00010001b</td>
<td>51</td>
<td>00110011b</td>
</tr>
<tr>
<td>18</td>
<td>00010010b</td>
<td>52</td>
<td>00110100b</td>
</tr>
<tr>
<td>19</td>
<td>00010011b</td>
<td>53</td>
<td>00110101b</td>
</tr>
<tr>
<td>20</td>
<td>00010100b</td>
<td>54</td>
<td>00110110b</td>
</tr>
<tr>
<td>21</td>
<td>00010101b</td>
<td>55</td>
<td>00110111b</td>
</tr>
<tr>
<td>22</td>
<td>00010110b</td>
<td>56</td>
<td>00111000b</td>
</tr>
<tr>
<td>23</td>
<td>00010111b</td>
<td>57</td>
<td>$0 0 1 1 1 0 0 1 b$</td>
</tr>
<tr>
<td>24</td>
<td>00011000b</td>
<td>58</td>
<td>00111010b</td>
</tr>
<tr>
<td>25</td>
<td>00011001b</td>
<td>59</td>
<td>00111011b</td>
</tr>
<tr>
<td>26</td>
<td>$0 0 0 1 1 0 1 0 b$</td>
<td>60</td>
<td>00111100b</td>
</tr>
<tr>
<td>27</td>
<td>00011011b</td>
<td>61</td>
<td>00111101b</td>
</tr>
<tr>
<td>28</td>
<td>00011100b</td>
<td>62</td>
<td>00111110b</td>
</tr>
<tr>
<td>29</td>
<td>00011101b</td>
<td>63</td>
<td>00111111b</td>
</tr>
<tr>
<td>30</td>
<td>00011110b</td>
<td>64</td>
<td>01000000b</td>
</tr>
<tr>
<td>31</td>
<td>00011111b</td>
<td>65</td>
<td>01000001b</td>
</tr>
<tr>
<td>32</td>
<td>00100000b</td>
<td>66</td>
<td>01000010b</td>
</tr>
<tr>
<td>33</td>
<td>00100001b</td>
<td>67</td>
<td>01000011b</td>
</tr>
</table>

<table>
<caption>Table 4-3. Lane ID: Standard Package Module</caption>
<tr>
<th>Logical Lane Number</th>
<th>Lane ID</th>
<th>Logical Lane Number</th>
<th>Lane ID</th>
</tr>
<tr>
<td>0</td>
<td>00000000b</td>
<td>8</td>
<td>00001000b</td>
</tr>
<tr>
<td>1</td>
<td>00000001b</td>
<td>9</td>
<td>00001001b</td>
</tr>
<tr>
<td>2</td>
<td>00000010b</td>
<td>10</td>
<td>00001010b</td>
</tr>
<tr>
<td>3</td>
<td>00000011b</td>
<td>11</td>
<td>00001011b</td>
</tr>
<tr>
<td>4</td>
<td>00000100b</td>
<td>12</td>
<td>00001100b</td>
</tr>
<tr>
<td>5</td>
<td>00000101b</td>
<td>13</td>
<td>00001101b</td>
</tr>
<tr>
<td>6</td>
<td>00000110b</td>
<td>14</td>
<td>00001110b</td>
</tr>
<tr>
<td>7</td>
<td>00000111b</td>
<td>15</td>
<td>00001111b</td>
</tr>
</table>

## 4.3 Interconnect redundancy remapping

As discussed in Section 5.9, Advanced Package modules require redundancy remapping to recover
from faulty Lanes. This section provides the details of remapping. After a successful remapping/repair,
any unused repair Lanes must have their Transmitters tri-stated and Receivers disabled.

### 4.3.1 Data Lane repair

The specification supports remapping (repair) of up to two data Lanes for each group of 32 data
Lanes. TD_P[31: 0] (RD_P[31 : 0] ) and TD_P[63: 32] (RD_P[63: 32] ) are treated as two
separate groups of 32 Lanes that can be independently repaired using redundant Lanes,
TRD_P [1 : 0] (RRD_P [1 : 0] ) and TRD_P [3 : 2] (RRD_P[3 : 2] ), respectively. TD_P [63: 32]
(RD_P[63: 32]) and hence TRD_P[3 :2] (RRD_P[3:2]) do not apply to x32 Advanced Package Link.

Lane remapping is accomplished by "shift left" or "shift right" operation. A "shift left" is when data
traffic of logical Lane TD_L [n] on TD_P[n] is multiplexed onto TD_P [n-1] . A shift left puts TD_L[0]
onto TRD _ P0 or TD_L[32] onto TRD _ P2. A shift right operation is when data traffic TD _ L[n] is
multiplexed onto TD_P [n+1] . A shift right puts TD_L [31] onto TRD_P1 or TD_L [ 63] onto TRD_P3.
See the pseudo codes in Section 4.3.3.1 and Section 4.3.3.2 that show the changes in mapping post
repair.

Note:
If the lower index redundant Lane (TRD_P[0] or TRD_P[2]) is faulty, no data lanes
can be repaired for its group. Note that if the higher index redundant lane (TRD_P [1]
or TRD_P [3]) is faulty, one data lane can be repaired for its group.

After a data Lane is remapped, the Transmitter associated with the faulty physical Lane is tri-stated
and the Receiver is disabled. The Transmitter and the Receiver of the redundant Lane used for the
repair are enabled.

Figure 4-12 shows transmit bump side of data Lane remapping for the first group of 32 Lanes. Both
"shift left" and "shift right" remapping is needed to optimally repair up to any two Lanes within the
group. Figure 4-13 shows details of the mux structure used for data Lane repair.

Note:
Example repair implementations are shown for TD_P [31 : 0] for clarity. It should be
noted that the same schemes are also applicable to TD_P [63 : 32] .

<figure>
<figcaption>Figure 4-12. Data Lane remapping possibilities to fix potential defects</figcaption>

TD_P2

TD_P9

TD_P16

TD_P23

TD_P30

$T D \_ P 3$

TD_P10

TD_P17

TD_P24

TD_P31

$T D _ { - } P 1$

TD_P8

$T D _ { - } P 1 5$

TD_P22

TD_P29

$T D \_ P 4$

TD_P11

TD_P18

TD_P25

$T R D \_ P 1$

TD_P0

TD_P7

TD_P14

TD_P21

TD_P28

TD_P5

$T D _ { - } P 1 2$

TD_P19

TD_P26

TRD_P0

TD_P6

TD_P13

TD_P20

TD_P27

</figure>

<figure>
<figcaption>Figure 4-13. Data Lane remapping: Mux chain</figcaption>

TD_L[n-1]

$\frac { E } { e }$

TD_L[n+1]

$\frac { 8 } { 8 }$

Shift_right

Shift_left

Lane Repair
Mux

Lan e Repair
Mux

Lane Repair
Mux

Lan e Repair
Mux

$\mathrm { T x }$

$\mathrm { T x }$

$T x$

$T x$

$D i e - 1$

$T D _ { - } P \left[ n _ { 1 } \right]$

$T D \_ P \left[ n \right]$

$P \left[ n + 1 \right]$

$T D _ { - } P \left[ n + 2 \right]$

RD_P[nl1]

RD_P[n]

$P \left[ n + 1 \right]$

$R D _ { - } P \left[ n + 2 \right]$

Rx

Rx

$R x$

Rx

Die-2

Lan e Repair
Mux

Lan e Repair
Mux

Lan e Repair
Mux

Lane Repair
Mux

RD_L[n-1]

RD_L[n]

RD_L[n+1]

RD_L[n+2]

</figure>

### 4.3.2 Data Lane repair with Lane reversal

If Lanes are reversed, physical Lane 0 of Transmitter (TD_P [0]) is connected to physical Lane N-1 of
the Receiver (RD_P [N-1] ). N is 64 or 32 for x64 or x32 Advanced Package modules, respectively.
See the pseudo codes in Section 4.3.3.3 and Section 4.3.3.4 that show the changes in mapping post
repair.

### 4.3.3 Data Lane repair implementation

#### 4.3.3.1 Single Lane repair

TRD_P[0] (RRD_P[0]) must be used as the redundant Lane to remap any single physical Lane
failure for TD_P [31 : 0] (RD_P[31 : 0] ) . TRD [2] (RRD [2] ) must be used as the redundant Lane to
remap any single Lane failure for TD_P [63: 32] (RD_P[63: 32] ) .

Pseudo code for repair in TD_P[31: 0] $\left( R D \_ P \left[ 3 1 : 0 \right] \right)$ $\left( 0 < = x < = 3 1 \right) :$

IF failure occurs in TD_P[x] :
IF x > 0 :

FOR 0 <= i < x:
TD_P [x-i-1] = TD_L [x-i]
$R D _ { - } L \left[ x - i \right] = R D _ { - } P \left[ x - i - 1 \right]$
TRD_P[0] = TD_L [0]
RD_L[0] = RRD_P[0]

Pseudo code for repair in TD_P [63 : 32] (RD_P[63: 32] ) $\left( 3 2 < = x < = 6 3 \right)$ (this does not apply to $x 3 2$
Advanced Package Link):

<figure>

IF failure occurs in TD_P[x] :
IF x > 32 :

FOR 0 <= i < x-32:
TD_P [x-i-1] = TD_L [x-i]
RD_L [x-i] = RD_P[x-i-1]
$I R D _ { - } P \left[ 2 \right] = I D _ { - } L \left[ 3 2 \right]$
RD_L [32] = RRD_P[2]

</figure>

As shown in Figure 4-14 TD_P [29] is remapped in the direction to use TRD_P $\left[ 0 \right]$ as the repair
resource. Figure 4-15 shows the circuit implementation.

<figure>
<figcaption>Figure 4-14. Example of Single Lane failure remapping</figcaption>

$T D \_ P 2$

TD_P9

TD_P16

$T D _ { - } P 2 3$

$T D _ { - } P 3 0$

$T D _ { - } P 3$

TD_P10

TD_P17

$T D _ { - } P 2 4$

TD_P31

TD_P1

TD_P8

TD_P15

TD_P22

TD

29

TD_P4

TD_P11

TD_P18

TD_P25

TRD_P1

$T D _ { - } P C$

$T D _ { - } P 7$

$T D _ { - } P 1 4$

TD_P21

TD_P28

TD_P5

TD_P12

TD_P19

TD_P26

$T R D \_ P O$

TD_P6

TD_P13

TD_P20

TD_P27

</figure>

<figure>
<figcaption>Figure 4-15. Example of Single Lane remapping implementation</figcaption>

$\frac { 8 } { 8 }$

$\frac { E } { e }$

$\frac { 8 } { 8 }$

$\frac { 8 } { 8 }$

Lan Repair
Mux

Lane Repair
Mu

Lane Repair
Mux

Lane Repair
Mux

$\bar { I } \mathrm { x }$

T

‹

$T x$

$\mathrm { T x }$

$D i e - 1$

$T D _ { - } P \left[ n - 1 \right]$

$T D _ { - } P \left[ n \right]$

$r D _ { - } P \left[ n + 1 \right]$

$T D _ { - } P \left[ n + 2 \right]$

BAD
LANE

$\left. R D \_ P \left[ n \right] - 1 \right]$

$R D \_ P \left[ n \right]$

$R D \_ P \left[ n + 1 \right]$

$R D _ { - } P \left[ n + 2 \right]$

$R x$

R

‹

$R x$

$R x$

Die-2

Lan e Repair
Mux

Lan e Repair
Mux

Lan e Repair
Mux

Lane Repair
Mux

$\frac { 8 } { 8 }$

$\frac { 5 } { 8 }$

RD_L[n+1]

RD_L[n+2]

</figure>

#### 4.3.3.2 Two Lane repair

Any two Lanes within a group of 32 can be repaired using the two redundant bumps. For any two
physical Lane failures in TD_P [31 : 0] (RD_P[31 : 0]), the lower Lane must be remapped to
TRD_P [0] (RRD_P[0]) and the upper Lane is remapped to TRD_P [1] (RRD_P [1]) . For any two
physical Lane failures in TD_P [63 : 32] (RD_P[63: 31] ), the lower Lane must be remapped to
TRD_P [2] (RRD_P[2]) and the upper Lane is remapped to TRD_P [3] (RRD_P [3]).

Pseudo code for two Lane repair in TD_P[31: 0] (RD_P[31: 0]) $\left( 0 < = x , y < = 3 1 \right) :$

<figure>

IF failure occurs in TD_P[x], TD_P[y] AND $\left( x < y \right)$ :
IF x > 0 :
FOR 0 <= i < x:
TD_P [x-i-1] = TD_L [x-i]
RD_L [x-i] = RD_P[x-i-1]
TRD_P[0] = TD_L [0]
$R D \_ L \left[ 0 \right] = R R D \_ P \left[ 0 \right]$
IF y < 31:
FOR 0 <= j < (31-y) :
TD_P[y+j+1] = TD_L[y+j]
$R D \left[ L \left[ y + j \right] = R D _ { - } P \left[ y + j + 1 \right] \right.$
$T R D \_ P \left[ 1 \right] = T D \_ L \left[ 3 1 \right]$
RD_L $I \left[ 3 1 \right] = R R D _ { - } \left[ 1 \right]$

</figure>

Pseudo code for two Lane repair in TD_P[63: 32] (RD_P[63: 32]) $\left( 3 2 < = x , y < = 6 3 \right)$ (this does not
apply to x32 Advanced Package Link):

$$\mathrm { R D } L \left[ x - i \right] = R D \quad P \left[ x - i - 1 \right]$$

<figure>

IF failure occurs in TD_P[x], $\mathbb{P} \left[ \mathrm { y } \right]$ AND $\left( x < y \right)$ :
IF $x > 3 2$ :

FOR $0 < = i < x - 3 2 :$
$T D \_ P \left[ x - i - 1 \right] = T D \_ L \left[ x - i \right]$

_
$T R D \_ P \left[ 2 \right] = T D \_ L \left[ 3 2 \right]$
$\mathrm { r i } \left[ 3 2 \right] = \mathrm { R R D } _ { - } \left[ 2 \right]$
IF $y < 6 3 :$
FOR 0 <= j < (63-y) :
$\mathrm { T R D } _ { - } \mathbb{P} \left[ 3 \right] = \mathrm { T D } _ { - } \mathrm { I } \left[ 6 3 \right]$
RD_L[63] = RRD_P[3]

$$T D \_ P \left[ y + j + 1 \right] = T D \_ L \left[ y + j \right]$$
$$R D \_ L \left[ y + j \right] = R D \_ P \left[ y + j + 1 \right]$$

</figure>

Shown in Figure 4-16 is an example of two (physical Lanes 25 and 26) Lane remapping. Figure 4-17
shows the circuit implementation. Both Transmitter and Receiver must apply the required remapping.

<figure>
<figcaption>Figure 4-16. Example of Two Lane failure remapping</figcaption>

TD_P2

$T D \_ P 9$

TD_P16

TD_P23

TD_P30

$T D _ { - } P 3$

$T D _ { - } P 1 0$

TD_P17

TD_P24

TD_P31

$T D \_ P 1$

TD_P8

TD_P15

TD_P22

TD_P29

TD_P4

TD_P11

TD_P18

TD 25

TRD_P1

$T D _ { - } P C$

TD_P7

TD_P14

TD_P21

TD_P28

TD_P5

TD_P12

$T D _ { - } P 1 9$

:

TD 26

TRD_P0

$T D \_ P 6$

TD_P13

$T D _ { - } P 2 0$

TD_P27

</figure>

<figure>
<figcaption>Figure 4-17. Example of Two Lane remapping implementation</figcaption>

TD_L[n-1]

$\frac { 5 } { 8 }$

TD_L[n+1]

$\frac { 8 } { 8 }$

La
e Repair
Mux

Lane Repair
Mux

Lan e Repair
Mux

L

ne Repair
Mux

Tx

$T x$

$T x$

Tx

$\mathrm { D i e - 1 }$

TD_P[n ]1]

$D _ { - }$

TD_F[n+1

]

$T D \_ P \left[ n + 2 \right]$

BAD

LANES

RD_P[nl1]

$R D \_ P \left[ n \right]$

RD_P[n+1]

$R D \_ P \left[ n + 2 \right]$

Rx

Rx

Rx

Rx

Die-2

Lane Repair
Mux

an e Repair
Mux

L
ne Repair
Mux

Lan e Repair
Mux

RD_L[n-1]

$\frac { 5 } { 8 }$

$\frac { 8 } { 8 }$

RD_L[n+2]

</figure>

#### 4.3.3.3 Single Lane repair with Lane reversal

#### 4.3.3.3.1 x64 Advanced Package Pseudo Codes

Pseudo code for one Lane failure in $T D \_ P \left[ 3 1 : 0 \right]$ (RD_P[32: 63]) $\left( 0 < = x < = 3 1 \right) :$

IF failure occurs in TD P[x] :
IF $x > 0$ :
FOR 0 <= i < x:

$$\mathrm { T D } \quad \mathrm { P } \left[ \mathrm { x } - \mathrm { i } - 1 \right] = \mathrm { T D } \mathrm { L } \left[ 6 3 - \mathrm { x } + \mathrm { i } \right]$$
$$R D \_ L \left[ 6 3 - x + i \right] = R D \_ P \left[ 6 3 - x + i + 1 \right]$$
_

_
TRD_P[0] = TD_L [63]
RD_L[63] = RRD_P[3]

Pseudo code for one Lane failure in TD_P[63: 32] $\left( R D \_ P \left[ 0 : 3 1 \right] \right)$ $\left( 3 2 < = x < = 6 3 \right) :$

IF failure occurs in TD_P[x] :
IF x > 32 :
FOR 0 <= i < x-32:
TD_P[x-i-1] = TD_L [63-x+i]
RD_L[63-x+i] = RD_P[63-x+i+1]
TRD_P [2] = TD_L [31]
RD_L [31] = RRD_P [1]

#### 4.3.3.3.2 x32 Advanced Package Pseudo Codes

Pseudo code for one-Lane failure in TD_P[31: 0] (RD_P[0:31]) $\left( 0 < = x < = 3 1 \right) :$

IF failure occurs in $T D \_ P \left[ x \right]$ :
IF $x > 0$ :
FOR 0 <= i < x:
$T R D \_ P \left[ 0 \right] = T D \_ L \left[ 3 1 \right]$
RD_L [31] = RRD_P [1]

$$T D \_ P \left[ x - i - 1 \right] = T D \_ L \left[ 3 1 - x + i \right]$$
$$R D _ { - } L \left[ 3 1 - x + i \right] = R D _ { - } P \left[ 3 1 - x + i + 1 \right]$$

#### 4.3.3.4 Two Lane repair with Lane reversal

#### 4.3.3.4.1 x64 Advanced Package Pseudo Codes

Pseudo code for two Lane failure in TD_P[31: 0] (RD_P[32: 63]) $\left( 0 < = x < = 3 1 \right) :$

<figure>

IF failure occurs in TD_P[x], TD_P[y] AND $\left( x < y \right)$ :
IF x > 0 :

FOR 0 <= i < x:
TD_P[x-i-1] = TD_L [63-x+i]
RD_L[63-x+i] = RD_P[63-x+i+1]
TRD_P[0] = TD_L [63]
RD_L [63] = RRD_P [3]
IF y < 31:
FOR 0 <= j < (31-y) :
TD_P[y+j+1] = TD_L [63-y-j]
RD_L[63-y-j] = RD_P[63-y- (j+1) ]
TRD_P [1] = TD_L [32]
RD_L [32] = RRD_P[2]

</figure>

Pseudo code for two-Lane failure in TD_P[63: 32] (RD_P[0: 31]) $\left( 3 2 < = x < = 6 3 \right) :$

IF failure occurs in TD_P[x], TD_P[y] AND $\left( x < y \right)$ :
IF x > 32 :
FOR 0 <= i < x-32:
TD_P [x-i-1] = TD_L [63-x+i]
RD_L[63-x+i] = RD_P[63-x+ (i+1) ]
TRD_P [2] = TD_L [31]
RD_L [31] = RRD_P [1]
IF y < 63:
FOR 0 <= j < (63-y) :
{ \text { TD } - \left[ y + j + 1 \right] = \text { TD } \left[ 6 3 - y - j \right] }<br>{ \text { RD } \left[ L \left[ 6 3 - y - j \right] = R D \right] = P \left[ 6 3 - y - \left( j + 1 \right) \right] }
TRD_P [3] = TD_L
$R D \_ L \left[ 0 \right] = R R D \_ P \left[ 0 \right]$

#### 4.3.3.4.2 x32 Advanced Package Pseudo Codes

Pseudo code for two-Lane failure in TD_P[31: 0] (RD_P[0: 31]) (0 <= x <= 31):

<figure>

IF failure occurs in TD_P[x], $\mathbb{P} \left[ \mathrm { y } \right]$ AND $\left( x < y \right)$ :
IF x > 0 :

FOR 0 <= i < x:

$$T D \_ P \left[ x - i - 1 \right] = T D \_ L \left[ 3 1 - x + i \right]$$

_

$$R D \_ L \left[ 3 1 - x + i \right] = R D \_ P \left[ 3 1 - x + i + 1 \right]$$

_
TRD_P[0] = TD_L [31]
RD_L [31] = RRD_P [1]
IF $y < 3 1$ :
FOR 0 <= j < (31-y) :

$$T D \_ P \left[ y + j + 1 \right] = T D \_ L \left[ 3 1 - y - j \right]$$
$$R D _ { - } L \left[ 3 1 - y - j \right] = R D _ { - } P \left[ 3 1 - y - \left( j + 1 \right) \right]$$

TRD_P $\left[ 1 \right] = T D \_ L \left[ 0 \right]$
$L \left[ 0 \right] = R R D _ { - } P \left[ 0 \right]$

</figure>

### 4.3.4 Clock and Track Lane remapping

The specification supports remapping of one broken Lane for TCKP_P/RCKP_P, TCKN_P/RCKN_P and
TTRK_P/RTRK_P physical Lanes. The repair scheme is shown in Figure 4-18. Clock Lane remapping
allows repair of single Lane failure for both differential and pseudo-differential implementation of the
clock Receiver. The circuit details are shown in Figure 4-19 and Figure 4-20 for differential and
pseudo-differential clock Receivers respectively.

After a Lane is remapped, the Transmitter is tri-stated. The Receiver of the physical redundant
(RRDCK_P) Lane is disabled.

<figure>
<figcaption>Figure 4-18. Clock and Track repair</figcaption>

TCKP_P

TCKN_P

TRDCK_P

TTRK_P

</figure>

<figure>
<figcaption>Figure 4-19. Clock and track repair: Differential Rx</figcaption>

Clock $R x$ (Differential)

$\mathrm { T C K P } _ { - } \mathrm { L }$

Normal Path

TCKP_P

RCKP_P

Repair Path

☒

☒

Normal Path P

Repair P

TCKN_L

Normal Path

TCKN_P

RCKN P

Repair Path

☒

☒

Normal Path N

RX Diff

RCK_L

Repair N

Repair Path clock

TRDCK_L

No Repair

TRDCK_P

RRDCK P

Repair Path track

☒

☒

Normal Path RD

RX

RRDCK_L

Repair Path

TTRK_L

Normal Path

TTRK_P

RTRK P

Repair TRK

Normal Path TRK

RX

RTRK_L

Repair Path

☒

☒

</figure>

<figure>
<figcaption>Figure 4-20. Clock and track repair: Pseudo Differential Rx</figcaption>

Clock Rx (Pseudo Differential)

TCKP_P

TxCLKP

Normal Path

RCKP_P

Repair Path

☒

☒

Normal Path P

Rx

RCKP_L

Normal Path

TCKN_P

RCKN P

Repair P

TxCLKN

Repair Path

☒

☒

Normal Path N

Rx

RCKN_L

Repair Path clock

Repair N

No Repair

TRDCK_P

RRDCK_P

TRDCK_L

Normal Path RD

Repair Path track

☒

☒

Repair Path

RX

RRDCK_L

Normal Path

TTRK_P

RTRK_P

Repair TRK

TTRK_L

Repair Path

☒

☒

Normal Path TRK

RX

$\mathrm { R T R K } _ { - } !$

</figure>

### 4.3.5 Clock and Track Lane repair implementation

Pseudo code for Clock and Track Lane repair:

<figure>

IF failure occurs in TCKP_P:

TCKN P = TCKP L AND TRDCK_P = TCKN_L
RCKP_L = RCKN P AND RCKN_L = RRDCK_P

ELSE IF failure occurs on TCKN_P:
TRDCK P = TCKN L
RCKN L = RRDCK P
_
_

_

_

ELSE IF failure occurs in TTRK P:
TRDCK P = TTRK L
RTRK L = RRDCK P
_
_
_

_

</figure>

The implementation of Clock and Track Lane remapping is shown in Figure 4-21(a), $F i g u r e \quad 4 - 2 1 \left( b \right)$
and Figure 4-21(c) respectively. The corresponding circuit level details of remapping implementation
are shown in Figure 4-22, Figure 4-23 and Figure 4-24.

Note that the both Transmitter and Receiver on CKRD Lane are required during detection phase and
can be tri-stated and turned off if not used for repair.

<figure>
<figcaption>Figure 4-21. Clock and Track Lane repair scheme</figcaption>

TCKP_P

TCKP_P

TCKP_P

TCKN_P

TCKN_P

TCKN_P

TRDCK_P

TRDCK_P

TRDCK_P

TTRK_P

TTRK_P

TTRK_P

(a)

(b)

(c)

</figure>

<figure>
<figcaption>Figure 4-22. Clock and track repair: CKP repair</figcaption>

Clock Rx (Pseudo Differential)

TCKP_L

Normal Path

TCKP_P

RCKP P

Repair Path

☒

☒

Normal Path P

$R x$

$\mathrm { R C K P } _ { - }$

$\mathrm { T C K N } _ { - } \mathrm { L }$

Normal Path

TCKN P

RCKN P

Normal Path N

Repair Path

Donair N

$R v$

RCKN_L

Repair Path clock

No Repair

TRDCK_P

RRDCK_P

TRDCK_L

Normal Path RD

Repair Path track

Repair Path

RX

RRDCK_L

TTRK_L

Normal Path

TTRK P

RTRK P

Repair TRK

☒

Normal Path TRK

RX

RTRK_L

nepal Fall

☒

</figure>

<figure>
<figcaption>Figure 4-23. Clock and track repair: CKN repair</figcaption>

Clock Rx (Pseudo Differential)

TCKP_L

Normal Path

TCKP_P

RCKP_P

nepal Patlı

Normal Dath D

Repair P

RX

RCKP_L

TCKN_L

Normal Path

TCKN_P

RCKN P

Repair Path

☒

☒

☒

Normal Path N

Danair N

Rv

RCKN_L

Repair Path clock

TRDCK_L

No Repair

TRDCK_P

RRDCK P
☒

lormal Path RD

Repair Path track

RRDCK_L

Repair Path

RX

TTRK_L

Normal Path

TTRK P

RTRK P

Repair TRK

Normal Path TRK

Rx

$\mathrm { R T R K } _ { - }$

Repair Path

</figure>

<figure>
<figcaption>Figure 4-24. Clock and track repair: Track repair</figcaption>

Clock Rx (Pseudo Differential)

TCKP_L

Normal Path

TCKP_P

RCKP_P

Repair Path

Normal Dath D

Repair P

RX

RCKP_L

TCKN_L

Normal Path

TCKN_P

RCKN P

Normal Path N

Repair Path

Repair N

Rx

RCKN_L

Repair Path clock

No Repair

TRDCK_P

RRDCK_P

TRDCK

Normal Path RD

Repair Path track

Repair Path

RX

RRDCK_L

TTRK_L

Normal Path
Repair Path

TTRK_P

RTRK P

Repair TRK

Normal Path TRK

RX

RTRK_L

</figure>

### 4.3.6 Valid Repair and implementation

Valid Lane has a dedicated redundant Lane. If a failure is detected on the Valid physical Lane,
redundant Valid physical Lane is used to send Valid. Valid failure detection and repair is performed
during Link initialization and Training (Section 4.5.3.3.4).

Figure 4-25 shows the normal path for Valid and redundant valid Lanes. Figure 4-26 shows the repair
path for Valid Lane failure.

<figure>
<figcaption>Figure 4-25. Valid repair: Normal Path</figcaption>

Die-1

$D i e - 2$

TVLD_L

e Repair

TVLD_P

RVLD_P

e Repair

RVLD_L

Lane

Mux

Rx

$1$

Mux

La

TRDVLD_L

an e Repair

TRDVLD_P

RRDVLD_P

Mux

Rx

RRDVLD_L

Tx
Tx

ne Repair

Lane

Mux

</figure>

<figure>
<figcaption>Figure 4-26. Valid Repair: Repair Path</figcaption>

$D i e - 1$

$D i e - 2$

TVLD_L

Lane Repair

TVLD_P

RVLD_P

Mux

$\sharp$

Rx

an e Repair

Mux

RVLD_L

TRDVLD_L

Repair

TRDVLD_P

RRDVLD_P

Aux

Tx

Rx

Lan e Repair

RRDVLD_L

Mux

Lan

</figure>

### 4.3.7 Width Degrade in Standard Package Interfaces

In the case of x16 Standard Package modules where Lane repair is not supported, resilience against
faulty Lanes is provided by configuring the Link to a x8 width (Logical Lanes 0 to 7 or Logical Lanes 8
to 15, which exclude the faulty Lanes). For example, if one or more faulty Lanes are in logical Lane 0

to 7, the Link is configured to x8 width using logical Lanes 8 to 15. The configuration is done during
Link initialization or retraining. Transmitters of the disabled Lanes are tri-stated and Receivers are
disabled.

In the case of x8 Standard Package modules, resilience against faulty Lanes is provided by
configuring the Link to a x4 width (Logical Lanes 0 to 3 or Logical Lanes 4 to 7, which exclude the
faulty Lanes). The configuration is done during Link initialization or retraining. Transmitters of the
disabled Lanes are tri-stated and Receivers are disabled.

Figure 4-5 shows the byte to Lane mapping for a width degraded x8 interface

## 4.4 Data to Clock Training and Test Modes

Note:
Sideband commands will be identified as {SB command}.

Figure 4-27 shows the infrastructure for interface training and testing. The Transmit Die and Receive
Die implement the same Linear Feedback Shift Register (LFSR) described in Section 4.4.1. The
pattern sent from the Transmitter along with forwarded clock and Valid is compared with locally
generated reference pattern. Both transmit and receive pattern generators must start and advance in
sync. The compare circuitry checks for matching data each UI. Any mismatch between the received
pattern and pattern predicted by the local pattern generator is detected as an error.

<figure>
<figcaption>Figure 4-27. Test and training logic</figcaption>

Ref Pattern
Gen

Clock

Valid

Pattern
Gen

Error
Detect

Pattern

Rx

Pattern

Vajid

Transmit Die

Receive Die

</figure>

The receive die must implement two types of comparison schemes

. Per-Lane comparison: Per-Lane comparison is used to identify the number of failing Lanes
between the two dies. Any mismatch, above the set threshold between the received pattern and
the expected pattern on each Lane, will set an internal error detect bit for each Lane. Once a
pattern mismatch on a particular Lane is found, this error bit is set for the remainder of the test.
Figure 4-28 illustrates Per-Lane comparison mode. This mode will indicate per-Lane errors within
the module $\left( N = 6 8 \left( 6 4 + 4 \quad R D \right) \right.$ for a x64 Advanced Package Module, $N = 3 4$ (32 + 2 RD) for a
x32 Advanced Package Module, $N = 1 6$ for a x16 Standard Package Module, and $N = 8$ for a x8
Standard Package Module, respectively). The per-Lane comparison results can be read via
sideband.

· Aggregate comparison: In this mode, pattern mismatches each UI on any Lane within the
module are accumulated into a 16-bit error counter. The Lane errors are ORed to generate a
module-level error and counted as shown in Figure 4-29. This scheme can be used for module
level margin and BER.

<figure>
<figcaption>Figure 4-28. Lane failure detection</figcaption>

Error bits

Remote pattern

Lane 0

D

☐

Lane 1

D

☐

Lane 2

☐

Lane 3

☐

☐
Lane (N-1)

☐

Local pattern

Lane N

</figure>

<figure>
<figcaption>Figure 4-29. All Lane error detection</figcaption>

Remote pattern

Lane 0

Lane 1

Lane 2

Lane 3

Error
Counter

Lane (N-1)

Local pattern

Lane N

</figure>

### 4.4.1 Scrambling and training pattern generation

A Linear feedback shift register (LFSR) is defined for scrambling and test pattern generation.

The LFSR uses the same polynomial as PCIe: $G \left( X \right) = X ^ { 2 3 } + X ^ { 2 1 } + X ^ { 1 6 } + X ^ { 8 } + X ^ { 5 } + X ^ { 2 } + 1 .$ Each
☒ ☒ ☒

☒ ☒ ☒ ☒
Transmitter is permitted to implement a separate LFSR for scrambling and pattern generation. Each
Receiver is permitted to implement a separate LFSR using the same polynomial for de-scrambling and
pattern comparison. The implementation is shown in Figure 4-30. The seed of the LFSR is Lane
dependent, and based on the Logical Lane number and the seed value for Lane number is modulo 8
as shown in Table 4-4.

Alternatively, implementations can choose to implement one LFSR with different tap points for
multiple Lanes as shown in Figure 4-31. This is equivalent to individual LFSR per-Lane with different
seeds.

<table>
<caption>Table 4-4. LFSR seed values</caption>
<tr>
<th>Lane</th>
<th>Seed</th>
</tr>
<tr>
<td>0</td>
<td>23'h1DBFBC</td>
</tr>
<tr>
<td>1</td>
<td>23'h 0607BB</td>
</tr>
<tr>
<td>2</td>
<td>23'h1EC760</td>
</tr>
<tr>
<td>3</td>
<td>23'h18C0DB</td>
</tr>
<tr>
<td>4</td>
<td>23'h010F12</td>
</tr>
<tr>
<td>5</td>
<td>23'h19CFC9</td>
</tr>
<tr>
<td>6</td>
<td>23'h0277CE</td>
</tr>
<tr>
<td>7</td>
<td>23'h1BB807</td>
</tr>
<tr>
<td>RDO, RD2ª</td>
<td>23'h18C0DB</td>
</tr>
<tr>
<td>RD1, RD3b</td>
<td>23'h010F12</td>
</tr>
</table>

a. Same as Lane 3. These are not currently used.

b. Same as Lane 4. These are not currently used.

Figure 4-30. LFSR implementation

<figure>

Data_Out

D0

D1

D2

D3

D4

D5

D6

D7

$D 8$

D9

$D 1 0$

D11

D12

D13

D14

D15

D16

D17

D18

D19

D20

D21

D22

\+

</figure>

<table>
<tr>
<th>Seed</th>
<th>Seed</th>
<th>Seed</th>
<th>Seed</th>
<th>Se ed</th>
<th></th>
<th>Seed</th>
<th>Seed</th>
<th>Seed</th>
<th>Seed</th>
<th>Seed</th>
<th>Se ed</th>
<th>Seed</th>
<th>Seed</th>
<th>Se ed</th>
<th>Seed</th>
<th>Seed</th>
<th>Seed</th>
<th>Seed</th>
<th>Se ed</th>
<th>Seed</th>
<th>Seed</th>
<th>{ \text { Seed } }<br>{ \text { na } }</th>
</tr>
<tr>
<td>D0</td>
<td>$D 1$</td>
<td>D2</td>
<td>D3</td>
<td>D4</td>
<td>$D 5$</td>
<td>D6</td>
<td>D7</td>
<td>D8</td>
<td>D9</td>
<td>D10</td>
<td>D11</td>
<td>D12</td>
<td>D13</td>
<td>D14</td>
<td>D15</td>
<td>D16</td>
<td>D17</td>
<td>D18</td>
<td>D19</td>
<td>D20</td>
<td>D21</td>
<td>Data_In</td>
</tr>
</table>

Figure 4-31. LFSR alternate implementation

<figure>
</figure>

<table>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th colspan="2" rowspan="2">D10</th>
<th colspan="2" rowspan="2">D11</th>
<th rowspan="2">D12</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
<tr>
<th>D0</th>
<th></th>
<th>D1</th>
<th></th>
<th>$D 2$</th>
<th></th>
<th>D3</th>
<th></th>
<th>D4</th>
<th></th>
<th>D5</th>
<th></th>
<th>D6</th>
<th></th>
<th>D7</th>
<th></th>
<th>D8</th>
<th></th>
<th>D9</th>
<th></th>
<th></th>
<th>D13</th>
<th></th>
<th>D14</th>
<th></th>
<th>D15</th>
<th></th>
<th>D16</th>
<th></th>
<th>D17</th>
<th></th>
<th>D18</th>
<th></th>
<th>D19</th>
<th></th>
<th>D20</th>
<th></th>
<th>D21</th>
<th></th>
<th>D22</th>
<th></th>
</tr>
<tr>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
<th>Seed</th>
<th></th>
</tr>
<tr>
<td>D0</td>
<td></td>
<td>D1</td>
<td></td>
<td>D2</td>
<td></td>
<td>D3</td>
<td></td>
<td>D4</td>
<td></td>
<td>D5</td>
<td></td>
<td>D6</td>
<td></td>
<td>D7</td>
<td></td>
<td>D8</td>
<td></td>
<td>$D 9$</td>
<td></td>
<td>D10</td>
<td></td>
<td>D11</td>
<td></td>
<td>D12</td>
<td></td>
<td>D13</td>
<td></td>
<td>D14</td>
<td></td>
<td>D15</td>
<td></td>
<td>D16</td>
<td></td>
<td>D17</td>
<td></td>
<td>D18</td>
<td></td>
<td>D19</td>
<td></td>
<td>D20</td>
<td></td>
<td>D21</td>
<td></td>
<td>D22</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"></td>
<td rowspan="2">For i = For i =</td>
<td rowspan="2">For i =</td>
<td>For i</td>
<td rowspan="2">For i = For i =</td>
<td>For i</td>
<td>For i Reset</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>=</td>
<td>=</td>
<td>=</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>7, 6,</td>
<td>5,</td>
<td>4,</td>
<td>3, 2,</td>
<td>1,</td>
<td>0, Value</td>
<td></td>
<td>Tap_Eqn_Lane_i Data_In_Lane_i</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>9,</td>
<td>8,</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>15, 14,</td>
<td>13,</td>
<td>12,</td>
<td>11, 10,</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>17,</td>
<td>16, =</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>23, 22,</td>
<td>21,</td>
<td>20,</td>
<td>19, 18,</td>
<td></td>
<td>'1</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>25,</td>
<td>24,</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>31, 30,</td>
<td>29,</td>
<td>28,</td>
<td>27, 26,</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>39, 38,</td>
<td>37,</td>
<td>36,</td>
<td>35, 34,</td>
<td>33,</td>
<td>32,</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>47, 46,</td>
<td>45,</td>
<td>44,</td>
<td>43, 42,</td>
<td>41,</td>
<td>40,</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>49,</td>
<td>48,</td>
<td></td>
<td>+</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>55, 54,</td>
<td>53,</td>
<td>52,</td>
<td>51, 50,</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>57:</td>
<td>56: Tap_Eqn_Lane_i</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>63: 62:</td>
<td>61:</td>
<td>60:</td>
<td>59: 58:</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Tap_Eqn_Lane_i</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"></td>
<td rowspan="2">Tap_Eqn_Lane_i = Tap_Eqn_Lane_i =</td>
<td rowspan="2">Tap_Eqn_Lane_i =</td>
<td rowspan="2">Tap_Eqn_Lane_i =</td>
<td rowspan="2">Tap_Eqn_Lane_i = Tap_Eqn_Lane_i =</td>
<td rowspan="2">=</td>
<td rowspan="2">=</td>
<td></td>
<td>Data_Out_Lane_i</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>D1^D9 D3^D9</td>
<td>D1^D3</td>
<td>D3^D22</td>
<td>D1^D22 D13^22</td>
<td>D1^D13</td>
<td>D9^D13</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="2"></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</table>

## 4.5 Link Initialization and Training

Link initialization and training are described at a Module level. The description of terms are used in
this section are as follows:

. UCIe Module Partner: A UCIe Module Partner is the corresponding UCIe Module on the remote
UCIe Die to which the UCIe Module connects. For example, if two UCIe Dies A and B are
connected in the standard Die rotate configuration by a 2-module UCIe Link, Modules 0 and 1;
UCIe Die A's Module 0 (UCIe Module A0) is connected to UCIe Die B's Module 1 (UCIe Module B1);
then A0 is the UCIe Module Partner of B1 and vice-versa.

· Phase Interpolator (PI) in this specification is used to refer any method of generating and
selecting sampling clock phase.

· Timeout: Every state except RESET, Active, L1/L2, and TRAINERROR in the Link Training State
Machine has a residency timeout of 8 ms. For states with sub-states, the timeout is per sub-state
(i.e., if Physical Layer is in a state for greater than 8 ms, then it transitions to TRAINERROR and
eventually to RESET). Physical Layer sideband handshakes for RDI state transitions with remote
Link partner also timeout after 8 ms. The timeout counters must be reset if a sideband message
with "Stall" encoding is received. All timeout values specified are -0% and +50% unless explicitly
stated otherwise. All timeout values must be set to the specified values after Domain Reset exit.
All counter values must be set to the specified values after Domain Reset.

· Electrical idle is described in Section 5.12.

· When Management Transport protocol is supported over the sideband, the term SB_MGMT_UP
refers to an internally maintained flag in the PHY that indicates whether the Management
Transport path has been successfully initialized with the partner chiplet. If the flag is cleared to 0,
the Management Transport path is not up. If the flag is set to 1, the Management Transport path
is up. The flag is cleared on a Management Reset or when a Heartbeat timeout is detected (see
Section 8.2.5.1.3). The flag is set after successful completion of the initialization phase of
Management Transport path setup as described in Section 8.2.3.1.2.

When training during Link Initialization (i.e., Physical Layer transitions out of RESET state), hardware
is permitted to attempt training multiple times:

· Triggers for initiating Link Training for Management Transport path setup on the sideband are:

\- Software writes 1 to the Retrain Link bit in the Sideband Management Port Structure register
(see Section 8.1.3.6.2.1)

\- HW-autonomous trigger by the Management Port Gateway to automatically train the
Management Transport path on the sideband without SW intervention, as occurs after
Management Reset

\- SBINIT pattern (two consecutive iterations of 64-UI clock pattern and 32-UI low) is observed
on any sideband Receiver clock/data pair, when the SB_MGMT_UP flag is cleared to 0

· The triggers for initiating Link Training for the mainband are:

\- Software writes 1 to Start UCIe Link Training bit in UCIe Link Control register in the UCIe Link
DVSEC (see Section 9.5.1.5)

\- When Management Transport protocol is supported on the UCIe link, software writes 1 to the
Retrain Link bit in the Management Port Structure register of either the Sideband or Mainband
Management Port that is associated with the UCIe link (see Section 8.1.3.6.2.1)

\- Adapter triggers Link Training on the RDI (RDI status is Reset and there is a NOP to Active
transition on the state request)

\- If [Management Transport protocol is not supported] OR [the SB_MGMT_UP flag is cleared to
0], the SBINIT pattern (two consecutive iterations of 64-UI clock pattern and 32-UI low) is
observed on any sideband Receiver clock/data pair

\- If [Management Transport protocol is supported] AND [the SB_MGMT_UP flag is set to 1], the
{SBINIT done req} sideband message was received from the module partner

If hardware fails training after an implementation-specific number of attempts, the hardware must
transition to RESET and wait for a subsequent Link Training trigger. Physical Layer must escalate a
fatal error to the D2D Adapter on the RDI if mainband Software-triggered or RDI-triggered Link
training fails or there is a Link-up-to-Link-down transition due to a Physical Layer timeout.

Throughout this section, references to mainband transmitter and receiver behavior are called out in
various state machine states. These references do not apply when the port does not have a mainband
(i.e., the port is a sideband-only port without a physically present mainband, or the port is a UCIe-S
port with only the sideband used. In the latter scenario, the mainband transmitters are held in tri-
state throughout and the mainband receivers are disabled.

### 4.5.1 Link Training Basic Operations

Some basic operations in Link training are defined in this section. These will be used in mainband
initialization, training and margining.

#### 4.5.1.1 Transmitter initiated Data to Clock Point Test

In this mode, the Transmitter initiates the data to clock training on all Lanes in the module at a single
PI phase. When not performing the actions relevant to this state:

· Data, Valid, and Track Transmitters drive low

· Clock Transmitters are held differential low (for differential clocking) or simultaneous low (for
Quadrature clocking)

· Data, Valid, and Clock Receivers are enabled

· Track Receiver is permitted to be disabled

The sequence of steps for this test are as follows for each UCIe Module of the UCIe Link:

1\. The UCIe Module sets up the Transmitter parameters (shown in Table 4-5), sends a {Start Tx Init
D to C point test req} sideband message to its UCIe Module Partner, and waits for a response. The
data field of this message includes the required parameters, shown in Table 4-5. The Receiver on
the UCIe Module Partner must enable the pattern comparison circuits to compare incoming
mainband data to the locally generated expected pattern. Once the data to clock training
parameters for its Receiver are setup, the UCIe Module Partner responds with a {Start Tx Init D to
C point test resp} sideband message.

2\. The UCIe Module resets the LFSR (scrambler) on its mainband Transmitters and sends the {LFSR
clear error req} sideband message. The UCIe Module Partner resets the LFSR and clears any prior
compare results on its mainband Receivers and responds with {LFSR clear error resp} sideband
message.

3\. The UCIe Module sends the pattern (selected through "Tx Pattern Generator Setup") for the
selected number of cycles ("Tx Pattern Mode Setup") on its mainband Transmitter.

4\. The UCIe Module Partner performs the comparison on its Receivers for each UI during the pattern
transmission based on "Rx Compare Setup" and logs the results.

5\. The UCIe Module requests its UCIe Module Partner for the logged results in Step 4 by sending
{Tx Init D to C results req} sideband message. The UCIe Module Partner stops comparison on its
mainband Receivers and responds with the logged results $\left\{ \mathrm { T x } \right.$ Init D to C results resp} sideband
message.

6\. The UCIe Module stops sending the pattern on its Transmitters and sends the {End Tx Init D to $\mathrm { C }$
point test req} sideband message and the UCIe Module Partner responds with { End Tx Init D to C
point test resp}. When a UCIe Module has received the {End Tx Init D to $\mathrm { C }$ point test resp}
sideband message, the corresponding sequence has completed.

<table>
<caption>Table 4-5. Data-to-Clock Training Parametersª</caption>
<tr>
<th>Parameter</th>
<th>Sideband Message Field</th>
<th>Options</th>
</tr>
<tr>
<td rowspan="3">Clock sampling/PI phase control</td>
<td rowspan="3">Clock Phase control at Transmitter</td>
<td>Eye Center found by training</td>
</tr>
<tr>
<td>Eye Left Edge found by training</td>
</tr>
<tr>
<td>Eye Right Edge found by training</td>
</tr>
<tr>
<td rowspan="3">Tx Pattern Generator Setup</td>
<td rowspan="2">Data Pattern (for Data Lanes)</td>
<td>LFSR Pattern for Data Lanes</td>
</tr>
<tr>
<td>Per-Lane ID pattern for Data Lanes as defined in Table 4-7</td>
</tr>
<tr>
<td>Valid Pattern (for Valid Lanes)</td>
<td>VALTRAIN pattern four 1s followed by four 0s</td>
</tr>
<tr>
<td rowspan="2">Tx Pattern Mode Setup</td>
<td rowspan="2">Pattern Mode</td>
<td>Burst Mode: Uses Burst Count/Idle Count/Iteration Count</td>
</tr>
<tr>
<td>Continuous Mode: Uses Burst count to indicate the number of UI of transmission. Idle Count = 0, Iteration Count = 1</td>
</tr>
<tr>
<td rowspan="2">Rx Compare Setup</td>
<td>Maximum Comparison error threshold</td>
<td>Maximum comparison error threshold</td>
</tr>
<tr>
<td>Comparison Mode</td>
<td>Per-Lane or aggregate error compare</td>
</tr>
</table>

a. See Table 7-11 for the encodings. See also the registers in Section 9.5.3.26 and Section 9.5.3.27. See also the Implementation
Note below this table.

##### IMPLEMENTATION NOTE

The Training Setup 1 and Training Setup 2 registers (see Section 9.5.3.26 and Section 9.5.3.27,
respectively) are applicable for compliance or debug. For regular operation, implementations must
follow the iteration or UI count specified in the corresponding states (for example, Section 4.5.3.4.8
specifies 4K UI of continuous mode LFSR pattern; and because these patterns are fixed, Rx is
permitted to ignore Burst Count/Idle Count/Iteration Count values in the sideband messages for
regular operation. Training Setup 3 and Training Setup 4 registers (see Section 9.5.3.28 and
Section 9.5.3.29, respectively) are applicable for regular operation as well as compliance and
debug.

Additionally, implementation notes for the parameters in Table 4-5:

· Clock sampling/PI phase control: For Tx-initiated Data to Clock point tests, this parameter is for
informational purposes only. For Rx-initiated Data to Clock point tests, the Transmitter sets the
PI phase for the requested setting (Eye Left edge, Eye Right edge or Eye Center) based on the
best known values from the most recent training for the corresponding speed. For the states of
MBTRAIN. VALVREF and MBTRAIN.DATAVREF, this would be the best known values at the
Transmitter at 4 GT/s. This field is not applicable and is ignored for Data to Clock eye sweep
tests.

· Tx Pattern Generator Setup and Tx Pattern Mode Setup:

\- For Continuous mode LFSR pattern, "Burst Count" indicates the number of UI of
transmission (for example, it is 4096 (or 4K) in Section 4.5.3.4.8). "Idle Count" is always 0
and "Iteration Count" is always 1.

\- For Continuous mode Per-Lane ID pattern, "Burst Count" indicates the number of UI of
transmission (e.g., it is 2048 for 128 iterations of the 16 bit pattern). "Idle Count" is always
0 and "Iteration Count" is always 1.

\- For Burst mode, the transmission is a "Burst Count" number of UI followed by an "Idle
Count" number of UI of 0 repeating for an "Iteration Count" number of times. In the case of
Per-Lane ID pattern, the "Burst Count" must be a multiple of the pattern size in UI. Burst
mode is currently not used for regular operation of Link Training.

\- VALTRAIN pattern is used for training of the Valid lane. In Continuous mode, "Burst Count"
indicates the number of UI of transmission (for example, it is 1024 for 128 iterations of the
8-bit pattern); "Idle Count" is always 0 and "Iteration Count" is always 1. In Burst mode,
the transmission is a "Burst Count" number of UI followed by an "Idle Count" number of UI
of 0 repeating for an "Iteration Count" number of times; the "Burst Count" must be a
multiple of the pattern size in UI.

#### 4.5.1.2 Transmitter initiated Data to Clock Eye Width Sweep

In this mode, the Transmitter initiates the data to clock training on all Lanes in the module and
sweeps through the sampling PI phases. This mode can also be used to check system margin. When
not performing the actions relevant to this state:

· Data, Valid, and Track Transmitters drive low

· Clock Transmitters are held differential low (for differential clocking) or simultaneous low (for
Quadrature clocking)

· Data, Valid, and Clock Receivers are enabled

· Track Receiver is permitted to be disabled

The sequence of steps for this test are as follows:

1\. The UCIe Module sets up the Transmitter parameters (shown in Table 4-5), sends a {Start Tx Init
D to C eye sweep req} sideband message to its UCIe Module Partner, and then waits for a
response. The data field of this message includes the required parameters, shown in Table 4-5.
The Receiver on the UCIe Module Partner must enable the pattern comparison circuits to compare
incoming mainband data to the locally generated expected pattern. Once the data to clock
training parameters for its Receiver are setup, the UCIe Module Partner responds with a {Start Tx
Init D to C eye sweep resp} sideband message.

2\. The UCIe Module resets the LFSR (scrambler) on its mainband Transmitters and sends the {LFSR
clear error req} sideband message. The UCIe Module Partner resets the LFSR and clears any prior
compare results on its mainband Receivers and responds with {LFSR clear error resp} sideband
message.

3\. The UCIe Module sends the pattern (selected through "Tx Pattern Generator Setup") for the
selected number of cycles ("Tx Pattern Mode Setup") on its mainband Transmitter.

4\. The UCIe Module Partner performs comparison on its Receivers for each UI during the pattern
transmission based on "Rx Compare Setup" and logs the results.

5\. The UCIe Module requests its UCIe Module Partner for the logged results in Step 4 by sending
{Tx Init D to C results req} sideband message. The UCIe Module Partner stops comparison on its
mainband Receivers and responds with the logged results {Tx Init D to C results resp} sideband
message.

6\. The UCIe Module sweeps through the PI phases on its forwarded clock Transmitter each time
repeating Step 2 through Step 5 to find the passing PI phase range. The sweep steps and range
are implementation specific.

7\. The UCIe Module stops sending the pattern on its Transmitters and sends the
{End Tx Init D to C eye sweep req} sideband message and the UCIe Module Partner responds
with {End Tx Init D to C eye sweep resp}. When a UCIe Module has received the {End Tx Init D to
C point eye sweep resp} sideband message, the corresponding sequence has completed.

### 4.5.1.3 Receiver initiated Data to Clock point test

In this mode, the Receiver initiates the data to clock training on all Lanes in the module at a single PI
phase. When not performing the actions relevant to this state:

· Data, Valid, and Track Transmitters drive low

· Clock Transmitters are held differential low (for differential clocking) or simultaneous low (for
Quadrature clocking)

· Data, Valid, and Clock Receivers are enabled

· Track Receiver is permitted to be disabled

The sequence of steps for this test are as follows:

1\. The UCIe Module enables the pattern comparison circuits to compare incoming mainband data to
the locally generated expected pattern, sets up the Receiver parameters (shown in Table 4-5),
sends a {Start Rx Init D to C point test req} sideband message to its UCIe Module Partner, and
then waits for a response. The data field of this message includes the required parameters, shown
in Table 4-5. Once the data to clock training parameters for its Transmitter are setup, the UCIe
Module Partner responds with a {Start Rx Init D to C point test resp} sideband message.

2\. The UCIe Module Partner resets the LFSR (scrambler) on its mainband Transmitters and sends
sideband message {LFSR clear error req}. The UCIe Module resets the LFSR and clears any prior
compare results on its mainband Receivers and responds with {LFSR clear error resp} sideband
message.

3\. The UCIe Module Partner sends the pattern (selected through "Tx Pattern Generator Setup") for
the selected number of cycles ("Tx Pattern Mode Setup") on its mainband Transmitter.

4\. The UCIe Module performs the comparison on its mainband Receivers for each UI during the
pattern transmission based on "Rx Compare Setup" and logs the results.

5\. The UCIe Module Partner sends a sideband message {Rx Init D to C Tx count done req} sideband
message once the pattern count is complete. The UCIe Module, stops comparison and responds
with the sideband message {Rx Init D to C Tx count done resp}. The UCIe Module can now use
the logged data for its Receiver Lanes.

6\. The UCIe Module sends an {End Rx Init D to C point test req} sideband message and the UCIe
Module Partner responds with an {End Rx Init D to C point test resp} sideband message. When a
UCIe Module has received the {End Rx Init D to C point test resp} sideband message, the
corresponding sequence has completed.

### 4.5.1.4 Receiver initiated Data to Clock Eye Width Sweep

In this mode, the Receiver initiates the data to clock training on all Lanes in the module at a single PI
phase. When not performing the actions relevant to this state:

· Data, Valid, and Track Transmitters drive low

· Clock Transmitters are held differential low (for differential clocking) or simultaneous low (for
Quadrature clocking)

· Data, Valid, and Clock Receivers are enabled

· Track Receiver is permitted to be disabled

The sequence of steps for this test are as follows:

1\. The UCIe Module enables the pattern comparison circuits to compare incoming mainband data to
the locally generated expected pattern, sets up the Receiver parameters (shown in Table 4-5),
sends a {Start Rx Init D to C eye sweep req} sideband message to its UCIe Module Partner, and
then waits for a response. The data field of this message includes the required parameters, shown
in Table 4-5. The Transmitter on the UCIe Module Partner must be idle. Once the data to clock
training parameters for its Transmitter are setup, the UCIe Module Partner responds with a {Start
Rx Init D to C eye sweep resp} sideband message.

2\. The UCIe Module Partner resets the LFSR (scrambler) on its mainband Transmitters and sends
sideband message {LFSR clear error req}. The UCIe Module resets the LFSR and clears any prior
compare results on its mainband Receivers and responds with an {LFSR clear error resp}
sideband message.

3\. The UCIe Module Partner sends the pattern (selected through "Tx Pattern Generator Setup") for
the selected number of cycles ("Tx Pattern Mode Setup") on its mainband Transmitter.

4\. The UCIe Module performs the comparison on its mainband Receivers for each UI during the
pattern transmission based on "Rx Compare Setup" and logs the results.

5\. The UCIe Module Partner requests the UCIe Module for the logged data to clock test results
through a {Rx Init D to C results req} sideband message. The UCIe Module responds with the
logged results for its mainband Receiver using the {Rx Init D to C results resp} sideband
message. The UCIe Module Partner can determine if the pattern comparison at the PI phase
passed or failed based on the results log.

6\. The UCIe Module Partner sweeps through the PI phases on its forwarded clock each time it
repeats Step 2 through Step 5 to find the passing PI phase range. The sweep pattern and range
are implementation specific.

7\. The UCIe Module Partner sends an {Rx Init D to C sweep done with results} sideband message
with results for its mainband Transmitter. The UCIe Module can use the sweep results for its
mainband Receivers.

8\. The UCIe Module sends an {End Rx Init D to C eye sweep req} sideband message and the UCIe
Module Partner responds with an {End Rx Init D to C eye sweep resp} sideband message. When a
UCIe Module has received the {End Rx Init D to C eye sweep resp} sideband message, the
corresponding sequence has completed.

### 4.5.2 Link Training with Retimer

The following diagram explains the initialization flow with UCIe Retimer. As shown in Figure 4-32,
external and UCIe (UCIe Die to UCIe Retimer) Links are permitted to come up independently. When a
UCIe Link trains up to local data rate and width, the remote UCIe information is requested over the
external Link. If there is a data rate and width difference, each UCIe Link is permitted to be retrained
to achieve a speed (data rate) and width match (if the UCIe Retimer requires this for operation, it
must initiate Retraining from LinkSpeed state). This can happen multiple times during initial Link
bring up or retraining. Once the UCIe Retimer has determined that the UCIe Link configuration is
suitable for successful operation with remote Retimer partner, the UCIe Link proceeds to ACTIVE
through protocol level Link initialization (LINKINIT).

<table>
<caption>Figure 4-32. Example Retimer bring up when performing speed/width match</caption>
<tr>
<th>UCle Die 0 &lt;- - &gt; UCle Retimer</th>
<th>0 External Link</th>
<th></th>
</tr>
<tr>
<td>SBInit</td>
<td rowspan="2">Ext. Link Bring up (independent)</td>
<td>SBInit</td>
</tr>
<tr>
<td rowspan="2">$M B I N I T \left( w / L o c a l \quad P a r a m \right)$</td>
<td rowspan="2">MBINIT (w/Local Param)</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>MBTRAIN (local Data rate)</td>
<td>Ext. $\mathrm { L i n k } \mathrm { U p }$</td>
<td>MBTRAIN (local Data rate)</td>
</tr>
<tr>
<td rowspan="4"></td>
<td>(Can send retimer-retimer messages)</td>
<td rowspan="4"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>Speed/width resolution</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>Speed/width match check</td>
<td>Message exchange</td>
<td>Speed/width match check</td>
</tr>
<tr>
<td>LINKINIT (protocol)</td>
<td>$\mathbb{V}$</td>
<td>LINKINIT (protocol)</td>
</tr>
<tr>
<td>Active</td>
<td></td>
<td>Active</td>
</tr>
<tr>
<td rowspan="2"></td>
<td>Functional Data</td>
<td rowspan="2"></td>
</tr>
<tr>
<td></td>
</tr>
</table>

<figure>

UCle Retimer 1 < > UCle Die 1

</figure>

### 4.5.3 Link Training State Machine

A high level initialization flow is shown in Figure 4-33. A high level description of each state is shown
in Table 4-6. The details and actions performed in each state are described in the following sections.

<table>
<caption>Table 4-6. State Definitions for Initialization</caption>
<tr>
<th>State</th>
<th>Description</th>
</tr>
<tr>
<td>RESET</td>
<td>This is the state following primary reset or exit from TRAINERROR.</td>
</tr>
<tr>
<td>SBINIT</td>
<td>Sideband initialization state where the sideband is detected, repaired (when applicable) and out of reset message is transmitted.</td>
</tr>
<tr>
<td>MBINIT</td>
<td>Following sideband initialization, Mainband (MB) is initialized at the lowest speed. applicable). Both dies perform on die calibration followed by interconnect repair (when</td>
</tr>
<tr>
<td>MBTRAIN</td>
<td>Mainband (Data, Clock and Valid signals) speed of operation is set to the highest negotiated data rate. Die-to-Die training of mainband is performed to center the clock with respect to Data.</td>
</tr>
<tr>
<td>LINKINIT</td>
<td>This state is used to exchange Adapter and Link management messages.</td>
</tr>
<tr>
<td>ACTIVE</td>
<td>This is the state in which transactions are sent and received.</td>
</tr>
<tr>
<td>L1/L2</td>
<td>Power Management state.</td>
</tr>
<tr>
<td>PHYRETRAIN</td>
<td>This state is used to begin the retrain flow for the Link during runtime.</td>
</tr>
<tr>
<td>TRAINERROR</td>
<td>$S t a t e \quad i s \quad e n t e r e d \quad w h e n$ a fatal or non-fatal event occurs at any point during Link</td>
</tr>
</table>

<figure>
<figcaption>Figure 4-33. Link Training State Machine</figcaption>

RESET

TRAINERROR

Any State
Except RESET

SBINIT

$F r o m \quad L 2$

MBINIT

$F r o m \quad L 1$

$L 1 / L 2$

MBTRAIN

LINKINIT

ACTIVE

PHYRETRAIN

</figure>

#### 4.5.3.1 RESET

Physical Layer must remain in RESET for a minimum of 4 ms upon every entry to RESET, to allow PLLs
to stabilize and any other Link Training initialization requirements to be met. The minimum conditions
necessary to exit RESET are as follows:

· Power supplies are stable

· Sideband clock is available and running at 800 MHZ

· If {

\- Physical Layer and Die to Die Adapter internal clocks are stable and available

\- Mainband clock speed is set to the slowest I/O data rate (2 GHz for 4 GT/s)

\- Local SoC/Firmware not keeping the Physical Layer in RESET

\- Link training trigger for the mainband has occurred (triggers are defined in the beginning of
Section 4.5)

} OR
{
\- Sideband Management Transport protocol is supported

\- SB_MGMT_UP = 0

\- Local SoC/Firmware is not keeping the sideband in RESET

\- Management Port Gateway indicates that it is ready for Management Transport path
initialization

\- Link Training trigger for the Management Transport path has occurred (triggers are defined in
the beginning of Section 4.5)
}

· Data, Valid, Clock, and Track Transmitters are tri-stated

· Data, Valid, Clock, and Track Receivers are permitted to be disabled

· If [Management Transport protocol is not supported] OR [SB_MGMT_UP=0], Sideband
Transmitters are held low

· Sideband Receivers are enabled

If [Management Transport protocol is supported] AND [SB_MGMT_UP=1], the Physical Layer is
available for sideband packet (any sideband packets including Management Port messages)
transmission/reception in the RESET state.

If [Management Transport protocol is not supported] OR [SB_MGMT_UP=0]:

. While the LTSM is in the RESET state, a Physical Layer implementation is permitted to handle any
new or pending untransmitted sideband register access requests as Unsupported Requests, and if
doing so, it must return a corresponding completion as well as end-to-end credit and RDI credit to
the Adapter. Similarly, for register access completions, a Physical Layer implementation is
permitted to discard any new or pending untransmitted completions and because completions do
not consume a credit, there is no credit return back to the Adapter for these. While the LTSM is in
the RESET state, an implementation may handle any new or pending untransmitted Vendor-
defined messages in an implementation dependent manner. This could include dropping the
message and logging an error.

#### 4.5.3.2 Sideband Initialization (SBINIT)

In this state, the sideband (SB) interface is initialized and repaired (when applicable).

If Management Transport is supported AND the SB_MGMT_UP flag is set to 1:

· Initialization and repair of the sideband (Step 1 through Step 9 for Advanced Package and Step 1
through Step 7 for Standard Package as shown later in this section) are skipped, and only an
SBINIT Done Req/Resp handshake is performed in this state (see Step 10 for Advanced Package
flow and Step 8 for Standard Package flow as shown later in this section); otherwise, all the steps
are traversed

· Physical Layer sideband is available for sideband packet (any sideband packets including
Management Port messages) transmission/reception in this state

When not performing the actions relevant to this state:

· Data, Valid, Clock, and Track Transmitters remain tri-stated

· Data, Valid, Clock, and Track Receivers are permitted to be disabled

· If [Management Transport protocol is not supported] OR [the SB_MGMT_UP flag is cleared to 0]
OR [a Sideband Packet is not being sent], SB Transmitters continue to be held Low

· SB Receivers continue to be enabled

The SB initialization procedure is performed at 800 MT/s with 800-MHz sideband clock.

If [Management Transport protocol is not supported] OR [SB_MGMT_UP=0]:

· While the LTSM is in the SBINIT state, a Physical Layer implementation is permitted to wait for an
implementation specific amount of time to see whether SBINIT is progressing or completing, and
subsequently handle any new or pending untransmitted sideband register access requests as
Unsupported Requests, and if treating the request as an Unsupported Request, it must return a
corresponding completion as well as end-to-end credit and RDI credit to the Adapter. Similarly, for
register access completions, a Physical Layer implementation is permitted to wait for an
implementation specific amount of time to see whether SBINIT is progressing or completing, and
subsequently discard any new or pending untransmitted completions and because completions do
not consume a credit, there is no credit return back to the Adapter for these. While the LTSM is in
the SBINIT state, an implementation may handle any new or pending untransmitted Vendor-
defined messages in an implementation dependent manner. This could include dropping the
message and logging an error.

Advanced Package has redundant SB clock and SB data Lanes (DATASBRD, CKSBRD) in addition to
DATASB and CKSB. SBINIT sequence for Advanced Package where interconnect repair may be
needed is as follows:

1\. The UCIe Module must start and continue to send iterations of a 64-UI clock pattern (a clock
pattern is defined as starting with 1 and toggling every UI of transmission, i.e., 1010 ... ) and 32-
UI low on both sideband data Transmitters (TXDATASB and TXDATASBRD). The UCIe Module must
send strobes on both TXCKSB and TXCKSBRD during the 64-UI clock pattern transmission and be
gated (held low) otherwise.

2\. UCIe Module Partner must sample each incoming data patterns on its sideband Receivers with
both incoming sideband clocks (this forms four Receiver/clock combinations).

3\. A sideband data-clock Receiver combination detection is considered successful if 128 UI clock
pattern is detected.

4\. If a UCIe Module Partner detects the pattern successfully on at least one of its sideband data-
clock Receiver combination, it must stop sending data and clock on its sideband Transmitters after
four more iterations of 64-UI clock pattern and 32-UI low. This will allow for any time differences
in both UCIe Module and UCIe Module Partner coming out of RESET state. The sideband
Transmitter and Receiver on the UCIe Module must now be enabled to send and receive sideband
messages

5\. If pattern is not detected on its sideband Receiver, the UCIe Module must continue to alternate
between sending the pattern on its sideband Transmitters for 1 ms, and holding low for 1 ms, for
a total of 8 ms. The sideband Receiver of the UCIe Module must remain enabled during this time.
Timeout occurs after 8 ms. If a timeout occurs, the UCIe Module enters TRAINERROR state.

6\. If detection is successful on more than one sideband data/clock combination, the device can pick
a combination based on a priority order. Pseudocode for sideband assignment:

<table>
<tr>
<td>CKSB sampling DATASB = Result [0] # 1:</td>
<td colspan="3">Detected; 0: Not detected</td>
</tr>
<tr>
<td>CKSBRD sampling DATASB = Result [1] #</td>
<td colspan="3">1: Detected; 0: Not detected</td>
</tr>
<tr>
<td>CKSB sampling DATASBRD = Result [2] #</td>
<td colspan="3">1: Detected; 0: Not detected</td>
</tr>
<tr>
<td>CKSBRD sampling DATASBRD = Result [3]</td>
<td colspan="3"># 1: Detected; 0: Not detected</td>
</tr>
<tr>
<td>IF (Result [3: 0] == XXX1) :</td>
<td colspan="2"></td>
<td></td>
</tr>
<tr>
<td>Sideband = (DATASB/CKSB)</td>
<td colspan="2"></td>
<td></td>
</tr>
<tr>
<td rowspan="2">ELSE IF (Result [3: 0] == XX10) : Sideband = (DATASB/CKSBRD)</td>
<td colspan="2"></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="2">ELSE IF (Result [3: 0] == X100) : Sideband = (DATASBRD/CKSB)</td>
<td colspan="2"></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ELSE IF (Result [3: 0] == 1000) :</td>
<td colspan="2"></td>
<td></td>
</tr>
<tr>
<td>Sideband = (DATASBRD/CKSBRD)</td>
<td colspan="2"></td>
<td></td>
</tr>
<tr>
<td>Else:</td>
<td colspan="2"></td>
<td></td>
</tr>
<tr>
<td>Sideband is not functional</td>
<td colspan="3"></td>
</tr>
</table>

7\. If the sideband on the UCIe Module is enabled to send and receive sideband messages (Step 4),
the UCIe Module must start and continue to send {SBINIT Out of Reset} sideband message on
both TXDATASB and TXDATASBRD while sending both TXCKSB and TXCKSBRD until it detects the
same message in its sideband Receivers or a timeout occurs at 8 ms.

8\. If {SBINIT Out of Reset} sideband message detection is successful on its sideband Receivers, the
UCIe Module stops sending the sideband message. Before sending any further sideband
messages, both UCIe Module and UCIe Module Partner must apply Sideband Data/Clock
assignment (called the functional sideband) based on the information included in the {SBINIT Out
of Reset} sideband message.

9\. Any further sideband messages must be sent and received on the functional sideband. Any
sideband message exchange can now be performed.

10\. The UCIe Module sends the {SBINIT done req} sideband message and waits for a response. If
this message is received successfully, UCIe Module Partner responds with {SBINIT done resp}
sideband message. When a UCIe Module has sent and received the {SBINIT done resp} sideband
message, the UCIe Module must exit to MBINIT. The following additional rules apply when the
transmitting/receiving chiplet supports Management Transport protocol. These additional rules
are required to initiate mainband link training for the scenario in which the Management Transport
path has already been established prior (i.e., SB_MGMT_UP flag is set to 1) and one of the
mainband link training triggers (see Section 4.5) occurred with the Link Training State Machine in
RESET state.

\- If the Module partner that is receiving the {SBINIT done req} sideband message is in RESET
state and is ready to proceed with mainband initialization, the module partner must transition
to SBINIT state, respond with an {SBINIT done resp} sideband message, and then send a
{SBINIT done req} sideband message.

\- Module partner must ignore a received {SBINIT done req} sideband message if the module
partner is EITHER [in RESET state but not yet ready to proceed with mainband initialization]
OR [in a state machine state other than RESET/SBINIT].

\- UCIe Module that is transmitting the {SBINIT done req} sideband message must transition to
RESET state (by way of TRAINERROR state) if the UCIe Module did not receive a response
within the regular 8-ms time window. In that scenario, the UCIe Module can choose to re-
issue the {SBINIT done req} sideband message after transitioning to SBINIT state again from
RESET state. The UCIe Module can repeat this process N number of times before waiting in
RESET for a new training trigger. (The value of N is implementation-dependent.) The UCIe
Module partner must collapse multiple outstanding {SBINIT done req} sideband messages
and respond only with a single {SBINIT done resp} sideband message.

The next state is mainband initialization (MBINIT) if sideband message exchange is successful.

SBINIT sequence for Standard Package where interconnect Lane redundancy and repair are not
supported is as follows:

1\. The UCIe Module must start and continue to send iterations of 64 UI clock pattern (a clock pattern
is defined as starting with 1b and toggling every UI of transmission, i.e., 1010 ... ) and 32 UI low
on its sideband Transmitter (TXDATASB). The UCIe Module must send strobe on its sideband clock
(TXCKSB) during the 64-UI clock pattern duration and gated (held low) otherwise.

2\. The UCIe Module Partner must sample incoming data pattern with incoming clock.

3\. Sideband pattern detection is considered successful if 128 UI clock pattern is detected.

4\. If the UCIe Module successfully detects the pattern, it stops sending data and clock on its
sideband Transmitters after four more iterations of pattern in Step 1. This will allow for any time
differences in both UCIe Modules coming out of RESET. The UCIe Module sideband Transmitter
and Receiver must now be enabled to send and receive sideband messages, respectively.

5\. If pattern is not detected on its sideband Receiver, the UCIe Module continues to alternate
between sending the pattern on its Transmitters for 1 ms, and holding low for 1 ms, for a total of
8 ms. The sideband Receiver must be enabled during this time. Timeout occurs after 8 ms. If a
timeout occurs, the UCIe Module must exit to TRAINERROR. If a pattern is detected successfully
at any time, as described in Step 3, the UCIe Module enables sideband message transmission as
described in Step 4 and continues to Step 6.

6\. Once sideband detection is successful (Step 5), the UCIe Module must start and continue to send
{SBINIT Out of Reset} sideband message on TXDATASB while sending TXCKSB until it detects the
same message in its sideband Receivers or a timeout occurs.

7\. If {SBINIT Out of Reset} sideband message detection is successful, the UCIe Module must stop
sending the message. Any sideband message exchange can now be performed.

8\. The UCIe Module must send the {SBINIT done req} sideband message. If this message is
received successfully, the UCIe Module Partner responds with the {SBINIT done resp} sideband
message. When the UCIe Module has sent and received the {SBINIT done resp} sideband
message, the UCIe Module must exit to MBINIT. The following additional rules apply when the
transmitting/receiving chiplet supports Management Transport protocol. These additional rules
are required to initiate mainband link training for the scenario in which the Management Transport
path has already been established prior (i.e., SB_MGMT_UP flag is set to 1) and one of the
mainband link training triggers (see Section 4.5) occurred with the Link Training State Machine in
RESET state.

\- If the Module partner that is receiving the {SBINIT done req} sideband message is in RESET
state and is ready to proceed with mainband initialization, the module partner must transition
to SBINIT state, respond with an {SBINIT done resp} sideband message, and then send a
{SBINIT done req} sideband message.

\- Module partner must ignore a received {SBINIT done req} sideband message if the module
partner is EITHER [in RESET state but not yet ready to proceed with mainband initialization]
OR [in a state machine state other than RESET/SBINIT].

\- UCIe Module that is transmitting the {SBINIT done req} sideband message must transition to
RESET state (by way of TRAINERROR state) if the UCIe Module did not receive a response
within the regular 8-ms time window. In that scenario, the UCIe Module can choose to re-
issue the {SBINIT done req} sideband message after transitioning to SBINIT state again from
RESET state. The UCIe Module can repeat this process N number of times before waiting in
RESET for a new training trigger. (The value of N is implementation-dependent.) The UCIe
Module partner must collapse multiple outstanding {SBINIT done req} sideband messages
and respond only with a single {SBINIT done resp} sideband message.

The next state is mainband initialization (MBINIT) if sideband message exchange is successful. For
the remainder of initialization and operations, when not transmitting sideband packets, sideband
Transmitters are held Low and sideband Receivers are enabled.

### 4.5.3.3 MBINIT

In this state, the mainband (MB) interface is initialized and repaired or width degraded (when
applicable). The data rate on the mainband is set to the lowest supported data rate (4 GT/s).

For Advanced Package interconnect repair may be needed. Sub-states in MBINIT allows detection
and repair of data, clock, track and valid Lanes. For Standard Package, where no Lane repair is
needed, sub-states are used to check functionality at lowest data rate and width degrade if needed.

<figure>
<figcaption>Figure 4-34. MBINIT: Mainband Initialization and Repair Flow</figcaption>

From SBINIT

PARAM

Cal

RepairCLK

RepairVAL

ReversalMB

RepairMB

To MBTRAIN

</figure>

#### 4.5.3.3.1 MBINIT.PARAM

This state is used to perform exchange of parameters that are required to set up the maximum
negotiated speed and other PHY settings. Mainband Transmitters remain tri-stated and mainband
Receivers are permitted to be disabled. The following parameters are exchanged over sideband with
UCIe Module Partner:

· "Voltage swing": The five bit value indicates the Transmitter voltage swing to the UCIe Module
Partner. The UCIe Module Partner must use this value and its Receiver termination information to
set the reference voltage (Vref) for its Receivers. The corresponding bits in the {MBINIT.PARAM
configuration resp} sideband message are reserved.

. "Maximum Data Rate": The four bit value indicates the Maximum supported Data rate to the UCIe
Module Partner. This value must take into consideration all the required features at the data rate
(BER, CRC/Retry, quadrature clock phase support etc.). The UCIe Module Partner must compare
this value with its supported maximum data rate and must respond with the maximum common
data rate encoding in the {MBINIT.PARAM configuration resp} sideband message. For example, a
UCIe Module is 8 GT/s capable while the UCIe Module Partner advertises 16 GT/s, the UCIe
Module must pick 8 GT/s and send it back in response.

. "Clock Mode": The one bit value indicates the UCIe Module's request to the UCIe Module Partner
for a strobe or continuous clock for operating speeds <= 32 GT/s. If the operating speed is

\> 32 GT/s, the Link operates with continuous clock and the "Clock Mode" parameter does not
change hardware behavior. If the negotiated maximum data rate is > 32 GT/s but the operating
speed degrades to $< = 3 2 \quad G T / s ,$ this parameter is used by the Transmitter to set up the Clock
Mode on its clock Transmitter. The {MBINIT.PARAM configuration resp} sideband message must
reflect the same value. Continuous clock mode requires the clock to be free running and is
enforced after receiving the {MBTRAIN.RXCLKCAL start req} sideband message from the UCIe
Module Partner. The clock remains free running through the remainder of MBTRAIN (unless
MBTRAIN.LINKSPEED is exited due to errors) and in ACTIVE.

##### IMPLEMENTATION NOTE

Note that the free-running clock (if requested) is enforced from the
MBTRAIN.RXCLKCAL state. The states of MBINIT as well as the states of MBTRAIN
before RXCLKCAL operate in Strobe mode to check Clock and Valid Lanes in a
structured manner. It is permitted for implementations to set an implementation-
specific higher error threshold in these states in case the receiver implementation will
miss sampling around the edges of the transmitted pattern because of a lack of the
free-running clock.

. "Clock Phase": The one bit value indicates the UCIe Module's request to UCIe Module Partner for
the Clock Phase support on UCIe Module's forwarded clock for operating speeds of 24 GT/s and
32 GT/s. This should only be set to 1 if the operation at 24 GT/s or 32 GT/s is supported and the
receiver requires quarter-rate clocking for these data rates (see Table 5-12). If the operating
speed is < 24 GT/s or > 32 GT/s, this parameter does not change hardware behavior. If the
negotiated maximum data rate is > 32 GT/s but the operating speed degrades to 24 GT/s or 32
GT/s, this parameter is used by the Transmitter to set up the Clock Phase. The corresponding bit
in the {MBINIT.PARAM configuration resp} sideband message must be set to 1 if this was
requested and the operational data rate allows it.

. "Module ID": The UCIe Module sends its "Module ID". This can be used by the UCIe Module
Partner if in a multi-module configuration for Byte mapping, Module enable/disable information
etc. The corresponding bits in the {MBINIT.PARAM configuration resp} sideband message are
reserved.

· "UCIe-A x32": This bit is set to 1b when APMW bit in DVSEC UCIe Link Capability register (see
Section 9.5.1.4) is set to 1b (OR) 'Force x32 width mode in x64 Module' in the PHY Control
register (see Section 9.5.3.23) is set; otherwise, the bit is set to 0b. If a x64 Advanced Package
module supports width reduction to interoperate with a x32 Advanced Package Module, it uses
this information from its link partner to condition the results during MBINIT.REVERSALMB. The
corresponding bits in the {MBINIT.PARAM configuration resp} sideband message are reserved.

· "UCIe-S x8": This bit is set to 1 in message {MBINIT.PARAM configuration req} when bit 20,
SPMW, in the DVSEC UCIe Link Capability register (see Section 9.5.1.4) is set to 1 (OR) 'Force x8
Width' bit is set to 1 in the PHY Control register (see Section 9.5.3.23). Otherwise, this bit is set
to 0. See Section 4.5.3.3.6 for how this bit is used. The corresponding bit in the {MBINIT.PARAM
configuration resp} sideband message is reserved.

. "Sideband Feature Extensions": This bit is set to 1 if the transmitter supports sideband feature
extensions (see Section 4.5.3.3.1.1).

· "Tx Adjustment during Runtime Recalibration (TARR)": This bit is set to 1 in the {MBINIT.PARAM
configuration req} sideband message if the UCIe Module supports TARR capability and TARR
capability has been enabled in the corresponding bit in the PHY Control register (see
Section 9.5.3.23). See Section 4.6 for details about the TARR flow. If the sent and received
{MBINIT.PARAM configuration req} sideband messages have this bit set to 1, then the
corresponding bit must be set to 1 in the {MBINIT.PARAM configuration resp} sideband message.

Following is the sequence for parameter exchange:

1\. The UCIe Module sends the {MBINIT.PARAM configuration req} sideband message to exchange
parameters with the UCIe Module Partner.

2\. After the {MBINIT.PARAM configuration req} sideband message is received, the UCIe Module
Partner resolves and responds with the {MBINIT.PARAM configuration resp} sideband message.

3\. After the UCIe Module has sent and received the {MBINIT.PARAM configuration resp} sideband
message, the UCIe Module must exit to MBINIT.CAL.

It is strongly recommended that if interoperable parameters are not negotiated, then hardware maps
this scenario to an Internal Error in the Error Log 1 register and transition the LTSM to TRAINERROR,
RDI to LINKERROR, and assert pl_trainerror on RDI. For a multi-module Link, all the parameters
except "Module ID" must be the same for all the modules, and if this is not the case, it is strongly
recommended that hardware maps this scenario to the same error escalation path.

When management transport is supported, the additional conditions required for the Link training
state machine to exit MBINIT.PARAM state to MBINIT.CAL are:

· Management Transport was not negotiated.

. (OR) Management Transport was negotiated and it was either initialized successfully or an error
was detected during initialization.

· (OR) SB_MGMT_UP flag is already set on entry into MBINIT state

AND

There is no MBINIT Stall condition (see Section 4.5.3.3.1.2)

AND

Port is ready to train mainband.

### 4.5.3.3.1.1 Management Transport Path Negotiation

Management Transport protocol over the sideband is optional and chiplets use the mechanism
described in this section to negotiate support for it. A sample negotiation flow is shown in Figure 4-35
for a single module design. Sideband Feature Extensions Supported (SFES) is bit 14 in the
{MBINIT.PARAM configuration req} sideband message (see Table 7-11). Note that MBINIT.PARAM
state handshake relating to management path negotiation described in this section, is performed on
all transitions through the MBINIT state. If SB_MGMT_UP flag is set (see Section 8.2.3.1.2 for when
this happens) at entry into MBINIT state, management transport traffic continues without interruption
in the MBINIT.PARAM state.

<figure>
<figcaption>Figure 4-35. Example Sideband Management Transport Protocol Negotiation - Single-module Scenario</figcaption>

MBINIT.PARAM Configuration Req[ 14]=1

MBINIT.PARAM Configuration Req[ 14]=1

MBINIT.PARAM Configuration Resp[14]=1

Chiplet 0

MBINIT.PARAM SBFE Req[0]=1

$\frac { 9 } { 8 }$ 1

MBINIT.PARAM SBFE Resp[0]=1

MBINIT.PARAM Configuration Resp[14]=1

MBINIT.PARAM SBFE Req[0]=1

MBINIT.PARAM SBFE Resp[0]=1

Negotiation Phase Complete
(i.e., Chiplet 0 can start
Initialization Phase)

Negotiation Phase Complete
(i.e., Chiplet 1 can start
Initialization Phase)

</figure>

<figure>
<figcaption>Figure 4-36. Example Sideband Management Transport Protocol Negotiation - Two-module Scenarioª</figcaption>

-Chiplet 0

-Chiplet

MBINIT.PARAM Configuration Req[14]=1

-MBINIT.PARAM Configuration Req[ 14]=1

MBINIT.PARAM Configuration Req[ 14]=1

-MBINIT.PARAM Configuration Req[ 14]=1-

-MBINIT.PARAM Configuration Resp[14]=1

MBINIT.PARAM Configuration Resp[14]=1

MBINIT.PARAM Configuration Resp[14]=1-

MBINIT.PARAM SBFE Req[0]=1

-MBINIT.PARAM SBFE Req[0]=1
MBINIT.PARAM SBFE Resp[U]=>

MBINIT.PARAM Configuration Resp[14]=1

-MBINIT. PARAM SBFE Resp[0]=1
MBINIT.PARAM SBFE Req[0]=1
MBINIT.PARAM SBFE Req[0]=1

-MBINIT.PARAM SBFE Resp[0]=1-
MBINIT.PARAM SBFE Resp[0]=1

Negotiation Phase Complete
i.e., Chiplet 0 can start
Initialization Phase

Negotiation Phase Complete
i.e., Chiplet 1 can start
Initialization Phase

</figure>

a. Solid lines are for Module 0. Dashed lines are for Module 1.

. Unless otherwise specified, a chiplet can optionally check for violation of any Negotiation Phase
rules (discussed in the subsequent bullets), and when a violation is detected, the chiplet initiates
a TRAINERROR handshake (see Section 4.5.3.8) to return the LTSM to RESET state.

· Sideband Feature Extensions Supported (SFES) bit in the {MBINIT.PARAM configuration req}
sideband message (see Table 7-11, it is bit [14] in the message) is defined to indicate support for
extended sideband features (of which Management Transport is one), during MBINIT.PARAM state
of link training.

\- 0 => Sideband Feature Extensions are not supported, 1 => Sideband Feature Extensions are
supported.

\- All modules in a multi-module design must have the same value for this bit in the Req
message.

\- After the SB_MGMT_UP flag is set, the value of this bit must remain the same on all
subsequent transitions through the MBINIT.PARAM state, until that flag is cleared.

. If the Remote link partner supports sideband feature extensions and it received the SFES bit set
to 1 in the {MBINIT.PARAM configuration req} sideband message, the Remote link partner will set
SFES bit in the {MBINIT.PARAM configuration resp} sideband message that it sends out;
otherwise, the bit is cleared to 0 in the resp message.

\- All modules in a multi-module design must have the same value for this bit in the resp
message.

. If the SFES bit in the {MBINIT.PARAM configuration resp} sideband message is received as set to
1 across all modules, then the chiplet negotiates the next level of details of extended sideband
features supported with remote link partner. If the SFES bit in the {MBINIT.PARAM configuration
resp} sideband message is received as cleared to 0 in any module, then MBINIT.PARAM state is
exited to MBINIT.CAL.

\- {MBINIT.PARAM SBFE req} sideband message (see Table 7-11) is sent to the remote link
partner on all modules which then sends back an {MBINIT.PARAM SBFE resp} sideband
message on all modules. This handshake happens independently in each direction.

o SBFE Req[0]/Resp[0] (also referred to as the MTP bit) indicates support for transmission/
reception of Management Port Messages. Remote link partner must set the MTP bit in the
{MBINIT.PARAM SBFE resp} sideband message if it was set in the {MBINIT.PARAM SBFE
req} sideband message, and it supports receiving Management Encapsulation messages.

o After the SB_MGMT_UP flag is set to 1, the value of this bit must remain the same on all
subsequent transitions through the MBINIT.PARAM state, until that flag is cleared to 0.

· When negotiating SFES in {MBINIT.PARAM configuration req/resp}, if a chiplet advertised SFES
support in the Req message, the chiplet must also advertise that support in the Resp message
provided the associated Req message had that capability advertised. If the chiplet did not
advertise SFES support in the Req message, then the chiplet must not advertise that support in
the Resp message.

· For a multi-module UCIe Link, the negotiation is performed independently per module.

\- A Physical Layer implementation may advertise MTP bit in the SBFE Req message only on a
subset of the modules.

Note:
A message sent on a given Module ID could be received on a different Module ID on the
partner sideband Receiver. Hence all sideband links in a multi-module design must be
capable of receiving MPMs even if they are limited to only supporting transmit of these
messages on a subset of sideband links. See Figure 4-37 and Figure 4-38 for examples
of multi-module transmit/receive scenarios that illustrate this point.

. After the {MBINIT.PARAM SBFE resp} sideband message has been transmitted to the remote link
partner and {MBINIT.PARAM SBFE resp} sideband message has been received from the remote

link partner are complete (successfully or unsuccessfully) during MBINIT.PARAM across all
modules, the PHY informs the Management Port Gateway of the following:

\- Negotiated link count with management transport support on the transmit side, using the
pm_param_local_count [N-1 : 0] signals (see Section 10.1 for more details) at the end of
the negotiation phase. This is the value RxQ-Local. A link is considered to have negotiated
management transport support on the transmit side if the link transmitted the
{MBINIT.PARAM SBFE req} sideband message with the MTP bit set to 1 and received the
corresponding {MBINIT.PARAM SBFE resp} sideband message with its MTP bit also set to 1.

\- Negotiated link count with management transport support on the receive side, using the
pm_param_remote_count [N-1 : 0] signals (see Section 10.1 for more details). This is the
value RxQ-Remote. A link is considered to have negotiated management transport support on
the receive side if the link received the {MBINIT.PARAM SBFE req} sideband message with the
MTP bit set to 1 and transmitted the corresponding {MBINIT.PARAM SBFE resp} sideband
message with its MTP bit also set to 1.

· A module must be able to receive initialization phase-related messages (see Section 8.2.3.1.2)
once it has transmitted {MBINIT.PARAM SBFE resp}.

· Negotiation phase ends when {MBINIT.PARAM SBFE resp} has been sent and received across all
modules.

. While in SBINIT state, if the SB_MGMT_UP flag transitioned from 1 to 0, the chiplet must move
the LTSM to TRAINERROR state -> RESET state.

. While in MBINIT state, if the SB_MGMT_UP flag transitioned from 1 to 0, the chiplet must perform
a TRAINERROR handshake and move the LTSM to TRAINERROR state -> RESET state.

<figure>
<figcaption>Figure 4-37. Example Sideband MPM Logical Flow with Two Modules and No Module Reversal</figcaption>

Management
Port Gateway

PHY

PHY

Management
Port Gateway

Tx for far-
end RxQ-
ID=0

RxQ-ID=0

Module 0

SB

Module 0

RxQ-ID=

Tx for far-
end Rx Q-
ID=0

Tx for far-
end RxQ-
ID=1

RxQ-ID=1

Module 1

SB

Module 1

RxQ-ID=1

Tx for far-
end Rx Q-
ID=1

Chiplet 0

Chiplet 1

</figure>

<figure>
<figcaption>Figure 4-38. Example Sideband MPM Logical Flow with Two Modules and Module Reversal</figcaption>

Management
Port Gateway

PHY

PHY

Management
Port Gateway

Tx for far-
end RxQ-
ID=0

RxQ-ID=1

Module 0

SB

Module 1

$R \times Q - I D = 0$

Tx for far-
end Rx Q-
ID=1

Tx for far-
end RxQ-
ID=1

$R \times Q - I D = 0$

Module 1

SB

Module 0

$8 \times 0 - 1 0 =$

Tx for far-
end Rx Q-
ID=0

Chiplet 0

Chiplet 1

</figure>

### 4.5.3.3.1.2 MBINIT Stall Capability

To support firmware download and other functionality that might have to be configured before the
mainband link can start training, a capability is provided to "pause" the MBINIT state machine after
the PARAM sub-state has completed.

This is an optional capability that is enabled only when both chiplets have indicated support for
Sideband Feature Extensions as described in Section 4.5.3.3.1.1.

To "pause" link training after MBINIT.PARAM, either side can send a "Stall" encoding of FFFFh in the
MsgInfo field of the {MBINIT.PARAM SBFE resp} sideband message. For example, if a chiplet needs to
download firmware by way of the partner port before the chiplet can bring up the mainband, the
partner port can respond with "stall" encoding as stated above. Stall encoding instructs the other side
to pause and not move beyond the MBINIT.PARAM state. The payload in the {MBINIT.PARAM SBFE
resp} sideband message with stall encoding is still valid and must be accurate to the responder's
capabilities. An {MBINIT.PARAM SBFE resp} sideband message with "Stall" encoded must be sent
once every 4 ms until the sender determines that it no longer needs to stall, at which time the sender
either sends the {MBINIT.PARAM SBFE resp} message without the stall encoding (in which case the
state machine advances to MBINIT.CAL state if other conditions allow (see Section 8.2.3.1.2)), OR the
sender does not send an {MBINIT.PARAM SBFE resp} sideband message, the link times out, and the
link transitions from TRAINERROR state to RESET state and starts over again.

It is legal for one side to indicate a stall and the other side to not indicate a stall. In that case, both
sides are stalled. It is also valid for either side to explicitly request an entry to TRAINERROR state
while in MBINIT.PARAM state. This can occur if either side is not yet ready to train the mainband.

See Section 4.5.3.3.1.3 for details of what happens at the end of MBINIT.PARAM when either end is a
sideband-only port.

Support for receiving an {MBINIT.PARAM SBFE resp} sideband message with "stall" encoding is
required in all ports that advertise the SFES bit set to 1 in the {MBINIT.PARAM configuration req}
sideband message. Support for transmitting the {MBINIT.PARAM SBFE resp} sideband message with
"stall" encoding is implementation-dependent. For example, if a design needs to support the firmware

download feature, the design can support this capability if the design cannot complete firmware
download within 8 ms.

Figure 4-39 shows a scenario in which the link training state machine initially moves through
RESET -> SBINIT -> MBINIT.PARAM with "stall" -> TRAINERROR -> RESET. During this phase, a
chiplet "stalls" in MBINIT.PARAM for additional Init time, such as for downloading chiplet firmware.
When the chiplet Init is complete, the chiplet either initiates entry to TRAINERROR state with a
TRAINERROR handshake message, OR the chiplet can stop sending the {MBINIT.PARAM SBFE resp}
sideband message with "stall" encoding, which would eventually trigger entry to TRAINERROR state
initiated by the partner chiplet. In the second phase, the state machine moves through to SBINIT ->
MBINIT.PARAM without "stall" -> MBINIT.CAL, thus training the mainband. This flow is useful for
scenarios in which a chiplet potentially needs to change the advertised parameters for Link training
after chiplet Init. Note that the transition to TRAINERROR in this case does not escalate to RDI
transitioning to LinkError (or pl_trainerror assertion on RDI).

<figure>
<figcaption>Figure 4-39. MBINIT "Stall" Example 1</figcaption>

Sideband Management path setup occurs first, followed by mainband training but
with an entry to RESET in between.

"Stall" in MBINIT.PARAM is used to gain additional time for chiplet initialization
during the first entry to MBINIT.PARAM.

RESET

TRAIN ERROR

Phase
1

Phase
2

SBINIT

Phase
1

Management Transport path on the
sideband is negotiated/initialized,
chiplet "stalls" in MBINIT. PARAM
for additional "Init" time

MBINIT.PARAM
(MBINIT.Stall
mechanism used
for additional Init
time in Phase 1)

Phase
2

Mainband is trained

MBINIT. CAL

</figure>

Figure 4-40 shows a scenario in which the link training state machine initially moves through
RESET -> SBINIT -> MBINIT.PARAM with "stall". The chiplet "stalls" in MBINIT.PARAM for additional
Init time. After the chiplet Init is complete, the chiplet sends an {MBINIT.PARAM SBFE resp} sideband
message without a "stall" encoding that triggers state machine entry to MBINIT.CAL. Mainband
training resumes from that point.

<figure>
<figcaption>Figure 4-40. MBINIT "Stall" Example 2</figcaption>

Sideband Management path setup occurs first, followed by mainband training
without re-entering RESET state.

"Stall" in MBINIT.PARAM is used to gain additional time for chiplet initialization
before training the mainband.

RESET

TRAIN ERROR

Phase
1

SBINIT

Phase
1

Management Transport path on the
sideband is negotiated/initialized,
chiplet "stalls" in MBINIT.PARAM
for additional "Init" time

MBINIT.PARAM
(MBINIT. Stall
mechanism used
for additional Init
time in Phase 1)

Phase
2

Mainband is trained

Phase
2

MBINIT. CAL

</figure>

### 4.5.3.3.1.3 UCIe-S Sideband Only (SO) Port

A UCIe-S Sideband-only port will advertise the SFES bit in an {MBINIT.PARAM configuration req}
sideband message. If that negotiation is successful, the port advertises bit 2 (SO bit) in an
{MBINIT.PARAM SBFE req} sideband message to indicate that the port is a "Sideband-only port". If
the port receives an {MBINIT.PARAM SBFE resp} sideband message with the SO bit set to 1, training
pauses on both sides at the exit of the MBINIT.PARAM phase until the next Management Reset or a
transition to the TRAINERROR state is triggered (see Section 4.5.3.8). State residency timeout is
disabled in MBINIT.PARAM. If the remote link partner did not set the SO bit in the {MBINIT.PARAM
SBFE resp} sideband message, the link goes to the TRAINERROR state. This is an SiP integration error
and is fatal. All links that support management transport over sideband (i.e., those links that set bit 0
as 1 in the {MBINIT.PARAM SBFE req} sideband message that they transmit) must set the SO bit to 1
in the {MBINIT.PARAM SBFE resp} sideband message that they transmit, provided that the
corresponding bit was set to 1 in the {MBINIT.PARAM SBFE req} sideband message that they
received.

In multi-sideband-only Link configuration (this refers to a multi-module configuration with sideband-
only modules; see Section 8.2.1), the chiplet must advertise the same value for the SO bit in the
{MBINIT.PARAM SBFE req} or {MBINIT.PARAM SBFE resp} sideband message across all links.
Receivers can optionally check for violation of this rule and then trigger a transition to the
TRAINERROR state if the transmitter violates this rule.

### 4.5.3.3.2 MBINIT.CAL

This state is used to perform any calibration needed (e.g., Tx Duty Cycle correction, Receiver offset
and Vref calibration). This state is common for both Advanced Package and Standard Package.

1\. The UCIe Module maintains tri-state on all its mainband Transmitters, and mainband Receivers
are permitted to be disabled in this state. The UCIe Module is permitted to perform
implementation specific steps for Transmitter and Receiver calibration.

2\. The UCIe Module must send the {MBINIT.CAL Done req} sideband message, and then wait for a
response. If this message is received successfully, the UCIe Module Partner responds with the
{MBINIT.CAL Done resp} sideband message. Once the UCIe Module has sent and received
{MBINIT.CAL Done resp}, it must exit to MBINIT.REPAIRCLK.

### 4.5.3.3.3 MBINIT.REPAIRCLK

This sub-state is used to detect and apply repair (if needed) to clock and track Lanes for Advanced
Package and for functional check of clock and track Lanes for Standard Package.

Following is the sequence for Advanced Package:

Clock repair mapping is described in Section 4.3. Each clock, track and their redundant physical Lanes
(TCKP_P/RCKP_P, TCKN_P/RCKN_P, TTRK_P/RTRK_P, and TRDCK_P/RRDCK_P) are independently
checked to detect possible electrical opens or electrical shorts between the two clock pins. Single-
ended clock Receivers or independent detection mechanism is required to ensure clock repair. The
UCIe Module must enable Transmitters and Receivers on Clock, Track and their redundant Lanes. All
other Transmitters are maintained in tri-state and Receivers are permitted to be disabled.

1\. The UCIe Module sends the {MBINIT.REPAIRCLK init req} sideband message and waits for a
response. The UCIe Module Partner when ready to receive pattern on RCKP_L, RCKN_L, RTRK_L,
and RRDCK_L responds with {MBINIT.REPAIRCLK init resp}.

2\. The UCIe Module must now send 128 iterations of clock repair pattern (16 clock cycles followed
by 8 cycles of low) on its TCKP_L only (TCKN_L, TTRK_L, and TRDCK_L are tri-stated). Clock
repair pattern must not be scrambled.

3\. The UCIe Module Partner detects this pattern on RCKP_L, RCKN_L, RTRK_L, and RRDCK_L.
Detection is considered successful if at least 16 consecutive iterations of clock repair pattern are
detected. The UCIe Module Partner logs the detection result for RCKP_L, RCKN_L, RTRK_L, and
RRDCK L.
_

4\. The UCIe Module after completing pattern transmission sends {MBINIT.REPAIRCLK result req}
sideband message to get the logged result and waits for a response.

5\. The UCIe Module Partner responds with {MBINIT.REPAIRCLK result resp} sideband message with
log result of RCKP_L, RCKN_L, RTRK_L, and RRDCK_L. If detection is successful on RCKP_L only
and not on any of RCKN_L, RTRK, and/or RRDCK_L, no repair is needed. Else if detection is
unsuccessful on any of RCKP_L, RCKN_L, RTRK_L, and RRDCK_L, repair is needed on the physical
Lane TCKP_P/RCKP_P. Else an electrical short is implied.

6\. After receiving the {MBINIT.REPAIRCLK result resp} sideband message, the UCIe Module sends
the sideband message {MBINIT.REPAIRCLK init req} and waits for a response. The UCIe Module
Partner when ready to receive pattern on RCKP_L, RCKN_L, RTRK_L, RRDCK_L responds with
{MBINIT.REPAIRCLK init resp}.

7\. After receiving the {MBINIT.REPAIRCLK init resp} sideband message, the UCIe Module must send
128 iterations of clock repair pattern (16 clock cycles followed by 8 cycles of low) on its TCKN_L
only. (TCKP_L, TTRK_L, and TRDCK_L are tri-stated)

8\. The UCIe Module Partner detects this pattern on all RCKP_L, RCKN_L, RTRK_L, and RRDCK_L.
Detection is considered successful if at least 16 consecutive cycles of clock repair pattern are
detected. The UCIe Module Partner logs the detection result for RCKP_L, RCKN_L, RTRK_L, and
RRDCK L.
_

9\. The UCIe Module after completing the pattern transmission, sends {MBINIT.REPAIRCLK result
req} sideband message to get the logged result.

10\. The UCIe Module Partner on receiving it responds with {MBINIT.REPAIRCLK result resp} sideband
message with logged result of RCKP_L, RCKN_L, RTRK_L, and RRDCK_L. If detection is successful
on RCKN_L and not on RCKP_L, RTRK_L, RRDCK_L, no repair is needed. Else if detection is
unsuccessful on any of RCKP_L, RCKN_L, RTRK_L, and RRDCK_L, repair is needed on the physical
Lane TCKN_P/RCKN_P. Else an electrical short is implied.

11\. After receiving the {MBINIT.REPAIRCLK result resp} sideband message, the UCIe Module sends
the sideband message {MBINIT.REPAIRCLK init req}. The UCIe Module Partner when ready to
receive pattern on RCKP_L, RCKN_L, RTRK_L, RRDCK_L responds with {MBINIT.REPAIRCLK init
resp}.

12\. After receiving the {MBINIT.REPAIRCLK init resp} sideband message, the UCIe Module sends 128
iterations of clock repair pattern (16 clock cycles followed by 8 cycles of low) on TRDCK_L only.
(TCKP_L, TTRK_L, and TCKN_L tri-stated)

13\. The UCIe Module Partner detects this pattern on all RCKP_L, RCKN_L, RTRK_L, and RRDCK_L.
Detection is considered successful if at least 16 consecutive cycles of clock repair pattern are
detected. The UCIe Module Partner logs the detection result for RCKP_L, RCKN_L, RTRK_L, and
RRDCK L.
_

14\. The UCIe Module device after completing the pattern transmission sends {MBINIT.REPAIRCLK
result req} sideband message to get the logged result.

15\. The UCIe Module Partner responds with {MBINIT.REPAIRCLK result resp} sideband message with
logged result of RCKP_L, RCKN_L, RTRK_L, and RRDCK_L. If detection is successful only on
RRDCK_L and not on RCKP_L, RTRK_L, RCKN_L, TRDCK_P/RRDCK_P is available as a repair
resource. Else if detection is unsuccessful on any of RCKP_L, RCKN_L, RTRK_L, and RRDCK_L,
the physical Lane TRDCK_P/RRDCK_P is not available as a repair resource. Else an electrical short
is implied.

16\. After receiving the {MBINIT.REPAIRCLK result resp} sideband message, the UCIe Module sends
the sideband message {MBINIT.REPAIRCLK init req} and waits for a response. The UCIe Module
Partner when ready to receive pattern on RCKP_L, RCKN_L, RTRK_L, RRDCK_L responds with
{MBINIT.REPAIRCLK init resp}.

17\. After receiving the {MBINIT.REPAIRCLK init resp} sideband message, the UCIe Module sends 128
iterations of clock repair pattern (16 clock cycles followed by 8 cycles of low) on TTRK_L only.
(TCKP_L, TCKN_L, and TRDCK_L are tri-stated).

18\. The UCIe Module Partner detects this pattern on all RCKP_L, RCKN_L, RTRK_L, and RRDCK_L.
Detection is considered successful if at least 16 consecutive cycles of clock repair pattern are
detected. The UCIe Module Partner logs the detection result for RCKP_L, RCKN_L, RTRK_L, and
RRDCK L.

19\. The UCIe Module after completing pattern transmission sends {MBINIT.REPAIRCLK result req}
sideband message to get the logged result and waits for a response.

20\. The UCIe Module Partner stops comparison and responds with {MBINIT.REPAIRCLK result resp}
sideband message with logged result of RCKP_L, RCKN_L, RTRK_L, and RRDCK_L. If detection is
successful only on RTRK_L and not on RCKP_L, RCKN_L, RRDCK_L, no repair is needed. Else if
detection is unsuccessful on any of RCKP_L, RCKN_L, RTRK_L, and RRDCK_L, repair is needed on
the physical Lane TTRK_P/RTRK_P. Else an electrical short is implied.

21\. Clock or Track is unrepairable if any of the following are true:

\- If repair is needed on any two of RCKP_L, RCKN_L, and RTRK_L

\- Electrical short is detected

\- RRDCK_L is unavailable for repair when repair is needed

If the clock or track is unrepairable, the UCIe Module and UCIe Module Partner must exit to
TRAINERROR after performing TRAINERROR handshake (see Section 4.5.3.8).

If repair is required on only one of the clock or track lanes and a repair resource is available, then
the UCIe Module applies repair on its clock/track Transmitter and sends the {MBINIT.REPAIRCLK
apply repair req} sideband message with repair information. If a repair is needed for one of the
clock or track pins (CKP, CKN, or TRK) and a repair resource is available, repair is applied as
described in Section 4.3. The UCIe Module Partner applies repair and sends {MBINIT.REPAIRCLK
apply repair resp} sideband message.

22\. If a repair is applied, UCIe Module must check the repair success by applying clock repair pattern
and checking on the Receiver.

a. The UCIe Module sends sideband message {MBINIT.REPAIRCLK check repair init req} to
initiate check repair and waits for a response. The UCIe Module Partner responds with sideband
message {MBINIT.REPAIRCLK check repair init resp} and is ready to receive and check clock
repair pattern.

b. After receiving the {MBINIT.REPAIRCLK check repair init resp} sideband message, the UCIe
Module sends 128 iterations of clock repair pattern (16 clock cycles followed by 8 cycles of low)
on TCKP_L. The UCIe Module Partner detects this pattern RCKN_L, RCKP_L, RTRK_L.
Detection is considered successful if at least 16 consecutive cycles of clock repair pattern are
detected. The UCIe Module requests for check result request using the sideband message

{MBINIT.REPAIRCLK check results req} and the UCIe Module Partner responds with the
sideband message {MBINIT.REPAIRCLK check results resp}. Repair is considered successful if
pattern is detected only on RCKP_L. If repair is unsuccessful, the UCIe Module and UCIe
Module Partner must exit to TRAINERROR after performing TRAINERROR handshake (see
Section 4.5.3.8).

c. Step a and Step b are repeated for TCKN_L and TTRK_L.

23\. If repair is successful or repair is not required, the UCIe Module sends {MBINIT.REPAIRCLK done
req} sideband message and the UCIe Module Partner responds with {MBINIT.REPAIRCLK done
resp} sideband message. When the UCIe Module has sent and received {MBINIT.REPAIRCLK done
resp}, it must exit to REPAIRVAL.

For Standard Package, clock and track Lanes are checked for functional operation at the lowest data
rate. The sequence is as follows:

1\. The UCIe Module sends the sideband message {MBINIT.REPAIRCLK init req} and waits for a
response. When ready to receive pattern on RCKP_L, RCKN_L, and RTRK_L, the UCIe Module
Partner responds with {MBINIT.REPAIRCLK init resp}. On receiving the sideband message
{MBINIT.REPAIRCLK init resp}, the UCIe Module sends 128 iterations of clock repair pattern
(16 clock cycles followed by 8 cycles of low) on TCKP_L, TCKN_L, and TTRK_L. Clock repair
pattern must not be scrambled.

2\. The UCIe Module Partner detects this pattern on RCKP_L, RCKN_L, and RTRK_L. Detection is
considered successful if at least 16 consecutive cycles of clock repair pattern are detected. The
UCIe Module Partner logs the detection result for RCKP_L, RCKN_L, and RTRK_L.

3\. After completing pattern transmission, the UCIe Module sends {MBINIT.REPAIRCLK result req}
sideband message to get the logged result.

4\. The UCIe Module Partner stops comparison and responds with {MBINIT.REPAIRCLK result resp}
sideband message with logged result of RCKP_L, RCKN_L, and RTRK_L.

5\. If detection is unsuccessful on any one of RCKP_L, RCKN_L, and RTRK_L, the UCIe Module and
UCIe Module Partner must exit to TRAINERROR after performing TRAINERROR handshake.

6\. If detection is successful, the UCIe Module sends {MBINIT.REPAIRCLK done req} sideband
message and the UCIe Module Partner responds with {MBINIT.REPAIRCLK done resp} sideband
message. When the UCIe Module has sent and received the sideband message
{MBINIT.REPAIRCLK done resp}, it must exit to MBINIT.REPAIRVAL.

### 4.5.3.3.4 MBINIT.REPAIRVAL

The UCIe Module sets the clock phase at the center of the data UI. The UCIe Module Partner must
sample the received Valid with the received forwarded Clock. All Data Lanes must be held low during
this state. Track and Data Receivers are permitted to be disabled. When not performing the actions
relevant to this state:

· Clock Transmitters are held differential low (for differential clocking) or simultaneous low (for
Quadrature clocking)

. Clock Receivers are enabled

· When not transmitting the VALTRAIN pattern, the transmitters for TVLD_L and TRDVLD_L are
disabled (tri-stated)

. The receivers for RVLD L and RRDVLD L are enabled

This state can be used to detect and apply repair (if needed) to Valid Lane for Advanced Package
and for functional check of Valid for Standard Package.

Following is the sequence for Advanced Package:

1\. The UCIe Module sends the sideband message {MBINIT.REPAIRVAL init req} and waits for a
response. When ready to receive pattern on RVLD_L and RRDVLD_L, the UCIe Module Partner
clears any previous comparison results and responds with {MBINIT.REPAIRVAL init resp}.

2\. The UCIe Module on receiving {MBINIT.REPAIRVAL init resp} must send 128 iterations of
VALTRAIN pattern (four 1's followed by four 0's) on TVLD_L along with the forwarded clock.
VALTRAIN pattern must not be scrambled.

3\. The UCIe Module Partner detects pattern on RVLD_L and RRDVLD_L. Detection is considered
successful if at least 16 consecutive iterations of VALTRAIN pattern are detected. The Receiver
logs the detection result for RVLD_L and RRDVLD_L.

4\. After completing the pattern transmission, the UCIe Module must send {MBINIT.REPAIRVAL result
req} sideband message and wait to get the logged result.

5\. The UCIe Module Partner must respond with {MBINIT.REPAIRVAL result resp} sideband message
with result in the previous step. If detection is successful on RVLD_L only and not on RRDVLD_L,
no repair is needed. If detection is successful on both RVLD_L and RRDVLD_L or only on
RRDVLD_L, the interconnect cannot be repaired. If detection is unsuccessful on both RVLD_L and
RRDVLD_L, Valid Lane (TVLD_P/RVLD_P) needs repair.

6\. After receiving {MBINIT.REPAIRVAL result resp}, Step 1 must be repeated.

7\. The UCIe Module sends 128 iterations of VALTRAIN repair pattern (four 1's followed by four 0's)
on TRDVLD_L along with the forwarded clock. VALTRAIN pattern must not be scrambled.

8\. The UCIe Module Partner detects pattern on RVLD_L and RRDVLD_L. Detection is considered
successful if at least 16 consecutive iterations of VALTRAIN pattern are detected. The Receiver
logs the detection result for RVLD_L and RRDVLD_L.

9\. After completing the pattern transmission, the UCIe Module must send {MBINIT.REPAIRVAL result
req} sideband message to get the logged result.

10\. The UCIe Module Partner must stop comparison and respond with {MBINIT.REPAIRVAL result
resp} sideband message with result from the previous step. If detection is successful on
RRDVLD_L only and not on RVLD_L, TRDVLD_P/RRDVLD_P is available for repair. If detection is
successful on both RVLD_L and RRDVLD_L or only on RVLD_L, the interconnect cannot be
repaired. If detection is unsuccessful on both RVLD_L and RRDVLD_L, TRDVLD_P/RRDVLD_P is
not available and cannot be used for Valid Lane repair.

11\. If repair is required on (TVLD_P/RVLD_P) and repair resource is available, the UCIe Module
applies repair on its Valid Transmitter (see Section 4.3.7) and sends sideband message
{MBINIT.REPAIRVAL apply repair req} with repair information. The UCIe Module Partner, after
receiving the message, must apply repair on its Valid Receiver and must respond with sideband
message {MBINIT.REPAIRVAL apply repair resp}.

12\. If a repair is applied, device must check the repair success by repeating Step 1 through Step 4.

13\. If repair is successful or repair is not required, the UCIe Module must send {MBINIT.REPAIRVAL
done req} sideband message and the UCIe Module Partner must respond with
{MBINIT.REPAIRVAL done resp}. When a UCIe Module has sent and received {MBINIT.REPAIRVAL
done resp} sideband message, it must exit to REVERSALMB. Else if repair is unsuccessful or Valid
Lane is unrepairable (in Step 11), the UCIe Module must exit to TRAINERROR after completing
the TRAINERROR handshake.

For Standard Package, Valid Lane is checked for functional operation at the lowest data rate.
Following is the flow:

1\. The UCIe Module must send the sideband message {MBINIT.REPAIRVAL init req} and wait for
a response. The UCIe Module Partner when ready to receive pattern on RVLD_L, must respond
with {MBINIT.REPAIRVAL init resp}.

2\. After receiving the sideband message {MBINIT.REPAIRVAL init resp}, the UCIe Module sends
128 iterations of VALTRAIN pattern (four 1's followed by four 0's) on TVLD_L along with the
forwarded clock.

3\. The UCIe Module Partner detects this pattern on RVLD_L. Detection is considered successful
if at least 16 consecutive iterations of valid repair pattern are detected. The Receiver logs the
detection result for RVLD_L.

4\. After completing pattern transmission, the UCIe Module must send {MBINIT.REPAIRVAL result
req} sideband message and wait to get the logged result.

5\. The UCIe Module Partner must stop comparison and respond with {MBINIT.REPAIRVAL result
resp} sideband message with result in the previous step.

6\. If detection fails, the UCIe Module must exit to TRAINERROR after completing the TRAINERROR
handshake.

7\. If detection is successful, the UCIe Module must send {MBINIT.REPAIRVAL done req} sideband
message and the UCIe Module Partner responds with {MBINIT.REPAIRVAL done resp}. When a
UCIe Module has sent and received {MBINIT.REPAIRVAL done resp} sideband message, it must
exit to REVERSALMB.

### 4.5.3.3.5 MBINIT.REVERSALMB

This state is entered only if Clock and Valid Lanes are functional. In this state, Data Lane reversal is
detected. All the Transmitters and Receivers are enabled. The UCIe Module sets the forwarded clock
phase at the center of the data UI. The UCIe Module Partner must sample the incoming Data with the
incoming forwarded clock. The Track Transmitter is held low and the Track Receiver is permitted to be
disabled. When not performing the actions relevant to this state:

· Clock Transmitters are held differential low (for differential clocking) or simultaneous low (for
Quadrature clocking)

· Clock Receivers are enabled

· Data and Valid Transmitters are held low

· Data and Valid Receivers are enabled

A 16-bit "Per Lane ID" pattern, shown in Table 4-7, is a Lane-specific pattern using the Lane ID
described in Section 4.2.1. Example of "Per Lane ID" pattern for Lane 1 and Lane 31 are shown in
Table 4-8. When "Per Lane ID" pattern is used, it must not be scrambled.

<table>
<caption>Table 4-7. Per Lane ID Pattern</caption>
<tr>
<td>Pattern</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td></td>
<td></td>
<td colspan="5">Lane IDª</td>
<td></td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>Bit</td>
<td>0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>123456789</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
<td>14</td>
<td>15</td>
</tr>
</table>

a. Note that bit 0 of Lane ID maps to bit 4 in the Per Lane ID pattern, bit 1 to bit 5 and so on until bit 7 to bit 11.

<table>
<caption>Table 4-8. Per Lane ID Pattern Examples</caption>
<tr>
<td>Lane 1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>Lane 31</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1111110000</td>
<td></td>
<td></td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>Bit</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
<td>14</td>
<td>15</td>
</tr>
</table>

Following is the Reversal MB sequence for Advanced Package and Standard Package:

1\. The UCIe Module must send the {MBINIT.REVERSALMB init req} sideband message. When ready
to receive "Per Lane ID" pattern and perform per-Lane pattern comparison, the UCIe Module
Partner must respond with {MBINIT.REVERSALMB init resp}.

2\. On Receiving the {MBINIT.REVERSALMB init resp} sideband message or entering from Step 8, the
UCIe Module must send {MBINIT.REVERSALMB clear error req} sideband message. Upon
receiving this message, the UCIe Module Partner clears any prior errors and responds with
{MBINIT.REVERSALMB clear error resp}. After receiving {MBINIT.REVERSALMB clear error resp},
the UCIe Module sends 128 iterations of Per Lane ID pattern (see Table 4-7) on all N data Lanes
with correct Valid framing on the Valid Lane (see Section 5.11 and Section 4.1.2) along with the
clock. Table 4-7 and Table 4-8 show examples of the Per Lane ID pattern. N is 68 (64
$\left. D a t a + 4 \quad R D \right) f o r$ a x64 Advanced Package. N is 34 (32 Data + 2 RD) for a x32 Advanced Package.
N is 16 for a x16 Standard Package. N is 8 for a x8 Standard Package.

3\. The UCIe Module Partner must perform a per-Lane compare on its Receivers on all N Lanes (see
Section 4.4). Detection on a Lane is considered successful if at least 16 consecutive iterations of
"Per Lane ID" pattern are detected. The UCIe Module Partner logs the detection result for its
Receiver Lanes to be used for Lane reversal Detection.

4\. After sending 128 iterations of "Per Lane ID" pattern, the UCIe Module stops sending the pattern
and sends {MBINIT.REVERSALMB result req} sideband message to get the logged result.

5\. The UCIe Module Partner stops comparison and must respond with {MBINIT.REVERSALMB result
resp} sideband message with per Lane result (see Table 7-11 for the message format).

6\. If majority of the Lanes show success (since some Lanes may need repair), Lane reversal is not
needed. Skip to Step 11. Note that if exactly 50% of the Lanes showed success, Lane reversal is
applied.

7\. The UCIe Module applies Lane reversal on its Transmitters (see Section 4.2).

8\. Following the Lane reversal application on its Transmitters, the UCIe Module repeats Step 2
through Step 5.

9\. If majority of Lanes show success, the Lane reversal is needed. Lane reversal preserved for rest
of the device operation. Skip to Step 11.

10\. The UCIe Module must exit to TRAINERROR after completing the TRAINERROR handshake.

11\. The UCIe Module must send {MBINIT.REVERSALMB done req} sideband message and the UCIe
Module Partner responds with {MBINIT.REVERSALMB done resp}. When the UCIe Module has sent
and received {MBINIT.REVERSALMB done resp} sideband message, it must exit to REPAIRMB.

If a x64 Advanced Package Module that supports interoperation with a x32 Advanced Package module
had received "UCIe-A x32" as 1b during parameter exchanges, it must recognize that it is connected
to a x32 Advanced Package Module and appropriately interpret the received {MBINIT.REVERSALMB
result resp} sideband message. In this scenario, the x64 applies steps 6 through 9 to lower 32 data
lane set and 2 repair lane set. The x64 module applies Lane reversal (if required) within the lower 32
data lane set and 2 repair lane set.

If a x32 Advanced Package Module had received "UCIe-A x32" as Ob during parameter exchanges, it
must recognize that it is connected to a x64 Advanced Package Module and appropriately interpret the

received {MBINIT.REVERSALMB result resp} sideband message, looking for majority of success in the
lower 32 data lane set and 2 repair lane set of the x64 module (the x64 module will always place the
results of its receiver on the lower half of its data/repair lane set).

If a x16 Standard Package Module that supports interoperation with a x8 Standard Package Module
had its SPMW bit set to 1b OR has transmitted or received "UCIe-S x8" as 1b during parameter
exchanges, the x16 Standard Package Module must recognize that it needs to operate in x8 mode and
appropriately interpret the received {MBINIT.REVERSALMB result resp} sideband message. In this
scenario, the x16 Standard Package Module applies Step 6 through Step 9 to the lower-8 data-lane
set. Additionally, the x16 Standard Package Module applies Lane reversal (if required) within the
lower-8 data-lane set.

When a x8 Standard Package Module receives the {MBINIT.REVERSALMB result resp} sideband
message, the module must look for majority of success in the bits that correspond to the lower-8
data-lane set only.

### 4.5.3.3.6 MBINIT.REPAIRMB

This state is entered only after Lane reversal detection and application is successful. All the
Transmitters and Receivers on a UCIe Module are enabled. The UCIe Module sets the clock phase at
the center of the data UI on its mainband Transmitter for data Lanes (including the redundant Lanes
for Advanced Package). The UCIe Module Partner must sample the incoming Data with the incoming
forwarded clock on its mainband Receivers for data Lanes (including the redundant Lanes for
Advanced Package). The Track Transmitter is held low and the Track Receiver is permitted to be
disabled. When not performing the actions relevant to this state:

· Clock Transmitters are held differential low (for differential clocking) or simultaneous low (for
Quadrature clocking)

· Clock Receivers are enabled

· Data and Valid Transmitters are held low

· Data and Valid Receivers are enabled

In this state, the mainband Lanes are detected and repaired (if needed) for Advanced Package. In
this state, functional checks and width degrade (if needed) are performed for Standard Package.

Following is the sequence for Advanced Package:

1\. The UCIe Module must send the {MBINIT.REPAIRMB start req} sideband message and waits for a
response. The UCIe Module Partner responds with {MBINIT.REPAIRMB start resp}.

2\. The UCIe Module device performs Transmitter-initiated Data-to-Clock point test as described in
Section 4.5.1.1 on its Transmitter Lanes (all the data Lanes including the redundant Lanes). The
Receiver must check for the pass/fail criteria on the data Lanes and the redundant Lanes.

a. The transmit pattern must be set up to send 128 iterations of continuous mode "Per Lane ID"
Pattern. "Per Lane ID" pattern must not be scrambled. The Receiver must be set up to perform
per Lane comparison.

b. Detection on a Receiver Lane is considered successful if at least 16 consecutive iterations of
"Per Lane ID" pattern are detected.

c. LFSR Reset has no impact in MBINIT.REPAIRMB.

3\. The UCIe Module receives the per-Lane pass/fail information over sideband message at the end
of Transmitter initiated data to clock point test Step 2.

4\. If Lane repair is required and the necessary repair resources are available, the UCIe Module
applies repair on its mainband Transmitters for data Lanes as described in Section 4.3.1, and
sends {MBINIT.REPAIRMB Apply repair req} sideband message. Upon receiving this sideband
message, the UCIe Module Partner applies repair on its mainband Receivers for data Lanes as
described in Section 4.3.1, and sends {MBINIT.REPAIRMB Apply repair resp} sideband message.
Otherwise, if the number of Lane failures are more than repair capability (see Section 4.3), the
mainband is unrepairable and the UCIe Module must exit to TRAINERROR after performing the
TRAINERROR handshake.

5\. If repair is not required, perform Step 7.

6\. If Lane repair is applied (Step 4), the applied repair is checked by UCIe Module by repeating
Step 2 and Step 3. If post repair Lane errors are logged in Step 5, the UCIe Module must exit to
TRAINERROR after performing the TRAINERROR handshake. If repair is successful, perform
Step 7.

7\. The UCIe Module sends {MBINIT.REPAIRMB end req} sideband message and the UCIe Module
Partner responds with {MBINIT.REPAIRMB end resp}. When UCIe Module has sent and received
{MBINIT.REPAIRMB end resp}, it must exit to MBTRAIN.

For Standard Package, mainband is checked for functional operation at the lowest data rate.
Following is the sequence of steps:

1\. The UCIe Module sends the {MBINIT.REPAIRMB start req} sideband message and waits for a
response. The UCIe Module Partner responds with the {MBINIT.REPAIRMB start resp} sideband
message when ready to receive the pattern on its mainband Receivers for data Lanes.

2\. The UCIe Module performs Transmitter-initiated Data-to-Clock point test as described in
Section 4.5.

a. The transmit pattern must be set up to send 128 iterations of continuous mode "Per Lane ID"
Pattern. The Receiver must be set up to perform per Lane comparison.

b. Detection on a Receiver Lane is considered successful if at least 16 consecutive iterations of
"Per Lane ID" pattern are detected.

c. LFSR Reset has no impact in MBINIT.REPAIRMB.

3\. The UCIe Module must send the {MBINIT.REPAIRMB apply degrade req} sideband message
indicating the functional Lanes on its Transmitter using one of the logical Lane map encodings
from Table 4-9. Encodings 100b and 101b can be used only when the SPMW bit is set to 1 or the
UCIe-S x8 bit was set to 1 in the transmitted or received {MBINIT.PARAM configuration req}
sideband message. If the remote Link partner indicated a width degrade in the functional Lanes,
the UCIe Module must apply the corresponding width degrade to its Receiver. If the remote Link
partner indicated all Lanes are functional (i.e. a Lane map code of 011b), the UCIe Module sets its
Transmitter and Receiver to the width corresponding to the functional Lane encoding determined
on its Transmitter. The UCIe Module sends the {MBINIT.REPAIRMB apply degrade resp} sideband
message after setting its Transmitter and Receiver lanes to the relevant width. If the width on the
Transmitter or Receiver has changed, both Link partners must repeat Step 2. If the width on the
Transmitter or Receiver has not changed, proceed to Step 4. If a "Degrade not possible" encoding
is sent or received in the {MBINIT.REPAIRMB apply degrade req} sideband message, the UCIe
Module must exit to TRAINERROR after performing the TRAINERROR handshake.

4\. The UCIe Module sends the {MBINIT.REPAIRMB end req} sideband message and the UCIe Module
Partner responds with the {MBINIT.REPAIRMB end resp} sideband message. When the UCIe
Module has sent and received the {MBINIT.REPAIRMB end resp} sideband message, it must exit
to MBTRAIN.

<table>
<caption>Table 4-9. Standard Package Logical Lane Map</caption>
<tr>
<th>Lane Map Code</th>
<th>Functional Lanes</th>
</tr>
<tr>
<td>000b</td>
<td>None (Degrade not possible)</td>
</tr>
<tr>
<td>001b</td>
<td>Logical $\mathrm { L a n e s } 0$ to 7</td>
</tr>
<tr>
<td>010b</td>
<td>Logical Lanes 8 to 15</td>
</tr>
<tr>
<td>011b</td>
<td>0 - 15</td>
</tr>
<tr>
<td>100b</td>
<td>Logical Lanes 0 to 3</td>
</tr>
<tr>
<td>$1 0 1 b$</td>
<td>Logical Lanes 4 to 7</td>
</tr>
</table>

### IMPLEMENTATION NOTE

Consider an example in which Die A is communicating with Die B over a Standard
Package UCIe Link.

During the first iteration of Step 2 of MBINIT.REPAIRMB, let's say that Tx on Die A
detects errors on Lane ID 1 and not on any other Lanes, but Tx on Die B detects
errors on Lane ID 10 and not on any other Lanes. Thus, as per the rules in Step 3, Die
A sends {MBINIT.REPAIRMB apply degrade req} with a Lane map code of 010b.
Similarly, in Step 3, Die B sends {MBINIT.REPAIRMB apply degrade req} with a Lane
map code of 001b. The Rx on Die B disables Lanes 0 to 7, and the Tx on Die B tri-
states Lanes 8 to 15. The Rx on Die A disables Lanes 8 to 15, and the Tx on Die A tri-
states Lanes 0 to 7. Following the rules in Step 3, each die goes back and repeats
Step 2.

In this second iteration of Step 2, both Die know that some of the Lanes are disabled,
and they will ignore the information related to the disabled Lanes in {Tx Init D to C
results resp} (e.g., Die A will ignore the information related to Lanes 0 to 7 and
perform only the Transmitter-initiated Data to Clock point test on Lanes 8 to 15).

Let's say that in the second iteration of Step 2, no errors are reported on the enabled
Lanes. In Step 3, Die A sends {MBINIT.REPAIRMB apply degrade req} with a Lane
map code of 010b. Similarly, in Step 3, Die B sends {MBINIT.REPAIRMB apply
degrade req} with a Lane map code of 001b. Because the width of the Tx and Rx
have not changed, both Die proceed to Step 4.

### 4.5.3.4 MBTRAIN

MBTRAIN state is used to setup operational speed and perform clock to data centering. At higher
speeds, additional calibrations like Rx clock correction, Tx and Rx deskew may be needed to ensure
Link performance. MBTRAIN uses sub-states to perform all the required calibration and training. UCIe
Modules must enter each sub-state and the exit from each sub-state is coordinated between UCIe
Module Partners through sideband handshakes. If a particular action within a sub-state is not needed,
the UCIe Module is permitted to exit the sub-state through the relevant sideband handshake without
performing the described operations in that sub-state.

Devices enter this state once the MBINIT is completed. This state is common for Advanced and
Standard Packages.

<figure>
<figcaption>Figure 4-41. Mainband Training</figcaption>

From MBINIT

VALVREF

VALTRAIN
$\mathrm { C E N T E R }$

DATAVREF

VALTRAIN
VREF

$F r o m \quad L 1$

SPEED
IDLE

DATATRAIN
CENTER1

From PHYRETRAIN

TXSELFCAL

DATATRAIN
VREF

REPAIR

RXCLKCAL

RXDESKEW

DATATRAIN
CENTER2

LINKSPEED

To PHYRETRAIN

To LINKINIT

</figure>

#### 4.5.3.4.1 MBTRAIN.VALVREF

Receiver reference voltage (Vref) to sample the incoming Valid is optimized in this state. The data
rate on the mainband continues to be at the lowest supported data rate (4 GT/s). The UCIe Module
Partner must set the forwarded clock phase at the center of the data UI on its mainband Transmitters.
The UCIe Module must sample the pattern on Valid signal with the forwarded clock. All data Lanes and
Track must be held low during Valid Lane reference voltage training. Track Receivers are permitted to
be disabled. When not performing the actions relevant to this state:

· Clock Transmitters are held differential low (for differential clocking) or simultaneous low (for
Quadrature clocking)

· Clock Receivers are enabled

The sequence for Valid Receiver reference voltage adjustment is as follows:

1\. The UCIe Module must send the {MBTRAIN. VALVREF start req} sideband message and wait for a
response. When {MBTRAIN.VALVREF start req} sideband message is received, the UCIe Module
Partner responds with {MBTRAIN. VALVREF start resp}.

2\. UCIe Module optimizes Vref on its Valid Receiver by adjusting Receiver reference voltage and
performing one or more Receiver-initiated Data-to-Clock point tests (see Section 4.5.1.3) (AND/
OR) one or more Receiver-initiated Data-to-Clock eye width sweeps (see Section 4.5.1.4).

a. The transmit pattern must be set to send 128 iterations of continuous mode "VALTRAIN" (four
1s and four 0s) pattern (see Table 4-5). This pattern must not be scrambled. The Receiver must
be set up to perform comparison on the Valid Lane.

b. Detection on a Receiver Lane is considered successful if "VALTRAIN" pattern detection errors
are less than the set threshold (per Lane comparison threshold in Section 9.5.3.29).

c. It should be noted that LFSR RESET has no impact in MBTRAIN. VALVREF.

3\. The UCIe Module must send {MBTRAIN. VALVREF end req} sideband message after the Vref
optimization (One way to perform Vref Optimization is to step through Vref and perform Step 2 at
each setting). When {MBTRAIN. VALVREF end req} is received, the UCIe Module Partner must
respond with {MBTRAIN. VALVREF end resp}. When the UCIe Module has sent and received the
sideband message {MBTRAIN. VALVREF end resp}, it must exit to MBTRAIN.DATAVREF.

### 4.5.3.4.2 MBTRAIN.DATAVREF

Receiver reference voltage (Vref) to sample the incoming data is optimized in this state. The data rate
on the UCIe Module mainband continues to be at the lowest supported data rate (4 GT/s). The
Transmitter sets the forwarded clock phase at the center of the data UI. The Track Transmitter is held
low and the Track Receiver is permitted to be disabled. When not performing the actions relevant to
this state:

· Clock Transmitters are held differential low (for differential clocking) or simultaneous low (for
Quadrature clocking)

· Clock Receivers are enabled

· Data and Valid Transmitters are held low

· Data and Valid Receivers are enabled

The sequence for data Receiver reference voltage adjustment is as follows:

1\. The UCIe Module sends the sideband message {MBTRAIN.DATAVREF start req}. When
{MBTRAIN.DATAVREF start req} sideband message is received, the UCIe Module Partner responds
with {MBTRAIN.DATAVREF start resp}.

2\. The UCIe Module optimizes data Vref by adjusting data Receiver reference voltage and
performing one or more Receiver-initiated Data-to-Clock point tests (see Section 4.5.1.3) (AND/
OR) one or more Receiver-initiated Data-to-Clock eye width sweeps (see Section 4.5.1.4).

a. The Transmitter must be set up to send 4K UI of continuous mode LFSR pattern described in
Section 4.4.1. The LFSR pattern on Data must be accompanied by correct Valid framing on the
Valid Lane as described in Section 4.1.2. The Receiver must be set up to perform per Lane
comparison.

b. Detection on a Receiver Lane is considered successful if total error count is less than the set
error threshold (see Section 9.5.3.29).

3\. The UCIe Module must send {MBTRAIN.DATAVREF end req} sideband message after the Vref
optimization (One way to perform Vref Optimization is to step through Vref and perform step 2 at
each setting). When {MBTRAIN.DATAVREF end req} is received, the UCIe Module Partner must
respond with {MBTRAIN.DATAVREF end resp}. Once the UCIe Module has sent and received the
sideband message {MBTRAIN.DATAVREF end resp}, it must exit to MBTRAIN.SPEEDIDLE.

### 4.5.3.4.3 MBTRAIN.SPEEDIDLE

This is an electrical idle state to allow frequency change. Clock Transmitters are held differential low
(for differential clocking) or simultaneous low (for Quadrature clocking). Clock Receivers are enabled.
Data, Valid, and Track Transmitters are held low.

The following rules apply:

1\. The data rate is determined as follows:

\- If this state is entered from MBTRAIN.DATAVREF, the UCIe Module transitions to a data rate
based on the highest common speed between the two devices (see Section 4.5.3.3.1).

\- Else if this state is entered from L1, the operating speed in the last ACTIVE state before
entering L1 must be restored.

\- Else if this state is entered from LINKSPEED or PHYRETRAIN (speed degrade), and the current
speed is not 4 GT/s, the next-lower data rate must be picked.

\- Else the UCIe Module must exit to TRAINERROR after performing the TRAINERROR
handshake.

2\. The width of the Link is set to the width previously determined at the exit of MBINIT.REPAIRMB or
MBTRAIN.REPAIR (whichever was the most-recent state relative to entry into SPEEDIDLE).

3\. Upon completing the transition to the required data rate, the UCIe Module must send
{MBTRAIN.SPEEDIDLE done req} sideband message. When {MBTRAIN.SPEEDIDLE done req}
sideband message is received, UCIe Module Partner responds with {MBTRAIN.SPEEDIDLE done
resp}. Once the UCIe Module has sent and received the {MBTRAIN.SPEEDIDLE done resp}
sideband message, it must exit to MBTRAIN.TXSELFCAL.

### 4.5.3.4.4 MBTRAIN.TXSELFCAL

The UCIe Module calibrates its circuit parameters independent of the UCIe Module Partner. Data,
Clock, Valid, and Track Transmitters are tri-stated. Data, Clock, Valid, and Track Receivers are
permitted to be disabled.

1\. UCIe Module is permitted to perform implementation specific Transmitter-related calibration.

2\. Upon completion of calibration, the UCIe Module must send the {MBTRAIN.TXSELFCAL Done req}
sideband message. When {MBTRAIN.TXSELFCAL Done req} sideband message is received, the
UCIe Module Partner must respond with {MBTRAIN.TXSELFCAL Done resp}. When the UCIe
Module has sent and received the {MBTRAIN.TXSELFCAL Done resp} sideband message, it must
exit to MBTRAIN. RXCLKCAL.

### 4.5.3.4.5 MBTRAIN.RXCLKCAL

In this state, Data, Valid Transmitters are held low (Data and Valid Receivers are permitted to be
disabled). When not performing the actions relevant to this state, if the operating speed is
<= 32 GT/s AND Strobe mode was advertised by the UCIe Module Partner, the Clock Transmitters are
held differential low (for differential clocking) or simultaneous low (for Quadrature clocking). When
not performing the actions relevant to this state, if the operating speed is > 32 GT/s OR continuous
clock mode was advertised by the UCIe Module Partner and the {MBTRAIN. RXCLKCAL start req}
sideband message has been received, then the Clock Transmitters are providing the free-running
forwarded clock.

1\. The UCIe Module, when ready to perform calibration on its Clock receive path, sends the
{MBTRAIN.RXCLKCAL start req} sideband message. When the {MBTRAIN.RXCLKCAL start req}
sideband message is received, the UCIe Module Partner starts sending the forwarded clock and
Track. Subsequently, the UCIe Module Partner sends the {MBTRAIN.RXCLKCAL start resp}
sideband message. The Transmitter clock must be free running and all Data Lanes and Valid must

be held low. If the operating speed is > 32 GT/s, the offset of TCKN_L relative to TCKP_L is set to
an implementation-specific default when entering this state for the first time since RESET state
exit or a speed degrade; otherwise, it is set to the value for the current speed from the last exit
from MBTRAIN.RXCLKCAL. The UCIe Module is permitted to use the forwarded clock to perform
any clock path-related and Clock-to-Track-related calibration. The UCIe Module Partner must not
adjust any circuit or PI phase parameters on its Transmitters within this state. If the operating
speed is $< = 3 2 \quad G T / s ,$ then proceed to Step 3.

2\. In this step, Rx of the UCIe Module is permitted to perform any required in-phase/quadrature (IQ)
correction on the received quarter rate clock by using the following sequence:

a. The UCIe Module Rx stops observing the incoming clock and track patterns, and subsequently
sends the {MBTRAIN.RXCLKCAL TCKN_L shift req} sideband message to request the UCIe
Module Partner to shift TCKN_L relative to TCKP_L. The parameters in this sideband message
contain a 5-bit "Shift Value" field that indicates the value of the shift from the current setting
with a step size of $1 / 6 4$ UI, as well as a 1-bit "Decrement" field that indicates that the request
is for an increment if it is cleared to 0, or for a decrement if it is set to 1. Here, "increment"
refers to shifting TCKN_L to be later in the phase relative to TCKP_L, and "decrement" refers
to shifting TCKN_L to be earlier in the phase relative to TCKP_L.

b. The UCIe Module Partner must apply the requested adjustment if it is within range of the
hardware implementation (see Section 5.5) and subsequently respond with
{MBTRAIN.RXCLKCAL TCKN_L shift resp} with a status that indicates the "Success" encoding.
If the requested adjustment is out of range of the hardware implementation, the UCIe Module
Partner does not apply the requested adjustment and responds with {MBTRAIN.RXCLKCAL
TCKN_L shift resp} with a status that indicates the "Out of Range" encoding.

c. The UCIe Module starts observing the incoming clock and track patterns only after the UCIe
Module has received a "Success" encoding on the {MBTRAIN.RXCLKCAL TCKN_L shift resp}
sideband message to check for acceptable in-phase/quadrature (I/Q) conditions and perform
any clock path-related calibration.

d. The UCIe Module returns to Step 2a if the UCIe Module needs to repeat this sequence for a
different setting; otherwise, the UCIe Module proceeds to Step 3.

3\. When the required calibration (if any) is performed, the UCIe Module sends {MBTRAIN.RXCLKCAL
done req} sideband message. When {MBTRAIN.RXCLKCAL done req} is received, the UCIe
Module Partner stops sending forwarded clock and responds by sending {MBTRAIN.RXCLKCAL
done resp} sideband message. When a UCIe Module has sent and received {MBTRAIN.RXCLKCAL
done resp} sideband message, it must exit to MBTRAIN. VALTRAINCENTER. If the operating speed
is > 32 GT/s, the Tx preserves the applied I/Q correction setting throughout the remainder of Link
training and operation until either the Link goes down or the Tx receives an {MBTRAIN.RXCLKCAL
TCKN_L shift req} sideband message.

### 4.5.3.4.6 MBTRAIN.VALTRAINCENTER

To ensure the valid signal is functional, valid to clock training is performed before the data Lane
training. The Receiver samples the pattern on Valid with the forwarded clock. Receiver reference
voltage is set to the optimized value achieved through Vref training (see Section 4.5.3.4.1 and
Section 4.5.3.4.2). All data and Track Transmitters are held low during valid to clock training. When
not performing the actions relevant to this state, if the operating speed is <= 32 GT/s AND Strobe
mode was advertised by the UCIe Module Partner, then the Clock Transmitters are held differential low
(for differential clocking) or simultaneous low (for Quadrature clocking). When not performing the
actions relevant to this state, if the operating speed is > 32 GT/s OR continuous clock mode was
advertised by the UCIe Module Partner, then the Clock Transmitters are providing the free-running
forwarded clock.

Following is the MBTRAIN. VALTRAINCENTER sequence:

1\. The UCIe Module sends a sideband message {MBTRAIN. VALTRAINCENTER start req}. The UCIe
Module Partner responds with {MBTRAIN. VALTRAINCENTER start resp}.

2\. The UCIe Module must perform one or more Transmitter-initiated Data-to-Clock eye width sweeps
(see Section 4.5.1.2) (AND/OR) one or more Transmitter-initiated Data-to-Clock point tests (see
Section 4.5.1.1) to determine the correct Valid to clock centering.

a. The transmit pattern must be set to send 128 iterations of continuous mode "VALTRAIN" (four
1s and four 0s) pattern (see Table 4-5). This pattern must not be scrambled. The Receiver must
be set up to perform comparison on the Valid Lane.

b. Detection on a Receiver Lane is considered successful if "VALTRAIN" pattern detection errors
are less than set threshold (per Lane comparison threshold in Section 9.5.3.29).

c. It should be noted that LFSR RESET has no impact in MBTRAIN. VALVREF.

3\. The UCIe Module can use the received results log to assess valid functionality and margins.
Following this, step 4 must be performed.

4\. The UCIe Module must send {MBTRAIN. VALTRAINCENTER done req} sideband message.
When {MBTRAIN. VALTRAINCENTER done req} is received the UCIe Module Partner responds
with {MBTRAIN. VALTRAINCENTER done resp}. Once the UCIe Module has sent and received
{MBTRAIN. VALTRAINCENTER done resp} sideband message, the UCIe Module must exit to
MBTRAIN. VALTRAINVREF.

### 4.5.3.4.7 MBTRAIN.VALTRAINVREF

The UCIe Module is permitted to optionally optimize the reference voltage (Vref) to sample the
incoming Valid at the operating data rate. All Data and Track Transmitters are held low during Valid-
to-Clock training. When not performing the actions relevant to this state, if the operating speed is
<= 32 GT/s AND Strobe mode was advertised by the UCIe Module Partner, then the Clock
Transmitters are held differential low (for differential clocking) or simultaneous low (for Quadrature
clocking). When not performing the actions relevant to this state, if the operating speed is > 32 GT/s
OR continuous clock mode was advertised by the UCIe Module Partner, then the Clock Transmitters
are providing the free-running forwarded clock.

The sequence for Valid Receiver reference voltage adjustment is as follows:

1\. The UCIe Module must send the sideband message {MBTRAIN. VALTRAINVREF start req}. When
{MBTRAIN.VALTRAINVREF start req} sideband message is received, the UCIe Module Partner
responds with {MBTRAIN. VALTRAINVREF start resp}.

2\. UCIe Module optionally optimizes Vref by adjusting Receiver reference voltage on its Valid
Receiver and performing one or more Receiver-initiated Data-to-Clock eye width sweeps (see
Section 4.5.1.4) (AND/OR) one or more Receiver-initiated Data-to-Clock point tests (see
Section 4.5.1.3). Step 2 is optional and implementation-specific.

a. If Valid centering is performed, the transmit pattern must be set to send 128 iterations of
continuous mode "VALTRAIN" (four 1s and four Os) pattern (see Table 4-5). This pattern must
not be scrambled. The Receiver must be set up to perform comparison on the Valid Lane.

b. Detection on a Receiver Lane is considered successful if "VALTRAIN" pattern detection errors
are less than set threshold (per Lane comparison threshold in Section 9.5.3.29).

c. It should be noted that LFSR RESET has no impact in MBTRAIN. VALVREF.

3\. The UCIe Module must send {MBTRAIN. VALTRAINVREF end req} sideband message after the Vref
optimization is complete. When {MBTRAIN. VALTRAINVREF end req} is received, the UCIe Module
Partner must respond with {MBTRAIN. VALTRAINVREF end resp}. Once the UCIe Module has sent
and received the sideband message {MBTRAIN. VALTRAINVREF end resp}, it must exit to
MBTRAIN.DATATRAINCENTER1.

### 4.5.3.4.8 MBTRAIN.DATATRAINCENTER1

In this state, the UCIe Module performs Data-to-Clock training (including valid). LFSR patterns
described in Section 4.4.1 must be used in this state. The Track Transmitter is held Low. When not
performing the actions relevant to this state:

· Clock Receivers are enabled

· Data and Valid Transmitters are held low

· Data and Valid Receivers are enabled

. If the operating speed is <= 32 GT/s AND Strobe mode was advertised by the UCIe Module
Partner, then the Clock Transmitters are held differential low (for differential clocking) or
simultaneous low (for Quadrature clocking)

. If the operating speed is > 32 GT/s OR continuous clock mode was advertised by the UCIe Module
Partner, then the Clock Transmitters are providing the free-running forwarded clock

. If the operating speed is > 32 GT/s, the UCIe Module sets the TX EQ presets to an
implementation-specific default when entering this state for the first time since RESET exit or a
speed degrade; otherwise, the TX EQ presets are set to the value for the current speed from the
last exit from MBTRAIN.RXDESKEW.

Following is the MBTRAIN.DATATRAINCENTER1 sequence:

1\. The UCIe Module sends the {MBTRAIN.DATATRAINCENTER1 start req} sideband message. When
{MBTRAIN.DATATRAINCENTER1 start req} sideband message is received, the UCIe Module
Partner responds with {MBTRAIN.DATATRAINCENTER1 start resp}.

2\. The UCIe Module must perform one or more Transmitter-initiated Data-to-Clock eye width sweeps
(see Section 4.5.1.2) (AND/OR) one or more Transmitter-initiated Data-to-Clock point tests (see
Section 4.5.1.1) to determine the correct data to clock centering and adjust Transmitter per-bit
deskew (if needed).

a. The Transmitter must be set up to send 4K UI of continuous mode LFSR pattern described in
Section 4.4.1. The LFSR pattern on data must be accompanied by correct valid framing on the
Valid Lane as described in Section 4.1.2. The Receiver must be set up to perform per Lane
comparison.

b. Detection on a Receiver Lane is considered successful if total error count is less than the set
error threshold (see Section 9.5.3.29).

3\. If the test is a success, the UCIe Module must set the clock phase to sample the data eye
at the optimal point to maximize eye margins. The UCIe Module must send
{MBTRAIN.DATATRAINCENTER1 end req} sideband message. When
{MBTRAIN.DATATRAINCENTER1 end req} sideband message is received, the UCIe Module Partner
responds with {MBTRAIN.DATATRAINCENTER1 end resp}. Once the UCIe Module has sent and
received the {MBTRAIN.DATATRAINCENTER1 end resp} sideband message, it must exit to
MBTRAIN.DATATRAINVREF.

### 4.5.3.4.9 MBTRAIN.DATATRAINVREF

UCIe Module is permitted to optionally optimize the reference voltage (Vref) on its data Receivers to
optimize sampling of the incoming Data at the operating data rate. The Track Transmitter is held Low.
When not performing the actions relevant to this state:

. Clock Receivers are enabled

· Data and Valid Transmitters are held low

· Data and Valid Receivers are enabled

. If the operating speed is <= 32 GT/s AND Strobe mode was advertised by the UCIe Module
Partner, then the Clock Transmitters are held differential low (for differential clocking) or
simultaneous low (for Quadrature clocking)

. If the operating speed is > 32 GT/s OR continuous clock mode was advertised by the UCIe Module
Partner, then the Clock Transmitters are providing the free-running forwarded clock

The sequence for data Receiver reference voltage adjustment is as follows:

1\. The UCIe Module must send the sideband message {MBTRAIN.DATATRAINVREF start req}. When
{MBTRAIN.DATATRAINVREF start req} sideband message is received, the UCIe Module Partner
responds with {MBTRAIN.DATATRAINVREF start resp}.

2\. UCIe Module optionally optimizes Vref by adjusting Receiver reference voltage and performing
one or more Receiver-initiated Data-to-Clock eye width sweeps (see Section 4.5.1.4) (AND/OR)
one or more Receiver-initiated Data-to-Clock point tests (see Section 4.5.1.3). Step 2 is optional
and implementation specific. If Data Vref optimization is performed:

a. The Transmitter must be set up to send 4K UI of continuous mode LFSR pattern described in
Section 4.4.1. The LFSR pattern on data must be accompanied by correct valid framing on the
Valid Lane as described in Section 4.1.2. The Receiver must be set up to perform per Lane
comparison.

b. Detection on a Receiver Lane is considered successful if total error count is less than the set
error threshold (see Section 9.5.3.29).

3\. The UCIe Module must send {MBTRAIN.DATATRAINVREF end req} sideband message after the
Vref optimization is complete. When {MBTRAIN.DATATRAINVREF end req} is received, the UCIe
Module Partner responds with {MBTRAIN.DATATRAINVREF end resp}. Once the UCIe Module has
sent and received the sideband message {MBTRAIN.DATATRAINVREF end resp}, it must exit to
MBTRAIN.RXDESKEW.

Note:
It is possible that the eye opening in this step is insufficient (test fails) and a per-bit
deskew may be needed on the Receiver. Thus, the UCIe Module must exit to
MBTRAIN.RXDESKEW.

### 4.5.3.4.10 MBTRAIN.RXDESKEW

The UCIe Module is permitted to optionally perform per Lane deskew on its Receivers to improve
timing margin in this state. The Track Transmitter is held Low. When not performing the actions
relevant to this state:

· Clock Receivers are enabled

· Data and Valid Transmitters are held low

· Data and Valid Receivers are enabled

. If the operating speed is <= 32 GT/s AND Strobe mode was advertised by the UCIe Module
Partner, then the Clock Transmitters are held differential low (for differential clocking) or
simultaneous low (for Quadrature clocking)

. If the operating speed is > 32 GT/s OR continuous clock mode was advertised by the UCIe Module
Partner, then the Clock Transmitters are providing the free-running forwarded clock

Following is the MBTRAIN.RXDESKEW sequence:

1\. The UCIe Module must send the {MBTRAIN.RXDESKEW start req} sideband message. When
{MBTRAIN.RXDESKEW start req} sideband message is received, the UCIe Module Partner
responds with the {MBTRAIN.RXDESKEW start resp} sideband message. If the operating speed is
$< = 3 2 \quad G T / s ,$ then proceed to Step 3.

2\. If the operating speed is > 32 GT/s, the UCIe Module is permitted to request a preset TX EQ
setting for the transmitters at the UCIe Module Partner in this step. To request a preset TX EQ
setting, the UCIe Module sends the {MBTRAIN.RXDESKEW EQ Preset req} sideband message. A
4-bit EQ preset encoding is provided in the Message Info field of this message (see Table 5-7 for
the preset encodings). The UCIe Module Partner applies the EQ preset if the request had a valid
encoding (i.e., one of the encodings from Table 5-7), and responds with the
{MBTRAIN.RXDESKEW EQ Preset resp} sideband message that indicates a status of "Success"
(see Table 7-9 for the sideband message encodings). If the request had a reserved encoding (i.e.,
it is not one of the encodings from Table 5-7), the UCIe Module Partner does not change its EQ
preset and responds with an {MBTRAIN.RXDESKEW EQ Preset resp} sideband message that
indicates a status of "Fail". In case of a "Fail" status, the UCIe Module is permitted to request
another preset by sending another {MBTRAIN.RXDESKEW EQ Preset req} sideband message and
repeating Step 2 before proceeding to Step 3.

3\. The UCIe Module optionally performs per Lane deskew on its Receivers by one or more Receiver-
initiated Data-to-Clock eye width sweeps (see Section 4.5.1.4) (AND/OR) one or more Receiver-
initiated Data-to-Clock point tests (see Section 4.5.1.3). Step 3 is optional and implementation
specific.

a. If per Lane deskew is performed:

o The Transmitter must be set up to send 4K UI of continuous mode LFSR pattern described
in Section 4.4.1. The LFSR pattern on data must be accompanied by correct valid framing
on the Valid Lane as described in Section 4.1.2. The Receiver must be set up to perform
per Lane comparison.

o Detection on a Receiver Lane is considered successful if total error count is less than the
set threshold (see Section 9.5.3.29).

b. If the operating speed $\mathrm { i s } > 3 2 \mathrm { G T / s } ,$ the following additional rules apply:

o The UCIe Module is permitted to repeat Step 2 and Step 3 multiple times, as long as
doing so does not lead to a state residency timeout for MBTRAIN.RXDESKEW.

o The UCIe Module is also permitted to issue an {MBTRAIN.RXDESKEW exit to
DATATRAINCENTER1 req} sideband message to request the next state to be
MBTRAIN.DATATRAINCENTER1 to allow additional transmitter side adjustments for the EQ
preset selected. The UCIe Module is permitted to take the RXDESKEW to
DATATRAINCENTER1 arc a maximum of four times.

o After the UCIe Module Partner receives an {MBTRAIN.RXDESKEW exit to
DATATRAINCENTER1 req} sideband message, if the UCIe Module Partner has not reached
the maximum limit of RXDESKEW to DATATRAINCENTER1 arc iterations, the UCIe Module
Partner responds with an {MBTRAIN.RXDESKEW exit to DATATRAINCENTER1 resp}
sideband message and transitions the state to MBTRAIN.DATATRAINCENTER1. If the
maximum limit of RXDESKEW to DATATRAINCENTER1 arc iterations is exceeded, the UCIe
Module Partner performs the TRAINERROR handshake and Link state transitions to
TRAINERROR state.

o After an {MBTRAIN.RXDESKEW exit to DATATRAINCENTER1 resp} sideband message is
sent or received, any pending {MBTRAIN.RXDESKEW end req} sideband messages are
discarded and that handshake is not completed (i.e,. the originator must not expect a
response for any discarded {MBTRAIN.RXDESKEW end req} sideband messages).

o If a UCIe Module receives an {MBTRAIN.RXDESKEW end req} sideband message but the
UCIe Module intends to send an {MBTRAIN.RXDESKEW exit to DATATRAINCENTER1 req}
sideband message, the UCIe Module must not send an {MBTRAIN.RXDESKEW end resp}
sideband message (i.e., the UCIe Module will not proceed to Step 4).

o If no other EQ preset adjustments are needed as determined by the Receiver, the UCIe
Module proceeds to Step 4.

4\. The UCIe Module must send {MBTRAIN.RXDESKEW end req} sideband message after the deskew
is performed or skipped. When {MBTRAIN.RXDESKEW end req} is received, the UCIe Module
Partner must respond with {MBTRAIN.RXDESKEW end resp}. Once UCIe Module has sent and
received the sideband message {MBTRAIN.RXDESKEW end resp}, it must exit to
MBTRAIN.DATATRAINCENTER2.

### 4.5.3.4.11 MBTRAIN.DATATRAINCENTER2

This state is needed for the UCIe Module to recenter clock to aggregate data in case the UCIe Module
Partner's Receiver performed a per Lane deskew. The Track Transmitter is held Low. When not
performing the actions relevant to this state:

· Clock Receivers are enabled

· Data and Valid Transmitters are held low

· Data and Valid Receivers are enabled

. If the operating speed is <= 32 GT/s AND Strobe mode was advertised by the UCIe Module
Partner, then the Clock Transmitters are held differential low (for differential clocking) or
simultaneous low (for Quadrature clocking)

. If the operating speed is > 32 GT/s OR continuous clock mode was advertised by the UCIe Module
Partner, then the Clock Transmitters are providing the free-running forwarded clock

Following is the MBTRAIN.DATATRAINCENTER2 sequence:

1\. The UCIe Module sends the sideband message {MBTRAIN.DATATRAINCENTER2 start req}. When
{MBTRAIN.DATATRAINCENTER2 start req} sideband message is received, the UCIe Module
Partner responds with {MBTRAIN.DATATRAINCENTER2 start resp}.

2\. The UCIe Module must perform one or more Transmitter-initiated Data-to-Clock eye width sweeps
(see Section 4.5.1.2) (AND/OR) one or more Transmitter-initiated Data-to-Clock point tests (see
Section 4.5.1.1) to determine the correct data-to-eye centering.

a. The Transmitter must be set up to send 4K UI of continuous mode LFSR pattern described in
Section 4.4.1. The LFSR pattern on data must be accompanied by correct valid framing on the
Valid Lane as described in Section 4.1.2. The Receiver must be set up to perform per Lane
comparison.

b. Detection on a Receiver Lane is considered successful if total error count is less than the set
error threshold (see Section 9.5.3.29).

3\. The UCIe Module uses the received training results to calculate the final eye center and set the
clock phase to sample the data eye at the optimal point to maximize eye margins. The UCIe
Module must send the {MBTRAIN.DATATRAINCENTER2 end req} sideband message. When
{MBTRAIN.DATATRAINCENTER2 end req} sideband message is received, the UCIe Module Partner
responds with {MBTRAIN. DATATRAINCENTER2 end resp}. Once UCIe Module has sent and
received {MBTRAIN.DATATRAINCENTER2 end resp} sideband message, it must exit to
MBTRAIN.LINKSPEED.

### 4.5.3.4.12 MBTRAIN.LINKSPEED

In this state, the UCIe Module checks Link stability at the operating date rate. The Track Transmitter is
held Low. When not performing the actions relevant to this state:

· Clock Receivers are enabled

· Data and Valid Transmitters are held low

· Data and Valid Receivers are enabled

. If the operating speed is <= 32 GT/s AND Strobe mode was advertised by the UCIe Module
Partner, then the Clock Transmitters are held differential low (for differential clocking) or
simultaneous low (for Quadrature clocking)

. If the operating speed is > 32 GT/s OR continuous clock mode was advertised by the UCIe Module
Partner, then the Clock Transmitters are providing the free-running forwarded clock

The following steps must be executed sequentially, when applicable:

1\. The UCIe Module sends the sideband message {MBTRAIN.LINKSPEED start req}. When
{MBTRAIN.LINKSPEED start req} sideband message is received, the UCIe Module Partner
responds with {MBTRAIN.LINKSPEED start resp}.

2\. The UCIe Module must perform a Transmitter-initiated Data-to-Clock point test (see
Section 4.5.1.1) with the final clock sampling phase calculated in the previous
MBTRAIN.DATACENTER2 state. LFSR pattern described in Section 4.4.1 must be used in this
state.

a. The Transmitter must be set up to send 4K UI of continuous mode LFSR pattern described in
Section 4.4.1. The LFSR pattern on data must be accompanied by correct valid framing on the
Valid Lane as described in Section 4.1.2. The Receiver must be set up to perform per Lane
comparison.

b. Detection on a Receiver Lane is considered successful if total error count is less than the set
threshold (see Section 9.5.3.29).

3\. For single-Module instantiations, if errors are encountered, the UCIe Module sets its Transmitters
to an electrical idle state and sends {MBTRAIN.LINKSPEED error req} sideband message. If an
{MBTRAIN.LINKSPEED error req} sideband message is received, the UCIe Module Partner must
complete Step 1 and Step 2, evaluate the results and if not initiating an {MBTRAIN.LINKSPEED
exit to phy retrain req} sideband message, the UCIe Module Partner enters electrical idle on its
Receiver and sends the {MBTRAIN.LINKSPEED error resp} sideband message. If an
{MBTRAIN.LINKSPEED exit to phy retrain req} sideband message is received, the UCIe Module
must exit to PHYRETRAIN and send an {MBTRAIN.LINKSPEED exit to PHY retrain resp} sideband
message; any outstanding messages are abandoned. Otherwise, after the {MBTRAIN.LINKSPEED
error resp} sideband message is received, the PHY_IN_RETRAIN flag is cleared and the following
rules apply:

a. Based on the number of Lanes encountering errors, the UCIe Module checks if the failing
Lanes can be repaired (for Advanced package) or Width degraded (for standard package).
If Lanes can be can be repaired (for Advanced package) or Width degraded (for standard
package), the UCIe Module must send {MBTRAIN.LINKSPEED exit to repair req} to the UCIe
Module Partner. The UCIe Module Partner, if not initiating a speed degrade, enters
MBTRAIN.REPAIR and sends the sideband message {MBTRAIN.LINKSPEED exit to repair resp}.
If {MBTRAIN.LINKSPEED exit to repair resp} is received in response to a
{MBTRAIN.LINKSPEED exit to repair req}, the UCIe Module must exit to MBTRAIN.REPAIR. If
a UCIe Module is initiating a speed degrade, it must not respond to {MBTRAIN.LINKSPEED exit
to repair req}.

b. If the Lanes cannot be repaired (for Advanced package) or width degraded (for Standard
package), the speed must be degraded. The UCIe Module sends {MBTRAIN.LINKSPEED exit to
speed degrade req} sideband message and waits for a response from the remote Link partner.
The UCIe Module Partner must respond with {MBTRAIN.LINKSPEED exit to speed degrade
resp}. Following this handshake, the UCIe Module must exit to MBTRAIN.SPEEDIDLE to set
data rate to next lower speed.

c. If the UCIe Module receives an {MBTRAIN.LINKSPEED exit to speed degrade req} any
outstanding {MBTRAIN.LINKSPEED exit to repair req} must be abandoned and the UCIe
Module must respond to {MBTRAIN.LINKSPEED exit to speed degrade req}.

d. Any outstanding {MBTRAIN.LINKSPEED done req} must be abandoned if a UCIe Module has
received a {MBTRAIN.LINKSPEED error req}.

4\. For single- or multi-module instantiations, if no errors are encountered, the UCIe Module must set
the clock phase on its Transmitter to sample the data eye at the optimal point to maximize eye
margins. If PHY_IN_RETRAIN is not set for single-module instantiations, proceed to Step 6. If
PHY_IN_RETRAIN is not set, for multi-module instantiations, the UCIe Module must send the
{MBTRAIN.LINKSPEED done req} (if not waiting for Link match criteria as a Retimer) to the
remote UCIe Module Partner and wait for multi-module PHY Logic (MMPL) resolution in Step 5c. If
the PHY_IN_RETRAIN variable is set, the following actions must be taken:

a. If a change is detected in Runtime Link Test Control register relative to the values at previous
PHYRETRAIN entry, the UCIe Module must send an {MBTRAIN.LINKSPEED exit to phy retrain
req} sideband message and wait for a response. Upon receiving this message, the UCIe Module
Partner must exit to PHY retrain and send an {MBTRAIN.LINKSPEED exit to PHY retrain resp}
sideband message. Once this sideband message is received, the UCIe Module must exit to PHY
retrain.

b. Else if no change is detected in the Runtime Link Test Control register relative to the values at
previous PHYRETRAIN entry, Busy bit in Runtime Link Test Status and PHY_IN_RETRAIN
variable must be cleared and the UCIe Module must proceed to Step 6.

5\. For multi-module instantiations, if errors are encountered, the UCIe Module sets its Transmitters
to an electrical idle state and sends {MBTRAIN.LINKSPEED error req} sideband message. If an
{MBTRAIN.LINKSPEED error req} sideband message is received, the UCIe Module Partner must
complete Step 1 and Step 2, evaluate the results and if not initiating an {MBTRAIN.LINKSPEED
exit to phy retrain req} sideband message, the UCIe Module Partner enters electrical idle on its
Receiver, and sends the {MBTRAIN.LINKSPEED error resp} sideband message. If an
{MBTRAIN.LINKSPEED exit to phy retrain req} sideband message is received on any of the
modules in the multi-module Link, the UCIe Module must exit to PHYRETRAIN and send an
{MBTRAIN.LINKSPEED exit to PHY retrain resp} sideband message; any outstanding messages
are abandoned. Otherwise, after the {MBTRAIN.LINKSPEED error resp} sideband message is
received, the PHY_IN_RETRAIN flag is cleared and the following rules apply:

a. Based on the number of Lanes encountering errors, the UCIe Module checks whether the failing
Lanes can be repaired (for Advanced Package) or Width degraded (for Standard Package). If
Lanes can be can be repaired (for Advanced Package) or Width degraded (for Standard
Package), the UCIe Module must send {MBTRAIN.LINKSPEED exit to repair req} to the UCIe
Module Partner.

b. If the Lanes cannot be repaired (for Advanced Package) or width degraded (for Standard
Package), the speed must be degraded. The UCIe Module sends {MBTRAIN.LINKSPEED exit to
speed degrade req}.

c. The UCIe Module informs MMPL of local and remote error requests, done requests, or speed
degrade requests, and waits for resolution. It also informs MMPL of any prior width degrade
(for example in MBINIT.REPAIRMB), and MMPL treats this as the corresponding module
requesting width degrade from the full operational width.

d. Based on the resolution flow chart in Section 4.7, MMPL directs each Module to send either the
{MBTRAIN.LINKSPEED exit to repair resp} (indicating next state is REPAIR),
{MBTRAIN.LINKSPEED exit to speed degrade resp} (indicating next state is SPEEDIDLE with
target speed to next-lower speed), {MBTRAIN.LINKSPEED multi-module disable module resp}
(indicating next state is TRAINERROR and eventually RESET), or {MBTRAIN.LINKSPEED done
resp} (indicating next state is LINKINIT). This is done regardless of the module's original error
request or done request, and indicates the result of the resolution and next state to each
module. The UCIe Module transitions to next state once it has sent and received the sideband
response message that matches the expected resolution. Any mismatch on received message
vs. expected resolution must take all modules to TRAINERROR. For Retimer dies, the resolution

must take into account any Link match requirements, and while resolving the target
configuration with remote Retimer partner, each UCIe Module from the Retimer die must send
{MBTRAIN.LINKSPEED done resp} with stall encoding every 4 ms. The UCIe Retimer must
ensure that this stall is not perpetual, and an implementation-specific timeout must be included
in the Retimer. If {MBTRAIN.LINKSPEED done resp} with stall encoding is received, it must
reset timers for state transition as well as any outstanding handshakes for multi-module
resolution.

6\. If the UCIe die is not a Retimer, proceed to Step 7. If the UCIe die is a Retimer, the following rules
apply to achieve Link match (if required):

a. Retimer must not send {MBTRAIN.LINKSPEED done req} unless the target Link speed and
width of the remote Retimer partner resolves to current Link and width. Proceed to Step 7 if
Link match is achieved or if it is not required.

b. While resolving the target Link speed and width with the remote Retimer partner, if a Retimer
has received an {MBTRAIN.LINKSPEED done req}, it must send {MBTRAIN.LINKSPEED done
resp} with stall encoding every 4 ms. UCIe Retimer must ensure that this stall is not perpetual,
and an implementation specific timeout must be included in the Retimer.

C. If the local UCIe Link speed or width is greater than the remote Retimer UCIe Link, then it must
treat this as an error condition, and perform Step 3 or Step 5 with repair or speed degrade
(whichever is applicable).

7\. The UCIe Module must send {MBTRAIN.LINKSPEED done req} sideband message. When
{MBTRAIN.LINKSPEED done req} is received, the UCIe Module must respond with
{MBTRAIN.LINKSPEED done resp} and when a UCIe Module has sent and received the
{MBTRAIN.LINKSPEED done resp} sideband message, both Transmitters and Receivers are now
enabled and idle and both devices exit to LINKINIT.

### 4.5.3.4.13 MBTRAIN.REPAIR

This state can be entered from PHYRETRAIN or from MBINIT.LINKSPEED. For Advanced package, this
state will be used to apply repair and for Standard package, this state will be used for Link width
degrade. Track, Data, and Valid Transmitters are held low. Clock Transmitters are held differential low
(for differential clocking) or simultaneous low (for Quadrature clocking).

For Advanced Package, if the number of repair resources currently available is greater than or equal
to the number of Lanes encountering errors, repair must be applied:

1\. The UCIe Module sends the sideband message {MBTRAIN.REPAIR init req} for its Transmitter and
the UCIe Module Partner responds with {MBTRAIN.REPAIR init resp}.

2\. If Lane repair is possible, the UCIe Module applies repair on its Transmitter Lanes as described in
Section 4.3.1 and sends {MBTRAIN.REPAIR Apply repair req} sideband message. The UCIe
Module Partner applies repair as described in Section 4.3.1 and responds with {MBTRAIN.REPAIR
Apply repair resp} sideband message once the required repair is applied.

3\. The UCIe Module must send {MBTRAIN.REPAIR end req} sideband message and waits for a
response. The UCIe Module Partner must then respond with {MBTRAIN.REPAIR end resp}. When
a UCIe Module has sent and received {MBTRAIN.REPAIR end resp}, it must exit to
MBTRAIN.TXSELFCAL.

For a x16 Standard package, if the Lanes encountering errors are all contained within the set of
Lane 0 through Lane 7 or Lane 8 through Lane 15, the width must be degraded to a x8 Link using the
set of Lanes without errors (Lane 0 ... Lane 7 OR Lane 8 ... Lane 15). Likewise, for a x8 Standard
package, if the Lanes encountering errors are all contained within the set of Lane 0 through Lane 3
or Lane 4 through Lane 7, the width must be degraded to a x4 Link using the set of Lanes without
errors (Lane 0 through Lane 3 or Lane 4 through Lane 7).

1\. The UCIe Module sends the sideband message {MBTRAIN.REPAIR init req} and the Receiver
responds with {MBTRAIN.REPAIR init resp}.

2\. The UCIe Module must send the {MBTRAIN.REPAIR apply degrade req} sideband message,
indicating the functional Lanes on its Transmitter using one of the logical Lane map encodings
from Table 4-9. Encodings 100b and 101b can be used only when the SPMW bit is set to 1 or the
UCIe-S x8 bit was set to 1 in the transmitted or received {MBINIT.PARAM configuration req}
sideband message. If the remote Link partner indicated a width degrade in the functional Lanes,
the UCIe Module must apply the corresponding width degrade to its Receiver. If the remote Link
partner indicated all Lanes are functional, the UCIe Module sets its Transmitter and Receiver to
the logical lane map corresponding to the functional Lane encoding determined on its Transmitter.
The UCIe Module sends the {MBTRAIN.REPAIR apply degrade resp} sideband message after
setting its Transmitter and Receiver lanes to the relevant logical lane map and proceeds to Step 3
if a degrade is possible or if all Lanes are functional. If a "Degrade not possible" encoding is sent
or received in the {MBTRAIN.REPAIR apply degrade req} sideband message, the UCIe Module
must exit to TRAINERROR after performing the TRAINERROR handshake.

3\. The UCIe Module must send the {MBTRAIN.REPAIR end req} sideband message and wait for a
response. The UCIe Module Partner must then respond with the {MBTRAIN.REPAIR end resp}
sideband message. When UCIe Module has sent and received the {MBTRAIN.REPAIR end resp}
sideband message, the UCIe Module must exit to MBTRAIN.TXSELFCAL.

### 4.5.3.5 LINKINIT

This state is used to allow die to die adapter to complete initial Link management before entering
Active state on RDI. See Section 10.1.6 for more details on RDI bring up flow. Track, Data, and Valid
Transmitters are held low. If the operating speed is <= 32 GT/s AND Strobe mode was advertised by
the UCIe Module Partner, then the Clock Transmitters are held differential low (for differential
clocking) or simultaneous low (for Quadrature clocking). If the operating speed is > 32 GT/s OR
continuous clock mode was advertised by the UCIe Module Partner, then the Clock Transmitters are
providing the free-running forwarded clock. Clock Receivers are enabled.

Once RDI is in Active state, the PHY will clear its copy of "Start UCIe Link training" bit from UCIe Link
control register.

The scrambler LFSR must be RESET upon entering this state.

This state is common for Advanced Package and Standard Package configurations.

### 4.5.3.6 ACTIVE

Physical layer initialization is complete, RDI is in Active state and packets from upper layers can be
exchanged between the two dies.

All data in this state is scrambled using the scrambler LFSR described in Section 4.4.1. Clock gating
rules as described in Section 5.11 apply.

This state is common for Advanced Package and Standard Package configurations.

### 4.5.3.7 PHYRETRAIN

A die can enter PHY retrain for a number of reasons. Track, Data, and Valid Transmitters are held low.
Clock Transmitters are held differential low (for differential clocking) or simultaneous low (for
Quadrature clocking). The trigger for PHY to enter PHY retrain is one of the following scenarios:

· Adapter directed PHY retrain: Adapter can direct the PHY to retrain for any reason it deems
necessary (see Section 10.3.3.4 Retrain State rules for more details and examples of Adapter-
initiated Retrain requests).

· PHY initiated PHY retrain: Local PHY must initiate retrain on detecting a Valid framing error.

. Remote die requested PHY retrain: Local PHY must enter PHY retrain on receiving a request from
the remote die.

. If a change is detected in Runtime Link Test Control register during MBTRAIN.LINKSPEED.

A variable PHY_IN_RETRAIN must be set when entering PHYRETRAIN. For a multi-module
configuration, the Retrain encoding (and hence the Retrain exit resolution) must be the same for all
the modules which are part of the same multi-module Link. This is required because in a multi-
module Link all modules must operate at the same speed and width (however, for Advanced package,
it is possible for a module not needing repair to go through the Repair state and send the "No Repair"
encoding in the corresponding {\*apply repair\*} messages).

<table>
<caption>Table 4-10. Runtime Link Test Status Register based Retrain encoding</caption>
<tr>
<th colspan="2">Link Test Status Register</th>
<th rowspan="2">Retrain Encoding Resolution</th>
</tr>
<tr>
<th>Busy bit value</th>
<th>Repair Required</th>
</tr>
<tr>
<td>0b</td>
<td>$N / A$</td>
<td>TXSELFCAL</td>
</tr>
<tr>
<td rowspan="2">1b</td>
<td rowspan="2">Repair needed</td>
<td>REPAIR (If repair resources are available)</td>
</tr>
<tr>
<td>SPEEDIDLE (if unrepairable)</td>
</tr>
<tr>
<td>1b</td>
<td>No Repair</td>
<td>TXSELFCAL</td>
</tr>
</table>

<table>
<caption>Table 4-11. Retrain encoding</caption>
<tr>
<th>Retrain Encoding</th>
<th>State</th>
<th>Retain Condition</th>
</tr>
<tr>
<td>001b</td>
<td>TXSELFCAL</td>
<td>No Lane errors (Valid framing errors detected by PHY)</td>
</tr>
<tr>
<td>010b</td>
<td>SPEEDIDLE</td>
<td>Lane errors &amp; faulty Lanes cannot be repaired</td>
</tr>
<tr>
<td>100b</td>
<td>REPAIR</td>
<td>Lane errors &amp; faulty Lanes are repairable</td>
</tr>
</table>

<table>
<caption>Table 4-12. Retrain exit state resolution</caption>
<tr>
<th colspan="2">Retrain reg Condition</th>
<th colspan="2">Retrain Request Encoding</th>
<th colspan="2">Resolved State Encoding</th>
<th>Exit</th>
</tr>
<tr>
<th>Die 0</th>
<th>Die 1</th>
<th>Die 0</th>
<th>Die 1</th>
<th>Die 0</th>
<th>Die 1</th>
<th>Both Dies</th>
</tr>
<tr>
<td>No Lane Errors</td>
<td>No Lane Errors</td>
<td>001b</td>
<td>001b</td>
<td>001b</td>
<td>001b</td>
<td>MBTRAIN. TXSELFCAL</td>
</tr>
<tr>
<td>No Lane Errors</td>
<td>Repair</td>
<td>001b</td>
<td>100b</td>
<td>100b</td>
<td>100b</td>
<td>MBTRAIN.REPAIR</td>
</tr>
<tr>
<td>No Lane Errors</td>
<td>Speed Degrade</td>
<td>001b</td>
<td>010b</td>
<td>010b</td>
<td>010b</td>
<td>MBTRAIN.SPEEDIDLE</td>
</tr>
<tr>
<td>Repair</td>
<td>No Lane Errors</td>
<td>100b</td>
<td>001b</td>
<td>100b</td>
<td>100b</td>
<td>MBTRAIN.REPAIR</td>
</tr>
<tr>
<td>Repair</td>
<td>Repair</td>
<td>100b</td>
<td>100b</td>
<td>100b</td>
<td>100b</td>
<td>MBTRAIN.REPAIR</td>
</tr>
<tr>
<td>Repair</td>
<td>Speed Degrade</td>
<td>100b</td>
<td>010b</td>
<td>010b</td>
<td>010b</td>
<td>MBTRAIN.SPEEDIDLE</td>
</tr>
<tr>
<td>Speed Degrade</td>
<td>No Lane Errors</td>
<td>010b</td>
<td>001b</td>
<td>010b</td>
<td>010b</td>
<td>MBTRAIN.SPEEDIDLE</td>
</tr>
<tr>
<td>Speed Degrade</td>
<td>Repair</td>
<td>010b</td>
<td>100b</td>
<td>010b</td>
<td>010b</td>
<td>MBTRAIN.SPEEDIDLE</td>
</tr>
<tr>
<td>Speed Degrade</td>
<td>Speed Degrade</td>
<td>010b</td>
<td>010b</td>
<td>010b</td>
<td>010b</td>
<td>MBTRAIN.SPEEDIDLE</td>
</tr>
</table>

#### 4.5.3.7.1 Adapter initiated PHY retrain

Following is the sequence of steps for an Adapter initiated PHY retrain:

1\. UCIe Module receives retrain request from the local Adapter (RDI state req moved to Retrain).
Following this, the UCIe Module must complete the stall Req/Ack (pl_stallreq; lp_stallack)
hand shake on RDI as described in Chapter 10.0.

2\. After completion of stall Req/Ack handshake and transmitting any pending data over mainband,
UCIe Module must send sideband message {LinkMgmt.RDI.Req.Retrain} to UCIe Module Partner.

3\. The UCIe Module Partner on receiving the sideband message {LinkMgmt.RDI.Req.Retrain} must
transition its RDI state to Retrain after completion of stall Req/Ack (pl_stallreq;
lp_stallack) handshake on its RDI and there is no mainband data pending in the Receiver
pipeline. After completion of stall Req/Ack handshake and transmitting any pending data over
mainband, the UCIe Module Partner responds with {LinkMgmt.RDI.Rsp.Retrain}.

4\. Once {LinkMgmt.RDI.Rsp.Retrain} is received and there is no mainband data pending in the
receiver pipeline, the UCIe Module must transition its RDI to Retrain.

5\. UCIe Module must send {PHYRETRAIN.retrain start req} with retrain encoding reflecting the
contents of Runtime Link Test Control register except the Start bit (if the Busy bit in Runtime Link
Test Status Register is set). Following this, the UCIe Module Partner compares the received retrain
encoding with the local retrain encoding. If received retrain encoding is the same as the local
retrain encoding, the UCIe Module Partner must respond with {PHYRETRAIN.retrain start resp}. If
the retrain encodings do not match, the UCIe Module Partner must resolve according to Retrain
encodings and resolutions shown in Table 4-10, Table 4-11, and Table 4-12 and then send
{PHYRETRAIN.retrain start resp} with the resolved retrain encoding.

6\. Once UCIe Module sends and receives the sideband message {PHYRETRAIN.retrain start resp}, it
must exit to corresponding training state according to the resolved retrain register encoding.

### 4.5.3.7.2 PHY initiated PHY retrain

Following is the sequence of steps for PHY initiated PHY retrain:

1\. On detecting a valid framing error, the UCIe Module must assert pl_error when transmitting
that flit (or flit chunk) on RDI. Following this the UCIe Module (PHY) must complete the stall Req/
Ack (pl_stallreq; lp_stallack) handshake on RDI.

2\. The UCIe Module must send sideband message {LinkMgmt.RDI.Req.Retrain}.

3\. The UCIe Module Partner on receiving the sideband message {LinkMgmt.RDI.Req.Retrain} must
transition its RDI to retrain after completion of stall Req/Ack (pl_stallreq; lp_stallack)
handshake on its RDI. Following that the UCIe Module Partner responds with
{LinkMgmt.RDI.Rsp.Retrain}.

4\. Once {LinkMgmt.RDI.Rsp.Retrain} is received, the UCIe Module must transition its RDI to Retrain.

5\. UCIe Module must send {PHYRETRAIN.retrain start req} with retrain encoding reflecting the
contents of Runtime Link Test Control register except the Start bit (if the Busy bit in Runtime Link
Test Status Register is set). Following this, the UCIe Module Partner compares the received retrain
encoding with the local retrain encoding. If received retrain encoding is the same as the local
retrain encoding, the UCIe Module Partner must respond with {PHYRETRAIN.retrain start resp}. If
the retrain encodings do not match, the UCIe Module Partner must resolve according to Retrain
encodings and resolutions shown in Table 4-10, Table 4-11, and Table 4-12 and then send
{PHYRETRAIN.retrain start resp} with the resolved retrain encoding.

6\. Once a UCIe Module has sent and received the sideband message {PHYRETRAIN.retrain start
resp}, it must exit to corresponding training state according to the resolved retrain encoding.

### 4.5.3.7.3 Remote Die requested PHY retrain

1\. On receiving {LinkMgmt.RDI.Req.Retrain}, the UCIe Module must transition local RDI to retrain
after completion of stall Req/Ack (pl_stallreq; lp_stallack) handshake on its RDI.
Following that the UCIe Module responds with {LinkMgmt.RDI.Rsp. Retrain}.

2\. Once {LinkMgmt.RDI.Rsp.Retrain} is received, the UCIe Module Partner must transition its RDI to
retrain.

3\. UCIe Module must send {PHYRETRAIN.retrain start req} with retrain encoding reflecting the
contents of Runtime Link Test Control register except the Start bit (if the Busy bit in Runtime Link
Test Status Register is set). Following this, the UCIe Module Partner compares the received retrain
encoding with the local retrain encoding. If received retrain encoding is the same as the local
retrain encoding, the UCIe Module Partner responds with {PHYRETRAIN.retrain start resp}. If the
retrain encodings do not match, the UCIe Module Partner must resolve according to Retrain
encodings and resolutions shown in Table 4-10, Table 4-11, and Table 4-12 and then send
{PHYRETRAIN.retrain start resp} with the resolved retrain encoding.

4\. Once a die has sent and received the sideband message {PHYRETRAIN.retrain start resp}, it must
exit to corresponding training state according to the resolved retrain encoding.

### 4.5.3.7.4 PHY retrain from LINKSPEED

1\. The UCIe Module must send {PHYRETRAIN.retrain start req} with retrain encoding reflecting the
contents of Runtime Link Test Control register except the Start bit (if the Busy bit in Runtime Link
Test Status Register is set). Following this, the UCIe Module Partner compares the received retrain
encoding with the local retrain encoding. If received retrain encoding is the same as the local
retrain encoding, the UCIe Module Partner must respond with {PHYRETRAIN.retrain start resp}. If
the retrain encodings do not match, the UCIe Module Partner must resolve according to Retrain
encodings and resolutions shown in Table 4-10, Table 4-11, and Table 4-12 and then send
{PHYRETRAIN.retrain start resp} with the resolved retrain encoding.

2\. Once a die has sent and received the sideband message {PHYRETRAIN.retrain start resp}, it must
exit to corresponding training state according to the resolved retrain encoding.

### 4.5.3.8 TRAINERROR

This state used as a transitional state due to any fatal or non-fatal events that need to bring the state
machine back to RESET state. This can happen during initialization and training or if "Start UCIe Link
training" bit from UCIe Link control register is set when state machine is not in RESET. It is also used
for any events that transition the Link from a Link Up to a Link Down condition. Data, Valid, Clock,
and Track transmitters are tri-stated, and their receivers are permitted to be disabled.

The exit from TRAINERROR to RESET is implementation specific. For cases when there is no error
escalation (i.e., RDI is not in LinkError), it is recommended to exit TRAINERROR as soon as possible.
For cases when there is error escalation (i.e., RDI is in LinkError), it is required for Physical Layer to
be in TRAINERROR as long as RDI is in LinkError. To avoid problems with entering RESET while
transmitting sideband packets, any in-progress sideband packets must finish transmission before
entering RESET state.

See Chapter 10.0 for correctable, non-fatal, and fatal error escalation on RDI.

This state is common for Advanced Package and Standard Package configurations.

If sideband is Active, a sideband handshake must be performed to enter TRAINERROR state from any
state other than SBINIT. The following is defined as the TRAINERROR handshake:

. The UCIe Module requesting exit to TRAINERROR must send {TRAINERROR Entry req} sideband
message and wait for a response. The UCIe Module Partner must exit to TRAINERROR and

respond with {TRAINERROR Entry resp}. Once {TRAINERROR Entry resp} sideband message is
received, the UCIe Module must exit to TRAINERROR. If no response is received for 8 ms, the
LTSM transitions to TRAINERROR.

### 4.5.3.9 L1/L2

PM state allows a lower power state than dynamic clock gating in ACTIVE. Data, Valid, Clock, and
Track transmitters are tri-stated, and their receivers are permitted to be disabled.

. This state is entered when RDI has transitioned to PM state as described in Chapter 10.0. The PHY
power saving features in this state are implementation specific.

. When local Adapter requests Active on RDI or remote Link partner requests L1 exit the PHY must
exit to MBTRAIN.SPEEDIDLE. L1 exit is coordinated with the corresponding L1 state exit
transitions on RDI.

· When local Adapter requests Active on RDI or remote Link partner requests L2 exit the PHY must
exit to RESET. L2 exit is coordinated with the corresponding L2 state exit transitions on RDI.

### 4.5.3.9.1 Powering down Sideband in L2 State

Implementations are permitted to optionally support the L2 Sideband Power Down (L2SPD) feature.
This capability is negotiated by way of Sideband Feature Extensions. If L2SPD is negotiated,
implementations are permitted to aggressively power down most of the sideband logic, with the
exceptions noted in the rules of this section. The sideband clock and data pins are used to provide a
mechanism to wake up the sideband infrastructure and re-perform SBINIT before sideband packets
can be transmitted. The rules are provided so that the L2 exit can be triggered from either side of the
Link.

In a multi-module Link, all the modules must advertise the same capability in the context of L2SPD
(see Table 7-11 for the bit assignment of L2SPD capability during negotiation in the {MBINIT.PARAM
SBFE req/resp} sideband messages). The L2SPD bit is set to 1 in the {MBINIT.PARAM SBFE req}
sideband message if the L2SPD capability is supported by hardware and enabled through the L2SPD
bit in UCIe Link Control register; otherwise, the bit is cleared to 0. The L2SPD bit is set to 1 in the
{MBINIT.PARAM SBFE resp} sideband message if the L2SPD capability was advertised in the
transmitted as well as the received {MBINIT.PARAM SBFE req} sideband messages; otherwise, the bit
is cleared to 0. The following rules apply for L2, and L2 exit after L2SPD has been negotiated; for
multi-module Links, the following rules and steps must be independently followed for each module:

. After L2 entry is complete, implementations are permitted to aggressively power down most of
their sideband infrastructure, with the following exceptions:

\- Sideband transmitters must drive 0 on the clock and data pins.

\- Sideband receivers must have a minimal sampling circuit powered on to detect the sideband
clock = 1 and sideband data = 0.

\- If the SB_MGMT_UP flag is supported, it is cleared to 0.

. The L2 exit flow in this mode consists of three Phases. The L2 exit trigger is provided to the
remote Link partner by driving 1 on the sideband clock transmitter and 0 on the sideband data
transmitter.

\- Phase 1: L2 exit trigger is sent and received.

o If an L2 exit trigger is detected on the sideband clock and data receivers for at least 100
ns OR if the UCIe Module is initiating L2 exit, the UCIe Module must bring up its local die's
sideband infrastructure.

o When ready to perform SBINIT, initiate the L2 exit trigger on its sideband transmitter.

o After the L2 exit trigger has been transmitted and received for at least 100 ns, the UCIe
Module proceeds to Phase 2 of L2 exit.

\- Phase 2: Bringing the sideband and mainband to the initial state to prepare for Link training.

o The UCIe Module transitions the LTSM to Reset state and drives 0 on both the sideband
clock and data transmitters.

o After meeting the residency and exit requirements of Reset state (see Section 4.5.3.1),
the UCIe Module proceeds to Phase 3.

· Phase 3: Link Initialization and Training

o The UCIe Module begins regular Link Initialization and Training - Reset exit is initiated to
proceed with SBINIT and the remainder of the Link bring-up flow.

Figure 4-42 illustrates an example ladder diagram for the L2 exit flow.

<figure>
<figcaption>Figure 4-42. Example L2 Exit Flow with L2SPD Capability</figcaption>

Chiplet A

Chiplet B

L2 Entry complete (Sideband power down*)

Chiplet A:

\* Sideband power down still requires:

. Receives the L2 exit trigger

· Brings up its infrastructure/sideband
voltage and dock when it is ready for SBINIT

· On Tx, drive 0 on sb clk and sb data
. On Rx, have minimal sampling circuit
to detect sb clk = 1 and sb data = 0

sb clk = 1, sb data = 0

Chiplet B:

· Detects sb clk = 1 and sb data = 0,
and treats this event as an L2 exit trigger

· Brings up its infrastructure/sideband voltage
and clock when it is ready for SBINIT

sb clk = 1, sb data = 0

Both sides detect sb clk = 1, sb data = 0
for at least 100 ns on $T \mathrm { x }$ and Rx,
LTSM transitions from L2 to Reset

sb clk = 0, sb data = 0

After Reset residency is complete, proceed with
Reset state exit and SBINIT, Link Training and
RDI Active handshake to complete L2 Exit flow

</figure>

## 4.6 Runtime Recalibration

Track signal can be used by the Receiver to perform periodic runtime calibration while in ACTIVE (see
Section 5.5.1 for Track usage and examples). Mainband data must continued to be sampled and
processed (when accompanied by correct valid framing) during Runtime Recalibration. For
unterminated Link, when not sending the required pattern the Track signal must alternate between
being held low and held high (for anti aging) across consecutive Track recalibration iterations. For a
terminated Link, when not sending the required pattern, the Track transmitter must go to Hi-Z. Tx
Adjustment during Runtime Recalibration (TARR) is an optional feature that can be used to permit $T \mathrm { x }$
adjustments for drift compensation. Because the Tx performs the majority of the adjustments during
Link training, this option permits more power-efficient Rx designs because the Rx does not have to
provision for a wide range of margin for drift compensation.

The following sequence is used to request track pattern:

1\. The UCIe Module enables the Track signal buffers on its Receiver and sends a {RECAL.track
pattern init req} sideband message, and then waits for a response.

2\. The UCIe Module Partner sends {RECAL.track pattern init resp} and enables its Track signal
Transmitter (is preconditioned to drive low if needed). Following this, the UCIe Module Partner's
Track Transmitter starts sending the pattern described in Section 5.5.1, along with the forwarded
clock. If the link is in Clock-gated mode, the UCIe Module Partner should enable the clock and
manage whether the Link should return to Clock-gated mode after the Track update is complete.

3\. If TARR was not negotiated or the Rx has determined that it can successfully perform
recalibration, the UCIe Module on its Receiver performs the required recalibration and sends the
{RECAL.track pattern done req} sideband message and proceeds to Step 6. Otherwise, proceed
to Step 4.

4\. The UCIe Module sends a {RECAL.track tx adjust req} sideband message to notify the UCIe
Module Partner Tx of the delay compensation value and direction, in units of 1/64 UI (see
Table 7-9 for the encodings).

5\. The UCIe Module Partner is permitted to use the information provided in the {RECAL.track tx
adjust req} sideband message to perform Tx adjustments for drift compensation. The UCIe
Module Partner responds with a {RECAL.track tx adjust resp} sideband message after receiving
the {RECAL.track tx adjust req} sideband message. It is the responsibility of the UCIe Module
Partner to prevent the 8-ms timeout for this handshake. The UCIe Module Partner is
recommended to send the "Stall" once every 4 ms to prevent the timeout. The MsgInfo field in the
{RECAL.track tx adjust resp} sideband message has the following information (see Table 7-9 for
the encodings):

\- Drift Compensated: This indicates that the Tx of the UCIe Module Partner was successfully
able to fully or partially compensate for the drift

\- Drift not Compensated: This indicates that the $\mathrm { T x }$ of the UCIe Module Partner did not
compensate for the drift at all

\- Stall: This indicates that the Tx of the UCIe Module Partner is still working on the drift
compensation and that the Rx of the UCIe Module must reset its timeout counter

The algorithm for Tx adjustment of drift is implementation-specific; however, note that this
compensation only occurs while the LTSM is in Active state. If the response received is with "Drift
not Compensated" encoding, the receiver is permitted to compensate for the maximum-available
compensation on the Rx side before finishing the flow.

If any of the following conditions are true:

\- A {RECAL.track tx adjust resp} sideband message is not received within 8 ms of sending the
{RECAL.track tx adjust req} sideband message. Note that for the {RECAL.track tx adjust *}
sideband message handshake, the 8-ms timeout is not an error condition, and does not take
RDI to LinkError.

\- A {RECAL.track tx adjust resp} sideband message is received without the "Stall" encoding

\- LTSM transitions away from Active state

then, the Rx must finish the Runtime Recalibration flow by sending the {RECAL.track pattern done
req} sideband message. Any Tx adjustments must be stopped if the {RECAL.track pattern done
req} sideband message is received, and no subsequent {RECAL.track tx adjust resp} sideband
message is sent. The {RECAL.track tx adjust resp} sideband message should be ignored if the
message is received after deciding to finish the Runtime Recalibration flow.

6\. Upon receiving the {RECAL.track pattern done req} sideband message, the UCIe Module Partner's
Track Transmitter stops sending the pattern and sends the {RECAL.track pattern done resp}
sideband message.

7\. The UCIe Module is permitted to disable the Track Receiver upon receiving the {RECAL.track
pattern done resp} sideband message.

### 4.7 Multi-module Link

As described in Chapter 1.0, the permitted configurations for a multi-module Link are one-, two-, and
four-module configurations. In a multi-module Link, each module is assigned a dedicated Module
Identifier (Module ID), which is advertised to the remote Link partner during MBINIT. PARAM.
Chapter 5.0 defines the permitted combinations of Module ID assignments for the different scenarios
of Multi-module instantiations that must be supported by multi-module implementations.

#### 4.7.1 Multi-module initialization

Each module in a multi-module configuration must initialize and train independently, using its
sideband. If two or four modules are used, a separate multi-module PHY logic block coordinates
across the modules, as described in Section 1.2.2. The MMPL is responsible for orchestrating data
transfer and any associated byte swizzling for the Transmitters across the multiple modules such that
the remote Link partner's Receivers observe the correct byte-to-Lane mapping (i.e., for any valid
transfer, bytes are laid out from LSB to MSB in ascending order of Module ID and Lane ID across all
the active Lanes). Figure 4-43, Figure 4-44, Figure 4-45, and Figure 4-46 illustrate examples of the
aforementioned byte swizzling for some of the Standard Package configurations. M0, M1, M2, and M3
in the figures correspond to Module ID 0, Module ID 1, Module ID 2, and Module ID 3, respectively.
The figures provide the RDI byte-to-Module mapping. Figure 4-43 shows the scenario in which the
remote Link partner's Module ID is the same. Figure 4-44 shows an example of a scenario in which
the remote Link partner's Module ID is different. Figure 4-45 shows an example of width degradation
for Standard package in which the remote Link partner's Module ID is different (note that the bytes
are laid out in ascending order of Module ID and Lane ID across all the active Lanes at the Receiver in
all cases). Figure 4-46 shows a scenario in which two modules are disabled. This corresponds to a
case outlined in Chapter 5.0 in which a stacked configuration is connected with an unstacked
configuration and the M0 and M2 modules are disabled; the remaining bytes of RDI are sent over
subsequent 8-UI intervals such that M1 on the remote Link partner receives the least significant
bytes.

<table>
<caption>Figure 4-43. Example of Byte Mapping for Matching Module IDs</caption>
<tr>
<th rowspan="2"></th>
<th>Module Name</th>
<th colspan="2">M1</th>
<th colspan="2">MO</th>
<th colspan="2">M2</th>
<th colspan="2">M3</th>
</tr>
<tr>
<th>Data Bytes</th>
<th>RDI B16 -- -- RDI B31</th>
<th>RDI B16 -- -- RDI B31</th>
<th>RDI BO -- -- RDI B15</th>
<th>RDI BO -- -- RDI B15</th>
<th>RDI B32 -- -- RDI B47</th>
<th>RDI B32 -- -- RDI B47</th>
<th>RDI B48 -- -- RDI B63</th>
<th>RDI B48 -- -- RDI B63</th>
</tr>
<tr>
<td rowspan="5"></td>
<td>Tx/Rx</td>
<td>Rx (x16)</td>
<td>Tx (x16)</td>
<td>Rx (x16)</td>
<td>Tx (x16)</td>
<td>Rx (x16)</td>
<td>Tx (x16)</td>
<td>Rx (x16)</td>
<td>Tx (x16)</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Tx/Rx</td>
<td>Tx (x16)</td>
<td>Rx(x16)</td>
<td>Tx (x16)</td>
<td>Rx(x16)</td>
<td>Tx (x16)</td>
<td>$R x \left( \times 1 6 \right)$</td>
<td>Tx (x16)</td>
<td>$R \times \left( \times 1 6 \right)$</td>
</tr>
<tr>
<td>Data Bytes</td>
<td>RDI B16 -- -- RDI B31</td>
<td>RDI B16 -- -- RDI B31</td>
<td>RDI BO -- -- RDI B15</td>
<td>RDI BO -- -- RDI B15</td>
<td>RDI B32 RDI B47</td>
<td>RDI B32 -- -- RDI B47</td>
<td>RDI B48 -- -- RDI B63</td>
<td>RDI B48 -- -- RDI B63</td>
</tr>
<tr>
<td>Module Name</td>
<td colspan="2">M1</td>
<td colspan="2">MO</td>
<td colspan="2">M2</td>
<td colspan="2">M3</td>
</tr>
</table>

<table>
<caption>Figure 4-44. Example of Byte Mapping for Differing Module IDs</caption>
<tr>
<th rowspan="8"></th>
<th>Module Name</th>
<th colspan="2">$M 1$</th>
<th colspan="2">MO</th>
<th colspan="2">M2</th>
<th colspan="2">M3</th>
</tr>
<tr>
<th>Data Bytes</th>
<th>RDI B16 -- -- RDI B31</th>
<th>RDI B48 -- -- RDI B63</th>
<th>RDI BO -- -- RDI B15</th>
<th>RDI B32 RDI B47</th>
<th>RDI B32 -- -- RDI B47</th>
<th>RDI BO -- -- RDI B15</th>
<th>RDI B48 -- -- RDI B63</th>
<th>RDI B16 -- -- RDI B31</th>
</tr>
<tr>
<td>$T x / R x$</td>
<td>Rx (x16)</td>
<td>Tx (x16)</td>
<td>Rx (x16)</td>
<td>Tx (x16)</td>
<td>Rx (x16)</td>
<td>Tx (x16)</td>
<td>Rx (x16)</td>
<td>Tx (x16)</td>
</tr>
<tr>
<td></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>$T x / R x$</td>
<td>Tx (x16)</td>
<td>Rx(x16)</td>
<td>Tx (x16)</td>
<td>Rx(x16)</td>
<td>Tx (x16)</td>
<td>Rx(x16)</td>
<td>Tx (x16)</td>
<td>Rx(x16)</td>
</tr>
<tr>
<td>Data Bytes</td>
<td>RDI B16 -- -- RDI B31</td>
<td>RDI B48 -- -- RDI B63</td>
<td>RDI BO -- -- RDI B15</td>
<td>RDI B32 RDI B47</td>
<td>RDI B32 -- -- RDI B47</td>
<td>RDI BO -- -- RDI B15</td>
<td>RDI B48 -- -- RDI B63</td>
<td>RDI B16 -- -- RDI B31</td>
</tr>
<tr>
<td>Module Name</td>
<td colspan="2">M3</td>
<td colspan="2">M2</td>
<td colspan="2">MO</td>
<td colspan="2">M1</td>
</tr>
</table>

<table>
<caption>Figure 4-45. Example of Width Degradation with Byte Mapping for Differing Module IDs</caption>
<tr>
<th rowspan="9"></th>
<th>Module Name</th>
<th colspan="2">M1</th>
<th colspan="2">MO</th>
<th colspan="2">M2</th>
<th colspan="2">M3</th>
</tr>
<tr>
<th>Data Bytes UI 15-8</th>
<th>RDI B40 -- -- RDI B47</th>
<th>RDI B57 -- -- RDI B63</th>
<th>RDI B32 -- -- RDI B39</th>
<th>RDI B48 -- -- RDI B55</th>
<th>RDI B48 -- -- RDI B55</th>
<th>RDI B32 -- -- RDI B39</th>
<th>RDI B57 -- -- RDI B63</th>
<th>RDI B40 -- -- RDI B47</th>
</tr>
<tr>
<th>Data Bytes UI 7-0</th>
<th>RDI B8 -- -- RDI B15</th>
<th>RDI B24 -- -- RDI B31</th>
<th>RDI BO -- -- RDI B7</th>
<th>RDI B16 -- -- RDI B23</th>
<th>RDI B16 -- -- RDI B23</th>
<th>RDI BO -- -- RDI B7</th>
<th>RDI B24 -- -- RDI B31</th>
<th>RDI B8 -- -- RDI B15</th>
</tr>
<tr>
<td>Tx/Rx</td>
<td>Rx (x8)</td>
<td>Tx (x8)</td>
<td>Rx (x8)</td>
<td>Tx (x8)</td>
<td>Rx (x8)</td>
<td>$T \times \left( \times 8 \right)$</td>
<td>Rx (x8)</td>
<td>Tx (x8)</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>$T x / R x$</td>
<td>Tx (x8)</td>
<td>Rx(x8)</td>
<td>$T x \left( x 8 \right)$</td>
<td>Rx(x8)</td>
<td>$T x \left( x 8 \right)$</td>
<td>Rx(x8)</td>
<td>$T x \left( x 8 \right)$</td>
<td>Rx(x8)</td>
</tr>
<tr>
<td>Data Bytes UI 7-0</td>
<td>RDI B8 -- -- RDI B15</td>
<td>RDI B24 -- -- RDI B31</td>
<td>RDI BO -- -- RDI B7</td>
<td>RDI B16 -- -- RDI B23</td>
<td>RDI B16 -- -- RDI B23</td>
<td>RDI BO -- -- RDI B7</td>
<td>RDI B24 -- -- RDI B31</td>
<td>RDI B8 -- -- RDI B15</td>
</tr>
<tr>
<td>Data Bytes UI 15-8</td>
<td>RDI B40 -- -- RDI B47</td>
<td>RDI B57 -- -- RDI 63</td>
<td>RDI B32 -- -- RDI B39</td>
<td>RD B48 -- -- RDI B55</td>
<td>RDI B48 -- -- RDI B55</td>
<td>RDI B32 -- -- RDI B39</td>
<td>RDI B57 -- -- RDI B63</td>
<td>RDI B40 -- -- RDI B47</td>
</tr>
<tr>
<td>Module Name</td>
<td colspan="2">M3</td>
<td colspan="2">M2</td>
<td colspan="2">MO</td>
<td colspan="2">M1</td>
</tr>
</table>

<table>
<caption>Figure 4-46. Example of Byte Mapping with Module Disable</caption>
<tr>
<th rowspan="7"></th>
<th>Module Name</th>
<th colspan="2">M1</th>
<th colspan="2">$M O$</th>
<th colspan="2">M2</th>
<th colspan="2">M3</th>
</tr>
<tr>
<th>Data Bytes</th>
<th>RDI BO -- -- RDI B15</th>
<th>RDI B16 -- -- RDI B31</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th>RDI B16 -- -- RDI B31</th>
<th>RDI BO -- -- RDI B15</th>
</tr>
<tr>
<td>Tx/Rx</td>
<td>$R \times \left( \times 1 6 \right.$</td>
<td>$T x \left( x 1 6 \right)$</td>
<td>$R \times \left( \times 1 6 \right)$</td>
<td>$T \times \left( \times 1 6 \right)$</td>
<td>$R \times \left( \times 1 6 \right)$</td>
<td>$T \times \left( \times 1 6 \right)$</td>
<td>$R \times \left( \times 1 6 \right)$</td>
<td>$T \times \left( \times 1 6 \right.$</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td colspan="2">Disabled</td>
<td colspan="2">Disabled</td>
<td></td>
<td></td>
</tr>
<tr>
<td>$T x / R x$</td>
<td>Tx (x16)</td>
<td>Rx(x16)</td>
<td>Tx (x16)</td>
<td>Rx(x16)</td>
<td>Tx (x16)</td>
<td>Rx(x16)</td>
<td>Tx (x16)</td>
<td>Rx(x16)</td>
</tr>
<tr>
<td>Data Bytes</td>
<td>RDI BO -- -- RDI B15</td>
<td>RDI B16 -- -- RDI B31</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>RDI B16 -- -- RDI B31</td>
<td>RDI BO -- -- RDI B15</td>
</tr>
<tr>
<td>Module Name</td>
<td colspan="2">M3</td>
<td colspan="2">M2</td>
<td colspan="2">MO</td>
<td colspan="2">M1</td>
</tr>
</table>

Each module in a multi-module Link must operate at the same width and speed. During initialization
or retraining, if any module failed to train, the MMPL must ensure that the multi-module configuration
degrades to the next permitted configuration for width or speed degrade (see Figure 4-47 and
Figure 4-48). Subsequently, any differences in width and speed between the different modules must
be resolved using the following rules:

1\. For Standard package multi-module configuration, if width degrade is reported for any of the
modules:

a. If less than or equal to half the number of modules report width degrade at the current Link
speed, the corresponding Modules must be disabled. The MMPL must ensure that the multi-
module configuration degrades to the next permitted configuration for width or speed degrade
(see Figure 4-47 and Figure 4-48). For example, if three out of four modules are active, the
MMPL must degrade the Link to a two-module configuration.

b. If the majority of modules report width degrade at the current Link speed, see the pseudo code
below:

<figure>

CLS: Current Link Speed
CLS-1: Next lower allowed Link Speed

M is number of active Modules

Aggregate Raw BW (M, CLS) = Common Minimum Link width * M * CLS

If modules report Width degrade:
If CLS = 4 GT/s
Apply Width degrade for all modules
Else If Aggregate Raw BW (M, (CLS-1) ) > Aggregate raw BW (M/2, CLS) :
Attempt Speed Degrade

Else :

Apply Width degrade for all modules

</figure>

When a module has been width degraded before entering LINKSPEED, the Common Minimum Link
Width is the degraded width. When modules are reporting errors that indicate width degrade
during LINKSPEED, the Common Minimum Link width is the same as when it entered LINKSPEED.

2\. For Advanced or Standard package multi-module configuration, if any Module reports speed
difference, see the pseudo code below:

<figure>

IF modules report speed difference:
CMLS: Common Maximum Link Speed

HMLS: Highest Maximum Link Speed of next lower configuration
IF HMLS/2 > CMLS :

Modules degrade to next lower configuration

Else:

Speed for all modules degrades to CMLS

</figure>

Figure 4-47 and Figure 4-48 provide a consolidated view of the above two rules as a flow chart that
Advanced Package and Standard Package implementations, respectively, must follow. Note that the
"Yes" condition for HMLS/2 > CMLS question is there to cover the base case of 4 GT/s. In other words,
if some module(s) passed MBINIT but failed 4 GT/s in LinkSpeed, then the "Yes" arc will result in
module disable instead of TrainError (because CMLS will be 0 for that) and provide the opportunity to
remain operational at 4 GT/s for the modules that were still operational at 4 GT/s.

<figure>
<figcaption>Figure 4-47. Decision Flow Chart for Multi-module Advanced Package</figcaption>

LinkSpeed

1

Any enabled
module reporting
errors?

Speedidle

Repair

NO

LinkInit

Yes

Operational Modules
Transition to LINKINIT

equal { \text { less than or } }<br>{ \text { ato half modules } }
report error and
unrepairable and no speed
degrade possible

Modules with errors
$d i s a b l e d \quad t o \quad r e a c h \quad n e x t$
lower module count
configuration

Yes

1

Z
O

Yes

Yes

All Modules with
errors repairable?

Any modules with an
operational configuration?

TRAINERROR

No

Z
0

Some modules
will report speed
degrade

Speed degrade
all modules

HMLS/2 >
CMLS?

Modules reporting speed
$d e g r a d e \quad d i s a b l e d \quad t o \quad r e a c h$
next lower module count
configuration

No

Yes

</figure>

<figure>
<figcaption>Figure 4-48. Decision Flow Chart for Multi-module Standard Package</figcaption>

LinkSpeed

1

Any enabled
module reporting
errors?

Speedidle

Width
Degrade

$N O$

LINKINIT

Yes-

Operational Modules
Transition to
LINKINIT

Less than or equal to half
number of modules report error
and all modules with errors
report width degrade

Modules with errors
disabled to reach next
lower module count
configuration

Yes

1

Yes

$B W \left( M , \left( C L S - 1 \right) \right) >$
BW (M/2, CLS)?

More than half number of modules
report errors and all modules with
errors report width degrade

No

Yes

Any modules with an
operational configuration ?
No

TRAINERROR

+Yes

This arc implies at least one
module reported speed
degrade

Speed degrade
all operational
modules

Modules reporting speed
degrade disabled to reach
next lower module count
configuration

{ \text { HMLS/2 } }<br>{ \text { CMLS? } } >

No

Yes

</figure>

##### 4.7.1.1 Sideband Assignment and Retimer Credits for Multi-module Configurations

During Link initialization, training and retraining (see Section 4.5) certain sideband packets are sent
on individual module sideband interfaces. These include all the messages in Table 7-9 and Table 7-11,
and any vendor-defined messages that were defined as such.

Other sideband packets use a single sideband to send sideband packets. These include Register
Access packets (requests as well as completions), all the non-vendor defined messages in Table 7-8
and Table 7-10, and any vendor-defined messages that were defined as such. A device must send
these sideband packets on the sideband interface of the numerically least Module ID whose LTSM is
not in RESET or SBINIT. A packet sent on a given Module ID could be received on a different Module
ID on the sideband Receiver.

Similarly, Retimer credits are returned on the Valid signal of the numerically least Module ID whose
LTSM is in Active state. Credits sent on a given Module ID could be received on a different Module ID
on the remote Link partner.

##### 4.7.1.2 Examples of MMPL Synchronization

When a module is part of a multi-module UCIe Link, it performs individual training steps through
Step 2 of MBTRAIN.LINKSPEED independent of other modules using its own sideband Link. This is
true for both Link Initialization and Link Retraining. The common Link parameters exchanged in
MBINIT.PARAM are the same for all modules that are part of the multi-module Link (for example the
"Maximum Data Rate"). Thus, when in MBTRAIN.LINKSPEED, all modules of a multi-module Link are
operating at the same data rate.

The synchronization orchestration by MMPL occurs in the MBTRAIN.LINKSPEED state based on the
rules outlined in Section 4.7.1. Note that different modules of a multi-module Link could take a
different amount of time to finish the individual training steps to reach MBTRAIN.LINKSPEED. In the
unlikely scenario where the staggering is greater than 8 ms, this could cause a module waiting in

MBTRAIN.LINKSPEED to time out while waiting for other modules to finish. As outlined in
Section 4.5.3.4.12, after Step 2 of MBTRAIN.LINKSPEED has completed and PHY_IN_RETRAIN is not
set:

· If no errors are encountered for a module, an {MBTRAIN.LINKSPEED done req} is sent to the
remote Link partner module

· If errors are encountered for a module, an {MBTRAIN.LINKSPEED error req}/
{MBTRAIN.LINKSPEED error resp} handshake is performed followed by sending an
{MBTRAIN.LINKSPEED exit to repair req} or an {MBTRAIN.LINKSPEED exit to speed degrade req}
on that module's sideband.

The individual modules notify the MMPL of the sent and received information from these sideband
messages. MMPL collects this information from all the modules which are operational in the Link and
determines the next state based on resolution of the rules outlined in Section 4.7.1. Of course, the
case without errors is when all modules sent and received the {MBTRAIN.LINKSPEED done req}
message with no change to Link width. In this scenario, the MMPL directs them to proceed to Step 6
of MBTRAIN.LINKSPEED.

The following sections cover a few examples of this resolution for a Link with four modules and
Standard Package configuration where errors were encountered.

#### 4.7.1.2.1 Example 1: MMPL Resolution results in a Width Degrade per Module

In this example, the four modules of the UCIe Link are in MBTRAIN.LINKSPEED at 8 GT/s. Table 4-13
shows the exchanged messages for one die (in the case where errors are encountered, it is assumed
that the {MBTRAIN.LINKSPEED error req}/ {MBTRAIN.LINKSPEED error resp} has completed before
the messages shown). Because the resolution is consistent in using the sent and received messages,
both die of the Link will reach the same resolution.

<table>
<caption>Table 4-13. Messages exchanged that are used to determine resolution for Example 1</caption>
<tr>
<th>Module Identifier</th>
<th>Sent Message</th>
<th>Received Message</th>
</tr>
<tr>
<td>Module 0</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
</tr>
<tr>
<td>Module 1</td>
<td>{MBTRAIN.LINKSPEED exit to repair req}</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
</tr>
<tr>
<td>Module 2</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
<td>{MBTRAIN.LINKSPEED exit to repair req}</td>
</tr>
<tr>
<td>Module 3</td>
<td>{MBTRAIN.LINKSPEED exit to repair req}</td>
<td>{MBTRAIN.LINKSPEED exit to repair req}</td>
</tr>
</table>

In this example, 3 out of the 4 modules have either sent or received the {MBTRAIN.LINKSPEED exit
to repair req} message which indicate a width degrade for Standard Package configurations. The
value of "CLS" (Current Link Speed) is 8 GT/s, and the value of "CLS-1" is 4 GT/s. The value of ${ } ^ { 1 1 } M ^ { \prime \prime }$
(Number of Active Modules) is 4. Because BW (4 Links at 4 GT/s) is not greater than BW (2 Links at 8
GT/s), the flow chart in Figure 4-48 would result in the MMPL notifying all the modules to proceed
with a width degrade by moving to MBTRAIN.REPAIR as the next state (i.e., {MBTRAIN.LINKSPEED
exit to repair resp} will be sent on each Module). Note that "CLS" and "M" are re-computed using the
updated information every time the Link is MBTRAIN.LINKSPEED and there is a corresponding MMPL
resolution. Width degrade is applied per module following the steps in MBTRAIN.REPAIR for every
module in this UCIe Link. For the module where no errors were encountered, the transmitter is
permitted to pick either of Lanes 0 to 7 or Lanes 8 to 15 as the operational Lanes when transmitting
the {MBTRAIN.REPAIR apply degrade req} to the remote Link partner module. Following the exit from
MBTRAIN.REPAIR, the training continues through the substates of MBTRAIN and in the next iteration
of MBTRAIN.LINKSPEED, if no errors are encountered, MMPL will direct the modules to proceed to
Step 6 of MBTRAIN.LINKSPEED.

Note that this example is covering the case where errors occurred during the LINKSPEED state. If the
width of a module is already lower from the rest of the operational modules that are part of a multi-

module Link (e.g., if a module had degraded width during MBINIT.REPAIRMB itself), it may have sent
and received {MBTRAIN.LINKSPEED done req} during LINKSPEED. However, from a MMPL resolution
perspective, MMPL must treat this as a Module reporting errors requiring width degrade. This is
because a multi-module Link requires all modules to operate at the same width and speed.

#### 4.7.1.2.2 Example 2: MMPL Resolution results in a Speed Degrade

In this example, the four modules of the UCIe Link are in MBTRAIN.LINKSPEED at 16 GT/s. Table 4-14
shows the exchanged messages for one die (in the case where errors are encountered, it is assumed
that the {MBTRAIN.LINKSPEED error req}/ {MBTRAIN.LINKSPEED error resp} has completed before
the messages shown). Because the resolution is consistent in using the sent and received messages,
both die of the Link will reach the same resolution.

<table>
<caption>Table 4-14. Messages exchanged that are used to determine resolution for Example 2</caption>
<tr>
<th>Module Identifier</th>
<th>Sent Message</th>
<th>Received Message</th>
</tr>
<tr>
<td>Module 0</td>
<td>{MBTRAIN.LINKSPEED exit to repair req}</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
</tr>
<tr>
<td>Module 1</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
</tr>
<tr>
<td>Module 2</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
</tr>
<tr>
<td>Module 3</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
<td>{MBTRAIN.LINKSPEED exit to speed degrade req}</td>
</tr>
</table>

In this example, Module 3 has received a message indicating that the remote partner wants to speed
degrade. "CMLS" always maps to the next degraded Link speed and so in this case "CMLS" is 12 GT/s.
"HMLS" always ends up mapping to current Link speed and so in this case it is 16 GT/s. Because
Module 3 received a speed degrade request, following the flow chart in Figure 4-48, this would result
in MMPL notifying all the modules to proceed with a speed degrade by moving to
MBTRAIN.SPEEDIDLE (i.e. {MBTRAIN.LINKSPEED exit to speed degrade resp} will be sent on each
Module). Following the exit from MBTRAIN.SPEEDIDLE, the training continues through the substates
of MBTRAIN and in the next iteration of MBTRAIN.LINKSPEED, if no errors are encountered, MMPL will
direct the modules to proceed to Step 6 of MBTRAIN.LINKSPEED. Note that "CMLS" and "HMLS" are
using the updated information every time the Link is MBTRAIN.LINKSPEED and there is a
corresponding MMPL resolution. In this example, for the next iteration, CMLS will be 8 GT/s and HMLS
will be 12 GT/s.

#### 4.7.1.2.3 Example 3: MMPL Resolution results in a Module Disable

In this example, the four modules of the UCIe Link are in MBTRAIN. LINKSPEED at 16 GT/s. Table 4-15
shows the exchanged messages for one die (in the case where errors are encountered, it is assumed
that the {MBTRAIN.LINKSPEED error req}/ {MBTRAIN.LINKSPEED error resp} has completed before
the messages shown). Because the resolution is consistent in using the sent and received messages,
both die of the Link will reach the same resolution.

<table>
<caption>Table 4-15. Messages exchanged that are used to determine resolution for Example 3</caption>
<tr>
<th>Module Identifier</th>
<th>Sent Message</th>
<th>Received Message</th>
</tr>
<tr>
<td>Module 0</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
</tr>
<tr>
<td>Module 1</td>
<td>{MBTRAIN.LINKSPEED exit to repair req}</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
</tr>
<tr>
<td>Module 2</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
</tr>
<tr>
<td>Module 3</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
<td>{MBTRAIN.LINKSPEED done req}</td>
</tr>
</table>

Because less than half of the modules are reporting errors and requesting a width degrade, as per the
flow chart in Figure 4-48, MMPL would take the configuration to a two module configuration. As per
the rules in Section 5.7.3.4.1, Module 0 and Module 1 would send the {MBTRAIN.LINKSPEED multi-

module disable module resp} to take these modules to TRAINERROR and RESET. Module 2 and
Module 3 would send the {MBTRAIN.LINKSPEED done resp} to take them to LINKINIT.

### 4.7.2 Multi-module Interoperability between x64 and x32 Advanced Packages

MMPL is responsible for the appropriate byte swizzling and width adjustment when a multi-module
x64 Advanced Package module is connected to a corresponding multi-module x32 Advanced Package
module. All the modules in a multi-module configuration must be of the same type (in this context, all
the modules within a multi-module set must be x64 Advanced or x32 Advanced). All the rules related
to module naming conventions and disabled configurations apply to x32 Advanced Package Modules
as well.

One example of interoperation between UCIe-A x64 and UCIe-A x32 is when the UCIe-A x64 Stack
(including RDI and FDI maximum throughput) is bandwidth-matched (Full Width Mode) by the remote
Link partner's maximum throughput for a given interface. Figure 4-49 shows an example of two x64
modules that are capable of operating as two independent UCIe stacks with independent Adapters
and Protocol Layers (bypass MMPL logic in configuration (a) in Figure 4-49) and is also capable of
operating as a multi-module configuration when connected to a corresponding multi-module
configuration of x32 Advanced Package to achieve the equivalent bandwidth of a single x64 module
(configuration (b) in Figure 4-49). In the latter configuration, one of the Adapters (shown in gray) is
disabled.

Software and firmware are permitted to use UCIe DVSEC Link Capability and Control registers to
determine within which configuration to train the link.

Figure 4-49. Implementation Example Showing Two Different Operating Modes
of the Same Hardware Implementation

<table>
<tr>
<th>Physical Layer (x64 module)</th>
<th>Physical Layer (x64 module)</th>
</tr>
<tr>
<td>AFE</td>
<td>$\mathrm { A F E }$</td>
</tr>
</table>

<figure>

Die-to-Die
Adapter

Die-to-Die
Adapter

Die-to-Die
Adapter

Die-to-Die
Adapter

RDI

RDI

Multi-module PHY Logic
(two x64 modules operating in x32 mode)

Module 0 AFE/PHY Logic

Module 1 AFE/PHY Logic

Two D2D stacks $e n a b l e d ;$ MMPL bypassed and each stack uses
one module and operates in Full Width mode
For each stack.

Only one D2D stack enabled; Uses MMPL with two modules and
operates in Full Width mode

(a)

(b)

</figure>

<table>
<tr>
<th rowspan="2">UCIe Link DVSEC Capability Register</th>
<th>Max Link Width</th>
<th>×64</th>
</tr>
<tr>
<td>APMW</td>
<td>0</td>
</tr>
<tr>
<td>Link Training Parameter</td>
<td>UCIe-A x32</td>
<td>0</td>
</tr>
</table>

<table>
<tr>
<th rowspan="2">UCIe Link DVSEC Capability Register</th>
<th>Max Link Width</th>
<th>×64</th>
</tr>
<tr>
<th>APMW</th>
<th>1</th>
</tr>
<tr>
<td>Link Training Parameter</td>
<td>UCIe-A x32</td>
<td>1</td>
</tr>
</table>

Another example of interoperation between UCIe-A x64 and UCIe-A x32 is when the UCIe-A x64
Stack degrades bandwidth (Degraded Width Mode) to match the remote Link partner's maximum
throughput. Figure 4-50 shows an example of RDI byte-to-module assignments for a four-module set
of x64 Advanced Package modules interoperating with a four-module set of x32 Advanced Package
modules. The example is for a 256B RDI width on the x64 set, and a 128B RDI on the x32 set. On the
Transmitter side of x64 modules, the MMPL throttles RDI, as required, because the MMPL can only
send half the bytes over 8 UI; and on the Receiver side, the MMPL accumulates 16 UI worth of data
before forwarding it over RDI (assumes data transfers are in chunks of 256B OR appropriate pause of
data stream indications are applied and detected by MMPLs/Adapters within the data stream).

<table>
<caption>Figure 4-50. RDI Byte-to-Module Assignment Example for $x 6 4$ Interop with $x 3 2$</caption>
<tr>
<th colspan="10"></th>
</tr>
<tr>
<th></th>
<th></th>
<th colspan="2">M1</th>
<th colspan="2">MO</th>
<th colspan="2">M2</th>
<th colspan="2">M3</th>
</tr>
<tr>
<td rowspan="8"></td>
<td>$U I \quad 8 \quad - \quad 1 5$</td>
<td>RDI B160 -- -- RDI B191</td>
<td>RDI B224 -- -- RDI B255</td>
<td>RDI B128 -- -- RDI B159</td>
<td>RDI B192 -- -- RDI B223</td>
<td>RDI B192 -- -- RDI B223</td>
<td>RDI B128 -- -- RDI B159</td>
<td>RDI B224 -- -- RDI B255</td>
<td>RDI B160 -- -- RDI B191</td>
</tr>
<tr>
<td>UI 0 - 7</td>
<td>RDI B32 -- -- RDI B63</td>
<td>RDI B96 -- -- RDI B127</td>
<td>RDI BO -- -- RDI B31</td>
<td>RDI B64 -- -- RDI B95</td>
<td>RDI B64 -- -- RDI B95</td>
<td>RDI BO -- -- RDI B31</td>
<td>RDI B96 -- -- RDI B127</td>
<td>RDI B32 -- -- RDI B63</td>
</tr>
<tr>
<td rowspan="3"></td>
<td>$R \times \left( \times 3 2 \right)$</td>
<td>Tx (x32)</td>
<td>Rx (x32)</td>
<td>Tx (x32)</td>
<td>Rx (x32)</td>
<td>$T x \left( x 3 2 \right)$</td>
<td>Rx (x32)</td>
<td>Tx (x32)</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Tx (x64)</td>
<td>Rx(x64)</td>
<td>Tx (x64)</td>
<td>Rx(x64)</td>
<td>Tx (x64)</td>
<td>Rx(x64)</td>
<td>Tx (x64)</td>
<td>Rx(x64)</td>
</tr>
<tr>
<td>$U I \quad 0 \quad - \quad 7$</td>
<td>RDI B32 -- -- RDI B63</td>
<td>RDI B96 -- -- RDI B127</td>
<td>RDI BO -- -- RDI B31</td>
<td>RDI B64 -- -- RDI B95</td>
<td>RDI B64 -- -- RDI B95</td>
<td>RDI BO -- -- RDI B31</td>
<td>RDI B96 -- -- RDI B127</td>
<td>RDI B32 -- -- RDI B63</td>
</tr>
<tr>
<td>$U I \quad 8 \quad - \quad 1 5$</td>
<td>RDI B160 -- -- RDI B191</td>
<td>RDI B224 RDI B255</td>
<td>RDI B128 -- -- RDI B159</td>
<td>RDI B192 -- -- RDI B223</td>
<td>RDI B192 -- -- RDI B223</td>
<td>RDI B128 -- -- RDI B159</td>
<td>RDI B224 -- -- RDI B255</td>
<td>RDI B160 -- -- RDI B191</td>
</tr>
<tr>
<td></td>
<td colspan="2">M3</td>
<td colspan="2">M2</td>
<td colspan="2">MO</td>
<td colspan="2">M1</td>
</tr>
</table>

For the example shown in Figure 4-50, a single Adapter is operating with all four Modules. The D2D
stack uses MMPL with 4 modules, with each of the x64 modules operating in Degraded Width Mode,
and only 32 lanes routed per module. The corresponding values in the capability register and Link
Training parameter are as listed in Table 4-16.

<table>
<caption>Table 4-16. Capability Register and Link Training Parameter Values for RDI Byte-to-Module Assignment Example for x64 Interop with $x 3 2$</caption>
<tr>
<td rowspan="2">UCIe Link DVSEC Capability Register</td>
<td>Max Link Width</td>
<td>$\times 1 2 8$</td>
</tr>
<tr>
<td>APMW</td>
<td>1</td>
</tr>
<tr>
<td>Link Training Parameter</td>
<td>UCIe-A x32</td>
<td>1</td>
</tr>
</table>

See Section 5.7.2.4 for comprehensive rules of interoperation between x64 and x32 Advanced
Package modules.

### 4.8 Sideband PHY Arbitration between MPMs and Link Management Packets

While the exact arbitration policy is implementation specific, care should be taken to avoid delaying
transmitting any pending link management packets for extended lengths of time potentially causing
timeouts. See Section 8.2.5.1.2 for length restriction on MPMs with Data that allows for PHY
arbitration to provide an upper bound on the amount of delay to send a link management packet or a
higher-priority MPM packet that might be waiting behind an MPM with Data packet. Additionally, PHY
transmitter must fully complete transmission of an MPM with Data within 512 UI max (when Sideband
Performant Mode Operation is negotiated) and 768 UI max (when Sideband Performant Mode

Operation is not negotiated). See Section 4.1.5 for details of sideband transmission UI notation. See
Section 4.1.5.1 for Performant Mode Operation (PMO) details.

Figure 4-51 and Figure 4-52 show the arbitration at the PHY.

<figure>
<figcaption>Figure 4-51. Example of Encapsulated MTPs Transmitted on Sideband Link without Sideband PMO</figcaption>

1 Encapsulated MTP with
maximum payload length of
7 QWORDs sent over 768 UI

A "Link Management" packet can be sent
here by arbiter, if pending, or another
Encapsulated MTP can start here

Encapsulated
$\mathrm { M T P }$ Header

IDLE

Encapsulated
MTP Payload

IDLE

Encapsulated
MTP Header

64 UI

32 UI

64 UI

32 UI

64 UI

Time

</figure>

<figure>
<figcaption>Figure 4-52. Example of a Large Management Packet Split into Two Encapsulated MTPs, with No Segmentation, No Sideband PMO, and with Two Link Management Packets between the Two Encapsulated MTPs</figcaption>

1st Encapsulated MTP from a large
Management Packet

2nd Encapsulated MTP from the same
large Management Packet starts here ...

Link Management Msg without Data

Link Management Msg with Data

Encapsulated
MTP Header

IDLE

Encapsulated
MTP Payload
QWORD 0

IDLE

Encapsulated
MTP Payload
QWORD 6

IDLE

Link Mgmt
Msg
Header

IDLE

Link Mgmt
MsgD
Header

IDLE

Link Mgmt
MsgD
Payload

IDLE

Encapsulated
MTP Header

IDLE

64 UI

32 UI

64 UI

32 UH

64 UI

32 UH

64 UI

32 UH

64 UI

32 UI

64 UI

32 UH

64 UI

32 UH

Time

</figure>

### 5.0 Electrical Layer (2D and 2.5D)

Key attributes of electrical specification include:

· Support for 4, 8, 12, 16, 24, 32, 48, and 64 GT/s data rates

· Support for Advanced and Standard package interconnects

· Support for clock and power gating mechanisms

· Single-ended unidirectional data signaling

· DC coupled point-to-point interconnect

· Forwarded clock for transmit jitter tracking

· Matched length interconnect design within a module

· For Advanced Package:

\- Tx driver strength control

\- Unterminated Rx for up to 32 GT/s

\- Terminated Rx for 48 GT/s and 64 GT/s

. Tx termination and data rate and channel reach dependent Rx termination for Standard Package

#### 5.1 Interoperability

##### 5.1.1 Data rates

A device must support 4 GT/s and all the data rates data rates between 4 GT/s and the highest
supported data rate. For example, a device supporting 16 GT/s must also support 4, 8, and 12 GT/s
data rates. References to data rates refer to the current operating speed unless the negotiated
maximum data rate is specifically mentioned.

Spread-Spectrum Clocking (SSC) is permitted. Common reference clock (REFCLK) is required
between a UCIe Link Transmitter and the corresponding UCIe Link partner's Receiver with a transport
delay difference less than 5 ns to limit the FIFO depth and minimize the latency impact. For the
retimer use case, the "Local UCIe Link connection" shall use common REFCLK, while the "Off-Package
Link connection" is not required to use or share the common REFCLK. Figure 5-1 shows the transport
delay difference and is symmetrical for both directions of a Die's UCIe Link connection. The transport
delay represents the delay difference between the Transmitter data to the Receiver data latch and the
clock as seen at the receiver's FIFO output data latch. See Section 5.1.2 for REFCLK details.

<figure>
<figcaption>Figure 5-1. Example Common Reference Clock</figcaption>

$D i e - 1$

Die-2

Data

TX Flop

$R x \quad F l o p + F I F O$

Clock
Phase

TXCK

RXCK

$T _ { 1 }$

$T = | T _ { 1 } - T _ { 2 } |$

$T _ { 2 }$

TX PLL

Ref
Clock

RX PLL

</figure>

# IMPLEMENTATION NOTE

In typical implementations, the LCLK for UCIe Link Transmitter and LCLK for the
corresponding link partner Receiver, are both generated from the common reference
clock. In the example implementation of Figure 5-1, the LCLK for Transmitter in Die-1
can be generated from TX PLL and the LCLK for Receiver in Die-2 can be generated
from the RX PLL.

## 5.1.2 Reference Clock (REFCLK)

Common reference clock (REFCLK) uses a single source that is distributed to both the Transmitter and
the Receiver. The clock can be supplied from a package pin or be forwarded by another die on the
package. In either case, the reference clock used by both dies on the same link must be from the
same clock source. Although other reference clocks are possible, it is recommended that every chiplet
use a 100-MHz reference clock, including both dies having different reference clock values from the
same clock source. Table 5-1 lists the permitted reference clock frequency range. The minimum and
maximum frequencies listed in the table indicate the limits, and do not indicate a requirement to
support the entire frequency range. It is required for implementations to generate precise I/O clock
frequencies for the supported data rates that use the reference clock. Note that this is possible if the
I/O clock frequency is an exact integer multiple of the reference clock frequency (if different from 100
MHz). The reference clock may be disabled in low-power states (such as is done in other Standards
and Specifications).

<table>
<caption>Table 5-1. REFCLK Frequency PPMs and SSC PPMs (Sheet 1 of 2)</caption>
<tr>
<th rowspan="2">Symbol</th>
<th rowspan="2">Description</th>
<th colspan="3">Limits</th>
<th rowspan="2">Unit</th>
<th rowspan="2">Notes</th>
</tr>
<tr>
<th>Min</th>
<th>Rec</th>
<th>Max</th>
</tr>
<tr>
<td>$\mathrm { F } _ { \mathrm { R E F C L K } }$</td>
<td>REFCLK Frequency</td>
<td>25</td>
<td>100</td>
<td>200</td>
<td>MHz</td>
<td></td>
</tr>
<tr>
<td>FREFCLKDEVIATION</td>
<td>REFCLK Frequency Deviation</td>
<td>-300</td>
<td></td>
<td>300</td>
<td>ppm</td>
<td>Maximum deviation allowed from ideal target frequency.</td>
</tr>
<tr>
<td>$\mathrm { F s s c }$</td>
<td>SSC Modulation Frequency</td>
<td>30</td>
<td></td>
<td>33</td>
<td>kHz</td>
<td></td>
</tr>
</table>

<table>
<caption>Table 5-1. REFCLK Frequency PPMs and SSC PPMs (Sheet 2 of 2)</caption>
<tr>
<th rowspan="2">Symbol</th>
<th rowspan="2">Description</th>
<th colspan="3">Limits</th>
<th rowspan="2">Unit</th>
<th rowspan="2">Notes</th>
</tr>
<tr>
<th>Min</th>
<th>Rec</th>
<th>Max</th>
</tr>
<tr>
<td>TSSC-FREQ-DEVIATION</td>
<td>SSC Deviation</td>
<td>-0.5</td>
<td></td>
<td>0</td>
<td>%</td>
<td>Tracks for different frequencies.</td>
</tr>
<tr>
<td>TTRANSPORT-DELAY</td>
<td>Tx-to-Rx Transport Delay</td>
<td></td>
<td></td>
<td>5</td>
<td>ns</td>
<td></td>
</tr>
<tr>
<td>TSSC-MAX-FREQ-SLEW</td>
<td>SSC df/dt</td>
<td></td>
<td></td>
<td>1250</td>
<td>ppm/us</td>
<td></td>
</tr>
</table>

### 5.2 Overview

#### 5.2.1 Interface Overview

High-level block diagrams of UCIe PHY are shown in Figure 5-2 and Figure 5-3. The UCIe physical
interface consists of building blocks called Modules. A Module that uses advanced packaging
technology (e.g., EMIB, CoWoS) called "Advanced Package Module" consists of a pair of clocks, 64 or
32 single-ended data Lanes for x64 or x32 Advanced Package Module, respectively, a data valid Lane
each direction (transmit and receive) and a Track Lane. There is a low-speed sideband bus for
initialization, Link training, and configuration reads/writes. The sideband consists of a single-ended
sideband data Lane and single-ended sideband clock Lane in both directions (transmit and receive).

The x16 or x8 "Standard Package Module" uses a traditional Standard packaging with larger pitch. A
Standard Package Module consists of a pair of clocks, 16 or 8 single-ended data Lanes, a data valid
Lane and Track Lane in each direction (transmit and receive). There is a low-speed sideband bus for
initialization, Link training, and configuration reads/writes. The sideband consists of a single-ended
sideband data Lane and single-ended sideband clock Lane in both directions (transmit and receive).

For some applications, multiple modules (2 or 4) can be aggregated to deliver additional bandwidth.

To avoid reliability issues, it is recommended to limit the Transmitter output high $\left( V _ { O H } \right)$ to a maximum
of 100 mV above the receiving chiplet's Receiver front-end circuit power supply rail. An over-stress
protection circuit may be implemented in the Receiver when $\mathrm { V } _ { O H }$ is more than 100 mV above the
Receiver power supply rail.

<figure>
<figcaption>Figure 5-2. x64 or x32 Advanced Package Module</figcaption>

Multi-die Advanced Package Module

$D i e - 1$

Mainband

$D i e - 2$

x64/x32 Data

2 Clock

1 Valid

1 Track

R
R

T

T

R

x
☒

x
☒

x64/x32 Data

x

x

Module

2 Clock

Module

1 Valid

1 Track

SB Data

R

T

SB Clock

T
R

☒
x

x
☒

SB Data

x

x

SB Clock

Sideband

</figure>

<figure>
<figcaption>Figure 5-3. x16 or x8 Standard Package Module</figcaption>

Multi-die Standard Package Module

Die-1

Mainband

Die-2

x16/x8 Data.

2 Clock

1 Valid

1 Track

R

T

T

R

x
☒

$X$
☒

☒

x16/x8 Data

x
☒

x

Module

2 Clock

Module

1 Valid

1 Track

SB Data

R

T

SB Clock

T
R

x
☒

$X$
☒

SB Data

x

x

SB Clock

Sideband

</figure>

#### 5.2.2 Electrical Summary

Table 5-2 defines the PHY electrical characteristics of a UCIe device <= to 32 GT/s. Table 5-3 defines
the PHY electrical characteristics of a UCIe device > 32 GT/s.

<table>
<caption>Table 5-2. Electrical Summary for 4 $\mathrm { G T } / \mathrm { s }$ to 32 GT/s</caption>
<tr>
<th>Parameter</th>
<th colspan="3">Advanced Package (x64)</th>
<th colspan="4">Standard Package</th>
</tr>
<tr>
<td>Data Width (per module)</td>
<td>64</td>
<td>64</td>
<td>64</td>
<td>16</td>
<td>16</td>
<td>16</td>
<td>16</td>
</tr>
<tr>
<td>Data Rate (GT/s)</td>
<td>$4 / 8 / 1 2$</td>
<td>16</td>
<td>$2 4 / 3 2$</td>
<td>4-16</td>
<td>$4 / 8 / 1 2$</td>
<td>16</td>
<td>$2 4 / 3 2$</td>
</tr>
<tr>
<td>$P o w e r \quad E f f i c i e n c y \quad T a r g e t \left( p J / b \right)$</td>
<td colspan="2">See Table 1-4</td>
<td colspan="5"></td>
</tr>
<tr>
<td>\text { Latency Target } \left( T x + R x \right) \left( U I \right) ^ { a }<br>\text { \left(Target upper bound\right) }</td>
<td>12</td>
<td>12</td>
<td>16</td>
<td>12</td>
<td>12</td>
<td>12</td>
<td>16</td>
</tr>
<tr>
<td>$I d l e \quad E x i t / E n t r y \quad L a t e n c y \left( n s \right)$ (Target upper bound)</td>
<td>0.5</td>
<td>1</td>
<td>1</td>
<td>0.5</td>
<td>0.5</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>Idle Power (% of peak power) (Target upper bound)</td>
<td>15</td>
<td>15</td>
<td>15</td>
<td>15</td>
<td>15</td>
<td>15</td>
<td>15</td>
</tr>
<tr>
<td>Channel Reach (mm)</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2-10</td>
<td>25</td>
<td>25</td>
<td>25</td>
</tr>
<tr>
<td>Die Edge Bandwidth Density (GB/s/mm)b</td>
<td colspan="7">See Table 1-4</td>
</tr>
<tr>
<td>Bandwidth area density (GB/s/mm2)</td>
<td>$1 5 8 / 3 1 6 / 4 7 3$</td>
<td>631</td>
<td>710/947</td>
<td>21-85</td>
<td>21/42/64</td>
<td>85</td>
<td>$1 0 9 / 1 4 5$</td>
</tr>
<tr>
<td>PHY dimension width per module (um)c</td>
<td>388.8</td>
<td>388.8</td>
<td>388.8</td>
<td>$5 7 1 . 5$</td>
<td>571.5ª</td>
<td>571.5ª</td>
<td>571.5ª</td>
</tr>
<tr>
<td>$\left( u m \right) ^ { e }$</td>
<td>1043</td>
<td>1043</td>
<td>1225</td>
<td>1320</td>
<td>1320</td>
<td>1320</td>
<td>1540</td>
</tr>
<tr>
<td>ESDf</td>
<td colspan="7">30-V CDM (Anticipating going $\left. t o \quad 5 - 1 0 \quad V \quad i n \quad f u t u r e . \right)$</td>
</tr>
</table>

a. Electrical PHY latency target. For overall latency target, see Table 1-4.

b. See Table 1-4.

c. For compatibility, PHY dimension width must match spec for Advanced Package. Tolerance of PHY dimension width for Standard
Package can be higher because there is more routing flexibility. For best channel performance, it's recommended for width to
be close to spec.

d. Standard Package PHY dimension width is the effective width of one (x16) module based on x32 interface (see Figure 5-46 and
Figure 5-47).

e. PHY dimension depth is an informative parameter and depends on bump pitch. Number in the table is based on 45-um bump
pitch for 10-column x64 Advanced Package and 100-um bump pitch for Standard Package. See Section 5.7.2 for informative
values of PHY dimension depth for combinations of the x64 and x32 Advanced Package modules in 10-column, 16-column, and
8-column bump matrix construction. Different variants of bump map that are deeper are required at high data rates.

f. Reference (Industry Council on ESD Target Levels): White Paper 2: A Case for Lowering Component-level CDM ESD
Specifications and Requirements.

<table>
<caption>Table 5-3. Electrical Summary for 48 GT/s and 64 GT/s</caption>
<tr>
<th>Parameter</th>
<th colspan="2">Advanced Package (x64)</th>
<th colspan="2">Standard Package</th>
</tr>
<tr>
<td>Data Width (per module)</td>
<td>64</td>
<td>64</td>
<td>16</td>
<td></td>
</tr>
<tr>
<td>Data Rate $\left( G T / s \right)$</td>
<td>48</td>
<td>$6 4$</td>
<td>48</td>
<td>$\frac { 1 6 } { 6 4 }$</td>
</tr>
<tr>
<td>Power Efficiency Target (pJ/b)</td>
<td colspan="2">$S e e \quad T a b l e \quad 1 - 4$</td>
<td colspan="2"></td>
</tr>
<tr>
<td>{ \text { Latency Target } \left( T x + R x \right) \left( U I \right) ^ { 6 } }<br>{ \text { \left(Target upper bound\right) } }</td>
<td>24</td>
<td>32</td>
<td>24</td>
<td>32</td>
</tr>
<tr>
<td>{ \text { Idle Exit/Entry Latency } \left( n s \right) }<br>{ \text { \left(Taraet upoer bound\right) } }</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>$\mathrm { I d l e } \mathrm { P o w e r b }$ (% of peak power) (Target upper bound)</td>
<td>20</td>
<td>20</td>
<td>25</td>
<td>25</td>
</tr>
<tr>
<td>Channel Reach (mm)</td>
<td>2</td>
<td>2</td>
<td>25</td>
<td>$2 5$</td>
</tr>
<tr>
<td>{ \text { Die Edge Bandwidth Density } }<br>{ \left( G B / s / m m \right) ^ { a } }</td>
<td colspan="4">See Table 1-4</td>
</tr>
<tr>
<td>{ \text { Bandwidth area density } }<br>{ \left( G B / s / m m ^ { 2 } \right) } $\left( G B / s / m m ^ { 2 } \right)$</td>
<td>1235</td>
<td>1646</td>
<td>144</td>
<td>$1 9 2$</td>
</tr>
<tr>
<td>$P H Y \quad d i m e n s i o n \quad w i d t h \quad p e r$</td>
<td>388.8</td>
<td>388.8</td>
<td>$6 9 1 . 2 ^ { 6 }$</td>
<td>$6 9 1 . 2 ^ { 8 }$</td>
</tr>
<tr>
<td>PHY dimension Depth (um)ª</td>
<td>1600</td>
<td>1600</td>
<td>1925</td>
<td>1925</td>
</tr>
<tr>
<td>ESDª</td>
<td colspan="4">30-V CDM (Anticipating going to 5-10 V in future.)</td>
</tr>
</table>

a. Parameter definition is the same as in Table 5-2.

b. At data rates > 32 GT/s, only continuous forwarded clock is supported, which results in higher idle power. The impact of
continuous forwarded clock is larger for Standard Packages due to fewer data lanes.

# IMPLEMENTATION NOTE

If an application requires it, the system designer can control the data rate by
adjusting the REFCLK supplied to the PLLs or by adjusting the PLL divider ratio in the
UCIe IP (see Table 5-4 for the range of values). The REFCLK must be stable before
initiating link training. Changes to REFCLK frequency should only be made when the
link is down.

Additionally, the frequency-adjusted REFCLK may be used in place of AUXCLK (see
Section 5.13.2 for AUXCLK details) as the source for the sideband clock. In this
situation, the sideband data rates range from 400 MT/s to 800 MT/s and must be the
same in both directions. Sideband timeouts will be scaled accordingly, ranging from
8 ms at 800 MT/s to 16 ms at 400 MT/s.

Compliance testing will only be conducted at the UCIe data rates specified in the Link
Speed Setting column of Table 5-4, as supported by the UCIe IP.

<table>
<caption>Table 5-4. Operating Data Rate Ranges for UCIe Link Speed Settings</caption>
<tr>
<th rowspan="2">Link Speed Setting</th>
<th colspan="2">Adjusted Operating Speed</th>
</tr>
<tr>
<th>Min</th>
<th>Max</th>
</tr>
<tr>
<td>4 GT/s</td>
<td>2 GT/s</td>
<td>4 GT/s</td>
</tr>
<tr>
<td>8 GT/s</td>
<td>4 GT/s</td>
<td>8 GT/s</td>
</tr>
<tr>
<td>12 GT/s</td>
<td>8 GT/s</td>
<td>12 GT/s</td>
</tr>
<tr>
<td>16 GT/s</td>
<td>12 GT/s</td>
<td>16 GT/s</td>
</tr>
<tr>
<td>24 GT/s</td>
<td>16 GT/s</td>
<td>24 GT/s</td>
</tr>
<tr>
<td>32 GT/s</td>
<td>24 GT/s</td>
<td>32 GT/s</td>
</tr>
<tr>
<td>48 GT/s</td>
<td>32 GT/s</td>
<td>48 GT/s</td>
</tr>
<tr>
<td>64 GT/s</td>
<td>48 GT/s</td>
<td>64 GT/s</td>
</tr>
</table>

## 5.3 Transmitter Specification

The Transmitter topology is shown in Figure 5-4. Each data module consists of N single-ended data
Transmitters plus a Valid signal. N is 68 (64 Data + 4 Redundant Data) for a x64 Advanced Package
Module. N is 34 (32 Data + 2 Redundant Data) for a x32 Advanced Package Module. N is 16 for $a \times 1 6$
Standard Package Module. N is 8 for a x8 Standard Package Module. There is a pair of Transmitters for
clocking and a Track signal in each module. The clock rates and phases are discussed in detail in
Section 5.5.

<figure>
<figcaption>Figure 5-4. Transmitter</figcaption>

$N$

$N$

$D a t a + V a l i d$

Data In

FIFO

Serializer

TXD

0

/N

Phase-1

Deskew

0

PI

TXCK

0

Clock

PLL

DLL

\+

Phase-2

CK

DCC

Buf

fCK

Track

$T X D$

0

</figure>

The Valid signal is used to gate the clock distribution to all data Lanes to enable fast idle exit and
entry. The signal also serves the purpose of Valid framing, see Section 4.1.2 for details. The
Transmitter implementation for Valid signal is expected to be the same as for regular Data.

The Track signal can be used for PHY to compensate for slow-changing variables such as voltage or
temperature. Track is a unidirectional signal similar to a data bit. The UCIe Module sends a clock
pattern (1010 ... ) aligned with Phase-1 of the forwarded clock signal on its Track Transmitter when
requested over the sideband by the UCIe Module Partner for its Track Receiver. See Section 4.6 for
more details on Runtime Recalibration steps and Section 5.5.1 for Track usage.

### 5.3.1 Driver Topology

The Transmitter is optimized for simplicity and low power operation. An example of a low power
Transmitter driver is shown in Figure 5-5. Separate pull-up and pull-down network strengths are
permitted to achieve optimal performance across different channel configurations.

A control loop or training is recommended to adjust output impedance to compensate for the process,
voltage and temperature variations. Control loop and training are implementation specific and beyond
the scope of this specification. In low power states, the implementation must be capable of tri-stating
the output.

It is recommended to optimize the ESD network to minimize pad capacitance. Inductive peaking
technique such as T-coil may be needed at higher data rates.

<figure>
<figcaption>Figure 5-5. Transmitter driver example circuit</figcaption>

VCCIO

$M _ { 1 }$

Pre-
Driver

$R _ { s }$

Data

☒
Pad

$R _ { s }$

ESD
Network

$M _ { 2 }$

Segmented Driver

</figure>

### 5.3.2 Transmitter Electrical parameters

<table>
<caption>Table 5-5 defines the Transmitter electrical parameters. Table 5-5. Transmitter Electrical Parameters (Sheet 1 of 2)</caption>
<tr>
<th>Parameter</th>
<th>Min</th>
<th>Typ</th>
<th>Max</th>
<th>Unit</th>
</tr>
<tr>
<td>Data Lane Tx Swinga</td>
<td>0.4</td>
<td></td>
<td></td>
<td>$V$</td>
</tr>
<tr>
<td>Fwd Clock Tx Swing (single ended)</td>
<td>0.4</td>
<td></td>
<td></td>
<td>V</td>
</tr>
<tr>
<td>Incoming Clock Rise/Fall timeb</td>
<td>0.1</td>
<td>0.22</td>
<td>0.25</td>
<td>UI</td>
</tr>
<tr>
<td>Incoming Differential Clock Overlapb</td>
<td></td>
<td></td>
<td>30</td>
<td>mUI</td>
</tr>
<tr>
<td>Incoming Data Rise/Fall timeb</td>
<td></td>
<td>0.35</td>
<td></td>
<td>UI</td>
</tr>
<tr>
<td>Driver Pull-up/Pull-down Impedance for Advanced Packagec</td>
<td>22</td>
<td>25</td>
<td>28</td>
<td>Ohms</td>
</tr>
<tr>
<td>Impedance Step Size for Advanced Packaged</td>
<td></td>
<td></td>
<td>0.5</td>
<td>Ohms</td>
</tr>
<tr>
<td>Driver Pull-up/Pull-down Impedance for Standard Packagee</td>
<td>27</td>
<td>30</td>
<td>33</td>
<td>Ohms</td>
</tr>
<tr>
<td>Impedance Step Size for Standard Packaged</td>
<td></td>
<td></td>
<td>0.5</td>
<td>Ohms</td>
</tr>
<tr>
<td>1-UI Total Jitterf</td>
<td></td>
<td></td>
<td>96/113</td>
<td>mUI pk-pk at BER</td>
</tr>
<tr>
<td>1-UI Deterministic Jitter (Dual Dirac)9</td>
<td></td>
<td></td>
<td>48</td>
<td>mUI pk-pk</td>
</tr>
<tr>
<td>Tx Data/Clock Differential Jitter (Divergent Path)h</td>
<td></td>
<td></td>
<td>60</td>
<td>mUI pk-pk at BER</td>
</tr>
</table>

<table>
<caption>Table 5-5. Transmitter Electrical Parameters (Sheet 2 of 2)</caption>
<tr>
<th>Parameter</th>
<th>Min</th>
<th>Typ</th>
<th>$M a x$</th>
<th>Unit</th>
</tr>
<tr>
<td>Tx Data/Clock Differential Deterministic Jitter'</td>
<td></td>
<td></td>
<td>30</td>
<td>mUI pk-pk</td>
</tr>
<tr>
<td></td>
<td>-0.02</td>
<td></td>
<td>0.02</td>
<td>UI</td>
</tr>
<tr>
<td>{ \text { Duty Cycle Errorj } }<br>{ \text { Lane-to-Lane Skew Correction Range \left(up to 16 GT/s\right)^{k } } }</td>
<td>-0.1</td>
<td></td>
<td>0.1</td>
<td>UI</td>
</tr>
<tr>
<td>Lane-to-Lane Skew Correction Range (up to 32 GT/s)k</td>
<td>-0.15</td>
<td></td>
<td>0.15</td>
<td>UI</td>
</tr>
<tr>
<td>Lane-to-Lane Skew Correction Range (up to 64 GT/s)k</td>
<td>-0.18</td>
<td></td>
<td>0.18</td>
<td>UI</td>
</tr>
<tr>
<td>Lane-to-Lane Skew Correction Range (up to 16 GT/s)'</td>
<td>-0.14</td>
<td></td>
<td>0.14</td>
<td>UI</td>
</tr>
<tr>
<td>Lane-to-Lane Skew Correction Range (up to 32 GT/s)!</td>
<td>-0.22</td>
<td></td>
<td>0.22</td>
<td>UI</td>
</tr>
<tr>
<td>Lane-to-Lane Skew Correction Range (up to 64 GT/s)!</td>
<td>-0.5</td>
<td></td>
<td>0.5</td>
<td>$\mathrm { U I }$</td>
</tr>
<tr>
<td>Lane-to-Lane Skewj</td>
<td>-0.02</td>
<td></td>
<td>0.02</td>
<td>$\mathrm { U I }$</td>
</tr>
<tr>
<td>Clock to Mean Data Training Accuracym</td>
<td>-0.07</td>
<td></td>
<td>0.07</td>
<td>$\mathrm { U I }$</td>
</tr>
<tr>
<td>Phase Adjustment Stepn</td>
<td></td>
<td></td>
<td>16</td>
<td>mUI</td>
</tr>
<tr>
<td>Effective Tx Pad Capacitance (32 GT/s capable design)k</td>
<td></td>
<td></td>
<td>250</td>
<td>fF</td>
</tr>
<tr>
<td>Effective Tx Pad Capacitance (64 GT/s capable design)k</td>
<td></td>
<td></td>
<td>180</td>
<td>fF</td>
</tr>
<tr>
<td>Effective Tx Pad Capacitance (8 GT/s capable design)!</td>
<td></td>
<td></td>
<td>300</td>
<td>fF</td>
</tr>
<tr>
<td>Effective Tx Pad Capacitance (16 GT/s capable design)!</td>
<td></td>
<td></td>
<td>200</td>
<td>fF</td>
</tr>
<tr>
<td>Effective Tx Pad Capacitance (&gt; 16 GT/s capable design)'</td>
<td></td>
<td></td>
<td>125</td>
<td>fF</td>
</tr>
<tr>
<td>Tx Driver S11 from DC to Nyquist Frequency! o</td>
<td></td>
<td></td>
<td>-9.5</td>
<td>dB</td>
</tr>
</table>

a. For recommended maximum Transmitter voltage, see Section 1.5.

b. Expected input (informative). Measured 20% to 80%. Differential clock overlap is deviation from the ideal
differential phase (180 degrees apart).

c. Driver pull-up/down impedance is calibrated at midpoint of Transmitter signal swing.

d. Impedance step size is an informative parameter and can be implementation specific to meet Driver pull-up/
pull-down impedance.

e. Driver pull-up/pull-down impedance is calibrated at midpoint of Transmitter signal swing (with nominal $R x$
termination when applicable).

f. 96 mUI for BER 1E-12 and 1E-15. 113 mUI for BER 1E-27.

g. Data dependent jitter excluding Duty Cycle Error.

h. Includes absolute random jitter and untracked deterministic jitter of the divergent path due to $\mathrm { d e l a v }$ mismatch
(in the matched architecture).

i. Untracked deterministic jitter for divergent path. This spec is for > 32 GT/s only.

j. Post correction.

k. Advanced Package.

I. Standard Package.

m. Includes static and tracking error.

n. Informative parameter. Phase adjustment step size must be chosen to meet other timing parameters,
including Clock-to-Mean Data Training Accuracy, Lane-to-Lane skew, and Duty cycle error (if applicable).

o. This is the input reflection coefficient. Transmission effect is much more significant at 48 to 64 GT/s for
UCIe-S. Lumped Cpad may not capture the full effect.

For UCIe-S designs that target a maximum data rate of 64 GT/s, it is recommended to implement a
full-cycle skew correction range (i.e., ±0.5 UI as indicated in Table 5-5). This adjustment

compensates for variations in bump maps because mismatches in bump-to-bump connection length
result in a larger percentage of UI time at higher data rates, thereby enhancing forward-scaling
capability.

The 1-UI Total Jitter, Tx Data/Clock Differential Total Jitter, Duty Cycle Error, Lane-to-Lane Skew, and
Clock to Mean Data Training Accuracy parameters listed in Table 5-5 are recommended target values.
It is permissible to make trade-offs among these individual components, as long as the overall sum of
the listed items does not exceed the specified total.

### 5.3.3 24 GT/s and 32 GT/s Transmitter Equalization

Transmitter equalization is recommended for 16 GT/s and must be supported at 24 GT/s and 32 GT/s
data rates to mitigate the channel ISI impact. Tx equalization is de-emphasis only for all applicable
Data rates.

Tx equalization coefficients for 24 GT/s and 32 GT/s are based on the FIR filter shown in Figure 5-6.
Equalization coefficient is subject to maximum unity swing constraint.

The Transmitter must support the equalization settings shown in Table 5-6. Determination of de-
emphasis setting is based on initial configuration or training sequence, where the value with larger
eye opening will be selected.

<figure>
<figcaption>Figure 5-6. Transmitter de-emphasis</figcaption>

$V _ { i n } \left( n \right)$

$1 \quad U I$

$C _ { 0 }$

$C _ { + 1 }$

$\sum$

$V _ { o u t } \left( n \right)$

$V _ { 0 u t } \left( n \right) = C _ { 0 } V _ { i n } \left( n \right) + C _ { + 1 } V _ { i n } \left( n - 1 \right) + | C _ { + 1 } |$

$$| C _ { 0 } | + | C _ { + 1 } | = 1$$

$V _ { i n } \left( n \right) = \left\{ 0 , + 1 \right)$

</figure>

<figure>
<figcaption>Figure 5-7. Transmitter de-emphasis waveform</figcaption>

$V _ { a }$

$V _ { b }$

$= 2 0 \log _ { 1 0 } \left( V _ { b } / V _ { a } \right)$

</figure>

<table>
<caption>Table 5-6. Transmitter de-emphasis values</caption>
<tr>
<th>Setting</th>
<th>De-emphasis</th>
<th>Accuracy</th>
<th>$\mathrm { C } _ { + 1 }$</th>
<th>$V _ { b } / V _ { a }$</th>
</tr>
<tr>
<td>1</td>
<td>0.0 dB</td>
<td>-</td>
<td>0.000</td>
<td>1.000</td>
</tr>
<tr>
<td>2</td>
<td>-2.2 dB</td>
<td>±0.5 dB</td>
<td>-0.112</td>
<td>0.776</td>
</tr>
</table>

### 5.3.4 48 GT/s and 64 GT/s Transmitter Equalization

Transmitter equalization is required for data rates of 48 GT/s and 64 GT/s. The coefficients for
transmitter equalization are derived from a Finite Impulse Response $\left( F I R \right)$ model, which is illustrated
in Figure 5-8.

<figure>
<figcaption>Figure 5-8. 3-tap Transmitter Equalization (Used at 48 GT/s and 64 GT/s)</figcaption>

$V _ { i n } \left( n \right)$

1.0 UI
delay

1.0 UI
delay

$C _ { - 1 }$
☒

$\mathrm { c } _ { n }$
☒

☒
$C _ { + 1 }$

$\Sigma$

$V _ { o u t } \left( n \right)$

$$V _ { o u t } \left( n \right) = C _ { - 1 } V \left( n \right) + C _ { 0 } V \left( n - 1 \right) + C _ { + 1 } V \left( n - 2 \right) + | C _ { - 1 } | + | C _ { + 1 } |$$
$$| C _ { - 1 } | + | C _ { 0 } | + | C _ { + 1 } | = 1$$
$$V _ { i n } \left( n \right) = \left\{ 0 , 1 \right\}$$

</figure>

The equalization coefficient is constrained by a maximum unity swing limitation. The transmitter is
required to support the equalization presets outlined $i n \quad T a b l e \quad 5 - 7 .$ The selection of the appropriate
preset is based on either the initial configuration or a training sequence, where the value with the
larger eye opening will be chosen. If multiple presets have the same eye opening, the one with the
largest $\mathrm { C } _ { 0 }$ coefficient should be selected. For a detailed explanation of the process, see
Section 4.5.3.4.10.

<table>
<caption>Table 5-7. 48 $G T / s$ and 64 GT/s Tx Equalization Coefficient Presets</caption>
<tr>
<th>Preset #</th>
<th>Preset Encoding</th>
<th>$C - 1$</th>
<th>$C _ { 0 }$</th>
<th>$\mathrm { C } _ { + 1 }$</th>
<th>Accuracy</th>
</tr>
<tr>
<td>PO</td>
<td>0000b</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>-</td>
</tr>
<tr>
<td>P1</td>
<td>0001b</td>
<td>-0.05</td>
<td>0.95</td>
<td>0</td>
<td>±0.025</td>
</tr>
<tr>
<td>P2</td>
<td>0010b</td>
<td>0</td>
<td>0.9</td>
<td>-0.1</td>
<td>±0.025</td>
</tr>
<tr>
<td>P3</td>
<td>0011b</td>
<td>-0.05</td>
<td>0.85</td>
<td>-0.1</td>
<td>±0.025</td>
</tr>
<tr>
<td>P4</td>
<td>0100b</td>
<td>0</td>
<td>0.8</td>
<td>-0.2</td>
<td>±0.025</td>
</tr>
<tr>
<td>P5</td>
<td>0101b</td>
<td>-0.05</td>
<td>0.75</td>
<td>-0.2</td>
<td>$0 . 0 2 5$</td>
</tr>
</table>

## 5.4 Receiver Specification

The Receiver topology is illustrated in Figure 5-9. Each Module (Advanced Package and Standard
Package) consists of clocks Receivers, data Receivers, and Track Receiver.

The received clock is used to sample the incoming data. The Receiver must match the delays between
the clock path and the data/valid path to the sampler. This is to minimize the impact of power supply
noise induced jitter. The data Receivers may be implemented as 2-way or 4-way interleaved. For
4-way interleaved implementation the Receiver needs to generate required phases internally from the
two phase of the forwarded clock. This may require duty cycle correction capability on the Receiver.
The supported forwarded clock frequencies and phases are described in Section 5.5.

At higher data rates, deskew capability may be needed in the receiver to achieve the matching
requirements between the data Lanes. Receiver Deskew, when applicable, can be performed during
mainband training. More details are provided in Section 4.5.

The UCIe Module, upon requesting the Track signal, receives a clock pattern (1010 ... ) aligned with
Phase-1 of the forwarded clock signal on its Track Receiver from the UCIe Module Partner's Track
Transmitter and may use the Track signal to track the impact of slow varying voltage and temperature
changes on sampling phase.

<figure>
<figcaption>Figure 5-9. Receiver topology</figcaption>

Deskew

Data

Flip-
flop

RXD

FIFO

2/4 Phases

...

Phase-1

Phase
Gen
(Optional)

RXCK

Phase-2

...

Track

RXD

Track

</figure>

### 5.4.1 Receiver Electrical Parameters for $< = 3 2$ GT/s

The specified Receiver electrical parameters for $< = 3 2 \quad G T / s$ are shown in Table 5-8.

<table>
<caption>Table 5-8. Receiver Electrical Parameters for $< = 3 2 \quad G T / s$</caption>
<tr>
<th>Parameter</th>
<th>Min</th>
<th>Typ</th>
<th>Max</th>
<th>Unit</th>
</tr>
<tr>
<td>Rx Input Impedanceª</td>
<td>45</td>
<td>50</td>
<td>55</td>
<td>Ohms</td>
</tr>
<tr>
<td>Impedance Step Sizeª</td>
<td>-</td>
<td>-</td>
<td>1</td>
<td>Ohms</td>
</tr>
<tr>
<td>Data/Clock Total Differential Jitterb c</td>
<td>-</td>
<td>-</td>
<td>60</td>
<td>mUI pk-pk</td>
</tr>
<tr>
<td>Lane-to-Lane skew (up to 16 GT/s)d</td>
<td>-0.07</td>
<td>-</td>
<td>0.07</td>
<td>UI</td>
</tr>
<tr>
<td>Lane-to Lane skew (&gt; 16 GT/s)d</td>
<td>-0.12</td>
<td>-</td>
<td>0.12</td>
<td>UI</td>
</tr>
<tr>
<td>Phase errore (Including Duty cycle error and I/Q mismatch)</td>
<td>-0.04</td>
<td>-</td>
<td>0.04</td>
<td>$\mathrm { U I }$</td>
</tr>
<tr>
<td>Per-Lane deskew adjustment stepf</td>
<td>-</td>
<td>-</td>
<td>16</td>
<td>mUI</td>
</tr>
<tr>
<td>Output Rise Timeg</td>
<td>-</td>
<td>-</td>
<td>0.1</td>
<td>UI</td>
</tr>
<tr>
<td>Output Fall Time9</td>
<td>-</td>
<td>-</td>
<td>0.1</td>
<td>UI</td>
</tr>
<tr>
<td>Rx Pad Capacitanceh</td>
<td>-</td>
<td>-</td>
<td>200</td>
<td>fF</td>
</tr>
<tr>
<td>Rx Pad Capacitance (up to 8 GT/s)ª</td>
<td>-</td>
<td>-</td>
<td>300</td>
<td>fF</td>
</tr>
<tr>
<td>Effective Rx Pad Capacitance (up to 16 GT/s)a</td>
<td>-</td>
<td>-</td>
<td>200</td>
<td>$\mathrm { f F }$</td>
</tr>
<tr>
<td>Effective Rx Pad Capacitance (24 and 32 GT/s)a</td>
<td>-</td>
<td>-</td>
<td>125</td>
<td>$\mathrm { f F }$</td>
</tr>
<tr>
<td>Rx Voltage sensitivity</td>
<td>-</td>
<td>-</td>
<td>40</td>
<td>mV</td>
</tr>
</table>

a. Standard Package mode with termination. Impedance step size is an informative parameter and can be
implementation specific to meet Rx Input Impedance.

b. Based on matched architecture.

c. Includes absolute random jitter and untracked deterministic jitter of the divergent path due to delay mismatch
(in the matched architecture).

d. Require Rx per-Lane deskew if limit is exceeded.

e. Residual error post training and correction.

f. When applicable (informative).

g. Expected output (informative). Measured 20% to 80%.

h. Advanced Package.

### 5.4.2 Receiver Electrical Parameters for 48 GT/s and 64 GT/s

The specified Receiver electrical parameters for 48 GT/s and 64 GT/s are shown in Table 5-9.

<table>
<caption>Table 5-9. Receiver Electrical Parameters for 48 GT/s and 64 GT/s</caption>
<tr>
<th>Parameter</th>
<th>Min</th>
<th>Typ</th>
<th>Max</th>
<th>Unit</th>
</tr>
<tr>
<td>Rx Input Impedanceª</td>
<td>45</td>
<td>50</td>
<td>55</td>
<td>Ohms</td>
</tr>
<tr>
<td>Impedance Step Sizeª</td>
<td></td>
<td></td>
<td>1</td>
<td>Ohms</td>
</tr>
<tr>
<td>Data/Clock Total Differential Jitterb c</td>
<td></td>
<td></td>
<td>60</td>
<td>mUI pk-pk at BER</td>
</tr>
<tr>
<td>Data/Clock Deterministic Differential Jitter</td>
<td></td>
<td></td>
<td>30</td>
<td>mUI pk-pk</td>
</tr>
<tr>
<td>Lane-to Lane skewd</td>
<td>-0.12</td>
<td></td>
<td>0.12</td>
<td>UI</td>
</tr>
<tr>
<td>Phase Errore (including Duty cycle error and I/Q mismatch)</td>
<td>-0.04</td>
<td></td>
<td>0.04</td>
<td>$\mathrm { U I }$</td>
</tr>
<tr>
<td>Per-lane Deskew Adjustment Stepf</td>
<td></td>
<td></td>
<td>16</td>
<td>mUI</td>
</tr>
<tr>
<td>Output Rise Timeg</td>
<td></td>
<td></td>
<td>0.1</td>
<td>UI</td>
</tr>
<tr>
<td>Output Fall Timeg</td>
<td></td>
<td></td>
<td>0.1</td>
<td>UI</td>
</tr>
<tr>
<td>Effective Rx Pad Capacitance for Advanced Packageª</td>
<td></td>
<td></td>
<td>180</td>
<td>fF</td>
</tr>
<tr>
<td>Effective Rx Pad Capacitance for Standard Packageª</td>
<td></td>
<td></td>
<td>125</td>
<td>fF</td>
</tr>
<tr>
<td>Data Rx Voltage Reference Error</td>
<td></td>
<td></td>
<td>5</td>
<td>mV</td>
</tr>
<tr>
<td>Rx Input Referred Noise Spectral Density</td>
<td></td>
<td></td>
<td>4.10E-08</td>
<td>$v ^ { 2 } / G H z$</td>
</tr>
</table>

a. Applies to both Advanced Packages and Standard Packages. Impedance step size is an informative parameter
and can be implementation specific to meet Rx Input Impedance.

b. Based on matched architecture.

c. Includes absolute random jitter and untracked deterministic jitter of the divergent path due to delay mismatch
(in the matched architecture).

d. Require Rx per-Lane deskew if limit is exceeded.

e. Residual error post training and correction.

f. When applicable (informative).

g. Expected output (informative). Measured 20% to 80%.

### 5.4.3 Rx Termination

Receivers on Advanced Package modules must be unterminated up to 32 GT/s, and terminated to
ground for 48 GT/s and 64 GT/s negotiated maximum data rate. The remainder of this section
elaborates on the details of Rx termination for Standard Package modules.

Receiver termination on Standard Package is data rate and channel dependent. Table 5-10 shows the
maximum data rate and channel reach combinations for which the Receivers in Standard Package
Modules are recommended to remain unterminated for a minimally compliant Transmitter.
Figure 5-10 shows an alternate representation of termination requirement. The area below the curve
in Figure 5-10 shows the speed and channel-reach combinations for which the Receivers in Standard
Package Modules are recommended to remain unterminated. Termination is required for all other
combinations. Receivers must be ground-terminated when applicable, as shown in Figure 5-11.

<table>
<caption>Table 5-10. Maximum channel reach for unterminated Receiver $\left( T x \sin g = 0 . 4 V \right)$</caption>
<tr>
<th></th>
<th>Data Rate (GT/s)</th>
<th>Channel Reach (mm)</th>
</tr>
<tr>
<td>12</td>
<td></td>
<td>3</td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>5</td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>10</td>
</tr>
</table>

<figure>
<figcaption>Figure 5-10. Receiver Termination Map for Table 5-10 $\left( T \times S w i n g = 0 . 4 V \right)$</figcaption>

16

14

12

Data Rate (GT/s)

10

8

6

4

2

0

0

5

10

15

20

25

Channel Reach (mm)

</figure>

<figure>
<figcaption>Figure 5-11. Receiver termination</figcaption>

Data

RXD

Clock Phase-1

RXCK

Clock Phase-2

Track

$R X D$

</figure>

For higher Transmitter swing, unterminated Receiver can be extended to longer channel and high data
rate. Table 5-11 shows the maximum data rate and channel reach combinations for Transmitter swing
and 0.85 V (maximum recommended swing). Figure 5-12 shows an alternate representation of
termination requirement. The area below the curve in Figure 5-12 shows the speed and channel reach
combinations for which the Receivers in Standard Package Modules are recommended to remain
unterminated.

<table>
<caption>Table 5-11. Maximum Channel reach for unterminated Receiver $\left( T X \quad s w i n g = 0 . 8 5 V \right)$</caption>
<tr>
<th>{ \text { Data Rate } }<br>{ \left( G T / s \right) }</th>
<th>Channel Reach (mm)</th>
</tr>
<tr>
<td>16</td>
<td>5</td>
</tr>
<tr>
<td>12</td>
<td>10</td>
</tr>
<tr>
<td>8 and below</td>
<td>All supported Lengths</td>
</tr>
</table>

<figure>
<figcaption>Figure 5-12. Receiver termination map for Table 5-11 $\left( T X \quad S w i n g = 0 . 8 5 \quad V \right)$</figcaption>

32

28

24

Data Rate (GT/s)

20

16

12

8

4

0

0

5

10

15

20

25

30

35

40

Channel Reach (mm)

</figure>

# IMPLEMENTATION NOTE

When the Transmitter is tri-stated and the Receiver is not required to be enabled
(e.g., SBINIT, and some MBINIT states):

· Disabled Receivers must be tolerant of a floating input pad

· Receivers are permitted to enable weak-termination directly on the input pad to
prevent crowbar current in the receiver and to lower noise sensitivity at the
receiver trip point

When the Transmitter is tri-stated and the Receiver is required to be enabled (e.g.,
REPAIRCLK and REPAIRVAL states for Advanced Package):

· Enabled Receivers for (CLKP, CLKN, CLKRD, TRK, VLD, VLDRD) must be tolerant
of a floating input signal on the pad

· Receivers are permitted to enable weak-termination directly on the input pad to
prevent crowbar current in the receiver and to lower noise sensitivity at the
receiver trip point

## 5.4.4 Receiver Equalization > 16 GT/s

Receiver equalization may be implemented at 24 GT/s and 32 GT/s data rates. This enables Link
operation even when TX equalization is not available. Implementation can be CTLE, inductive peaking,
1-tap DFE, or others. Expected RX equalization capability is equivalent of 1st order CTLE. Example
transfer function curves of a first order CTLE are shown in Figure 5-13 and the corresponding
equation is shown below:

$$H \left( s \right) = \mathrm { o } _ { p 2 } \left( \frac { s + A _ { D C } \mathrm { o } _ { p 1 } } { \left( s + \mathrm { o } _ { p 1 } \right) \left( s + \mathrm { o } _ { p 2 } \right) } \right)$$

where, @p2 = 2n*DataRate, $\omega _ { p 1 } = 2 \pi ^ { * } D a t a R a t e / 4 ,$ and $\mathrm { A } _ { \mathrm { D C } }$ is the DC gain.

<figure>
<figcaption>Figure 5-13. Reference Rx CTLE for 24 GT/s</figcaption>

5

0

CTLE Gain (dB)

-5

-10

-15

-20

1.00E+07

$1 . 0 0 E + 0 8$

$1 . 0 0 E + 0 9$

1.00E+10

$1 . 0 0 E + 1 1$

$1 . 0 0 E + 1 2$

Frequency $\left( H z \right)$

</figure>

For data rates of 48 GT/s and 64 GT/s, Rx equalization is required to be utilized in conjunction with $\mathrm { T x }$
equalization to facilitate correct Link operation. The Rx equalization, a reference behavioral model for
channel analysis, adheres to the following design criteria:

· Transfer Function: Simple 1-zero, 2-pole configuration

· Adjustable Parameterized DC Gain: Gain value less than 1, or negative measured in dB

· Consistent Peak Gain: Peak gain is fixed at 0 dB, regardless of the DC gain level

· Nyquist Peak Gain: Peak gain frequency is aligned with the Nyquist frequency, independent of DC
gain adjustments

The Rx equalizer's frequency response is captured by the closed-form equations presented in
Equation 5-1 through Equation $5 - 4 :$

Equation 5-1.

$$H \left( s \right) = \frac { A _ { D C } \omega _ { P } ^ { 2 } } { \omega _ { z } } \frac { s + \omega _ { z } } { \left( s + \omega _ { p } \right) ^ { 2 } }$$

Equation 5-2.

$$\omega _ { n } = 2 \pi f _ { n }$$



---



Equation 5-3.

$$\omega _ { p } = \min \left( \frac { \omega _ { n } } { \sqrt [ 4 ] { 1 - A _ { D c } ^ { 2 } } } , 2 \omega _ { n } \right)$$

Equation 5-4.

$$a _ { z } = a _ { p } \sqrt { \frac { 1 - \sqrt { 1 - A _ { D c } ^ { 2 } } } { 2 } }$$

Apc is the DC gain value. $f _ { n }$ the peak frequency, 24 GHz and 32 GHz, for 48 GT/s and 64 GT/s,
respectively.

It is recommended to provide a minimum of seven CTLE settings to span the DC gain range from
-6 dB to 0 dB, adjustable in 1-dB increments. Figure 5-14 shows the Reference Rx CTLE responses for
64 GT/s.

<figure>
<figcaption>Figure 5-14. Reference Rx CTLE for 64 GT/s</figcaption>

5

0

CTLE Gain (dB)

-5

-10

-15

-20

1.00E+07

1.00E+08

1.00E+09

1.00E+10

1.00E+11

$1 . 0 0 E + 1 2$

Frequency (Hz)

</figure>

Additionally, designers have the option to implement a 1-tap DFE alongside the CTLE, which can
potentially enhance signal integrity at a data rate of 64 GT/s. To maintain control over error
propagation in the DFE, it is recommended that the coefficient ratio h1/h0 be maintained at less than
0.35.

# 5.5 Clocking

Figure 5-15 shows the forwarded clocking architecture. Each module supports a two-phase forwarded
clock. It is critical to maintain matching between all data Lanes and valid signal within the module.
The Receiver must provide matched delays between the Receiver clock distribution and Data/Valid
Receiver path. This is to minimize the impact of power supply noise-induced jitter on Link
performance. Phase adjustment is performed on the Transmitter as shown in Figure 5-15. Link
training is required to set the position of phase adjustment to maximize the Link margin.

At higher data rates, Receiver eye margins may be small and any skew between the data Lanes
(including Valid) may further degrade Link performance. Per-Lane deskew must be supported on the
Transmitter at high data rates.

This specification supports quarter-rate clock frequencies at data rates (24 GT/s and 32 GT/s). The
forwarded clock Transmitter must support quadrature phases in addition to differential clock at these
data rates (to enable either quarter-rate or half-rate Receiver implementations). Table 5-12 shows the
clock frequencies and phases that must be supported at different data rates. Forwarded Clock Phase
is negotiated during Link Initialization and Training (see Section 4.5.3.3.1). At 24 GT/s and 32 GT/s,
Receiver has the options to support differential clock or quadrature clock. The capability register is
defined in Table 9-47, and advertised at the beginning of link negotiation. Note that to achieve
interoperability with designs of lower max data rate, differential clock must always be used at
16 GT/s and below, independent of the choice at 24 GT/s and 32 GT/s.

At data rates of 48 GT/s and 64 GT/s, the forwarded clock operates at a quarter rate and is free-
running. Additionally, in-phase/quadrature (I/Q) training can be conducted during the Rx clock
calibration phase. I/Q training is utilized to fine-tune the relative timing between Phase-1 and
Phase-2 of the forwarded clock. It is recommended that the phase adjustment resolution and range
adhere to Table 5-13 to ensure sufficient precision and coverage. For additional information, see
Section 4.5.3.4.5.

## 5.5.1 Track

Track signal can be used to perform Runtime Recalibration to adjust the Receiver clock path against
slow varying voltage, temperature and transistor aging conditions.

When requested by the UCIe Module, the UCIe Module Partner sends a clock-like pattern that
matches the frequency and is phase-aligned with Phase-1 of the forwarded clock on its Track
Transmitter, as shown in Figure 5-15. The pattern is 1010 ... in the half-rate forwarded clock mode and
1100 ... in the quarter-rate forwarded clock mode.

<figure>
<figcaption>Figure 5-15. Clocking architecture</figcaption>

Die-1

Die-2

Deskew

$D a t a + V a l i d$

Flip-
flop

Data

FIFO

Serializer

TXD

RXD

FIFO

$2 / 4 \quad P h a s e s$

/N

$1 6 x / 6 4 x$

...

Phase-1

Deskew

Clock

$P I$
+
DCC

Phase
Gen

TXCK

RXCK

PLL

DLL

Phase-2

CK

Buf

$f C K$

Track

...

$T X D$

RXD

Phase
Control

Track

</figure>

<table>
<caption>Table 5-12. Forwarded Clock Frequency and Phase</caption>
<tr>
<th>Data rate $\left( G T / s \right)$</th>
<th>Clock freq. (fCK) (GHZ)</th>
<th>Phase-1</th>
<th>Phase-2</th>
<th>Deskew $\left( \mathrm { R e q } / \mathrm { O p t } \right)$</th>
</tr>
<tr>
<td>64</td>
<td>16</td>
<td>45</td>
<td>135</td>
<td>Required</td>
</tr>
<tr>
<td>48</td>
<td>12</td>
<td>45</td>
<td>135</td>
<td>Required</td>
</tr>
<tr>
<td rowspan="2">32</td>
<td>16</td>
<td>90</td>
<td>270</td>
<td>Required</td>
</tr>
<tr>
<td>8</td>
<td>45</td>
<td>135</td>
<td>Required</td>
</tr>
<tr>
<td rowspan="2">24</td>
<td>12</td>
<td>90</td>
<td>270</td>
<td>Required</td>
</tr>
<tr>
<td>6</td>
<td>45</td>
<td>135</td>
<td>Required</td>
</tr>
<tr>
<td>16</td>
<td>8</td>
<td>90</td>
<td>270</td>
<td>Required</td>
</tr>
<tr>
<td>12</td>
<td>6</td>
<td>90</td>
<td>270</td>
<td>Required</td>
</tr>
<tr>
<td>8</td>
<td>4</td>
<td>90</td>
<td>270</td>
<td>Optional</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>90</td>
<td>270</td>
<td>Optional</td>
</tr>
</table>

<table>
<caption>Table 5-13. I/Q Correction for 48 GT/s and 64 GT/s</caption>
<tr>
<th>Parameter</th>
<th>Min</th>
<th>Typ</th>
<th>Max</th>
<th>Unit</th>
</tr>
<tr>
<td>I/Q Correction Step</td>
<td></td>
<td>1/64</td>
<td></td>
<td>$\mathrm { U I }$</td>
</tr>
<tr>
<td rowspan="2">I/Q Correction Range</td>
<td>-12</td>
<td></td>
<td>12</td>
<td>step</td>
</tr>
<tr>
<td>-0.1875</td>
<td></td>
<td>$0 . 1 8 7 5$</td>
<td>$\mathrm { U I }$</td>
</tr>
</table>

### IMPLEMENTATION NOTE

This implementation note provides an example usage for Track signal to calibrate out
slow varying temperature- and voltage-related delay drift between Data and Clock on
the Receiver.

Track uses the same type of Tx driver and Rx receiver as Data (see Figure 5-15). A
clock pattern aligned with Phase-1 of the forwarded clock is sent from Track
Transmitter and received on the Track Receiver. Any initial skew can be calibrated out
during initialization and training (MBTRAIN.RXCLKCAL) on the Receiver side. During
run-time, any drift between Data and the forwarded clock can be detected. One
method for detecting the drift is to sample Track with the forwarded clock. An
implementation-specific number of samples can be collected, averaged if needed, and
used for drift detection. This drift can then be corrected on the forwarded clock
(if needed).

<figure>
<figcaption>Figure 5-16. Track Usage Example</figcaption>

Track and Fwd clock pre initialization

Fwd Clock

Track

Track and Fwd clock post initialization (alignment)

Fwd Clock

Track

Clock drift and correction

Fwd Clock

Track

Fwd Clock
$\left( p o s t \quad c o r r e c t i o n \right)$

</figure>

# 5.6 Supply noise and clock skew

I/O Vcc noise and the clock skew between data modules shall be within the range specified in
Table 5-14.

<table>
<caption>Table 5-14. I/O Noise and Clock Skew</caption>
<tr>
<th>Parameter</th>
<th>Min</th>
<th>Nom</th>
<th>Max</th>
<th>Unit</th>
</tr>
<tr>
<td>I/O Vcc noise for 4 GT/s and 8 GT/sa</td>
<td>-</td>
<td>-</td>
<td>80</td>
<td>mVpp</td>
</tr>
<tr>
<td>{ \text { I/O Vcc noise for } 1 2 \text { GT/s^{\circ } } }<br>{ \text { I/O Vcc noise for } 1 6 \text { GT/s } }</td>
<td>-</td>
<td>-</td>
<td>50</td>
<td>mVpp</td>
</tr>
<tr>
<td></td>
<td>-</td>
<td>-</td>
<td>40</td>
<td>mVpp</td>
</tr>
<tr>
<td>I/O Vcc noise for 24, 32, 48, and 64 GT/sa</td>
<td>-</td>
<td>-</td>
<td>30</td>
<td>mVpp</td>
</tr>
<tr>
<td>Module to module clock skewb</td>
<td>-</td>
<td>-</td>
<td>60</td>
<td>ps</td>
</tr>
</table>

a. I/O VCC noise includes all noise at the I/O supply bumps relative to VSS bumps. This noise includes all DC and
AC fluctuations at all applicable frequencies.

b. Applies only to multi-module instantiations.

## IMPLEMENTATION NOTE

Due to different micro bump max current capacity and power delivery requirements,
PHY in Advanced Package may have TX providing I/O power supply to RX circuits.

Due to low current draw, sideband supply voltage is strongly recommended to be on
an always-on power domain.

# 5.7 Ball-out and Channel Specification

The UCIe interconnect channel is required to achieve a minimum eye opening that conforms to a
specified eye mask, under channel compliance simulation conditions with noiseless and jitter-less
behavioral Tx and Rx models.

For data rates <= 32 GT/s, the eye mask conforms to a rectangular shape (see Figure 5-17), with the
minimum eye height and width specified in Table 5-15.

<figure>
<figcaption>Figure 5-17. Example Rectangular Eye Mask Diagram for $< = 3 2 \quad G T / s$</figcaption>

Voltage (mV)

-0.8

0

+0.8

Time $\left( U I \right)$

</figure>

<table>
<caption>Table 5-15. Rectangular Eye Mask Requirements for $< = 3 2 \quad G T / s$</caption>
<tr>
<th>Data Rate (GT/s)</th>
<th>{ \text { Eye Height } }<br>{ \left( m v \right) }</th>
<th>{ \text { Eye Width } }<br>{ \left( U I \right) }</th>
</tr>
<tr>
<td>4, 8, 12, $1 6 ^ { \circ }$</td>
<td>40</td>
<td>0.75</td>
</tr>
<tr>
<td>24, 32ª b</td>
<td>40</td>
<td>0.65</td>
</tr>
</table>

a. Based on minimum Tx swing specification.

b. With equalization enabled.

At the higher data rates of 48 GT/s and 64 GT/s, the eye mask adopts a diamond shape (see
Figure 5-18). During the channel analysis, the search space for Tx equalization is confined to the
presets outlined in Table 5-7. Concurrently, Rx equalization utilizes a 1st order CTLE, as detailed in
Section 5.4.4, with a DC gain range from -6 dB to 0 dB, adjustable in 1-dB increments. The minimum
eye height and eye width defined for this specification are 65 mV and 0.65 UI, respectively.

<figure>
<figcaption>Figure 5-18. Diamond Eye Mask for 48 GT/s and 64 GT/s</figcaption>

EH

EW

</figure>

## IMPLEMENTATION NOTE

Figure 5-19 shows an example circuit setup that can be used to generate the eye
diagrams shown in Figure 5-17 and Figure 5-18. $\mathrm { R } _ { \mathrm { T X } }$ is the Transmitter impedance
and RRx represents the Receiver termination. $\mathrm { C } _ { \mathrm { T X } }$ and $\mathrm { C } _ { \mathrm { R X } }$ represent effective
Transmitter and Receiver capacitance, respectively. For crosstalk, the 19-largest
aggressors need to be included. At data rates of 24 GT/s and above, the
corresponding Transmitter and Receiver equalization are enabled.

The eye diagram was generated using a two-step process.

1\. Generate ISI and XTALK channel step response using circuit setup shown in
Figure 5-19.

2\. Use the generated channel response in a signal-integrity or channel-simulation
tool to generate a statistical eye diagram (see Figure 5-17).

Other equivalent methods may be used, depending on the signal-integrity or channel-
simulation tool.

<figure>
<figcaption>Figure 5-19. Example Eye Simulation Setup</figcaption>

Tx Model

Interconnect

Rx Model

$R _ { T X }$

CTX

$R _ { R X } \sum _ { T = 1 } ^ { T }$

$\mathrm { C } _ { R X }$

Agg # N

$V _ { 0 \_ a g g N }$

RTX

:

Victim

Vo_vic

\+

$\mathrm { C } _ { \mathrm { T Y } }$

:

CRX

$R _ { R X }$

Agg # 1

o_agg1

$c _ { m }$

$\mathrm { R } _ { \mathrm { T X } }$

$| \mathrm { C } _ { R X }$

$\mathrm { R } _ { \mathrm { R X } }$

</figure>

The Tx Lane-to-Lane Skew Correction Range is the range that the Tx can compensate for interconnect
channel mismatches and Rx lane-to-lane delay variations (within the specified limits). Therefore, the
difference between Tx Lane-to-Lane Skew Correction Range in Section 5.3.2 and the Rx Lane-to-Lane
Skew in Section 5.4.1 and Section 5.4.2 represents interconnect channel-matching tolerance. The
tolerance defined with respect to the center of distribution across Lanes is quantified in Table 5-16.
The maximum-allowable mismatch between any two Lanes is constrained by the tolerance span listed
in the table.

Additionally, the deskew circuit in the Tx can be used to correct Tx clock distribution skew. In this
scenario, the combined correction range for Tx, Rx, and channel mismatches depends on the Tx
design implementation; however, the combined correction range must exceed the specified Tx Lane-
to-Lane Skew Correction Range value listed in Table 5-5.

<table>
<caption>Table 5-16. Channel Matching Tolerance of Tx or Rx within a Module</caption>
<tr>
<th colspan="2">Channel Matching Tolerance</th>
<th rowspan="2">Min</th>
<th rowspan="2">Max</th>
<th rowspan="2">Tolerance Span</th>
<th rowspan="2">Unit</th>
</tr>
<tr>
<th>Package Type</th>
<th>Data Rate</th>
</tr>
<tr>
<td rowspan="2">Advanced</td>
<td>4 to 32 GT/s</td>
<td>-0.03</td>
<td>0.03</td>
<td>0.06</td>
<td>UI</td>
</tr>
<tr>
<td>48 and 64 GT/s</td>
<td>-0.06</td>
<td>0.06</td>
<td>0.12</td>
<td>UI</td>
</tr>
<tr>
<td rowspan="3">Standard</td>
<td>4 to 16 GT/s</td>
<td>-0.07</td>
<td>0.07</td>
<td>0.14</td>
<td>UI</td>
</tr>
<tr>
<td>$2 4 \quad a n d \quad 3 2 \quad G T / s$</td>
<td>-0.10</td>
<td>0.10</td>
<td>0.20</td>
<td>UI</td>
</tr>
<tr>
<td>48 and 64 GT/s</td>
<td>-0.20</td>
<td>0.20</td>
<td>0.40</td>
<td>UI</td>
</tr>
</table>

### 5.7.1 Voltage Transfer Function

Voltage Transfer Function (VTF) based metrics are used to define insertion loss and crosstalk. VTF
metrics incorporate both resistive and capacitive components of $T x$ and Rx terminations. Figure 5-20
shows the circuit diagram for VTF calculations.

<figure>
<figcaption>Figure 5-20. Circuit for VTF calculation</figcaption>

$\mathrm { V } _ { \mathrm { s } }$

$\mathrm { R } _ { \mathrm { t x } }$

interconnect

$\mathrm { V } _ { \mathrm { r } }$

Victim

$\mathrm { C } _ { \mathrm { t } }$

$C _ { x }$

$R _ { f x }$

$R _ { x }$

interconnect

$V _ { a 1 }$

Aggressor1

$C _ { 0 x }$

$C _ { x x }$

$\mathrm { R } _ { _ { \mathrm { f X } } }$

$R _ { x }$

interconnect

$V _ { a }$

Aggressor2

$\mathrm { C } _ { \mathrm { x } }$

$C _ { x x }$

$R _ { n }$

$R _ { t x }$

interconnect

$V _ { a 1 9 }$

Aggressor19

$\mathrm { C } _ { \mathrm { t x } }$

$c _ { n } = \frac { 1 } { T }$

</figure>

VTF loss is defined as the ratio of the Receiver voltage and the Source voltage, as shown in
Equation 5-5 and Equation 5-6.

# Equation $5 - 5 .$

$$L \left( f \right) = 2 0 \log 1 0 | \frac { V _ { r } \left( f \right) } { V _ { s } \left( f \right) } |$$

Equation 5-6.

$$L \left( 0 \right) = 2 0 \log 1 0 \left( \frac { R _ { r x } } { R _ { t x } + R _ { c h a n n e l } + R _ { r x } } \right)$$

L(f) is the frequency dependent loss and L(0) is the $D C \quad l o s s .$ For unterminated channel, $L \left( 0 \right)$ is
effectively 0.

VTF crosstalk is defined as the power sum of the ratios of the aggressor Receiver voltage to the
source voltage. 19 aggressors are included in the calculation. Based on crosstalk reciprocity,
VTF crosstalk can be expressed as shown in Equation 5-7.

Equation $5 - 7 .$

$$X T \left( f \right) = 1 0 \log 1 0 \left( \sum _ { i = 1 } ^ { 1 9 } | \frac { V _ { a i } \left( f \right) } { V _ { s } \left( f \right) } | ^ { 2 } \right)$$

## 5.7.2 Advanced Package

<table>
<caption>Table 5-17. Channel Characteristics</caption>
<tr>
<th>Data Rate</th>
<th>4-16 GT/s</th>
<th>$2 4 , 3 2 \quad G T / s$</th>
</tr>
<tr>
<td>VTF Loss (dB)</td>
<td>$L \left( f _ { N } \right) > - 3$</td>
<td>$L \left( f _ { N } \right) > - 5$</td>
</tr>
<tr>
<td>VTF Crosstalk (dB)ª</td>
<td>XT(fN) &lt; 1.5 L(fN) - 21.5 and XT(fN) &lt; - 23</td>
<td>XT(fN) &lt; 1.5 L(fN) - 19 and $X T \left( f _ { N } \right) < - 2 4$</td>
</tr>
</table>

a. Based on Voltage Transfer Function Method (Tx: 25 ohm / 0.25 pF; Rx: 0.2 pF).

$f _ { N }$ is the Nyquist frequency. The equations in the table form a segmented line in the loss-crosstalk
coordinate plane, defining the pass/fail region.

<table>
<caption>Table 5-18. x64 Advanced Package Module Signal List (Sheet 1 of 2)ª</caption>
<tr>
<th>Signal Name</th>
<th>Count</th>
<th>Description</th>
</tr>
<tr>
<td colspan="3">Data</td>
</tr>
<tr>
<td>TXDATA [ 63 : 0]</td>
<td>64</td>
<td>Transmit Data</td>
</tr>
<tr>
<td>TXVLD</td>
<td>1</td>
<td>Transmit Data Valid; Enables clocking in corresponding module</td>
</tr>
<tr>
<td>TXTRK</td>
<td>1</td>
<td>Transmit Track signal</td>
</tr>
<tr>
<td>TXCKP</td>
<td>1</td>
<td>Transmit Clock Phase-1</td>
</tr>
<tr>
<td>TXCKN</td>
<td>1</td>
<td>Transmit Clock Phase-2</td>
</tr>
<tr>
<td>TXCKRD</td>
<td>1</td>
<td>Redundant for Clock and Track Lane repair</td>
</tr>
<tr>
<td>TXDATARD [ 3 : 0]</td>
<td>4</td>
<td>Redundant for Data Lane repair</td>
</tr>
<tr>
<td>TXVLDRD</td>
<td>1</td>
<td>Redundant for Valid</td>
</tr>
<tr>
<td>RXDATA [ 63 : 0]</td>
<td>64</td>
<td>Receive Data</td>
</tr>
</table>

<table>
<caption>Table 5-18. x64 Advanced Package Module Signal List (Sheet 2 of 2)ª</caption>
<tr>
<th>Signal Name</th>
<th>Count</th>
<th>Description</th>
</tr>
<tr>
<td>RXVLD</td>
<td>1</td>
<td>Receive Data Valid; Enables clocking in corresponding module</td>
</tr>
<tr>
<td>RXTRK</td>
<td>1</td>
<td>Receive Track.</td>
</tr>
<tr>
<td>RXCKP</td>
<td>1</td>
<td>Receive Clock Phase-1</td>
</tr>
<tr>
<td>RXCKN</td>
<td>1</td>
<td>Receive Clock Phase-2</td>
</tr>
<tr>
<td>RXDATARD [3 : 0]</td>
<td>4</td>
<td>Redundant for Data Lane repair</td>
</tr>
<tr>
<td>RXCKRD</td>
<td>1</td>
<td>Redundant for Clock Lane repair</td>
</tr>
<tr>
<td>RXVLDRD</td>
<td>1</td>
<td>Redundant for Valid</td>
</tr>
<tr>
<td colspan="3">Sideband</td>
</tr>
<tr>
<td>TXDATASB</td>
<td>1</td>
<td>$S i d e b a n d \quad T r a n s m i t \quad D a t a$</td>
</tr>
<tr>
<td>RXDATASB</td>
<td>1</td>
<td>$S i d e b a n d$ Receiver Data</td>
</tr>
<tr>
<td>TXCKSB</td>
<td>1</td>
<td>Sideband Transmit Clock</td>
</tr>
<tr>
<td>RXCKSB</td>
<td>1</td>
<td>Sideband Receive Clock</td>
</tr>
<tr>
<td>TXDATASBRD</td>
<td>1</td>
<td>Redundant Sideband Transmit Data</td>
</tr>
<tr>
<td>RXDATASBRD</td>
<td>1</td>
<td>Redundant Sideband Receiver Data</td>
</tr>
<tr>
<td>TXCKSBRD</td>
<td>1</td>
<td>Redundant Sideband Transmit Clock</td>
</tr>
<tr>
<td>RXCKSBRD</td>
<td>1</td>
<td>Redundant Sideband Receive Clock</td>
</tr>
<tr>
<td colspan="3">Power and Voltage</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>Ground Reference</td>
</tr>
<tr>
<td>VCCIO</td>
<td></td>
<td>I/O supply</td>
</tr>
<tr>
<td>VCCFWDIO</td>
<td></td>
<td>Forwarded power supply from remote Transmitter supply to local Receiver AFE (see Tightly Coupled mode in Section 5.8)</td>
</tr>
<tr>
<td>VCCAON</td>
<td></td>
<td>Always on Aux supply (sideband)</td>
</tr>
</table>

a. For x32 Advanced Package module, the TXDATA [ 63 : 32], TXRD $\left[ 3 : 2 \right] ,$ RXDATA [ 63 : 32], and RXRD [ 3 : 2]
signals do not apply. All other signals are the same as the x64 Advanced Package Module signals.

### 5.7.2.1 Loss and Crosstalk Mask

Loss and crosstalk are specified by a mask defined by the $L \left( f _ { N } \right)$ and $X T \left( f _ { N } \right)$ at Nyquist frequency. It is
a linear mask from DC to $f _ { N }$ for loss and flat mask for crosstalk, illustrated by Figure 5-21. Loss from
DC to $f _ { N }$ needs to be above the spec line. Crosstalk from DC to $f _ { N }$ needs to be below the spec line. The
green line in Figure 5-21 is a representative passing signal.

<figure>
<figcaption>Figure 5-21. Loss and Crosstalk Mask</figcaption>

Loss Spec

Crosstalk Spec

$f _ { N }$

Freq (GHz)

$f _ { \lambda }$

Freq (GHz)

0

0

$L \left( 0 \right)$

$L \left( f _ { N } \right)$

$X T \left( f _ { N } \right)$

</figure>

### 5.7.2.2 x64 Advanced Package Module Bump Map

All bump matrices in this section and hereinafter are defined with "dead bug" view which means the
viewer is looking directly at the UCIe micro bumps facing up, with the die flipped like a "dead bug" as
illustrated in Figure 5-22.

<figure>
<figcaption>Figure 5-22. Viewer Orientation Looking at the Defined UCIe Bump Matrix</figcaption>
</figure>

Figure 5-23, Figure 5-24, and Figure 5-25 show the reference bump matrix for the 10-column, 16-
column, and 8-column x64 Advanced Package Modules, respectively. The lower left corner of the
bump map will be considered "origin" of a bump matrix and the leftmost column is Column 0.

It is strongly recommended to follow the bump matrices provided in Figure 5-23, Figure 5-24, and
Figure 5-25 for x64 Advanced Package interfaces.

The 10-column bump matrix is optimal for bump pitch range of 38 to 50 um. To achieve optimal area
scaling with different bump pitches, the optional 16-column and 8-column bump matrices are defined
for bump ranges of 25 to 37 um and 51 to 55 um, respectively, which will result in optimal Module
depth while maintaining Module width of 388.8 um, as shown in Figure 5-24 and Figure 5-25,
respectively.

The following rule must be followed for the 10-column x64 Advanced Package bump matrix:

· The signal order within a column must be preserved. For example, Column 0 must contain the
signals: txdataRD0, txdata0, txdata1, txdata2, txdata3, txdata4, ... , rxdata59,
rxdata60, rxdata61, rxdata62, rxdata63, rxdataRD3, and txdatasbRD. Similarly, 16-
column and 8-column x64 Advanced Packages must preserve the signal order within a column of
the respective bump matrices.

It is strongly recommended to follow the supply and ground pattern shown in the bump matrices. It
must be ensured that sufficient supply and ground bumps are provided to meet channel
characteristics (FEXT and NEXT) and power-delivery requirements.

The following rules must be followed when instantiating multiple modules of Advanced Package bump
matrix:

· Modules must be stepped in the same orientation and abutted.

· Horizontal or vertical mirroring is not permitted.

· Module stacking is not permitted.

Additionally, in multi-module instantiations it is strongly recommended to add one column of vss
bumps on each outside edge of the multi-module instantiation.

Mirror die implementation may necessitate a jog or additional metal layers for proper connectivity.

<table>
<caption>Figure 5-23. 10-column x64 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</caption>
<tr>
<th></th>
<th>Column0</th>
<th>Column1</th>
<th>Column2</th>
<th>Column3</th>
<th>Column4</th>
<th>Column5</th>
<th>$C o l u m n 6$</th>
<th>Column7</th>
<th>Column8</th>
<th>Column9</th>
</tr>
<tr>
<td rowspan="5"></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
</tr>
<tr>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
</tr>
<tr>
<td rowspan="6"></td>
<td></td>
<td>rxdata50</td>
<td></td>
<td>rxdata35</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td>rxdataRD3</td>
<td></td>
<td>rxdata49</td>
<td></td>
<td>rxdata34</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata13</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata51</td>
<td></td>
<td>rxdata36</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>rxdata63</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata33</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata12</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata52</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>rxdata48</td>
<td></td>
<td>rxdata32</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata11</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata53</td>
<td></td>
<td>rxdata37</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>rxdata1</td>
</tr>
<tr>
<td></td>
<td>rxdata62</td>
<td></td>
<td>rxdata47</td>
<td></td>
<td>rxdataRD2</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>rxdata10</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata54</td>
<td></td>
<td>rxdata38</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>rxdata61</td>
<td></td>
<td>rxdata46</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata55</td>
<td></td>
<td>rxdata39</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata18</td>
<td></td>
<td>rxdata2</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata45</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata56</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata19</td>
<td></td>
<td>rxdata3</td>
</tr>
<tr>
<td></td>
<td>rxdata60</td>
<td></td>
<td>rxdata44</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata7</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata57</td>
<td></td>
<td>rxdata40</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata20</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>rxdata59</td>
<td></td>
<td>rxdata43</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>rxdata6</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata58</td>
<td></td>
<td>rxdata41</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>rxdata4</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata42</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata5</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata41</td>
<td></td>
<td>txdata58</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata5</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata42</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdata4</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txckp</td>
<td></td>
<td>txdata40</td>
<td></td>
<td>txdata57</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata6</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>txdata43</td>
<td></td>
<td>txdata59</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txckn</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata56</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata7</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txvld</td>
<td></td>
<td>txdata44</td>
<td></td>
<td>txdata60</td>
</tr>
<tr>
<td></td>
<td>txdata3</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>txdata39</td>
<td></td>
<td>txdata55</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>txdata45</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdata2</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata38</td>
<td></td>
<td>txdata54</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata46</td>
<td></td>
<td>txdata61</td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>txdataRD2</td>
<td></td>
<td>txdata47</td>
<td></td>
<td>txdata62</td>
</tr>
<tr>
<td></td>
<td>txdata1</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>txdata37</td>
<td></td>
<td>txdata53</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>txdata32</td>
<td></td>
<td>txdata48</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdata0</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata52</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata12</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata33</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata63</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>txdata36</td>
<td></td>
<td>txdata51</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>txdata34</td>
<td></td>
<td>txdata49</td>
<td></td>
<td>txdataRD3</td>
</tr>
<tr>
<td></td>
<td>txdataRD0</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>txdata35</td>
<td></td>
<td>txdata50</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
</table>

Die Edge

Note:
In Figure 5-23, at 45-um pitch, the module depth of the 10-column reference bump
matrix as shown is approximately 1043 um.

<table>
<caption>Figure 5-24. 16-column x64 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</caption>
<tr>
<th></th>
<th>Column0</th>
<th>Column1</th>
<th>Column2</th>
<th>Column3</th>
<th>Column4</th>
<th>Column5</th>
<th>Column6</th>
<th>Column7</th>
<th>Column8</th>
<th>Column9</th>
<th>Column10</th>
<th>Column11</th>
<th>Column12</th>
<th>Column13</th>
<th>Column14</th>
<th>Column15</th>
</tr>
<tr>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata54</td>
<td></td>
<td>rxdata50</td>
<td></td>
<td>rxdata35</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata 14</td>
<td></td>
<td>rxdata11</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata52</td>
<td></td>
<td>rxdata49</td>
<td></td>
<td>rxdata34</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata13</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata55</td>
<td></td>
<td>rxdata51</td>
<td></td>
<td>rxdata36</td>
<td></td>
<td>rxdataRD2</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata 15</td>
<td></td>
<td>rxdata 10</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>rxdataRD3</td>
<td></td>
<td>rxdata53</td>
<td></td>
<td>rxdata48</td>
<td></td>
<td>rxdata33</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata 12</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata 61</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata37</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td></td>
<td>rxdata63</td>
<td></td>
<td>rxdata56</td>
<td></td>
<td>rxdata47</td>
<td></td>
<td>rxdata32</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>rxdata 17</td>
<td></td>
<td>rxdata2</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata60</td>
<td></td>
<td>rxdata46</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata7</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata57</td>
<td></td>
<td>rxdata43</td>
<td></td>
<td>rxdata38</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>rxdata18</td>
<td></td>
<td>rxdata3</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>rxdata59</td>
<td></td>
<td>rxdata45</td>
<td></td>
<td>rxdata40</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata20</td>
<td></td>
<td>rxdata6</td>
<td></td>
<td>rxdata1</td>
</tr>
<tr>
<td></td>
<td>rxdata62</td>
<td></td>
<td>rxdata58</td>
<td></td>
<td>rxdata42</td>
<td></td>
<td>rxdata39</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata19</td>
<td></td>
<td>rxdata4</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata44</td>
<td></td>
<td>rxdata41</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>rxdata5</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata5</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>txdata41</td>
<td></td>
<td>txdata44</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata4</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>txckp</td>
<td></td>
<td>txdata39</td>
<td></td>
<td>txdata42</td>
<td></td>
<td>txdata58</td>
<td></td>
<td>txdata62</td>
</tr>
<tr>
<td></td>
<td>txdata1</td>
<td></td>
<td>txdata6</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txvld</td>
<td></td>
<td>txdata40</td>
<td></td>
<td>txdata45</td>
<td></td>
<td>txdata59</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata3</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>txckn</td>
<td></td>
<td>txdata38</td>
<td></td>
<td>txdata43</td>
<td></td>
<td>txdata57</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata7</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata46</td>
<td></td>
<td>txdata60</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata2</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>txdata32</td>
<td></td>
<td>txdata47</td>
<td></td>
<td>txdata56</td>
<td></td>
<td>txdata63</td>
</tr>
<tr>
<td></td>
<td>txdata0</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata37</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata61</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata33</td>
<td></td>
<td>txdata48</td>
<td></td>
<td>txdata53</td>
<td></td>
<td>txdataRD3</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>txdataRD2</td>
<td></td>
<td>txdata36</td>
<td></td>
<td>txdata51</td>
<td></td>
<td>txdata55</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>txdata34</td>
<td></td>
<td>txdata49</td>
<td></td>
<td>txdata52</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdataRD0</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata35</td>
<td></td>
<td>txdata50</td>
<td></td>
<td>txdata54</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
</table>

Die Edge

Note:
In Figure $5 - 2 4 ,$ at 25-um pitch, the module width of the 16-column reference bump
matrix as shown is approximately 388.8 um.

<table>
<caption>Figure 5-25. 8-column x64 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</caption>
<tr>
<th></th>
<th>Column0</th>
<th>Column1</th>
<th>Column2</th>
<th>Column3</th>
<th>Column4</th>
<th>Column5</th>
<th>$\mathrm { c o l u m n 6 }$</th>
<th>Column7</th>
</tr>
<tr>
<td rowspan="39"></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
</tr>
<tr>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata50</td>
<td></td>
<td>rxdata36</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td>rxdataRD3</td>
<td></td>
<td>rxdata49</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata13</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata51</td>
<td></td>
<td>rxdata35</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>rxdata48</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata12</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata52</td>
<td></td>
<td>rxdata34</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>rxdata63</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata11</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata53</td>
<td></td>
<td>rxdata33</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>rxdata1</td>
</tr>
<tr>
<td>rxdata62</td>
<td></td>
<td>rxdata47</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata10</td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>rxdata61</td>
<td></td>
<td>rxdata46</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>rxdata2</td>
</tr>
<tr>
<td>rxdata60</td>
<td></td>
<td>rxdata37</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata54</td>
<td></td>
<td>rxdata32</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata3</td>
</tr>
<tr>
<td>rxdata59</td>
<td></td>
<td>rxdata38</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata55</td>
<td></td>
<td>rxdataRD2</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata4</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>rxdata39</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata45</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>rxdata7</td>
</tr>
<tr>
<td>rxdata56</td>
<td></td>
<td>rxdata40</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata18</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>rxdata57</td>
<td></td>
<td>rxdata41</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata19</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata44</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata6</td>
</tr>
<tr>
<td>rxdata58</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata20</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata43</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>rxdata5</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>rxdata42</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata42</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>txdata5</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>txdata43</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata20</td>
<td></td>
<td>txckp</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata58</td>
</tr>
<tr>
<td>txdata6</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txvld</td>
<td></td>
<td>txdata44</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata19</td>
<td></td>
<td>txckn</td>
<td></td>
<td>txdata41</td>
<td></td>
<td>txdata57</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata18</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>txdata40</td>
<td></td>
<td>txdata56</td>
</tr>
<tr>
<td>txdata7</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata45</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata39</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdata4</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>txdataRD2</td>
<td></td>
<td>txdata55</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>txdata38</td>
<td></td>
<td>txdata59</td>
</tr>
<tr>
<td rowspan="2"></td>
<td>txdata3</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>txdata32</td>
<td></td>
<td>txdata54</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>txdata37</td>
<td></td>
<td>txdata60</td>
</tr>
<tr>
<td rowspan="2"></td>
<td>txdata2</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>txdata46</td>
<td></td>
<td>txdata61</td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>txdata47</td>
<td></td>
<td>txdata62</td>
</tr>
<tr>
<td rowspan="5"></td>
<td>txdata1</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>txdata33</td>
<td></td>
<td>txdata53</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata63</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>txdata34</td>
<td></td>
<td>txdata52</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata12</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata48</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>txdata0</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata35</td>
<td></td>
<td>txdata51</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>txdata49</td>
<td></td>
<td>txdataRD3</td>
</tr>
<tr>
<td></td>
<td>txdataRD0</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txdata36</td>
<td></td>
<td>txdata50</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td colspan="3">Die Edge</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td colspan="3"></td>
<td></td>
<td></td>
<td></td>
</tr>
</table>

Note:
In Figure 5-25, at 55-um pitch, the module depth of the 8-column reference bump
matrix as shown is approximately 1,585 um.

<table>
<caption>Figure 5-26 shows the signal exit order for the 10-column x64 Advanced Package bump map. Figure 5-26. 10-column x64 Advanced Package Bump map: Signal exit order</caption>
<tr>
<th colspan="20"></th>
</tr>
<tr>
<th rowspan="12"></th>
<th rowspan="6">Tx Breakout</th>
<th>Left to Right</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
<tr>
<th></th>
<th>txdataRD0</th>
<th>txdata0</th>
<th>txdata1</th>
<th>txdata2</th>
<th>txdata3</th>
<th>txdata4</th>
<th>txdata5</th>
<th>txdata6</th>
<th>txdata7</th>
<th>txdata8</th>
<th>txdata9</th>
<th>txdata10</th>
<th>txdata11</th>
<th>txdata12</th>
<th>txdata13</th>
<th>Cont ...</th>
<th rowspan="11"></th>
</tr>
<tr>
<td>Cont ...</td>
<td>txdata14</td>
<td>txdata15</td>
<td>txdata16</td>
<td>txdata17</td>
<td>txdata18</td>
<td>txdata19</td>
<td>txdata20</td>
<td>txdata21</td>
<td>txdata22</td>
<td>txdata23</td>
<td>txdata24</td>
<td>txdata25</td>
<td>txdata26</td>
<td>txdata27</td>
<td>txdata28</td>
<td>Cont1 ...</td>
</tr>
<tr>
<td>Cont1 ...</td>
<td>txdata29</td>
<td>txdata30</td>
<td>txdata31</td>
<td>txdataRD1</td>
<td>txckRD</td>
<td>txckn</td>
<td>txckp</td>
<td>txtrk</td>
<td>txvld</td>
<td>txvldRD</td>
<td>txdataRD2</td>
<td>txdata32</td>
<td>txdata33</td>
<td>txdata34</td>
<td>txdata35</td>
<td>Cont2 ...</td>
</tr>
<tr>
<td>Cont2 ...</td>
<td>txdata36</td>
<td>txdata37</td>
<td>txdata38</td>
<td>txdata39</td>
<td>txdata40</td>
<td>txdata41</td>
<td>txdata42</td>
<td>txdata43</td>
<td>txdata44</td>
<td>txdata45</td>
<td>txdata46</td>
<td>txdata47</td>
<td>txdata48</td>
<td>txdata49</td>
<td>txdata50</td>
<td>Cont3 ...</td>
</tr>
<tr>
<td>Cont3 ...</td>
<td>txdata51</td>
<td>txdata52</td>
<td>txdata53</td>
<td>txdata54</td>
<td>txdata55</td>
<td>txdata56</td>
<td>txdata57</td>
<td>txdata58</td>
<td>txdata59</td>
<td>txdata60</td>
<td>txdata61</td>
<td>txdata62</td>
<td>txdata63</td>
<td>txdataRD3</td>
<td></td>
<td></td>
</tr>
<tr>
<td rowspan="6">Rx Breakout</td>
<td>Left to Right</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdataRD3</td>
<td>rxdata63</td>
<td>rxdata62</td>
<td>rxdata61</td>
<td>rxdata60</td>
<td>rxdata59</td>
<td>rxdata58</td>
<td>rxdata57</td>
<td>rxdata56</td>
<td>rxdata55</td>
<td>rxdata54</td>
<td>rxdata53</td>
<td>rxdata52</td>
<td>rxdata51</td>
<td>rxdata50</td>
<td>Cont ...</td>
</tr>
<tr>
<td>Cont ...</td>
<td>rxdata49</td>
<td>rxdata48</td>
<td>rxdata47</td>
<td>rxdata46</td>
<td>rxdata45</td>
<td>rxdata44</td>
<td>rxdata43</td>
<td>rxdata42</td>
<td>rxdata41</td>
<td>rxdata40</td>
<td>rxdata39</td>
<td>rxdata38</td>
<td>rxdata37</td>
<td>rxdata36</td>
<td>rxdata35</td>
<td>Cont1 ...</td>
</tr>
<tr>
<td>Cont1 ...</td>
<td>rxdata34</td>
<td>rxdata33</td>
<td>rxdata32</td>
<td>rxdataRD2</td>
<td>rxvldRD</td>
<td>rxvld</td>
<td>rxtrk</td>
<td>rxckp</td>
<td>rxckn</td>
<td>rxckRD</td>
<td>rxdataRD1</td>
<td>rxdata31</td>
<td>rxdata30</td>
<td>rxdata29</td>
<td>rxdata28</td>
<td>Cont2 ...</td>
</tr>
<tr>
<td>Cont2 ...</td>
<td>rxdata27</td>
<td>rxdata26</td>
<td>rxdata25</td>
<td>rxdata24</td>
<td>rxdata23</td>
<td>rxdata22</td>
<td>rxdata21</td>
<td>rxdata20</td>
<td>rxdata19</td>
<td>rxdata18</td>
<td>rxdata17</td>
<td>rxdata16</td>
<td>rxdata15</td>
<td>rxdata14</td>
<td>rxdata13</td>
<td>Cont3 ...</td>
</tr>
<tr>
<td>Cont3 ...</td>
<td>rxdata12</td>
<td>rxdata11</td>
<td>rxdata10</td>
<td>rxdata9</td>
<td>rxdata8</td>
<td>rxdata7</td>
<td>rxdata6</td>
<td>rxdata5</td>
<td>rxdata4</td>
<td>rxdata3</td>
<td>rxdata2</td>
<td>rxdata1</td>
<td>rxdata0</td>
<td>rxdataRD0</td>
<td></td>
<td></td>
</tr>
</table>

#### IMPLEMENTATION NOTE

##### High-speed Considerations for x64 Bump Maps

Three reference bump maps in Figure 5-23, Figure 5-24, and Figure 5-25 are recommended for
different ranges of bump pitch, while PHY implementations have the flexibility to adjust the power
and ground bumps to meet channel characteristics and power delivery requirements, which largely
depend on the target speed and the advanced packaging technology capabilities.

At higher speeds, the PHY circuits draw larger current through the bumps and require better signal
and power integrity of the packaging solution. This typically requires adding power and ground
bumps and optimizing the distribution of them, but the implementation also needs to minimize the
lane-to-lane length skew and preserve the assignment and relative order of the signals in each
column to comply with the bump matrix rules in Section 5.7.2.2.

<table>
<caption>Table 5-19. Bump Map Options and the Recommended Bump Pitch Range and Corresponding Max Speed</caption>
<tr>
<th>Bump Map</th>
<th>Bump Pitch (um)</th>
<th>Max Speed $\left( \mathrm { G T } / \mathrm { s } \right)$</th>
</tr>
<tr>
<td rowspan="2">16 column</td>
<td>25-30</td>
<td>12</td>
</tr>
<tr>
<td>31-37</td>
<td>16</td>
</tr>
<tr>
<td rowspan="2">10 column</td>
<td>38-44</td>
<td>24</td>
</tr>
<tr>
<td>45-50</td>
<td>32</td>
</tr>
<tr>
<td>8 column</td>
<td>51-55</td>
<td>32</td>
</tr>
</table>

This Implementation Note is formulated to provide PHY implementations a set of reference x64
bump maps to encompass the max speed specified. Table 5-19 summarizes the corresponding max
speed for these bump map options and their recommended bump pitch ranges.

Bump maps in Figure 5-27, Figure 5-28, and Figure 5-29 are the x64 implementation references for
the corresponding max speed with an enhancement of the power and ground bumps. They all
comply with the bump matrix rules in Section 5.7.2.2, and they maintain the backward compatibility
in terms of signal exit order. These reference examples have been optimized for signal integrity,
power integrity, lane-to-lane skew, electro-migration stress and bump area based on most of the
advanced packaging technologies in the industry. Please note that technology requirements vary,
and it is still required to verify the bump map with the technology provider for actual implementation
requirements and performance targets.

# IMPLEMENTATION NOTE

## Continued

<table>
<caption>$F i g u r e \quad 5 - 2 7 .$ Enhanced 10-column x64 Advanced Package Bump Map Example for 32 GT/s Implementation</caption>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
<tr>
<td>1</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>3</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
</tr>
<tr>
<td>5</td>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td></td>
<td>rxdata50</td>
<td></td>
<td>rxdata35</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td>7</td>
<td>rxdataRD3</td>
<td></td>
<td>rxdata49</td>
<td></td>
<td>rxdata34</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata13</td>
<td></td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>rxdata51</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>9</td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata33</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata12</td>
<td></td>
</tr>
<tr>
<td>10</td>
<td></td>
<td>rxdata52</td>
<td></td>
<td>rxdata36</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>11</td>
<td>VSS</td>
<td></td>
<td>rxdata48</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata11</td>
<td></td>
</tr>
<tr>
<td>12</td>
<td></td>
<td>rxdata53</td>
<td></td>
<td>rxdata37</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td>13</td>
<td>rxdata63</td>
<td></td>
<td>rxdata47</td>
<td></td>
<td>rxdata32</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>rxdata10</td>
<td></td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>15</td>
<td>rxdata62</td>
<td></td>
<td>rxdata46</td>
<td></td>
<td>rxdataRD2</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td>16</td>
<td></td>
<td>rxdata54</td>
<td></td>
<td>rxdata38</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>rxdata1</td>
</tr>
<tr>
<td>17</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>18</td>
<td></td>
<td>rxdata55</td>
<td></td>
<td>rxdata39</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata18</td>
<td></td>
<td>rxdata2</td>
</tr>
<tr>
<td>19</td>
<td>rxdata61</td>
<td></td>
<td>rxdata45</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td>20</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>21</td>
<td>rxdata60</td>
<td></td>
<td>rxdata44</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>rxdata7</td>
<td></td>
</tr>
<tr>
<td>22</td>
<td></td>
<td>rxdata56</td>
<td></td>
<td>rxdata40</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata19</td>
<td></td>
<td>rxdata3</td>
</tr>
<tr>
<td>23</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>24</td>
<td></td>
<td>rxdata57</td>
<td></td>
<td>rxdata41</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata20</td>
<td></td>
<td>rxdata4</td>
</tr>
<tr>
<td>25</td>
<td>rxdata59</td>
<td></td>
<td>rxdata43</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata6</td>
<td></td>
</tr>
<tr>
<td>26</td>
<td></td>
<td>rxdata58</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>27</td>
<td>VSS</td>
<td></td>
<td>rxdata42</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata5</td>
<td></td>
</tr>
<tr>
<td>28</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
</tr>
<tr>
<td>29</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>30</td>
<td></td>
<td>txdata5</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata42</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>31</td>
<td>vccio</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txckp</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata58</td>
<td></td>
</tr>
<tr>
<td>32</td>
<td></td>
<td>txdata6</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>txdata43</td>
<td></td>
<td>txdata59</td>
</tr>
<tr>
<td>33</td>
<td>txdata4</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txckn</td>
<td></td>
<td>txdata41</td>
<td></td>
<td>txdata57</td>
<td></td>
</tr>
<tr>
<td>34</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>35</td>
<td>txdata3</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>txdata40</td>
<td></td>
<td>txdata56</td>
<td></td>
</tr>
<tr>
<td>36</td>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>txvld</td>
<td></td>
<td>txdata44</td>
<td></td>
<td>txdata60</td>
</tr>
<tr>
<td>37</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>38</td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>txdata45</td>
<td></td>
<td>txdata61</td>
</tr>
<tr>
<td>39</td>
<td>txdata2</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata39</td>
<td></td>
<td>txdata55</td>
<td></td>
</tr>
<tr>
<td>40</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>41</td>
<td>txdata1</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>txdata38</td>
<td></td>
<td>txdata54</td>
<td></td>
</tr>
<tr>
<td>42</td>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>txdataRD2</td>
<td></td>
<td>txdata46</td>
<td></td>
<td>txdata62</td>
</tr>
<tr>
<td>43</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>44</td>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>txdata32</td>
<td></td>
<td>txdata47</td>
<td></td>
<td>txdata63</td>
</tr>
<tr>
<td>45</td>
<td>txdata0</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>txdata37</td>
<td></td>
<td>txdata53</td>
<td></td>
</tr>
<tr>
<td>46</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata48</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>47</td>
<td>vccio</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>txdata36</td>
<td></td>
<td>txdata52</td>
<td></td>
</tr>
<tr>
<td>48</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata33</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>49</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata51</td>
<td></td>
</tr>
<tr>
<td>50</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>txdata34</td>
<td></td>
<td>txdata49</td>
<td></td>
<td>txdataRD3</td>
</tr>
<tr>
<td>51</td>
<td>txdataRD0</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>txdata35</td>
<td></td>
<td>txdata50</td>
<td></td>
</tr>
<tr>
<td>52</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>53</td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td colspan="2"></td>
<td></td>
<td></td>
<td colspan="3">Die Edge</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td colspan="10"></td>
<td></td>
</tr>
</table>

Note:
In Figure 5-27, at 45-um pitch, the module depth of the 10-column bump map as
shown is approximately 1225 um. Rows 1, 2, and 53 are required for packaging
solutions using floating bridges without through-silicon vias (TSVs). They can be
optional for packaging solutions with TSVs.

# IMPLEMENTATION NOTE

## Continued

<table>
<caption>Figure 5-28. Enhanced 16-column x64 Advanced Package Bump Map Example for 16 GT/s Implementation</caption>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
<th>12</th>
<th>13</th>
<th>14</th>
<th>15</th>
<th>16</th>
</tr>
<tr>
<td>1</td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>3</td>
<td>txdatasbRD</td>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
<td>$r x d a t a s b R D$</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>rxdata54</td>
<td></td>
<td>rxdata50</td>
<td></td>
<td>rxdata35</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxdata11</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td>5</td>
<td>rxdataRD3</td>
<td></td>
<td>rxdata52</td>
<td></td>
<td>rxdata49</td>
<td></td>
<td>rxdata34</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata13</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td></td>
<td>rxdata55</td>
<td></td>
<td>rxdata51</td>
<td></td>
<td>rxdata36</td>
<td></td>
<td>rxdataRD2</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>rxdata10</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>7</td>
<td>VSS</td>
<td></td>
<td>rxdata53</td>
<td></td>
<td>rxdata48</td>
<td></td>
<td>rxdata33</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata12</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>rxdata61</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata37</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata7</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>9</td>
<td>rxdata63</td>
<td></td>
<td>rxdata56</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata32</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata2</td>
<td></td>
</tr>
<tr>
<td>10</td>
<td></td>
<td>vccio</td>
<td></td>
<td>$r x d a t a 4 6$</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td>11</td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata47</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>12</td>
<td></td>
<td>rxdata60</td>
<td></td>
<td>rxdata45</td>
<td></td>
<td>rxdata40</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata20</td>
<td></td>
<td>rxdata6</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>13</td>
<td>rxdata62</td>
<td></td>
<td>rxdata57</td>
<td></td>
<td>rxdata43</td>
<td></td>
<td>rxdata38</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>rxdata 18</td>
<td></td>
<td>rxdata3</td>
<td></td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>rxdata59</td>
<td></td>
<td>rxdata44</td>
<td></td>
<td>rxdata41</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>rxdata5</td>
<td></td>
<td>rxdata1</td>
</tr>
<tr>
<td>15</td>
<td>VSS</td>
<td></td>
<td>rxdata58</td>
<td></td>
<td>rxdata42</td>
<td></td>
<td>rxdata39</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata 19</td>
<td></td>
<td>rxdata4</td>
<td></td>
</tr>
<tr>
<td>16</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>17</td>
<td>VSS</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
<tr>
<td>18</td>
<td></td>
<td>txdata4</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>txckp</td>
<td></td>
<td>txdata39</td>
<td></td>
<td>txdata42</td>
<td></td>
<td>txdata58</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>19</td>
<td>txdata1</td>
<td></td>
<td>txdata5</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>$t x t r k$</td>
<td></td>
<td>txdata41</td>
<td></td>
<td>txdata44</td>
<td></td>
<td>txdata59</td>
<td></td>
</tr>
<tr>
<td>20</td>
<td></td>
<td>txdata3</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>txckn</td>
<td></td>
<td>txdata38</td>
<td></td>
<td>txdata43</td>
<td></td>
<td>txdata57</td>
<td></td>
<td>txdata62</td>
</tr>
<tr>
<td>21</td>
<td>VSS</td>
<td></td>
<td>txdata6</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>txvld</td>
<td></td>
<td>txdata40</td>
<td></td>
<td>txdata45</td>
<td></td>
<td>txdata60</td>
<td></td>
</tr>
<tr>
<td>22</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata47</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>23</td>
<td>txdata0</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata46</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>24</td>
<td></td>
<td>txdata2</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata32</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata56</td>
<td></td>
<td>txdata63</td>
</tr>
<tr>
<td>25</td>
<td>VSS</td>
<td></td>
<td>txdata7</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata37</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata61</td>
<td></td>
</tr>
<tr>
<td>26</td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>txdata33</td>
<td></td>
<td>txdata48</td>
<td></td>
<td>txdata53</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>27</td>
<td>VSS</td>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>txdataRD2</td>
<td></td>
<td>txdata36</td>
<td></td>
<td>txdata51</td>
<td></td>
<td>txdata55</td>
<td></td>
</tr>
<tr>
<td>28</td>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata34</td>
<td></td>
<td>txdata49</td>
<td></td>
<td>txdata52</td>
<td></td>
<td>txdataRD3</td>
</tr>
<tr>
<td>29</td>
<td>txdataRD0</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata35</td>
<td></td>
<td>txdata50</td>
<td></td>
<td>txdata54</td>
<td></td>
</tr>
<tr>
<td>30</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>31</td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td colspan="17">Die Edge</td>
</tr>
</table>

Note:
In Figure 5-28, at 25-um pitch, the module depth of the 16-column bump map as
shown is approximately 400 um. Rows 1 and 31 are required for packaging solutions
using floating bridges without TSVs. They can be optional for packaging solutions
with TSVs.

# IMPLEMENTATION NOTE

## Continued

Figure 5-29.

<figure>
<figcaption>Enhanced 8-column x64 Advanced Package Bump Map Example for 32 GT/s Implementation</figcaption>
</figure>

<table>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
</tr>
<tr>
<th>1</th>
<th>VSS</th>
<th></th>
<th>vccio</th>
<th></th>
<th>vccio</th>
<th></th>
<th>VSS</th>
<th></th>
</tr>
<tr>
<td>2</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>3</td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
</tr>
<tr>
<td>5</td>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td></td>
<td>rxdata50</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td>7</td>
<td>$r x d a t a R D 3$</td>
<td></td>
<td>rxdata49</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata13</td>
<td></td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata36</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>9</td>
<td>rxdata63</td>
<td></td>
<td>rxdata48</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata12</td>
<td></td>
</tr>
<tr>
<td>10</td>
<td></td>
<td>$r x d a t a 5 1$</td>
<td></td>
<td>rxdata35</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td>11</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>12</td>
<td></td>
<td>rxdata52</td>
<td></td>
<td>rxdata34</td>
<td></td>
<td>$r x d a t a 1 6$</td>
<td></td>
<td>rxdata1</td>
</tr>
<tr>
<td>13</td>
<td>$r x d a t a 6 2$</td>
<td></td>
<td>$r x d a t a 4 7$</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata11</td>
<td></td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>15</td>
<td>rxdata61</td>
<td></td>
<td>rxdata46</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata10</td>
<td></td>
</tr>
<tr>
<td>16</td>
<td></td>
<td>rxdata53</td>
<td></td>
<td>rxdata33</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>rxdata2</td>
</tr>
<tr>
<td>17</td>
<td>rxdata60</td>
<td></td>
<td>rxdata37</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td>18</td>
<td></td>
<td>rxdata54</td>
<td></td>
<td>rxdata32</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>rxdata3</td>
</tr>
<tr>
<td>19</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>20</td>
<td></td>
<td>rxdata55</td>
<td></td>
<td>rxdataRD2</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata4</td>
</tr>
<tr>
<td>21</td>
<td>$r x d a t a 5 9$</td>
<td></td>
<td>rxdata38</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td>22</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>23</td>
<td>rxdata56</td>
<td></td>
<td>rxdata39</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata18</td>
<td></td>
</tr>
<tr>
<td>24</td>
<td></td>
<td>rxdata45</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>rxdata7</td>
</tr>
<tr>
<td>25</td>
<td>VSS</td>
<td></td>
<td>rxdata40</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>26</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata6</td>
</tr>
<tr>
<td>27</td>
<td>rxdata57</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata19</td>
<td></td>
</tr>
<tr>
<td>28</td>
<td></td>
<td>rxdata44</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>29</td>
<td>rxdata58</td>
<td></td>
<td>rxdata41</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata20</td>
<td></td>
</tr>
<tr>
<td>30</td>
<td></td>
<td>rxdata43</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>rxdata5</td>
</tr>
<tr>
<td>31</td>
<td>VSS</td>
<td></td>
<td>rxdata42</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>32</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
</tr>
<tr>
<td>33</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>34</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txckp</td>
<td></td>
<td>txdata42</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>35</td>
<td>txdata5</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>txdata43</td>
<td></td>
</tr>
<tr>
<td>36</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txckn</td>
<td></td>
<td>txdata41</td>
<td></td>
<td>txdata58</td>
</tr>
<tr>
<td>37</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata44</td>
<td></td>
</tr>
<tr>
<td>38</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>$\mathrm { t x c k R D }$</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata57</td>
</tr>
<tr>
<td>39</td>
<td>txdata6</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>txvld</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>40</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata40</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>41</td>
<td>txdata7</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>txdata45</td>
<td></td>
</tr>
<tr>
<td>42</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata39</td>
<td></td>
<td>txdata56</td>
</tr>
<tr>
<td>43</td>
<td>VSS</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>44</td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>txdata38</td>
<td></td>
<td>txdata59</td>
</tr>
<tr>
<td>45</td>
<td>txdata4</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>txdataRD2</td>
<td></td>
<td>txdata55</td>
<td></td>
</tr>
<tr>
<td>46</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>47</td>
<td>txdata3</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>txdata32</td>
<td></td>
<td>txdata54</td>
<td></td>
</tr>
<tr>
<td>48</td>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>txdata37</td>
<td></td>
<td>txdata60</td>
</tr>
<tr>
<td>49</td>
<td>txdata2</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>txdata33</td>
<td></td>
<td>txdata53</td>
<td></td>
</tr>
<tr>
<td>50</td>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>txdata46</td>
<td></td>
<td>txdata61</td>
</tr>
<tr>
<td>51</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>52</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>txdata47</td>
<td></td>
<td>txdata62</td>
</tr>
<tr>
<td>53</td>
<td>txdata1</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>txdata34</td>
<td></td>
<td>txdata52</td>
<td></td>
</tr>
<tr>
<td>54</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>55</td>
<td>txdata0</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata35</td>
<td></td>
<td>txdata51</td>
<td></td>
</tr>
<tr>
<td>56</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>txdata48</td>
<td></td>
<td>txdata63</td>
</tr>
<tr>
<td>57</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata36</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>58</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>txdata49</td>
<td></td>
<td>txdataRD3</td>
</tr>
<tr>
<td>59</td>
<td>txdataRD0</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata50</td>
<td></td>
</tr>
<tr>
<td>60</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>61</td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td colspan="2"></td>
<td colspan="4">Die Edge</td>
<td></td>
</tr>
<tr>
<td></td>
<td colspan="8"></td>
</tr>
</table>

Note:
In Figure 5-29, at 55-um pitch, the module depth of the 8-column bump map as
shown is approximately 1705 um. Rows 1, 2, and 61 are required for packaging
solutions using floating bridges without TSVs. They can be optional for packaging
solutions with TSVs.

### 5.7.2.2.1 x64 Advanced Package Module Bump Map for 48 GT/s and 64 GT/s

Figure 5-30 illustrates bump configurations for Advanced Package modules that operate at data rates
of 48 GT/s and 64 GT/s. In comparison to the configuration for 32 GT/s, additional power and ground
bumps have been incorporated. This is designed to mitigate the impact of increased crosstalk at
higher data rates and to accommodate the higher total current. It should be noted that additional
bump maps or further optimizations may be introduced in subsequent updates to this specification.

<table>
<caption>Figure 5-30. 10-column x64 Advanced Package Bump Map for 48 GT/s and 64 GT/s</caption>
<tr>
<th rowspan="69"></th>
<th>Column 1</th>
<th>Column 2</th>
<th>Column 3</th>
<th>Column 4</th>
<th>Column 5</th>
<th>Column 6</th>
<th>Column 7</th>
<th>Column 8</th>
<th>Column 9</th>
<th>Column 10</th>
<th></th>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
<td></td>
</tr>
<tr>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata50</td>
<td></td>
<td>rxdata35</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>rxdataRD3</td>
<td></td>
<td>rxdata49</td>
<td></td>
<td>rxdata34</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata13</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata 12</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata51</td>
<td></td>
<td>rxdata36</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>rxdataRD0</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>rxdata48</td>
<td></td>
<td>rxdata33</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata52</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>rxdata63</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata11</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata37</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>rxdata47</td>
<td></td>
<td>rxdata32</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>rxdata10</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata53</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata0</td>
<td></td>
</tr>
<tr>
<td>rxdata62</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata38</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>rxdata46</td>
<td></td>
<td>rxdataRD2</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata9</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata54</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata1</td>
<td></td>
</tr>
<tr>
<td>rxdata61</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata39</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata18</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>rxdata45</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata8</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata55</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata2</td>
<td></td>
</tr>
<tr>
<td>rxdata60</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata40</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata19</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>rxdata44</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>rxdata7</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata56</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata3</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata6</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata57</td>
<td></td>
<td>rxdata41</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata20</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>rxdata59</td>
<td></td>
<td>rxdata43</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata4</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>rxdata42</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata5</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata58</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata58</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata5</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata42</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>txdata4</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txckp</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata43</td>
<td></td>
<td>txdata59</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txckn</td>
<td></td>
<td>txdata41</td>
<td></td>
<td>txdata57</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata6</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>txdata3</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata56</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata44</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata40</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txvld</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata60</td>
<td></td>
</tr>
<tr>
<td>txdata2</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata55</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>txdata45</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata39</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata61</td>
<td></td>
</tr>
<tr>
<td>txdata1</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata54</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>txdataRD2</td>
<td></td>
<td>txdata46</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>txdata38</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata62</td>
<td></td>
</tr>
<tr>
<td>txdata0</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata53</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>txdata32</td>
<td></td>
<td>txdata47</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>txdata37</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata11</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata63</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata52</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>txdata33</td>
<td></td>
<td>txdata48</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>txdataRD0</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>txdata36</td>
<td></td>
<td>txdata51</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata12</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>txdata34</td>
<td></td>
<td>txdata49</td>
<td></td>
<td>txdataRD3</td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>txdata35</td>
<td></td>
<td>txdata50</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td colspan="11">Die Edge</td>
</tr>
<tr>
<td></td>
<td colspan="11"></td>
</tr>
</table>

### 5.7.2.3 x32 Advanced Package Module Bump Map

UCIe also defines a x32 Advanced Package Module that supports 32 Tx and 32 Rx data signals and
two redundant bumps each for Tx and two for Rx (total of four) for lane-repair functions. All other
signals, including the sidebands, are the same as those of the x64 Advanced Package.

Figure 5-31, Figure 5-32, and Figure 5-33 show the reference bump matrix for the 10-column, 16-
column, and 8-column x32 Advanced Package Modules, respectively. The lower left corner of the
bump map will be considered "origin" of a bump matrix and the leftmost column is Column 0.

It is strongly recommended to follow the bump matrices provided in Figure 5-31, Figure 5-32, and
Figure 5-33 for x32 Advanced Package Modules.

The following rule must be followed for the 10-column x32 Advanced Package bump matrix:

· The signals order within a column must be preserved. For example, Column 0 must contain the
signals: txdataRD0, txdata0, txdata1, txdata2, txdata3, txdata4, and txdatasbRD.
Similarly, 16-column and 8-column x32 Advanced Packages must preserve the signal order within
a column of the respective bump matrices.

It is strongly recommended to follow the supply and ground pattern shown in the bump matrices. It
must be ensured that sufficient supply and ground bumps are provided to meet channel
characteristics (FEXT and NEXT) and power-delivery requirements.

When instantiating multiple x32 Advanced Package Modules, the same rules as defined in
Section 5.7.2.2 must be followed.

<table>
<caption>Figure 5-31. 10-column x32 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</caption>
<tr>
<th>Column0</th>
<th>Column1</th>
<th>Column2</th>
<th>Column3</th>
<th>Column4</th>
<th>Column5</th>
<th>Column6</th>
<th>Column7</th>
<th>Column8</th>
<th>Column9</th>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
</tr>
<tr>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txckp</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata13</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata5</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txckn</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata12</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata6</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td>txdata4</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata11</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata10</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td>txdata3</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>rxdata1</td>
</tr>
<tr>
<td>txdata2</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>txvld</td>
<td></td>
<td>$r x d a t a 2 5$</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata9</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>$r x d a t a 1 8$</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata19</td>
<td></td>
<td>rxdata2</td>
</tr>
<tr>
<td>txdata1</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata20</td>
<td></td>
<td>rxdata3</td>
</tr>
<tr>
<td>txdata0</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata7</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata12</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>rxdata6</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>rxdata4</td>
</tr>
<tr>
<td>txdataRD0</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata5</td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
</table>

Die Edge

Note:
In Figure 5-31, at 45-um pitch, the module depth of the 10-column reference bump
matrix as shown is approximately 680.5 um.

<table>
<caption>Figure 5-32. 16-column x32 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</caption>
<tr>
<th></th>
<th>Column0</th>
<th>Column1</th>
<th>Column2</th>
<th>Column3</th>
<th>Column4</th>
<th>Column5</th>
<th>Column6</th>
<th>Column7</th>
<th>Column8</th>
<th>Column9</th>
<th>Column10</th>
<th>Column11</th>
<th>Column12</th>
<th>Column13</th>
<th>Column14</th>
<th>Column15</th>
</tr>
<tr>
<th></th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdatasbRD</td>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
<td>rxdatasbRD</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata5</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata4</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>rxdata13</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td></td>
<td>txdata2</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txckp</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata 14</td>
<td></td>
<td>rxdata11</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata3</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata 12</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdata1</td>
<td></td>
<td>txdata6</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txckn</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>rxdata10</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata8</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txvld</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata18</td>
<td></td>
<td>rxdata7</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdata0</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata19</td>
<td></td>
<td>rxdata6</td>
<td></td>
<td>rxdata1</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata3</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>rxdata5</td>
<td></td>
<td>rxdata2</td>
</tr>
<tr>
<td></td>
<td>txdataRD0</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata20</td>
<td></td>
<td>rxdata4</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
<tr>
<td></td>
<td colspan="4"></td>
<td></td>
<td></td>
<td colspan="4">Die Edge</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</table>

Note:
In Figure $5 - 3 2 ,$ at 25-um pitch, the module depth of the 16-column reference bump
matrix as shown is approximately 237.5 um.

<table>
<caption>Figure 5-33. 8-column x32 Advanced Package Bump Map for $< = 3 2 \quad G T / s$</caption>
<tr>
<th></th>
<th>Column0</th>
<th>Column1</th>
<th>Column2</th>
<th>Column3</th>
<th>Column4</th>
<th>Column5</th>
<th>Column6</th>
<th>Column7</th>
</tr>
<tr>
<th rowspan="2"></th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
</tr>
<tr>
<td></td>
<td>txdata5</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata13</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata22</td>
<td></td>
<td>txckp</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td></td>
<td>txdata6</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata12</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txckn</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>rxdata11</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata20</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata10</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>rxdata1</td>
</tr>
<tr>
<td></td>
<td>txdata4</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata18</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdata3</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata17</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata2</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txvld</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata3</td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata9</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdata2</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata17</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata10</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata4</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata18</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata7</td>
</tr>
<tr>
<td></td>
<td>txdata1</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata19</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td>txdata0</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata20</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata12</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata6</td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata21</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>rxdata5</td>
</tr>
<tr>
<td></td>
<td>txdataRD0</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata22</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
<tr>
<td></td>
<td colspan="8">Die Edge</td>
</tr>
</table>

Note:
In Figure 5-33, at 55-um pitch, the module depth of the 8-column reference bump
matrix as shown is approximately 962.5 um.

<table>
<caption>Figure 5-34 shows the signal exit order for the 10-column x32 Advanced Package bump map. Figure 5-34. 10-column x32 Advanced Package Bump Map: Signal Exit Order</caption>
<tr>
<td rowspan="5">$T x$ Breakout</td>
<td>Left to Right</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdataRD0</td>
<td>txdata0</td>
<td>txdata1</td>
<td>txdata2</td>
<td>txdata3</td>
<td>txdata4</td>
<td>txdata5</td>
<td>txdata6</td>
<td>txdata7</td>
<td>txdata8</td>
<td>Cont ...</td>
</tr>
<tr>
<td>Cont ...</td>
<td>txdata9</td>
<td>txdata10</td>
<td>txdata11</td>
<td>txdata12</td>
<td>txdata13</td>
<td>txdata14</td>
<td>txdata15</td>
<td>txdata16</td>
<td>txdata17</td>
<td>txdata18</td>
<td>Cont1 ..</td>
</tr>
<tr>
<td>Cont1 ...</td>
<td>txdata19</td>
<td>txdata20</td>
<td>txdata21</td>
<td>txdata22</td>
<td>txdata23</td>
<td>txdata24</td>
<td>txdata25</td>
<td>txdata26</td>
<td>txdata27</td>
<td>txdata28</td>
<td>Cont2 ...</td>
</tr>
<tr>
<td>$\mathrm { c o n t 2 } .$</td>
<td>txdata29</td>
<td>txdata30</td>
<td>txdata31</td>
<td>txdataRD1</td>
<td>txvldRD</td>
<td>txvld</td>
<td>txtrk</td>
<td>txckRD</td>
<td>txckn</td>
<td>txckp</td>
<td></td>
</tr>
<tr>
<td rowspan="5">Rx Breakout</td>
<td>Left to Right</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxckp</td>
<td>rxckn</td>
<td>rxckRD</td>
<td>rxtrk</td>
<td>rxvld</td>
<td>rxvldRD</td>
<td>rxdataRD1</td>
<td>rxdata31</td>
<td>rxdata30</td>
<td>rxdata29</td>
<td>Cont ...</td>
</tr>
<tr>
<td>Cont ...</td>
<td>rxdata28</td>
<td>rxdata27</td>
<td>rxdata26</td>
<td>rxdata25</td>
<td>rxdata24</td>
<td>rxdata23</td>
<td>rxdata22</td>
<td>rxdata21</td>
<td>rxdata20</td>
<td>rxdata19</td>
<td>$\cot 1 .$</td>
</tr>
<tr>
<td>Cont1 ...</td>
<td>rxdata18</td>
<td>$r x d a t a 1 7$</td>
<td>rxdata16</td>
<td>rxdata15</td>
<td>rxdata14</td>
<td>rxdata13</td>
<td>rxdata12</td>
<td>rxdata11</td>
<td>rxdata10</td>
<td>rxdata9</td>
<td>$\cot 2 \ldots .$</td>
</tr>
<tr>
<td>Cont2 ...</td>
<td>rxdata8</td>
<td>rxdata7</td>
<td>rxdata6</td>
<td>rxdata5</td>
<td>rxdata4</td>
<td>rxdata3</td>
<td>rxdata2</td>
<td>rxdata1</td>
<td>rxdata0</td>
<td>rxdataRD0</td>
<td></td>
</tr>
</table>

# IMPLEMENTATION NOTE

## High-speed Considerations for x32 Bump Maps

This Implementation Note is formulated to provide PHY implementations a set of reference x32
bump maps to encompass the max speed specified.

Bump maps in Figure 5-35, Figure 5-36, and Figure 5-37 are the x32 implementation references for
the corresponding max speed with an enhancement of the power and ground bumps. They all
comply with the bump matrix rules in Section 5.7.2.3, and they maintain the backward compatibility
in terms of signal exit order. These reference examples have been optimized for signal integrity,
power integrity, lane-to-lane skew, electro-migration stress and bump area based on most of the
advanced packaging technologies in the industry. Please note that technology requirements vary,
and it is still required to verify the bump map with the technology provider for actual implementation
requirements and performance targets.

These bump maps have been optimized to minimize the lane to-lane routing mismatch, which is not
avoidable when two different bumps at different bump pitches interoperate. Table 5-20 summarizes
the max skew due to bump locations for the representative cases. As a rule of thumb, each 150-um
mismatch causes about 1-ps timing skew. This skew can be reduced or eliminated by the length
matching effort in package channel layout design.

<table>
<caption>Table 5-20. Maximum Systematic Lane-to-lane Length Mismatch in um between the Reference Bump Maps in the Implementation Note</caption>
<tr>
<th>Rx</th>
<th rowspan="2">{ 1 6 - c o l u m n }<br>{ \times 6 4 a t 2 5 u n }</th>
<th rowspan="2">16-column x32 at 25 um</th>
<th rowspan="2">10-column x64 at 45 um</th>
<th rowspan="2">10-column x32 at 45 um</th>
<th rowspan="2">{ 8 - \mathrm { c o l u m n } }<br>{ \times 6 4 \text { at } 5 5 \text { um } }</th>
<th rowspan="2">$8 - \mathrm { c o l u m n }$</th>
</tr>
<tr>
<th>Tx</th>
</tr>
<tr>
<td>{ 1 6 - \mathrm { c o l u m n } x 6 4 }<br>{ \text { at } 2 5 \text { um } }</td>
<td>0</td>
<td>125</td>
<td>351</td>
<td>399</td>
<td>560</td>
<td>605</td>
</tr>
<tr>
<td>{ 1 6 - c 0 l u m n \times 3 2 }<br>{ a t 2 5 u m }</td>
<td></td>
<td>0</td>
<td>351</td>
<td>393</td>
<td>563</td>
<td>618</td>
</tr>
<tr>
<td>$1 0 - \mathrm { c o l u m } n \times 6 4$</td>
<td></td>
<td></td>
<td>0</td>
<td>159</td>
<td>351</td>
<td>463</td>
</tr>
<tr>
<td>$1 0 - \mathrm { c o l u m n } \times 3 2$</td>
<td></td>
<td></td>
<td></td>
<td>0</td>
<td>428</td>
<td>398</td>
</tr>
<tr>
<td>$8 - \mathrm { c o l u m n } \times 6 4$</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>0</td>
<td>468</td>
</tr>
<tr>
<td>{ 8 - \mathrm { c o l u m } n \times 3 2 }<br>{ \text { at } 5 5 \text { um } }</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>0</td>
</tr>
</table>

# IMPLEMENTATION NOTE

## Continued

<table>
<caption>Figure 5-35. Enhanced 10-column x32 Advanced Package Bump Map Example for 32 GT/s Implementation</caption>
<tr>
<th rowspan="2">1</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th colspan="2">10</th>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td colspan="2">VSS</td>
</tr>
<tr>
<td>3</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
<td></td>
</tr>
<tr>
<td>6</td>
<td></td>
<td>txdata5</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>txdata4</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txckp</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata13</td>
<td></td>
<td></td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>txdata6</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdataRD0</td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txckn</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata12</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10</td>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>11</td>
<td>vccio</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>12</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>rxdata0</td>
<td></td>
</tr>
<tr>
<td>13</td>
<td>txdata3</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata11</td>
<td></td>
<td></td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata1</td>
<td></td>
</tr>
<tr>
<td>15</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata10</td>
<td></td>
<td></td>
</tr>
<tr>
<td>16</td>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>17</td>
<td>txdata2</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>txvld</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>18</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>rxdata18</td>
<td></td>
<td>rxdata2</td>
<td></td>
</tr>
<tr>
<td>19</td>
<td>vccio</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata9</td>
<td></td>
<td></td>
</tr>
<tr>
<td>20</td>
<td></td>
<td>txdata10</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td>21</td>
<td>txdata1</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata8</td>
<td></td>
<td></td>
</tr>
<tr>
<td>22</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata19</td>
<td></td>
<td>rxdata3</td>
<td></td>
</tr>
<tr>
<td>23</td>
<td>txdata0</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td></td>
</tr>
<tr>
<td>24</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata20</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>25</td>
<td>VSS</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>rxdata7</td>
<td></td>
<td></td>
</tr>
<tr>
<td>26</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>27</td>
<td>txdataRD0</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata6</td>
<td></td>
<td></td>
</tr>
<tr>
<td>28</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>rxdata4</td>
<td></td>
</tr>
<tr>
<td>29</td>
<td>VSS</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata5</td>
<td></td>
<td></td>
</tr>
<tr>
<td>30</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
<tr>
<td>31</td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="2">Die Edge</td>
<td></td>
<td></td>
<td></td>
<td colspan="2"></td>
</tr>
</table>

Note:
In Figure 5-35, at 45-um pitch, the module depth of the 10-column bump map as
shown is approximately 725 um. Rows 1, 2, and 31 are required for packaging
solutions using floating bridges without through-silicon vias (TSVs). They can be
optional for packaging solutions with TSVs. The vccfwdio bumps are required for the
tightly coupled mode up to 16 GT/s. For higher speeds, the vccfwdio bumps may be
connected to the vccio bumps in package.

# IMPLEMENTATION NOTE

## Continued

<table>
<caption>Figure 5-36. Enhanced 16-column x32 Advanced Package Bump Map Example for 16 GT/s Implementation</caption>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
<th>12</th>
<th>13</th>
<th>14</th>
<th>15</th>
<th>16</th>
<th></th>
</tr>
<tr>
<td>1</td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>txdatasbRD</td>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
<td>rxdatasbRD</td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>txdata4</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>rxdata13</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>VSS</td>
<td></td>
<td>txdata5</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txckp</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata 14</td>
<td></td>
<td>rxdata11</td>
<td></td>
<td></td>
</tr>
<tr>
<td>6</td>
<td></td>
<td>txdata3</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata12</td>
<td></td>
<td>rxdataRD0</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>txdata2</td>
<td></td>
<td>txdata6</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txckn</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata10</td>
<td></td>
<td></td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata7</td>
<td></td>
<td>rxdata0</td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>txdata1</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>rxdata9</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10</td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txvld</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata18</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>11</td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>rxdata8</td>
<td></td>
<td></td>
</tr>
<tr>
<td>12</td>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata19</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata1</td>
<td></td>
</tr>
<tr>
<td>13</td>
<td>txdata0</td>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>vccio</td>
<td></td>
<td></td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>txdata10</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata6</td>
<td></td>
<td>rxdata2</td>
<td></td>
</tr>
<tr>
<td>15</td>
<td>txdataRD0</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata3</td>
<td></td>
<td></td>
</tr>
<tr>
<td>16</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>rxdata5</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>17</td>
<td>VSS</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata20</td>
<td></td>
<td>rxdata4</td>
<td></td>
<td></td>
</tr>
<tr>
<td>18</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
<tr>
<td>19</td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="4">Die Edge</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="2"></td>
</tr>
</table>

Note:
In Figure 5-36, at 25-um pitch, the module depth of the 16-column bump map as
shown is approximately 250 um. Rows 1 and 19 are required for packaging solutions
using floating bridges without TSVs. They can be optional for packaging solutions with
TSVs. The vccfwdio bumps are required for the tightly coupled mode up to 16 GT/s.
For higher speeds, the vccfwdio bumps may be connected to the vccio bumps
in package.

# IMPLEMENTATION NOTE

## Continued

<figure>
</figure>

<table>
<tr>
<th colspan="9">Figure 5-37. Enhanced 8-column x32 Advanced Package Bump Map Example for 32 GT/s Implementation</th>
</tr>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
</tr>
<tr>
<td>1</td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>3</td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
</tr>
<tr>
<td>5</td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>txckp</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td>7</td>
<td>VSS</td>
<td></td>
<td>txdata23</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata13</td>
<td></td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>txckn</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>9</td>
<td>txdata5</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata12</td>
<td></td>
</tr>
<tr>
<td>10</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td>11</td>
<td>txdata6</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>rxdata11</td>
<td></td>
</tr>
<tr>
<td>12</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txckRD</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>rxdata1</td>
</tr>
<tr>
<td>13</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata2</td>
</tr>
<tr>
<td>15</td>
<td>txdata7</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>rxdataRD1</td>
<td></td>
<td>rxdata10</td>
<td></td>
</tr>
<tr>
<td>16</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata3</td>
</tr>
<tr>
<td>17</td>
<td>vccio</td>
<td></td>
<td>txdata26</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td>18</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>txvld</td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>19</td>
<td>txdata4</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td>20</td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata4</td>
</tr>
<tr>
<td>21</td>
<td>VSS</td>
<td></td>
<td>txdata27</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>rxdata17</td>
<td></td>
</tr>
<tr>
<td>22</td>
<td></td>
<td>txdata9</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>23</td>
<td>txdata3</td>
<td></td>
<td>txdata28</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata18</td>
<td></td>
</tr>
<tr>
<td>24</td>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata7</td>
</tr>
<tr>
<td>25</td>
<td>txdata2</td>
<td></td>
<td>txdata29</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata19</td>
<td></td>
</tr>
<tr>
<td>26</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
</tr>
<tr>
<td>27</td>
<td>txdata1</td>
<td></td>
<td>txdata16</td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata20</td>
<td></td>
</tr>
<tr>
<td>28</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata6</td>
</tr>
<tr>
<td>29</td>
<td>txdata0</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td>30</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>txdata30</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>rxdata5</td>
</tr>
<tr>
<td>31</td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata21</td>
<td></td>
</tr>
<tr>
<td>32</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>33</td>
<td>txdataRD0</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata22</td>
<td></td>
</tr>
<tr>
<td>34</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
</tr>
<tr>
<td>35</td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td colspan="3">Die Edge</td>
<td></td>
<td></td>
<td></td>
</tr>
</table>

Note:
In Figure 5-37, at 55-um pitch, the module depth of the 8-column bump map as
shown is approximately 990 um. Rows 1, 2, and 35 are required for packaging
solutions using floating bridges without TSVs. They can be optional for packaging
solutions with TSVs. The vccfwdio bumps are required for the tightly coupled mode up
to 16 GT/s. For higher speeds, the vccfwdio bumps may be connected to the vccio
bumps in package.

### 5.7.2.4 x64 and x32 Advanced Package Module Interoperability

x64 and x32 Advanced Package Module bump maps enable interoperability between all $\mathrm { T x }$ and Rx
combinations of x64 or x32, 10-column, 16-column, or 8-column Modules, in both Normal-to-Normal
module orientation or Normal-to-Mirrored module orientation.

However, if x64 to x32 modules or x32 to x32 modules have normal and mirrored orientation as
shown in Figure 5-38 and Figure 5-39, respectively, signal traces between the TX half and RX half will
crisscross and require swizzling technique which refers to rearranging the physical connections
between signal bumps of two chiplets to optimize the layout and routing on the interposer or
substrate. It involves changing the order of the connections or route on different layers without
altering the netlist or the electrical functionality of the design. Moreover, connections between 8-
column, 16-column, and 10-column modules may need to be routed to adjacent columns (swizzle and
go across). In all cases, the electrical spec must be met for all these connections.

It is optional for a x64 Module to support interoperability with a x32 Module. The following
requirements apply when a x64 module supports x32 interoperability:

. When a x64 module connects to x32 module, the connection shall always be contained to the
lower half of the x64 module. This must be followed even with x32 lane reversal described below.

· Electrical specifications must be met for combinations that require signal-routing swizzling.

· Lane reversal will not be permitted on CKP-, CKN-, CKRD-, VLD-, VLDRD-, TRK-, and sideband-
related pins. These pins need to be connected appropriately. Swizzling for these connections is
acceptable.

· x64 module must support a lane-reversal mode in a x32 manner (i.e., TD_P [31 : 0] =
TD_L [0 : 31]. When a x64 module is connected to a x32 module, in either Normal or Mirrored
orientation, the upper 32 bits are not used and should be disabled.

. It is not permitted for a single module of larger width to simultaneously interop with two or more
modules of a lower width. For example, a x64 Advanced Package module physically connected to
two x32 Advanced Package modules is prohibited.

Additional technological capabilities or layers may be needed to accomplish swizzling on data/auxiliary
signals.

Table 5-21 summarizes the connections between combinations of x64 and x32 modules in both
Normal-to-Normal and Normal-to-Mirrored module orientations. The table applies to all combinations
of 10-column, 16-column, or 8-column modules on either side of the Link.

<table>
<caption>Table 5-21. x64 and x32 Advanced Package Connectivity Matrix</caption>
<tr>
<th rowspan="3">Normal Module Tx</th>
<th colspan="2">Normal Module</th>
<th colspan="2">Mirrored Module</th>
</tr>
<tr>
<th colspan="4">Rx</th>
</tr>
<tr>
<th>x64</th>
<th>x32</th>
<th>x64</th>
<th>x32</th>
</tr>
<tr>
<td>x64</td>
<td>TX[63:0] - RX[63:0]ª</td>
<td>TX[31:0] - RX[31:0]b</td>
<td>rTX[63:0] - RX[0:63]c d</td>
<td>rTX[31:0] - RX[0:31]ce</td>
</tr>
<tr>
<td>x32</td>
<td>TX[31:0] - RX[31:0]b</td>
<td>TX[31:0] - RX[31:0]b</td>
<td>rTX[31:0] - RX[0:31]ce</td>
<td>rTX[31:0] - RX[0:31]c e</td>
</tr>
</table>

a. Entry "TX[63:0] - RX[63:0]" is for Normal Module connections between two x64 modules without lane reversal.
This applies to x64-to-x64 combination.

b. Entry "TX[31:0] - RX[31:0]" is for Normal Module connections between lower 32-bit half without lane reversal.
This applies to x64-to-x32, x32-to-x64, and x32-to-x32 combinations.

c. The prefix "r" means lane reversal is enabled on the Transmitter lanes, and:
. "rTX[63:0]" means TD_P[63:0] = TD_L[0:63], to be connected with RD_P[0: 63]

. "rTX[31:0]" means TD_P[31:0] = TD_L[0:31], to be connected with RD_P[0:31].

d. Entry "rTX[63:0] - RX[0:63]" = Normal-to-Mirrored Module connections between two x64 modules with TX lane reversal.
This applies to x64-to-x64 Normal-to-Mirrored combinations.

e. Entry "rTX[31:0] - RX[0:31]" = Normal-to-Mirrored Module connections between lower 32-bit half with TX lane reversal. This
applies to x64-to-x32, x32-to-x64, and x32-to-x32 Normal-to-Mirrored combinations.

The defined bump matrices can achieve optimal skew between bump matrices of differing depths,
and the worst-case trace-reach skews are expected to be within the maximum lane-to-lane skew limit
for the corresponding data rates as defined in Section 5.3 and Section 5.4.

Figure 5-38 and Figure 5-39 show examples of normal and mirrored x64-to-x32 and x32-to-x32
Advanced Package Module connections, respectively.

<figure>
<figcaption>Figure 5-38. Example of Normal and Mirrored x64-to-x32 Advanced Package Module Connection</figcaption>

x64 Normal

x64 Normal

VSS

VS5

vccio

vccio

VSS

VSS

vccio

vccio

V55

VSS

VSS

VSS

vccio

vccio

VSS

rxcksbRD

rxcksb

vccio

rxdatasb

rxdatasbRD

txdatasbRD

txdatasb

vccio

txcksb

txcksbRD

rxdata29

rxdata14

rxdataRD0

rxdata28

rxdata13

rxdata30

rxdata15

VSS

vccio

vccio

rxdata12

VSS

rxdata31

VSS

rxdata0

VSS

rxdata27

rxdata11

rxdat RD1

rxdata16

rxda a1

rxdata26

rxdata10

VIS

rxdata17

VS

vccio

rxdata25

rxdata9

rxcl RD

rxdata18

rxda

a2

VSS

rxvldRD

rxdata24

rxdata8

VSS

rxcken

rxdata19

rxda

a3

rxvld

VSS

rxdata7

rxckp

rxdata20

VS

rxtrk

rxdata23

rxdata6

v.

rxdata21

rxda

a4

VSS

vccio

rxdata22

rxdata5

vccfwdio

vccfwdio

vccf
dio

vccfwdio

vccfv

dio

vccio

txdata21

vccio

txdata5

txdata22

V.

VS

txdata4

txdata20

txckp

txdata6

txdata23

txt

k

VSS

txdata19

txckn

VSS

txdata7

VSS

txv d

txdata3

txdata18

txckRD

txdata8

txdata24

txvl

RD

VS

txdata2

txdata17

vccio

txdata9

txdata25

VI

vccio

vccio

vccio

vccio

vccio

txdata10

txdata26

txdata1

txdata16

txdataRD1

txdata11

txdata27

VS

txdata0

VSS

txdata31

VSS

txdata12

VSS

VSS

VSS

txdata15

txdat 30

txdata13

txdata28

txdata DO

txdata14

txdat 29

vccio

vccio

vcdo

vccio

vcalo

vcci

vccio

vcci

vccio

vccio

Die Edge

Die Edge

De Edge

vccfwdio

vccfwdio

vcdo

vccio

vcdo

vccio

vccio

vccig

vccfwa.

vccfwdio

vccfw

io

vccfwdio

vccfw

lio

vccio

vccio

vccio

vccio

vccfwdio

vccfwdio

vccfwdio

rxdata5

rxdata22

txdata31

txdata14

txdat: RDO

txdataRD0

txdat 14

txdata31

rxdata22

rxdata5

rxdat 4

rxdata21

VSS

txdata30

txdata13

txdata 13

txdata30

VSS

rx Nata21

rxdata4

rxdata6

rxdata23

txdataRD1

txdata15

VS

VSS

txdata15

txdataRD1

rxdata23

rxdata6

VSS

VSS

rxcko

txdata29

txdata12

txdata12

txdata29

rxckp

VSS

VSS

rxdata7

VSS

VSS

VSS

txdata0

txdata0

VSS

VSS

VS5

rxdata7

rxdat 3

rxdata20

rxck

txdata28

txdata11

txdata11

txcata28

rxckn

rxdata20

rxdata3

rxdata8

rxdata24

txvldRD

txdata16

txdata1

txdata1

txdata16

txvldRD

rxdata24

data8

rxdat
2

rxdata19

rxckHD

txdata27

txdata10

txdata10

txdata.

rxckRD

rxdata19

rxdata2

vccfwdio

vccfwdio

vccio

vccio

vccio

vccio

vccio

vccio

vccfwdio

vccfwdı

VSS

rxdata18

rxtr

VSS

txdata9

txdata9

VSS

rxtrk

rxdata18

VSS

rxdata9

rxdata25

txvld

txdata17

txdata2

txdata2

txdata17

txvld

rxdata25

rxdata9

rxdat 1

rxdata17

VSS

txdata26

VSS

VSS

txdata26

VSS

rxdata17

xdata1

VSS

rxdata26

VSS

txdata18

txdata3

txdata3

txdata18

SS

rxdata26

VSS

rxdata0

rxdata16

rxvl

txdata25

txdata8

txdata8

txdata25

rxvld

rxdata16

rxdata0

rxdata10

rxdata27

txtrk

txdata19

VSS

VSS

txdata19

txtrk

rxdata27

rxdata10

VSS

VSS

rxvid D

txdata24

txdata7

txdata7

txdata24

rxvldRD

VSS

VSS

rxdata11

rxdata28

txckRD

V55

txdata4

txdata4

VSS

txckRD

rxdata28

rxdata11

rxdataRD0

rxdata15

rxdataRD1

VSS

txdata6

txdata6

VSS

xdataRD1

rxdata15

rxdataRD0

rxdata12

rxdata29

txckn

txdata20

vccio

vccio

txdata20

txckn

rxdata29

rxdata12

vccio

rxdata14

VSS

txdata23

txdata5

txdata5

txdata23

Ş

rxdata14

vccio

rxdata13

rxdata30

txckp

txdata21

VSS

VSS

txdata21

txckp

rxdata30

rxdata13

vccio

vccio

rxdata31

txdata22

VSS

VSS

txdata22

rxdata31

vccio

vccio

txcksbRD

txcksb

VSS

txdatasb

txdatasbRD

txdatasbRD

txdatasb

VSS

txcksb

txcksbRD

rxdatasbRD

rxdatasb

vccio

rxcksb

rxcksbRD

rxcksbRD

rxcksb

vccio

rxdatasb

rxdatasbRD

VSS

vccio

vccio

VSS

VSS

VSS

VSS

vccio

vccio

VSS

VSS

VSS

vccio

vccio

VSS

VSS

vccio

vccio

VSS

VSS

VSS

vccio

vccio

VSS

VSS

VSS

VSS

vccio

vccio

VSS

x32 Normal

x32 Mirrored w/Lane Reversal

</figure>

<table>
<tr>
<th colspan="10"></th>
</tr>
<tr>
<th>VSS</th>
<th></th>
<th>VSS</th>
<th></th>
<th>vccio</th>
<th></th>
<th>vccio</th>
<th></th>
<th>VSS</th>
<th></th>
</tr>
<tr>
<th></th>
<th>VSS</th>
<th></th>
<th>vccio</th>
<th></th>
<th>vccio</th>
<th></th>
<th>VSS</th>
<th></th>
<th>VSS</th>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxcksbRD</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdatasb</td>
<td></td>
<td>rxdatasbRD</td>
</tr>
<tr>
<td>txdatasbRD</td>
<td></td>
<td>txdatasb</td>
<td></td>
<td>vccio</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>txcksbRD</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>rxdata29</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxdataRD0</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>rxdata28</td>
<td></td>
<td>rxdata13</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>rxdata30</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata12</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata31</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata0</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>rxdata27</td>
<td></td>
<td>rxdata11</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>r dataRD1</td>
<td></td>
<td>rxdata16</td>
<td></td>
<td>data1</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>rxdata26</td>
<td></td>
<td>rxdata10</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata17</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata25</td>
<td></td>
<td>rxdata9</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>rxckRD</td>
<td></td>
<td>rxdata18</td>
<td></td>
<td>rxdata2</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td></td>
<td></td>
<td>rxvldRD</td>
<td></td>
<td>rxdata24</td>
<td></td>
<td>rxdata8</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata19</td>
<td></td>
<td>rxdata3</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>rxv)</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxda a7</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata20</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>xtrk</td>
<td></td>
<td>rxdata23</td>
<td></td>
<td>data6</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata21</td>
<td></td>
<td>rxdata4</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata22</td>
<td></td>
<td>rxdata5</td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
<td></td>
<td>vccfwdio</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>txdata21</td>
<td></td>
<td>vccio</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata5</td>
<td></td>
<td>txdata22</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>txdata4</td>
<td></td>
<td>txdata20</td>
<td></td>
<td>txckp</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata6</td>
<td></td>
<td>txdat 23</td>
<td></td>
<td>txtrk</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata19</td>
<td></td>
<td>txckn</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata7</td>
<td></td>
<td>ISS</td>
<td></td>
<td>txvld</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>txdata3</td>
<td></td>
<td>txdata18</td>
<td></td>
<td>txckRD</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata24</td>
<td></td>
<td>txvldRD</td>
<td></td>
<td></td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>txdata2</td>
<td></td>
<td>txdata17</td>
<td></td>
<td>vccio</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata9</td>
<td></td>
<td>txdata25</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vCC</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata10</td>
<td></td>
<td>txdata26</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>txdata1</td>
<td></td>
<td>txdat 16</td>
<td></td>
<td>txdataRD1</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata27</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>txdata0</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata31</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata12</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata36</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata13</td>
<td></td>
<td>txdata28</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>txdataRD0</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txdata29</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>AIO</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Die</td>
<td>Edg</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</table>

<figure>
<figcaption>Figure 5-39. Example of Normal and Mirrored x32-to-x32 Advanced Package Module Connection</figcaption>

x32 Normal

x32 Normal

VSS

VSS

vccio

vccio

VSS

VSS

VSS

vccio

vccio

VSS

VSS

vccio

vccio

VSS

VSS

VSS

vccio

vccio

VSS

VSS

VSS

VSS

vccio

vccio

VSS

VSS

VSS

vccio

vccio

VSS

rxcksbRD

rxcksb

vccio

rxdatasb

rxdatasbRD

rxcksbRD

rxcksb

vccio

rxdatasb

rxdatasbRD

txdatasbRD

txdatasb

VSS

txcksb

txcksbRD

txdatasbRD

txdatasb

VSS

txcksb

txcksbRD

VSS

txdata22

rxdata31

vccio

vccio

VSS

txdata22

rxdata31

vccio

vccio

VSS

txdata21

txckp

rxdata30

rxdata13

VSS

txdata21

txckp

rxdata30

rxdata13

txdata5

txdata23

Ss

rxdata14

vccio

txdata5

txdata23

VSS

rxdata14

vccio

vccio

txdata20

txckn

rxdata29

rxdata12

vccio

txdata20

txckn

rxdata29

rxdata12

txdata6

VSS

rxda aRD1

rxdata15

rxdataRD0

txdata6

VSS

/xdataRD1

rxdata15

rxdataRD0

txdata4

VSS

txckRD

rxdata28

rxdata11

txdata4

VSS

txckRD

rxdata28

rxdata11

txdata7

txdata24

rxv dRD

VSS

VSS

txdata7

txdata24

rxvldRD

VSS

VSS

VSS

txdata19

txtrk

rxdata27

rxdata10

VSS

txdata19

txtrk

rxdata27

rxdata10

txdata8

txdata25

n vid

rxdata16

rxdata0

txdata8

txdata25

rxvld

rxdata16

rxdata0

txdata3

txdata18

VSS

rxdata26

VSS

txdata3

txdata18

SS

rxdata26

VSS

VSS

txdata26

SS

rxdata17

rxq ata1

VSS

txdata26

VSS

rxdata17

ry ata1

txdata2

txdata17

txvld

rxdata25

rxdata9

txdata2

txdata17

txvld

rxdata25

rxdata9

txdata9

VSS

n trk

rxdata18

SS

txdata9

VSS

rxtrk

rxdata18

VSS

vccio

vccio

vccio

vccfwdio

vccfwdio

vccio

vccio

vccio

vccfwdio

vccfwdir

txdata10

txdata27

rx

KRD

rxdata19

rxd ata2

txdata10

txdata _7

rxckRD

rxdata19

$r x d a t a 2$

txdata1

txdata16

txvldRD

rxdata24

rxdata8

txdata1

txdata16

txvldRD

rxdata24

rx ata8

txdata11

txdata28

DEkn

rxdata20

rxdata3

txdata11

txdata28

rxckn

rxdata20

rxdata3

txdata0

VSS

VSS

VSS

rxdata7

txdata0

VSS

VSS

VSS

rxdata7

txdata12

txdata29

rkp

VSS

SS

$t x d a t a 1 2$

cxdata29

rxckp

VSS

VSS

txdata15

txdataRD1

rxdata23

rxdata6

VS.

txdata15

txdataRD1

rxdata23

rxdata6

txdata13

txdata30

SS

rxdata21

rxd ata4

txdata13

txdata30

VSS

ry Jata21

rxdata4

txda aRDO

txdata14

txdata31

rxdata22

rxdata5

txdataRD

txdata14

txdata31

$r \times d a t a 2 2$

rxdata5

vccio

vccio

vcc

wdio

vccfwdio

vcc wdio

vccio

vccio

vccfwdio

vccfwdio

vccfwdio

votio

vccio

vcci

vccfwdio

vccfwdio

vccio

uccio

vccio

vccfw Mo

vccfwdio

Die Edge

Die Edge

Die Edge

Die Edg

vccfwdio

vccfwdio

vicio

vccio

vocio

vccio

ccio

vccio

vouwdio

vccfwdio

vccf vdio

vccfwdio

vccfw dic

vccio

vccio

vccio

vccio

vccfwdio

vccfwdio

vccfwdio

rxdata5

rxdata22

txdata31

txdata14

txda aRDO

txdataRD0

txda14

$r x d a t a 2$

rxdata5

rxd

ta4

rxdata21

VSS

txdata30

txdata13

txdata13

$\mathrm { t r d a t a } 3 1$

VSS

rxdata21

rxdata4

rxdata6

rxdata23

txdataRD1

txdata15

IS

VSS

txdata1.

txdataRD1

$r x d a t a 2 3$

$r x d a t a 6$

VIS

VSS

rxcko

txdata29

txdata12

txdata12

txdata29

$r x c k p$

VSS

rxdata7

VSS

VSS

VSS

txdata0

txdata0

VSS

VSS

VSS

$r x d a t a 7$

rxd

ta3

rxdata20

rxck

txdata28

txdata11

txdata11

txouta28

$r x c k n$

rxdata20

rxdata3

rxdata8

rxdata24

txvldRD

txdata16

txdata1

txdata1

txdata16

txvldRD

rxdata24

xdata8

rxd: ta2

rxdata19

rxck
D

txdata27

txdata10

txdata10

$t x d a t a$ 7

rxckRD

rxdata19

rxdata2

vccfwdio

vccfwdio

vccio

vccio

vccio

vccio

vccio

vccio

vccfwdio

vccfwio

VIS

rxdata18

rxtik

VSS

txdata9

txdata9

VSS

rxtrk

rxdata18

VSS

rxdata9

rxdata25

txvld

txdata17

txdata2

txdata2

txdata17

txvld

rxdata25

rxdata9

rxd: ta1

rxdata17

VS

txdata26

VSS

VSS

VSS

rxdata17

xdata1

VSS

rxdata26

VSS

txdata18

txdata3

txdata3

{ \text { thata a } 1 6 }<br>{ \text { txdata } 1 8 }

rxdata26

VSS

rxdata0

rxdata16

rxvid

txdata25

txdata8

txdata8

txdata25

rxvld

rxdata16

rxdata0

rxdata10

rxdata27

txtrk

txdata19

VSS

VSS

txdata19

txtrk

rxdata27

$r x d a t a 1 0$

VSS

VSS

rxvlaRD

txdata24

txdata7

txdata7

txdata24

rxvldRD

VSS

VSS

rxdata11

rxdata28

txckRD

VSS

txdata4

txdata4

VSS

txckRD

rxdata28

rxdata11

rxdataRD0

rxdata15

rxdata RD1

VSS

txdata6

txdata6

VSS

dataRD1

rxdata15

rxdataRD0

rxdata12

rxdata29

txckn

txdata20

vccio

vccio

txdata20

txckn

rxdata29

rxdata12

vccio

rxdata14

VS

txdata23

txdata5

txdata5

txdata23

ES

rxdata14

vccio

rxdata13

rxdata30

txckp

txdata21

VSS

VSS

txdata21

txckp

rxdata30

rxdata13

vccio

vccio

rxdata31

txdata22

VSS

VSS

txdata22

rxdata31

vccio

vccio

txcksbRD

txcksb

VSS

txdatasb

txdatasbRD

txdatasbRD

txdatasb

VSS

txcksb

txcksbRD

rxdatasbRD

rxdatasb

vccio

rxcksb

rxcksbRD

rxcksbRD

rxcksb

vccio

rxdatasb

rxdatasbRD

VSS

vccio

vccio

VSS

VSS

VSS

VSS

vccio

vccio

VSS

VSS

VSS

vccio

vccio

VSS

VSS

vccio

vccio

VSS

VSS

VSS

vccio

vccio

VSS

VSS

VSS

VSS

vccio

vccio

VSS

x32 Normal

x32 Mirrored w/Lane Reversal

</figure>

Although the depth of the bump map for 48 GT/s and 64 GT/s is greater than that for lower data
rates, the module width and signal exit order remain unchanged. As a result, the bump maps for 48
GT/s and 64 GT/s are interoperable with those for lower speeds.

### 5.7.2.5 Module Naming of Advanced Package Modules

This section describes the Module naming convention of x64 and x32 Advanced Package modules in a
multi-module configuration.

The Module naming is defined to help with connecting the Modules deterministically which, in turn,
will help minimize the multiplexing requirements in the Multi-module PHY Logic (MMPL).

The naming of M0, M1, M2, and M3 will apply to 1, 2, or 4 Advanced Package modules that are
aggregated through the MMPL.

Figure 5-40 shows the naming convention for 1, 2, or 4 Advanced Package Modules when they are
connected to their "Standard Die Rotate" Module counterparts that have same number of Advanced
Package Modules.

Note:
The double-ended arrows in Figure 5-40 through Figure 5-43 indicate Module-to-
Module connections.

<figure>
<figcaption>Figure 5-40. Naming Convention for One-, Two-, and Four-module Advanced Package Paired with "Standard Die Rotate" Configurations</figcaption>

$R x$
(x64)

Rx
(x64)

$R x$
(x64)

Rx
(x64)

$R x$
(x64)

Rx
(x64)

Rx
(x64)

MO

MO

M1

M1

MO

M2

M̧3

$T x$
(x64)

$T x$
$\left( x 6 4 \right)$

Tx
(x6 )

$T x$
(x64)

TX
$\left( \times 6 \right)$

Tx
$\left( x 6 4 \right)$

TX
(x6 )

(tax)
1

(t|9x)
T:

$\left( \log x \right)$
TX

(tax)
T

( 9x)

(tex)
1

( 9x)
T:

T:

OW

M1

OW

M3

M2

OW

M1

(x64)
XH

(x64)
Rx

(x64)
Rx

(x64)
Rx

(×64)
Rx

(x64)
Rx

(79X)
Rx

</figure>

Figure 5-41 shows the naming convention for 1, 2, or 4 Advanced Package modules when they are
connected to their "Mirrored Die Rotate" counterparts with the same number of Advanced Package
modules.

<figure>
<figcaption>Figure 5-41. Naming Convention for One-, Two-, and Four-module Advanced Package Paired with "Mirrored Die Rotate" Configurations</figcaption>

$R x$
(x64)

Rx
(x64)

Rx

Rx
(x64)

Rx
(x64)

Rx
(x64)

Rx
(x64)

(x64)

H

MO

MO

M1

M1

MO

M2

M̧3

Tx
(x64)

Tx
(x64)

Tx
(x6)

Tx
(x64)

TX
(x6 )

Tx
(x64)

TX
(x6)

(xps
xT

(xes)
1X

(xe :)
ET

[xed
XT

(xe-)
XT

(xed
$1 ^ { x }$

(xeso
xT

WO

WO

WJ

IM

OM

WS

W3

(xe4)
хЯ

(Aax)
хЯ

(x2)
$B ^ { x }$

(xe9)
ХЯ

(xe4)
$8 x$

(xe4)
$8 x$

(xp=)
хЯ

</figure>

Table 5-22 summarizes the connections between the combinations shown in Figure 5-40 and
Figure 5-41.

<table>
<caption>Table 5-22. Summary of Advanced Package Module Connection Combinations with Same Number of Modules on Both Sides</caption>
<tr>
<th>Advanced Package Module Connections (Same # of Modules on Both Sides)</th>
<th>Standard Die Rotate Counterpart</th>
<th>Mirrored Die Rotate Counterpart</th>
</tr>
<tr>
<td>$1 \quad - \quad x 1$</td>
<td>· MO - MO</td>
<td>· $M O \quad - \quad M O$</td>
</tr>
<tr>
<td rowspan="2">$2 \quad - \quad x 2$</td>
<td>· MO - M1</td>
<td>· $M O \quad - \quad M O$</td>
</tr>
<tr>
<td>· $M 1 \quad - \quad M O$</td>
<td>· M1 - M1</td>
</tr>
<tr>
<td rowspan="4">×4 - x4</td>
<td>· MO - M2</td>
<td>· $M O \quad - \quad M O$</td>
</tr>
<tr>
<td>· M1 - M3</td>
<td>· $M 1 \quad - \quad M 1$</td>
</tr>
<tr>
<td>· M3 - M1</td>
<td>· $M 2 \quad - \quad M 2$</td>
</tr>
<tr>
<td>· M2 - MO</td>
<td>· M3 - M3</td>
</tr>
</table>

Figure 5-42 shows the naming convention for 1, 2, or 4 Advanced Package modules when they are
connected to their "Standard Die Rotate" counterparts that have a different number of Advanced
Package modules.

<figure>
<figcaption>Figure 5-42. Examples for Advanced Package Configurations Paired with "Standard Die Rotate" Counterparts, with a Different Number of Modules</figcaption>

Rx
(x64)

$R x$
(x64)

Rx
(x64)

$R x$
(x64)

$R x$
(x64)

$R x$
(x64)

Rx
(x64)

$R x$
(x64)

Rx
(x64)

$R x$
(x64)

MO

M1

M1

MO

M2

M3

M1

MO

M2

M3

TX
(x6 )

$T x$
(x64)

T
(x6|)

Tx
(x64

$T x$
(x64)

$T x$
(x64)

$T x$
(x64)

TX
(x6)

$T x$
(x64)

Tx
(x64)

(9%)
KL

(|9x)
KI

(tex)
1

(|9x)
1

MO

M1

MO

0W

(x64)
Rx

(x64)
Rx

(x64)
Rx

(19x)
Rx

</figure>

Figure 5-43 shows the naming convention for 1, 2, or 4 Advanced Package modules when they are
connected to their "Mirrored Die Rotate" counterparts that have a different number of Advanced
Package modules.

<figure>
<figcaption>Figure 5-43. Examples for Advanced Package Configurations Paired with "Mirrored Die Rotate" Counterparts, with a Different Number of Modules</figcaption>

Rx
(x64)

Rx
(x64)

Rx
(x64)

Rx
(x64)

Rx
(x64)

Rx
(x64)

Rx
(x64)

Rx
(x64)

Rx
(x64)

Rx
(x64)

Rx
(x64)

M0

MO

M1

M1

MO

M2

M3

M1

MO

M2

M3

TK
(x6 4)

TX
(x6-
)

Tx
(x64)

T
(x6 )

Tx
(x64

$T x$
(x64)

Tx
(x64)

Tx
(x64)

TX
(x6.
)

$T x$
$\left( \times 6 4 \right)$

Tx
$\left( x 6 4 \right)$

(x64)
x

(xe 6)
KT

(xe
J

[xed
XT

(xe
KT

ST

O'W

WO

WO

WJ

WO

(x64)

(xev)
хЯ

(XP)
ХЯ

(xe+)
BX

(xe4)
ХЯ

Rx

</figure>

Table 5-23 summarizes the connections between the combinations shown in Figure 5-42 and
Figure 5-43.

<table>
<caption>Table 5-23. Summary of Advanced Package Module Connection Combinations with Different Number of Modules on Both Sides</caption>
<tr>
<th>Advanced Package Module Connections (Different # of Modules on Both Sides)</th>
<th>Standard Die Rotate Counterpartª</th>
<th>Mirrored Die Rotate Counterpartª</th>
</tr>
<tr>
<td rowspan="2">×2 - x1</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M O$</td>
</tr>
<tr>
<td>· M1 - NC</td>
<td>· $M 1 \quad - \quad N C$</td>
</tr>
<tr>
<td rowspan="4">$4 \quad - \quad x 2$</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M 1$</td>
</tr>
<tr>
<td>· $M 1 \quad - \quad M 1$</td>
<td>· $M 1 \quad - \quad M O$</td>
</tr>
<tr>
<td>· M3 - NC</td>
<td>· $M 2 \quad - \quad N C$</td>
</tr>
<tr>
<td>· $M 2 \quad - \quad N C$</td>
<td>· M3 - NC</td>
</tr>
<tr>
<td rowspan="4">$4 \quad - \quad x 1$</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M O$</td>
</tr>
<tr>
<td>· $M 1 \quad - \quad N C$</td>
<td>· $M 1 \quad - \quad N C$</td>
</tr>
<tr>
<td>· M3 - NC</td>
<td>· $M 2 \quad - \quad N C$</td>
</tr>
<tr>
<td>· M2 - NC</td>
<td>· M3 - NC</td>
</tr>
</table>

a. NC indicates no connection.

### 5.7.3 Standard Package

Interconnect channel should be designed with 50-ohm characteristic impedance. Insertion loss and
crosstalk for requirement at Nyquist frequency with Receiver termination is defined in Table 5-24.

<table>
<caption>Table 5-24. IL and Crosstalk for Standard Package: With Receiver Termination Enabled</caption>
<tr>
<th>Data Rate</th>
<th>4, 8 GT/s</th>
<th>12, 16 GT/s</th>
<th>24, 32 GT/s</th>
</tr>
<tr>
<td>VTF Loss (dB)a b c</td>
<td>$L \left( 0 \right) > - 4 . 5$ $L \left( f _ { N } \right) > - 7 . 5$</td>
<td>$L \left( 0 \right) > - 4 . 5$ $L \left( f _ { N } \right) > - 6 . 5$</td>
<td>$L \left( 0 \right) > - 4 . 5$ $L \left( f _ { N } \right) > - 7 . 5$</td>
</tr>
<tr>
<td>VTF Crosstalk (dB)</td>
<td>$X T \left( f _ { N } \right) < 3 * L \left( f _ { N } \right)$ - 11.5 and $x T \left( f _ { N } \right) < - 2 5$</td>
<td>$X T \left( f _ { N } \right) < 3 * L \left( f _ { N } \right) - 1 1 . 5$ $x T \left( f _ { N } \right) < - 2 5$</td>
<td>$X T \left( f _ { N } \right) < 2 . 5 * L \left( f _ { N } \right) - 1 0$ and $X T \left( f _ { N } \right) < - 2 6$</td>
</tr>
</table>

a. Voltage Transfer Function for 4 GT/s and 8 GT/s (Tx: 30 ohm / 0.3pF; Rx: 50 ohm / 0.3pF).

b. Voltage Transfer Function for 12 GT/s and 16 GT/s (Tx: 30 ohm / 0.2pF; Rx: 50 ohm / 0.2pF).

c. Voltage Transfer Function for 24 GT/s and 32 GT/s (Tx: 30 ohm / 0.125pF; Rx: 50 ohm / 0.125pF).

IL and crosstalk for requirement at Nyquist frequency without Receiver termination is defined by
Table 5-25. Loss and crosstalk specifications between DC and Nyquist fy follow the same methodology
defined in Section 5.7.2.1.

<table>
<caption>Table 5-25. IL and Crosstalk for Standard Package: No Rx Termination</caption>
<tr>
<th>Data Rate</th>
<th>4-12 GT/s</th>
<th>16 GT/s</th>
</tr>
<tr>
<td>VTF Loss (dB)a b</td>
<td>$L \left( f _ { N } \right) > - 1 . 2 5$</td>
<td>$L \left( f _ { N } \right) > - 1 . 1 5$</td>
</tr>
<tr>
<td>VTF Crosstalk (dB)</td>
<td>$X T \left( f _ { N } \right) < 7 * L \left( f _ { N } \right) - 1 2 . 5$ and $\check { X } T \left( f _ { N } \right) < - 1 5$</td>
<td>$X T \left( f _ { N } \right) < 4 * L \left( f _ { N } \right) - 1 3 . 5$ $x \left( f _ { N } \right) < - 1 7$</td>
</tr>
</table>

a. Voltage Transfer Function for 4 GT/s and 8 GT/s (Tx: 30 ohm / 0.3pF; Rx: 0.2 pF).

b. Voltage Transfer Function for 12 GT/s and 16 GT/s (Tx: 30 ohm / 0.2pF; Rx: 0.2 pF).

<table>
<caption>Table 5-26. Standard Package Module Signal List (Sheet 1 of 2)</caption>
<tr>
<th>Signal Name</th>
<th>Count</th>
<th>Description</th>
</tr>
<tr>
<td colspan="3">Data</td>
</tr>
<tr>
<td>TXDATA [ 15 : 0]</td>
<td>16</td>
<td>Transmit Data</td>
</tr>
<tr>
<td>TXVLD</td>
<td>1</td>
<td>Transmit Data Valid; Enables clocking in corresponding module</td>
</tr>
<tr>
<td>TXTRK</td>
<td>1</td>
<td>Transmit Track signal</td>
</tr>
<tr>
<td>TXCKP</td>
<td>1</td>
<td>Transmit Clock Phase-1</td>
</tr>
<tr>
<td>TXCKN</td>
<td>1</td>
<td>Transmit Clock Phase-2</td>
</tr>
<tr>
<td>RXDATA [ 15 : 0]</td>
<td>16</td>
<td>Receive Data</td>
</tr>
<tr>
<td>RXVLD</td>
<td>1</td>
<td>Receive Data Valid; Enables clocking in corresponding module</td>
</tr>
<tr>
<td>RXTRK</td>
<td>1</td>
<td>Receive Track</td>
</tr>
<tr>
<td>RXCKP</td>
<td>1</td>
<td>Receive Clock Phase-1</td>
</tr>
<tr>
<td>RXCKN</td>
<td>1</td>
<td>Receive Clock Phase-2</td>
</tr>
<tr>
<td colspan="3">Sideband</td>
</tr>
<tr>
<td>TXDATASB</td>
<td>1</td>
<td>Sideband Transmit Data</td>
</tr>
<tr>
<td>RXDATASB</td>
<td>1</td>
<td>Sideband Receiver Data</td>
</tr>
<tr>
<td>TXCKSB</td>
<td>1</td>
<td>Sideband Transmit Clock</td>
</tr>
</table>

<table>
<caption>Table 5-26. Standard Package Module Signal List (Sheet 2 of 2)</caption>
<tr>
<th>Signal Name</th>
<th>Count</th>
<th>Description</th>
</tr>
<tr>
<td>RXCKSB</td>
<td>1</td>
<td>Sideband Receive Clock</td>
</tr>
<tr>
<td colspan="3">Power and Voltage</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>Ground Reference</td>
</tr>
<tr>
<td>VCCIO</td>
<td></td>
<td>I/O supply</td>
</tr>
<tr>
<td>VCCAON</td>
<td></td>
<td>Always on Aux supply (sideband)</td>
</tr>
</table>

#### 5.7.3.1 x16 Standard Package Module Bump Map

Figure 5-44 and Figure 5-46 show the reference bump matrices for x16 (one module) and x32 (two
module) Standard Packages, respectively, for data rates up to 32 GT/s.

It is strongly recommended to follow the bump matrices provided in Figure 5-44 for one module and
Figure 5-46 for two module Standard Packages. The lower left corner of the bump map will be
considered "origin" of a bump matrix.

Signal exit order for x16 and x32 Standard Package bump matrices are shown in Figure 5-45 and
Figure 5-47, respectively.

The following rules must be followed for Standard Package bump matrices:

· The signals within a column must be preserved. For example, for a x16 (one module Standard
Package) shown in Figure 5-44, Column 1 must contain the signals: txdata0, txdata1,
txdata4, txdata5, and txdatasb.

· The signals must exit the bump field in the order shown in Figure 5-45. Layer 1 and Layer 2 are
two different signal routing layers in a Standard Package.

It is strongly recommended to follow the supply and ground pattern shown in the bump matrices. It
must be ensured that sufficient supply and ground bumps are provided to meet channel
characteristics (FEXT and NEXT) and power-delivery requirements.

The following rules must be followed for instantiating multiple modules of Standard Package bump
matrix:

· When looking at a die such that the UCIe Modules are on the south side, Tx should always
precede Rx within a module along the die's edge when going from left to right.

· When instantiating multiple modules, the modules must be stepped in the same orientation and
abutted. Horizontal or vertical mirroring is not permitted.

If more Die Edge Bandwidth density is required, it is permitted to stack two modules before abutting.
If two modules are stacked, the package may need to support at least four routing layers for UCIe
signal routing. An example of stacked Standard Package Module instantiations is shown in
Figure 5-46.

. If only one stacked module is instantiated, when looking at a die such that the UCIe Modules are
on the south side, Tx should always precede Rx within a module along the die's edge when going
from left to right.

· When instantiating multiple stacked modules, the modules must be stepped in the same
orientation and abutted. Horizontal or vertical mirroring is not permitted.

Note:
An example of signal routing for stacked module is shown in Figure 5-48.

Figure 5-44. Standard Package Bump Map: x16 interface

<table>
<tr>
<th>Column 0</th>
<th>Column 1</th>
<th>Column 2</th>
<th>Column 3</th>
<th>Column 4</th>
<th>Column 5</th>
<th>Column 6</th>
<th>Column 7</th>
<th>Column 8</th>
<th>Column 9</th>
<th>Column 10</th>
<th colspan="2">Column 11</th>
</tr>
<tr>
<th></th>
<th>txdatasb</th>
<th></th>
<th>txcksb</th>
<th></th>
<th>vccaon</th>
<th></th>
<th>vccaon</th>
<th></th>
<th>rxcksb</th>
<th></th>
<th>rxdatasb</th>
<th></th>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata9</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata8</td>
<td></td>
<td>rxdata6</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata5</td>
<td></td>
<td>txckn</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>rxdata10</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata4</td>
<td></td>
</tr>
<tr>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata4</td>
<td></td>
<td>txckp</td>
<td></td>
<td>$t x d a t a 1 0$</td>
<td></td>
<td>rxdata11</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata5</td>
<td></td>
</tr>
<tr>
<td>V55</td>
<td></td>
<td>txdata6</td>
<td></td>
<td>txdata8</td>
<td></td>
<td>V55</td>
<td></td>
<td>rxdata9</td>
<td></td>
<td>rxdata7</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>txdata3</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdata12</td>
<td></td>
<td>rxdata2</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata1</td>
<td></td>
<td>txvld</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td colspan="2">rxdata0</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>vccio</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td colspan="2"></td>
</tr>
<tr>
<td></td>
<td>txdata0</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>rxvld</td>
<td></td>
<td colspan="2">rxdata1</td>
</tr>
<tr>
<td>V55</td>
<td></td>
<td>txdata2</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>V55</td>
<td></td>
<td>rxdata13</td>
<td></td>
<td>rxdata3</td>
<td colspan="2"></td>
</tr>
</table>

Die Edge

<table>
<caption>Figure 5-45. Standard Package x16 interface: Signal exit order</caption>
<tr>
<th rowspan="3"></th>
<th>Layer 1</th>
<th rowspan="2">Tx Module dule</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>trk</th>
<th>vld</th>
<th>12</th>
<th>13</th>
<th>14</th>
<th>15</th>
<th>15</th>
<th>14</th>
<th>13</th>
<th>12</th>
<th>vld</th>
<th>trk</th>
<th>3</th>
<th>2</th>
<th>1</th>
<th>0</th>
<th rowspan="2">$R x$ Module</th>
</tr>
<tr>
<th>Layer 2</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>ckp</th>
<th>ckn</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
<th>11</th>
<th>10</th>
<th>9</th>
<th>8</th>
<th>ckn</th>
<th>ckp</th>
<th>7</th>
<th>6</th>
<th>5</th>
<th>4</th>
</tr>
<tr>
<td>Sideband</td>
<td></td>
<td></td>
<td colspan="2">txdatasb</td>
<td></td>
<td></td>
<td></td>
<td>txcksb</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>rxcksb</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="2">rxdatasb</td>
<td></td>
</tr>
</table>

<table>
<caption>Figure 5-46. Standard Package Bump Map: x32 interface</caption>
<tr>
<th>Column 0</th>
<th>Column 1</th>
<th>Column 2</th>
<th>Column 3</th>
<th>Column 4</th>
<th>Column 5</th>
<th>Column 6</th>
<th>Column 7</th>
<th>Column 8</th>
<th>Column 9</th>
<th>Column 10</th>
<th>Column 11</th>
</tr>
<tr>
<th></th>
<th>m2rxdatasb</th>
<th></th>
<th>m2rxcksb</th>
<th></th>
<th>vccaon</th>
<th></th>
<th>m2txcksb</th>
<th></th>
<th>m2txdatasb</th>
<th></th>
<th>vccaon</th>
</tr>
<tr>
<td>m1txdatasb</td>
<td></td>
<td>m1txcksb</td>
<td></td>
<td>vccaon</td>
<td></td>
<td>vccaon</td>
<td></td>
<td>m1rxcksb</td>
<td></td>
<td>m1rxdatasb</td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
</tr>
<tr>
<td></td>
<td>m2rxdata6</td>
<td></td>
<td>m2rxdata8</td>
<td></td>
<td>V55</td>
<td></td>
<td>m2txdata9</td>
<td></td>
<td>m2txdata7</td>
<td></td>
<td>V55</td>
</tr>
<tr>
<td>m2rxdata4</td>
<td></td>
<td>m2rxckp</td>
<td></td>
<td>m2rxdata10</td>
<td></td>
<td>m2txdata11</td>
<td></td>
<td>m2txckn</td>
<td></td>
<td>m2txdata5</td>
<td></td>
</tr>
<tr>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
</tr>
<tr>
<td>m2rxdata5</td>
<td></td>
<td>m2rxckn</td>
<td></td>
<td>m2rxdata11</td>
<td></td>
<td>m2txdata10</td>
<td></td>
<td>m2txckp</td>
<td></td>
<td>m2txdata4</td>
<td></td>
</tr>
<tr>
<td></td>
<td>m2rxdata7</td>
<td></td>
<td>m2rxdata9</td>
<td></td>
<td>V55</td>
<td></td>
<td>$m 2 t x d a t a 8$</td>
<td></td>
<td>m2txdata6</td>
<td></td>
<td>V55</td>
</tr>
<tr>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
</tr>
<tr>
<td></td>
<td>m2rxdata2</td>
<td></td>
<td>m2rxdata12</td>
<td></td>
<td>V55</td>
<td></td>
<td>m2txdata13</td>
<td></td>
<td>m2txdata3</td>
<td></td>
<td>V55</td>
</tr>
<tr>
<td>m2rxdata0</td>
<td></td>
<td>$m 2 r x t r k$</td>
<td></td>
<td>$n 2 r \times d a t a 1 4$</td>
<td></td>
<td>m2txdata15</td>
<td></td>
<td>$m 2 t x v l d$</td>
<td></td>
<td>$m 2 t x d a t a 1$</td>
<td></td>
</tr>
<tr>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
</tr>
<tr>
<td>m2rxdata1</td>
<td></td>
<td>$m 2 r x v l d$</td>
<td></td>
<td>m2rxdata15</td>
<td></td>
<td>m2txdata14</td>
<td></td>
<td>m2txtrk</td>
<td></td>
<td>m2txdata0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>$m 2 r \times d a t a 3$</td>
<td></td>
<td>$m 2 r x d a t a 1 3$</td>
<td></td>
<td>vccio</td>
<td></td>
<td>$m 2 t x d a t a 1 2$</td>
<td></td>
<td>$m 2 t x d a t a 2$</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>vccio</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>m1txdata7</td>
<td></td>
<td>m1txdata9</td>
<td></td>
<td>vccio</td>
<td></td>
<td>m1rxdata8</td>
<td></td>
<td>m1rxdata6</td>
<td></td>
</tr>
<tr>
<td></td>
<td>m1txdata5</td>
<td></td>
<td>$m 1 t x c k n$</td>
<td></td>
<td>m1txdata11</td>
<td></td>
<td>m1rxdata10</td>
<td></td>
<td>m1rxckp</td>
<td></td>
<td>m1rxdata4</td>
</tr>
<tr>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
</tr>
<tr>
<td></td>
<td>m1txdata4</td>
<td></td>
<td>m1txckp</td>
<td></td>
<td>m1txdata10</td>
<td></td>
<td>m1rxdata11</td>
<td></td>
<td>m1rxckn</td>
<td></td>
<td>m1rxdata5</td>
</tr>
<tr>
<td>V55</td>
<td></td>
<td>m1txdata6</td>
<td></td>
<td>m1txdata8</td>
<td></td>
<td>V55</td>
<td></td>
<td>m1rxdata9</td>
<td></td>
<td>m1rxdata7</td>
<td></td>
</tr>
<tr>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>m1txdata3</td>
<td></td>
<td>m1txdata13</td>
<td></td>
<td>vccio</td>
<td></td>
<td>m1rxdata12</td>
<td></td>
<td>m1rxdata2</td>
<td></td>
</tr>
<tr>
<td></td>
<td>m1txdata1</td>
<td></td>
<td>m1txvld</td>
<td></td>
<td>m1txdata15</td>
<td></td>
<td>m1rxdata14</td>
<td></td>
<td>m1rxtrk</td>
<td></td>
<td>m1rxdataO</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
<td>vccio</td>
<td></td>
<td>V55</td>
<td></td>
<td>V55</td>
<td></td>
</tr>
<tr>
<td></td>
<td>m1txdataO</td>
<td></td>
<td>m1txtrk</td>
<td></td>
<td>m1txdata14</td>
<td></td>
<td>m1rxdata15</td>
<td></td>
<td>m1rxvld</td>
<td></td>
<td>m1rxdata1</td>
</tr>
<tr>
<td>V55</td>
<td></td>
<td>m1txdata2</td>
<td></td>
<td>m1txdata12</td>
<td></td>
<td>V55</td>
<td></td>
<td>m1rxdata13</td>
<td></td>
<td>m1rxdata3</td>
<td></td>
</tr>
</table>

Die Edge

<table>
<caption>Figure 5-47. Standard Package x32 interface: Signal exit routing</caption>
<tr>
<th rowspan="5"></th>
<th>Layer 1</th>
<th>Tx</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>trk</th>
<th>vld</th>
<th>12</th>
<th>13</th>
<th>14</th>
<th>15</th>
<th>15</th>
<th>14</th>
<th>13</th>
<th>12</th>
<th>vld</th>
<th>trk</th>
<th>3</th>
<th>2</th>
<th>1</th>
<th>0</th>
<th>$R x$</th>
<th></th>
</tr>
<tr>
<td>Layer 2</td>
<td>Module 1</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>ckp</td>
<td>ckn</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>11</td>
<td>10</td>
<td>9</td>
<td>8</td>
<td>ckn</td>
<td>ckp</td>
<td>7</td>
<td>6</td>
<td>5</td>
<td>4</td>
<td>Module 1</td>
<td></td>
</tr>
<tr>
<td>Layer 3</td>
<td>Rx</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>trk</td>
<td>vld</td>
<td>12</td>
<td>13</td>
<td>14</td>
<td>15</td>
<td>15</td>
<td>14</td>
<td>13</td>
<td>12</td>
<td>vld</td>
<td>$\mathrm { t r k }$</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>Tx</td>
<td></td>
</tr>
<tr>
<td>Layer 4</td>
<td>Module 2</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>ckp</td>
<td>ckn</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>11</td>
<td>10</td>
<td>9</td>
<td>8</td>
<td>ckn</td>
<td>ckp</td>
<td>7</td>
<td>6</td>
<td>5</td>
<td>4</td>
<td>Module 2</td>
<td></td>
</tr>
<tr>
<td>Sideband</td>
<td></td>
<td colspan="3">m1txdatasb</td>
<td colspan="3">m2rxdatasb</td>
<td colspan="2">m1txcksb</td>
<td colspan="2">m2rxcksb</td>
<td colspan="2">m2txcksb</td>
<td colspan="2">m1rxcksb</td>
<td colspan="3">m2txdatasb</td>
<td colspan="3">m 1rxdatasb</td>
<td colspan="2">Sideband</td>
</tr>
</table>

<figure>
<figcaption>Figure 5-48. Standard Package cross section for stacked module</figcaption>

Package

Orange - Tx signals on Die 1 talking to Rx on Die 2 in Layer 1

Orange - Tx signals on Die 1 talking to Rx on Die 2 in Layer 2

Blue - Tx signals on Die 2 talking to Rx on Die 1 in Layer 3
Blue - Tx signals on Die 2 talking to Rx on Die 1 in Layer 4
Brown - VCCIO
Green - VSS

</figure>

## IMPLEMENTATION NOTE

Figure 5-49 shows a breakout design reference with the Standard Package channel based on the
bump pitch and on routing design rules.

Figure 5-49.
Standard Package reference configuration

D

I

V

VL

1

1

$S$

$P = D + L + 2 S$

$\mathrm { P } _ { \mathrm { y } }$

$P = \frac { 1 } { 2 } \sqrt { P _ { x } ^ { 2 } + P _ { y } ^ { 2 } }$

V

1

$P$

$P _ { X }$

· 4-row deep breakout per routing layer

· Example $1 : P _ { y } = 1 9 0 . 5 u m ,$ $P _ { x } \approx 1 1 1 . 5 u m ,$ $P \approx 1 1 0 u m$

· Example 2: $P _ { v } = 1 9 0 . 5 u m ,$ $P _ { x } \approx 1 7 7 ,$ $P \approx 1 3 0 u m$

<table>
<caption>Figure 5-50 and Figure 5-51 present recommended bump configurations for Standard Package modules for 48 GT/s and 64 GT/s. As with the Advanced Package configurations, a greater number of power and ground bumps have been integrated to support the increased data rates. Additional bump maps or further optimizations may be introduced in subsequent updates to this specification. To enhance die edge bandwidth density, the UCIe Consortium is investigating the feasibility of bump maps for 48 GT/s and 64 GT/s that have die edge equal to that of 32 GT/s and below. This exploration involves optimizing bump maps and enhancing circuits through improvements in equalization, termination network, skew, jitter, and noise reduction. Figure 5-50. Standard Package Bump Map: 48 GT/s and 64 GT/s x32 Interface</caption>
<tr>
<th>Column 1</th>
<th>Column 2</th>
<th>Column 3</th>
<th>Column 4</th>
<th>Column 5</th>
<th>Column 6</th>
<th>Column 7</th>
<th>Column 8</th>
<th>Column 9</th>
<th>Column 10</th>
<th>Column 11</th>
<th>Column 12</th>
<th>Column 13</th>
<th>Column 14</th>
</tr>
<tr>
<th></th>
<th>rxdatasb2</th>
<th></th>
<th>rxcksb2</th>
<th></th>
<th>vccio</th>
<th></th>
<th>vccinfaon</th>
<th></th>
<th>vccio</th>
<th></th>
<th>txdatasb2</th>
<th></th>
<th>txcksb2</th>
</tr>
<tr>
<td>txdatasb1</td>
<td></td>
<td>txcksb1</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccinfaon</td>
<td></td>
<td>vccio</td>
<td></td>
<td>rxdatasb1</td>
<td></td>
<td>rxdatack1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata6</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata10</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata4</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata5</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata9</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata9</td>
<td></td>
<td>txckn</td>
<td></td>
<td>txdata5</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>rxdata4</td>
<td></td>
<td>rxdata7</td>
<td></td>
<td>rxdata8</td>
<td></td>
<td>rxdata11</td>
<td></td>
<td>txdata10</td>
<td></td>
<td>txckp</td>
<td></td>
<td>txdata6</td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata2</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>txdata3</td>
<td></td>
<td>txdata0</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>rxdata1</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata13</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>txdata1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>rxdata0</td>
<td></td>
<td>rxdata3</td>
<td></td>
<td>rxdata12</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>txvld</td>
<td></td>
<td>txdata2</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>txdata4</td>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>rxdata10</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata6</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata9</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata5</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata5</td>
<td></td>
<td>txckn</td>
<td></td>
<td>txdata9</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata6</td>
<td></td>
<td>txckp</td>
<td></td>
<td>txdata10</td>
<td></td>
<td>rxdata11</td>
<td></td>
<td>rxdata8</td>
<td></td>
<td>rxdata7</td>
<td></td>
<td>rxdata4</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>txdata0</td>
<td></td>
<td>txdata3</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>rxdata2</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata13</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata1</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata2</td>
<td></td>
<td>txvld</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>rxdata15</td>
<td></td>
<td>rxdata12</td>
<td></td>
<td>rxdata3</td>
<td></td>
<td>rxdata0</td>
</tr>
</table>

Die Edge

<table>
<caption>Figure 5-51. x16 Standard Package Potential Bump Map: 48 GT/s and 64 GT/s x16</caption>
<tr>
<th></th>
<th>Column 1</th>
<th>Column 2</th>
<th>Column 3</th>
<th>Column 4</th>
<th>Column 5</th>
<th>Column 6</th>
<th>Column 7</th>
<th>Column 8</th>
<th>Column 9</th>
<th>Column 10</th>
<th>Column 11</th>
<th>Column 12</th>
<th colspan="3">Column 13 Column 14</th>
</tr>
<tr>
<th></th>
<th></th>
<th>txdatasb1</th>
<th></th>
<th>txcksb1</th>
<th></th>
<th>vccio</th>
<th></th>
<th>vccinfaon</th>
<th></th>
<th>vccio</th>
<th></th>
<th>rxdatasb1</th>
<th></th>
<th>rxdatack1</th>
<th></th>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata4</td>
<td></td>
<td>txdata7</td>
<td></td>
<td>txdata8</td>
<td></td>
<td>txdata11</td>
<td></td>
<td>rxdata10</td>
<td></td>
<td>rxckp</td>
<td></td>
<td>rxdata6</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata9</td>
<td></td>
<td>rxckn</td>
<td></td>
<td>rxdata5</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata5</td>
<td></td>
<td>txckn</td>
<td></td>
<td>txdata9</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata6</td>
<td></td>
<td>txckp</td>
<td></td>
<td>txdata10</td>
<td></td>
<td>rxdata11</td>
<td></td>
<td>rxdata8</td>
<td></td>
<td>rxdata7</td>
<td></td>
<td>rxdata4</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>txdata0</td>
<td></td>
<td>txdata3</td>
<td></td>
<td>txdata12</td>
<td></td>
<td>txdata15</td>
<td></td>
<td>rxdata14</td>
<td></td>
<td>rxvld</td>
<td></td>
<td>rxdata2</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>rxdata13</td>
<td></td>
<td>rxtrk</td>
<td></td>
<td>rxdata1</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata1</td>
<td></td>
<td>txtrk</td>
<td></td>
<td>txdata13</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>txdata2</td>
<td></td>
<td>txvld</td>
<td></td>
<td>txdata14</td>
<td></td>
<td>rxdata 15</td>
<td></td>
<td>rxdata12</td>
<td></td>
<td>rxdata3</td>
<td></td>
<td>rxdata0</td>
<td></td>
</tr>
<tr>
<td></td>
<td colspan="15">Die Edge</td>
</tr>
<tr>
<td colspan="16"></td>
</tr>
</table>

## 5.7.3.2 x8 Standard Package Module Bump Map

Designs can choose to add a UCIe-S port for sort/pre-bond test purposes in scenarios where they
need the high bandwidth of UCIe, but the design is an advanced package design, or for any other
reason. To reduce the chiplet's die edge when supporting such a UCIe-S usage, a x8 version of UCIe-
S is provided. This is an additional option that goes beyond the available standard x16 UCIe-S port
options. A UCIe-S x16 Module, including bump maps for all data rates, can optionally support a
connection to a UCIe-S x8 Module. When this connection is supported, the connection is always to the
lower x8 lanes (i.e., Lanes 7:0). UCIe-S x8 designs must support lane reversal and degraded mode
operation to x4. UCIe-S x16 designs that support connection to a x8 Module must support lane
reversal, and must support degraded mode operation to x4 on its lower 8 lanes when connected to a
x8 Module.

UCIe-S x8 support is limited to a single module configuration and up to 32 GT/s. When a UCIe-S x8
port is connected to a multi-module x16 port, it is always connected to Module 0 UCIe-S x16.

Figure 5-52 shows the reference bump matrix for a x8 Standard Package.

<table>
<caption>Figure 5-52. Standard Package Bump Map: x8 Interface</caption>
<tr>
<th>Column 0</th>
<th>Column 1</th>
<th>Column 2</th>
<th>Column 3</th>
<th>Column 4</th>
<th>Column 5</th>
<th>Column 6</th>
<th>Column 7</th>
</tr>
<tr>
<td>txdatasb</td>
<td></td>
<td>txcksb</td>
<td></td>
<td>rxcksb</td>
<td></td>
<td>rxdatasb</td>
<td></td>
</tr>
<tr>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
<td></td>
<td>vccio</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Txdata0</td>
<td></td>
<td>Txdata7</td>
<td></td>
<td>Rxdata6</td>
<td></td>
<td>Rxdata1</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>Txckn</td>
<td></td>
<td>VSS</td>
<td></td>
<td>Rxckp</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>Txckp</td>
<td></td>
<td>vccio</td>
<td></td>
<td>Rxckn</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Txdata1</td>
<td></td>
<td>Txdata6</td>
<td></td>
<td>Rxdata7</td>
<td></td>
<td>Rxdata0</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
<td>vccio</td>
<td></td>
<td>VSS</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Txdata3</td>
<td></td>
<td>Txdata4</td>
<td></td>
<td>Rxdata5</td>
<td></td>
<td>Rxdata2</td>
</tr>
<tr>
<td>vccio</td>
<td></td>
<td>$T x v l d$</td>
<td></td>
<td>vccio</td>
<td></td>
<td>Rxtrk</td>
<td></td>
</tr>
<tr>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
<td></td>
<td>VSS</td>
</tr>
<tr>
<td>VSS</td>
<td></td>
<td>Txtrk</td>
<td></td>
<td>VSS</td>
<td></td>
<td>Rxvld</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Txdata2</td>
<td></td>
<td>Txdata5</td>
<td></td>
<td>Rxdata4</td>
<td></td>
<td>Rxdata3</td>
</tr>
</table>

Die Edge

It is strongly recommended to follow the bump matrix provided in Figure 5-52. The lower left corner
of the bump map will be considered "origin" of a bump matrix.

The same rules as mentioned for x16 and x32 Standard Package bump matrices in Section 5.7.3.1
must be followed for the x8 bump matrix.

## 5.7.3.3 x16 and x8 Standard Package Module Interoperability

A x8 bump matrix will either connect to another x8 bump matrix or to bits [7:0] of a x16 bump
matrix.

## 5.7.3.4 Module Naming of Standard Package Modules

This section describes the Module naming convention of Standard Package Modules in a multi-module
configuration.

The naming of M0, M1, M2, and M3 will apply to 1, 2, or 4 Standard Package modules that are
aggregated through MMPL, in stacked and unstacked configuration combinations.

Figure 5-53 shows the naming convention for 1, 2, or 4 Standard Package modules when they are
connected to their "Standard Die Rotate" module counterparts with the same number of Standard
Package modules, with either same stack or same unstacked configuration.

Note:
The double-ended arrows in Figure 5-53 through Figure 5-57 indicate Module-to-
Module connections.

<figure>
<figcaption>Figure 5-53. Naming Convention for One-, Two-, and Four-module Standard Package Paired with "Standard Die Rotate" Configurations</figcaption>

MO

M1

MO

M1

MO

Tx
(x15)

Hs
(16)

Tx
(x16)

RN
(<16)

Ts
(*15]

R.
[x16)

Tx
[x16)

Rx
(x26)

T.K
[x16)

Rx
[xIGI

Tx
[x16)

M2

RX
(x16)

Tx
(x)6)

M3

Rx
(=26)

(91)

[91X)

19L.)

(TN)
RX

(OTX)
KA

(9Tv)
TH

(91)

(x16)

(STX)
XL

(x1E)

(x16)

Rx

¥L

(9)*)
34

191-)
X1

19LAT
KN

W!

MO

M34

Rx

XL

MO

M1

M3

M2

MO

M1

$1 - x 1$

$x 2$ Unstacked $- \quad x 2$ Unstacked

x4 Unstacked - x4 Unstacked

MI

M3

AY
[x16)

M1

Fix
(x16

Ta
(,16)

REA
(*16

1,
(×16)

1x

(x16)

MO

MQ

IX
(x16)

1x
(x16)

Hx
(x15)

M2

TK

Rx
(×16)

AX

(x16)

[x16)

·15)

(9[*)
MI

x10)

(91)
KL

(91)

(1)

EH

KH

Xb

OW

X1

M2

OW

(9TX)

(Prk)

(9TM)

(92%)

(41)

(41X)
RK

K

MN

.:

TW

M3

X1

M1

x2 Stacked - x2 Stacked

x4 Stacked - x4 Stacked

</figure>

Figure 5-54 shows the naming convention for 1, 2, or 4 Standard Package modules when they are
connected to their "Mirrored Die Rotate" counterparts that have same number of Standard Package
modules, with either same stack or same unstacked configuration.

<figure>
<figcaption>Figure 5-54. Naming Convention for One-, Two-, and Four-module Standard Package Paired with "Mirrored Die Rotate" Configurations</figcaption>

MO

M1

MO

Ta
(=16)

M1

MO

RX
(wtG)

Tx
(*16)

RW
(x16)

TM
[x16)

M2

AN
(x16)

Tx
(x16)

M3

Tx
(x10)

Rx
[x16)

1x
(x16)

1x

A

(¥101

Tx
(x16)

KV
(16)

I-10)

here)
1X

(are)

(KB)

(2)
K

(xJe)
P

(*)+)
12

(se)

(x12)

1x12)
IN

ISTEN
BX

(XTC)
1ª

(XTC)
HA

(XTC)
IM

(KT2)
!! &

WO

LOX

1#

14

54

WT

OM

WT

OM

WS

EM

$x 1 - x 1$

x2 Unstacked -x2 Unstacked

x4 Unstacked - x4 Unstacked

M1

ALK

TA
[¥15)

RKA
İKİG

M1

Tx
(x1G)

RX
(x10

M3

Tx
İx1G)

4x16

MO

1x
(xIG)

KK
(HIG)

1%
(x36)

MO

TW
(16)

M2

RN
for

Re
(1)

चिस
I

(vr@)
1

(xTe)
IK

(KT2)
UX

[XTeJ

(Tel
IK

WO

WO

2

WS

(a)e)
LO

(xre)
KT

Ire

(xce)
IM

(>10
HM

(xTe)

WT

1\.

1Z

WAT

EM

x2 Stacked - x2 Stacked

x4 Stacked - x4 Stacked

</figure>

Table 5-27 summarizes the connections between the combinations shown in Figure 5-53 and
Figure 5-54.

<table>
<caption>Table 5-27. Summary of Standard Package Module Connection Combinations with Same Number of Modules on Both Sides a b</caption>
<tr>
<th rowspan="2">Standard Package Module Connections (Same # of Modules on Both Sides)</th>
<th rowspan="2">Standard Die Rotate Counterpart</th>
<th colspan="2">Mirrored Die Rotate Counterpart</th>
</tr>
<tr>
<th>Option 1 (See Figure 5-54)</th>
<th>Option 2℃ (See Figure 5-57)</th>
</tr>
<tr>
<td>$1 \quad - x 1$</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td rowspan="2">x2 Unstacked - x2 Unstacked</td>
<td>· $M O \quad - \quad M 1$</td>
<td>· $M O \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td>· $M 1 \quad - \quad M O$</td>
<td>· $M 1 \quad - \quad M 1$</td>
<td></td>
</tr>
<tr>
<td rowspan="2">x2 Stacked - x2 Stacked</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M 1$</td>
</tr>
<tr>
<td>· $M 1 \quad - \quad M 1$</td>
<td>· $M 1 \quad - \quad M 1$</td>
<td>· $M 1 \quad - \quad M O$</td>
</tr>
<tr>
<td rowspan="4">x4 Unstacked - x4 Unstacked</td>
<td>· $M O \quad - \quad M 2$</td>
<td>· $M O \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td>· $M 1 \quad - \quad M 3$</td>
<td>· $M 1 \quad - \quad M 1$</td>
<td></td>
</tr>
<tr>
<td>· $M 3 \quad - \quad M 1$</td>
<td>· $M 2 \quad - \quad M 2$</td>
<td></td>
</tr>
<tr>
<td>· M2 - MO</td>
<td>· $M 3 \quad - \quad M 3$</td>
<td></td>
</tr>
<tr>
<td rowspan="4">$x 4 \quad S t a c k e d \quad - \quad x 4 \quad S t a c k e d$</td>
<td>· $M O \quad - \quad M 2$</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M 1$</td>
</tr>
<tr>
<td>· M1 - M3</td>
<td>· $M 1 \quad - \quad M 1$</td>
<td>· $M 1 \quad - \quad M O$</td>
</tr>
<tr>
<td>· M3 - M1</td>
<td>· $M 2 \quad - \quad M 2$</td>
<td>· $M 2 \quad - \quad M 3$</td>
</tr>
<tr>
<td>· M2 - MO</td>
<td>· $M 3 \quad - \quad M 3$</td>
<td>· $M 3 \quad - \quad M 2$</td>
</tr>
</table>

a. Mirror-to-Mirror connection will be same as non-mirrored case.

b. Mirror die connectivity may have jogs and need additional layers on package.

c. For some mirrored cases, there are possible alternative connections to allow design choices between more routing layers vs. max
data rates, shown as Option 1 and Option 2 in Table 5-27. For x2 - x2 Stacked and x4 - x4 Stacked cases, Option 1 typically
requires 2x the routing layers and enables nominal data rates, while Option 2 enables same the layer count but at reduced max
data rates due to potential crosstalk. See Figure 5-56 for Option 2 connection illustrations.

Figure 5-55 shows the naming convention for 1, 2, or 4 Standard Package modules when they are
connected to their "Standard Die Rotate" counterparts that have a different number of Standard
Package modules.

<figure>
<figcaption>Figure 5-55. Examples for Standard Package Configurations Paired with "Standard Die Rotate" Counterparts, with a Different Number of Modules</figcaption>

MI

M3

MI

MJ

MT

7

A

4

MI

M3

\-

%

\-

\-

wicy

MO

M2

MD

M2

MU

M2

W

MO

M2

2

.

7

K

\-

nro

Hirey

0

w

EW

MO

IW

MD

x4 Stacked -x4 Unstacked

x4 Stacked - x2 Unstacked

\-

$4 \quad S t a c k e d \quad - x 1$

x4 Stacked - x2 Stacked

MI

MO

M2

M3

MI

MO

M2

Ma

M1

MO

M2

M3

\-

&

1441

1.MH

TE

W

\-

\-

(-16)

I

MD

LT
4

my

DW

x4 Unstacked - x2 Unstacked

x4 Unstacked - x2 Stacked

.

TW

$x 4 \quad U n s t a c k e d \quad - x 1$

MI

MI

MO

0

P

\-

I

6

T

I

\-

Bu

\-

W

\-
M

\-

-4

4

$x 2 \quad U n s t a c k e d \quad - x 1$

MO

x2 Stacked -x2 Unstacked

$x 2 \quad S t a c k e d \quad - x 1$

</figure>

Figure 5-56 shows the naming convention for 1, 2, or 4 Standard Package Modules when they are
connected to their "Mirrored Die Rotate" counterparts that have a different number of Standard
Package Modules.

<figure>
<figcaption>Figure 5-56. Examples for Standard Package Configurations Paired with "Mirrored Die Rotate" Counterparts, with a Different Number of Modules</figcaption>

MI

MR

Ta

MI

W

CON

MO

M2

MO

M2

MI

MO

A

..

..

.

1

IM

.

EM

0

VAT

I

\-

1

NO

x4 Stacked - x4 Unstacked

x4 Stacked - x2 Unstacked

x4 Stacked - x1

4

\-

x4 Stacked - x2 Stacked

MI

MO

MJ

MI

MO

M2

M3

MI

MO

M2

.

.

T

Te

T

H

..

1

..

..

DJ41

1-360

5

1100

A

0

I

\#

\-

x4 Unstacked - x2 Unstacked

x4 Unstacked $- \quad x 2$ Stacked

W

x4 Unstacked - x1

M1

M

M1

MU

n

\-

Tw

\-

MG

W

T

A

aJej

pTet

\-

x2 Unstacked -x1

0

1

WO

AT

WO

1

x2 Stacked - x2 Unstacked

×2 Stacked -x1

</figure>

Figure 5-57 illustrates the possible alternative connections for some mirrored cases to allow design
choices between more routing layers vs. reduced max data rates due to potential crosstalk, shown as
Option 2 in Table 5-27 and Table 5-28.

<figure>
<figcaption>Figure 5-57. Additional Examples for Standard Package Configurations Paired with "Mirrored Die Rotate" Counterparts, with a Different Number of Modules</figcaption>

MI

MI

M3

MI

M3

MI

M3

\-

-161

[x

MO

MO

M2

MD

M2

n

TA

N

D

A

2

Intel

161

TM

TA

Popel

(-200

I

WO

\-

WD

WS

W

.

OM

(*10)

\-

x4 Stacked - x2 Unstacked

WIT

EM

$x 2 \quad S t a c k e d \quad - \quad x 2 \quad S t a c k e d$

x4 Stacked - x4 Stacked

x4 Stacked - x2 Stacked

</figure>

Table 5-28 summarizes the connections between the combinations shown in Figure 5-55, Figure 5-56,
and Figure 5-57.

<table>
<caption>5.7.3.4.1 Module Degrade Rules Table 5-28. Summary of Standard Package Module Connection Combinations with Different Number of Modules on Both Sides</caption>
<tr>
<th rowspan="2">Standard Package Module Connections (Different # of Modules on Both Sides)</th>
<th rowspan="2">Standard Die Rotate Counterpartª</th>
<th colspan="2">Mirrored Die Rotate Counterpartª</th>
</tr>
<tr>
<th>Option 1 (See Figure 5-56)</th>
<th>Option 2 (See Figure 5-57)</th>
</tr>
<tr>
<td rowspan="4">x4 Stacked - x4 Unstacked</td>
<td>· $M O \quad - \quad M 2$</td>
<td>· $M O \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td>· $M 1 \quad - \quad M 3$</td>
<td>· $M 1 \quad - \quad M 1$</td>
<td></td>
</tr>
<tr>
<td>· M3 - M1</td>
<td>· M2 - M2</td>
<td></td>
</tr>
<tr>
<td>· $M 2 \quad - \quad M O$</td>
<td>· $M 3 \quad - \quad M 3$</td>
<td></td>
</tr>
<tr>
<td rowspan="4">x4 Stacked - x2 Stacked</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M O$</td>
<td>· MO - M1</td>
</tr>
<tr>
<td>· $M 1 \quad - \quad M 1$</td>
<td>· $M 1 \quad - \quad M 1$</td>
<td>· $M 1 \quad - \quad M O$</td>
</tr>
<tr>
<td>· $M 3 \quad - \quad N C$</td>
<td>· M2 - NC</td>
<td>· M2 - NC</td>
</tr>
<tr>
<td>· M2 - NC</td>
<td>· M3 - NC</td>
<td>· $M 3 \quad - \quad N C$</td>
</tr>
<tr>
<td rowspan="4">$x 4 \quad S t a c k e d \quad - \quad x 2 \quad U n s t a c k e d$</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M 1$</td>
<td>· MO - NC</td>
</tr>
<tr>
<td>· $M 1 \quad - \quad N C$</td>
<td>· $M 1 \quad - \quad N C$</td>
<td>· $M 1 \quad - \quad M 1$</td>
</tr>
<tr>
<td>· M3 - NC</td>
<td>· $M 2 \quad - \quad M O$</td>
<td>· M2 - NC</td>
</tr>
<tr>
<td>· $M 2 \quad - \quad M 1$</td>
<td>· M3 - NC</td>
<td>· $M 3 \quad - \quad M O$</td>
</tr>
<tr>
<td rowspan="4">$x 4 \quad S t a c k e d \quad - \quad x 1$</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td>· $M 1 \quad - \quad N C$</td>
<td>· $M 1 \quad - \quad N C$</td>
<td></td>
</tr>
<tr>
<td>· M3 - NC</td>
<td>· M3 - NC</td>
<td></td>
</tr>
<tr>
<td>· M2 - NC</td>
<td>· M2 - NC</td>
<td></td>
</tr>
<tr>
<td rowspan="4">x4 Unstacked - x2 Unstacked</td>
<td>· $M O \quad - \quad M 1$</td>
<td>· $M O \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td>· $M 1 \quad - \quad M O$</td>
<td>· $M 1 \quad - \quad M 1$</td>
<td></td>
</tr>
<tr>
<td>· M3 - NC</td>
<td>· M2 - NC</td>
<td></td>
</tr>
<tr>
<td>· M2 - NC</td>
<td>· M3 - NC</td>
<td></td>
</tr>
<tr>
<td rowspan="4">x4 Unstacked - x2 Stacked</td>
<td>· $M O \quad - \quad M 1$</td>
<td>· $M O \quad - \quad M 1$</td>
<td></td>
</tr>
<tr>
<td>· M1 - MO</td>
<td>· $M 1 \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td>· M3 - NC</td>
<td>· M2 - NC</td>
<td></td>
</tr>
<tr>
<td>· M2 - NC</td>
<td>· M3 - NC</td>
<td></td>
</tr>
<tr>
<td rowspan="4">$x 4 \quad U n s t a c k e d \quad - \quad x 1$</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td>· M1 - NC</td>
<td>· $M 1 \quad - \quad N C$</td>
<td></td>
</tr>
<tr>
<td>· M3 - NC</td>
<td>· M3 - NC</td>
<td></td>
</tr>
<tr>
<td>· M2 - NC</td>
<td>· M2 - NC</td>
<td></td>
</tr>
<tr>
<td rowspan="2">x2 Stacked - x2 Unstacked</td>
<td>· $M O \quad - \quad M 1$</td>
<td>· $M O \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td>· $M 1 \quad - \quad M O$</td>
<td>· $M 1 \quad - \quad M 1$</td>
<td></td>
</tr>
<tr>
<td rowspan="2">x2 Stacked - x1</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td>· M1 - NC</td>
<td>· $M 1 \quad - \quad N C$</td>
<td></td>
</tr>
<tr>
<td rowspan="2">x2 Unstacked - x1</td>
<td>· $M O \quad - \quad M O$</td>
<td>· $M O \quad - \quad M O$</td>
<td></td>
</tr>
<tr>
<td>· M1 - NC</td>
<td>· M1 - NC</td>
<td></td>
</tr>
</table>

a. NC indicates no connection.

On a 2-module or 4-module link, if one or more module-pairs have failed, the link will be degraded
and shall comply with the following rules:

1\. The degraded link shall be either one or two modules, and shall not be three modules.

a. For a 4-module link:

i. If any one module-pair failed, it shall be degraded to a 2-module link.

ii. If any two module-pairs failed, it shall be degraded to a 2-module link.

iii. If any three module-pairs failed, it shall be degraded to a 1-module link.

b. For a 2-module link:

i. If any one module-pair failed, it shall be degraded to a 1-module link.

2\. For a 4-module link, if only one module-pair failed, one additional module-pair that belongs to the
"same half" (along the Die Edge) of the 4-module will be disabled/degraded.

Figure 5-58 illustrates an example with a x4 Unstacked connected to a x4 Unstacked "Standard Die
Rotate" counterpart with one MO - M2 pair failed. The M1 - M3 pair on its left shall be disabled
accordingly to comply with the rules defined above, which will be denoted as "x (d)" in Table 5-29.

<figure>
<figcaption>Note: The double-ended arrows in Figure 5-58 indicate Module-to-Module connections. Figure 5-58. Example of a Configuration for Standard Package, with Some Modules Disabled</figcaption>

M1

Tx
(x16)

MO

Rx
(x16)

Tx
(x16)

Rx
(x16)

Tx
(x16)

M2

Rx
(x16)

Tx
(x16)

M3

Rx

(x16)

X (degraded)
☒

X
☒

(x16)

(x16)
XL

(x16)
Rx

(9T*)
×1

(91x)
Rx

(×16)
XL

(x16)
Rx

(×16)
×1

RX

M3

M2

MO

M1

</figure>

Table 5-29 summarizes the resulting degraded link if there are one, two, or three failed module-pairs
for the x4 Unstacked to x4 Unstacked configuration.

<table>
<caption>Table 5-29. Summary of Degraded Links when Standard Package Module-pairs Fail</caption>
<tr>
<th rowspan="2">Module - Module Partner Pair</th>
<th colspan="14">Number of Module-pairs Failedª</th>
</tr>
<tr>
<th colspan="4">1-fail</th>
<th colspan="2"></th>
<th colspan="4">2-fail</th>
<th colspan="4">3-fail</th>
</tr>
<tr>
<td>$M O \quad - \quad M 2$</td>
<td>$x$ ☒</td>
<td>$x \left( d \right)$ ☒</td>
<td>☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
<td>☒</td>
<td>☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
<td>☒</td>
</tr>
<tr>
<td>$M 1 \quad - \quad M 3$</td>
<td>$x \left( d \right)$ ☒</td>
<td>☒ x</td>
<td>☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
<td>☒</td>
<td>$x$ ☒</td>
</tr>
<tr>
<td>$M 3 \quad - \quad M 1$</td>
<td>☒</td>
<td>☒</td>
<td>☒ x</td>
<td>$x \left( d \right)$ ☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
</tr>
<tr>
<td>$M 2 \quad - \quad M O$</td>
<td>☒</td>
<td>☒</td>
<td>$x \left( d \right)$ ☒</td>
<td>$x$ ☒</td>
<td>☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
<td>☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
<td>$x$ ☒</td>
</tr>
</table>

a. x = Failed Module - Module Partner Pair.
☒

x (d) = Disabled Module - Module Partner Pair to comply with Degrade rules.
☒

v = Functional Module - Module Partner Pair.
☒

All other module configurations shall follow the same Module Degrade rules as defined above.

### 5.7.4 UCIe-S Sideband-only Port

A UCIe-S sideband-only port is also permitted for test/manageability purposes. The RDI signals to the
sideband port for a sideband-only configuration are the same as for a sideband with mainband
configuration (see Chapter 10.0 for details of the latter).

Figure 5-59 shows the bump map for a UCIe-S sideband-only port. Figure 5-60 shows the supported
configurations for a UCIe-S sideband-only port.

<figure>
<figcaption>Figure 5-59. UCIe-S Sideband-only Port Bump Map</figcaption>

VSS

m1rxdatasb

m1rxcksb

vccaon

VSS

m1txcksb

m1txdatasb

</figure>

<figure>
<figcaption>Figure 5-60. UCIe-S Sideband-only Port Supported Configurations</figcaption>

Config 1

Config 2

UCIe-S
SB-only

UCIe-S
SB-only

SB

MB

UCIe-S
SB-only

CIe-S x16/x8

</figure>

#### 5.8 Tightly Coupled Mode

Tightly Coupled PHY mode is defined as when both of the following conditions are met:

· Shared Power Supply between Tx and Rx, or Forwarded Power Supply from Tx to Rx

. Channel supports larger eye mask defined in Table 5-30

In this mode, there is no Receiver termination and the Transmitter must provide full swing output. In
this mode, further optimization of PHY circuit and power reduction is possible. For example, a tuned
inverter can potentially be used instead of a front-end amplifier. Training complexity such as voltage
reference can be simplified.

<table>
<caption>Table 5-30. Tightly Coupled Mode: Eye Mask</caption>
<tr>
<th>Data Rate</th>
<th>4-16 GT/s</th>
</tr>
<tr>
<td>Overall (Eye Closure due to Channel)a</td>
<td></td>
</tr>
<tr>
<td>Eye Heightb</td>
<td>250 mV</td>
</tr>
<tr>
<td>Eye Width (rectangular eye mask with specified eye height)</td>
<td>0.7 UI</td>
</tr>
</table>

a. With 750-mV Transmitter signal swing.

b. Centered around VCCFWDIO/2.

Loss and crosstalk requirement follow the same VTF method, adjusting to the eye mask defined in
Table 5-30. Table 5-31 shows the specification at Nyquist frequency.

<table>
<caption>Table 5-31. Tightly Coupled Mode Channel for Advanced Package</caption>
<tr>
<th>Data Rate</th>
<th>4-12 GT/s</th>
<th>16 GT/s</th>
</tr>
<tr>
<td>VTF Lossª (dB)</td>
<td>L(fN) &gt; -3</td>
<td>-</td>
</tr>
<tr>
<td>VTF Crosstalkª (dB)</td>
<td>XT(f) &lt; 1.5 * L(fN) - 21.5 and $X T \left( f _ { N } \right) < - 2 3$</td>
<td>-</td>
</tr>
</table>

a. Based on Voltage Transfer Function (Tx: 25 ohm / 0.25 pF; Rx: 0.2 pF).

Loss and crosstalk specifications between DC and Nyquist $\mathrm { f } _ { \mathrm { N } }$ follow the same methodology defined in
Section 5.7.2.1.

Although the use of this mode is primarily for Advanced Package, it may also be used for Standard
Package when two Dies are near one another and Receiver must be unterminated.

##### 5.9 Interconnect redundancy Remapping

###### 5.9.1 Advanced Package Lane Remapping

Interconnect Lane remapping is supported in Advanced Package Module to improve assembly yield
and recover functionality. Each module supports:

· Four redundant bumps for Data

. One redundant bump for Clock and Track

· One redundant bump for Valid

For x64 Advanced Package modules, the four redundant bumps for data repair are divided into two
groups of two. Figure 5-61 shows an illustration of x64 Advanced package module redundant bump
assignment for data signals. TRD_P0 and TRD_P1 are allocated to the lower 32 data Lanes and
TRD_P2 and TRD_P3 are allocated to the upper 32 data Lanes. Each group is permitted to remap up

to two Lanes. For example, TD15 is a broken Lane in the lower half and TD_P32 and TD_P40 are
broken Lanes in the upper 32 Lanes. Figure 5-62 illustrates Lane remapping for the broken Lanes.

For x32 Advanced Package modules, only the lower 32 data lanes and TRD_P0 and TRD_P1 apply in
Figure 5-61 and Figure 5-62.

Details and implementation of Lane remapping for Data, Clock, Track, and Valid are provided in
Section 4.3.

<figure>
<figcaption>Figure 5-61. Data Lane repair resources</figcaption>

TD_P2

TD_P9

TD_P16

TD_P23

TD_P30

TD_P34

TD_P41

TD_P48

TD_P55

TD_P62

TD_P3

$T D _ { - } P 1 0$

TD_P17

TD_P24

TD_P31

$T D _ { - } P 3 5$

TD_P42

TD_P49

TD_P56

TD_P63

TD_P1

TD_P8

TD_P15

TD_P22

TD_P29

TD_P33

TD_P40

TD_P47

TD_P54

TD_P61

$T D _ { - } P$

TD_P11

$T D _ { - } P 1 8$

TD_P25

TRD_P1

TD_P36

TD_P43

TD_P50

TD_P57

TRD_P3

TD_P0

TD_P7

$T D _ { - } P 1 4$

TD_P21

TD_P28

$T D _ { - } P 3 2$

$T D _ { - } P 3$

$T D _ { - } P 4 6$

TD_P53

TD_P60

TD_P5

$T D \_ P 1 2$

$T D _ { - P 1 }$

TD_P26

TD_P37

TD_P44

TD_P51

TD_P58

TRD_P0

$T D _ { - } P$

TD_P13

TD_P20

TD_P27

TRD_P2

TD_P38

$T D \_ P 4 5$

TD_P52

TD_P59

</figure>

<figure>
<figcaption>Figure 5-62. Data Lane repair</figcaption>

TD_P2

TD_P9

TD_P16

$T D _ { 2 }$

TD_P30

TD_P34

TD_P41

TD_P48

$T D \_ P 5 5$

$T D _ { 2 } P 6 2$

TD_P3

TD_P10

$T D \_ P 1 7$

TD_P24

$T D \_ P 3 1$

TD_P35

TD_P42

TD_P49

TD_P56

TD_P63

TD_P1

TD_P8

TD <15

TD_P22

TD_P29

$T D \_ P 3 3$

TD 40

TD_P47

TD_P54

TD_P61

TD_P4

$T D \_ P 1 1$

TD_P18

TD_P25

TRD_P1

TD_P36

TD_P43

TD_P50

$P 5 ^ { \circ }$

TRD_P3

TD_P0

TD_P7

$T D \_ P 1 4$

TD_P21

TD_P28

TD -32

TD_P39

TD_P46

$T D \_ P 5 3$

TD_P60

TD_P5

TD_P12

TD_P19

TD_P26

TD_P37

TD_P44

TD_P51

TD_P58

TRD_P0

$T D _ { - } P 6$

TD_P13

TD_P20

TD_P27

TRD_P2

TD_P38

TD_P45

TD_P52

TD_P59

</figure>

###### 5.9.2 Standard Package Lane remapping

Lane repair is not supported in Standard Package modules.

##### 5.10 BER Requirements, CRC, and Retry

The BER requirement based on channel reach defined in Section 5.7 is shown in Table 5-32. Error
detection and correction mechanisms such as CRC and retry are required for BER of 1E-15 or higher
to achieve the required Failure In Time (FIT) rate of significantly less than 1 (1 FIT = 1 device failure
in 109 Hours). The UCIe spec defined CRC and retry is detailed in Chapter 3.0. For the BER of 1E-27,
either parity or CRC can be used and the appropriate error reporting mechanism must be invoked to
ensure a FIT that is significantly less than 1.

<table>
<caption>Table 5-32. Raw BER Requirements</caption>
<tr>
<th rowspan="2">Package Type</th>
<th colspan="8">Data Rate $\left( \mathrm { G T } / \mathrm { s } \right)$</th>
</tr>
<tr>
<th>4</th>
<th>8</th>
<th>12</th>
<th>16</th>
<th>24</th>
<th>32</th>
<th>48</th>
<th>64</th>
</tr>
<tr>
<td>Advanced Package</td>
<td>1E-27</td>
<td>1E-27</td>
<td>1E-27</td>
<td>1E-15</td>
<td>1E-15</td>
<td>1E-15</td>
<td>1E-15</td>
<td>1E-12</td>
</tr>
<tr>
<td>Standard Package</td>
<td>1E-27</td>
<td>1E-27</td>
<td>1E-15</td>
<td>$1 E - 1 5$</td>
<td>1E-15</td>
<td>1E-15</td>
<td>1E-15</td>
<td>$1 E - 1 2$</td>
</tr>
</table>

###### 5.11 Valid and Clock Gating

Valid is used to frame transmit data. For a single transmission of 8 UI data packet, Valid is asserted
for the first 4 UI and de-asserted for the second 4 UI. Figure 5-63 shows the transfer of two 8 UI data
packets back to back.

<figure>
<figcaption>Figure 5-63. Valid Framing</figcaption>

Clock

Valid

Data

8 UI

8 UI

</figure>

As described in Section 4.1.3, clock must be gated only after Valid signal remains low for 16 UI
(8 cycles) of postamble clock for half-rate clocking and 32 UI (8 cycles) of postamble clock for
quarter-rate clocking, unless free running clock mode is negotiated.

Idle state is when there is no data transmission on the mainband. During Idle state, Data, Clock, and
Valid Lanes must hold values as follows:

. If the Link is unterminated, some Data Lane Transmitters are permitted to remain toggling up to
the same transition density as the scrambled data without advancing the scrambler state. The
remaining Data Lane Transmitters must hold the data of the last transmitted bit. Valid Lane must
be held low until the next normal transmission.

\- In Strobe mode, the clock level in a clock-gated state for half-rate clocking (after meeting
postamble requirement) must alternate between differential high and differential low during
consecutive clock-gating events. For quarter-rate clocking, the clock level in a clock-gated
state must alternate between high and low for both phases (Phase-1 and Phase-2)
simultaneously. Clock must drive a differential (simultaneous) low for half- (quarter-) rate
clocking for at least 1 UI or a maximum of 8 UI before normal operation. The total clock-gated
period must be an integer multiple of 8 UI. Example shown in Figure 5-64 and Figure 5-65.

\- In Continuous mode, the clock remains free running (examples shown in Figure 5-66). Total
idle period must be an integer multiple of 8 UI.

<figure>
<figcaption>Figure 5-64. Data, Clock, Valid Levels for Half-rate Clocking: Clock-gated Unterminated Link</figcaption>

Clock Gated (Multiple of 8 UI: N * 8 UI)

Normal operation

Clock Postamble

Normal operation

Clock

Parked Clock Level

Valid

Data[n]

D0

D1

De

DB

D4

D5

D6

D7

D7 or Implementation-specific pattern

16 UL

1 UI to 8 UI

</figure>

<figure>
<figcaption>Figure 5-65. Data, Clock, Valid Levels for Quarter-rate Clocking: Clock-gated Unterminated Link</figcaption>

Normal operation

Clock Postamble

Clock Gated (Multiple of Valid frames: N * 8 UI)

Normal operation

Quad Clock

Phase-1

Parked Clock Level

Quad Clock
Phase-2

Parked Cock Level

Valid

Data[n]

D0

D1

D2

DB

D4

D5

D6

D7

D7 or Implementation-specific pattern

32 UI

1 UI to 8 UI

</figure>

Figure 5-66.
Data, Clock, Valid Levels for Half-rate Clocking:
Continuous Clock Unterminated Link

<table>
<tr>
<th></th>
<th>Normal operation</th>
<th>Free running (Multiple of 8 UI: N * 8 UI)</th>
<th colspan="2">Normal operation</th>
</tr>
<tr>
<td>Clock Valid</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td colspan="2" rowspan="3">Data[n] D0 D1 D2 DB D4 D5 D6 D7</td>
<td></td>
<td></td>
<td rowspan="3"></td>
</tr>
<tr>
<td>D7 or Implementation-specific pattern</td>
<td rowspan="2"></td>
</tr>
<tr>
<td></td>
</tr>
</table>

<figure>
</figure>

. If the Link is terminated, some Data Lane Transmitters are permitted to remain toggling up to the
same transition density as the scrambled data without advancing the scrambler state. The
remaining Data Lanes' Transmitters hold the data of the last-transmitted bit for 16 UIs under half-
rate clocking and 32 UIs under quarter-rate clocking, before transitioning to Hi-Z. Valid Lane must
be held low until the next normal transmission. Note that keeping the transmitter toggling will
incur extra power penalty and should be applied with discretion.

\- In Strobe mode, the clock level in a clock-gated state for half-rate clocking (after meeting
postamble requirement) must alternate between differential high and differential low during
consecutive clock-gating events. For quarter-rate clocking, the clock level in a clock-gated
state must alternate between high and low for both phases (Phase-1 and Phase-2)
simultaneously. Transmitters must precondition the Data Lanes to a 0 or 1 (V) and clock must
drive a differential low for at least 1 UI or up to a maximum of 8 UIs for half- (quarter-) rate
clocking before the normal transmission. The total clock-gated period must be an integer
multiple of 8 UI. Example shown in Figure 5-67 and Figure 5-69.

\- In Continuous mode, the clock remains free running (examples shown in Figure 5-70).
Transmitters must precondition the Data Lanes to a 0 or 1 (V) for at least 1 UI or up to a
maximum of 8 UI. Total idle period must be an integer multiple of 8 UI.

Note:
Entry into and Exit from Hi-Z state are analog transitions. Hi-Z represents Transmitter
state and the actual voltage during this period will be pulled Low due to termination to
ground at the Receiver.

<figure>
<figcaption>Figure 5-67. Data, Clock, Valid Gated Levels for Half-rate Clocking: Terminated Link</figcaption>

Normal operation

Clock Postamble

Clock Gated (Multiple of 8 UI: N*8UI)

Normal operation

Clock

Parked Clock Level

Valid

Data: Hi-Z

Data[n]

D0

D1

D2

DB

D4

D5

D6

D7

D7

V

16 UI

1 UI to 8 UI

</figure>

<figure>
<figcaption>Figure 5-68. Data, Clock, Valid Gated Levels for Quarter-rate Clocking: Terminated Link</figcaption>

Normal operation

$\mathrm { C l o c k } \mathrm { P o s t a m b l }$

Clock Gated (Multiple of Valid frames: N*8UI)

Normal operation

Quad Clock

Phase -1

Parked Clock Level

Quad Clock

Phase - 2

Parked Clock Level

Valid

Data: Hi-Z

Data[n]

D0

D1

D2

DB

D4

D5

D6

D7

D7

32 UI

1 UI to 8 UI

</figure>

<figure>
<figcaption>Figure 5-69. Data, Clock, Valid Gated Levels for Half-rate Clocking: Continuous Clock Terminated Link</figcaption>

Normal operation

Free running (Multiple of 8 UI : N*8UI)

Normal operation

Clock

Valid

Data: Hi-Z

Data[n]

D0

D1

D2

DB

D4

D5

D6

D7

D7

V

16 UI

1 UI to 8 UI

</figure>

For data rates of 48 GT.s and 64 GT/s, the forwarded clock lanes must operate in continuous mode.
Hamming distance 4 encoding is utilized for Valid Framing, Retimers, and other potential applications.
At these data rates, it is required to implement double-error detection and single-error correction for
the Valid signal. This requirement aims to minimize the frequency of Link re-training events that are
caused by Valid framing errors, while ensuring a sufficiently low probability of failure. Table 4-1
describes the four legal Valid Framing encodings for retimers. For non-retimer links, only two of those
encodings are legal. A received value that is one bit different from one of those legal encodings is
corrected to that legal encoding. A received value that is two or more bits different from one of those
legal encodings is detected as a Valid framing error.

Track operation and Strobe mode:

· Track may be enabled during Link Training (MBTRAIN.RXCLKCAL) and when runtime recalibration
is requested

· When Track is enabled, both CLKP/N and Track will remain ON until the flow is complete

· Track may be enabled during mainband data transfer or during Electrical Idle state

. If Strobe mode is selected and runtime recalibration is on-going, the clock continues to toggle
even if the Idle state is entered, until the flow is complete

##### 5.12 Electrical Idle

Some training states need electrical idle when Transmitters and Receivers are waiting for generate
and receive patterns.

· Electrical idle on the mainband in this Specification is described as when Transmitters and
Receivers are enabled; Data, Valid and Track Lanes are held low and Clock is parked at high and
low.

##### 5.13 Sideband signaling

Each module supports a sideband interface. The sideband is a two-signal interface that is used for the
transmit and receive directions. The sideband data is an 800 MT/s single data rate signal with an 800-
MHz source. Channel reach of the sideband is the same as that of the main band, as defined in
Table 1-1 and Table 1-2, unless explicitly stated otherwise in the extended reach setting. The
extended reach setting must meet the Tx Driver Output Impedance specified in Table 5-33. Sideband
should run on power supply and clock derived from the auxiliary clock (AUXCLK) source which are
always on (VCCAON). See Section 5.13.2 for AUXCLK details.

Sideband data is sent edge aligned with the positive edge of the strobe. The Receiver must sample
the incoming data with the strobe. The negative edge of the strobe is used to sample the data as the
data uses single data rate signaling as shown in Figure 5-70. Sideband transmission is described in
Section 4.1.5.

For Advanced Package modules, redundancy is supported for the sideband interface. Sideband
initialization and repair are described in Section 4.5.3.2. There is no redundancy and no Lane repair
support on Standard Package modules.

<figure>
<figcaption>Figure 5-70. Sideband signaling</figcaption>

SB Clock

SB Message

</figure>

###### 5.13.1 Sideband Electrical Parameters

Table 5-33 shows the sideband electrical parameters.

It is strongly recommended that the two sides of the sideband I/O Link share the same power supply
rail.

s

<table>
<caption>Table 5-33. Sideband Parameters summary</caption>
<tr>
<th>Parameter</th>
<th>Min</th>
<th>Typ</th>
<th>Max</th>
<th>Unit</th>
</tr>
<tr>
<td>Supply voltage (VCCAON)ª</td>
<td>0.65</td>
<td></td>
<td></td>
<td>☒ V</td>
</tr>
<tr>
<td></td>
<td>0.8*VCCAON</td>
<td>—</td>
<td>—</td>
<td>☒ V</td>
</tr>
<tr>
<td>$\left( V _ { I H } \right)$</td>
<td>0.7*VCCAON</td>
<td></td>
<td></td>
<td>☒ V</td>
</tr>
<tr>
<td>Input low voltage (VIL)</td>
<td></td>
<td></td>
<td>0.3*VCCAON</td>
<td>☒ V</td>
</tr>
<tr>
<td>Output high voltage $\left( V _ { O H } \right)$</td>
<td>0.9*VCCCAON</td>
<td></td>
<td></td>
<td>☒ V</td>
</tr>
<tr>
<td>Output low voltage $\left( \mathrm { V } _ { \mathrm { O L } } \right)$</td>
<td></td>
<td></td>
<td>0.1*VCCAON</td>
<td>☒ V</td>
</tr>
<tr>
<td>$\text { Sideband Data } \mathrm { S e t u p } \mathrm { T i m e } ^ { \mathrm { t } }$</td>
<td>200</td>
<td>—</td>
<td>—</td>
<td>ps</td>
</tr>
<tr>
<td>Sideband Data Hold Timeb</td>
<td>200</td>
<td>—</td>
<td>—</td>
<td>ps</td>
</tr>
<tr>
<td>Rise/Fall time for Advanced Packagec, d</td>
<td>50</td>
<td>—</td>
<td>280</td>
<td>ps</td>
</tr>
<tr>
<td>Rise/Fall time for Standard Packagee, d</td>
<td>80</td>
<td>—</td>
<td>175</td>
<td>ps</td>
</tr>
<tr>
<td>Extended Reach Channel Length (Standard Package)</td>
<td></td>
<td></td>
<td>100</td>
<td>mm</td>
</tr>
<tr>
<td>Tx Driver Output Impedance for Extended Reachf</td>
<td></td>
<td></td>
<td>60</td>
<td>Ohms</td>
</tr>
</table>

a. Always On power supply. The guidelines for maximum Voltage presented in Section 1.5 apply to sideband signaling.

b. The Setup and Hold Times are referenced to the Sideband Data in relation to the falling edge of the Sideband Clock
at Sideband Rx.

c. 20 to 80% of VCCAON level with Advanced Package reference channel load.

d. This specification applies to sideband of channel length the same as that of the mainband.

e. 20 to 80% of VCCAON level with Standard Package reference channel load.

f. This specification is only required for enabling the extended reach sideband. The specification must be met across variations in
process, voltage, and temperature.

###### 5.13.2 Auxiliary Clock (AUXCLK)

Auxiliary clock (AUXCLK) may be from any clock source. Although other clock frequencies are
possible, it is recommended that every chiplet should also use a 100-MHz clock source. Table 5-34
lists the permitted auxiliary clock frequency range. The minimum and maximum frequencies listed in
the table indicate the limits, and do not indicate a requirement to support the entire frequency range.
Reference clock (REFCLK; see Section 5.1.2) can be used if it is always on. Spread-Spectrum Clocking
(SSC) is permitted. AUXCLK has relaxed tolerances compared to REFCLK.

<table>
<caption>Table 5-34. AUXCLK Frequency Parameters</caption>
<tr>
<th rowspan="2">Symbol</th>
<th rowspan="2">Description</th>
<th colspan="3">Limits</th>
<th rowspan="2">Unit</th>
<th rowspan="2">Notes</th>
</tr>
<tr>
<th>Min</th>
<th>Rec</th>
<th>Max</th>
</tr>
<tr>
<td>FAUXCLK</td>
<td>AUXCLK Frequency</td>
<td>25</td>
<td>100</td>
<td>800</td>
<td>MHz</td>
<td></td>
</tr>
</table>

##### 5.14 Open Drain

An Open-drain net is resistively pulled up and one or multiple drivers can pull down the net. Any of
the drivers can pull down the net such that all sinks will detect the net as low within the maximum fall
time. When all drivers have stopped pulling the net low, all sinks will detect the net as high within the
maximum rise time.

A chiplet can optionally support an Open Drain pin that connects to a common net. The Open Drain
has been specified for a pin connected to a common package route. This pin is not required to be on
the same die-edge as the UCIe macro. For an SiP with a small number of chiplets, it is possible for the
Open Drain to be routed on the substrate. It is recommended that SiP integrators perform the
necessary simulations to ensure functionality.

Figure 5-71 shows an example using Open Drain to connect 16 modules of 10 mm x 10 mm size with
5-mm separation. Note that this example assumes worst-case routing where a default package
resistor pull-up is on one end of the Open Drain net. Actual implementations may have more
optimized routing compared to the figure. This should allow for meeting the specifications in
Table 5-35 more easily.

<figure>
<figcaption>Figure 5-71. Example Package Route for Open Drain Signal</figcaption>

$R _ { p u l l - u p }$

15 mm

15 mm

15 mm

7.5 mm

2.5 mm

2.5 mm

2.5 mm

2.5 mm

10 x 10
mm2

$1 0 \times 1 0$
mm2

10 x 10
mm2

15 mm

10 x 10

mm2

2.5 mm

2.5 mm

2.5 mm

2.5 mm

15 mm

Chiplet

$1 0 \times 1 0$
$m m ^ { 2 }$

$1 0 \times 1 0$
$m m ^ { 2 }$

$1 0 \times 1 0$
mmª

$1 0 \times 1 0$
mm

15 mm

10 × 10
mmª

10 × 10

10 x 10
mm

10 × 10
mm

Approximately
250-mm total
routing length

$m m ^ { 4 }$

$2 . 5 \quad m m$

2.5 mm

2.5 mm

2.5 mm

10 × 10
mm2

10 × 10
mm2

10 × 10
mm2

10 x 10
mm2

15 mm

2.5 mm

2.5 mm

2.5 mm

2.5 mm

$1 5 \quad m m$

$1 5 \quad m m$

15 mm

7.5 mm

</figure>

<table>
<caption>Table 5-35. Open Drain Specification Summary</caption>
<tr>
<th>Parameter</th>
<th>Min</th>
<th>Typ</th>
<th>Max</th>
<th>Units</th>
<th>Notes</th>
</tr>
<tr>
<td>$R _ { \text { pull-down } }$</td>
<td>120</td>
<td>180</td>
<td>240</td>
<td>Ohms</td>
<td>a</td>
</tr>
<tr>
<td>$R _ { \mathrm { p u l l - u p } }$</td>
<td>5K</td>
<td>7.5K</td>
<td>10K</td>
<td>Ohms</td>
<td>a</td>
</tr>
<tr>
<td>$\left( V _ { H } \right)$</td>
<td>$0 . 7 ^ { * } V C C A O N$</td>
<td></td>
<td></td>
<td>V</td>
<td></td>
</tr>
<tr>
<td>Input low voltage $\left( \mathrm { V } _ { \mathrm { I L } } \right)$</td>
<td></td>
<td></td>
<td>0.3*VCCAON</td>
<td>V</td>
<td></td>
</tr>
<tr>
<td>Output high voltage $\left( \mathrm { V } _ { \mathrm { O H } } \right)$</td>
<td>0.9*VCCAON</td>
<td></td>
<td></td>
<td>V</td>
<td></td>
</tr>
<tr>
<td>Output low voltage $\left( \mathrm { V } _ { \mathrm { O L } } \right)$</td>
<td></td>
<td></td>
<td>0.1*VCCAON</td>
<td>V</td>
<td></td>
</tr>
<tr>
<td>Rise time</td>
<td>-</td>
<td>1.5</td>
<td>&lt;2.0</td>
<td>us</td>
<td>b</td>
</tr>
<tr>
<td>Fall time</td>
<td>-</td>
<td>30</td>
<td>&lt;100</td>
<td>ns</td>
<td>c</td>
</tr>
<tr>
<td>Pin Capacitance $\left( \mathrm { C } _ { \mathrm { D i n } } \right)$</td>
<td></td>
<td></td>
<td>1</td>
<td>$\mathrm { p F }$</td>
<td></td>
</tr>
</table>

Note: Requires typical package routing and default single pull-up resistor on package.

a. Ratio $R _ { \text { pull-down } } / \left( R _ { \text { pull-down } } + R _ { \text { pull-up } } \right)$ is important to meet $\mathrm { V } _ { \mathrm { O L } } .$ Any combination of Min/Max values meets the
requirements.

b. Rise time to $V _ { O H } < 2 .$

C.
Fall time to $V _ { O I } < 1 0 0 .$

The specification must be met across variations in process, voltage, and temperature.

###### 5.14.1 Open Drain Usage

Open Drain pins enable low-latency, bidirectional events. The Open Drain signals are used for some
specified UCIe low-latency events (see Section 8.4.2.1 and Section 8.4.2.2), as well as vendor-
defined events.

###### 5.14.2 External Open Drain Connections

The Open Drain specification is recommended to use for in-package routing. Systems that require
external event connections are recommended to use a separate pin for external event
communications. In this case, it is expected that one chiplet provides any associated bridging
between the internal Open Drain and the external event pin. Figure 5-72 shows an example of
bridging between internal Open Drain and external event pin. Although not shown in Figure 5-72, it is
possible that the external event pin is also bidirectional. Details of external Open Drain
implementation are beyond the scope of this specification.

<figure>
<figcaption>$F i g u r e \quad 5 - 7 2 .$ Example Bridging between Internal and External Event Pin</figcaption>

External
Event/Monitor

External
Event/Monitor

VCCAON

VCCAON

External Pin
(External
I/O Voltage)

ENB

$I / O +$
Bridge

Chiplet A

Chiplet B

Bridging Circuit

Chiplet C

Chiplet D

</figure>

# IMPLEMENTATION NOTE

## Bridging Circuit

If the event being communicated indicates that we are approaching or exceeding
standard operating conditions, it is advisable that the bridging circuitry be designed
to maintain functionality beyond standard operating conditions.

# 6.0 UCIe-3D

## 6.1 Introduction

Three-dimensional heterogeneously integrated technologies present an opportunity for the
development of new electronic systems with advantages of higher bandwidth and lower power as
compared to 2D and 2.5D architectures. 3D will enable applications where the scale of data
movement is impractical for monolithic, 2D, or 2.5D approaches.

Universal Chiplet Interconnect express for 3D packaging (UCIe-3D) is designed as a universally
applicable interface for 3D die-to-die communication. Figure 6-1 illustrates an example of two dies
stacked in a 3D configuration. UCIe-3D uses a two-dimensional array of interconnect bumps for data
transmission between dies.

<figure>
<figcaption>Figure 6-1. Example of 3D Die Stacking</figcaption>

Face-to-Face Hybrid Bonding

TSVs

Package Substrate

C4 Bumps

</figure>

## 6.2 UCIe-3D Features and Summary

While the UCIe 2D and 2.5D models strive for seamless plug-and-play interoperability, the UCIe-3D
model necessitates a more-integrated approach due to the inherent characteristics of packaging
technology. The objective is to offer a range of options or a "menu" from which users can select what
best suits their needs. The primary objectives and general methodology for UCIe-3D are as follows:

· Circuit and logic must fit within the bump area (i.e., UCIe will continue to be bump-limited). Given
the high density, this will translate to lower operating frequencies and a much-simplified circuit
(e.g., at 1-um bump-pitch, the UCIe-3D area amortized on a per-lane basis must be less than 1
um2).

. No D2D adapter. Low BER due to low-frequency and almost zero-channel distance - No CRC/
replay is needed.

. A hardened minimal PHY such as a simple inverter/driver. The SoC Logic connects directly to the
PHY.

· All debug/testability hooks are located within a common block (across all UCIe-3D Links) that is
connected to the SoC Logic network inside the chiplet.

. Lane repair becomes a bundle-wide repair that is orchestrated by the SoC Logic.

<figure>
<figcaption>Figure 6-2. UCIe-3D Illustration</figcaption>

PHY

PHY

PHY

Chiplet 0

SoC.

SoC

SoC

0

1

2

Logic

Logic

Logic

3

4

5

PHY

6

7

8

PHY

SoC

PHY

Logic

SoC

SoC
Logic

Chiplet

A

EC
G

1

2

2\.

Logic

TDPI

3

X

5

PHY

PHY

6

7:

B

8

Soc
Logic

SoC
Logic

PHY

SoC

Logic

(a)

(b)

Chiplets connected across each SoC with UCIe-3D.
A failure in UCIe-3D in either die results in the
remaining SoCs being routing around the failure.

Each chiplet has its own system controller logic,
I/Os, etc. Each SoC Logic connects to one or more
UCIe-3D PHY. The common test, debug, pattern,
and infrastructure (TDPI) block orchestrates
training, testing, debug, etc. across chiplets.

</figure>

<table>
<caption>Table 6-1 summarizes the key performance indicators of the proposed UCIe-3D. Table 6-1. UCIe-3D Key Performance Indicators (Sheet 1 of 2)</caption>
<tr>
<th>Characteristics/KPIs</th>
<th>UCIe-S</th>
<th>UCIe-A</th>
<th>UCIe-3D</th>
<th>Comments for UCIe-3D</th>
</tr>
<tr>
<td colspan="5">Characteristics</td>
</tr>
<tr>
<td>Data Rate (GT/s)</td>
<td colspan="2">4, 8, 12, 16, 24, 32, 48, 64</td>
<td>up to 4</td>
<td>· Equal to SoC Logic Frequency - power efficiency is critical</td>
</tr>
<tr>
<td>Width (each cluster)</td>
<td>16</td>
<td>64</td>
<td>80</td>
<td>· Options of reduced width to 70, 60, ...</td>
</tr>
<tr>
<td>Bump Pitch (um)</td>
<td>100 to 130</td>
<td>$2 5 \quad t o \quad 5 5$</td>
<td>≤ 10 (optimized) &gt; 10 to 25 (functional)</td>
<td>· Must scale such that UCIe-3D fits within the bump area · Must support hybrid bonding</td>
</tr>
<tr>
<td>$C h a n n e l \quad R e a c h$ (mm)</td>
<td>≤ 25</td>
<td>≤ 2</td>
<td>3D vertical</td>
<td>· F2F bonding initially; F2B, B2B, multi-stack possible</td>
</tr>
<tr>
<td colspan="5">Target for Key Metrics</td>
</tr>
<tr>
<td>{ \text { BW Die Edg } }<br>{ \left( G B / s / m m \right) }</td>
<td>$2 8 \quad t o \quad 3 7 0$</td>
<td>$1 6 5 \quad t o \quad 2 6 3 4$</td>
<td>N/A (vertical)</td>
<td></td>
</tr>
<tr>
<td>$B W \quad D e n s i t y$</td>
<td>22 to 192</td>
<td>188 to 1646</td>
<td>4,000 at 9 um</td>
<td>· 4 TB/s/mm2 at 9 um · Approximately 12 TB/s/mm2 at 5 um · Approximately $3 5 T B / s / m m ^ { 2 }$ at 3 um · Approximately $3 0 0 T B / s / m m ^ { 2 }$ at 1 um</td>
</tr>
<tr>
<td>Power Efficiency Target (pJ/b)</td>
<td>$0 . 5 0 \quad t o$</td>
<td>0.25 to 0.50</td>
<td>$< 0 . 0 5 \quad a t \quad 9 \quad u m$</td>
<td>· Conservatively estimated at 9-um pitch · &lt; 0.02 for 3-um pitch</td>
</tr>
<tr>
<td>Low-power Entry/Exit</td>
<td colspan="2">0.5 ns at ≤ 16 GT/s $0 . 5 \text { ns to } 1 \text { ns at } \geq 2 4$</td>
<td>0 ns</td>
<td>· No preamble or postamble</td>
</tr>
</table>

<table>
<caption>Table 6-1. UCIe-3D Key Performance Indicators (Sheet 2 of 2)</caption>
<tr>
<th>Characteristics/KPIs</th>
<th>UCIe-S</th>
<th>UCIe-A</th>
<th>UCIe-3D</th>
<th>Comments for UCIe-3D</th>
</tr>
<tr>
<td>Latency $\left( T x + R x \right)$</td>
<td colspan="2">&lt; 2 ns $\left( P H Y + A d a p t e r \right)$ ≤ 0.75 ns (PHY 16 GT/s)</td>
<td>0.125 ns at 4 GT/s</td>
<td>· 0.5 UI, half of flop to flop</td>
</tr>
<tr>
<td>Reliability $\left( \mathrm { F I T } ^ { \mathrm { a } } \right)$</td>
<td colspan="3">$0 < F I T < < 1$</td>
<td>· $B E R < 1 E - 2 7$</td>
</tr>
<tr>
<td>ESD</td>
<td>$3 0 - V \quad C D M$</td>
<td></td>
<td>$5 - V C D M - > \leq 3 V$</td>
<td>· 5-V CDM at introduction . No ESD for wafer-to-wafer hybrid bonding possible</td>
</tr>
</table>

a. $F I T = F a i l u r e$ in Time.

## 6.3 UCIe-3D Tx, Rx, and Clocking

Figure 6-3 presents the Transceiver (Trx) architecture of UCIe-3D. A matched architecture as shown
in Figure 5-4, Figure 5-9, and Figure 5-15 offers optimal supply noise rejection. However, this comes
at the cost of increased power consumption. The architecture depicted in Figure 6-3 circumvents this
power penalty while maintaining the same level of supply noise rejection. The UCIe-3D specification
will establish target values and tolerances for clock distribution delays $D _ { 1 }$ and $D _ { 2 } .$

<figure>
<figcaption>Figure 6-3. UCIe-3D PHY</figcaption>

80x

Data Tx

Data $R x$

Channel

ClkTree

$D _ { 1 }$

$D _ { 2 }$

ClkTree

CLK

Clock Tx

Clock Rx

</figure>

It is important to highlight that UCIe-3D uses a rise-to-fall timing approach, differing from the typical
on-die logic design that uses a rise-to-rise timing approach. The primary distinction between these
two scenarios is that on-die logic must factor in the delay caused by combinational logic, whereas
UCIe-3D features matched data and clock buffer delays, resulting in a near-zero differential. As
depicted in Figure 6-4, rise-to-fall timing yields the most-optimal timing margin for zero-delay
differential.

<figure>
<figcaption>Figure 6-4. Start Edge and Sample Edge</figcaption>

1 UI

Rx Data Eye

$T x \quad C L K \left( r i s e \right) s t a r t$

$T x \quad C L K \left( f a l l \right)$

0.5 UI

Clockdelay

Data $\mathrm { d e l a y }$

Optimal sampling when
Data delay = Clock delay

0.5 UI

Rx CLK (rise)

Rx CLK (fall)
sample

</figure>

## 6.4 Electrical Specification

### 6.4.1 Timing Budget

Consideration of various factors such as jitter, noise, mismatch, and error terms are crucial for the link
timing budget. Table 6-2 outlines the UCIe-3D specification parameters that are pertinent to link
timing. Pulse width deviation from 50% clock period includes both static error (duty-cycle error) and
dynamic error (pulse-width jitter). Lane-to-lane skews account for the variation between data lanes,
and Data/Clock differential delays account for the clock to center of distribution of data lanes.

<table>
<caption>Table 6-2. Timing and Mismatch Specification (Sheet 1 of 2)</caption>
<tr>
<th>Specification</th>
<th>Name</th>
<th>Min</th>
<th>Typ</th>
<th>Max</th>
<th>Unit</th>
<th>$U I = 2 5 0 \quad p s$ at $4 \quad G T / s$</th>
<th>Note</th>
</tr>
<tr>
<td>Eye Closure due to Channel</td>
<td>$\mathrm { C } _ { \mathrm { h } }$</td>
<td></td>
<td>0.1</td>
<td></td>
<td>UI</td>
<td>$2 5 \quad p s$</td>
<td>a</td>
</tr>
<tr>
<td>Pulse-width Deviation from 50% Clock Period</td>
<td>$\mathrm { J } _ { \mathrm { p w } }$</td>
<td></td>
<td>0.08</td>
<td></td>
<td>UI pk-to-pk</td>
<td>20 ps</td>
<td></td>
</tr>
<tr>
<td>Tx Lane-to-Lane Skew</td>
<td>$\mathrm { S } _ { \mathrm { t x } }$</td>
<td></td>
<td>0.12</td>
<td></td>
<td>UI pk-to-pk</td>
<td>30 ps</td>
<td></td>
</tr>
<tr>
<td>Rx Lane-to-Lane Skew</td>
<td>$\mathrm { S } _ { \mathrm { r x } }$</td>
<td></td>
<td>0.12</td>
<td></td>
<td>UI pk-to-pk</td>
<td>30 $p s$</td>
<td></td>
</tr>
<tr>
<td>Tx Data/Clock Differential Delay</td>
<td>$D _ { t }$</td>
<td>$D _ { t x }$</td>
<td>$D _ { t x }$</td>
<td>Dtx_max</td>
<td>ps</td>
<td>$m a x \quad - \quad m i n = 5 0 \quad p s$</td>
<td rowspan="2">b</td>
</tr>
<tr>
<td>Rx Data/Clock Differential $\mathrm { D e l a y }$</td>
<td>$D _ { r x }$</td>
<td>$D _ { r x m i n }$</td>
<td>$D _ { r x _ { - } t y p }$</td>
<td>$D _ { r x m a x }$</td>
<td>ps</td>
<td>$m a x \quad - \quad m i n = 5 0 \quad p s$</td>
</tr>
<tr>
<td>$A l p h a \quad F a c t o r \left( T x \quad a n d \quad R x \right)$</td>
<td>$\alpha _ { t r x }$</td>
<td></td>
<td></td>
<td>1.5</td>
<td></td>
<td></td>
<td>c</td>
</tr>
<tr>
<td>Vcc Noise</td>
<td>$\mathrm { n } _ { \mathrm { v c c } }$</td>
<td></td>
<td></td>
<td>10</td>
<td>% pk-to-pk</td>
<td></td>
<td>d</td>
</tr>
</table>

<table>
<caption>Table 6-2. Timing and Mismatch Specification (Sheet 2 of 2)</caption>
<tr>
<th>Specification</th>
<th>Name</th>
<th>Min</th>
<th>Typ</th>
<th>Max</th>
<th>Unit</th>
<th>$U I = 2 5 0 \quad p s$ at 4 GT/s</th>
<th>Note</th>
</tr>
<tr>
<td>Tx Data/Clock Differential RJ</td>
<td>$J _ { r t x }$</td>
<td></td>
<td></td>
<td>0.05</td>
<td>UI pk-to-pk at BER</td>
<td>12.5 ps</td>
<td></td>
</tr>
<tr>
<td>Rx Data/Clock Differential RJ</td>
<td>$J _ { r r x }$</td>
<td></td>
<td></td>
<td>0.05</td>
<td>UI pk-to-pk at BER</td>
<td>12.5 ps</td>
<td></td>
</tr>
<tr>
<td>Sampling Aperture</td>
<td>$\mathrm { A } _ { \mathrm { p } }$</td>
<td></td>
<td></td>
<td>0.03</td>
<td>UI</td>
<td>7.5 ps</td>
<td></td>
</tr>
</table>

a. Eye closure due to channel includes inter-symbol interference (ISI) and crosstalk.

b. Defined as clock to mean data, min/typ/max values are shown below.

c. Alpha factor is defined as follows for Tx and Rx, respectively:

$$\alpha _ { T x } = \frac { d D _ { t x } } { D _ { t x } } / \frac { d V _ { C C } } { V _ { C C } } \quad \alpha _ { R x } = \frac { d D _ { r x } } { D _ { T X } } / \frac { d V _ { C C } } { V _ { C C } }$$

d. This is equivalent to a variation of ±5% in Vcc. Careful mitigation is particularly needed when disturbances external to UCIe
occur, such as electromagnetic coupling from through-silicon vias (TSVs).

Parameters $D _ { \mathrm { t x } }$ and $D _ { \mathrm { r x } }$ are Vcc-dependent functions. Equation 6-1 defines their typical values.

#### Equation 6-1.

$$D _ { t x \_ t y p } = D _ { r x \_ t y p } = \frac { V _ { c c } } { 0 . 0 1 5 3 V _ { c c } { } ^ { 2 } + 0 . 0 1 8 8 V _ { c c } - 0 . 0 0 8 4 }$$

where, unit of $D _ { t x _ { - } t y p }$ and $D _ { r x }$ $t y p$ is ps and unit of $V _ { C C }$ is $\mathrm { V } .$
☒

Equation 6-2 and Equation 6-3 define the minimum spec curve of $D _ { t x }$ and $D _ { r x } ,$ respectively.

##### Equation 6-2.

$$D _ { t x } { } _ { m i n } = m a x \left( D _ { t x } { } _ { t y p } - 0 . 0 8 U I _ { r } 0 \right)$$

###### Equation 6-3.

$$D _ { r x m i n } = m a x \left( D _ { r x } t y p - 0 . 0 8 U I , 0 \right)$$

Equation 6-4 and Equation 6-5 define the maximum spec curve of $D _ { t x }$ and $D _ { r x } ,$ respectively.

###### Equation 6-4.

$$D _ { t x m a x } = D _ { t x t y p } + 0 . 1 2 U I$$

Equation 6-5.

$$D _ { r x } { } _ { - } m a x = D _ { r x } { } _ { - } t y p + 0 . 1 2$$ ☒

Figure 6-5 illustrates a plot of the spec range for 4 GT/s.

<figure>
<figcaption>Figure 6-5. Dtx and Drx Spec Range for 4 GT/s</figcaption>

120

Spec Typ

100

Spec Max

$\mathrm { S p e c } M i r$

$\frac { x } { a } 4 0$ and Drx (ps)

80

60

20

0

0.5

0.55

0.6

0.65

0.7

0.75

0.8

0.85

Vcc (V)

</figure>

The equation for delay time, derived from the general theory of buffer chain, incorporates a term
proportional to Vcc and a quadratic Vcc dependence in the denominator. This equation is fitted to a
specific process and design. A typical design is expected to have the same trend, and remain within
the boundaries of the upper and lower curves. It is not required to align with the central curve.

Equation 6-6 is essential in closing the timing budget, subsequently leading to the defined
specification limit.

Equation 6-6.

$$C _ { h } + J _ { p w } + S _ { t x } + S _ { r x } + \sqrt { J _ { r t x } ^ { 2 } + J _ { r r x } ^ { 2 } } + A _ { p }$$
$$+ \left[ m a x \left( D _ { b x } \right) - m i n \left( D _ { b x } \right) + m a x \left( D _ { r x } \right) - m i n \left( D _ { r x } \right) \right] \left( 1 + \alpha _ { t r x } n _ { v c c } \right) < 1 U I$$

When there is a change in $\mathrm { V c c } ,$ as in the case of a dynamic voltage frequency scaling (DVFS) scenario,
the specification range for $D _ { \mathrm { t x } }$ and $D _ { r x }$ adjusts correspondingly. This offers a degree of design
flexibility because the delay does not need to conform to a fixed band across the entire Vcc range.
Given that the range from maximum to minimum remains constant, the timing margin remains
unaffected.

### 6.4.2 ESD and Energy Efficiency

Data and clock signals shall comply with a mask on an eye diagram that specifies the following:

· Minimum voltage swing

· Minimum duration during which the output voltage will be stable

· Maximum permitted overshoot and undershoot

The Tx output swing range is between 0.40 V and 0.75 V.

Table 6-3 defines the ESD targets.

<table>
<caption>Table 6-3. ESD Specification for ≤ 10 um Bump Pitch</caption>
<tr>
<th>Parameter</th>
<th>Minimum</th>
</tr>
<tr>
<td>Discharge voltage (CDM)</td>
<td>5 V</td>
</tr>
<tr>
<td>Discharge peak current</td>
<td>40 mA</td>
</tr>
</table>

The feasibility of 0-V ESD should be explored for the special case of wafer-to-wafer hybrid bonding.
For more details, see the Industry Council on ESD Targets white papers.

For > 10 um to < 25 um bump pitches, higher ESD can be permitted. The exact target will be
published in a future revision of the specification.

Table 6-4 lists the Energy Efficiency targets.

<table>
<caption>Table 6-4. Energy Efficiency Target</caption>
<tr>
<th>Bump Spacing (um)</th>
<th>Energy Efficiency at 4 GT/s (pJ/bit)</th>
</tr>
<tr>
<td>9</td>
<td>0.05</td>
</tr>
<tr>
<td>3</td>
<td>0.02</td>
</tr>
<tr>
<td>1</td>
<td>0.01</td>
</tr>
<tr>
<td>9 to 25</td>
<td>To be published in a future revision of the specification.</td>
</tr>
</table>

### 6.4.3 UCIe-3D Module and Bump Map

Figure 6-6 depicts a potential bump map for UCIe-3D. The arrangement of the signals is such that the
same PHY can be utilized on both the top die and bottom die. The unit used in Figure 6-6 is the bump
pitch. The estimated area for a x80 module (encompassing both Tx and Rx) in a 9-um pitch is
approximately 0.02 mm2. It is important to note that the area scales with the square of the bump
pitch.

<table>
<caption>Figure 6-6. UCIe-3D Module Bump Map</caption>
<tr>
<th></th>
<th>21</th>
<th>R00</th>
<th>R01</th>
<th>R02</th>
<th>R03</th>
<th>R04</th>
<th>VSS</th>
<th>R05</th>
<th>R06</th>
<th>R07</th>
<th>R08</th>
<th>R09</th>
</tr>
<tr>
<td rowspan="21"></td>
<td>20</td>
<td>R10</td>
<td>R11</td>
<td>R12</td>
<td>R13</td>
<td>R14</td>
<td>VSS</td>
<td>R15</td>
<td>R16</td>
<td>R17</td>
<td>R18</td>
<td>R19</td>
</tr>
<tr>
<td>19</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
</tr>
<tr>
<td>18</td>
<td>R20</td>
<td>R21</td>
<td>R22</td>
<td>R23</td>
<td>R24</td>
<td>VSS</td>
<td>R25</td>
<td>R26</td>
<td>$R 2 7$</td>
<td>R28</td>
<td>R29</td>
</tr>
<tr>
<td>17</td>
<td>R30</td>
<td>R31</td>
<td>R32</td>
<td>R33</td>
<td>R34</td>
<td>VSS</td>
<td>R35</td>
<td>R36</td>
<td>R37</td>
<td>R38</td>
<td>R39</td>
</tr>
<tr>
<td>16</td>
<td>R40</td>
<td>R41</td>
<td>R42</td>
<td>R43</td>
<td>R44</td>
<td>RXCK</td>
<td>R45</td>
<td>R46</td>
<td>R47</td>
<td>R48</td>
<td>R49</td>
</tr>
<tr>
<td>15</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
</tr>
<tr>
<td>14</td>
<td>R50</td>
<td>R51</td>
<td>R52</td>
<td>R53</td>
<td>R54</td>
<td>VSS</td>
<td>R55</td>
<td>R56</td>
<td>R57</td>
<td>R58</td>
<td>R59</td>
</tr>
<tr>
<td>13</td>
<td>R60</td>
<td>R61</td>
<td>R62</td>
<td>R63</td>
<td>R64</td>
<td>VSS</td>
<td>R65</td>
<td>R66</td>
<td>R67</td>
<td>R68</td>
<td>R69</td>
</tr>
<tr>
<td>12</td>
<td>R70</td>
<td>R71</td>
<td>R72</td>
<td>R73</td>
<td>R74</td>
<td>VSS</td>
<td>R75</td>
<td>R76</td>
<td>R77</td>
<td>R78</td>
<td>R79</td>
</tr>
<tr>
<td>11</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
</tr>
<tr>
<td>10</td>
<td>T70</td>
<td>T71</td>
<td>T72</td>
<td>T73</td>
<td>T74</td>
<td>VSS</td>
<td>T75</td>
<td>T76</td>
<td>T77</td>
<td>T78</td>
<td>T79</td>
</tr>
<tr>
<td>9</td>
<td>T60</td>
<td>T61</td>
<td>T62</td>
<td>T63</td>
<td>T64</td>
<td>VSS</td>
<td>T65</td>
<td>T66</td>
<td>T67</td>
<td>T68</td>
<td>T69</td>
</tr>
<tr>
<td>8</td>
<td>T50</td>
<td>T51</td>
<td>T52</td>
<td>T53</td>
<td>T54</td>
<td>VSS</td>
<td>T55</td>
<td>T56</td>
<td>T57</td>
<td>T58</td>
<td>T59</td>
</tr>
<tr>
<td>7</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
</tr>
<tr>
<td>6</td>
<td>T40</td>
<td>T41</td>
<td>T42</td>
<td>T43</td>
<td>T44</td>
<td>TXCK</td>
<td>T45</td>
<td>T46</td>
<td>T47</td>
<td>T48</td>
<td>T49</td>
</tr>
<tr>
<td>5</td>
<td>T30</td>
<td>T31</td>
<td>T32</td>
<td>T33</td>
<td>T34</td>
<td>VSS</td>
<td>T35</td>
<td>T36</td>
<td>T37</td>
<td>T38</td>
<td>T39</td>
</tr>
<tr>
<td>4</td>
<td>T20</td>
<td>T21</td>
<td>T22</td>
<td>T23</td>
<td>T24</td>
<td>VSS</td>
<td>T25</td>
<td>T26</td>
<td>T27</td>
<td>T28</td>
<td>T29</td>
</tr>
<tr>
<td>3</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
</tr>
<tr>
<td>2</td>
<td>T10</td>
<td>T11</td>
<td>T12</td>
<td>T13</td>
<td>T14</td>
<td>VSS</td>
<td>T15</td>
<td>T16</td>
<td>T17</td>
<td>T18</td>
<td>T19</td>
</tr>
<tr>
<td>1</td>
<td>T00</td>
<td>T01</td>
<td>T02</td>
<td>T03</td>
<td>T04</td>
<td>VSS</td>
<td>T05</td>
<td>T06</td>
<td>T07</td>
<td>T08</td>
<td>T09</td>
</tr>
<tr>
<td></td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
</tr>
</table>

<figure>

\-

VDS

VOD

\-

0

W

ER

\-

\-

W

M

\-

WA

4

\-

\-

\-

\-

\-

\-

\-

\-

4

v

\-

1

W

W

\-
m

\-

2

\-

\-

\-

6

4

.

5

1

m

m

\-

\-

W

A

\-

\-

\-

3

155

151

1

V

15

N

W

134

1

路

221

12%

129

100

VDO

VOO

WOO

154

VSS

115

15%

124

129

104

DO'S

106

</figure>

The UCIe-3D standard does not prescribe a mandatory bump pitch; however, a 9-um pitch is
recommended at introduction. As the technology advances, additional specific recommended pitch
values will be established.

Although UCIe-3D does not inherently predefine an adapter, users have the flexibility to allocate some
data lanes within the module for adapter functions as required, such as Valid, Data Mask, Parity, and
ECC. UCIe-3D does not necessitate a sideband for initialization. If a low-bandwidth data link similar to
sideband is required, it is up to the implementation to determine how to assign a group of lanes for
the purpose. Bit replication or other forms of redundancy can be used to guarantee link reliability.

If modules are physically adjacent, extra VDDs can be added between them to provide physical
separation, shielding, and additional power delivery.

Along with x80, the bump map of x70 Module is depicted in Figure 6-7. Bump maps of additional
Module widths may be incorporated in a future update to this specification if needed, using similar
layout.

<table>
<caption>Figure 6-7. x70 Module</caption>
<tr>
<th rowspan="20"></th>
<th>19</th>
<th>R00</th>
<th>R01</th>
<th>R02</th>
<th>R03</th>
<th>R04</th>
<th>VSS</th>
<th>R05</th>
<th>R06</th>
<th>R07</th>
<th>R08</th>
<th>R09</th>
<th rowspan="20"></th>
</tr>
<tr>
<td rowspan="2">18 17</td>
<td>R10</td>
<td>R11</td>
<td>R12</td>
<td>R13</td>
<td>R14</td>
<td>VSS</td>
<td>R15</td>
<td>R16</td>
<td>R17</td>
<td>R18</td>
<td>R19</td>
</tr>
<tr>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
</tr>
<tr>
<td>16</td>
<td>R20</td>
<td>R21</td>
<td>R22</td>
<td>R23</td>
<td>R24</td>
<td>VSS</td>
<td>R25</td>
<td>R26</td>
<td>R27</td>
<td>R28</td>
<td>R29</td>
</tr>
<tr>
<td>15</td>
<td>R30</td>
<td>R31</td>
<td>R32</td>
<td>R33</td>
<td>R34</td>
<td>VSS</td>
<td>R35</td>
<td>R36</td>
<td>R37</td>
<td>R38</td>
<td>R39</td>
</tr>
<tr>
<td>14</td>
<td>R40</td>
<td>R41</td>
<td>R42</td>
<td>R43</td>
<td>R44</td>
<td>RXCK</td>
<td>R45</td>
<td>R46</td>
<td>R47</td>
<td>R48</td>
<td>R49</td>
</tr>
<tr>
<td>13</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
</tr>
<tr>
<td>12</td>
<td>R50</td>
<td>R51</td>
<td>R52</td>
<td>R53</td>
<td>R54</td>
<td>VSS</td>
<td>R55</td>
<td>R56</td>
<td>R57</td>
<td>R58</td>
<td>R59</td>
</tr>
<tr>
<td>11</td>
<td>R60</td>
<td>R61</td>
<td>R62</td>
<td>R63</td>
<td>R64</td>
<td>VSS</td>
<td>R65</td>
<td>R66</td>
<td>R67</td>
<td>R68</td>
<td>R69</td>
</tr>
<tr>
<td>10</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
</tr>
<tr>
<td>9</td>
<td>T60</td>
<td>T61</td>
<td>T62</td>
<td>T63</td>
<td>T64</td>
<td>VSS</td>
<td>T65</td>
<td>T66</td>
<td>T67</td>
<td>T68</td>
<td>T69</td>
</tr>
<tr>
<td>8</td>
<td>T50</td>
<td>T51</td>
<td>T52</td>
<td>T53</td>
<td>T54</td>
<td>VSS</td>
<td>T55</td>
<td>T56</td>
<td>T57</td>
<td>T58</td>
<td>T59</td>
</tr>
<tr>
<td>7</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
<td>VSS</td>
</tr>
<tr>
<td>6</td>
<td>T40</td>
<td>T41</td>
<td>T42</td>
<td>T43</td>
<td>T44</td>
<td>TXCK</td>
<td>T45</td>
<td>T46</td>
<td>T47</td>
<td>T48</td>
<td>T49</td>
</tr>
<tr>
<td>5</td>
<td>T30</td>
<td>T31</td>
<td>T32</td>
<td>T33</td>
<td>T34</td>
<td>VSS</td>
<td>T35</td>
<td>T36</td>
<td>T37</td>
<td>T38</td>
<td>T39</td>
</tr>
<tr>
<td>4</td>
<td>T20</td>
<td>T21</td>
<td>T22</td>
<td>T23</td>
<td>T24</td>
<td>VSS</td>
<td>T25</td>
<td>T26</td>
<td>T27</td>
<td>T28</td>
<td>T29</td>
</tr>
<tr>
<td>3</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
<td>VDD</td>
</tr>
<tr>
<td>2</td>
<td>T10</td>
<td>T11</td>
<td>T12</td>
<td>T13</td>
<td>T14</td>
<td>VSS</td>
<td>₸15</td>
<td>T16</td>
<td>T17</td>
<td>T18</td>
<td>T19</td>
</tr>
<tr>
<td>1</td>
<td>TOO</td>
<td>T01</td>
<td>T02</td>
<td>T03</td>
<td>T04</td>
<td>VSS</td>
<td>T05</td>
<td>T06</td>
<td>T07</td>
<td>T08</td>
<td>T09</td>
</tr>
<tr>
<td></td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
</tr>
</table>

### 6.4.4 Repair Strategy

Defect size (more exactly, Si area impacted by a single defect) is defined by a probability distribution.
The size is influenced by factors such as numbers of I/Os in SoC, packaging technology used, and
bump pitch. A standard needs to cover technologies from multiple companies, scalable to future bump
pitches, as well as different SoC sizes. Lane repair based on fixed defect size is not practical for an
effective standard.

Given these considerations, a bundle repair strategy is proposed for UCIe-3D. This involves reserving
bundles within the SoC for repair purposes, which can be rerouted to serve as backup in the event of
a failure, as illustrated in Figure 6-8. The figure shows the cases of no repair, 1-bundle repair, and 4-
bundle repairs. For a densely packed 2D UCIe Module array, it is recommended to reserve two full
Modules (equivalent to four bundles) to repair a single failure. This assumes an alternating
arrangement of Tx and Rx bundles in at least one direction. Each Module is equipped with one Tx
bundle (comprising a x80 Tx + Clock) and one Rx bundle (comprising a x80 Rx + Clock).

Figure 6-8.
Bundle Repair

<table>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</table>

<figure>

Unrepaired Row

0

1

2

3

Unused spare bundles

Repaired Row
2

0

3

1
Unused

Bundle
with defect

Re-route to spare

Repaired Rows
2
3

0

1

Bundles with defect

Re-route to spare

</figure>

To scale the general case of a large number of UCIe links, the following mathematical model can be
used to compute the repair requirements:

Parameters:

. Do represents the defect density of the interconnect, expressed in terms of the number of failures
per unit area

· A signifies the total UCIe-3D area of the chip

· 8 denotes the acceptable yield loss

The model suggests reserving 2k full Modules, where $\mathrm { k }$ is determined by the subsequent equation.

Equation 6-7.

$$1 - \sum _ { i = 0 } ^ { k } P _ { i } \left( A D _ { 0 } \right) < 8$$

#### Equation 6-8.

$$P _ { i } \left( x \right) = \frac { x ^ { i } } { i ! } e ^ { - x }$$ ☒ ☒

The calculations in Equation 6-7 and Equation 6-8 assume that large interconnect defects that are
comparable to bundle size are relatively rare. More spare bundles may be needed if density of large
defects exceeds a limit such that Equation 6-9 does not hold.

#### Equation 6-9.

$$1 - e ^ { - A D _ { 1 } } < 8$$

where, $\mathrm { D } _ { 1 }$ is the density of defects with diameter greater than the bundle dimension. The exact
amount can be determined by simulation.

When UCIe-3D links are not densely packed, strategic placement of spacing between bundles can
effectively reduce the number of repair bundles required. For example, with sufficient spacing
between rows, the occurrence of a single defect eliminating four bundles can be prevented. However,
the precise determination of this spacing is highly dependent on the specific technology in use, and
thus, falls beyond the scope of this specification. The specification merely highlights this as a potential
option.

The initiation of repair is anticipated to originate from the SoC Logic, which is external to the UCIe-3D
PHY, and therefore is not elaborated on in this context. The implementation can be specific to the
system.

## 6.4.5 Channel and Data Rate Extension

While the immediate focus of UCIe-3D is on Face-to-Face hybrid bonding, the proposed architecture is
designed to be adaptable for Face-to-Back, Back-to-Back, and multi-stack configurations.
Comprehensive channel and circuit simulations are necessary to determine the optimal data rate for
these scenarios. Reduction of 10% or less in data rate is expected for Face-to-Back and Back-to-Back
configurations.

§ §

# 7.0 Sideband

## 7.1 Protocol Specification

The usage for the sideband Link is to provide a out of band channel for Link training and an interface
for sideband access of registers of the Link partner. It is also used for Link Management Packets and
parameter exchanges with remote Link partner.

The same protocol is also used for local die sideband accesses over FDI and RDI. When relevant, FDI
specific rules are pointed out using "FDI sideband:". When relevant, RDI specific rules are pointed out
using "RDI sideband:". When relevant, UCIe Link specific rules are pointed out using "UCIe Link
sideband:". If no prefix is mentioned, it is a common rule across FDI, RDI and UCIe Link.

The Physical Layer is responsible for framing and transporting sideband packets over the UCIe Link.
Direct sideband access to remote die can originate from the Adapter or the Physical Layer. The
Adapter forwards a remote die sideband access over RDI to the Physical Layer for framing and
transport. These include register access requests, completions or messages.

The Protocol Layer has indirect access to remote die registers using the sideband mailbox mechanism.
The mailbox registers reside in the Adapter, and it is the responsibility of the Adapter to initiate
remote die register access requests when it receives the corresponding access trigger for the mailbox
register over FDI.

FDI sideband: In the case of multi-protocol stacks, the Adapter must track which protocol stack sent
the original request and route the completion back to the appropriate protocol stack.

FDI sideband: Because the Protocol Layer is only permitted indirect access to remote die registers,
and direct access to local die registers, currently only Register Access requests and completions are
permitted on the FDI sideband.

All sideband requests that expect a response have an 8ms timeout. A "Stall" encoding is provided for
the relevant packets for Retimers, to prevent timeouts if the Retimer needs extra time to respond to
the request. When stalling to prevent timeouts, it is the responsibility of the Retimer to send the
corresponding Stall response once every 4ms. The Retimer must also ensure that it does not Stall
indefinitely, and escalates a Link down event after a reasonable attempt to complete resolution that
required stalling the requester. If a requester receives a response with a "Stall" encoding, it resets the
timeout counter.

In certain cases, it is necessary for registers to be fragmented between the different layers; i.e.,
certain bits of a given register physically reside in the Protocol Layer, other bits reside in the Adapter,
and other bits reside in the Physical Layer. UCIe takes a hierarchical decoding for these registers. For
fragmented registers, if a bit does not physically reside in a given Layer, it implements that bit as
Read Only and tied to 0. Hence reads would return 0 for those bits from that Layer, and writes would
have no effect on those bits. As an example, for reads, Protocol Layer would forward these requests
to the Adapter on FDI and the Protocol Layer will OR the data responded by the Adapter with its local
register before responding to software. The Adapter must do the same if any bits of that register
reside in the Physical Layer before responding to the Protocol Layer.

### 7.1.1 Sideband Packet Types

Five different categories of sideband packets are permitted:

· Register Accesses: These can be Configuration (CFG) or Memory Mapped accesses for both Reads
or Writes are supported. These can be associated with 32b of data or 64b of data. All register
accesses (Reads or Writes) have an associated completion.

· Messages without data: These can be Link Management (LM), or Vendor Defined Packets. These
do not carry additional data payloads.

· Messages with data: These can be Parameter Exchange (PE), Link Training related or Vendor
Defined, and carry 64b of data.

· Management Transport Messages: If Management Transport protocol is supported, Management
Transport Messages with data or without data are supported (see Section 7.1.2.4 and
Section 7.1.2.5, respectively).

· Priority Sideband Traffic Packets (PSTP): These are sideband packets that carry priority messages
to the remote Link partner (see Section 4.1.5.2 for the rules related to transmitting these
sideband packets, and Figure 7-14 for the format of a PSTP).

Every sideband packet type carries a 5-bit opcode. Every sideband packet type, with the exception of
a PSTP, also carries a 3-bit source identifier (srcid), and a 3-bit destination identifier (dstid). The 5-bit
opcode indicates the sideband packet type, as well as whether the sideband packet carries no data,
32b of data or 64b of data.

Table 7-1 gives the mapping of opcode encodings to the Sideband Packet Types.

<table>
<caption>Table 7-1. Sideband Packet Opcode Encodings Mapped to Sideband Packet Types</caption>
<tr>
<th>Opcode Encoding</th>
<th>Sideband Packet Type</th>
<th>Opcode Encoding</th>
<th>Sideband Packet Type</th>
</tr>
<tr>
<td>00000b</td>
<td>32b Memory Read</td>
<td>01101b</td>
<td>64b Configuration Write</td>
</tr>
<tr>
<td>00001b</td>
<td>32b Memory Write</td>
<td>10000b</td>
<td>Completion without Data</td>
</tr>
<tr>
<td>00010b</td>
<td>32b DMS Register Read</td>
<td>10001b</td>
<td>Completion with 32b Data</td>
</tr>
<tr>
<td>00011b</td>
<td>32b DMS Register Write</td>
<td>10010b</td>
<td>Message without Data</td>
</tr>
<tr>
<td>00100b</td>
<td>32b Configuration Read</td>
<td>10111b</td>
<td>Management Port Messages without Data</td>
</tr>
<tr>
<td>00101b</td>
<td>32b Configuration Write</td>
<td>11000b</td>
<td>Management Port Message with Data</td>
</tr>
<tr>
<td>01000b</td>
<td>64b Memory Read</td>
<td>11001b</td>
<td>Completion with 64b Data</td>
</tr>
<tr>
<td>01001b</td>
<td>64b Memory Write</td>
<td>11011b</td>
<td>Message with 64b Data</td>
</tr>
<tr>
<td>01010b</td>
<td>64b DMS Register Read</td>
<td>11110b</td>
<td>Priority Packet (see Section 4.1.5.2 for details)ª</td>
</tr>
<tr>
<td>01011b</td>
<td>64b DMS Register Write</td>
<td>11111b</td>
<td>Priority Packet (see Section 4.1.5.2 for details)ª</td>
</tr>
<tr>
<td>01100b</td>
<td>64b Configuration Read</td>
<td>Other encodings</td>
<td>Reserved</td>
</tr>
</table>

a. The Priority Packet headers are of a different size compared to other sideband packets, which causes the parity bit location to
be different for them. With a BER of 1E-27 on the sideband Link, it is required to prevent single bit errors on the Link from causing
aliasing between priority packets and other sideband packets. This relies on the opcode field plus bit [5] and bit [6] requiring
more than one bit flip to change between priority packet format and non-priority packet format types. Future packet changes/
additions must take this into account and prevent aliasing for any new packet additions/changes.

$T a b l e \quad 7 - 2 , T a b l e \quad 7 - 3 ,$ and Table 7-4 give the encodings of source and destination identifiers. It is not
permitted for Protocol Layer from one side of the Link to directly access Protocol Layer of the remote
Link partner over sideband (this should be done via mainband).

<table>
<caption>Table 7-2. FDI sideband: srcid and dstid encodings on FDI</caption>
<tr>
<th>Fieldª</th>
<th>Description</th>
</tr>
<tr>
<td>$\mathrm { s r c i d } \left[ 2 : 0 \right]$</td>
<td>000b: Stack 0 Protocol Layer 100b: Stack 1 Protocol Layer other encodings are reserved.</td>
</tr>
<tr>
<td>dstid[2:0]</td>
<td>001b: D2D Adapter 010b: Physical Layer other encodings are reserved.</td>
</tr>
</table>

a. srcid and dstid are Reserved for completion messages transferred over FDI. The Protocol Layer must correlate
the completions to original requests using the Tag field. Currently, no requests are permitted from Adapter to
Protocol Layer over FDI sideband.

<table>
<caption>Table 7-3. RDI sideband: srcid and dstid encodings on RDI</caption>
<tr>
<th>Fieldª</th>
<th>Description</th>
</tr>
<tr>
<td>$s r c i d \left[ 2 : 0 \right]$</td>
<td>000b: Stack 0 Protocol Layer 001b: D2D Adapter 011b: Management Port Gateway (see Section 8.2) 100b: Stack 1 Protocol Layer other encodings are reserved.</td>
</tr>
<tr>
<td rowspan="2">$d s t i d \left[ 2 \right]$</td>
<td>$O b : L o c a l \quad d i e \quad t e r m i n a t e d \quad r e q u e s t$</td>
</tr>
<tr>
<td>1b: Remote die terminated</td>
</tr>
<tr>
<td rowspan="4">$\mathrm { d s t i d } \left[ 1 : 0 \right]$</td>
<td>For Local die terminated requests: 10b: Physical Layer other encodings are reserved.</td>
</tr>
<tr>
<td>For Remote die terminated Register Access Requests: dstid[1:0] is Reserved</td>
</tr>
<tr>
<td>For Remote die terminated Register Access Completions: 01b: D2D Adapter other encodings are reserved.</td>
</tr>
<tr>
<td>For Remote die terminated messages: message $1 0 b : P h y s i c a l \quad L a y e r \quad m e s s a g e$ 11b: message (see Section 8.2)</td>
</tr>
</table>

a. srcid and dstid are Reserved for completion messages transferred over RDI for local Register Access
completions. For Register Access completions, the Adapter must correlate the completions to original requests
using the Tag field regardless of dstid field. Both local and remote Register Access requests are mastered by
the Adapter with unique Tag encodings.

<table>
<caption>Table 7-4. UCIe Link sideband: srcid and dstid encodings for UCIe Link</caption>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
<tr>
<td>$\mathrm { s r c i d } \left[ 2 : 0 \right]$</td>
<td>001b: D2D Adapter 010b: Physical Layer 011b: Management Port Gateway (see Section 8.2)</td>
</tr>
<tr>
<td rowspan="2">$\mathrm { d s t i d } \left[ 2 \right]$</td>
<td>$1 b : R e m o t e \quad d i e \quad t e r m i n a t e d \quad r e q u e s t$</td>
</tr>
<tr>
<td>other encodings are reserved</td>
</tr>
<tr>
<td rowspan="3">$\mathrm { d s t i d } \left[ 1 : 0 \right]$</td>
<td>For Register Access requests: dstid[1:0] is Reserved.</td>
</tr>
<tr>
<td>$F o r \quad R e m o t e \quad d i e \quad t e r m i n a t e d \quad R e g i s t e r \quad A c c e s s \quad C o m p l e t i o n s :$ 01b: D2D Adapter other encodings are reserved.</td>
</tr>
<tr>
<td>For Remote die terminated messages: 01b: D2D Adapter message $1 0 b : P h y s i c a l \quad L a y e r \quad m e s s a g e$ message (see Section 8.2)</td>
</tr>
</table>

### 7.1.2 Sideband Packet Formats

All the figures in this section show examples assuming a 32-bit interface of RDI/FDI transfer for
sideband packets, hence the headers and data are shown in Phases of 32 bits.

Note that the sideband packet format figures provided in this chapter show the packet format over
multiple 32-bit Phases. This is for representation purposes only. For transport over the UCIe sideband
bumps (serial interface), the transfer occurs as a 64-bit serial packet at a time. For headers, the
transmission order is bit 0 of Phase 0 as bit 0 of the serial packet (D0 in Figure 4-7), bit 1 of Phase 0
as bit 1 of the serial packet, etc., followed by bit 0 of Phase 1 as bit 32 of the serial packet, bit 1 of
Phase 1 as bit 33 of the serial packet, etc., until bit 31 of Phase 1 as bit 63 of the serial packet.

Data (if present) is sent as a subsequent serial packet, with bit 0 of Phase 2 as bit 0 of the serial
packet (D0 in Figure 4-7), bit 1 of Phase 2 as bit 1 of the serial packet, etc., followed by bit 0 of Phase
3 as bit 32 of the serial packet, bit 1 of Phase 3 as bit 33 of the serial packet, etc., until bit 31 of Phase
3 as bit 63 of the serial packet.

### 7.1.2.1 Register Access Packets

Figure 7-1 shows the packet format for Register Access requests. Table 7-5 gives the description of
the fields other than the opcode, srcid, and dstid.

<table>
<caption>Table 7-5. Field descriptions for Register Access Requests</caption>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
<tr>
<td>CP</td>
<td>Control Parity (CP) is the even parity of all the header bits excluding DP.</td>
</tr>
<tr>
<td>DP</td>
<td>Data Parity is the even parity of all bits in the data payload. If there is no data payload, this bit is set to 0b.</td>
</tr>
<tr>
<td>Cr</td>
<td>If 1b, indicates one credit return for credited sideband messages. This field is only used by the Adapter for remote Link partner's credit returns for E2E credits. It is not used for local FDI or RDI credit loops.</td>
</tr>
<tr>
<td>$A d d r \left[ 2 3 : 0 \right]$</td>
<td>{ \text { Address of the request } }<br>{ \text { Table } 7 - 6 \text { for details. } } \end{array} .$ Different opcodes use this field differently. See The following rules apply for the address field: For 64-bit request, Addr[2:0] is reserved.</td> </tr> <tr> <td>$B E \left[ 7 : 0 \right]$</td> <td>$B y t e \quad E n a b l e s \quad f o r \quad t h e \quad R e q u e s t . I t \quad i s \quad N O T \quad r e q u i r e d \quad t o \quad b e \quad c o n t i g u o u s .$</td> </tr> <tr> <td>$E P$</td> <td>Data Poison. If poison forwarding is enabled, the completer can poison the data on internal errors. Setting the EP bit is optional, the conditions for setting it to 1 are implementation-specific. Typical usages involve giving additional FIT protection against data integrity errors on internal data buffers. A Receiver must not modify the contents of the target location for requests with data payload that have the EP bit set. It must return UR for the completion status of requests with an EP bit set.</td> </tr> <tr> <td>$\mathrm { T a a r } \left[ 4 : 0 \right]$</td> <td>$\log$ generated by the requester, and it must be unique for all outstanding requests that require a completion. The original requester uses the Tag to associate returning completions with the original request.</td> </tr> <tr> <td>Data</td> <td>Payload. Can be 32 bits or 64 bits wide depending on the Opcode.</td> </tr> </table> <table> <caption>Table 7-6. Mapping of Addr[23:0] for Different Requests</caption> <tr> <th>Opcode</th> <th>Description</th> </tr> <tr> <td>Memory Reads/Writes</td> <td>$R L \left[ 3 : 0 \right] ,$ Offset[19:0]} Offset is the Byte Offset. RL[3:0] encodings are as follows: 0h: Register Locator 0 1 $2 h : R e g i s t e r \quad L o c a t o r \quad 2$ 3h: Register Locator 3 Fh: Accesses for Protocol specific MMIO registers that are shadowed in the Adapter (e.g., ARB/MUX registers defined in the CXL Specification). The offsets for these registers are implementation specific, and the protocol layer must translate accesses to match the offsets implemented in the Adapter. Other encodings are reserved. For accesses to Reserved RL encodings, the completer must respond with a UR.</td> </tr> <tr> <td>Configuration Reads/Writes</td> <td>{RL[3:0], Rsvd[7:0], Byte Offset[11:0]}, where RL[3:0] encodings are as follows: 0h: UCIe Link DVSEC Fh: Accesses for Protocol specific configuration registers that are shadowed in the Adapter (e.g., ARB/MUX registers defined in the CXL Specification). The offsets for these registers are implementation specific, and the protocol layer must translate accesses to match the offsets implemented in the Adapter. Other encodings are reserved. For accesses to Reserved RL encodings, the completer must respond with a UR.</td> </tr> <tr> <td>DMS Register Reads/Writes</td> <td>These allow for accessing the DMS registers implemented in UCIe Spoke Type 0, 1, or 2. Addr[21:0] provides the register offset in DMS register space, relative to the start of the Spoke's register space, that corresponds to the DevID. A maximum of 4 MB of address space is possible for UCIe D2D/PHY Spokes. These opcodes are always targeted at the local D2D or PHY registers (i.e., these opcodes never target the remote link partner). Addr[23:22] encodings are as follows: 00b: Spoke registers. 01b: Reserved. 10b: Reserved. 11b: Used for other chiplet UMAP registers that are shadowed in the D2D or PHY, if any. The definitions of these registers and offsets are implementation- specific.</td> </tr> </table> <table> <caption>Figure 7-1. Format for Register Access Request</caption> <tr> <td colspan="20">Register Access Request</td> </tr> <tr> <td>Bytes</td> <td colspan="5">3</td> <td colspan="2"></td> <td colspan="2">2</td> <td colspan="2"></td> <td colspan="3">1</td> <td colspan="5">0</td> </tr> <tr> <td>Bits</td> <td>31</td> <td colspan="2">30 29</td> <td>28 27</td> <td>26 25 24</td> <td>23 22</td> <td>21 20</td> <td>19</td> <td>18</td> <td>17</td> <td>16</td> <td>15 14</td> <td>13 12 11 10</td> <td>9 8</td> <td>7 6</td> <td colspan="2">5 4 3 2</td> <td>10</td> <td></td> </tr> <tr> <td>Header / Data</td> <td colspan="19">Header</td> </tr> <tr> <td>Phase0</td> <td colspan="3">srcid</td> <td>rsvd</td> <td colspan="2">tag[4:0]</td> <td colspan="6">be[7:0]</td> <td colspan="2">rsvd</td> <td></td> <td colspan="4">ep opcode [4:0]</td> </tr> <tr> <td>Phase1</td> <td>dp</td> <td>cp</td> <td>|cr</td> <td>rsvd</td> <td>dstid</td> <td colspan="2"></td> <td colspan="4"></td> <td></td> <td colspan="2">addr[23:0]</td> <td></td> <td></td> <td></td> <td colspan="2"></td> </tr> <tr> <td>Header / Data</td> <td colspan="19">Data (if applicable, can be 32 bits or 64 bits)</td> </tr> <tr> <td>Phase2</td> <td colspan="19">data[31:0]</td> </tr> <tr> <td>Phase3</td> <td></td> <td colspan="8"></td> <td colspan="3">data[63:32]</td> <td colspan="7"></td> </tr> </table> <figure> </figure> <table> <caption>Figure 7-2 gives the format for Register Access completions. Figure 7-2. Format for Register Access Completions</caption> <tr> <th colspan="22">Register Access Completions</th> </tr> <tr> <th>Bytes</th> <th colspan="5">3</th> <th colspan="2">2</th> <th colspan="2"></th> <th colspan="2"></th> <th colspan="4">1</th> <th colspan="6">0</th> </tr> <tr> <td>Bits</td> <td>31</td> <td>30</td> <td>29</td> <td>28 27</td> <td>26 25 24</td> <td colspan="2">23 22 21 20 19</td> <td>18 17</td> <td>16</td> <td>15</td> <td>14</td> <td>13</td> <td>12 11</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>109876543210</td> <td></td> </tr> <tr> <td>Header / Data</td> <td colspan="5"></td> <td colspan="2"></td> <td colspan="4">Header</td> <td colspan="4"></td> <td colspan="6"></td> </tr> <tr> <td>Phase0</td> <td colspan="3">srcid</td> <td>rsvd</td> <td colspan="2">tag[4:0]</td> <td colspan="3">be[7:0]</td> <td colspan="2"></td> <td colspan="3">rsvd</td> <td></td> <td></td> <td></td> <td>ep</td> <td colspan="3">opcode [4:0]</td> </tr> <tr> <td>Phase1</td> <td>dp</td> <td>cp</td> <td>cr</td> <td>rsvd</td> <td>dstid</td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2">rsvd</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2">Status</td> </tr> <tr> <td>Header / Data</td> <td colspan="3"></td> <td></td> <td colspan="11">Data (if completion with data, can be 32 bits or 64 bits)</td> <td colspan="6"></td> </tr> <tr> <td>Phase2</td> <td colspan="7"></td> <td colspan="8">data[31:0]</td> <td></td> <td></td> <td colspan="4"></td> </tr> <tr> <td>Phase3</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td colspan="3">data [63:32]</td> <td colspan="3"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> </tr> </table> <table> <caption>Table 7-7 gives the field descriptions for a completion. Table 7-7. Field Descriptions for a Completion</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>$\mathrm { T a g } \left[ 4 : 0 \right]$</td> <td>Completion Tag associated with the corresponding Request. The requester uses this to associate the completion with the original request.</td> </tr> <tr> <td>CP</td> <td>$\text { Control Parity. All fields other than whan when vand crothe the the Header are pretected by Control } }<br>{ \text { Parity, and the parity sarity schene is even \left(including reserved bits\right). } }</td> </tr> <tr> <td>DP</td> <td>Data Parity. All fields in data are protected by data parity, and the parity scheme is even.</td> </tr> <tr> <td>$\mathrm { C r }$</td> <td>If 1b, indicates one credit return for credited sideband messages. This field is only used by the Adapter for remote Link partner's credit returns for E2E credits. It is not used for local FDI or RDI credit loops.</td> </tr> <tr> <td rowspan="2">$E P$</td> <td>Data Poison. If poison forwarding is enabled, the completer can poison the data on internal errors.</td> </tr> <tr> <td>Setting the EP bit is optional, the conditions for setting it to 1 are implementation-specific. Typical usages involve giving additional FIT protection against data integrity errors on internal data buffers. A Receiver must not modify the contents of the target location for requests with data payload that have the EP bit set. It must return UR for the completion status of requests with an EP bit set.</td> </tr> <tr> <td>$B E \left[ 7 : 0 \right]$</td> <td>Byte Enables for the Request. Completer returns the same value that the original request had (this avoids the requester from having to save off the BE value). BE[7:4] are reserved if the opcode is for a 32-bit request.</td> </tr> <tr> <td rowspan="2">$S t a t u s \left[ 2 : 0 \right]$</td> <td>Completion Status 000b - Successful Completion (SC). This can be a completion with or without data, depending on the original request (it must set the appropriate Opcode). If the original request was a write, it is a completion without data. If the original request was a read, it is a completion with data. 001b - Unsupported Request (UR). On UCIe, this is a completion with 64b Data when a request is aborted by the completer, and the Data carries the original request header that resulted in UR. This enables easier header logging at the requester. Register Access requests that timeout must also return UR status, but for those the completion is without Data.</td> </tr> <tr> <td>100b - Completer Abort (CA). On UCIe, this is a completion with 64b Data, and the Data the requester. carries original request header that resulted in CA. This enables easier header logging at 111b - Stall. Receiving a completion with Stall encoding must reset the timeout at the original request. requester. Completer must send a Stall once every 4ms if it is not ready to respond to the Other encodings are reserved. An error is logged in the Sideband Mailbox Status if a CA was received or if the number of timeouts exceed the programmed threshold. For timeouts below the programmed threshold, a UR is returned to the requester.</td> </tr> <tr> <td>Data</td> <td>Payload. 32 bits or 64 bits depending on the Opcode.</td> </tr> </table> ### 7.1.2.2 Messages without Data Figure 7-3 shows the Format for Messages without data payloads. These can be Link Management Packets, NOPs or Vendor Defined message packets. <table> <caption>Figure 7-3. Format for Messages without Data</caption> <tr> <th colspan="23">Messages without Data</th> </tr> <tr> <th>Bytes</th> <th colspan="3">3</th> <th colspan="3"></th> <th>2</th> <th></th> <th colspan="2"></th> <th></th> <th colspan="5">1</th> <th colspan="4">0</th> <th></th> <th></th> </tr> <tr> <td>Bits</td> <td>31 30 29 28 27</td> <td>26</td> <td>25 24</td> <td>23</td> <td>22</td> <td>21 20</td> <td>19</td> <td>18</td> <td>17</td> <td>16</td> <td>15</td> <td>14</td> <td>13 12</td> <td>11</td> <td></td> <td></td> <td></td> <td></td> <td>109876543210</td> <td></td> <td></td> <td></td> </tr> </table> Header / Data Header <table> <tr> <th>Phase0</th> <th></th> <th>srcid</th> <th>rsvd</th> <th>rsvd</th> <th>msgcode [7:0]</th> <th>rsvd</th> <th>opcode [4:0]</th> </tr> <tr> <td>Phase1</td> <td>dp</td> <td>|cp</td> <td>rsvd</td> <td>dstid</td> <td>MsgInfo[15:0]</td> <td></td> <td>MsgSubcode[7:0]</td> </tr> </table> The definitions of opcode, srcid, dstid, dp, and cp fields are the same as Register Access packets. Table 7-8 and Table 7-9 give the encodings of the different messages without data that are send on UCIe. Some Notes on the different message categories are listed below: · {NOP.Crd} - These are used for E2E Credit returns. The destination must be D2D Adapter. · {LinkMgmt.RDI .* } - These are used to coordinate RDI state transitions, the source and destination is Physical Layer. . {LinkMgmt.Adapter0 .* } - These are used to coordinate Adapter LSM state transitions for the Adapter LSM corresponding to Stack 0 Protocol Layer. The source and destination is D2D Adapter. . {LinkMgmt.Adapter1 .* } - These are used to coordinate Adapter LSM state transitions for the Adapter LSM corresponding to Stack 1 Protocol Layer. The source and destination is D2D Adapter. · {ParityFeature .* } - This is used to coordinate enabling of the Parity insertion feature. The source and destination for this must be the D2D Adapter. · $\left\{ \mathrm { E r r M s g } \right\} - \mathrm { T h i s } \mathrm { i s }$ used for error reporting and escalation from the remote Link Partner. This is sent from the Retimer or Device die to the Host, and the destination must be the D2D Adapter. <table> <caption>Table 7-8. Message Encodings for Messages without Dataª (Sheet 1 of 3)</caption> <tr> <th>Name</th> <th>Msgcode</th> <th>Msgsubcode</th> <th>MsgInfo</th> <th>Description</th> </tr> <tr> <td>$\left\{ \mathrm { N o p } . \mathrm { C r d } \right\}$</td> <td>00h</td> <td>00h</td> <td>{ 0 0 0 0 h : R e s e r v e d }<br>{ 0 0 0 1 h : 1 \text { Credit returr } } 0002h: 2 Credit returns 0003h: 3 Credit returns 0004h: 4 Credit returns</td> <td>Explicit Credit return from Remote Link partner for credited messages.</td> </tr> <tr> <td>{LinkMgmt.RDI.Req .Active}</td> <td rowspan="7">01h</td> <td>01h</td> <td rowspan="7">Reserved</td> <td>Active Request for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.RDI.Req .L1}</td> <td>04h</td> <td>L1 Request for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.RDI.Req .L2}</td> <td>$0 8 h$</td> <td>L2 Request for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.RDI.Req .LinkReset}</td> <td>$0 9 h$</td> <td>LinkReset Request for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.RDI.Req .LinkError}</td> <td>0Ah</td> <td>LinkError Request for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.RDI.Req .Retrain}</td> <td>0Bh</td> <td>Retrain Request for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.RDI.Req .Disable}</td> <td>$0 C h$</td> <td>Disable Request for RDI SM.</td> </tr> </table> <table> <caption>Table 7-8. Message Encodings for Messages without Dataª (Sheet 2 of 3)</caption> <tr> <th>Name</th> <th>Msgcode</th> <th>Msgsubcode</th> <th>MsgInfo</th> <th>Description</th> </tr> <tr> <td>{ \left\{ \mathrm { L i n k M g m t } . R D I . R S _ { F } \right. }<br>{ . A c t i v e ^ { 2 } }</td> <td rowspan="8">02h</td> <td>01h</td> <td rowspan="8">0000h: Regular Response FFFFh: Stall Response</td> <td>Active Response for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.RDI.Rsp .PMNAK}</td> <td>02h</td> <td>PMNAK Response for RDI SM</td> </tr> <tr> <td>{LinkMgmt.RDI.Rsp .L1}</td> <td>04h</td> <td>L1 Response for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.RDI.Rsp .L2}</td> <td>$0 8 h$</td> <td>L2 Response for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.RDI.Rsp .LinkReset}</td> <td>09h</td> <td>LinkReset Response for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.RDI.Rsp .LinkError}</td> <td>$0 A h$</td> <td>LinkError Response for RDI SM.</td> </tr> <tr> <td>{ \left\{ \text { LinkMgmt.RDI.RSp } \right. }<br>{ \left. \text { Retrain } \right\} }</td> <td>$0 B h$</td> <td>Retrain Response for RDI SM.</td> </tr> <tr> <td>{ \left\{ \mathrm { L i n k M g m t } . R D I . R S F \right. }<br>{ \left. . D i s a b l e \right\} }</td> <td>$0 C h$</td> <td>Disable Response for RDI SM.</td> </tr> <tr> <td>{LinkMgmt.Adapter 0.Req.Active}</td> <td rowspan="5">03h</td> <td>$0 1 h$</td> <td>0000h: Regular Request FFFFh: Stall</td> <td>Active Request for Stack 0 Adapter LSM. The Stall encoding is provided for Retimers to avoid the Adapter LSM transition to Active timeout as described in Section 9.5.3.8.</td> </tr> <tr> <td>$L i n k M g m t . A d a p t e r$</td> <td>04h</td> <td rowspan="4">Reserved</td> <td>L1 Request for Stack 0 Adapter LSM.</td> </tr> <tr> <td>{ \text { \left\{LinkMgmt.Adapter } }<br>{ 0 . R e a . 1 2 3 }</td> <td>$0 8 h$</td> <td>L2 Request for Stack 0 Adapter LSM.</td> </tr> <tr> <td>{LinkMgmt.Adapter 0.Req.LinkReset}</td> <td>09h</td> <td>LinkReset Request for Stack 0 Adapter LSM.</td> </tr> <tr> <td>{ \text { \left\{LinkMgmt.Adapter } }<br>{ \left. 0 . R e a . D i s a b l e \right\} }</td> <td>0Ch</td> <td>Disable Request for Stack 0 Adapter LSM.</td> </tr> <tr> <td>$\left\{ \mathrm { L i n k M g m t } . \mathrm { A d a p t e r } \right.$</td> <td rowspan="6">04h</td> <td>01h</td> <td rowspan="6">0000h: Regular Response FFFFh: Stall Response</td> <td>Active Response for Stack 0 Adapter LSM.</td> </tr> <tr> <td>{LinkMgmt.Adapter 0.Rsp.PMNAK}</td> <td>02h</td> <td>PMNAK Response for Stack 0 Adapter LSM.</td> </tr> <tr> <td>$L i n k M g m t . A d a p t e r$</td> <td>04h</td> <td>L1 Response for Stack 0 Adapter LSM.</td> </tr> <tr> <td>{ \text { LinkMgmt. Adapter } }<br>{ \left. 0 . R s 0 . 1 2 \right\} }</td> <td>08h</td> <td>L2 Response for Stack 0 Adapter LSM.</td> </tr> <tr> <td>{ \text { \left\{LinkMgmt. Adapter } }<br>{ \left. 0 . R s p . L i n k R e s e t \right\} }</td> <td>$0 9 h$</td> <td>LinkReset Response for Stack 0 Adapter LSM.</td> </tr> <tr> <td>{ \left\{ \text { LinkMgmt.Adapter } \right. }<br>{ \left. \text { D.Rsp.Disable } \right\} }</td> <td>0Ch</td> <td>Disable Response for Stack 0 Adapter LSM.</td> </tr> <tr> <td>{ \left\{ \text { LinkMgmt.Adapter } \right. }<br>{ \left. \text { 1.Rea.Active } \right\} }</td> <td rowspan="5">05h</td> <td>01h</td> <td>0000h: Regular Request FFFFh: Stall</td> <td>Active Request for Stack 1 Adapter LSM. The Stall encoding is provided for Retimers to avoid the Adapter LSM transition to Active timeout as described in Section 9.5.3.8.</td> </tr> <tr> <td>$L i n k M g m t . A d a p t e r$</td> <td>$0 4 h$</td> <td rowspan="4">Reserved</td> <td>L1 Request for Stack 1 Adapter LSM.</td> </tr> <tr> <td>{ \left\{ \text { LinkMgmt.Adapter } \right. }<br>{ \left. 1 . \text { Req.L2 } \right\} }</td> <td>08h</td> <td>L2 Request for Stack 1 Adapter LSM.</td> </tr> <tr> <td>$\left\{ \mathrm { L i n k M g m t } . \mathrm { A d a p t e r } \right.$</td> <td>$0 9 h$</td> <td>LinkReset Request for Stack 1 Adapter LSM.</td> </tr> <tr> <td>{ \text { LinkMgmt.Adapter } }<br>{ \left. \text { 1.Req. Disable } \right\} }</td> <td>0Ch</td> <td>Disable Request for Stack 1 Adapter LSM.</td> </tr> </table> <table> <caption>Table 7-8. Message Encodings for Messages without Dataª (Sheet 3 of 3)</caption> <tr> <th>Name</th> <th>Msgcode</th> <th>Msgsubcode</th> <th>MsgInfo</th> <th>Description</th> </tr> <tr> <td>$\left\{ \mathrm { L i n k M g m t } . \mathrm { A d a p t e r } \right.$</td> <td rowspan="6">$0 6 h$</td> <td>01h</td> <td rowspan="6">0000h: Regular Response FFFFh: Stall Response</td> <td>Active Response for Stack 1 Adapter LSM.</td> </tr> <tr> <td>$\left\{ \mathrm { L i n k M g m t } . \mathrm { A d a p t e r } \right.$</td> <td>02h</td> <td>PMNAK Response for Stack 1 Adapter LSM</td> </tr> <tr> <td>{ \left\{ \text { LinkMgmt.Adapter } \right. }<br>{ \left. 1 . R s p . L 1 \right\} }</td> <td>04h</td> <td>L1 Response for Stack 1 Adapter LSM.</td> </tr> <tr> <td>{ \left\{ \text { LinkMgmt. Adapter } \right. }<br>{ \left. 1 . R s p . L 2 \right\} }</td> <td>$0 8 h$</td> <td>L2 Response for Stack 1 Adapter LSM.</td> </tr> <tr> <td>$L i n k M g m t . A d a p t e r$</td> <td>09h</td> <td>LinkReset Response for Stack 1 Adapter LSM.</td> </tr> <tr> <td>$\left\{ \mathrm { L i n k M g m t } . \mathrm { A d a p t e r } \right.$</td> <td>0Ch</td> <td>Disable Response for Stack 1 Adapter LSM.</td> </tr> <tr> <td>{ParityFeature.Req}</td> <td>07h</td> <td>00h</td> <td>Reserved</td> <td>Parity Feature enable request.</td> </tr> <tr> <td>$P a r i t y F e a t u r e . A c k$</td> <td rowspan="2">$0 8 h$</td> <td>00h</td> <td rowspan="2">0000h: Regular Response FFFFh: Stall Response</td> <td>Parity Feature enable Ack.</td> </tr> <tr> <td>{ParityFeature.Nak}</td> <td>01h</td> <td>Parity Feature enable Nak.</td> </tr> <tr> <td rowspan="3">$E r r M s g$</td> <td rowspan="3">09h</td> <td>00h</td> <td rowspan="3">Reserved</td> <td>Correctable Error Message.</td> </tr> <tr> <td>01h</td> <td>Non-Fatal Error Message.</td> </tr> <tr> <td>$0 2 h$</td> <td>Fatal Error Message.</td> </tr> <tr> <td>{Vendor Defined Message}</td> <td>$F F h$</td> <td>--</td> <td>Vendor ID</td> <td>Vendor Defined Messages. These can be exchanged at any time after sideband is functional post SBINIT. Interoperability is vendor defined. Unsupported vendor defined messages must be discarded by the receiver. Note that this is NOT the UCIe Vendor ID, but rather the unique identifier of the chiplet vendor that is defining and using these messages.</td> </tr> </table> a. All other encodings not mentioned in this table are reserved. <table> <caption>Table 7-9. Link Training State Machine related Message encodings for messages without data (Sheet 1 of 5)</caption> <tr> <th>Message</th> <th>MsgInfo[15:0]</th> <th>MsgCode[7:0]</th> <th>MsgSubcode[7:0]</th> </tr> <tr> <td>{Start Tx Init D to C point test resp}</td> <td>0000h</td> <td>8Ah</td> <td>01h</td> </tr> <tr> <td>{LFSR_clear_error req}</td> <td>0000h</td> <td>85h</td> <td>02h</td> </tr> <tr> <td></td> <td>0000h</td> <td>8Ah</td> <td>02h</td> </tr> <tr> <td>$\left\{ T \times \text { Init } D \text { to C results req } \right\}$</td> <td>0000h</td> <td>85h</td> <td>03h</td> </tr> <tr> <td>$\frac { \left\{ \text { End Tx Init } D \text { to C point test req } \right\} } { \left\{ \text { End } T \times \text { Init } D \text { to C point test } r e s p \right\} }$</td> <td>0000h</td> <td>85h</td> <td>04h</td> </tr> <tr> <td></td> <td>0000h</td> <td>8Ah</td> <td>04h</td> </tr> <tr> <td>{Start Tx Init D to C eye sweep resp}</td> <td>0000h</td> <td>8Ah</td> <td>05h</td> </tr> <tr> <td>{End Tx Init D to C eye sweep req}</td> <td>0000h</td> <td>85h</td> <td>06h</td> </tr> <tr> <td>$T \times \text { Init } D$ to C eye sweep resp}</td> <td>0000h</td> <td>8Ah</td> <td>06h</td> </tr> <tr> <td>{Start Rx Init D to C point test resp}</td> <td>0000h</td> <td>8Ah</td> <td>07h</td> </tr> <tr> <td>$\left\{ R \times \text { Init } D \text { to C } T x \text { Count Done } r e q \right\}$</td> <td>0000h</td> <td>85h</td> <td>08h</td> </tr> <tr> <td>$R x \quad I n i t \quad D \quad t o \quad C \quad T x \quad C o u n t \quad D o n e \quad r e s p$</td> <td>0000h</td> <td>8Ah</td> <td>08h</td> </tr> <tr> <td>$E n d \quad R x \quad I n i t \quad D \quad t o \quad C \quad p o i n t \quad t e s t \quad r e q$</td> <td>0000h</td> <td>85h</td> <td>09h</td> </tr> <tr> <td>{End Rx Init D to C point test resp}</td> <td>0000h</td> <td>8Ah</td> <td>09h</td> </tr> <tr> <td>{Start Rx Init D to C eye sweep resp}</td> <td>0000h</td> <td>8Ah</td> <td>0Ah</td> </tr> <tr> <td>{Rx Init D to C results req}</td> <td>0000h</td> <td>85h</td> <td>0Bh</td> </tr> <tr> <td>$E n d \quad R x \quad I n i t \quad D \quad t o \quad C \quad e y e \quad s w e e p \quad r e q$</td> <td>0000h</td> <td>85h</td> <td>0Dh</td> </tr> <tr> <td>{End Rx Init D to C eye sweep resp}</td> <td>0000h</td> <td>8Ah</td> <td>0Dh</td> </tr> <tr> <td>$S B I N I T \quad o u t \quad o f \quad R e s e t$</td> <td>$\left[ 3 : 0 \right] : R e s u l t$</td> <td>$9 1 h$</td> <td>00h</td> </tr> <tr> <td>$S B I N I T \quad d o n e \quad r e q$</td> <td>0000h</td> <td>95h</td> <td>01h</td> </tr> <tr> <td>{SBINIT done resp}</td> <td>0000h</td> <td>9Ah</td> <td>01h</td> </tr> <tr> <td>$\left\{ \mathrm { M B I N I T } . \mathrm { C A L D o n e } \mathrm { r e q } \right\}$</td> <td>0000h</td> <td>A5h</td> <td>02h</td> </tr> <tr> <td>{MBINIT.CAL Done resp}</td> <td>0000h</td> <td>AAh</td> <td>02h</td> </tr> <tr> <td>{MBINIT.REPAIRCLK init req}</td> <td>0000h</td> <td>A5h</td> <td>03h</td> </tr> <tr> <td>{MBINIT.REPAIRCLK init resp}</td> <td>0000h</td> <td>AAh</td> <td>03h</td> </tr> <tr> <td>{MBINIT.REPAIRCLK result req}</td> <td>0000h</td> <td>A5h</td> <td>04h</td> </tr> <tr> <td>{MBINIT.REPAIRCLK result resp}</td> <td>[15:4]: Reserved $\left[ 3 \right] : C o m p a r e \quad R e s u l t s \quad f r o m$ L _ $\left[ 2 \right] : C o m p a r e \quad R e s u l t s \quad f r o m$ L _ $\left[ 1 \right] : C o m p a r e \quad R e s u l t s \quad f r o m$ L _ $\left[ 0 \right] : C o m p a r e \quad R e s u l t s \quad f r o m$ L _</td> <td>$A A h$</td> <td>04h</td> </tr> <tr> <td>{MBINIT.REPAIRCLK apply repair req}</td> <td>[15:4]: Reserved [3:0]: Repair Encoding • · \text { Fh: Reserved }<br>\text { Oh: Repair RCKP } _ · 1h: Repair RCKN L · 2h: Repair RTRK L _ · 7h: Reserved</td> <td>A5h</td> <td>05h</td> </tr> <tr> <td>{MBINIT.REPAIRCLK apply repair resp}</td> <td>0000h</td> <td>AAh</td> <td>05h</td> </tr> </table> <table> <caption>Table 7-9. Link Training State Machine related Message encodings for messages without data (Sheet 2 of 5)</caption> <tr> <th>Message</th> <th>$M s g I n f o \left[ 1 5 : 0 \right]$</th> <th>$\mathrm { M s g C o d e \left[ 7 : 0 \right] }$</th> <th>$\mathrm { M s g S u b c o d e } \left[ 7 : 0 \right]$</th> </tr> <tr> <td>{MBINIT.REPAIRCLK check repair init req}</td> <td>0000h</td> <td>$A 5 h$</td> <td>06h</td> </tr> <tr> <td>{MBINIT.REPAIRCLK check repair init resp}</td> <td>0000h</td> <td>AAh</td> <td>06h</td> </tr> <tr> <td>{MBINIT.REPAIRCLK check results req}</td> <td>0000h</td> <td>A5h</td> <td>07h</td> </tr> <tr> <td>{MBINIT.REPAIRCLK check results resp}</td> <td>[15:4]: { \left[ 3 \right] : \text { Compare Results from } }<br>{ \text { RRDCK I } } L _ { \left[ 2 \right] : \text { Compare Results from } }<br>{ \text { RTRK } I } L _ $\left[ 1 \right] : C o m p a r e \quad R e s u l t s \quad f r o m$ RCKN_L { \text { \left[0\right]: Compare Results from } }<br>{ \text { RCKP L } } L _</td> <td>AAh</td> <td>07h</td> </tr> <tr> <td>{MBINIT.REPAIRCLK done req}</td> <td>0000h</td> <td>A5h</td> <td>$0 8 h$</td> </tr> <tr> <td>{MBINIT.REPAIRCLK done resp}</td> <td>0000h</td> <td>AAh</td> <td>$0 8 h$</td> </tr> <tr> <td>{MBINIT.REPAIRVAL init req}</td> <td>0000h</td> <td>A5h</td> <td>09h</td> </tr> <tr> <td>{MBINIT.REPAIRVAL init resp}</td> <td>0000h</td> <td>$A A h$</td> <td>09h</td> </tr> <tr> <td>{MBINIT.REPAIRVAL result req}</td> <td>0000h</td> <td>A5h</td> <td>0Ah</td> </tr> <tr> <td>{MBINIT.REPAIRVAL result resp}</td> <td>[15:2]: Reserved { \left[ 1 \right] : \text { Compare Results from } }<br>{ \text { RRDVLD } } L _ { \text { \left[0\right]: Compare Results from } }<br>{ \text { RVLD I } } L _</td> <td>AAh</td> <td>$0 A h$</td> </tr> <tr> <td>{MBINIT.REPAIRVAL apply repair req}</td> <td>$\left[ 1 5 : 2 \right] : R e s e r v e d$ [1:0]: · 3h: Reserved · Oh: Repair RVLD_L · 1h: Reserved</td> <td>A5h</td> <td>$0 B h$</td> </tr> <tr> <td>{MBINIT.REPAIRVAL apply repair resp}</td> <td>0000h</td> <td>$A A h$</td> <td>$0 B h$</td> </tr> <tr> <td>{MBINIT.REPAIRVAL done req}</td> <td>0000h</td> <td>A5h</td> <td>$0 C h$</td> </tr> <tr> <td>{MBINIT.REPAIRVAL done resp}</td> <td>0000h</td> <td>AAh</td> <td>0Ch</td> </tr> <tr> <td>{MBINIT.REVERSALMB init req}</td> <td>0000h</td> <td>A5h</td> <td>0Dh</td> </tr> <tr> <td>{MBINIT.REVERSALMB init resp}</td> <td>0000h</td> <td>AAh</td> <td>0Dh</td> </tr> <tr> <td>{MBINIT.REVERSALMB clear error req}</td> <td>0000h</td> <td>A5h</td> <td>0Eh</td> </tr> <tr> <td>{MBINIT.REVERSALMB clear error resp}</td> <td>0000h</td> <td>AAh</td> <td>0Eh</td> </tr> <tr> <td>{MBINIT.REVERSALMB result req}</td> <td>0000h</td> <td>A5h</td> <td>0Fh</td> </tr> <tr> <td>{MBINIT.REVERSALMB done req}</td> <td>0000h</td> <td>A5h</td> <td>10h</td> </tr> <tr> <td>{MBINIT.REVERSALMB done resp}</td> <td>0000h</td> <td>AAh</td> <td>10h</td> </tr> <tr> <td>{MBINIT.REPAIRMB start req}</td> <td>0000h</td> <td>A5h</td> <td>11h</td> </tr> <tr> <td>{MBINIT.REPAIRMB start resp}</td> <td>0000h</td> <td>AAh</td> <td>11h</td> </tr> <tr> <td>{MBINIT.REPAIRMB Apply repair resp}</td> <td>0000h</td> <td>AAh</td> <td>12h</td> </tr> <tr> <td>$\left\{ \mathrm { M B I N I T } . \mathrm { R E P A I R M B } \mathrm { e n d } \mathrm { r e q } \right\}$</td> <td>0000h</td> <td>A5h</td> <td>13h</td> </tr> <tr> <td>{MBINIT.REPAIRMB end resp}</td> <td>0000h</td> <td>AAh</td> <td>13h</td> </tr> <tr> <td>{MBINIT.REPAIRMB apply degrade req}</td> <td>$\left[ 1 5 : 3 \right] : R e s e r v e d$ $\left[ 2 : 0 \right] :$ Standard package logical</td> <td>A5h</td> <td>14h</td> </tr> <tr> <td>{MBINIT.REPAIRMB apply degrade resp}</td> <td>0000h</td> <td>AAh</td> <td>14h</td> </tr> </table> <table> <caption>Table 7-9. Link Training State Machine related Message encodings for messages without data (Sheet 3 of 5)</caption> <tr> <th>$\mathrm { M e s s a g } 6$</th> <th>$M s g I n f o \left[ 1 5 : 0 \right]$</th> <th>$M s g C o d e \left[ 7 : 0 \right]$</th> <th>MsgSubcode[7:0]</th> </tr> <tr> <td>{MBTRAIN.VALVREF start req}</td> <td>$0 0 0 0 h$</td> <td>$B 5 h$</td> <td>00h</td> </tr> <tr> <td>{MBTRAIN.VALVREF start resp}</td> <td>0000h</td> <td>BAh</td> <td>00h</td> </tr> <tr> <td>$\left\{ \mathrm { M B T R A I N } . \mathrm { V A L V R E E F } \text { end req } \right\}$</td> <td>0000h</td> <td>B5h</td> <td>01h</td> </tr> <tr> <td>$\left\{ \mathrm { M B T R A I N } . \mathrm { V A L V R E F } \text { end resp } \right\}$</td> <td>0000h</td> <td>BAh</td> <td>01h</td> </tr> <tr> <td>$\left\{ \mathrm { M B T R A I N } . \mathrm { D A T A V R E F } \text { start req } \right\}$</td> <td>0000h</td> <td>B5h</td> <td>02h</td> </tr> <tr> <td>{MBTRAIN.DATAVREF start resp}</td> <td>0000h</td> <td>BAh</td> <td>02h</td> </tr> <tr> <td>{MBTRAIN.DATAVREF end req}</td> <td>0000h</td> <td>B5h</td> <td>03h</td> </tr> <tr> <td>$\left\{ \mathrm { M B T R A I N } . \mathrm { D A T A V R F F } \text { end resp } \right\}$</td> <td>0000h</td> <td>BAh</td> <td>03h</td> </tr> <tr> <td>$\left\{ \mathrm { M B T R A I N } . \mathrm { S P E E D I D L E } \mathrm { d o n e } \mathrm { r e q } \right\}$</td> <td>0000h</td> <td>B5h</td> <td>04h</td> </tr> <tr> <td>{MBTRAIN.SPEEDIDLE done resp}</td> <td>0000h</td> <td>BAh</td> <td>04h</td> </tr> <tr> <td>{MBTRAIN.TXSELFCAL Done req}</td> <td>0000h</td> <td>B5h</td> <td>05h</td> </tr> <tr> <td>{MBTRAIN.TXSELFCAL Done resp}</td> <td>0000h</td> <td>BAh</td> <td>05h</td> </tr> <tr> <td>{MBTRAIN.RXCLKCAL start req}</td> <td>0000h</td> <td>B5h</td> <td>06h</td> </tr> <tr> <td>$\left\{ \mathrm { M B T R A I N } . \mathrm { R X C L K C A L } \mathrm { s t a r t } \mathrm { r e s p } \right\}$</td> <td>0000h</td> <td>BAh</td> <td>06h</td> </tr> <tr> <td>{MBTRAIN.RXCLKCAL $\left. \mathrm { d o n e } \mathrm { r e q } \right\}$</td> <td>0000h</td> <td>B5h</td> <td>07h</td> </tr> <tr> <td>{MBTRAIN.RXCLKCAL done resp}</td> <td>0000h</td> <td>BAh</td> <td>07h</td> </tr> <tr> <td>{MBTRAIN.VALTRAINCENTER start req}</td> <td>0000h</td> <td>B5h</td> <td>08h</td> </tr> <tr> <td>{MBTRAIN.VALTRAINCENTER start resp}</td> <td>0000h</td> <td>BAh</td> <td>08h</td> </tr> <tr> <td>{MBTRAIN.VALTRAINCENTER done req}</td> <td>0000h</td> <td>B5h</td> <td>09h</td> </tr> <tr> <td>{MBTRAIN.VALTRAINCENTER $\left. \mathrm { d o n e } \mathrm { r e s p } \right\}$</td> <td>0000h</td> <td>BAh</td> <td>09h</td> </tr> <tr> <td>{MBTRAIN.VALTRAINVREF start req}</td> <td>0000h</td> <td>B5h</td> <td>0Ah</td> </tr> <tr> <td>{MBTRAIN.VALTRAINVREF start resp}</td> <td>0000h</td> <td>BAh</td> <td>0Ah</td> </tr> <tr> <td>{MBTRAIN.VALTRAINVREF $d o n e \quad r e q$</td> <td>0000h</td> <td>B5h</td> <td>0Bh</td> </tr> <tr> <td>{MBTRAIN.VALTRAINVREF $d o n e \quad r e s p$</td> <td>0000h</td> <td>BAh</td> <td>0Bh</td> </tr> <tr> <td>{MBTRAIN.DATATRAINCENTER1 start req}</td> <td>0000h</td> <td>B5h</td> <td>0Ch</td> </tr> <tr> <td>{MBTRAIN.DATATRAINCENTER1 start resp}</td> <td>0000h</td> <td>BAh</td> <td>0Ch</td> </tr> <tr> <td>{MBTRAIN.DATATRAINCENTER1 end req}</td> <td>0000h</td> <td>B5h</td> <td>0Dh</td> </tr> <tr> <td>{MBTRAIN.DATATRAINCENTER1 end resp}</td> <td>0000h</td> <td>BAh</td> <td>0Dh</td> </tr> <tr> <td>{MBTRAIN.DATATRAINVREF start req}</td> <td>0000h</td> <td>B5h</td> <td>0Eh</td> </tr> <tr> <td>{MBTRAIN.DATATRAINVREF start resp}</td> <td>0000h</td> <td>BAh</td> <td>0Eh</td> </tr> <tr> <td>{MBTRAIN.DATATRAINVREF end req}</td> <td>0000h</td> <td>B5h</td> <td>10h</td> </tr> <tr> <td>{MBTRAIN.DATATRAINVREF end resp}</td> <td>0000h</td> <td>BAh</td> <td>10h</td> </tr> <tr> <td>{MBTRAIN.RXDESKEW start req}</td> <td>0000h</td> <td>B5h</td> <td>11h</td> </tr> <tr> <td>{MBTRAIN.RXDESKEW start resp}</td> <td>0000h</td> <td>BAh</td> <td>11h</td> </tr> <tr> <td>{MBTRAIN.RXDESKEW end req}</td> <td>0000h</td> <td>B5h</td> <td>12h</td> </tr> <tr> <td>$\left\{ \mathrm { M B T R I I N } . \mathrm { R X D E S K E W } \mathrm { e n d } \mathrm { r e s p } \right\}$</td> <td>0000h</td> <td>BAh</td> <td>12h</td> </tr> <tr> <td>{MBTRAIN.DATATRAINCENTER2 start req}</td> <td>0000h</td> <td>B5h</td> <td>13h</td> </tr> <tr> <td>{MBTRAIN.DATATRAINCENTER2 start resp}</td> <td>0000h</td> <td>BAh</td> <td>13h</td> </tr> <tr> <td>{MBTRAIN.DATATRAINCENTER2 end req}</td> <td>0000h</td> <td>B5h</td> <td>14h</td> </tr> <tr> <td>{MBTRAIN.DATATRAINCENTER2 end resp}</td> <td>0000h</td> <td>BAh</td> <td>14h</td> </tr> </table> <table> <caption>Table 7-9. Link Training State Machine related Message encodings for messages without data (Sheet 4 of 5)</caption> <tr> <th>Message</th> <th>$M s g I n f o \left[ 1 5 : 0 \right]$</th> <th>$M s g C o d e \left[ 7 : 0 \right]$</th> <th>MsgSubcode [7:0]</th> </tr> <tr> <td>{MBTRAIN.LINKSPEED start req}</td> <td>$0 0 0 0 h$</td> <td>B5h</td> <td>15h</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED start resp}</td> <td>0000h</td> <td>BAh</td> <td>15h</td> </tr> <tr> <td>$\left\{ \mathrm { M B T R A I N } . \mathrm { L I N K S P E E D } \mathrm { e r r o r } \mathrm { r e q } \right\}$</td> <td>0000h</td> <td>B5h</td> <td>16h</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED error resp}</td> <td>0000h</td> <td>BAh</td> <td>16h</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED exit to repair req}</td> <td>0000h</td> <td>B5h</td> <td>17h</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED exit to repair resp}</td> <td>0000h</td> <td>BAh</td> <td>17h</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED exit to speed degrade req}</td> <td>0000h</td> <td>B5h</td> <td>18h</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED exit to speed degrade resp}</td> <td>0000h</td> <td>BAh</td> <td>18h</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED done req}</td> <td>0000h: For regular response</td> <td>B5h</td> <td>19h</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED done resp}</td> <td>0000h: For regular response FFFFh: For stall</td> <td>BAh</td> <td>19h</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED multi-module disable module resp}</td> <td>0000h</td> <td>BAh</td> <td>1Ah</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED exit to phy retrain req}</td> <td>0000h</td> <td>B5h</td> <td>1Fh</td> </tr> <tr> <td>{MBTRAIN.LINKSPEED exit to phy retrain resp}</td> <td>0000h</td> <td>BAh</td> <td>$1 F h$</td> </tr> <tr> <td>{MBTRAIN.REPAIR init req}</td> <td>0000h</td> <td>B5h</td> <td>1Bh</td> </tr> <tr> <td>{MBTRAIN.REPAIR init resp}</td> <td>0000h</td> <td>BAh</td> <td>1Bh</td> </tr> <tr> <td>{MBTRAIN.REPAIR Apply repair resp}</td> <td>0000h</td> <td>BAh</td> <td>1Ch</td> </tr> <tr> <td>{MBTRAIN.REPAIR end req}</td> <td>0000h</td> <td>B5h</td> <td>1Dh</td> </tr> <tr> <td>{MBTRAIN.REPAIR end resp}</td> <td>0000h</td> <td>BAh</td> <td>1Dh</td> </tr> <tr> <td>$\left\{ \mathrm { M B T R A I N } . \mathrm { R E P A I R } \mathrm { A p p l y } \mathrm { d e g r a d e } \mathrm { r e q } \right\}$</td> <td>[15:3]: Reserved [2:0]: Standard Package logical Lane mapb</td> <td>B5h</td> <td>1Eh</td> </tr> <tr> <td>{MBTRAIN.REPAIR Apply degrade resp}</td> <td>0000h</td> <td>BAh</td> <td>$1 E h$</td> </tr> <tr> <td>{MBTRAIN.RXDESKEW EQ Preset req}</td> <td>$\left[ 1 5 : 4 \right] : R e s e r v e d$</td> <td>B5h</td> <td>1Fh</td> </tr> <tr> <td>{MBTRAIN.RXDESKEW EQ Preset resp}</td> <td>[15:1]: Reserved [0]: Status · 0: Success · 1: Fail</td> <td>BAh</td> <td>1Fh</td> </tr> <tr> <td>{MBTRAIN.RXDESKEW exit to DATATRAINCENTER1 req}</td> <td>0000h</td> <td>B5h</td> <td>$2 0 h$</td> </tr> <tr> <td>{MBTRAIN.RXDESKEW exit to DATATRAINCENTER1 $\left. \mathrm { r e s p } \right\}$</td> <td>0000h</td> <td>BAh</td> <td>20h</td> </tr> </table> <table> <caption>Table 7-9. Link Training State Machine related Message encodings for messages without data (Sheet 5 of 5)</caption> <tr> <th>Message</th> <th>MsgInfo[15:0]</th> <th>$M s g C o d e \left[ 7 : 0 \right]$</th> <th>MsgSubcode [7:0]</th> </tr> <tr> <td>{MBTRAIN.RXCLKCAL TCKN_L shift req}</td> <td>[15:6]: Reserved $\left[ 5 : 1 \right] : S h i f t \quad V a l u e . I n d i c a t e s \quad t h e$ of 1/64 UI [0]: Decrement · 0: Increment · 1: Decrement</td> <td>B5h</td> <td>21h</td> </tr> <tr> <td>{MBTRAIN.RXCLKCAL TCKN_L shift resp}</td> <td>[15:1]: Reserved [0]: Status · 0: Shift was successfully applied · 1: Shift was not applied (most likely scenario is that it is Out of Range)</td> <td>$B A h$</td> <td>$2 1 h$</td> </tr> <tr> <td>{PHYRETRAIN.retrain start req}</td> <td>{ \left[ 1 5 : 3 \right] : \text { Reserved } }<br>{ \left[ 2 : 0 \right] : \text { Retrain Encoding } }</td> <td>C5h</td> <td>01h</td> </tr> <tr> <td>{PHYRETRAIN.retrain start resp}</td> <td>$\left[ 1 5 : 3 \right] : R e s e r v e d$ [2:0]:</td> <td>CAh</td> <td>01h</td> </tr> <tr> <td>{TRAINERROR Entry req}</td> <td>0000h</td> <td>$E 5 h$</td> <td>00h</td> </tr> <tr> <td>{TRAINERROR Entry resp}</td> <td>0000h</td> <td>EAh</td> <td>00h</td> </tr> <tr> <td>{RECAL.track pattern init req}</td> <td>0000h</td> <td>D5h</td> <td>00h</td> </tr> <tr> <td>{RECAL.track pattern init resp}</td> <td>0000h</td> <td>DAh</td> <td>00h</td> </tr> <tr> <td>{RECAL.track pattern done req}</td> <td>0000h</td> <td>D5h</td> <td>01h</td> </tr> <tr> <td>{RECAL.track pattern done resp}</td> <td>0000h</td> <td>DAh</td> <td>01h</td> </tr> <tr> <td>{RECAL.track tx adjust req}</td> <td>[15:9]: Reserved [8]: · 0: Increment clock delay or decrement data delay · 1: Decrement clock delay or increment data delay [7:0]: Delay compensation value, in units of 1/64 UI</td> <td>$B 5 h$</td> <td>$2 2 h$</td> </tr> <tr> <td>{RECAL.track tx adjust resp}</td> <td>[15:2]: Reserved [1:0]: Status · 00b: Reserved · 01b: Drift compensated · 10b: Drift not compensated . 11b: Stall</td> <td>BAh</td> <td>22h</td> </tr> </table> a. See Section 4.5.3.2. b. See Table 4-9. ### 7.1.2.3 Messages with data payloads Figure 7-4 shows the formats for Messages with data payloads. The definitions of opcode, srcid, dstid, dp, and cp fields are the same as Register Access packets. <table> <caption>Figure 7-4. Format for Messages with data payloads</caption> <tr> <th colspan="18">Messages with data</th> </tr> <tr> <th>Bytes</th> <th colspan="4">3</th> <th colspan="5">2</th> <th colspan="3">1</th> <th colspan="5">0</th> </tr> <tr> <td>Bits</td> <td colspan="3">31 30 29 28 27</td> <td>26 25 24</td> <td>23</td> <td colspan="2">22 21 20</td> <td>19 18</td> <td>17 16</td> <td>15 14</td> <td>13 12 11 10</td> <td>9 8</td> <td>7</td> <td>6 5</td> <td>4 3</td> <td></td> <td>210</td> </tr> <tr> <td>Header / Data</td> <td colspan="4"></td> <td colspan="13">Header</td> </tr> <tr> <td>Phase0</td> <td colspan="2">srcid</td> <td>rsvd</td> <td colspan="3">rsvd</td> <td colspan="4">msgcode [7:0]</td> <td colspan="2">rsvd</td> <td colspan="2"></td> <td colspan="3">opcode [4:0]</td> </tr> <tr> <td>Phase1</td> <td>dp cp</td> <td></td> <td>rsvd</td> <td>dstid</td> <td colspan="2"></td> <td></td> <td colspan="3">MsgInfo[15:0]</td> <td colspan="2"></td> <td colspan="5">MsgSubcode [7:0]</td> </tr> <tr> <td>Header / Data</td> <td colspan="4"></td> <td colspan="8">Data</td> <td colspan="5"></td> </tr> <tr> <td>Phase2</td> <td colspan="17">data[31:0]</td> </tr> <tr> <td>Phase3</td> <td></td> <td colspan="2"></td> <td></td> <td colspan="2"></td> <td colspan="2"></td> <td colspan="2">data[63:32]</td> <td colspan="2"></td> <td colspan="5"></td> </tr> </table> <table> <caption>Table 7-10 and Table 7-11 give the message encodings. Table 7-10. Message encodings for Messages with Dataª (Sheet 1 of 3)</caption> <tr> <th>Name</th> <th>Msg code</th> <th>Msgsubcode</th> <th>MsgInfo</th> <th>Data Bit Encodings</th> <th>Description</th> </tr> <tr> <td>{AdvCap.Adapter}</td> <td>01h</td> <td>00h</td> <td>$0 0 0 0 h : R e g u l a r$ Message FFFFh: Stall Message</td> <td>$\left[ 0 \right] : \text { {waw Format } }$ $\left[ 2 \right] : ^ { \prime \prime } C X L 2 5 6 B$ [3]: "PCIe Flit Mode"</td> <td>Advertised Capabilities of the D2D Adapter</td> </tr> <tr> <td rowspan="2">{FinCap.Adapter}</td> <td rowspan="2">$0 2 h$</td> <td rowspan="2">00h</td> <td></td> <td rowspan="2">[4]: "Streaming" [5]: "Retry" [6]: "Multi_Protocol_Enable" [7]: "Stack0_Enable" $\left[ 8 \right] : \text { Stack1 } \text { Enable } ^ { \prime \prime }$ $\left[ 1 0 \right] : C X L \_ L a t O p t \_ F m t 6$ [11]: "Retimer" [20:12]: "Retimer Credits" [21]: "DP" $\left[ 2 3 \right] : 6 8 B \quad F l i t \quad F o r m a t$ $\left[ 2 4 \right] : S t a n d a r d \quad 2 5 6 B \quad E n d \quad H e a d e r \quad F l i t$ $\left[ 2 5 \right] : \text { {Standard } 2 5 6 B \text { Start Header Flit } }$ { \left[ 2 6 \right] : \text { uatency-Optimized } 2 5 6 B \text { without } }<br>{ \text { Optional Bytes Flit Format^{\prime\prime } } } { \left[ 2 7 \right] : \text { uatency-Optimized } 2 5 6 B \text { with } }<br>{ \text { Optional Bytes Flit Format^{\prime\prime } } } { \text { L28\right]: Enhanced_Multi_ Protocol_Enable^{\prime\prime } } }<br>{ \left[ 2 9 \right] : \text { Stack } 0 M a x i m u m }<br>{ \text { Banduridth limitr } } [30]: "Stack 1 Maximum Bandwidth_Limit" $\left[ 3 1 \right] : \text { whanagement Transport Protocol } ^ { \prime \prime }$</td> <td rowspan="2">{ \text { Finalized } }<br>{ \text { Capability of the } }</td> </tr> <tr> <td>0000h: Regular Message FFFFh: Stall Message</td> </tr> </table> <table> <caption>Table 7-10. Message encodings for Messages with Dataª (Sheet 2 of 3)</caption> <tr> <th>Name</th> <th>Msg code</th> <th>Msgsubcode</th> <th>MsgInfo</th> <th>Data Bit Encodings</th> <th>Description</th> </tr> <tr> <td>$\left\{ \mathrm { A d v C a p } . \mathrm { C X L } \right\}$</td> <td>01h</td> <td>01h</td> <td>$0 0 0 0 h : P o s t$ { \text { negotiation, if } }<br>{ \text { Fnhanced Mult } } $i s \quad O b , o r \quad i t \quad i s \quad 1 b$ and the message is for Stack 0. $0 0 0 1 h : P o s t$ negotiation, if Enhanced_Multi \text { Protocol } \text { Enabl }<br>\text { is 1b and the } { \text { message is fo } }<br>{ \text { Stack } 1 } { \text { FFFh: Stall } }<br>{ \text { Messaae } }</td> <td>[23:0]: Flexbus Mode negotiation usage bits as defined for Symbols 12-14 of Modified TS1/TS2 Ordered Set in CXL Specification, with the following additional rules: · { \text { \left[0\right]: PCIe capable/enable- this mus } }<br>{ \text { be 1b for PCIe Non-Flit Mode. } } • \text { \left[1\right]: CXL.i0 capable/enable-this }<br>\text { must be 0b for PCIe Non-Flit Mode. .$ · $\left[ 2 \right] : \text { CXL.mem capable/enable- this } }<br>{ \text { must be 0b for PCIe Non-Flit Mode. } } · { \left[ 3 \right] : \text { CXL.cache capable/enable- this } }<br>{ \text { must be 0b for PCIe Non-Flit Mode. } } · $\left[ 4 \right] : C X L \quad 6 8 B \quad F l i t \quad a n d \quad V H \quad c a p a b l e ;$</td> <td>Advertised Capabilities for CXL protocol.</td> </tr> <tr> <td>$F i n C a p . C X L$</td> <td>02h</td> <td>01h</td> <td>$0 0 0 0 h : P o s t$ negotiation, if Enhanced_Multi Protocol_Enable is 0b, or it is 1b and the message is for Stack 0. { 0 0 0 1 h : \text { Post } }<br>{ \text { negotiation, if } } Enhanced_Multi { \text { Protocol Enabl } }<br>{ \text { is 1b and the } } { \text { message is fo } }<br>{ \text { Stack } 1 } $F F F F h : S t a l l$</td> <td>{ \text { CXL protocols, as specified in the } }<br>{ \text { Protocol Layer interoperability } } requirements. · $\left[ 8 \right] : M u l t i - L o g i c a l \quad D e v i c e \quad - \quad m u s t \quad b e$ · [9]: Reserved. · { \left[ 1 2 : 1 0 \right] : \text { these bits do not apply for } }<br>{ \text { UCIe, must be nh } } · { \left[ 1 4 \right] : \text { Retimer } 2 - \text { does not apply fo } }<br>{ \text { UCIe. must be 0b } } · { \left[ 1 5 \right] : \text { CXL.io Throttle } - \text { must be 0b } }<br>{ \text { for PCIe Non-Fitt Mode. } } · { \left[ 1 7 : 1 6 \right] : \text { NOP Hint Info- does not } }<br>{ \text { apply for UCIe, and must be } 0 }</td> <td>Finalized Capabilities for CXL protocol.</td> </tr> <tr> <td>{MultiProtAdvCap. Adapter}</td> <td>01h</td> <td>$0 2 h$</td> <td>0000h: Reserved $F F F F h : S t a l l$</td> <td>[0]: "68B Flit Mode" [1]: "CXL 256B Flit Mode" [2]: "PCIe Flit Mode" { \text { \left[3\right]: ^{\text{w Streaming Protocol } ^ { \prime \prime } } } }<br>{ \left[ 4 \right] : \text { managent Transport Protocol } ^ { \prime } } [63:5]: Reserved</td> <td>Protocol { \text { Advertisement fol } }<br>{ \text { Stack } 1 \text { when } } Enhanced Multi_Protocol_En able is negotiated</td> </tr> <tr> <td>{MultiProtFinCap. Adapter}</td> <td>02h</td> <td>$0 2 h$</td> <td>0000h: Reserved { \text { FFFh: Stal } }<br>{ \text { Messane } }</td> <td>$\left[ 0 \right] : \text { vesB Flit Mode^{\prime\prime } }$ [1]: "CXL 256B [2]: "PCIe Flit Mode" [3]: Reserved [4]: "Management Transport Protocol" $\left[ 6 3 : 5 \right] : R e s e r v e d$</td> <td>Finalized Capability for Protocol negotiation when Enhanced Multi_Protocol_En $a n d \quad S t a c k \quad 1 \quad i s$</td> </tr> </table> <table> <caption>Table 7-10. Message encodings for Messages with Dataª (Sheet 3 of 3)</caption> <tr> <th>Name</th> <th>Msg code</th> <th>Msgsubcode</th> <th>MsgInfo</th> <th>Data Bit Encodings</th> <th>Description</th> </tr> <tr> <td>$V e n d o r \quad D e f i n e d$</td> <td>$F F h$</td> <td></td> <td>Vendor ID</td> <td></td> <td>Vendor Defined Messages. These can be { \text { exchanged at an } }<br>{ \text { time after } } sideband is functional post SBINIT. Interoperability is vendor defined. Unsupported vendor defined messages must { \text { be discarded by } }<br>{ \text { the receiver. .$ that this is NOT the UCIe Vendor ID, but rather the unique identifier of the $\text { chiplet vendor } }<br>{ \text { that is defining } } and using these messages.</td> </tr> </table> a. All other encodings not mentioned in this table are reserved. <table> <caption>Table 7-11. Link Training State Machine related encodings (Sheet 1 of 6)</caption> <tr> <th>Message</th> <th>MsgInfo[15:0]</th> <th>MsgCode [7:0]</th> <th>MsgSubcode [7:0]</th> <th>Data Field [63:0]</th> </tr> <tr> <td>{Start Tx Init D to $C$ point test req}</td> <td>[15:0]: Maximum comparison error threshold</td> <td>85h</td> <td>01h</td> <td>[63:60]: Reserved [59]: Comparison Mode (0: Per Lane; 1: { \text { Aggregate\right) } }<br>{ \left[ 5 8 : 4 3 \right] : \text { Iteration Count Settings } } [42:27]: Idle Count settings $\left[ 1 0 \right] : P a t t e r n \quad M o d e \left( 0 : c o n t i n u o u s \quad m o d e , 1 : \right.$ Burst Mode) { \left[ 9 : 6 \right] : \text { Clock Phase control at } T \times \text { Device } \left( 0 h \right. }<br>{ \text { Clock PI Center, } 1 h : L e f t E d g e , 2 h : \text { Right :$ $\left[ 5 : 3 \right] : V a l i d \quad P a t t e r n \left( O h : F u n c t i o n a l \quad p a t t e r n \right)$ [2:0]: Data pattern (0h: LFSR, 1h: Per Lane ID)</td> </tr> </table> <table> <caption>Table 7-11. Link Training State Machine related encodings (Sheet 2 of 6)</caption> <tr> <th>Message</th> <th>MsgInfo[15:0]</th> <th>$4 \mathrm { s g } \mathrm { c o d } }<br>{ \left[ 7 : 0 \right] }</th> <th>$M s g S u b c o d e$ $\left[ 7 : 0 \right]$</th> <th>Data Field [63:0]</th> </tr> <tr> <td>$\left\{ \begin{array}{} { T x \text { Init } D \text { to<br>\left. \text { racults resp } \right\ \right.$ C</td>
<td>$\left[ 1 5 : 6 \right] : R e s e r v e d$ [5]: Valid Lane comparison results of $a l l \quad L a n e s \left( 0 : F a i l \left( E r r o r s \right. \right.$ &gt; 1: Pass (Errors &lt;= Max Error Threshold)). [3:0]: UCIe-A: Compare results from Redundant Lanes (0h: Fail (Errors &gt; Max Error { \text { Threshold\right), } 1 h : \text { Pass } \left( \text { Error } \right. }<br>{ \left. < = \text { Max Error Threshold } \right) } (RRD_L [3], RRD_L[2], RRD_L [1], RRD_L [0]) UCIe-S: Reserved RRD_L [3] and RRD_L $\left[ 2 \right]$ { \text { are reserved for UCIe-A } x 3 2 }<br>{ \text { as a transmitter of this } }</td>
<td>8Ah</td>
<td>03h</td>
<td>[63:0]: Compare Results of individual Data Lanes (0h: Fail (Errors &gt; Max Error Threshold), 1h: Pass (Errors &lt;= Max Error Threshold)) UCIe-A {RD_L [63], RD_L [62], .... , RD_L [1], RD_L [0]} { \text { UCIe-S } \left\{ 4 8 h 0 , R D , L \left[ 1 5 \right] , R D , L \left[ 1 4 \right] , \ldots \right. }<br>{ \left. \left. \text { RD } I L I \right] , R D L I O T \right\} } \end{array} .$ , $\sqrt { 3 2 } ^ { \prime } h 0 ,$ $\text { UCIe- } S \times 8 \left\{ 5 6 ^ { \prime } h 0 , R D , L \left[ 7 \right] , R D _ { - } L \left[ 6 \right] , \cdots , \right. }<br>{ \left. \text { RD LI } 1 1 . R D \text { IJ } 0 1 \right\ ,$</td> </tr> <tr> <td>$T \times \text { Init } D$ eye sweep req}</td> <td>[15:0]: Maximum comparison error threshold</td> <td>85h</td> <td>$0 5 h$</td> <td>$\left[ 6 3 : 6 0 \right] :$ Reserved [59]: Comparison Mode (0: Per Lane; 1: $\left[ 5 8 : 4 3 \right] : I t e r a t i o n \quad C o u n t \quad S e t t i n g s$ [42:27]: Idle Count settings $\left[ 1 0 \right] : P a t t e r n \quad M o d e \left( 0 : c o n t i n u o u s \quad m o d e , 1 : \right.$ Burst Mode) $\left[ 9 : 6 \right] : \text { Clock Phase control at } T \times \text { Device } \left( 0 h \right. }<br>{ \text { Clock PI Center, } 1 h : \text { Left Edge, } 2 h : \text { Right :$ $\left[ 5 : 3 \right] : V a l i d \quad P a t t e r n \left( O h : F u n c t i o n a l \quad p a t t e r n \right)$ ID) [2:0]: Data pattern (0h: LFSR, 1h: Per Lane</td> </tr> <tr> <td>{Start Rx Init D to C point test req}</td> <td>[15:0]: Maximum comparison error threshold</td> <td>$8 5 h$</td> <td>07h</td> <td>[63:60]: Reserved [59]: Comparison Mode (0: Per Lane; 1: Aggregate) [58:43]: Iteration Count Settings [42:27]: Idle Count settings [26:11]: Burst Count settings [10]: Pattern Mode (0: continuous mode, 1: Burst Mode) [9:6]: Clock Phase control at Transmitter (0h: Clock PI Center, 1h: Left Edge, 2h: Right Edge) [5:3]: Valid Pattern (0h: Functional pattern) [2:0]: Data pattern (0h: LFSR, 1h: Per Lane ID)</td> </tr> </table> <table> <caption>Table 7-11. Link Training State Machine related encodings (Sheet 3 of 6)</caption> <tr> <th>Message</th> <th>MsgInfo[15:0]</th> <th>$\text { Msgcod } }<br>{ \left[ 7 : 0 \right] }</th> <th>{ \text { MsgSubcouc } }<br>{ \left[ 7 : 0 \right] } $\left[ 7 : 0 \right]$</th> <th>Data Field [63:0]</th> </tr> <tr> <td>{Start Rx Init D to C eye sweep req}</td> <td>$c o m p a r i s o n \quad e r r o r \quad t h r e s h o l d$</td> <td>$8 5 h$</td> <td>0Ah</td> <td>$\left[ 6 3 : 6 0 \right] :$ Reserved [59]: Comparison Mode (0: Per Lane; 1: Aggregate) [58:43]: Iteration Count Settings $\left[ 4 2 : 2 7 \right] : I d l e \quad C o u n t \quad s e t t i n g s$ [26:11]: Burst Count settings [10]: Pattern Mode (0: continuous mode, 1: Burst Mode) { \text { \left[9:6\right]: Clock Phase control at Transmitter } }<br>{ \text { \left(0h: Clock PI Center, 1h: Left Edge, } 2 h : :$ $\left[ 5 : 3 \right] : V a l i d \quad P a t t e r n \left( O h : F u n c t i o n a l \quad p a t t e r n \right)$ [2:0]: Data pattern (0h: LFSR, 1h: Per Lane ID)</td> </tr> <tr> <td>$\left\{ R \times \text { Init } D \text { to } C \right. }<br>{ \left. \text { results resp } \right\} }</td> <td>{ \left[ 1 5 : 6 \right] : \text { Reservea } }<br>{ \left[ 5 \right] : \text { Valid Lane comparison } } result [4]: Cumulative Results of all Lanes (0: Fail (Errors &gt; Max Error Threshold), $P a s s \left( E r r o r s < = M a x \quad E r r o r \right.$ $U C I e - A : C o m p a r e \quad r e s u l t s$ from Fail (Errors &gt; Max Error \left. \text { Threshold\right), 1h: Pass\left(Error: }<br>< = \text { Max Error Threshold } \right) (RRD_L [3], RRD_L[2], RRD_L [1], RRD_L [0]) UCIe-S: Reserved $\mathrm { R e D } _ { - } L \left[ 3 \right] \text { and } R R D _ { L } \left[ 2 \right]$ { \text { are reserved for UCIe-A } \times 3 2 }<br>{ \text { as a transmitter of this } } message.</td> <td>8Ah</td> <td>0Bh</td> <td>[63:0]: Compare Results of individual Data Lanes (Oh: Fail (Errors &gt; Max Error \left. \text { Threshold } \right)<br>\text { Threshold ,$ 1h: Pass (Errors &lt;= Max Error $\text { UCIe-A } \left\{ R D L \left[ 6 3 \right] , R D _ { - } L \left[ 6 2 \right] , \cdots , \right. }<br>{ \left. \text { RD LII } , R D L \left[ 0 \right] \right\ ,$ UCIe-S {48'h0, RD_L [15], RD_L [14], ... , $\mathrm { R D } \mathrm { L } \left[ 1 \right] ,$ RD_L $\text { UCIe-A } \times 3 2 \left\{ 3 2 ^ { \prime } h 0 , R D , L \left[ 3 1 \right] , R D _ { - } L \left[ 3 0 \right] \right. }<br>{ \left. \cdots , R D L \left[ 0 \right] \right\ ,$ $\text { UCIe-S } \times 8 \left\{ 5 6 ^ { \prime } h 0 , R D , L \left[ 7 \right] , R D _ { - } L \left[ 6 \right] , \ldots , \right. }<br>{ \left. \text { RD } _ { - } L \left[ 1 \right] , R D _ { - } L \left[ 0 \right] \right\} ^ { - ,$</td> </tr> <tr> <td>$R x \quad I n i t \quad D \quad t o \quad C$ sweep done with results}</td> <td>$0 0 0 0 h$</td> <td>81h</td> <td>$0 C h$</td> <td>$\left[ 6 3 : 1 6 \right] :$ Reserved $\left[ 1 5 : 8 \right] :$ $1 6 3 : 1 0 1 : \text { Right Edge } }<br>{ 1 1 5 : 8 1 : \text { Right Edge } } $\left[ 7 : 0 \right] : L e f t \quad E d g e$</td> </tr> <tr> <td>$\left\{ \mathrm { M B I N I T } . \mathrm { P A R A M } \right.$</td> <td>0000h</td> <td>$A 5 h$</td> <td>$0 0 h$</td> <td>[63:16]: Reserved { \left[ 1 5 \right] : \text { Tx Adjustment during Runtime } }<br>{ \text { Recalibration \left(TARR\right) is supported } \left( 1 \right) \text { or not } } supported (0) { \left[ 1 4 \right] : \text { Sideband feature extensions is } }<br>{ \text { supported } \left( 1 \right) \text { or not supported } \left( 0 \right) } { \left[ 1 3 \right] : \text { UCIe-A x32 if Advanced Package; } }<br>{ \text { UCIe-S x8 if Standard Package. } } [12:11]: Module ID: 0h: 0, 1h: 1, 2h: 2, 3h:3 $\left[ 1 0 \right] : C l o c k \quad P h a s e : 0 b :$ Differential clock, 1b: Quadrature phase 0b: Strobe mode; 1b: $C o n t i n u o u s \quad m o d e$ [8:4]: Voltage Swing - The encodings are the same as the "Supported Tx Vswing encodings" field of the PHY Capability register $\left[ 3 : 0 \right] : M a x \quad I O \quad L i n k \quad S p e e d \quad - \quad T h e \quad e n c o d i n g s$ { \text { are une same as whax Link Speeds^{\prime\prime } \text { field of } } }<br>{ \text { the UCIe Link Capability register } }</td> </tr> </table> <table> <caption>Table 7-11. Link Training State Machine related encodings (Sheet 4 of 6)</caption> <tr> <th>Message</th> <th>MsgInfo[15:0]</th> <th>MsgCode $\left[ 7 : 0 \right]$</th> <th>{ \text { MsgSubcouc } }<br>{ \left[ 7 : 0 \right] } $\left[ 7 : 0 \right]$</th> <th>Data Field [63:0]</th> </tr> <tr> <td>{MBINIT.PARAM configuration resp}</td> <td>0000h</td> <td>AAh</td> <td>00h</td> <td>{ \left[ 6 3 : 1 6 \right] : \text { Reserved } }<br>{ \left[ 1 5 \right] : \text { Tx Adjustment during Runtime } }<br>{ \left[ 1 5 \right] : \text { Tx Adjun \left(TARR\right) is negotiated } \left( 1 \right) \text { or not } } supported (0) { \left[ 1 4 \right] : \text { Sideband feature extensions is } }<br>{ \text { negotiated } \left( 1 \right) \text { or not supported } \left( 0 \right) } [13:11]: Reserved [10]: Clock Phase: 0b: Differential clock, 1b: Quadrature phase $\left[ 9 \right] : C l o c k \quad M o d e \quad - \quad O b :$ Strobe mode; 1b: [8:4]: Reserved [3:0]: Max { \text { are the same as whax Link Speeds fincodings } }<br>{ \text { the UCIe Link Capability reqister } }</td> </tr> <tr> <td>{MBINIT.PARAM $\left. \mathrm { S B F E } \mathrm { r e q } \right\}$</td> <td>0000h: Regular Message</td> <td>$A 5 h$</td> <td>01h</td> <td>{ \left[ 6 3 : 5 \right] : \text { Reserved } }<br>{ \left[ 4 \right] : L 2 S P D \text { is supported } \left( 1 \right) \text { or not supportec } } (0) [3]: PSPT is supported (1) or not supported (0) $\left[ 2 \right] : S i d e b a n d - o n l y \left( S O \right) p o r t \left( 1 \right) , f u l l \quad U C I e$ [1]: Sideband Performant Mode Operation (PMO) is supported (1) or not supported (0) { \text { \left[0\right]: Management Transport protocol is } }<br>{ \text { supported } \left( 1 \right) \text { or not supported } \left( 0 \right) }</td> </tr> <tr> <td>{MBINIT.PARAM SBFE resp}</td> <td>0000h: Regular Message FFFFh: Stall Message</td> <td>AAh</td> <td>01h</td> <td>[63:5]: Reserved [4]: L2SPD is negotiated (1) or not { \text { negotiated \left(0\right) } }<br>{ \left[ 3 \right] : \text { PSPT is negotiated } \left( 1 \right) \text { or not negotiatec } } (0) port (0) [2]: Sideband-only (SO) port (1), full UCIe { \text { \left[1\right]: Sideband Performant Mode Operation } }<br>{ \text { \left(PMO\right) is negotiated } \left( 1 \right) \text { or not supported } \left( 0 \right. } { \text { IOJ: Managernent Transport protocol is } }<br>{ \text { supported } \left( 1 \right) \text { or not supported } \left( 0 \right) }</td> </tr> <tr> <td>{MBINIT.REVERSAL MB result resp}</td> <td>{ \text { The error condition for this } }<br>{ \text { show is NoT observing } 1 6 } consecutive iterations of the expected pattern. The error threshold is always 0 for this test. [15:4]: Reserved [3:0]: $\mathrm { J C I e - A : } \text { Compare results }$ Fail (Errors &gt; Max Error \left. \text { Threshold\right), } 1 h : \text { Pass \left(Error\right) }<br>< = \text { Max Error Threshold } \right) $\left. R R D \_ L \left[ 1 \right] , R R D \_ L \left[ 0 \right] \right)$ $R R D \_ L \left[ 3 \right] a n d \quad R R D \_ L \left[ 2 \right]$ { \text { are reserved for UCIe-A } \times 3 2 }<br>{ \text { as a transmitter of this } }</td> <td>AAh</td> <td>0Fh</td> <td>The error condition for this flow is NOT $e x p e c t e d \quad p a t t e r n . T h e \quad e r r o r \quad t h r e s h o l d \quad i s$ [63:0]: Compare Results of individual Data Lanes (Oh: Fail (Errors &gt; Max Error Threshold), 1h: Pass (Errors &lt;= Max Error Threshold)) { \text { UCIe-A } \left\{ R D \text { L } \left[ 6 3 \right] , R D _ { - } L \left[ 6 2 \right] , \cdots , \right. }<br>{ \left. \text { RD } _ { - } L \left[ 1 \right] , R D _ { - } L \left[ 0 \right] \right\ ,$ $\text { UCIe-S } \left\{ 4 8 ^ { \prime } h 0 , R D , L \left[ 1 5 \right] , R D _ { - } \left[ \left[ 1 4 \right] , \right. \right. }<br>{ \left. \text { RD } _ { - } L \left[ 1 \right] , R D _ { - } L \left[ 0 \right] \right\ .$ , $\text { UCIe-A } \times 3 2 \left\{ 3 2 ^ { 2 } h 0 , R D , L \left[ 3 1 \right] , R D _ { - L } \left[ 3 0 \right] \right. }<br>{ \cdots , R D L \left[ 0 1 \right\} ^ { 3 ,$ $\text { UCIe-S } \times 8 \left\{ 5 6 ^ { \prime } h 0 , R D , L \left[ 7 \right] , R D _ { - } L \left[ 6 \right] , \ldots , \right. }<br>{ \left. \text { RD } _ { - } L \left[ 1 \right] , R D _ { - } L \left[ 0 \right] \right\ ,$</td> </tr> </table> <table> <caption>Table 7-11. Link Training State Machine related encodings (Sheet 5 of 6)</caption> <tr> <th>Message</th> <th>MsgInfo[15:0]</th> <th>$\text { MsgCod } }<br>{ \left[ 7 : 0 \right] }</th> <th>{ \text { MsgSubcoue } }<br>{ \left[ 7 : 0 \right] }</th> <th>Data Field [63:0]</th> </tr> <tr> <td rowspan="2">{MBINIT.REPAIRMB Apply repair req}</td> <td rowspan="2">0000h</td> <td rowspan="2">$A 5 h$</td> <td rowspan="2">$1 2 h$</td> <td>[31:24]: Repair Address for TRD_P[3]: Indicates the physical Lane repaired when { \text { TRD_P\left[3\right] is used in remapping scheme. Thi } }<br>{ \text { is reserved for UCIe-A } x 3 2 \text { as a transmiter } } of this message. $2 1 h : T D _ { - }$ 22h: TD_P[34] Repaired ...... 3Eh: TD_P[62] Repaired 3Fh: TD_P[63] Repaired F0h: Reserved $\left[ 2 3 : 1 6 \right] : \text { Repair Address for TRD } _ { - } :$ { \text { TRD_P\left[2\right] is used in remapping scheme. This } }<br>{ \text { is reserved for UCIe-A x32 as a transmitter } } 20h: TD_P[32] Repaired $2 1 h : T D _ { - } P \left[ 3 3 \right]$</td> </tr> <tr> <td>$3 E h : T D _ { - } P \left[ 6 2 \right]$ 3Fh: TD_P[63] Repaired F0h: Reserved FFh: No Repair { \left[ 1 5 : 8 \right] : \text { Repar Auquress repared whe } }<br>{ \text { Indicates the physical Lane repaired whe } }<br>{ \text { Ton pril is lis lin remapping scheme. } } 00h: Invalid 01h: TD_P[1] Repaired 02h: TD_P[2] Repaired ...... 1Eh: TD_P[30] Repaired 1Fh: TD_P[31] Repaired F0h: Reserved { \text { FFh: No Repair } }<br>{ \text { Tr:0\right]: Reparir Address for TRD_PIOI: } }<br>{ \text { I7: } 0 \text { l: Repair Address for renaired whe :$ $\text { Indicates the physical Lane repaired whe } }<br>{ \text { TRD PIOI is used in remapping scheme. } } 00h: TD_P[0] Repaired 01h: TD_P[1] Repaired 02h: TD_P[2] Repaired ...... 1Eh: TD_P[30] Repaired 1Fh: TD_P[31] Repaired F0h: Reserved FFh: No Repair</td> </tr> </table> <table> <caption>Table 7-11. Link Training State Machine related encodings (Sheet 6 of 6)</caption> <tr> <th>Message</th> <th>MsgInfo[15:0]</th> <th>{ \text { MsgCod } }<br>{ \left[ 7 : 0 \right] }</th> <th>{ \text { MsgSubcoue } }<br>{ \left[ 7 : 0 \right] }</th> <th>Data Field[63:0]</th> </tr> <tr> <td>{MBTRAIN.REPAIR Apply repair req}</td> <td>0000h</td> <td>B5h</td> <td>1Ch</td> <td>[31:24]: Repair Address for TRD_P[3]: Indicates the physical Lane repaired when { \text { TRD_P\left[3\right] is used in remapping scheme. Thi } }<br>{ \text { is reserved for UCIe-A } x 3 2 \text { as a transmiter } } of this message. $2 1 h : T D _ { - }$ 22h: TD_P[34] Repaired ...... 3Eh: TD_P[62] Repaired 3Fh: TD_P[63] Repaired F0h: Reserved $\left[ 2 3 : 1 6 \right] : \text { Repair Address for TRD } _ { - } :$ { \text { TRD_P\left[2\right] is used in remapping scheme. This } }<br>{ \text { is reserved for UCIe-A x32 as a transmitter } } 20h: TD_P[32] Repaired $2 1 h : T D _ { - } P \left[ 3 3 \right]$ $3 E h : T D _ { - } P \left[ 6 2 \right]$ 3Fh: TD_P[63] Repaired F0h: Reserved FFh: No Repair { \left[ 1 5 : 8 \right] : \text { Repar Auquress repared whe } }<br>{ \text { Indicates the physical Lane repaired whe } }<br>{ \text { Ton pril is lis lin remapping scheme. } } 00h: Invalid 01h: TD_P[1] Repaired 02h: TD_P[2] Repaired ...... 1Eh: TD_P[30] Repaired 1Fh: TD_P[31] Repaired F0h: Reserved { \text { FFh: No Repair } }<br>{ \text { Tr:0\right]: Reparir Address for TRD_PIOI: } }<br>{ \text { I7: } 0 \text { l: Repair Address for renaired whe :$ $\text { Indicates the physical Lane repaired whe } }<br>{ \text { TRD PIOI is used in remapping scheme. } } 00h: TD_P[0] Repaired 01h: TD_P[1] Repaired 02h: TD_P[2] Repaired ...... 1Eh: TD_P[30] Repaired 1Fh: TD_P[31] Repaired F0h: Reserved FFh: No Repair</td> </tr> </table> ### 7.1.2.4 Management Port Message (MPM) with Data As with all sideband messages, Management Port Messages with Data also carry a 1-QWORD header. This is referred to as "MPM header" (see Figure 7-5) for the remainder of this section. The payload in these messages is referred to as "MPM payload" for the remainder of this section. Bits [21:14] in the first DW of the MPM Hdr of an MPM with Data message, forms an 8b msgcode that denotes a specific MPM with Data message. Table 7-12 summarizes the supported MPM with Data messages over sideband. Support for these messages is optional and negotiated as described in Section 8.2.3.1. <table> <caption>Table 7-12. Supported MPM with Data Messages on Sideband</caption> <tr> <th>msgcode</th> <th>Message</th> </tr> <tr> <td>01h</td> <td>Encapsulated MTP Message</td> </tr> <tr> <td>FFh</td> <td>Vendor-defined Management Port Gateway Message</td> </tr> <tr> <td>Others</td> <td>Reserved</td> </tr> </table> ### 7.1.2.4.1 Common Fields in MPM Header of MPM with Data Messages on Sideband Figure 7-5 shows and Table 7-13 describes the common fields in the MPM header of MPM with data messages on the sideband. <table> <caption>Figure 7-5. Common Fields in MPM Header of all MPM with Data Messages on Sideband</caption> <tr> <th colspan="8">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th colspan="8">0</th> </tr> <tr> <th colspan="2">31 30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> <tr> <td colspan="3">srcid=011b</td> <td></td> <td colspan="2">rsvd</td> <td>re sp</td> <td></td> <td>VC</td> <td></td> <td></td> <td></td> <td colspan="4">msgcode</td> <td></td> <td></td> <td></td> <td></td> <td colspan="4">length</td> <td colspan="2"></td> <td>rs vd</td> <td colspan="5">opcode $= 1 1 0 0 0 b$</td> </tr> <tr> <td>$r s$ vd</td> <td>cp</td> <td colspan="3">rsvd</td> <td colspan="3">dstid=111b</td> <td></td> <td></td> <td></td> <td colspan="8">msgcode-specific</td> <td></td> <td colspan="4"></td> <td colspan="2">rsvd</td> <td colspan="2">msgcode- specific</td> <td colspan="2">rsvd</td> <td colspan="2">rxqid</td> </tr> </table> <table> <caption>Table 7-13. Common Fields in MPM Header of all MPM with Data Messages on Sideband</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>opcode</td> <td>11000b: MPM with Data.</td> </tr> <tr> <td>length</td> <td>MPM Payload length (i.e., 0h for 1 QWORD, 1h for 2 QWORDs, 2h for 3 QWORDs, etc.).</td> </tr> <tr> <td>msgcode</td> <td>Message code as defined in Table 7-12.</td> </tr> <tr> <td>$V C$</td> <td>Virtual Channel ID.</td> </tr> <tr> <td>resp</td> <td>0: Request MPM. 1: Response MPM. Management Port Gateway Message with Data, this bit is $\mathrm { a l w a y s } 0$ $\left( s e e \quad S e c t i o n \quad 7 . 1 . 2 . 4 . 3 \right) .$</td> </tr> <tr> <td>srcid</td> <td>011b: Indicates Management Port Gateway as source. Other values: Not applicable to $M P M .$ For details on other values of srcid, see Table 7-2, Table 7-3, and Table 7-4.</td> </tr> <tr> <td>rxqid</td> <td>$\text { RxQ-ID to which this packet is destined, and } R \times Q \text { and RSSociated with any credits }$</td> </tr> <tr> <td>dstid</td> <td>{ 1 1 1 b : \text { Indicates Managenent Portent Gateway as target. Other values: } \text { Not applicable to } }<br>{ \text { MPM. For details on other values of dstid, see Table } 7 - 2 , \text { Table } 7 - 3 , \text { and Table } 7 - 4 . }</td> </tr> <tr> <td>cp</td> <td>Control parity for the sideband packet header. All fields other than "cp" in the header are protected by Control Parity, and the parity scheme is even (including reserved bits).</td> </tr> </table> #### 7.1.2.4.2 Encapsulated MTP Message Encapsulated MTP on sideband is an MPM with Data message with a msgcode of 01h. <table> <caption>Figure 7-6. Encapsulated MTP on Sideband</caption> <tr> <th></th> <th colspan="7">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th colspan="7">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> </tr> </table> $\mathrm { s r c i d } =$ 011b rsvd re sp $\mathrm { v c }$ $m s g c o d e = 0 1 h$ length rs opcode = 11000b vd a rs vd cp rsvd $d s t i d = 1 1 1 b$ cr_ret_vc $c r \_ r e t \left( i n \quad Q W O R D s \right)$ rsvd s p rsvd rxqid <table> <tr> <td>...</td> <td>...</td> <td>DWORD 0: Byte 1</td> <td>DWORD 0: Byte 0</td> </tr> <tr> <td>...</td> <td>...</td> <td>DWORD 1: Byte 1</td> <td>DWORD 1: Byte 0</td> </tr> </table> b d ... 1 DWORD padding of all 0s (if required) e a. MPM Header. b. MPM Payload. c. Management Transport Packet (MTP). d. Length in MPM Header. e. DWORD padding. <table> <caption>Table 7-14. Encapsulated MTP on Sideband Fields</caption> <tr> <th>Location</th> <th>Bit</th> <th>Description</th> </tr> <tr> <td rowspan="7">$\mathrm { M P M } \mathrm { H e a d e r } ^ { \mathrm { a } }$</td> <td>s</td> <td>Segmented MTP (see Section 8.2.4.2). The first and middle segments in a segmented MTP have this bit set to 1. The last segment in a segmented MTP will have this bit cleared to 0. An unsegmented MTP also has this bit cleared to 0.</td> </tr> <tr> <td>$p$</td> <td>$I f \quad t h i s \quad i s \quad s e t \quad t o \quad 1 , t h e r e \quad i s \quad 1 - D W O R D \quad p a d d i n g \quad o f \quad a l l \quad O s \quad a d d e d \quad a t \quad t h e \quad e n d \quad o f$</td> </tr> <tr> <td rowspan="3">cr_ret</td> <td>Value of RxQ credits being returned to the MPG receiving this message, indicated by the rxqid value and its VC: Resp channel indicated via cr_ret_vc/cr_ret_resp fields. 000h indicates 0 credits returned. 001h indicates 1 credit returned.</td> </tr> <tr> <td>3FEh indicates 1022 credits returned. 3FFh is reserved.</td> </tr> <tr> <td>If there is no credit being returned, cr_ret fields must be set to 0h.</td> </tr> <tr> <td>cr_ret_vc</td> <td>VC associated with the credit returned.</td> </tr> <tr> <td>$\mathrm { c r } _ { - } \mathrm { r e t } _ { - } \mathrm { r e s p }$</td> <td>Resp value associated with the credit returned. 0=Request channel credit. 1 =Response channel credit.</td> </tr> <tr> <td>MPM Payload</td> <td>—</td> <td>See Section 8.2 for details. Note that DWORDx: Bytey in Figure 7-6 refers to the corresponding DWORD, Byte defined in the Management Transport Packet in Figure 8-5.</td> </tr> </table> a. See Section 7.1.2.4.1 for details of header fields common to all MPMs with data on the sideband. cr ret re sp c #### 7.1.2.4.3 Vendor-defined Management Port Gateway Message The Vendor-defined Management Port Gateway message with data is defined for custom communication between MPGs on the two ends of a UCIe sideband link. These messages are not part of the Management transport protocol, and these messages start at an MPG and terminate at the MPG on the other end of the UCIe sideband link. These messages share the same RxQ-ID request buffers and credits as encapsulated MTP messages. If an MPG does not support these messages or does not support vendor-defined messages from a given vendor (identified by the UCIe Vendor ID in the header), the MPG silently drops those messages. Length of these Vendor defined messages is subject to the same rules stated in Section 8.2.5.1.2. Ordering of these messages sent over multiple sideband links is subject to the same rules presented in Section 8.2.4.3 for encapsulated MTPs. <table> <caption>Figure 7-7. Vendor-defined Management Port Gateway Message with Data on Sideband</caption> <tr> <th colspan="8">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th colspan="8">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> </tr> <tr> <td colspan="3">$s r c i d = 0 1 1 b$</td> <td></td> <td>rsvd</td> <td></td> <td>$r e$ sp = 0</td> <td></td> <td>VC</td> <td></td> <td></td> <td></td> <td></td> <td>msgcode</td> <td colspan="2">= FFh</td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td>length</td> <td></td> <td></td> <td></td> <td></td> <td>rs vd</td> <td></td> <td></td> <td></td> <td>$o p c o d e = 1 1 0 0 0 b$</td> <td></td> </tr> </table> <figure> a $r s$ vd cp rsvd $d s t i d = 1 1 1 b$ UCIe Vendor ID rsvd rxqid $b$ Vendor-defined payload c </figure> a. MPM Header. b. MPM Payload. c. Length in MPM Header. <table> <caption>Table 7-15. Vendor-defined Management Port Gateway Message with Data on Sideband Fields</caption> <tr> <th>Location</th> <th>Field</th> <th>Description</th> </tr> <tr> <td>MPM Headerª</td> <td>UCIe Vendor ID</td> <td>UCIe Consortium-assigned unique ID for each vendor.</td> </tr> <tr> <td>MPM Payload</td> <td>—</td> <td>Vendor-defined.</td> </tr> </table> a. See Section 7.1.2.4.1 for details of header fields common to all MPMs with data on the sideband. ### 7.1.2.5 MPMs without Data Bits [21:14] in the first DWORD of the MPM header of an MPM without Data message form an 8b msgcode that denotes a specific MPM without Data message. Table 7-16 lists the supported msgcodes. <table> <caption>Table 7-16. Supported MPM without Data Messages on Sideband</caption> <tr> <th>msgcode</th> <th>Message</th> </tr> <tr> <td>01h</td> <td>Management Port Gateway Capabilities Message</td> </tr> <tr> <td>02h</td> <td>Credit Return Message</td> </tr> <tr> <td>03h</td> <td>Init Done Message</td> </tr> <tr> <td>04h</td> <td>PM Message</td> </tr> <tr> <td>FFh</td> <td>Vendor-defined Management Port Gateway Message</td> </tr> <tr> <td>Others</td> <td>Reserved</td> </tr> </table> ### 7.1.2.5.1 Common Header Fields of MPM without Data Messages on Sideband Figure 7-8 shows and Table 7-17 describes the common fields in the MPM header of MPM without data messages on the sideband. <table> <caption>Figure 7-8. Common Fields in MPM Header of all MPM without Data Messages on Sideband</caption> <tr> <th colspan="8">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th colspan="8">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>11109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> <tr> <td colspan="3">$s r c i d = 0 1 1 b$</td> <td colspan="2"></td> <td colspan="3">rsvd</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="3">msgcode</td> <td></td> <td></td> <td></td> <td></td> <td colspan="5">msgcode-specific</td> <td></td> <td>rs vd</td> <td></td> <td colspan="4">opcode = 10111b</td> </tr> <tr> <td>$r s$ vd</td> <td>cp</td> <td></td> <td colspan="2">rsvd</td> <td colspan="3">$d s t i d = 1 1 1 b$</td> <td></td> <td></td> <td></td> <td></td> <td colspan="4"></td> <td></td> <td></td> <td></td> <td colspan="6">msgcode-specific</td> <td></td> <td></td> <td></td> <td colspan="2">rsvd</td> <td colspan="2">msgcode- specific</td> </tr> </table> <table> <caption>Table 7-17. Common Fields in MPM Header of all MPM without Data Messages on Sideband</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>opcode</td> <td>10111b: MPM without Data.</td> </tr> <tr> <td>msgcode</td> <td>Message code as defined in Table 7-16.</td> </tr> <tr> <td>srcid</td> <td>011b: Indicates Management Port Gateway as source.</td> </tr> <tr> <td>cp</td> <td>Control parity for the sideband packet header. All fields other than "cp" in the header are protected by Control Parity, and the parity scheme is even (including reserved bits).</td> </tr> <tr> <td>dstid</td> <td>111b: Indicates Management Port Gateway as target.</td> </tr> </table> ### 7.1.2.5.2 Management Port Gateway Capabilities Message See Section 8.2.3.1.2 for usage of this message during sideband management transport path initialization. Figure 7-9 shows and Table 7-18 describes the Management Port Gateway Capabilities message format on the sideband. <table> <caption>Figure 7-9. Management Port Gateway Capabilities MPM on Sideband</caption> <tr> <th colspan="8">3</th> <th></th> <th colspan="7">2</th> <th></th> <th colspan="7">1</th> <th></th> <th colspan="7">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th>8</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th></th> <th></th> <th></th> <th>3210</th> </tr> </table> a <table> <tr> <th colspan="3">srcid=011b</th> <th>rsvd</th> <th>$m s g c o d e = 0 1 h$</th> <th>NumVC</th> <th>rsvd $o p c o d e = 1 0 1 1 1 b$</th> </tr> <tr> <td>rs vd</td> <td>cp</td> <td>rsvd</td> <td>$d s t i d = 1 1 1 b$</td> <td>Port ID[15:0]</td> <td></td> <td>rsvd</td> </tr> </table> a. MPM Header. <table> <caption>Table 7-18. Management Port Gateway Capabilities MPM Header Fields on Sidebandª</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>NumVC</td> <td>Number of VCs supported by the Management Port Gateway that is transmitting the message.</td> </tr> <tr> <td>Port ID</td> <td>Port ID number value of the Management port associated with the Management Port Gateway that is issuing the message (see Section 8.1.3.6.2.1).</td> </tr> </table> a. See Table 7-17 for details of header fields common to all MPMs without data on the sideband. ### 7.1.2.5.3 Credit Return Message See Section 8.2.3.1.2 for usage of this message during sideband management transport path initialization. Figure 7-10 shows and Table 7-19 describes the Credit Return message format on the sideband. If credit returns a and b carry the same vc:resp fields, then the total credit returned for that rxqid: vc:resp credit type is the sum of cr_ret_a and cr_ret_b. Figure 7-10. Credit Return MPM on Sideband a <table> <tr> <th colspan="8">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th colspan="8">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>9876543210</th> </tr> <tr> <td colspan="2">srcid=011b</td> <td></td> <td></td> <td></td> <td></td> <td>rsvd</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="4">$m s g c o d e = 0 2 h$</td> <td></td> <td></td> <td>cr ret re sp. a</td> <td colspan="2">cr_ret_vc_a</td> <td></td> <td>cr_ ret re sp b</td> <td></td> <td>cr_ret_vc_b</td> <td></td> <td>rs vd</td> <td></td> <td></td> <td colspan="3">$o p c o d e = 1 0 1 1 1 b$</td> </tr> <tr> <td>rs $v d$</td> <td>cp</td> <td></td> <td colspan="2">rsvd</td> <td colspan="3">dstid=111b</td> <td></td> <td></td> <td colspan="6">cr_ret_a</td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td colspan="5">cr_ret_b</td> <td></td> <td></td> <td colspan="2">rsvd</td> <td colspan="2">rxqid</td> </tr> </table> a. MPM Header. <table> <caption>Table 7-19. Credit Return MPM Header Fields on Sidebandª</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>cr_ret_vc_a(b)</td> <td>VC for which the credit is being returned.</td> </tr> <tr> <td>$c r \_ r e t \_ r e s p \_ a \left( b \right)$</td> <td>Resp value associated with the credit returned. 0=Request channel credit. 1=Response channel credit.</td> </tr> <tr> <td>$\mathrm { c r } _ { - } \mathrm { r e t } _ { - } \mathrm { a } \left( \mathrm { b } \right)$</td> <td>Value of credits returned for the RxQ (in the Management Port Gateway transmitting this and the associated VC: Resp channel indicated via $c r \_ r e t \_ v c \_ a \left( b \right) / c r \_ r e t \_ r e s p \_ a \left( b \right) f i e l d s .$ 001h indicates 1 credit returned. 3FEh indicates 1022 credits returned. 3FFh indicates infinite credits. 3FFh value is legal only on credit returns that happen during VC initialization (i.e., before Init Done message is sent) $\mathrm { a n d } \mathrm { c a n n o t }$ be used after initialization until the transport path is renegotiated/initialized again. If a receiver detects infinite credit returns after VC initialization and during runtime, it silently ignores it.</td> </tr> <tr> <td>rxqid</td> <td>RxQ-ID of the receiver queue for which the credits are being returned (see Section 8.2.3.1.2 for RxQ details).</td> </tr> </table> a. See Table 7-17 for details of header fields common to all MPMs without data on the sideband. #### 7.1.2.5.4 Init Done Message See Section 8.2.5.1.4 for usage of this message during sideband management transport path initialization. Figure 7-11 shows and Table 7-20 describes the Init Done message format on the sideband. <table> <caption>Figure 7-11. Init Done MPM on Sideband</caption> <tr> <th colspan="8">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th></th> <th colspan="6">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th>8</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th></th> <th></th> <th>3210</th> </tr> <tr> <td colspan="3">$\mathrm { s r c i d } = 0 1 1 \mathrm { b }$</td> <td colspan="5">rsvd</td> <td></td> <td></td> <td></td> <td colspan="6">$m s g c o d e = 0 3 h$</td> <td></td> <td></td> <td></td> <td></td> <td colspan="3">rsvd</td> <td></td> <td></td> <td></td> <td colspan="4">$o p c o d e = 1 0 1 1 1 b$</td> </tr> <tr> <td>$r s$ vd</td> <td>cp</td> <td></td> <td colspan="2">rsvd</td> <td colspan="3">$d s t i d = 1 1 1 b$</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="3"></td> <td></td> <td></td> <td>rsvd</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td colspan="2">rxqid</td> </tr> </table> a a. MPM Header. <table> <caption>Table 7-20. Init Done MPM Header Fields on Sidebandª</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>rxqid</td> <td>RxQ-ID of the receiver queue that has completed initializing credits (see Section 8.2.3.1.2 for RxQ details).</td> </tr> </table> a. See Table 7-17 for details of header fields common to all MPMs without data on the sideband. #### 7.1.2.5.5 PM Message See Section 8.2.5.1.4 for usage of this message during sideband management transport PM flows. Figure 7-12 shows and Table 7-21 describes the PM message format on the sideband. <table> <caption>Figure 7-12. PM MPM on Sideband</caption> <tr> <th colspan="8">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th></th> <th colspan="7">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> </tr> </table> a <table> <tr> <th colspan="3">$s r c i d = 0 1 1 b$</th> <th>rsvd</th> <th>$m s g c o d e = 0 4 h$</th> <th>pmcode</th> <th colspan="2">rsvd $o p c o d e = 1 0 1 1 1 b$</th> </tr> <tr> <th>$r s$ $v d$</th> <th>cp</th> <th>rsvd</th> <th>dstid=111b</th> <th></th> <th>rsvd</th> <th></th> <th>rxqid</th> </tr> </table> a. MPM Header. <table> <caption>Table 7-21. PM MPM Header Fields on Sidebandª</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>pmcode</td> <td>1h: Wake Req; 2h: Wake ack: 3h; Sleep Req; 4h: Sleep ack; 5h: Sleep nak; Others: Rsvd.</td> </tr> <tr> <td>rxqid</td> <td>RxQ details). RxQ-ID of the receiver queue to which the message applies (see Section 8.2.3.1.2 for</td> </tr> </table> a. See Table 7-17 for details of header fields common to all MPMs without data on the sideband. ### 7.1.2.5.6 Vendor-defined Management Port Gateway Message The Vendor-defined Management Port Gateway message without data is defined for custom communication between the MPGs on both ends of a UCIe sideband link. These messages are not part of the management transport protocol, and these messages start at an MPG and terminate at the MPG on the other end of the UCIe sideband link. These messages share the same RxQ-ID request buffers as encapsulated MTP messages. If an MPG does not support these messages or does not support these messages from a given vendor (identified by the UCIe Vendor ID in the header), the MPG silently drops those messages. The Vendor-defined Management Port Gateway message without data on the sideband has the format shown in Figure 7-13. Figure 7-13. Vendor-defined Management Port Gateway MPM without Data on Sideband a <table> <tr> <th colspan="8">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th colspan="8">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> </tr> <tr> <td colspan="2">srcid=011b</td> <td></td> <td></td> <td>rsvd</td> <td></td> <td>re sp = 0</td> <td></td> <td>VC</td> <td></td> <td></td> <td></td> <td></td> <td colspan="3">msgcode = FFh</td> <td></td> <td></td> <td></td> <td></td> <td colspan="4">Vendor-defined</td> <td></td> <td></td> <td>rs vd</td> <td></td> <td></td> <td colspan="3">$o p c o d e = 1 0 1 1 1 b$</td> </tr> <tr> <td>$r s$ vd</td> <td>cp</td> <td></td> <td colspan="2">rsvd</td> <td colspan="3">$d s t i d = 1 1 1 b$</td> <td></td> <td></td> <td></td> <td></td> <td colspan="7">UCIe Vendor ID</td> <td colspan="5"></td> <td></td> <td></td> <td colspan="2">rsvd</td> <td colspan="2"></td> <td colspan="2">rxqid</td> </tr> </table> a. MPM Header. <table> <caption>Table 7-22. MPM Header Vendor-defined Management Port Gateway Message without Data on Sidebandª</caption> <tr> <th>Field</th> <th>Descriptions</th> </tr> <tr> <td>Vendor-defined</td> <td>Defined by the vendor specified in the UCIe Vendor ID field.</td> </tr> <tr> <td>VC</td> <td>Virtual Channel ID.</td> </tr> <tr> <td>resp</td> <td>Vendor-defined Management Port Gateway message without data always uses the Request channel. The value must be 0.</td> </tr> <tr> <td>UCIe Vendor ID</td> <td>UCIe Consortium-assigned unique ID for each vendor.</td> </tr> <tr> <td>rxqid</td> <td>RxQ details). RxQ-ID of the receiver queue to which the message belongs (see Section 8.2.3.1.2 for</td> </tr> </table> a. See Table 7-17 for details of header fields common to all MPMs without data on the sideband. ### 7.1.2.6 Priority Sideband Traffic Packets See Section 4.1.5.2 for the rules associated with priority sideband traffic packets. Figure 7-14 shows the packet format. Note that Byte 0[6, 5] must always be 11b for all priority sideband traffic packets to avoid aliasing with other packet types in case there are single bit errors during transmission. Bit 31 is a Parity (P) bit, calculated by XORing bits 0 through 30 of the priority sideband traffic packet (i.e., P = ^ {PSPT[30:0]}, where PSTP is the priority sideband traffic packet). <table> <caption>Figure 7-14. Format for Priority Sideband Traffic Packets</caption> <tr> <th colspan="20">Priority Sideband Traffic Packet</th> </tr> <tr> <th>Bytes</th> <th colspan="3">3</th> <th colspan="2">2</th> <th colspan="4">1</th> <th colspan="2"></th> <th></th> <th colspan="5">0</th> <th colspan="2"></th> </tr> <tr> <td>Bits</td> <td>31</td> <td>30 29 28 27 26 25</td> <td>24</td> <td>23 22 21 20 19</td> <td>18 17 16</td> <td>15</td> <td>14</td> <td>13 12</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>Header / Data</td> <td colspan="17">11109876543210 Header</td> <td colspan="2"></td> </tr> <tr> <td>Phase0</td> <td>P</td> <td colspan="2"></td> <td colspan="4">Payload (LSB is on bit 8)</td> <td></td> <td></td> <td colspan="2"></td> <td>rsvd</td> <td>1</td> <td>1</td> <td colspan="3">$o p c o d e \left[ 4 : 0 \right]$</td> <td></td> <td></td> </tr> </table> ### 7.1.3 Flow Control and Data Integrity Sideband packets can be transferred across FDI, RDI or the UCIe sideband Link. Each of these have independent flow control. #### 7.1.3.1 Flow Control and Data Integrity over FDI and RDI For each Transmitter associated with FDI or RDI, a design time parameter of the interface is used to determine the number of credits advertised by the Receiver, with a maximum of 32 credits. Each credit corresponds to 64 bits of header and 64 bits of potentially associated data. Thus, there is only one type of credit for all sideband packets, regardless of how much data they carry. Every Transmitter/Receiver pair has an independent credit loop. For example, on RDI, credits are advertised from Physical Layer to Adapter for sideband packets transmitted from the Adapter to the Physical Layer; and credits are also advertised from Adapter to the Physical Layer for sideband packets transmitted from the Physical Layer to the Adapter. The Transmitter must check for available credits before sending Register Access requests and Messages. The Transmitter must not check for credits before sending Register Access Completions, and the Receiver must guarantee unconditional sinking for any Register Access Completion packets. Messages carrying requests or responses consume a credit on FDI and RDI, but they must be guaranteed to make forward progress by the Receiver and not get blocked behind Register Access requests. Both RDI and FDI give a dedicated signal for sideband credit returns across those interfaces. All Receivers associated with RDI and FDI must check received messages for data or control parity errors, and these errors must be mapped to Uncorrectable Internal Errors (UIE) and transition RDI to LinkError state. All receivers of the Priority Sideband Traffic Packet (PSTP) must check for parity errors, and these errors must be mapped to Uncorrectable Internal Errors (UIE) and transition RDI to LinkError state. When supporting Management Port Messages over sideband, the Physical Layer maintains separate credited buffers (which is a design time parameter) per RxQ-ID it supports to which it can receive Management Port Messages from Management Port Gateway over the RDI configuration bus. Whether received over FDI or RDI, Management Port Messages are always sunk unconditionally in the Management Port Gateway. #### 7.1.3.2 Flow Control and Data Integrity over UCIe sideband Link between dies The BER of the sideband Link is 1e-27 or better. Hence, no retry mechanism is provided for the sideband packets. Receivers of sideband packets must check for Data or Control parity errors, and any of these errors is mapped to a fatal UIE. #### 7.1.3.3 End-to-End flow control and forward progress for UCIe Link sideband It is important for deadlock avoidance to ensure that there is sufficient space at the Receiver to sink all possible outstanding requests from the Transmitter, so that the requests do not get blocked at any intermediate buffers that would thereby prevent subsequent completions from making progress. Sideband access for Remote Link partner's Adapter or Physical Layer registers is only accessible via the indirect mailbox mechanism, and the number of outstanding transactions is limited to four at a time. Although four credits are provisioned, there is only a single mailbox register, and this limits the number of outstanding requests that can use this mechanism to one at a time. The extra credits allow additional debug-related register access requests in case of register access timeouts. These credits are separate from local FDI or RDI accesses, and thus the Physical Layer must provision for sinking at least one register access request and completion each from remote die and local Adapter in addition to other sideband request credits (see Implementation Note below). The Adapter provisions for at least four remote register access requests from remote die Adapter. Each credit corresponds to 64b of header and 64b of data. Even requests that send no data or only send 32b of data consume one credit. Register Access completions do not consume a credit and must always sink. If Management Transport Protocol is not supported, the Adapter credit counters for register access request are initialized to 4 on Domain Reset exit OR whenever RDI transitions from Reset to Active. If Management Transport Protocol is supported, the Adapter credit counters for register access request are initialized to 4 on [Domain Reset exit] OR whenever [RDI transitions from Reset to Active AND SB_MGMT_UP=0]. It is permitted to send an extra (N-4) credit returns to remote Link partner if a UCIe implementation is capable of sinking a total of N requests once RDI has transitioned to Active state. The Adapter must implement a saturating credit counter capable of accumulating at least 4 credits, and hence prevent excess credit returns from overflowing the counter. All other messages except Vendor Defined messages must always sink and make forward progress, and not block any messages on the sideband interface behind them. All Link Management message requests have an associated response, and the source of these messages must only have one outstanding request at a time (i.e., one outstanding message per "Link Management Request" MsgCode encoding). Priority Sideband Traffic Packets (PSTPs) must always be accepted and make forward progress - there is no flow control check at the Transmitter for them. For vendor defined messages, there must be a vendor defined cap on the number of outstanding messages, and the Receiver must guarantee sufficient space so as to not block any messages behind the vendor defined messages on any of the interfaces. # IMPLEMENTATION NOTE Figure 7-15 shows an example of an end-to-end register access request to remote die and the corresponding completion returning back. <figure> <figcaption>Figure 7-15. Example Flow for Remote Register Access Request (Local FDI/RDI Credit Checks Are Not Explicitly Shown)</figcaption> 1a. Mailbox request completed over FDI cfg as soon as mailbox register is updated. 1\. Mailbox targeted request over FDI cfg. 10\. Adapter updates mailbox with relevant information. Status is updated, Read/Write Trigger is cleared by Adapter HW. Adapter Die 0 2\. Adapter checks credits for remote Adapter; generates remote die request. 9\. Response from remote die over RDI cfg. 3\. Remote die request over RDI cfg. Physical Layer Die 0 8\. Response for remote die over UCIe sideband. 4\. Remote die request over UCIe sideband. Physical Layer Die 1 6\. Adapter decoded the request to local Physical Layer and performs the transaction using RDI cfg. 7\. Response for remote die over RDI cfg. 5\. Request from remote die over RDI cfg. Adapter Die 1 </figure> In Step 1 shown in Figure 7-15, the Protocol Layer checks for FDI credits before sending the request to Adapter Die 0. Adapter Die 0 completes the mailbox request as soon as the mailbox register is updated (shown in Step 1a). FDI credits are returned once its internal buffer space is free. In Step 2, Adapter Die 0 checks credits for remote Adapter as well as credits for local RDI before sending the remote die request to Physical Layer Die 0 in Step 3. Physical Layer schedules the request over UCIe sideband and returns the RDI credit to Adapter Die 0 once it has freed up its internal buffer space. --- # IMPLEMENTATION NOTE ## Continued In Step 5, Physical Layer Die 1 checks for Adapter Die 1 credits on RDI before sending the request over RDI. Adapter Die 1 decodes the request to see that it must access a register on Physical Layer Die 1; Adapter Die 1 checks for RDI credits of Physical Layer Die 1 before sending the request over RDI in Step 6. Adapter Die 1 must remap the tag for this request, if required, and save off the original tag of the remote die request as well as pre-allocate a space for the completion. Physical Layer Die 1 completes the register access request and responds with the corresponding completion. Because a completion is sent over RDI, no RDI credits need to be checked or consumed. Adapter Die 1 generates the completion for the remote die request and sends it over RDI (no credits are checked or consumed for completion over RDI) in Step 7. The completion is transferred across the different hops as shown in Figure 7-15 and finally sunk in Adapter Die 0 to update the mailbox information. No RDI credits need to be checked for completions at the different hops. For forward progress to occur, the Adapters and Physical Layers on both die must ensure that they can sink sufficient requests, completions, and messages to guarantee that there is no Link Layer level dependency between the different types of sideband packets (i.e., remote register access requests, remote register access completions, Link state transition messages for Adapter LSM(s), Link state transition messages for RDI, and Link Training related messages). In all cases, because at most one or two outstanding messages are permitted for each operation, it is relatively easy to provide greater than or the same number of buffers to sink from RDI. For example, in the scenario shown in Figure 7-15, Physical Layer Die 1 must ensure that it has dedicated space to sink the request in Step 6 independent of any ongoing remote register access request or completion from Die 1 to Die 0, or any other sideband message for state transition, etc. Similarly, Physical Layer Die 1 must have dedicated space for remote die register access completion in Step 7. Dynamic coarse clock gating is permitted in Adapter or Physical Layer in a subset of the RDI states (see Chapter 10.0). Thus, when applicable, any sideband transfer over RDI or FDI must follow the clock gating exit handshake rules as defined in Chapter 10.0. It is recommended to always perform the clock exit gating handshakes for sideband transfers if implementations need to decouple dependencies between the interface status and sideband transfers. Implementations of the Physical Layer and Adapter must ensure that there is no receiver buffer overflow for messages being sent over the UCIe sideband Link. This can be done by either ensuring that the time to exit clock gating is upper bounded and less than the time to transmit a sideband packet over the UCIe sideband Link, OR that the Physical Layer has sufficient storage to account for the worst-case backup of each sideband message function (i.e., remote register access requests, remote register access completions, Link state transition messages for Adapter LSM(s), Link state transition messages for RDI, and Link Training related messages). The latter offers more-general interoperability at the cost of buffers. ## 7.1.4 Operation on RDI and FDI The same formats and rules of operation are followed on the RDI and FDI. The protocol is symmetric \- requests, completions, and messages can be sent on 1p_cfg as well as on pl_cfg signals. Implementations must ensure deadlock-free operation by allowing a sufficient quantity of sideband packets to sink and unblock the sideband bus for other packets. At the interface, these transactions are packetized into multiple phases depending on the configuration interface width (compile time parameter). Supported interface widths are 8, 16, or 32 bits. lp_cfg_vld and pl_cfg_vld are asserted independently for each phase. They must be asserted on consecutive clock cycles for transferring consecutive phases of the same packet. They may or may not assert on consecutive clock cycles when transferring phases of different packets. For packets with data, 64b of data is always transmitted over RDI or FDI; for 32b of valid payload, the most-significant 32b (Phase 4) of the packet are assigned to 0b before transfer. § § # 8.0 System Architecture ## 8.1 UCIe Manageability ### 8.1.1 Overview UCIe Manageability is optional and defines mechanisms to manage a UCIe-based SiP that is independent of UCIe mainband protocols. This accelerates the construction of a UCIe-based SiP by allowing a common manageability architecture and hardware/software infrastructure to be leveraged across implementations. Examples of functions that may be performed using UCIe Manageability include the following: · Discovery of chiplets that make up an SiP and their configuration, · Initialization of chiplet structures, and parameters (i.e., serial EEPROM replacement), · Firmware download, · Power and thermal management, · Error reporting, · Performance monitoring and telemetry, · Retrieval of log and crash dump information, · Initiation and reporting of self-test status, · Test and debug, and · Various aspects of chiplet security. UCIe manageability has been architected with the following goals: · Support for management using mainband or sideband is mainband protocol agnostic allowing it to be used with chiplets that implement existing mainband protocols, mainband protocols that may be standardized in the future, and vendor-specific mainband protocols. · The required core capabilities of UCIe manageability may be realized in hardware allowing simple chiplets to remain simple while providing advanced manageability capabilities (i.e., those that may require firmware implementation) to be implemented in chiplets that require these capabilities. . UCIe Chiplets that support manageability may be used to realize products for a variety of markets. These markets may have vastly different manageability and security requirements. UCIe manageability defines a menu of optional management and security capabilities that build on top of the required core capabilities. . UCIe manageability is intended to foster an open chiplet ecosystem where SiPs may be constructed from chiplets produced by different vendors. This means that common features and capabilities that are generally useful across market segments are standardized. Mechanisms are supplied for vendor-specific extensions. · Manageability capabilities are discoverable and configurable, allowing a common firmware base to be rapidly used across SiPs. . UCIe manageability builds on top of applicable industry standards. ## 8.1.2 Theory of Operation A UCIe-based System-in-Package (SiP) that supports manageability contains one or more UCIe Chiplets that support UCIe manageability. Chiplets in the SiP that support UCIe manageability form a Management Domain. The SiP may also contain chiplets that do not support UCIe manageability and these chiplets are outside the Management Domain. If the Management Domain contains more than one chiplet, then the chiplets are interconnected through Management Ports using chiplet-to-chiplet management links to form a Management Network. The Management Network is fully connected meaning that there is a path from any chiplet in the Management Domain to any other chiplet in the Management Domain. A UCIe Chiplet that supports manageability contains a Management Fabric and one or more Management Entities. A Management Entity is a Management Element, a Management Port, or a Management Bridge. An example UCIe chiplet that supports manageability is shown in Figure 8-1 and an example SiP that supports manageability consisting of four UCIe chiplets is shown in Figure 8-2. <figure> <figcaption>Figure 8-1. Example UCIe Chiplet that Supports Manageability</figcaption> Chiplet Management Fabric Management Element Management Element Management Bridge Management Port Management Element Management Port Management Port Management Port </figure> <figure> <figcaption>Figure 8-2. Example SiP that Supports Manageability</figcaption> Chiplet Management Fabric Chiplet Management Fabric Management Director Management Element Management Bridge Management Port Management Port Management Element Management Element { \text { vagement } }<br>{ \text { Port } } Management Port Management Port Management Port Management Port Management Port Management Port Chiplet Chiplet Management $\mathrm { E l e m e n t }$ Management $\mathrm { E l e m e n t }$ $\mathrm { M a n a g e m e n t }$ Management Port $\mathrm { M a n a g e m e n t }$ Element $\mathrm { M a n a a c m e n t }$ Port $\mathrm { M a n a a q e m e n t }$ Element Management Element Management Fabric Management Fabric Management $E l e m e n t$ </figure> The UCIe Management Transport is an end-to-end media-independent protocol for management communication on the Management Network. This includes between Management Entities within a chiplet as well as between Management Entities in different chiplets. As shown in Figure 8-3, the Management Protocols above the UCIe Management Transport are used to implement management services. An example of a Management Protocol is the UCIe Memory Access Protocol. Figure 8-3. UCIe Manageability Protocol Hierarchy <figure> </figure> <table> <tr> <th></th> <th colspan="2">UCIe Protocol(s)</th> <th>Management Protocol</th> </tr> <tr> <td></td> <td colspan="2">UCIe Management Transport</td> <td>UCIe Management Transport</td> </tr> <tr> <td></td> <td>UCIe Sideband Management Link Encapsulation $\mathrm { M e c h a n i s m }$</td> <td>UCIe Mainband Management Link Encapsulation Mechanism</td> <td>Management Link Encapsulation Mechanism</td> </tr> </table> A Management Port is a Management Entity that acts as the interface between the Management Fabric within a chiplet and a point-to-point management link that interconnects two chiplets. As shown in Figure 8-3. UCIe Manageability Protocol Hierarchy, below the UCIe Management Transport is a Management Link Encapsulation Mechanism that defines how UCIe Management Transport packets are transferred across a point-to-point management link. Two Management Link Encapsulation Mechanisms are defined, one for the UCIe sideband and one for the UCIe mainband. See Section 8.2 for additional details of Management Link Encapsulation Mechanisms. Whether a specific UCIe sideband or mainband link in a chiplet may function as a point-to-point management link is implementation specific. A chiplet that supports manageability should support at least one UCIe sideband Management Port. To enable broad interoperability, it is strongly recommended that a chiplet support enough UCIe sideband Management Ports to enable construction of an SiP with a single management domain using only UCIe sideband. If a chiplet supports management applications that require high bandwidth, such as test, debug, and telemetry, then it is strongly recommended that the chiplet support UCIe mainband Management Ports. A Management Fabric within a UCIe chiplet facilitates communication between Management Entities inside the chiplet. A Management Entity is a Management Element, a Management Port, or a Management Bridge. The Management Fabric may be realized using one or more on-die fabrics and the implementation of the Management Fabric is beyond the scope of this specification. A Management Element is a Management Entity that implements a management service. A Management Element must support the UCIe Management Transport protocol and one or more Management protocols. A Management Bridge is a Management Entity that interconnects the Management Network to another interconnect, allowing agents on the Management Network and the other interconnect to communicate. The interconnect associated with a bridge may be internal to an SiP or external to the SiP. One of the Management Elements within an SiP is designated as the Management Director. An SiP may contain multiple Management Elements that may act as a Management Director; however, there can only be one active Management Director at a time. How the Management Director is selected in such SiPs is beyond the scope of this specification. The roles of the Management Director include the following: · Discovering chiplets and configuring Chiplet IDs, · Discovering and configuring Management Elements, · Discovering and configuring Management Ports, · Discovering and configuring Management Bridges, · Acting as the manageability Root of Trust (RoT), and . Coordinating overall management of the SiP. One or more of the Management Elements within an SiP may function as a Security Director. A Security Director is responsible for configuring security parameters. The relationship between the various type of Management Entities is shown in Figure 8-4. <figure> <figcaption>Figure 8-4. Relationship Between the Various Types of Management Entities</figcaption> Management Entity Management Element Management Port Management Bridge Management Director Security Director DFx Management Hub Other Type of Management Element </figure> Unless otherwise specified, UCIe manageability, Management Entities, and all associated manageability structures in a chiplet (e.g., those in a Management Capability Structure) are reset on a Management Reset. A Management Reset occurs on initial application of power to a chiplet. Other conditions that cause a Management Reset are implementation specific. ## 8.1.3 UCIe Management Transport The UCIe Management Transport is a protocol that facilitates communication between Management Entities on an SiP's Management Network. UCIe Management Transport packets are produced and consumed by Management Entities on the Management Network and the packets flow unmodified through the network. ### 8.1.3.1 UCIe Management Transport Packet Figure 8-5 shows the fields that make up a UCIe Management Transport packet. The first two DWORDs contain the packet header. This is followed by a protocol specified field defined by the Management Protocol carried in the packet. Finally, a UCIe Management Transport packet may optionally contain a Packet Integrity value computed over the previous contents of the packet. If present, Packet Integrity is one DWORD in size. Reserved fields in a UCIe Management Transport packet must be filled with 0s when the packet is formed. Reserved fields must be forwarded unmodified on the Management Network and ignored by receivers. An implementation that relies on the value of a reserved field in a packet is non-compliant. <table> <caption>Figure 8-5. UCIe Management Transport Packet</caption> <tr> <th></th> <th colspan="3">+0 +1 +2 76543210765432107654321076543210</th> <th></th> <th></th> <th colspan="2">+3</th> <th></th> </tr> <tr> <th>DWORD 0 Packet</th> <th>Destination ID</th> <th>Mgmt. Protocol ID</th> <th>$T C$</th> <th>$P I P P$</th> <th>Resp</th> <th>Reserved</th> <th>Ver</th> <th></th> </tr> <tr> <td>- - Header DWORD 1</td> <td>Source ID</td> <td colspan="2">Security Clearance Group</td> <td></td> <td colspan="3">Length</td> <td></td> </tr> <tr> <td>DWORD 2</td> <td colspan="7"></td> <td></td> </tr> <tr> <td>-- DWORD 3 Management</td> <td colspan="7"></td> <td></td> </tr> <tr> <td>Protocol Specific</td> <td colspan="6"></td> <td></td> <td></td> </tr> <tr> <td>-- DWORD M</td> <td colspan="4"></td> <td colspan="2"></td> <td></td> <td></td> </tr> <tr> <td>DWORD M+1 Packet DWORD N { \text { Integrity } }<br>{ \text { Protection } }</td> <td colspan="4">Packet Integrity Protection (Optional)</td> <td colspan="2"></td> <td></td> <td></td> </tr> </table> <figure> </figure> Table 8-1 defines the fields of a UCIe Management Transport packet. All fields in the table have little endian bit ordering (e.g., Destination ID bits 0 through 7 are in Byte 1 with bit 0 of the Destination ID in Byte 1 bit 0, and Destination ID bits 8 through 15 are in Byte 0 with Destination ID bit 8 in Byte 0 bit 0). <table> <caption>Table 8-1. UCIe Management Transport Packet Fields (Sheet 1 of 2)</caption> <tr> <th>Field Name</th> <th>Field Size</th> <th>Description</th> </tr> <tr> <td>Destination ID</td> <td>16 bits</td> <td>Destination ID This field specifies the Management Network ID of the entity on the Management Network that is to receive the packet.</td> </tr> <tr> <td>Mgmt. Protocol ID</td> <td>3 bits</td> <td>Management Protocol ID This field contains an ID that corresponds to a Management Protocol and specifies the type of payload contained in the Management Protocol Specific field. See Section 8.1.3.1.3 for ID values.</td> </tr> <tr> <td>$\mathrm { T C }$</td> <td>3 bits</td> <td>Traffic Class This field is a packet label used to enable different packet servicing policies. Each Traffic Class is a unique ordering domain with no ordering guarantees between packets in different Traffic Classes. See Section 8.1.3.1.1.</td> </tr> <tr> <td>PIPP</td> <td>2 bits</td> <td>Packet Integrity Protection Present (PIPP) A nonzero value in this field indicates that the packet contains a packet integrity protection value in the Packet Integrity Protection field. The type of packet integrity is indicated by the nonzero value. See Section 8.1.3.4 for more information. 00b: Packet Integrity Protection field is not present in the packet 11b: CRC Integrity (one DWORD in size) Others: Reserved</td> </tr> <tr> <td>Resp</td> <td>1 bit</td> <td>Request or Response This field indicates whether the packet is a request or a response. 0: Request packet 1: Response packet</td> </tr> <tr> <td>Reserved</td> <td>5 bits</td> <td>Reserved</td> </tr> <tr> <td>Ver</td> <td>2 bits</td> <td>UCIe Management Transport Packet Version This field indicates the version of the UCIe Management Transport packet. This field must be set to 00b in this version of the specification. If a Management Entity receives a packet with a UCIe Management Transport packet version that it does not support, then Management Entity must discard the packet.</td> </tr> </table> <table> <caption>Table 8-1. UCIe Management Transport Packet Fields (Sheet 2 of 2)</caption> <tr> <th>Field Name</th> <th>Field Size</th> <th>Description</th> </tr> <tr> <td>Source ID</td> <td>16 bits</td> <td>Source ID This field indicates the Management Network ID of the entity on the Management Network that originated the packet.</td> </tr> <tr> <td>Security Clearance Group</td> <td>7 bits</td> <td>Security Clearance Group This field is used by the UCIe Management Transport access control mechanism. In request packets, this field is set to the security clearance group value associated with the request. In response packets, this field must be cleared to 00h. Note: A response packet is handled at the same Security Clearance Group as its corresponding request packet.</td> </tr> <tr> <td>$\mathrm { L e n a t h }$</td> <td>9 bits</td> <td>Length This field indicates the length of the entire packet in DWORDs. This includes the UCIe Management Network Header, the Management Protocol Specific field, and the Packet Integrity Protection field if present. The length of the packet in DWORDs is equal to the value of this field plus 1 (e.g., a value of 000h in this field indicates a packet length of one DWORD, a value of 001h in this field indicates a packet length of two DWORDs, and so on).</td> </tr> <tr> <td>Management Protocol Specific</td> <td>Varies</td> <td>Management Protocol Specific This field contains Management Protocol specific packet contents. The format of this field is indicated by the Management Protocol field. This field must be an integral number of DWORDs.</td> </tr> <tr> <td>Packet Integrity Protection</td> <td>Varies</td> <td>Packet Integrity Protection If the Packet Integrity Protection Present (PIPP) field in the packet has a nonzero value, then this field is present in the packet and corresponding packet integrity value. See Section 8.1.3.4 for more information. This field must be an integral number of DWORDs. In this version of the specification only CRC integrity protection is supported which is always one DWORD.</td> </tr> </table> A request packet is a packet with the Resp field in the UCIe Management Transport packet header assigned to 0. A requester is a Management Entity that first introduces a request packet into a Management Fabric. A responder is the Management Entity that performs the actions associated with a request that consists of one or more request packets and is the ultimate destination of these request packet(s). A response packet is a packet with the Resp field in the UCIe Management Transport packet header assigned to 1. As a result of performing the actions associated with a request, the responder may introduce one or more response packets into the Management Fabric destined to the requester. A Management entity that receives a malformed packet must discard the packet. . A packet with an incorrect length in the Length field is malformed. \- An example of a malformed packet with an incorrect length in the Length field is one where the Length field in the UCIe Management Transport packet header indicates a length of 65 DWORDs but the actual length of the packet is 64 DWORDs. · A packet whose size exceeds the Management Transport Packet size supported by a chiplet is malformed. . A packet that violates a requirement outlined in this specification is malformed. \- An example of a malformed packet due to a requirement violation is a response packet with a nonzero value in the Security Clearance Group field. ### 8.1.3.1.1 Traffic Class and Packet Ordering Requirements Traffic classes (TCs) are used to enable different packet servicing policies. The UCIe Management Transport supports eight traffic classes, and the characteristics of each traffic class are described in Table 8-2. The Management Director configures management fabric routes and may configure different routes for different traffic classes (e.g., TC0 traffic may be routed to UCIe sideband Management Port A and TC2 traffic may be routed to UCIe mainband Management Port B). <table> <caption>Table 8-2. Traffic Class Characteristics</caption> <tr> <th>Traffic Class</th> <th>Description</th> </tr> <tr> <td>0</td> <td>Default Ordered Lossless Traffic Class Traffic class optimized for packets that require high reliability and availability. Example: Configuration and health monitoring packets</td> </tr> <tr> <td>1</td> <td>Low Latency Ordered Lossless Traffic Class This traffic class has the same characteristics as the Default Ordered Lossless Traffic Class but is intended to be lightly loaded and used for packets that require low latency and should bypass congested Default Ordered Lossless Traffic Class packets. Example: Debug cross trigger and low latency power management packets</td> </tr> <tr> <td>2</td> <td>Bulk Lossless Ordered Performance Traffic Class Traffic class optimized for packets associated with bulk traffic. In a properly functioning system without errors, packets in this traffic class are never dropped. Example: Firmware download packets</td> </tr> <tr> <td>3</td> <td>Bulk Lossy Ordered Performance Traffic Class Traffic class optimized for packets associated with bulk traffic that may be dropped in the presence of congestion. Example: Debug trace packets</td> </tr> <tr> <td>4</td> <td>Unordered Lossless Traffic Class Traffic class optimized for packets that require high performance. Request packets in this traffic class may be delivered out-of-order. Response packets in this traffic class may be delivered out-of-order. Example: High performance UCIe Memory Access protocol accesses.</td> </tr> <tr> <td>5 to 6</td> <td>Reserved</td> </tr> <tr> <td>7</td> <td>Vendor-Specific Traffic Class</td> </tr> </table> A request packet and an associated response packet need not have the same traffic class. Which traffic classes are allowed and how they are mapped between a request and response are Management Protocol specific. An implementation shall ensure forward progress on all traffic classes. Quality of service between traffic classes is implementation specific and beyond the scope of this specification. Each traffic class is a unique ordering domain and there are no ordering guarantees for packets in different traffic classes and there are no ordering guarantees between request and response packets in the same traffic class. Regardless of the traffic class, a response packet associated with any traffic class must be able to bypass a blocked request packet associated with any traffic class. Within an ordered traffic class, request packets are delivered in-order from a requester to a responder and response packets are delivered in-order from a responder to the requester. There are no ordering guarantees between requests to different responders and there are no ordering guarantees between responses from different responders to a requester. Within an unordered traffic class there are no ordering guarantees between packets of any type and the chiplet's Management Fabric is free to arbitrarily reorder packets. While packets may be reordered on an unordered traffic class, there is no requirement that they be reordered (i.e., an implementation is free to maintain ordering as in an ordered traffic class). Packets associated with a lossy traffic class may be dropped during normal operation. The policy used to determine when a lossy traffic class packet is dropped is vendor defined and beyond the scope of this specification (e.g., due to exceeding a vendor defined congestion threshold). Lossless traffic classes are reliable, and packets associated with a lossless traffic class are not dropped during normal operation; however, packets associated with a lossless traffic class may be dropped due to an error condition. The detection of lost packets and recovery from lost packets is the responsibility of a Management Protocol. To maintain forward compatibility, a UCIe Management Transport packet with a reserved traffic class value is treated in the same manner as a packet with a traffic class value of zero (i.e., Default Ordered Lossless Traffic Class). To maintain interoperability, all implementations are required to support all traffic classes; however, an implementation is only required to maintain the ordered and lossless characteristics of a traffic class. All other traffic class characteristics may be ignored. For example, an implementation may treat all traffic classes in the same manner as the Default Ordered Lossless Traffic Class. Under no circumstances may packets in an ordered traffic class be reordered between a requester and a responder. Similarly, under no circumstances may a packet in a lossless traffic class be dropped in a properly functioning system without errors. # IMPLEMENTATION NOTE ## Chiplet Route Through Chiplet route through occurs when a UCIe Management Transport packet flows through a chiplet (i.e., the packet enters a chiplet through a UCIe Management Port, is not destined to any Management Entity within the chiplet, and the packet matches a Route Entry that causes it to be routed out a UCIe Management Port). Due to chiplet route through it is desirable that chiplets implement the packet servicing policies associated with a TC even if none of the Management Entities within the chiplet utilize that TC. Chiplets are always required to support chiplet route through for all traffic classes. ### 8.1.3.1.2 Packet Length The length of a Packet is indicated by the Length field, is an integral number of DWORDs, and consists of the entire length of the packet (i.e., the UCIe Management Network Header, the Management Protocol Specific field, and Packet Integrity Protection field if present.). The maximum packet length architecturally supported by the UCIe Management Transport is 512 DWORDs (i.e., 2048B). A chiplet may support a maximum packet length that is less than the architectural limit. The Maximum Packet Size (MPS) field in the Chiplet Capability Structure indicates the maximum packet size supported by the chiplet. If a packet larger than that advertised by MPS is received on a Management Port or Management Bridge, then it is silently discarded and not emitted on the chiplet's Management Fabric. The Configured Maximum Packet Size (CMPS) field in the Chiplet Capability Structure controls the maximum UCIe Management Transport packet size generated by a Management Entity within the chiplet. The initial value of this field corresponds to 8 DWORDs (i.e., 64B). The CMPS field does not affect UCIe Management Transport packets emitted by Management Ports and Management Bridges when forwarding packets into a chiplet's Management Fabric. This allows packets to be routed through the chiplet (e.g., between Management Ports) that are larger than the size of packets generated by Management Entities within the chiplet. ### 8.1.3.1.3 Management Protocol The Management Protocol field in a packet contains a Management Protocol ID that indicates the format of the Management Protocol Specific field. Table 8-3 lists the Management Protocols supported by the UCIe Management Transport. <table> <caption>Table 8-3. Management Protocol IDs</caption> <tr> <th>Management Protocol ID</th> <th>Description</th> </tr> <tr> <td>0</td> <td>Reserved</td> </tr> <tr> <td>1</td> <td>UCIe Memory Access Protocol This protocol is used to access memory mapped structures and memory.</td> </tr> <tr> <td>2</td> <td>UCIe Test and Debug Protocol</td> </tr> <tr> <td>3 to 6</td> <td>Reserved</td> </tr> <tr> <td>7</td> <td>Vendor defined</td> </tr> </table> #### 8.1.3.2 Management Network ID Management Network IDs are used to uniquely identify Management Entities in the Management Network and to route UCIe Management Transport packets between Management Entities. As shown in Figure 8-6, a Management Network ID is a 16-bit field that consists of the concatenation of a Chiplet ID and an Entity ID. The Chiplet ID uniquely identifies a chiplet within an SiP and the Entity ID is a fixed value that uniquely identifies a Management Entity within a chiplet. Together the Chiplet ID and Entity ID uniquely identify each Management Entity in an SiP. <figure> Figure 8-6. Management Network ID Format 15 N N-1 0 Chiplet ID Entity ID </figure> The size of the Chiplet ID in bits is chiplet implementation specific and may be 2-bits to 15-bits in size. The size of the Entity ID in bits is also chiplet implementation specific and may be 1-bit to 14- bits in size. For each chiplet, the sum of the size of the Chiplet ID and the Entity ID must be 16-bits. The size of the Chiplet ID and Entity ID fields may be different in different chiplets in an SiP (i.e., it is not a requirement that all chiplets of an SiP have the same Chiplet ID field size). To facilitate interoperability an implementation should make the Chiplet ID field as large as possible (i.e., make the Entity ID field only as large as needed to address Management Entities in the chiplet). The Management Director initializes the Chiplet ID value associated with each chiplet during SiP initialization. This is done by writing the Chiplet ID value to the Chiplet field in the Chiplet Capability Structure and setting the Chiplet ID Valid bit in that structure. The Management Director may determine the size of the Chiplet ID associated with a chiplet by examining the initial value of the Chiplet ID field in the Chiplet Capability Structure or by determining which bits are read-write in this field. Each Management Entity within a chiplet has a fixed Entity ID. Entity ID zero within each chiplet must be a Management Element that is used to initialize and configure the chiplet. Entity IDs within a chiplet that map to Management Entities may be sparse. For example, a chiplet may contain Management Entities at Management Entity IDs zero, one, and three. The other Entity IDs are unused. A UCIe Management Packet that targets an unused Entity ID within a chiplet is silently discarded by the chiplet's Management Fabric. # IMPLEMENTATION NOTE Configuring Routing in an SiP with Different Chiplet ID Sizes A System-in-Package (SiP) may be composed of chiplets with varying sizes for the Chiplet ID portion of the Management Network ID. To establish routing within such an SiP, one approach is to identify the smallest Chiplet ID size among all chiplets in the SiP. Subsequently, Route Entries (as described in Section 8.1.3.6.2.2) are configured as if each chiplet possessed a Chiplet ID size equivalent to this minimum. For chiplets with a Chiplet ID size exceeding the minimum, any unused Chiplet ID bits are assigned 0 in the Base ID field of a Route Entry and set to 1 in the Limit ID field of a Route Entry. ## 8.1.3.3 Routing UCIe Management Transport packets are routed based on the Destination ID field in the UCIe Management Network Header. The routing of UCIe Management Transport packets differs depending on whether the Chiplet ID value is initialized or uninitialized. The Chiplet ID value is initialized when the Chiplet ID Valid bit is set to 1 in the Chiplet Capability Structure. The Chiplet ID value is uninitialized when the Chiplet ID Valid bit is cleared to 0 in the Chiplet Capability Structure. A UCIe Management Transport request packet is one where the Resp field is cleared to 0. A UCIe Management Transport response packet is one where the Resp field is set to 1. While the Chiplet ID and Entity ID size of chiplets may vary in an SiP, all packet routing associated with a chiplet is performed using the Chiplet ID size of the chiplet performing the routing. The method used to configure UCIe Management Transport routing within an SiP is beyond the scope of this specification. The routing may be pre-determined during SiP design and this static configuration may be used by the Management Director to configure routing. Alternatively, the Management Director may discover the SiP configuration (i.e., chiplets, Management Network topology, and Chiplet ID size of each chiplet) and use this information to dynamically configure routing. Because the Management Network may contain redundant management links between chiplets as well as links that form cycles, care must be exercised to ensure that the UCIe Management Transport routing is acyclic and deadlock free. In the absence of faults, request packets and response packets are delivered in order; however, it is possible to configure UCIe Management Transport routing such that the path used by a request packet from a requester to a responder is different from path used by a response packet from the responder back to the requester. ## 8.1.3.3.1 Routing of a Packet from a Management Entity within the Chiplet This section describes routing of a UCIe Management Transport packet generated by a Management Entity within the chiplet. . If the chiplet's Chiplet ID value is initialized, then the packet is routed as follows. \- If the Chiplet ID portion of the packet's Destination ID matches the Chiplet ID value of the chiplet performing the routing, the packet is routed within the chiplet based on the Entity ID portion of the packet's Destination ID. o If the Entity ID portion of the packet's Destination ID matches that of a Management Entity within the chiplet, then the packet is routed to that Management Entity. o If the Entity ID portion of the packet's Destination ID does not match that of any Management Entity within the chiplet, then the packet is discarded. \- If the Chiplet ID portion of the packet's Destination ID does not match the Chiplet ID value of the chiplet, then the packet is routed based on Management Port Route Entries. o If the packet's Destination ID matches a Route Entry associated with a Management Port, then the packet is routed out that Management Port. See Section 8.1.3.6.2.2 for Route Entry matching rules. o If the packet's Destination ID matches multiple Route Entries within the chiplet and the packet is associated with an ordered traffic class, then the packet is discarded. o If the packet's Destination ID matches multiple Route Entries within the chiplet and the packet is associated with an unordered traffic class, then the packet is routed out one of the Management Ports with a matching Route Entry. Which matching Route Entry is selected in the unordered traffic class case is vendor defined. o If the packet's Destination ID does not match any Route Entries within the chiplet, then the packet is discarded. . If the chiplet's Chiplet ID value is uninitialized, then packet is routed as follows. \- If the packet is a UCIe Management Transport Response packet and the corresponding UCIe Management Transport Request packet was received from a Management Port, then the packet is routed as follows. o If the link is up that is associated with Management Port on which the corresponding UCIe Management Transport Request packet was received, then the response packet is routed out that same Management Port on virtual channel zero (VC0). This allows a Management Entity outside the chiplet to configure the chiplet before the chiplet's Chiplet ID value is initialized. o If the link associated with Management Port on which the corresponding UCIe Management Transport Request packet was received is not up (a link may be down after receiving a UCIe Management Transport Request packet for reasons such as link instability, or a write to the Link Not Up field, etc.), then the response packet is discarded. \- Otherwise, the packet is routed within the chiplet based on the Entity ID portion of the packet's Destination ID. o If the Entity ID portion of the packet's Destination ID matches that of a Management Entity within the chiplet, then the packet is routed to that Management Entity. o If the Entity ID portion of the packet's Destination ID does not match that of any Management Entity within the chiplet, then the packet is discarded. ### IMPLEMENTATION NOTE #### Routing for Uninitialized Chiplet IDs When a chiplet's Chiplet ID value is uninitialized, then a packet received on a chiplet's Management Port is routed based on the Entity ID portion of the packet's Destination ID to a Management Entity within the chiplet, if one exists. When a response packet is emitted by this Management Entity, the packet is routed out the same Management Port on which the corresponding request was received. This allows an agent external to the chiplet to configure the chiplet before the Chiplet ID and Route Entries are initialized (e.g., following a Management Reset). When a response packet is routed out the Management Port on which the corresponding request was received, it is routed out the Management Port on virtual channel zero. While there is no requirement that requests to uninitialized chiplets use virtual channel zero (VC0), it is strongly encouraged that virtual channel zero be used. ## 8.1.3.3.2 Routing of a Packet Received on a Management Port This Section describes routing of a UCIe Management Transport packet received on a chiplet's Management Port. . If the chiplet's Chiplet ID value is initialized, then the packet is routed in the same manner as a packet generated by a Management Entity within the chiplet. See Section 8.1.3.3.1 for how such a packet is routed. . If the chiplet's Chiplet ID value is uninitialized, then the packet is routed within the chiplet based on the Entity ID portion of the packet's Destination ID. \- If the Entity ID portion of the packet's Destination ID matches that of a Management Entity within the chiplet, then the packet is routed to that Management Entity. \- If the Entity ID portion of the packet's Destination ID does not match that of any Management Entity within the chiplet, then the packet is discarded. ## 8.1.3.4 Packet Integrity Protection A UCIe Management Transport packet may optionally contain a Packet Integrity Protection field that is used to protect the integrity of the packet. The presence and type of packet integrity are indicated by the Packet Integrity Protection Present (PIPP) field in the packet. CRC protection, defined in Section 8.1.3.4.1, is the only packet integrity protection currently defined and is one DWORD in size. ### 8.1.3.4.1 CRC Integrity Protection When the PIPP field in a packet is set to 11b, then the Packet Integrity Protection field in the packet is one DWORD in size and contains a 32-bit CRC computed over the previous contents of the packet (i.e., the UCIe Management Network Header and Management Protocol Specific field). Each bit of the Packet Integrity Protection field is set to the corresponding bit of the computed CRC (e.g., bit 31 of the computed CRC corresponds to bit 31 of the Packet Integrity Protection field). The 32-bit CRC required by this specification is CRC-32C (Castagnoli) which uses the generator polynomial 1EDC6F41h. The CRC is calculated using the following Rocksoft™ Model CRC Algorithm parameters: Name : "CRC-32C" Width : 32 Poly : 1EDC6F41h Init : FFFFFFFFh RefIn : True RefOut : True XorOut : FFFFFFFFh Check : E3069283h When the PIPP field in a packet is set to 11b and the CRC contained in the Packet Integrity Protection field is incorrect, then the packet is discarded. ### 8.1.3.5 Access Control The Management Network in an SiP may contain multiple Management Entities that issue requests and multiple Management Entities that expose assets (e.g., structures, keys, or memory). The UCIe Management Transport supports an access control mechanism that may be used by a Management Protocol to prevent unauthorized access to assets by Management Entities on the Management Network. Some Management Protocols have their own security architecture, so the use of the access control mechanism is Management Protocol specific. Table 8-4 shows which Management Protocols use the access control mechanism. <table> <caption>Table 8-4. Management Protocol use of Access Control Mechanism</caption> <tr> <th>Management Protocol</th> <th>Uses Access Control Mechanism</th> </tr> <tr> <td>UCIe Memory Access Protocol</td> <td>Yes</td> </tr> <tr> <td>UCIe Test and Debug Protocol</td> <td>$\mathrm { Y e s } ^ { \mathrm { a } }$</td> </tr> <tr> <td>Vendor Defined</td> <td>Vendor Defined</td> </tr> </table> a. The UCIe Test and Debug Protocol uses the UCIe Memory Access Protocol for configuration and status field accesses and as a result uses the Access Control Mechanism. The access control mechanism is based on a 7-bit security clearance group value contained in request packets. When a Management Entity emits a request packet on the Management Network, it populates the Security Clearance Group field in the packet with a value that corresponds to the security clearance group associated with the requester. When a Management Entity receives a request packet, it determines whether the asset(s) accessed by the request are allowed or prohibited by that security clearance group. A Management Entity may emit packets with different security clearance group values. How the security clearance group values that a Management Entity emits are configured or selected is beyond the scope of this specification (see Section 8.1.3.6.4.1). Although the security clearance group value is seven bits in size, an implementation may choose to restrict the number of security clearance groups. When an implementation restricts the number of security clearance groups to a value N, then security clearance group values from 0 to (N-1) are allowed, and security clearance group values from N to 127 are not allowed. Security Clearance Group 0 is dedicated for use by Security Directors (see Section 8.1.3.5.2). The method a Management Entity uses to determine whether a request packet is allowed access to an asset is shown in Figure 8-7 and consists of the following steps. 1\. The standard asset class ID or the vendor defined asset class ID of the asset being accessed by the request packet is determined. \- UCIe defines standard asset classes (see Section 8.1.3.5.1) and supports vendor defined asset classes. Each asset must map to a standard asset class, a vendor defined asset class, or both. \- Associated with each asset class is an asset class ID. The mapping associated with this step produces a standard asset class ID, a vendor defined asset class ID, or both. \- The manner and granularity in which an implementation maps assets to asset class IDs are beyond the scope of this specification and may be done as part of address decoding, tagging of assets, or some other mechanism. 2\. Each asset class ID determined in the previous step is mapped to a 256-bit access control structure. \- Associated with each asset class ID is a 128-bit Read Access Control (RAC) structure and a 128-bit Write Access Control (WAC) structure. If an asset's state is being read, then the RAC structure is selected as the access control structure. If an asset's state is being written/ modified, then the WAC structure is selected as the access control structure. o RAC and WAC structures are contained in the Access Control Capability Structure (see Section 8.1.3.6.3). o If a Management Entity does not have any assets that correspond to an asset class ID, then the RAC and WAC structures associated with that asset class ID must be hardwired to 0 (i.e., all the bits on both the RAC and WAC structures are read-only with a value of 0) so no accesses would be allowed. o If an implementation restricts the number of security clearance groups, then RAC and WAC structure bits associated with security clearance groups that are not supported must be hardwired to 0. For example, if an implementation only supports Security Clearance Groups 0 through 3, then bits 4 through 127 must be read-only with a value of 0 in all RAC and WAC structures. 3\. The bit corresponding to the security clearance group value in the request packet is examined in each access control structure determined in the previous step to determine whether access to the asset is allowed. \- The 7-bit security clearance group value in the request packet is a value from 0 to 127 and this value maps to a corresponding bit in a 128-bit access structure (e.g., security clearance group value 27 maps to access control structure bit 27). \- If a bit corresponding to the security clearance group value in an access control structure is set to one, then access to that asset is allowed by that security clearance group. If a bit corresponding to the security clearance group value in an access control structure is set to 0, then access to that asset is prohibited by that security clearance group. 4\. If access to the asset is allowed by either the standard asset class or the vendor defined asset, then access to the asset is granted and the request is processed. If access to the asset class is prohibited by both the standard asset class and a vendor defined asset class, then access to the asset is prohibited and the request is not processed. \- How a request that attempts to access a prohibited asset is handled is Management Protocol specific. If a request packet requires access to multiple assets for the request to be serviced, then Step 1 through Step 3 are performed and the request is processed only if access is granted to all assets. If access is prohibited to any asset associated with the request, then no asset is accessed by the request. <figure> <figcaption>Figure 8-7. Access Control Determination in a Responder Management Entity</figcaption> Standard Asset Class Access Table RAC0 WAC0 $\mathrm { R A C 1 }$ 127 0 WAC1 Read selects RAC Write selects WAC RAC or WAC UCIe Management Transport Packet Security Clearance Group RAC or WAC bit that { \text { Corresponsis to Sacurity } }<br>{ \text { Clearance Group } } ... RAC25 Security Clearance Group WAC25 OR Access Allowed Decode of asset being accessed (e.g., address decode) Asset (Register) Standard Asset Class ID Vendor Specific Asset Class ID Vendor Defined Asset Class Access Table RAC or WAC bit that corresponds to Security Clearance Group RAC0 WAC0 Read selects RAC Write selects WAC RAC or WAC 127 0 $\mathrm { R A C }$ RAC or WAC bit selected corresponding to Security Clearance Group WAC1 ... Management Entity Responder RACy WACy </figure> ### 8.1.3.5.1 Standard Asset Classes The objective of the standard asset classes is to provide a consistent classification of assets across chiplet implementations and applications for access control. To achieve this, it must be possible for a chiplet implementer to map chiplet assets that are accessible over the Management Network into asset classes without understanding the underlying architecture, roles, or applications associated with an SiP that uses the chiplet. Standard asset class 0 is for SiP security configuration (e.g., reading and writing the RAC and WAC structures). The remaining standard asset classes are constructed by taking the Cartesian product of a set of asset types and asset contexts and removing elements that are not applicable in practice. Asset types used to construct the standard asset class are shown in Table 8-5 and asset contexts used to construct the standard asset class are shown in Table 8-6. The standard asset classes are shown in Table 8-7. In some cases, an asset may logically map to two or more standard asset classes. For example, a memory region may contain both SiP data and chiplet data. When this occurs, the asset should be mapped to the standard asset class with the lowest ID value. In some cases, further access control granularity may be desired beyond what is offered by the standard asset classes. This granularity may be accomplished by separating the assets into different Management Elements within the chiplet. For example, a chiplet may contain two global secrets and the chiplet implementor may wish to allow one set of requesters access to the first global secret and a separate set of requesters access to the second global secret. By putting the two global assets into two different Management Elements, different security clearance groups may be given access to each global secret. In another example, a chiplet may contain an I/O controller and a memory controller and the chiplet implementor may wish to allow one security clearance group to configure the I/O controller and a different security clearance group to configure the memory controller. This granularity may be achieved by putting the I/O controller and memory controller in different Management Elements. <table> <caption>Table 8-5. Asset Types</caption> <tr> <th>Asset Type</th> <th>Description</th> </tr> <tr> <td>Persistent One-Time Secret</td> <td>Data or configuration that is persistent, one-time programmable, and considered a secret or sensitive configuration. Example: one-time programmable device secret</td> </tr> <tr> <td>Permanent Secret</td> <td>Data or configuration that is permanent and remains unchanged for the lifetime of the device and considered a secret or sensitive configuration. Example: a device secret that is permanent for the lifetime of the device</td> </tr> <tr> <td>Secret</td> <td>A secret, data, or status that may compromise a secret, or configuration that may control the exposure of a secret. Example: security key</td> </tr> <tr> <td>Permanent Denial of Service (PDOS)</td> <td>Data or configuration that could potentially cause permanent denial of service. Example: thermal, power, or voltage controls</td> </tr> <tr> <td>Sensitive</td> <td>Volatile or persistent data that should have limited exposure, status that could expose information that should have limited exposure, or configuration that may control exposure or modification of sensitive information. Examples: error injection capabilities, sensitive state machines, private memory space</td> </tr> <tr> <td>Permanent</td> <td>Data or configuration that is one-time programmable and is not sensitive or a secret. Example: general fuses</td> </tr> <tr> <td>Data</td> <td>General data or user data that is not sensitive or a secret. Example: application space</td> </tr> <tr> <td>Configuration</td> <td>General configuration that cannot be used to expose user, sensitive, or secret information.</td> </tr> <tr> <td>Status</td> <td>General status that cannot be used to expose user, sensitive, or secret information. Example: boot status</td> </tr> </table> <table> <caption>Table 8-6. Asset Contexts</caption> <tr> <th>Asset Context</th> <th>Description</th> </tr> <tr> <td>Global</td> <td>Asset associated with or which affects chiplets or SiPs produced by a manufacturer. The definition of the manufacturer is beyond the scope of the specification and may be the SiP integrator, the SiP designer, or an IP provider. All that matters is that the asset is</td> </tr> <tr> <td>SiP</td> <td>{ \text { the same in SiPs of that type \left(i.e., a global key\right). } }<br>{ \text { Asset associated with or which affects a specific SiP. .$</td> </tr> <tr> <td>Chiplet</td> <td>Asset associated with or which affects a specific chiplet.</td> </tr> <tr> <td>Partition</td> <td>$\text { Asset associated with or which affects a partition. The definition of a partition is vertior } }<br>{ \text { defined but is broadly defined as a collection of hardware resurces that act as an } } independent unit.</td> </tr> </table> <table> <caption>Table 8-7. Standard Security Asset Classes (Sheet 1 of 2)</caption> <tr> <th>Standard Security Asset Class ID</th> <th>Asset Context</th> <th>Asset Type</th> </tr> <tr> <td>0</td> <td>SiP</td> <td>SiP Security Configuration</td> </tr> <tr> <td>1</td> <td>Global</td> <td>Secret</td> </tr> <tr> <td>2</td> <td>SiP</td> <td>Persistent One-Time Secret</td> </tr> <tr> <td>3</td> <td>SiP</td> <td>Secret</td> </tr> <tr> <td>4</td> <td>$S i P$</td> <td>Permanent Denial of Service (PDOS)</td> </tr> <tr> <td>5</td> <td>SiP</td> <td>Sensitive</td> </tr> </table> <table> <caption>Table 8-7. Standard Security Asset Classes (Sheet 2 of 2)</caption> <tr> <th>Standard Security Asset Class ID</th> <th>Asset Context</th> <th>Asset Type</th> </tr> <tr> <td>6</td> <td>SiP</td> <td>Permanent</td> </tr> <tr> <td>7</td> <td>SiP</td> <td>Data</td> </tr> <tr> <td>8</td> <td>SiP</td> <td>Configuration</td> </tr> <tr> <td>9</td> <td>SiP</td> <td>Status</td> </tr> <tr> <td>10</td> <td>Chiplet</td> <td>Permanent Secret</td> </tr> <tr> <td>11</td> <td>Chiplet</td> <td>Secret</td> </tr> <tr> <td>12</td> <td>Chiplet</td> <td>Permanent Denial of Service (PDOS)</td> </tr> <tr> <td>13</td> <td>Chiplet</td> <td>Sensitive</td> </tr> <tr> <td>14</td> <td>Chiplet</td> <td>Permanent</td> </tr> <tr> <td>15</td> <td>Chiplet</td> <td>Data</td> </tr> <tr> <td>16</td> <td>Chiplet</td> <td>Configuration</td> </tr> <tr> <td>17</td> <td>Chiplet</td> <td>$\mathrm { S t a t u s }$</td> </tr> <tr> <td>18</td> <td>Partition</td> <td>Permanent Secret</td> </tr> <tr> <td>19</td> <td>Partition</td> <td>Secret</td> </tr> <tr> <td>20</td> <td>Partition</td> <td>Permanent Denial of Service (PDOS)</td> </tr> <tr> <td>21</td> <td>Partition</td> <td>Sensitive</td> </tr> <tr> <td>22</td> <td>Partition</td> <td>Permanent</td> </tr> <tr> <td>23</td> <td>Partition</td> <td>Data</td> </tr> <tr> <td>24</td> <td>Partition</td> <td>Configuration</td> </tr> <tr> <td>25</td> <td>Partition</td> <td>Status</td> </tr> </table> ### 8.1.3.5.2 Security Director A Management Element within an SiP that may configure security parameters is designated as a Security Director. An SiP may contain multiple Security Directors. When an SiP contains multiple Security Directors, coordination between security directors is beyond the scope of this specification. The Security Clearance Group value of 0 is reserved for Security Directors and must not be used for any other purpose. The Management Director may also be a Security Director. While it is not recommended that the Management Director operate using the Security Clearance Group value reserved for Security Directors (i.e., 0) during normal operation, it is required to operate with this value during initial configuration. When and how a Management Director changes the Security Clearance Group used for transactions is beyond the scope of this specification. ### 8.1.3.6 Initialization and Configuration UCIe Management Transport initialization and configuration are performed through read and write operations using the UCIe Memory Access protocol to Management Entity fields. Management Entity fields are grouped by function into Management Capability Structures. Unless otherwise specified, Management Capability Structures and any sub-structures must be read or written as single DWORD quantities (i.e., the Length field in the UCIe Memory Access Request must be 0h which represents a data length of one DWORD). All fields in a Management Capability Structure and any sub-structures have little endian bit ordering. A Management Entity may support the UCIe Memory Access protocol (see Section 8.1.4) which exposes a 64-bit address space associated with the Management Entity containing fields that allow configuration by another Management Entity, such as the Management Director. Each chiplet must support Management Element 0. Chiplet initialization and configuration are performed through Management Element 0 using the Chiplet Capability Structure and as a result Management Element 0 must support the UCIe Memory Access protocol. A chiplet may contain other Management Entities and the number of such Management Entities is implementation specific. These additional Management Entities may support the UCIe Memory Access protocol. Figure 8-8 shows the UCIe Memory Access protocol memory map associated with a Management Entity that support the UCIe Memory Access Protocol. The contents and organization of the memory map are implementation specific except for a 64-bit Capability Directory Pointer value located at address 0. If the Management Entity implements any Management Capability Structures, then the Management Capability Directory Pointer contains the address of a Management Capability Directory. If the Management Entity does not implement any Management Capability Structures, then the Management Capability Directory Pointer contains a value of 0. The Management Capability Directory, described in Section 8.1.3.6.1, contains a list of pointers (i.e., 64-bit UCIe Memory Access protocol addresses) to Management Capability Structures supported by the Management Entity and contains a pointer (i.e., the Element ID) of the next Management Entity in the chiplet if one exists. <figure> <figcaption>Figure 8-8. Memory Map for Management Entities</figcaption> FFFF_FFFF_FFFF_FFFFh Capability Structure Capability Structure Capability Directory Capability Structure Capability Directory Pointer 0000_0000_0000_0000h </figure> The organization that all Management Capability Structures follow is shown in Figure 8-9. A Management Capability Structure is at least two DWORDs in size and may be larger. The size of a Management Capability Structure is Management Capability Structure specific. Associated with each Management Capability Structure is a Management Capability ID that identifies the capability. The list of Management Capability IDs defined by UCIe are listed in Table 8-8. <table> <caption>Figure 8-9. Management Capability Structure Organization</caption> <tr> <th rowspan="2">DWORD 0</th> <th>31 30</th> <th>+3 29 28 27 26 25</th> <th>24</th> <th>+2 23 22 21 20 19 18 17 16</th> <th>+1 15 14 13 12 11</th> <th>109876543210 +0</th> </tr> <tr> <th>Rsvd</th> <th colspan="3">Management Capability ID</th> <th>Reserved</th> <th>Ver</th> </tr> <tr> <td>...</td> <td></td> <td colspan="5">Management Capability Specific</td> </tr> </table> <table> <caption>Table 8-8. UCIe-defined Management Capability IDs</caption> <tr> <th>Management Capability ID</th> <th>Management Capability Structure Name</th> <th>Description</th> </tr> <tr> <td>0</td> <td>Chiplet</td> <td>See Section 8.1.3.6.2</td> </tr> <tr> <td>1</td> <td>Access Control</td> <td>See Section 8.1.3.6.3</td> </tr> <tr> <td>2</td> <td>UCIe Memory Access Protocol</td> <td>See Section 8.1.4.2</td> </tr> <tr> <td>3</td> <td>DFx Management Hub</td> <td>$\mathrm { S e e }$ Section 8.3.1.1</td> </tr> <tr> <td>4</td> <td>Security Clearance Group</td> <td>See Section 8.1.3.6.4</td> </tr> <tr> <td>5</td> <td>Open Drain Detection</td> <td>See Section 8.1.6</td> </tr> <tr> <td>6</td> <td>Early Firmware Download</td> <td>Section 8.4.1.2</td> </tr> <tr> <td>7</td> <td>Fast Throttle Trigger</td> <td>See Section 8.4.2.1.2.1</td> </tr> <tr> <td>8</td> <td>Fast Throttle Response</td> <td>See Section 8.4.2.1.2.2</td> </tr> <tr> <td>9</td> <td>Fast Throttle Logging</td> <td>See Section 8.4.2.1.2.3</td> </tr> <tr> <td>10</td> <td>Emergency Shutdown Trigger</td> <td>See Section 8.4.2.2.2.1</td> </tr> <tr> <td>11</td> <td>$\mathrm { E m e r g e n c y }$ Shutdown Response</td> <td>$\mathrm { S e e }$ Section 8.4.2.2.2.2</td> </tr> <tr> <td>12</td> <td>Emergency Shutdown Logging</td> <td>See Section 8.4.2.2.2.3</td> </tr> <tr> <td>13 to 12,287</td> <td>Reserved</td> <td></td> </tr> <tr> <td>12,288 { \text { to } }<br>{ 1 6 , 3 8 3 }</td> <td>Vendor defined</td> <td>See Figure 8-10</td> </tr> </table> The top 4096 Management Capability IDs are available for vendor-defined use. The organization of a Vendor Defined Management Capability Structure is shown in Figure 8-10. Bits 0 through 15 of DWORD 1 contain the UCIe-assigned identifier of the vendor that specified the Management Capability Structure. <table> <caption>Figure 8-10. Vendor Defined Management Capability Structure Organization</caption> <tr> <th rowspan="3">DWORD 0</th> <th colspan="7">+3</th> <th colspan="6">+2</th> <th>+1</th> <th colspan="3">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26 25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19 18</th> <th>17 16</th> <th>15 14 13 12 11 10 9</th> <th>8 7 6 5 4 3</th> <th>2 10</th> <th></th> </tr> <tr> <td colspan="2">Rsvd</td> <td></td> <td></td> <td colspan="7">Management Capability ID</td> <td colspan="2"></td> <td>Reserved</td> <td colspan="3">Ver</td> </tr> <tr> <td>DWORD 1</td> <td colspan="12">Management Capability Specific</td> <td></td> <td colspan="4">Vendor ID</td> </tr> <tr> <td>...</td> <td colspan="17">Management Capability Specific</td> </tr> <tr> <td></td> <td></td> <td colspan="16"></td> </tr> </table> <figure> </figure> #### 8.1.3.6.1 Management Capability Directory The Management Capability Directory provides a method for discovery of Management Capability Structures associated with a Management Entity. The structure of the Management Capability Directory is shown in Figure 8-11 and described in Table 8-9. <table> <caption>Figure 8-11. Management Capability Directory</caption> <tr> <th></th> <th colspan="2">+3 31 30 29 28 27 26 25 24</th> <th>+2 23 22 21 20 19 18 17 16 15 14</th> <th>+1 13 12 11 10 9 8</th> <th>7 6 5 4 3 2 10 +0</th> <th rowspan="3"></th> </tr> <tr> <th>DWORD 0</th> <th>Rsvd</th> <th colspan="3">Number of Capability Pointers Reserved</th> <th>Ver</th> </tr> <tr> <td>DWORD 1</td> <td colspan="3">Reserved</td> <td colspan="2">Next Management Entity ID</td> </tr> <tr> <td>DWORD 2</td> <td colspan="5" rowspan="2">Capability Pointer 0</td> <td rowspan="2"></td> </tr> <tr> <td>DWORD 3</td> </tr> <tr> <td></td> <td colspan="4">Capability Pointer 1</td> <td></td> <td></td> </tr> <tr> <td>...</td> <td colspan="4">...</td> <td></td> <td></td> </tr> <tr> <td></td> <td colspan="4">Capability Pointer N</td> <td></td> <td></td> </tr> <tr> <td></td> <td colspan="2"></td> <td colspan="2"></td> <td></td> <td></td> </tr> </table> <figure> </figure> <table> <caption>Table 8-9. Management Capability Directory Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>{ \text { Standard } }<br>{ \text { Security } } Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Ver</td> <td>$0 \left[ 7 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Capability Directory Version This field is a UCIe-defined version number that indicates the version of the capability directory. This field must be 00h in this version of the specification</td> </tr> <tr> <td>Number of Capability Pointers</td> <td>$0 \left[ 2 9 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Number of Capability Pointers { \text { This field indicates the number of Capability Pointers in the } }<br>{ \text { Capability Directory. Since the UCIemory } } { \text { Protocol must be supported in order to access tne } }<br>{ \text { Manacment Capability Directory, this field cannot be zero .$</td> </tr> <tr> <td>Next Management Entity ID</td> <td>1 [13:0]</td> <td>17</td> <td>$R O$</td> <td>Next Management Entity ID a list of Management Entities that $s u p p o r t \quad t h e \quad U C I e \quad M e m o r y \quad A c c e s s \quad P r o t o c o l \quad s t a r t i n g$ with Management Entity ID of the $\text { the chiplet that supports } }<br>{ \text { Protocol. If this is the las } } the UCIe Memory Access Management Entity in the chiplet Memory Access Protocol, then this { \text { that supports the UCIe } M }<br>{ \text { field has a value of OO00 .$ Management Entity IDs in $t h i s \quad l i s t \quad m u s t \quad b e \quad o r d e r e d \quad f r o m$ lowest to highest and may gaps). $T h e \quad M a n a g e m e n t \quad E n t i t y \quad l i s t \quad m a y \quad b e \quad v i e w e d \quad a s \quad a \quad l i s t \quad o f$ support the UCIe Memory Access Protocol contained within the chiplet with the Chiplet ID field set to 0.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. <table> <caption>Figure 8-12. Capability Pointer</caption> <tr> <th rowspan="2"></th> <th colspan="7">+3</th> <th colspan="8">+2</th> <th colspan="3">+1</th> <th colspan="2">+0</th> </tr> <tr> <th>31 30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15 14</th> <th>13</th> <th>12 11 10 9</th> <th>8 7 6 5 4 3 2 1 0</th> <th></th> </tr> <tr> <td>DWORD 0</td> <td colspan="4"></td> <td></td> <td colspan="4"></td> <td></td> <td colspan="2"></td> <td colspan="8">Capability Pointer Low</td> </tr> <tr> <td>DWORD 1</td> <td colspan="20">Capability Pointer High</td> </tr> <tr> <td></td> <td colspan="4"></td> <td></td> <td colspan="4"></td> <td></td> <td colspan="10"></td> </tr> </table> <table> <caption>Table 8-10. Capability Pointer Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Capability Pointer Low</td> <td>$0 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Capability Pointer Low Bits 0 to 31 of the 64-bit address of the first byte of the Capability Structure associated with the Capability pointed to by this Capability Pointer. A value of all 0s in both the Capability Pointer Low and High fields indicates that this is a Null Capability Pointer and should be skipped. Because capability structures must be DWORD-aligned, bits 0 and 1 must be 00b.</td> </tr> <tr> <td>Capability Pointer High</td> <td>$1 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>$B i t s \quad 3 2 \quad t o \quad 6 3 \quad o f \quad t h e \quad 6 4 - b i t \quad a d d r e s s \quad o f \quad t h e \quad f i r s t \quad b y t e \quad o f \quad t h e$ Capability Structure associated with the Capability pointed to by this Capability Pointer.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. ### 8.1.3.6.2 Chiplet Capability Structure The Chiplet Capability Structure must be implemented in Management Element 0 of each chiplet and must not be implemented in any other Management Entity in a chiplet. Figure 8-13 shows the organization of the Chiplet Capability Structure. The Chiplet Capability Structure describes the basic characteristics of the chiplet. It points to a list of Management Port Structures that describe the characteristics of chiplet Management Ports. Each Management Port Structure contains one or more Route Entries that control the routing of UCIe Management Transport packets from the Management Fabric of the chiplet out the corresponding Management Port to an adjacent chiplet in the SiP. <figure> <figcaption>Figure 8-13. Chiplet Capability Structure Organization</figcaption> Port 1 Management Port Structure Route Entry 0 Route Entry 1 Port 0 Management Port Structure Route Entry 0 Route Entry 1 Route Entry 2 Route Entry 3 Chiplet Capability Structure </figure> <table> <caption>Figure 8-14. Chiplet Capability Structure</caption> <tr> <th rowspan="2">DWORD 0</th> <th colspan="2">+3 31 30 29 28 27 26 25</th> <th>24</th> <th colspan="2">+2 23 22 21 20 19 18 17 16</th> <th>+1 15 14 13 12 11 10</th> <th colspan="2">987654321 0 +0</th> <th rowspan="2"></th> </tr> <tr> <th>Rsvd</th> <th colspan="4">Management Capability ID</th> <th>Reserved</th> <th colspan="2">Ver</th> </tr> <tr> <td>DWORD 1</td> <td colspan="4">Reserved</td> <td>CIV</td> <td colspan="3">Chiplet ID</td> <td></td> </tr> <tr> <td>DWORD 2</td> <td colspan="5">Device ID</td> <td colspan="3">Vendor ID</td> <td></td> </tr> <tr> <td>DWORD 3</td> <td colspan="6">Reserved</td> <td>CMPS</td> <td>$M P S$</td> <td></td> </tr> <tr> <td>DWORD 4</td> <td colspan="6">Management Port Structure Low</td> <td colspan="2"></td> <td></td> </tr> <tr> <td>DWORD 5</td> <td colspan="8">Management Port Structure High</td> <td></td> </tr> </table> <table> <caption>Table 8-11. Chiplet Capability Structure Fields (Sheet 1 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Ver</td> <td>0 [7:0]</td> <td>17</td> <td>$R O$</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>Management Capability ID</td> <td>$0 \left[ 2 9 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Management Capability ID This field specifies the Capability ID of this Management Capability structure. The Chiplet Capability structure has a Management Capability ID of 000h.</td> </tr> <tr> <td>Chiplet ID</td> <td>$1 \left[ 1 5 : 0 \right]$</td> <td>8</td> <td>$R W / R O$</td> <td>Chiplet ID This field is used to configure the Chiplet ID portion of the 16-bit Management Network ID associated with Management Element zero in the chiplet. A Management Network ID is partitioned into a Chiplet ID field in the upper bits and an Entity ID field in the lower bits (see Section 8.1.3.2). The lower bits of this field associated with the Entity ID portion of the Management Network ID are hardwired to 0 (i.e., RO). Since bits 0 and 1 are only associated with an Entity ID, they are always hardwired to zero. $\text { The upper bits of th }$ $\text { The upper bits of this field associated with the Chiplet } \mathrm { I D }<br>\text { portion of the Managent Network ID may be read and }<br>\text { written \left(i.e., RW\right). These upper bits must be initized witt } the Chiplet ID value associated with the chiplet. The initial value of these upper bits is all ones (i.e., 1). The value of the Chiplet ID portion of the Management $r o u t i n g \quad o n l y \quad w h e n \quad t h e \quad C h i p l e t \quad I D \quad V a l i d \left( C I V \right) f i e l d \quad i s \quad s e t \quad t o \quad 1 .$</td> </tr> <tr> <td>CIV</td> <td>1 [16]</td> <td>8</td> <td>RW</td> <td>Chiplet ID Valid When this bit is set to 1, the Chiplet ID value in the Chiplet ID field is used for UCIe Management Transport packet routing. When this bit is cleared to 0, the Chiplet ID value in the { \text { Cnlplet ID thel is uninitized; see Section 8.1.3. } 3 . 3 \text { for } }<br>{ \text { details on routing a ucie Managent Transport Packet with } }<br>{ \text { uninitialized Chinitiot ID } }</td> </tr> <tr> <td>Vendor ID</td> <td>$2 \left[ 1 5 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Vendor ID UCIe assigned identifier of the vendor that produced the chiplet.</td> </tr> <tr> <td>Device ID</td> <td>$2 \left[ 3 1 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Device $V e n d o r \quad a s s i g n e d \quad i d e n t i f i e r \quad t h a t \quad i d e n t i f i e s \quad t h e \quad t y p e \quad o f \quad c h i p l e t$ The tuple (Vendor ID, Device ID) uniquely identifies a type of chiplet.</td> </tr> <tr> <td>MPS</td> <td>3 [2:0]</td> <td>17</td> <td>$R O$</td> <td>Maximum Packet Size This field indicates the maximum UCIe Management size supported by the chiplet (see $\left. S e c t i o n \quad 8 . 1 . 3 . 1 . 2 \right) .$ 000b: 4 DWORDS 001b: 8 DWORDS 010b: { 1 6 \text { DWORD } }<br>{ 3 2 \text { DWORD } } 011b: 100b: 64 DWORDS 101b: 128 DWORDS 110b: 256 DWORDS 111b: 512 DWORDS</td> </tr> </table> <table> <caption>Table 8-11. Chiplet Capability Structure Fields (Sheet 2 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class $I D ^ { a }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td></td> <td rowspan="2">$3 \left[ 6 : 4 \right]$</td> <td rowspan="2">16</td> <td rowspan="2">RW</td> <td>Configured Maximum Packet Size This field indicates the configured maximum UCIe Management Transport packet size of the chiplet (see Section 8.1.3.1.2). \text { The Config }<br>\text { -he Maximi } Packet Size must be less than or equal to Packet Size. Setting the Configured Packet Size to a value greater than the Maximum Packet Size blocks all Management Entities in the chiplet from emitting packets. $M a n a g e m e n t \quad E n t i t i e s \quad i n \quad t h e \quad c h i p l e t \quad n e v e r \quad g e n e r a t e \quad U C I e$ Configured Packet Size.</td> </tr> <tr> <td>CMPS</td> <td>This field has no effect on how a Management Entity handles \text { receipt or a packet or transier or packets on } \mathrm { t h e }<br>\text { Management Fabric. } \text { These benaviors are only affected by }<br>\text { the Maximum Packet Size } . The initial value of this field is 001b. 000b: 4 DWORDS 001b: 8 DWORDS 010b: 16 DWORDS 011b: 32 DWORDS 100b: 64 DWORDS 101b: 128 DWORDS 110b: 256 DWORDS 111b: 512 DWORDS</td> </tr> <tr> <td>Management Port Structure Low</td> <td>$4 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>RO</td> <td>Management Port Structure Bits 0 to 31 of the 64-bit address of the first Management { \text { Port Structure. Because the Managent Port Structure } }<br>{ \text { must be DWORD-aligned, bits } 0 \text { and 1 must be 00b and ar } } ignored. If the chiplet implements zero Management Ports, then this field must be 0.</td> </tr> <tr> <td>Management Port Structure High</td> <td>$5 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>$B i t s \quad 3 2 \quad t o \quad 6 3 \quad o f \quad t h e \quad 6 4 - b i t \quad a d d r e s s \quad o f \quad t h e \quad f i r s t \quad M a n a g e m e n t$ If the chiplet implements zero Management Ports, then this field must be 0.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. #### 8.1.3.6.2.1 Management Port Structure The Management Port Structure provides a mechanism to discover and configure the characteristics of a chiplet Management Port. The structure contains Route Entries associated with the port and points to the next Management Port if one exists. <figure> <figcaption>Figure 8-15. Management Port Structure</figcaption> +3 +2 +1 +0 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 76543210 DWORD 0 Reserved Port Type Reserved Num Route Entries Reserved Ver DWORD 1 Reserved $R L$ DWORD 2 Reserved NumVCs Reserved RMT Reserved $H T$ IDT Reserved RLD LNU LU PS DWORD 3 Remote Port ID Port ID DWORD 4 Reserved Port Entity ID DWORD 5 Reserved VC Full BW Supported Rsvd BW Value Rsvd BW Units DWORD 6 Next Management Port Structure Low DWORD 7 Next Management Port Structure High DWORD 8 Route Entries </figure> <table> <caption>Table 8-12. Management Port Structure Fields (Sheet 1 of 5)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Ver</td> <td>$0 \left[ 7 : 0 \right]$</td> <td>17</td> <td>RO</td> <td>Management Port Structure Version This field indicates the version of the Management Port $M u s t \quad b e \quad 0 0 h \quad f o r \quad t h i s \quad v e r s i o n \quad o f \quad t h e \quad s p e c i f i c a t i o n .$</td> </tr> <tr> <td>Num Route Entries</td> <td>$0 \left[ 1 9 : 1 6 \right]$</td> <td>17</td> <td>RO</td> <td>Number of Route Entries This field indicates the number of Route Entries associated with this Management Port. The number of Route Entries associated with the Management Port is equal to the value in this field plus 1. A Management Port must have at least one Route Entry associated with it. A value of Oh in this field indicates one Route Entry.</td> </tr> <tr> <td>Port Type</td> <td>$0 \left[ 2 6 : 2 4 \right]$</td> <td>17</td> <td>RO</td> <td>Management Port Type This field indicates the management port type. 000b: Not Implemented (skip) 001b: UCIe Sideband { 0 1 0 b : \text { UCIe Mainban } }<br>{ 1 1 1 b : \text { Vendor Define } } Others: Reserved A value of 000b indicates that the management port is not implemented and should be skipped.</td> </tr> </table> <table> <caption>Table 8-12. Management Port Structure Fields (Sheet 2 of 5)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$R L$</td> <td>$1 \left[ 0 \right]$</td> <td>8</td> <td>$R W$</td> <td>Retrain Link Writing a 1 to this bit initiates retraining of the link associated with the Management Port. Because the UCIe Management Transport may be other protocols on the link, retraining a \text { multiplexed witn }<br>\text { port link may aff } } SiP operation. Retraining a UCIe Sideband link will also retrain the corresponding UCIe Mainband link if one exists. Retraining a link may take time to complete after this bit is written. Status in this structure does not reflect the result of a link retraining until the operation completes. The Retrain Link Done (RLD) field may be used to determine when the operation has completed. Writing a 0 to this bit has no effect on the link. Reads of this field always return a value of 0 and have no effect on the link.</td> </tr> <tr> <td>$P S$</td> <td>2 [0]</td> <td>17</td> <td>$R O$</td> <td>Port Status This field indicates the current Management Port Status. 0: Link Not Up 1: Link Up</td> </tr> <tr> <td>$L U$</td> <td>$2 \left[ 1 \right]$</td> <td>17</td> <td>RW1C</td> <td>$\ln k U D$ This field indicates whether the link has transitioned to Link Up state since the last time this bit was cleared. The initial value of this field is 0. This bit is set to 1 when the link transitions from a link not up to a link up state. { \text { When this bit transitionstions to 1, this bit remains set to } 1 }<br>{ \text { until a 1 is written to this bit } } \text { writing a 1 to this bit clear } this bit to 0. Writing a 0 to this field has no effect on this field. Writing to this field has no effect on the link.</td> </tr> <tr> <td>LNU</td> <td>2 [2]</td> <td>17</td> <td>RW1C</td> <td>Link Not Up $T h i s \quad f i e l d \quad i n d i c a t e s \quad w h e t h e r \quad t h e \quad l i n k \quad h a s \quad t r a n s i t i o n e d \quad t o$ Link The $T h i s \quad b i t \quad i s \quad s e t \quad t o \quad 1 \quad w h e n \quad t h e \quad l i n k \quad t r a n s i t i o n s \quad f r o m \quad a \quad l i n k \quad u p$ 1 { \text { When this bit transitions to to to this bit remains set to } }<br>{ \text { until a 1 is written to this bitis wititing a to this bit } c } clears this bit to 0. Writing a 0 to this field has no effect on this field. Writing to this field has no effect on the link.</td> </tr> <tr> <td>RLD</td> <td>$2 \left[ 3 \right]$</td> <td>17</td> <td>RW1C</td> <td>Retrain Link Done $L i n k \quad r e t r a i n i n g \quad s i n c e \quad t h e \quad l a s t \quad t i m e \quad t h i s \quad b i t \quad w a s \quad c l e a r e d . T h e$ { \text { This bit is set to } 1 \text { when a 1 is writen to the Retrain Link } }<br>{ \text { \left(RL\right) field and the corresponding retrain operation has } } completed. { \text { When this bit transitions to 1, this bit remains set to } 1 }<br>{ \text { until a 1 is written to this bitis wititing a 1 to this bit clears } } this bit to 0. Writing a 0 to this field has no effect on this field.</td> </tr> </table> <table> <caption>Table 8-12. Management Port Structure Fields (Sheet 3 of 5)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$I D T$</td> <td>2[8]</td> <td>17</td> <td>RW1C</td> <td>Init Done Timeout This field indicates whether an Init Done Timeout was detected since the last time this bit was cleared. The initial value of this field is 0. { \text { This bit is set to } 1 }<br>{ \text { \left(see Sertion } 8 . 2 } when an Init Done timeout is detected for details). 1 { \text { When this bit transitions to to to this bit remains set to } }<br>{ \text { until a } 1 \text { is written to this bitis wititing a to this bit cl } } clears this bit to 0. Writing a 0 to this field has no effect on this field.</td> </tr> <tr> <td>$H T$</td> <td>2[9]</td> <td>17</td> <td>RW1C</td> <td>Timeout $T h i s \quad f i e l d \quad i n d i c a t e s \quad w h e t h e r \quad a \quad H e a r t b e a t \quad T i m e o u t \quad w a s$ detected since $T h i s \quad b i t \quad i s \quad s e t \quad t o \quad 1 \quad w h e n \quad a \quad H e a r t b e a t \quad T i m e o u t \quad i s \quad d e t e c t e d$ { \text { When this bit transitions to } 1 , \text { this bit remains set to } 1 }<br>{ \text { until a 1 is written to this bit } } \text { writing a 1 to this bit clear: } $W r i t i n g \quad a \quad 0 \quad t o \quad t h i s \quad f i e l d \quad h a s \quad n o \quad e f f e c t \quad o n \quad t h i s \quad f i e l d .$ Heartbeat Timeout is implemented only on the UCIe sideband.</td> </tr> <tr> <td>RMT</td> <td>$2 \left[ 1 6 \right]$</td> <td>17</td> <td>RW1C</td> <td>Remote Management Transport This field indicates whether the remote chiplet has advertised support for management transport { \text { associated Management Port since the last time this bit } }<br>{ \text { was cleared. The initial value of this field is } 0 . } { \text { This bit is set to 1 when managen ent transport support is } }<br>{ \text { advertised by the remote chiplet associated with this } }<br>{ \text { Manaacnt Port Port \left(see Section 4.3.1.1\right). } } { \text { When this bit transitions to 1, this bit remains set to } 1 }<br>{ \text { until a 1 is written to this bitis bititing a 1 to this bit clear: } } $W r i t i n g \quad a \quad 0 \quad t o \quad t h i s \quad f i e l d \quad h a s \quad n o \quad e f f e c t \quad o n \quad t h i s \quad f i e l d .$</td> </tr> <tr> <td>Num VCs</td> <td>$2 \left[ 2 6 : 2 4 \right]$</td> <td>17</td> <td>$R O$</td> <td>Number of Virtual Channels If the Port Status field indicates that the link is up, then the value of this field indicates the number of virtual channels available on the Management Port minus 1 (i.e., a value of 0 means one VC, a value of 1 means two VCs, and so on). Because implemented virtual channels must always start at 0 and increase sequentially. A value of N in this field indicates that Virtual Channels 0 through N are available. If the Port Status field indicates that the link is not up, then this field has a value of 000b.</td> </tr> </table> <table> <caption>Table 8-12. Management Port Structure Fields (Sheet 4 of 5)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Port ID</td> <td>$3 \left[ 1 5 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Port Identifier This field indicates the chiplet's unique 16-bit identifier associated with the corresponding Management Port. Port identifiers are statically assigned by the chiplet manufacturer, never change, and need not be assigned { \text { sequentially } \left( 1 . e \right) }<br>{ \text { as outlined belo ,$ their assignment may be sparse) except UCIe mainband and sideband ports associated with the same physical connection share all port ID bits in common except bit 0. Bit 0 has a value of 0 in the mainband port identifier and a value of 1 in the corresponding sideband port identifier. For example, if a UCIe mainband port has a port identifier of N, then N is even and the UCIe sideband port associated with that mainband port is odd and has a port identifier if (N+1). The port identifier FFFFh is reserved.</td> </tr> <tr> <td>Remote Port ID</td> <td>$3 \left[ 3 1 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Remote Port Identifier This field indicates the remote chiplet unique 16-bit port $\text { Identriter assocracted with the remote wharagent Port } }<br>{ \text { \left(i.e., the Port ID of the adjacent chiplet\right). .$ The value of this field is only valid when the Port Status field indicates that the link is up; otherwise, the value of this field is FFFFh. The value of this field is obtained from the remote chiplet during management transport path negotiation (see Section 4.5.3.3.1.1).</td> </tr> <tr> <td>Port Entity ID</td> <td>$4 \left[ 1 3 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Port Entity ID $\text { This field indicates the Entity ID associated with the } }<br>{ \text { Management Port } \left( \text { see } S e c t i o n 8 . 1 . 3 . 2 \right) }</td> </tr> <tr> <td>BW Units</td> <td>$5 \left[ 2 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Port Bandwidth Units { \text { If the Port Status field indicates that the link is up, then } }<br>{ \text { this field indicates the units associated with the BW Valu } } field. Support for port bandwidth reporting is optional. 000b: Port bandwidth not reported 001b: KB/s 010b: MB/s 011b: GB/s { \text { 100b: } 1 B / s }<br>{ \text { Others: Reserve } } If the port Status field indicates that the link is not up or port bandwidth reporting is not supported, then this field has a value of 000b.</td> </tr> <tr> <td>BW Value</td> <td>$5 \left[ 1 3 : 4 \right]$</td> <td>17</td> <td>RO</td> <td>Port Bandwidth Value If the Port Status field indicates that the link is up, then this field indicates the maximum port bandwidth value. The units associated with the value are specified by the BW Units field. If the port bandwidth may change (e.g., because a chiplet port supports multiple link speeds), then this field reflects the current port bandwidth. Support for port bandwidth reporting is optional. If the port Status field indicates that the link is not up or port bandwidth reporting is not supported, then this field has a value of 000h.</td> </tr> </table> <table> <caption>Table 8-12. Management Port Structure Fields (Sheet 5 of 5)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>VC Full BW Supported</td> <td>$5 \left[ 2 3 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Virtual Channel Full Bandwidth Supported Each bit in this field corresponds to a virtual channel. If the Port Status field indicates that the link is up and NUM VCs field indicates that a virtual channel is available, then a value of 1 in the bit corresponding to the virtual channel indicates that the virtual channel supports full link the BW Value field from the $a d j a c e n t \quad c h i p l e t \quad t o \quad t h i s \quad c h i p l e t . A \quad v a l u e \quad o f \quad 0 \quad i n \quad t h e \quad b i t$ virtual channel does not support the adjacent chiplet to this chiplet. Whether full link bandwidth is supported from this chiplet to the adjacent chiplet may be determined from the Management Port Structure in the adjacent chiplet. { \text { If the Port Status field indicates that the link is not up, } }<br>{ \text { then none of the virtual chanels associated with the port ,$ are available. $I f \quad a \quad v i r t u a l \quad c h a n n e l \quad i s \quad n o t \quad a v a i l a b l e , t h e n \quad t h e \quad v a l u e \quad o f \quad t h e$</td> </tr> <tr> <td>Next Management Port Structure Low</td> <td>$6 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Next Management Port Structure Low Bits 0 to 31 of the 64-bit address of the first byte of the $\text { next Managenent Port Structure. Because Managent } }<br>{ \text { Port Structures must be DWORD-aligned, bits 0 and 1 } } must be 00b. A value of all 0s in both the Management Port Structure Low and High fields indicates that there are no more</td> </tr> <tr> <td>Next Management Port Structure High</td> <td>7 [31:0]</td> <td>17</td> <td>RO</td> <td>$N e x t \quad M a n a g e m e n t \quad P o r t \quad S t r u c t u r e \quad H i g h$ Bits 32 to 63 of the 64-bit address Management Port Structure. A value of all Os in both the \text { Management Port Structure Low Lond High fields indicate }<br>\text { that there are no more Management Port Structures. .$</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. #### 8.1.3.6.2.2 Route Entry A Route Entry is used to specify a route from the Management Fabric within a chiplet out the Management Port associated with the Route Entry. The TC Select field selects traffic classes that are filtered out from matching a Route Entry. A Route Entry may specify a normal route or a default route. The type of route is determined by the RT field. While the Chiplet ID and Entity ID size of chiplets may vary in an SiP, all Route Entry matching associated with a chiplet is performed using the Chiplet ID size of that chiplet. Packet Route Entry matching is performed as follows. . If a Route Entry has the Route Type field set to Normal Route, then a packet matches the Route Entry when all the following are true: \- The link is up, \- The packet is associated with a traffic class that has the corresponding bit of the TC Select field in the Route Entry set to 1, \- The Chiplet ID portion (using the Chiplet ID width for this chiplet) of the packet's Destination ID field is greater than or equal to the value in the Base ID field, and \- The Chiplet ID portion (using the Chiplet ID width for this chiplet) of the packet's Destination ID field is less than or equal to the value in the Limit ID field. . If a Route Entry has the Route Type field set to Default Route, then a packet matches the route when all the following are true: \- The link is up, \- The packet is associated with a traffic class that has the corresponding bit of the TC Select field in the Route Entry set to 1, and \- The packet does not match any other Route Entry within the chiplet. If a packet on the Management Fabric of a chiplet matches the route specified by the Route Entry, then the packet is transmitted out the Management Port associated with the Route Entry. The virtual channel used by the packet is specified by the VC ID field in the matching Route Entry. Route Entries associated with the Management Ports on either side of a point-to-point link that interconnects two chiplets may be configured differently. This means that the TC-to-VC mapping in each direction on the link may be different. <table> <caption>Figure 8-16. Route Entry</caption> <tr> <th></th> <th colspan="2">+3 31 30 29 28 27 26 25 24</th> <th>+2 23 22 21 20 19 18 17 16</th> <th colspan="2">+1 15 14 13 12 11</th> <th></th> <th>109876543210 +0</th> <th rowspan="2"></th> </tr> <tr> <td>DWORD 0</td> <td>TC Select</td> <td></td> <td>Reserved</td> <td>RT</td> <td>Reserved</td> <td>VC ID</td> <td>Ver</td> </tr> <tr> <td>DWORD 1</td> <td colspan="3">Limit ID</td> <td colspan="2"></td> <td colspan="2">Base ID</td> <td></td> </tr> </table> <figure> </figure> <table> <caption>Table 8-13. Route Entry Fields (Sheet 1 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Ver</td> <td>$0 \left[ 7 : 0 \right]$</td> <td>8</td> <td>$R O$</td> <td>Route Entry Version This field indicates the version of the Route Entry. Must be 0h in this version of the specification</td> </tr> <tr> <td>VC ID</td> <td>$0 \left[ 1 0 : 8 \right]$</td> <td>8</td> <td>RW</td> <td>Virtual Channel ID This field selects the Virtual Channel (VC) used by packets that match this Route Entry. The default value of this field is 0 which maps all selected traffic classes onto VC0.</td> </tr> <tr> <td>RT</td> <td>$0 \left[ 1 5 \right]$</td> <td>8</td> <td>RW</td> <td>Route Type This field selects the routing type of this Route Entry. 0: Normal Route 1: Default Route The default value of this field is 0.</td> </tr> </table> <table> <caption>Table 8-13. Route Entry Fields (Sheet 2 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>TC Select</td> <td>$0 \left[ 3 1 : 2 4 \right]$</td> <td>8</td> <td>RW</td> <td>$T h i s \quad f i e l d \quad s e l e c t s \quad w h i c h \quad t r a f f i c \quad c l a s s e s \quad m a y \quad m a t c h \quad t h i s$ Route Entry. A packet's traffic Classes (TC) in the packet header. $\text { Each bit in this fiela } }<br>{ \text { Each bin th th TC0 } } corresponds to a traffic class (i.e., bit 0 bit 1 to TC1, and so on). If a bit in this field is set to 0, then packets with the associated traffic class are filtered out from matching the route specified by the Route Entry. If a bit in this field is set to 1, then $\mathrm { p a c k e c t s } \mathrm { w i n } _ { F }$ the associated traffic class are considered for the route specified by the Route Entry. The default value of this field is 0 which filters out all traffic classes.</td> </tr> <tr> <td>Base ID</td> <td>1 [15:0]</td> <td>8</td> <td>$R W / R O$</td> <td>Base ID This field contains the Base ID value of the Chiplet ID associated with this Route Entry. This field contains a 16-bit Management Network ID. The Management Network ID is partitioned into a Chiplet ID field in the upper bits and an Entity ID field in the lower bits (see Section 8.1.3.2). The lower bits of this field associated with the Entity ID portion of the Management Network ID are hardwired to 0 (i.e., RO). Since bits 0 and 1 are only associated with an Entity ID, they are always hardwired to zero. The upper bits of this field associated with the Chiplet ID portion of the Management Network ID may be read and written (i.e., RW). These upper bits must be initialized with the Chiplet ID value associated with the Base ID. The initial value of these upper bits is all ones (i.e., 1).</td> </tr> <tr> <td>Limit ID</td> <td>$1 \left[ 3 1 : 1 6 \right]$</td> <td>8</td> <td>RW/RO</td> <td>Limit ID \text { This field contains the Limit ID value of the Chiplet ID }<br>\text { associated with this Route Entry. } This field contains a 16-bit Management Network ID. The \text { Management Network ID is partitioned into a Chiplet ID }<br>\text { field in the upper bits and an Entity ID field in the lower }<br>\text { bitc } \left( \text { see lsen Serion } 8 1 3 \right) \text { The lower bits of this field associated with the Entity ID }<br>\text { portion of the Management Network ID are hardwired to } 0 (i.e., RO). The upper bits of this field associated with the Chiplet ID portion of the Management Network ID may be read and written (i.e., RW). These upper bits must be initialized with the Chiplet ID value associated with the Base ID. The initial value of these upper bits is all 0s. If the Base ID is greater than the Limit ID, then the Route Entry is disabled.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. ### 8.1.3.6.3 Access Control Capability Structure A Management Entity must support the access control mechanism outlined in Section 8.1.3.5 and must implement the Access Control Capability Structure described in this section. The Access Control Capability Structure provides access to the Read Access Control (RAC) and Write Access Control (WAC) structures associated with asset classes contained in the Management Entity. The organization of the Access Control Capability Structure is shown in Figure 8-17. It consists of a 10-DWORD header that contains a pointer to the standard asset class access table and the vendor defined asset class access table. The standard and vendor defined asset access class tables consists of a sequence of 128-bit (4- DWORD) RAC and 128-bit (4-DWORD) WAC structure pairs. The number of RAC/WAC structure pairs in the standard asset class access table is equal to 26 (i.e., the number of standard asset class IDs) and the number of RAC/WAC structure pairs in the vendor defined asset class access table corresponds to the number of vendor defined asset classes. The fields in the 4-DWORD RAC and WAC structures are described in Table 8-15 and Table 8-16, respectively. <table> <caption>Figure 8-17. Access Control Capability Structure</caption> <tr> <th></th> <th colspan="2">+3 31 30 29 28 27 26 25 24</th> <th>+2 23 22 21 20 19 18 17</th> <th>16</th> <th rowspan="2">+1 15 14 13 12 11 10 9 8 Rsvd Max Security Clearance Group Supported</th> <th>7 6 5 4 3 2 10 +0</th> <th></th> </tr> <tr> <th>DWORD 0</th> <th>Rsvd</th> <th colspan="3">Management Capability ID</th> <th>Ver</th> <th></th> </tr> <tr> <td>DWORD 1</td> <td colspan="5">Reserved Standard Asset Class Supported</td> <td></td> <td></td> </tr> <tr> <td>DWORD 2</td> <td colspan="6">Reserved</td> <td></td> </tr> <tr> <td>DWORD 3</td> <td colspan="6">Reserved</td> <td></td> </tr> <tr> <td>DWORD 4</td> <td colspan="5">Number of Vendor Specific Asset Classes</td> <td></td> <td></td> </tr> <tr> <td>DWORD 5</td> <td colspan="5">Reserved</td> <td></td> <td></td> </tr> <tr> <td>DWORD 6</td> <td colspan="5">Standard Asset Class Access Table Low</td> <td></td> <td></td> </tr> <tr> <td>DWORD 7</td> <td colspan="5">Standard Asset Class Access Table High</td> <td></td> <td></td> </tr> <tr> <td>DWORD 8</td> <td colspan="5">Vendor Specific Asset Class Access Table Low</td> <td></td> <td></td> </tr> <tr> <td>DWORD 9</td> <td></td> <td colspan="5">Vendor Specific Asset Class Access Table High</td> <td></td> </tr> </table> <figure> </figure> <table> <caption>Table 8-14. Access Control Capability Structure Fields (Sheet 1 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Ver</td> <td>0 [7:0]</td> <td>17</td> <td>$R O$</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>Max Security $C l e a r a n c e \quad G r o u p$ Supported</td> <td>$0 \left[ 1 4 : 8 \right]$</td> <td>17</td> <td>$R O$</td> <td>Max Security Clearance Group Supported This field specifies the maximum security clearance group value supported. A value of N in this field indicates that security clearance group values 0 through N are supported. If this capability structure is implemented, then security clearance group 0 must be supported. If the { \text { nber of security clearance groups is not } }<br>{ \text { then } N \text { is eaural to } 1 2 7 } restricted,</td> </tr> <tr> <td>Management Capability ID</td> <td>$0 \left[ 2 9 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Management Capability ID This field specifies the Capability ID of this Management Capability structure. The Access Control Capability structure has a Management Capability ID of 001h.</td> </tr> <tr> <td>Standard Asset Class Supported</td> <td>$1 \left[ 2 5 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Standard Asset Class Supported Each bit in this field represents an asset class ID (see Table 8-5 and Table 8-7). $I f \quad a \quad b i t \quad i n \quad t h i s \quad f i e l d \quad i s \quad s e t \quad t o \quad 1 , t h e n \quad t h e \quad a s s e t \quad c l a s s$ $I f \quad a \quad b i t \quad i n \quad t h i s \quad f i e l d \quad i s \quad s e t \quad t o \quad 0 , t h e n \quad t h e \quad a s s e t \quad c l a s s$ corresponding to is not supported.</td> </tr> </table> <table> <caption>Table 8-14. Access Control Capability Structure Fields (Sheet 2 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class $I D ^ { a }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Number of Vendor Defined Asset Classes</td> <td>$4 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Number of Vendor Defined Asset Classes This field indicates the number of vendor defined asset classes. A value of all 0s in this field indicates that no vendor defined asset classes are supported.</td> </tr> <tr> <td>Standard Asset<br>Class Access Table Low</td> <td>$6 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Standard Asset Class Access Table Low Bits 0 to 31 of the 64-bit address of the base address of the Standard Asset Class Table. Because the Standard Asset Class Access Table must be DWORD-aligned, bits 0 and 1 must be 00b.</td> </tr> <tr> <td>Standard Asset Class Access Table High</td> <td>$7 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Standard Asset Class Access Table High Bits 32 to 63 of the 64-bit address of the base address of the Standard Asset Class Table.</td> </tr> <tr> <td>Vendor Defined<br>Asset Class Access Table Low</td> <td>$8 \left\lceil 3 1 : 0 \right\rceil$</td> <td>17</td> <td>$R O$</td> <td>Vendor Defined Asset Class Access Table Low Bits 0 to 31 of the 64-bit address of the base address of the Vendor Defined Asset Class Table. Because the Vendor Defined Asset Class Access Table must be DWORD-aligned, bits 0 and 1 must be 00b. A value of zero in the Vendor Defined Asset Class Access Table Low and High fields indicates that there is no Vendor Defined Asset Class Access Table.</td> </tr> <tr> <td>Vendor Defined Asset Class Access Table High</td> <td>$9 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Vendor Defined Asset Class Access Table High Bits 32 to 63 of the 64-bit address of the base address of the Vendor Defined Asset Class Table. A value of zero in the Vendor Defined Asset Class Access Table Low and High fields indicates that there is no Vendor Defined Asset Class Access Table.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. Figure 8-18. Standard Asset Class Access Table <figure> </figure> <table> <caption>Figure 8-19. Vendor Defined Asset Class Access Table</caption> <tr> <th rowspan="2"></th> <th colspan="6">+3</th> <th colspan="2"></th> <th></th> <th colspan="7">+2</th> <th colspan="7">+1</th> <th></th> <th></th> <th colspan="6">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th>8</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th>3</th> <th>2 1 0</th> <th></th> </tr> <tr> <td>DWORD 0</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 1 DWORD 2</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>RAC0</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 3</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 4</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 5 DWORD 6</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>WAC0</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 7</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td rowspan="2"></td> </tr> <tr> <td>...</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>...</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 200</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 201</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 202</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>RAC25</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 203</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 204</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 205</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 206</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>WAC25</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td rowspan="2">DWORD 207</td> <td rowspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </table> <figure> +3 +2 +1 +0 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 10 DWORD 0 DWORD 1 DWORD 2 RAC0 DWORD 3 DWORD 4 DWORD 5 DWORD 6 WAC0 DWORD 7 ... ... DWORD 8x DWORD 8x+1 DWORD 8x+2 RACx $D W O R D \quad 8 x + 3$ DWORD 8x+4 DWORD 8x+5 DWORD 8x+6 WACx DWORD 8x+7 \* The x in RACx/WACx corresponds to the number of vendor specific asset classes minus one (i.e., the first vendor specific asset class corresponds to RACO/WACO, the second vendor specific asset class corresponds to RAC1/WAC1, and so on). </figure> <table> <caption>Table 8-15. Read Access Control (RAC) Structure Field Description</caption> <tr> <th>Field Name</th> <th>DWORDª &amp; Bit Location</th> <th>Standard Security Asset Class IDb</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>RACx_SD</td> <td>$8 \times \left[ 0 \right]$</td> <td>0</td> <td>$R W / R O$</td> <td>Read Access Control Security Director This bit provides access control for the Security Director. If this bit is 1, then Security Director read accesses to assets in the Management Entity of the type associated with this RAC structure are allowed. If this bit is 0, then Security Director read accesses to assets in the Management Entity of the type associated with this RAC structure are not allowed. The initial value of this bit is 1. If the Management Entity contains no assets associated { \text { with the access class correspondin } }<br>{ \text { then this field is hard wired to } 0 } to this RAC structure,</td> </tr> <tr> <td>$\mathrm { R A C } x L$</td> <td>$8 \times \left[ 3 1 : 1 \right]$</td> <td>0</td> <td>RW/RO</td> <td>Read Access Control Lower Lower { \text { This field provides access control for Security Clearance } }<br>{ \text { Groups 1 through } 3 1 . \text { Bit } x \text { corresponds to Security } } Clearance Group x. If a bit is 1, then read accesses with the corresponding clearance group to assets in the Management Entity of the this RAC structure are allowed. If this { \text { type associated wi } }<br>{ \text { bit is } 0 , \text { then read } } accesses with the corresponding clearance group to assets in the Management Entity of the type associated with this RAC structure are not allowed. The initial value of each bit in this field is 0. If { \text { with the access class corresponding to this this RAC stucture } }<br>{ \text { then this field is hard wired to } 0 . 0 ,$ $c l e a r a n c e \quad g r o u p \quad a s s o c i a t e d \quad w i t h \quad a \quad b i t \quad i n \quad t h i s \quad f i e l d , t h e n \quad t h e$</td> </tr> <tr> <td>RACx_LM</td> <td>$8 x + 1 \left[ 3 1 : 0 \right]$</td> <td>0</td> <td>$R W / R O$</td> <td>Read Access Control Lower Middle This field provides access control for Security Clearance Groups 32 through 63. Bit x corresponds to Security $S e e \quad R A C x \_ L L \quad f o r \quad a \quad d e s c r i p t i o n \quad o f \quad t h i s \quad f i e l d .$ The initial value of each bit in this field is 0.</td> </tr> <tr> <td>RACx_UM</td> <td>$8 x + 2$ [31:0]</td> <td>0</td> <td>$R W / R O$</td> <td>Read Access Control Upper Middle control for Security Clearance $G r o u p s \quad 6 4 \quad t h r o u g h \quad 9 5 . B i t \quad x \quad c o r r e s p o n d s \quad t o$ Security $\mathrm { S e e } R A C x$ a description of this field. The initial value of each bit in this field is 0.</td> </tr> <tr> <td>RACx_UU</td> <td>$8 x + 3 \left[ 3 1 : 0 \right]$</td> <td>0</td> <td>RW/RO</td> <td>Read Access Control Upper Upper $\text { This field provides access control for Security Clearanct } }<br>{ \text { Groups 96 through } 1 2 7 . \text { Bit } x \text { corresponds to Security } } Group (x + 96). See RACx_LL for a description of this field. The initial value of each bit in this field is 0.</td> </tr> </table> a. DWORD in this table refers to the DWORD offset into asset class access table for RACx. For example, the 128-bit RAC2 structure is at DWORD offsets 16, 17, 18, and 19. b. See Table 8-7 for a description of Standard Security Asset Class IDs. <table> <caption>Table 8-16. Write Access Control (WAC) Structure Field Description</caption> <tr> <th>Field Name</th> <th>DWORDª &amp; Bit Location</th> <th>Standard Security Asset Class IDb</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$\mathrm { W A C x } \mathrm { S D }$</td> <td>$8 x + 4 \left[ 0 \right]$</td> <td>0</td> <td>RW</td> <td>Write Access Control Security Director This bit provides access control for the Security Director. { \text { If this bit is } 1 , \text { then Security Director write accsses to } }<br>{ \text { assets in the Management Entity of the the the hssociated } } with this WAC structure Security Director write accesses to assets in the Management Entity of the type associated with this WAC structure are not allowed. The initial value of this bit is 1. If the Management Entity contains no assets associated { \text { with the access class correspondin } }<br>{ \text { then this field is hard wired to } 0 } to this WAC structure,</td> </tr> <tr> <td>WACx_LL</td> <td>$8 x + 4$ [31:1]</td> <td>0</td> <td>RW</td> <td>Write Access Control Lower Lower { \text { This field provides access control for Security Clearance } }<br>{ \text { Groups 1 through } 3 1 . \text { Bit } x \text { corresponds to Security } } Clearance Group x. If a bit is 1, then write accesses with the corresponding clearance group to assets in the Management Entity of the type associated with this WAC structure are allowed. If this bit is 0, then write accesses with the corresponding clearance group to assets in the Management Entity of the type associated with this WAC structure are not allowed. The initial value of each bit in this field is 0. { \text { with the access class corresponding to this this whactar statie } }<br>{ \text { then this field is hard wired to } 0 . 0 ,$ $\text { If the Managenent Entity does not support the security } }<br>{ \text { clearance group associated with a bit in this finid, then then then the } }<br>{ \text { bit is hardwired to } 0 . }</td> </tr> <tr> <td>$\mathrm { W A C x } L M$</td> <td>$8 x + 5 \left[ 3 1 : 0 \right]$</td> <td>0</td> <td>RW</td> <td>Write Access Control Lower Middle This field provides access control for Security Clearance Groups 32 through 63. Bit x corresponds to Security Clearance Group $\left( x + 3 2 \right) .$ See WACx_LL for a description of this field. The initial value of each bit in this field is 0.</td> </tr> <tr> <td>WACx_UM</td> <td>$8 x + 6$ [31:0]</td> <td>0</td> <td>RW</td> <td>Write Access Control Upper Middle Clearance { \text { Groups } 6 4 \text { through } 9 5 . \text { Bit } x \text { corresponds to se } }<br>{ \text { Clearance Group } \left( x + 6 4 \right) . } Security See WACx_LL for a description of this field. The initial value of each bit in this field is 0.</td> </tr> <tr> <td>WACx_UU</td> <td>$8 x + 7 \left[ 3 1 : 0 \right]$</td> <td>0</td> <td>RW</td> <td>Write Access Control Upper Upper This field provides access control for Security Clearance Groups 96 through 127. Bit x corresponds to Security Clearance Group (x + 96). See WACx_LL for a description of this field. The initial value of each bit in this field is 0.</td> </tr> </table> a. DWORD in this table refers to the DWORD offset into asset class access table for WACx. For example, the 128-bit WAC2 structure is at DWORD offsets 20, 21, 22, and 23. b. See Table 8-7 for a description of Standard Security Asset Class IDs. ### 8.1.3.6.4 Security Clearance Group Capability Structure The Security Clearance Group Capability Structure allows a Security Director to configure the Security Clearance Group value used by a Management Entity when issuing Management Transport requests. This capability structure must be implemented by a Management Entity that is the ultimate source of UCIe Management Transport request packets (i.e., emits request packets) and is not required to be implemented by any other Management Entity. In some cases, a Management Entity may need to issue requests with different Security Clearance Group values when operating in different contexts. The Security Clearance Group Capability Structure supports multiple Security Clearance Group Contexts to allow a Security Director to configure a Security Clearance Group value for each context. How a Security Director determines the manageability functions provided by these contexts and what Security Clearance Group value should be used is beyond the scope of this specification. Figure 8-20. Security Clearance Group Capability Structure <figure> +3 +2 +1 +0 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 76543210 DWORD 0 Rsvd Management Capability ID Reserved Ver DWORD 1 Reserved Num Security Clearance Group Contexts DWORD 2 Reserved DWORD 3 Reserved DWORD 4 Security Clearance Group Contexts </figure> <table> <caption>Table 8-17. Security Clearance Group Capability Structure Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Ver</td> <td>0 [7:0]</td> <td>17</td> <td>$R O$</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>Management Capability ID</td> <td>$0 \left[ 2 9 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Management Capability ID This field specifies the Capability ID of this Management Capability structure. { \text { The Security Clearance Group Capablity structure has } }<br>{ \text { Manactnent Capability ID of } 0 0 4 h } a</td> </tr> <tr> <td>Num Security Clearance Group Contexts</td> <td>1 [7:0]</td> <td>17</td> <td>$R O$</td> <td>Number of Security Clearance Group Contexts This field indicates the number of Security Clearance Group Contexts associated with this Management Entity. The number of Security Clearance Groups Contexts associated with this Management Entity is equal to the value in this field plus 1. { \text { A Management Entity that implements this capability } }<br>{ \text { structure must have at least one Security Clearance Group } } Context.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. ## 8.1.3.6.4.1 Security Clearance Group Context <table> <caption>Figure 8-21. Security Clearance Group Context</caption> <tr> <th rowspan="3">DWORD 0</th> <th colspan="5">+3</th> <th colspan="6">+2</th> <th colspan="3">+1</th> <th colspan="3">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28 27 26 25</th> <th>24</th> <th>23 22 21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14 13 12 11 10 9</th> <th>8</th> <th>7</th> <th>6 5 4 3 2 1 0</th> <th></th> </tr> <tr> <td>En</td> <td colspan="4"></td> <td colspan="9">Reserved</td> <td></td> <td>Security Clearance Group</td> <td></td> </tr> <tr> <td>DWORD 1</td> <td colspan="14">Reserved</td> <td colspan="2"></td> <td></td> </tr> <tr> <td colspan="15"></td> <td colspan="3"></td> </tr> </table> <table> <caption>Table 8-18. Security Clearance Group Context Fields</caption> <tr> <th>Field Name</th> <th>DWORD&amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Security Clearance Group</td> <td>$0 \left[ 6 : 0 \right]$</td> <td>0</td> <td>RW</td> <td>Security Clearance Group This field is configured by the Security Director with the Security Clearance Group value used by the Management Entity when issuing a request. The initial value of this field is 7Fh if this context is not associated with a Security Director. The initial value of this field is 00h if this context is associated with a Security Director.</td> </tr> <tr> <td>$E n$</td> <td>$0 \left\lceil 3 1 \right\rceil$</td> <td>0</td> <td>RW</td> <td>Request Enable When this field is set to 1 the Management Entity may issue requests associated with this security clearance group context. When this field is set to 0 the Management Entity must not issue requests associated with this security clearance group context. The initial value of this field is 0 if this context is not associated with a Security Director. The initial value of this field is 1 if this context is associated with a Security Director.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. ## 8.1.4 UCIe Memory Access Protocol The UCIe Memory Access Protocol provides read and write access to memory mapped structures and memory associated with a Management Entity that supports the UCIe Memory Access Protocol. A Management Entity exposes a 64-bit address space. The relationship of this address space to a system or I/O address map is beyond the scope of this specification. The address space associated with a Management Entity may be local to that Management Entity or shared across one or more Management Entities in a chiplet. For example, the same address in two Management Entities may reference the same memory location or different memory locations (e.g., a memory location associated with each Management Entity). A Management Entity may have some addresses that are local and some that are shared. For shared addresses, how concurrent accesses, security, and mutual exclusion are handled is beyond the scope of this specification. The UCIe Memory Access Protocol utilizes the UCIe Management Transport access control mechanism (see Section 8.1.3.5). ### 8.1.4.1 UCIe Memory Access Protocol Packets This section describes UCIe Memory Access Protocol packets. These packets are carried by the UCIe management transport. #### 8.1.4.1.1 UCIe Memory Request Packet Memory request packets are issued by a Management Entity to read or write memory mapped structures or memory in another Management entity. The Opcode field indicates the type of operation. When a UCIe Management Transport packet carries a UCIe Memory Request, the Resp field is set to 0 corresponding to a request packet. UCIe Memory Request packet operations are non-posted. If a UCIe Management Transport packet that carries a UCIe Memory Request packet is not discarded, then a UCIe Memory Response packet is sent in response. A Management Entity may issue requests on an ordered or unordered traffic class when the Unordered Traffic Class Enable (UE) bit is set to 1 in the UCIe Memory Access Protocol capability structure. When the UE bit is cleared to 0, then the Management Entity may only issue requests on an ordered traffic class and must not issue requests on an unordered traffic class. Whether a Management Entity utilizes an unordered traffic class is implementation specific. The Tag field in a UCIe Memory Request packet is an 8-bit field populated by the requester, carried in a request packet, and returned by the responder in the corresponding response packet if one is generated. A requester may have multiple outstanding requests with the same Tag field value to the same or different responders. The responder must not assume that Tag field values are unique and must not in any way interpret the Tag field value. The use of the Tag field is requester implementation specific and may be used for applications such as mapping responses to previously issued requests; determining the responder associated with a response packet; and detecting lost, dropped, or discarded packets. The maximum number of requests that a requester may have outstanding is requester implementation specific. Figure 8-22 shows the fields of a UCIe Memory Access Request packet. Reserved fields (i.e., ones labeled as Rsvd) must be filled with all 0s when the packet is formed. Reserved fields must be forwarded unmodified on the Management Network and ignored by receivers. An implementation that relies on the value of a reserved field in a packet is non-compliant. <figure> <figcaption>Figure 8-22. UCIe Memory Access Request Packet Format</figcaption> +0 +1 +2 +3 76543210765432107654321076543210 DWORD 2 Rsvd Opcode Length Last DW BE First DW BE Tag DWORD 3 Address[63:32] DWORD 4 Protocol Specific Address[31:2] Rsvd IPA DWORD 5 Data (Optional) DWORD M </figure> Table 8-19 defines the fields of a UCIe Memory Access Request packet. The packet starts at DWORD 2 because DWORDs 0 and 1 contain the UCIe Management Transport packet header. All fields in the table have little endian bit ordering, similar to Figure 8-5 (e.g., Address bits 32 through 39 are in Byte 3 bits 7 through 0 of DWORD 3, and Address bits 40 through 47 are in Byte 2 bits 7 through 0 of DWORD 2 and so on). <table> <caption>Table 8-19. UCIe Memory Access Request Packet Fields</caption> <tr> <th>Field Name</th> <th>Field Size</th> <th>Description</th> </tr> <tr> <td>Tag</td> <td>8 bits</td> <td>Tag This field contains the value of the tag field of the corresponding memory access request.</td> </tr> <tr> <td>First DW BE</td> <td>4 bits</td> <td>First Data DWORD Byte Enable This field contains byte enables for the first (or only) DWORD referenced. A value of 0 indicates that the corresponding byte is not enabled and a value of 1 indicates that the corresponding byte is enabled. Bit 0 corresponds to Byte 0. $B i t \quad 1 \quad c o r r e s p o n d s \quad t o \quad B y t e \quad 1 .$ 2. Bit 3 corresponds to Byte 3.</td> </tr> <tr> <td>Last DW BE</td> <td>4 bits</td> <td>Last Data DWORD Byte Enable This field contains byte enables for the last DWORD referenced. If the LENGTH field has a value of 0, then this field must be 0000b. the corresponding byte is not enabled and a value of 1 { \text { A value of } 0 \text { indicates that } t }<br>{ \text { indicates that the correspor } } byte is enabled. 0 corresponds to Byte 0. { \text { Bit } 1 \text { corresponds to Byte } 1 }<br>{ \text { Bit } 2 \text { corresponds to Byte } 2 .$ Bit 3 corresponds to Byte 3.</td> </tr> <tr> <td>Length</td> <td>8 bits</td> <td>Data Length This field indicates the length of data referenced in DWORDs. The length of the packet in DWORDs is equal to the value of this field plus 1 (e.g., a value of 00h in this field indicates a packet length of one DWORD, a value of 01h in this field indicates a packet length of two DWORDs, and so on).</td> </tr> <tr> <td>Opcode</td> <td>4 bits</td> <td>Opcode This field indicates the memory access request operation. 0000b: Reserved (used for responses) 0001b: Memory Read (MemRd) 0010b: Memory Write (MemWr) $\mathrm { O t h e r s } :$ Reserved</td> </tr> <tr> <td>Address</td> <td>62 bits</td> <td>Address This field contains the DWORD address being referenced in the Management Entity.</td> </tr> <tr> <td>IPA</td> <td>1 bit</td> <td>$T h i s \quad b i t \quad i n d i c a t e s \quad w h e t h e r \quad a c c e s s e s \quad t o \quad p r o h i b i t e d \quad a s s e t s \quad s h o u l d \quad b e \quad i g n o r e d . W h e n$ completes successfully. The value of this bit is determined by the requester and should not be set to 1 during normal operation because doing so would cause access violations to not be reported in the Response Status. 0: Do not ignore access to prohibited assets 1: Ignore accesses to prohibited assets</td> </tr> <tr> <td>Data</td> <td>Varies</td> <td>Data This field is present in Memory Write requests and contains the data being written. This field is not present in Memory Read requests.</td> </tr> </table> #### 8.1.4.1.2 UCIe Memory Access Response Packet A UCIe Memory Access Response packet is generated by a Management Entity when the processing associated with a UCIe Memory Access Request packet completes. When a UCIe Management Transport packet carries a UCIe Memory Response, the Resp field is set to 1 corresponding to a response packet. A UCIe Memory Access Protocol responder must always support UCIe Memory Request packets on all traffic classes (TC). The traffic class of a UCIe Memory Access Response packet is the same as the traffic class used in the corresponding UCIe Memory Access Request packet. As described in Section 8.1.3.1.1, each traffic class is a unique ordering domain. There are no ordering guarantees for UCIe Memory Request packets in different traffic classes. Within an ordered traffic class, UCIe Memory Request packets are delivered in-order between a requester and a responder and UCIe Memory Response packets are delivered in-order between a responder and the requester. There are no ordering guarantees between requests to different responders and there are no ordering guarantees between responses from different responders to a requester. Within an unordered traffic class there are no packet ordering guarantees and the packets may be delivered in any order. A Management Entity may process received UCIe Memory Request packets sequentially (i.e., one at a time) or concurrently (i.e., two or more at a time). There are no ordering requirements between requests in different traffic classes; however, the result of processing these requests must be equivalent to some sequential processing of requests performed in an atomic manner. Regardless of whether UCIe Memory Request packets are associated with an ordered or an unordered traffic class, a responder may send UCIe Memory Access Response Packets out-of-order (i.e., a responder is not required to send response packets in the same order that the corresponding request packets were received by the responder). This means that responses may be received by a requester in an order different from the order in which the requests were sent by the requester. ## IMPLEMENTATION NOTE ### Responses in an Ordered Traffic Class Because responders are free to send response packets for the UCIe Memory Access protocol in any order, an implementation may reorder these responses when carried in an ordered traffic class. While this conflicts with the ordered traffic class requirements, a requester cannot tell whether this reordering occurred at the responder or in the ordered traffic class of the Management Network. The Status field in a UCIe Memory Access Response packet indicates the status associated with processing the corresponding UCIe Memory Access Request packet. If a UCIe Memory Access Request packet is processed successfully, then a UCIe Memory Access Response packet is generated with status Success. If the request requires response data, then all the data associated with the successful response is contained in a single response packet. If a Management Entity receives a well formed UCIe Management Transport packet, but the UCIe Memory Access Request packet is malformed, then no processing of the request occurs and a response with no data and status Packet Error is returned. · Examples of a malformed UCIe Memory Access Request packet: \- Receipt of a UCIe Memory Access Request packet with a reserved value in the Opcode field. \- Receipt of a UCIe Memory Access Request packet with the Length field set to zero and the Last DW BE field set to a nonzero value. If a request violates the programming model of a Management Entity, then the request is not performed and a response with no data and status Programming Model Violation is returned. · Examples of programming model violations: \- Unless otherwise specified all UCIe defined structures must be accessed as DWORDs. If a Management Entity receives a request and is not capable of processing the request, but will be able to process the request at some point in the future, then a response with no data and status Retry Request is returned. The Retry Request status should not be used during normal operation and implementations are strongly encouraged to only use the Retry Status when absolutely necessary. How long a requester waits after receiving a response with status Retry Request before reissuing the request is implementation specific. The Max Retry Time Units and Max Retry Time Value fields in the UCIe Memory Access Protocol Capability Structure report the maximum duration of time during which a Management Entity may return a response with status Retry Request. A requester may use this time duration to determine how long to poll a responder before declaring that the responder has malfunctioned. If the Management Entity can process a request, the request does not contain an error, and the request attempts to access an asset that is prohibited, then the asset is not accessed, and no processing associated with the request occurs. · If the Ignore Prohibited Access (IPA) bit in the request is cleared to 0, then a response with no data and a status of Access Denied is returned. . If the Ignore Prohibited Access (IPA) bit in the request is set to 1, then the required response data with all values set to zero and status Success is returned. The purpose of this is to allow an address range to be probed without returning errors. The read of a byte whose corresponding byte enable is 0 in the First DW BE or Last DW BE field should return a value of FFh. ## IMPLEMENTATION NOTE ### Read Value Returned on Unused Byte Lanes If a Management Entity receives a UCIe Memory Access Request packet with a byte enable value of 0 in the First DW BE or Last DW BE field and does not return a value of FFh for the byte in the corresponding response, then care must be exercised to ensure that the data returned in unused bytes does not create a security issue. Implementations are strongly encouraged to align secure information on DWORD or larger boundaries. Figure 8-23 shows the fields of a UCIe Memory Access Response packet. Reserved fields (i.e., ones labeled as Rsvd) must be filled with 0s when the packet is formed. Reserved fields must be forwarded unmodified on the Management Network and ignored by receivers. An implementation that relies on the value of a reserved field in a packet is non-compliant. <figure> <figcaption>Figure 8-23. UCIe Memory Access Response Packet</figcaption> +0 +1 +2 +3 76543210765432107654321076543210 DWORD 2 Rsvd Opcode Rsvd Status Tag -- DWORD 3 Protocol Specific Data (Optional) ... -- DWORD M </figure> Table 8-20 defines the fields of a UCIe Memory Access Response packet. The packet starts at DWORD 2 because DWORDs 0 and 1 contain the UCIe Management Transport packet header. All fields in the table have little endian bit ordering (e.g., Tag bit 0 is in DWORD 3 bit 0, and Tag bit 7 is in DWORD 3 bit 7). <table> <caption>Table 8-20. UCIe Memory Access Response Packet Fields</caption> <tr> <th>Field Name</th> <th>Field Size</th> <th>Description</th> </tr> <tr> <td>Opcode</td> <td>4 bits</td> <td>Opcode This field must be set to 0000b.</td> </tr> <tr> <td>Status</td> <td>3 bits</td> <td>Response Status This field indicates the memory access response status. 000b: Success (SUCCESS) 001b: Programming Model Violation (PMV) 010b: Retry Request (RR) 011b: Access Denied (AD) 100b: Packet Error (PERR) Others: Reserved</td> </tr> <tr> <td>Tag</td> <td>8 bits</td> <td>Tag This field contains the value of the tag field of the corresponding memory access request.</td> </tr> <tr> <td>Data</td> <td>Varies</td> <td>Data If the memory access request was a Memory Read that was processed successfully (i.e., the Response Status field contains Success), then this field contains the data read. This field is not present in Memory Write completions.</td> </tr> </table> #### 8.1.4.2 UCIe Memory Access Protocol Capability Structure A Management Entity that implements the UCIe Memory Access Protocol must implement the UCIe Memory Access Protocol Capability Structure described in this section. The Max Buffered Requests field reports the maximum number of requests that the Management Entity is guaranteed to buffer. Issuing more outstanding requests to the Management Entity than this maximum may result in head-of-line blocking in the chiplet Management Fabric and/or a VC associated with a Management Port between chiplets. The Request Buffer Size field reports the sum of the size of the requests that the Management Entity is guaranteed to buffer. Issuing more outstanding requests to the Management Entity than will fit in this buffer may result in head-of-line blocking in the chiplet Management Fabric and/or a VC associated with a Management Port between chiplets. The Max Response Time Units and Max Response Time Value fields report the expected maximum time that the Management Entity requires to process a request. This is the expected maximum time with no other outstanding requests from receipt of a UCIe Memory Request packet at the Management Entity to the Management Entity emitting a corresponding UCIe Memory Response packet. The UCIe Management Access Protocol does not define an architected completion timeout mechanism to detect lost packets or hardware failures; however, a requester may use the time reported in Max Response Time Units and Max Response Time Value fields in this capability structure to implement a vendor defined completion timeout mechanism. When a completion timeout mechanism is implemented, the requester must not declare a completion timeout sooner than the expected maximum response time reported by Response Time Units and Response Time Value fields. <table> <caption>Figure 8-24. UCIe Memory Access Protocol Capability Structure</caption> <tr> <th></th> <th colspan="2">+3 31 30 29 28 27 26 25 24</th> <th>+2 23 22 21 20 19 18 17 16</th> <th>15 14</th> <th>+1 13 12 11 10</th> <th colspan="2">9876543210 +0</th> <th></th> <th rowspan="4"></th> </tr> <tr> <th>DWORD 0</th> <th>Rsvd</th> <th colspan="2">Management Capability ID</th> <th colspan="2">Reserved</th> <th colspan="3">Ver</th> </tr> <tr> <td>DWORD 1</td> <td colspan="2">Reserved</td> <td>Max Buffered Requests</td> <td>Rsvd</td> <td colspan="2">Max Response Time Value</td> <td colspan="2">Max Response Time Units</td> </tr> <tr> <td>DWORD 2</td> <td colspan="8">Requests Buffer Size</td> </tr> <tr> <td>DWORD 3</td> <td colspan="4">Reserved</td> <td colspan="2">Max Retry Time Value</td> <td colspan="2">Max Retry Time Units</td> <td></td> </tr> <tr> <td>DWORD 4</td> <td colspan="7">Reserved</td> <td>UE</td> <td></td> </tr> </table> <figure> </figure> <table> <caption>Table 8-21. UCIe Memory Access Protocol Capability Structure Fields (Sheet 1 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard $\text { Security Asset } }<br>{ \text { Class ID^{a } } }</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Ver</td> <td>$0 \left[ 7 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Capability Structure Version $T h i s \quad f i e l d \quad i n d i c a t e s \quad t h e \quad v e r s i o n \quad o f \quad t h i s$ This field has a value of 00h in this specification.</td> </tr> <tr> <td>Management Capability ID</td> <td>$0 \left[ 2 9 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Management Capability ID { \text { This field specifies the Capability ID of this } }<br>{ \text { Management Capability structure. } } { \text { The UCIe Memory Access Protocol Capability } }<br>{ \text { structure has a Manaquent Capability ID of } } 002h.</td> </tr> <tr> <td>Max Response Time Units</td> <td>$1 \left[ 3 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Maximum Response Time Units { \text { This field indicates the units associated with } }<br>{ \text { the Max Response Time Value field. } } 0000b: Reserved 0001b: nanoseconds (ns) 0010b: microseconds (us) $0 0 1 1 b : m i l l i s e c o n d s \left( m s \right)$ Others: Reserved</td> </tr> </table> <table> <caption>Table 8-21. UCIe Memory Access Protocol Capability Structure Fields (Sheet 2 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Max Response Time Value</td> <td>1 $\left[ 1 3 : 4 \right]$</td> <td>17</td> <td>$R O$</td> <td>Maximum Response Time Value { \text { This field indicates the expected maximum } }<br>{ \text { response time value. The units associated } } with this value are specified by the Max Response Time Units field.</td> </tr> <tr> <td>Maximum Buffered Requests</td> <td>$1 \left[ 2 3 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Maximum Number of Buffered Requests { \text { Ihis field reports the maximum number of } }<br>{ \text { requests that the Management Entity can } } { \text { Requests that the Management Entity are } }<br>{ \text { currently processing are considered buffered } } request. { \text { A value of zero in this fielel indicates that the } }<br>{ \text { maximum number of buffered requests is } } not reported.</td> </tr> <tr> <td>Request Buffer Size</td> <td>$2 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Request Buffer Size { \text { This field reports the size of the } }<br>{ \text { Management Entity request buffer } } in { \text { consumed by a request packet in this buffer } }<br>{ \text { is equal to the value specified by the Length } } $p a c k e t \quad h e a d e r . A \quad r e q u e s t \quad p a c k e t \quad t h a t \quad t h e$ consumes space in this buffer. { \text { A value of all Os in this field indicates that } }<br>{ \text { the size of the request buffer is not } } reported.</td> </tr> <tr> <td>{ \text { Max Retry } }<br>{ \text { Time Units } }</td> <td>3 [3:0]</td> <td>17</td> <td>RO</td> <td>Maximum Retry Time Units { \text { This field indicates the units associated with } }<br>{ \text { the Max Retry Time value fieleld. } } 0000b: Reserved 0001b: nanoseconds (ns) 0010b: microseconds (us) 0011b: milliseconds (ms) 0100b: seconds (s) Others: Reserved</td> </tr> <tr> <td>Max Retry Time Value</td> <td>$3 \left[ 1 3 : 4 \right]$</td> <td>17</td> <td>$R O$</td> <td>Maximum Retry Time Value This field indicates the maximum duration of time during which a Management Entity may { \text { return a response with status Retry Reques } }<br>{ \text { \left(i.e., maximum retry time\right). } } \text { A value of oon in this field indicates that }<br>\text { the maximum retry time value is not } reported.</td> </tr> <tr> <td>UE</td> <td>4 [0]</td> <td>16</td> <td>RW</td> <td>Unordered Traffic Class Enable { \text { When this field is set to 1 the Management } }<br>{ \text { Entitv mav issue UCIe Memorv Access } } protocol requests on an ordered or unordered traffic class. { \text { When this field is set to the Managem } }<br>{ \text { Entitv mav onlv issue reauests on an } } ordered traffic class and must not issue requests on an unordered traffic class. { \text { The initial value of this field is } 0 \text { in all } }<br>{ \text { Management Entities except the } } { \text { Management Director. The intial value of } }<br>{ \text { this field is } 1 \text { in the Management Directo } }</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. #### 8.1.5 Common Data Structures All data structures described in this section are common and can be instantiated in any capability structure exposed through the UCIe memory access protocol (see Section 8.4). A capability structure that instantiates one of the common data structures must follow the memory layout and size for each field defined as part of the common data structure. A capability structure must support all the mandatory features for the common data structure(s) it is using. In the following sections, a UMAP requester is an entity which accesses the common data structure through the UMAP protocol. The restrictions and rules for each common data structure defined in Section 8.1.5.1 apply to UMAP requesters. Access or manipulation of the common data structure locally by the chiplet/endpoint is beyond the scope of this specification. ##### 8.1.5.1 Circular Buffer A Circular Buffer structure is a common data structure that can be instantiated by a capability structure provided it respects the layout and behavior outlined in this section. A capability structure can instantiate multiple distinct instances of the Circular Buffer. Section 8.1.5.1.11 describes how to use the Circular Buffer structure. This section defines both sink and source type of Circular Buffers that both follow similar memory layout and behavior. As a sink the UMAP requester writes to the Circular Buffer. As a source the UMAP requester reads from the Circular Buffer. The sink and source Circular Buffers share the same layout and semantics. ##### 8.1.5.1.1 Circular Buffer Theory of Operation A Circular Buffer is a common structure that a producer writes to at a write offset and consumer reads from at a read offset. Both offsets range from 0 to the Circular Buffer size minus 1. Both offsets wrap- around to 0 when they reach the Circular Buffer size value. The Circular Buffer is empty if the write offset and read offset are equal as shown in Figure 8-25. The Circular Buffer is full if the write offset incremented by 1 would be equal to the read offset as shown in Figure 8-26 or Figure 8-27. <figure> <figcaption>Figure 8-25. Empty Circular Buffer</figcaption> base address + buffer size - 1 empty empty empty write offset empty \+ read offset Offset Increment empty base address empty </figure> <figure> <figcaption>Figure 8-26. Full Circular Buffer with Write Offset below Read Offset</figcaption> base address + buffer size - 1 one dword of data one dword of data one dword of data \+ read offset empty \+ write offset Offset Increment one dword of data base address one dword of data </figure> Figure 8-27. Full Circular Buffer with Write Offset above Read Offset <figure> base address + buffer size - 1 empty write offset one dword of data one dword of data one dword of data Offset Increment one dword of data base address one dword of data \+ read offset </figure> A Circular Buffer access has a maximum burst size which is the maximum value for data length of one UMAP packet. Maximum burst size is reported by the CB_MAX_BURST_SIZE field (see Table 8-28). If a UMAP packet that reads or writes from or to the Circular Buffer has a larger data length, a UMAP programming model violation error is reported (no error is reported in the Circular Buffer structure). Note that the UCIe management fabric may impose further restrictions that impact the maximum burst size, such as the Maximum Packet Size (MPS) of each chiplet in the path. It is the responsibility of the requester to use a burst size that meets all the restrictions. ##### 8.1.5.1.2 Circular Buffer State Machine Figure 8-28 shows the possible states of a Circular Buffer and how it transitions from one state to another. A Circular Buffer must automatically transition from the INITIALIZING state to the READY state unless the management capability which defines the Circular Buffer also defines special actions that need to be taken to finalize the initialization of the Circular Buffer. Note that the transition from INITIALIZING state to the READY state can take an implementation dependent amount of time. A Circular Buffer can transition from the INITIALIZING state to the ERROR state for implementation dependent reasons. <figure> <figcaption>Figure 8-28. Circular Buffer State Machine</figcaption> Reset INITIALIZING Initialization Error ERROR Initialization Done Reset READY Illegal Access </figure> The following registers/fields can be accessed while the Circular Buffer is in any state: · CB_VERSION · CB_CAPABILITIES · CB_STATE · CB_ERROR_BITS · CB_ERROR If Reset Supported is 1 in CB_CAPABILITIES (see Table 8-22), then it is legal to write 1 to the Reset bit of CB_CONTROL while a Circular Buffer is in READY or ERROR states. Writing 1 to the Reset bit will reset the Circular Buffer, which shall transition to the INITIALIZING state. Additionally, the read offset and write offset will be reinitialized to an empty circular buffer (i.e., both values equal to each other). Note that read and write offset do not necessarily reset to 0. It is illegal to write 1 to the Reset bit while the Circular Buffer is in the INITIALIZING state. The Circular Buffer shall ignore such reset requests and continue with its initialization. It is also illegal to write 1 to the Reset bit if the reset operation is not supported (reported by CB_CAPABILITIES (see Table 8-22)). If 1 is written to the Reset bit when reset is not supported, then the Circular Buffer shall ignore such request. When a Circular Buffer is in READY state, all Circular Buffer data structures can be accessed as long as it is allowed by access control and follows the write and read rules specified in Section 8.1.5.1.8 for a sink Circular Buffer or Section 8.1.5.1.9 for a source Circular Buffer. In INITIALIZING or ERROR states, it is illegal for a requester to read (source Circular Buffer) or write (sink Circular Buffer) to a Circular Buffer with UMAP protocol. Illegal accesses will be ignored and trigger a programming model violation (empty reply with programming model violation bit set). A Circular Buffer implementation may also report the error using Circular Buffer error reporting mechanisms (see Section 8.1.5.1.5). ##### 8.1.5.1.3 Circular Buffer Initialization Before using a Circular Buffer (sink or source) the UMAP requester must confirm it is initialized and ready. Circular Buffer initialization is defined by the management capability which exposes the Circular Buffer. Initialization, if necessary, should generally only need to happen once after management element initialization. Circular Buffer initialization may also be needed to recover from some error conditions. See Table 8-23 for a list of errors which need Circular Buffer initialization for recovery. When a UMAP read of CB_STATE reports READY state, initialization was successful. If an error occurred during initialization then CB_STATE will report ERROR state (see Section 8.1.5.1.5). The Management Capability Structure may define how to handle multiple initialization attempt failures. For example, the Early Firmware Download capability (see Section 8.4.1 and more specifically Section 8.4.1.8) uses a sink Circular Buffer and defines that initialization should be retried at most one time if it fails after reset. #### 8.1.5.1.4 Circular Buffer Features The Circular Buffer Capability register allows requesters to discover which optional features are supported by a particular Circular Buffer. See the capabilities register definition in Table 8-22 for the capabilities of the Circular Buffer that can be reported. <table> <caption>Table 8-22. CB_CAPABILITIES Circular Buffer Capabilities</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="2">0</td> <td rowspan="2">RO</td> <td>Reset Supported If 1, then reset is supported (i.e., initiator can reset the Circular Buffer using reset bit of CB_CONTROL). See Section 8.1.5.1.6 for details.</td> </tr> <tr> <td>If 0, then reset is not supported and if an error occurs, then the initiator must perform a full chiplet reset to recover from error. Note that this bit may change value and if it can change value then the UCIe management capability which uses Circular Buffer is responsible for defining when and why this bit can change.</td> </tr> <tr> <td>1</td> <td>RO</td> <td>Overflow/Underflow Set for source Circular Buffers that detect and report overflow. Set for sink Circular Buffers that detect and report underflow.</td> </tr> <tr> <td>31:2</td> <td>RO</td> <td>Reserved</td> </tr> </table> ##### 8.1.5.1.5 Circular Buffer State and Errors The CB_STATE field (see the field's definition in Table 8-28) can only take one of the values defined in Table 8-23. Each value corresponds to one state in the state machine of the Circular Buffer state machine described in Section 8.1.5.1.2. <table> <caption>Table 8-23. CB_STATE Field Value and Definitions</caption> <tr> <th>Field Values</th> <th>Description</th> </tr> <tr> <td>0</td> <td>READY Circular Buffer ready either for write (sink Circular Buffer) or for read (source Circular Buffer). The requester can initiate write or read following the sequences described in Section 8.1.5.1.8 or Section 8.1.5.1.9.</td> </tr> <tr> <td>1</td> <td>INITIALIZING Circular Buffer is initializing. This is a transient state so it will not remain in this state indefinitely. When initialization successfully completes, CB_STATE changes to READY. for details). The INITIALIZING state may timeout and proceed to ERROR state (see Section 8.1.5.1.3</td> </tr> <tr> <td>2</td> <td>ERROR See Table 8-24 and Table 8-25 for information on the types of errors that may occur.</td> </tr> <tr> <td>Other Values</td> <td>Reserved</td> </tr> </table> When an error occurs, the error code reported in CB_ERROR field shall reflect the first error condition observed by the hardware. Every error that occurs accumulates in CB_ERROR_BITS where bits are set for every error type detected and remain set until a Circular Buffer or chiplet reset. See Table 8-24 for the error vector bit definitions. The CB_ERROR_BITS shall reset to 0 (no error) after a Circular Buffer reset. Note that if Circular Buffer reset is not supported (see Table 8-22), then only a full chiplet reset can clear CB_ERROR_BITS and CB_ERROR (see Section 8.1.5.1.2 for details). <table> <caption>Table 8-24. CB_ERROR_BITS - Error Vector</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>$R O$</td> <td>Internal See CB_ERROR definition in Table 8-25 for details.</td> </tr> <tr> <td>1</td> <td>RO</td> <td>Initialization Failure See CB_ERROR definition in Table 8-25 for details.</td> </tr> <tr> <td>2</td> <td>RO</td> <td>Access while Not Ready See CB_ERROR definition in Table 8-25 for details.</td> </tr> <tr> <td>3</td> <td>RO</td> <td>$S e e \quad C B \_ E R R O R \quad d e f i n i t i o n \quad i n \quad T a b l e \quad 8 - 2 5 \quad f o r \quad d e t a i l s .$</td> </tr> <tr> <td>4</td> <td>RO</td> <td>$C B _ { - } .$</td> </tr> <tr> <td>31:5</td> <td>RO</td> <td>Reserved</td> </tr> </table> The CB_ERROR field can only take one of the values defined in Table 8-25. <table> <caption>Table 8-25. CB_ERROR Values Definitions (Sheet 1 of 2)</caption> <tr> <th>Field Values</th> <th>Description</th> </tr> <tr> <td>0</td> <td>No Error</td> </tr> <tr> <td>1</td> <td>{ \text { Internal } }<br>{ \text { Internal error is for vendor defined errors .$</td> </tr> <tr> <td>2</td> <td>Initialization Failure The Circular Buffer initialization failed. The capability structure which makes use of the Circular Buffer structure can further define what might be the cause of failures through error reporting mechanisms unique to each capability structure. If the capability structure does not further define the reasons then this should be considered as a vendor defined failure.</td> </tr> </table> <table> <caption>Table 8-25. CB_ERROR Values Definitions (Sheet 2 of 2)</caption> <tr> <th>Field Values</th> <th>Description</th> </tr> <tr> <td>3</td> <td>Access while Not Ready Access to a register (other than the always legal registers) of the Circular Buffer structure or Circular Buffer when the state is not READY. Note that this error is not necessarily detected by a Circular Buffer and thus requesters should not depend on a Circular Buffer implementation to report such illegal access.</td> </tr> <tr> <td>4</td> <td>Overflow Circular Buffer overflow (i.e., either the requester wrote DWORDs between the read offset and the write offset, or the requester updated the write offset past the read offset). Value is 0 for source Circular Buffer. If the Circular Buffer implementation can detect overflow access, the implementation shall discard the overflowing write. Overflow detection is optional for a Circular Buffer.</td> </tr> <tr> <td>5</td> <td>Underflow Circular Buffer underflow (i.e., either the requester read DWORDs between the write offset and the read offset, or the requester updated the read offset past the write offset). Circular Buffer underflow detection is optional. This field is always 0 for a sink Circular Buffer.</td> </tr> <tr> <td>Other values</td> <td>Reserved</td> </tr> </table> When the CB_ERROR field is set to a value other than "No Error", the field will not be changed until the Circular Buffer or chiplet is reset. The CB_VENDOR_DEFINED_ERROR_STATUS field defined in Table 8-26 is for vendor defined error status. It is for providing additional details related to the error reported in CB_ERROR (i.e., a user of the circular buffer does not need to use the CB_VENDOR_DEFINED_ERROR_STATUS when handling errors). If there is no vendor defined status when the Circular Buffer is in ERROR state, then this field shall return zero (see Table 8-26). Note that if CB_VENDOR_DEFINED_ERROR_STATUS returns 0, it does not mean that there are no errors. When an error occurs, CB_ERROR is set to a value other than No Error (see Table 8-25) and CB_STATE reports ERROR state. <table> <caption>Table 8-26. CB_VENDOR_DEFINED_ERROR_STATUS Value Definitions</caption> <tr> <th>Field Values</th> <th>Description</th> </tr> <tr> <td>0</td> <td>No vendor defined error status. The reported error, if any, does not require any vendor defined error status.</td> </tr> <tr> <td>Other values</td> <td>Reserved for vendors. Vendors are free to define meaning for each of those values.</td> </tr> </table> #### 8.1.5.1.6 Control Register <table> <caption>Table 8-27 defines each bit of the Circular Buffer Control register (CB_CONTROL). Table 8-27. CB_CONTROL - Control Register Bit Definition</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW</td> <td>Reset Writing 1 to this bit will cause the Circular Buffer to become empty by setting the read and write offsets to the same value. The read and write offset values are not required to reset to 0. It is illegal to write 1 to the reset bit if CB_CAPABILITIES reports reset as not supported (see Section 8.1.5.1.2 and Section 8.1.5.1.4 for details). The Circular Buffer shall ignore such reset requests (i.e., when reset is not supported as reported in CB_CAPABILITIES). Setting this bit, when it is legal to do so, shall clear error conditions.</td> </tr> <tr> <td>31:1</td> <td>RW</td> <td>Reserved</td> </tr> </table> Read of the control register (CB_CONTROL) shall return 0 because this is a write only register. #### 8.1.5.1.7 Circular Buffer Common Fields Table 8-28 defines registers and fields that are common between sink and source Circular Buffer. <table> <caption>Table 8-28. Sink and Source Circular Buffer Structure Fields (Sheet 1 of 2)</caption> <tr> <th>Register/Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>CB_VERSION</td> <td>0 [7:0]</td> <td>RO</td> <td>Version of the Circular Buffer control structure. Must be 0.</td> </tr> <tr> <td>CB_CAPABILITIES</td> <td>1 [31:0]</td> <td>RO</td> <td>Bit vector of supported capabilities (see Table 8-22 for details)</td> </tr> <tr> <td>CB_MAX_BURST_SIZE</td> <td>$2 \left[ 7 : 0 \right]$</td> <td>RO</td> <td>Specifies the maximum data length for a UMAP operation to the Circular Buffer. The maximum number of DWORDs is equal to this field plus 1 (e.g., a value of 00h in this field indicates a data length of one DWORD, a value of 01h in this field indicates a data length of two DWORDs, and so on).</td> </tr> <tr> <td>CB_BUFFER_SIZE</td> <td>$3 \left[ 3 1 : 0 \right]$</td> <td>RO</td> <td>The size of the Circular Buffer in DWORDs. A Circular Buffer must be at least one DWORD in size and the value 0 is reserved.</td> </tr> <tr> <td>CB_ADDRESS_LOW</td> <td>$4 \left[ 3 1 : 0 \right]$</td> <td>$R O$</td> <td>Bits [31:0] of the 64-bit base address of the Circular Buffer. $\text { Because capability structures must be DWORD } }<br>{ \text { aligned, bits } \left[ 1 : 0 \right] \text { must be 00b } }</td> </tr> <tr> <td>CB_ADDRESS_HIGH</td> <td>$5 \left[ 3 1 : 0 \right]$</td> <td>$R O$</td> <td>Bits [63:32] of the 64-bit base address of the Circular Buffer.</td> </tr> <tr> <td>CB_CONTROL</td> <td>6 [31:0]</td> <td>RW</td> <td>Control vector (see Table 8-27 for details).</td> </tr> <tr> <td>-</td> <td>$7 \left[ 3 1 : 0 \right]$</td> <td>-</td> <td>{ \text { See Table } 8 - 2 9 \text { for a sink Circular Buffer } }<br>{ \text { See Table } 8 - 3 0 \text { for a source Circular Buffer .$</td> </tr> <tr> <td>-</td> <td>8 [31:0]</td> <td>-</td> <td>See Table 8-29 for a sink Circular Buffer. See Table 8-30 for a source Circular Buffer.</td> </tr> <tr> <td>CB_STATE</td> <td>$9 \left[ 1 : 0 \right]$</td> <td>$R O$</td> <td>See Table 8-23 for details.</td> </tr> <tr> <td>CB_ERROR_BITS</td> <td>10 [31:0]</td> <td>RO</td> <td>See Table 8-24 for details.</td> </tr> <tr> <td>CB_ERROR</td> <td>11 [3:0]</td> <td>$R O$</td> <td>See Table 8-25 for details.</td> </tr> <tr> <td>CB_VENDOR_DEFINED_ERROR_STATUS</td> <td>$1 1 \left[ 3 1 : 1 6 \right]$</td> <td>RO</td> <td>$S e e \quad T a b l e \quad 8 - 2 6 \quad f o r \quad d e t a i l s .$</td> </tr> <tr> <td>Reserved</td> <td>12 [31:0]</td> <td>RO</td> <td>Reserved</td> </tr> </table> <table> <caption>Table 8-28. Sink and Source Circular Buffer Structure Fields (Sheet 2 of 2)</caption> <tr> <th>Register/Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Reserved</td> <td>13 [31:0]</td> <td>RO</td> <td>Reserved</td> </tr> <tr> <td>Reserved</td> <td>14 [31:0]</td> <td>RO</td> <td>Reserved</td> </tr> <tr> <td>Reserved</td> <td>15 [31:0]</td> <td>RO</td> <td>Reserved</td> </tr> </table> #### 8.1.5.1.8 Sink Circular Buffer Structure Figure 8-29 shows the sink Circular Buffer structure. A sink Circular Buffer is written to by a UMAP requester using the CB_REQUESTER_WRITE_OFFSET added to the 64-bit Circular Buffer base address for the start address of a UMAP write. The 64-bit circular base address is formed by concatenating CB_ADDRESS_HI with CB_ADDRESS_LOW. The management entity that is reading from the Circular Buffer uses CB_READ_OFFSET added to the 64-bit Circular Buffer base address for the read's start address (see Figure 8-29 and Table 8-29). <table> <caption>Figure 8-29. Sink Circular Buffer, UMAP Requester Write to and Management Entity Read from</caption> <tr> <th rowspan="5">DWORD 0 DWORD 1</th> <th colspan="10"></th> <th colspan="8"></th> </tr> <tr> <th colspan="4">+3</th> <th colspan="6">+2</th> <th colspan="4">+1</th> <th colspan="4">+0</th> </tr> <tr> <th>31</th> <th>30 29 28 27 26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21 20</th> <th>19</th> <th>18</th> <th>17 16</th> <th>15 14 13 12</th> <th></th> <th></th> <th></th> <th></th> <th>11109876543210</th> <th></th> <th></th> </tr> <tr> <td colspan="14">Reserved</td> <td colspan="4">CB_VERSION (RO)</td> </tr> <tr> <td colspan="14">CB_CAPABILITIES (RO)</td> <td colspan="4"></td> </tr> <tr> <td>DWORD 2</td> <td colspan="14">Reserved</td> <td colspan="4">CB_MAX_BURST_SIZE (RO)</td> </tr> <tr> <td>DWORD 3</td> <td colspan="18">CB_BUFFER_SIZE (RO)</td> </tr> <tr> <td>DWORD 4</td> <td colspan="18"></td> </tr> <tr> <td>DWORD 5</td> <td colspan="11">$\frac { C B _ { - } A D D R E S S _ { - } L O W \left( R O \right) } { C B A D D P E S S _ { - } H I G H \left( R O \right) }$</td> <td colspan="2"></td> <td colspan="5"></td> </tr> <tr> <td>DWORD 6</td> <td colspan="11">CB_CONTROL (RW)</td> <td colspan="2"></td> <td></td> <td colspan="4"></td> </tr> <tr> <td>DWORD 7</td> <td colspan="13">CB_READ_OFFSET (RO)</td> <td></td> <td colspan="4"></td> </tr> <tr> <td>DWORD 8</td> <td colspan="18">CB_REQUESTER_WRITE_OFFSET (RW)</td> </tr> <tr> <td>DWORD 9</td> <td colspan="14">Reserved</td> <td colspan="4">CBS1</td> </tr> <tr> <td>DWORD 10</td> <td colspan="18">CB_ERROR_BITS (RO)</td> </tr> <tr> <td>DWORD 11</td> <td colspan="5">$C B V ^ { 3 }$</td> <td colspan="5"></td> <td colspan="3">Reserved</td> <td></td> <td colspan="2"></td> <td colspan="2">CBE2</td> </tr> <tr> <td>DWORD 12</td> <td colspan="4"></td> <td></td> <td colspan="6">Reserved</td> <td colspan="2"></td> <td></td> <td colspan="2"></td> <td colspan="2"></td> </tr> <tr> <td>DWORD 13</td> <td colspan="4"></td> <td></td> <td></td> <td colspan="3"></td> <td colspan="2">Reserved</td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td colspan="2"></td> </tr> <tr> <td>...</td> <td colspan="4"></td> <td></td> <td colspan="6">Reserved</td> <td colspan="2"></td> <td></td> <td colspan="4"></td> </tr> <tr> <td>DWORD 15</td> <td colspan="4"></td> <td></td> <td colspan="4"></td> <td colspan="2">Reserved</td> <td colspan="2"></td> <td></td> <td colspan="2"></td> <td></td> <td></td> </tr> <tr> <td></td> <td colspan="16">(1) CBS is the shorthand for the CB_STATE field which is a read only (RO) $\left( 2 \right) C B E \quad i s \quad t h e$ shorthand for the CB_ERROR field which is a read only (RO) shorthand for the CB_VENDOR_DEFINED_ERROR_STATUS field which is a read only (RO)</td> <td></td> <td></td> </tr> </table> <figure> </figure> Table 8-29 defines the fields specific to a sink Circular Buffer. See Section 8.1.5.1.7 for the definition of the registers that are common between sink and source Circular Buffer. <table> <caption>Table 8-29. Sink Circular Buffer Structure Fields</caption> <tr> <th>Register/Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>CB_READ_OFFSET</td> <td>7 [31:0]</td> <td>RO</td> <td>The offset at which the management entity will read next from the Circular Buffer. Updated by the management entity.</td> </tr> <tr> <td>CB_REQUESTER_WRITE_OFFSET</td> <td>8 [31:0]</td> <td>RW</td> <td>The offset at which the UMAP requester shall write next to the Circular Buffer. Updated by the UMAP requester.</td> </tr> </table> A Circular Buffer must be initialized and in READY state before a UMAP requester can write to it. After the sink Circular Buffer is in READY state, the requester shall use the following steps to write to the Circular Buffer: 1\. Read the CB_BUFFER_SIZE register (cb size). 2\. Read the CB_REQUESTER_WRITE_OFFSET register (wr offset). 3\. Read the CB_READ_OFFSET register (rd offset). 4\. Compute the maximum amount of DWORDs that the UMAP requester can write, referred to as (max wr size), using the following formula: (max wr size) = ((cb size) + (rd offset) - (wr offset) - 1) % (cb size) Note that the '%' symbol in the above formula represents the modulo operation. 5\. The requester can write up to (max wr size) DWORDs, over multiple UMAP write packets, into the Circular Buffer before it needs to read CB_READ_OFFSET again. The requester must not write more than CB_MAX_BURST_SIZE DWORDs with each individual UMAP write packet and the end offset of the data written must not extend beyond the (cb size). Note that the UCIe management fabric might impose further restrictions on the maximum UMAP packet size (see the available DWORD sizes for the CMPS field in Table 8-11). The UMAP requester shall decide on a write size (wr size) for each UMAP write packet and the offset of the data written must not extend beyond the (cb size). After writing the last valid offset of the buffer, the next write offset (next wr offset) shall wrap around 0, computing (next wr offset) can be achieved using the following formula: $$\left( n e x t \quad w r \quad o f f s e t \right) = \left( \left( w r \quad o f f s e t \right) + \left( w r \quad s i z e \right) \right) \left( c b \quad s i z e \right)$$ Note that writing beyond the Circular Buffer size with one single UMAP write packet (where the write offset starts within the Circular Buffer area and the last write offset would be beyond the Circular Buffer size) will be reported as a programming violation error and nothing will be written to the Circular Buffer. 6\. The UMAP requester may update the write offset to allocate any entries into the Circular Buffer once their write is acknowledged by the UCIe memory access protocol. The UMAP requester can update the write offset after each write is acknowledged, after all writes are acknowledged, or after a subset of all the writes are acknowledged. The above procedure ensures that the UMAP requester never sets the write offset equal to the management entity read offset since that could cause the Circular Buffer to overflow. If the UMAP requester follows all the rules defined in this section, the UMAP requester does not need to check the error status between write transactions. #### 8.1.5.1.9 Source Circular Buffer Structure Figure 8-30 shows the source Circular Buffer structure. A source Circular Buffer is read from by a UMAP requester using the CB_REQUESTER_READ_OFFSET added to the 64-bit Circular Buffer base address for the start address of a UMAP read. The management entity that is writing to the Circular Buffer uses CB_WRITE_OFFSET added to the 64-bit Circular Buffer base address for the write's start address (see Figure 8-30 and Table 8-30). The flow to read from a source Circular Buffer is described below. Figure 8-30. Source Circular Buffer, UMAP Requester Read from and Management Entity Write to <figure> +3 +2 +1 +0 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 109876543210 DWORD 0 Reserved CB_VERSION (RO) DWORD 1 CB_CAPABILITIES (RO) DWORD 2 Reserved CB_MAX_BURST_SIZE (RO) DWORD 3 $C B _ { - } B U F F E R _ { - } S l Z E \left( R O \right)$ DWORD 4 $C B _ { - } A D D R E S S _ { - } L O W \left( R O \right)$ DWORD 5 CB_ADDRESS_HIGH (RO) DWORD 6 CB_CONTROL (RW) DWORD 7 CB_REQUESTER_READ_OFFSET (RW) DWORD 8 CB_WRITE_OFFSET (RO) DWORD 9 Reserved CBS1 DWORD 10 CB_ERROR_BITS (RO) DWORD 11 CBV3 Reserved CBE2 DWORD 12 Reserved DWORD 13 Reserved Reserved DWORD 15 Reserved (1) CBS is the shorthand for the CB_STATE field (2) CBE is the shorthand for the CB_ERROR field (3) CBV is the shorthand for the CB_VENDOR_DEFINED_ERROR_STATUS field which is a read only (RO) </figure> Table 8-30 defines the fields specific to a source Circular Buffer. See Section 8.1.5.1.7 for the definition of the registers that are common between sink and source Circular Buffers. <table> <caption>Table 8-30. Source Circular Buffer Structure Fields</caption> <tr> <th>Register/Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>CB_REQUESTER_READ_OFFSET</td> <td>7 [31:0]</td> <td>RW</td> <td>The offset at which the UMAP requester shall read next from the Circular Buffer.</td> </tr> <tr> <td>CB_WRITE_OFFSET</td> <td>8 [31:0]</td> <td>RO</td> <td>The offset at which the management entity writes next to the Circular Buffer.</td> </tr> </table> A Circular Buffer must be initialized and in READY state before a UMAP requester can read from it. When the source Circular Buffer is ready, the UMAP requester shall perform the following steps to read from the Circular Buffer: 1\. Read the CB_BUFFER_SIZE register (cb size). 2\. Read the CB_REQUESTER_READ_OFFSET register (rd offset). 3\. Read the CB_WRITE_OFFSET register (wr offset). 4\. Compute the maximum amount of DWORDs that the UMAP requester can read $\left( m a x \quad r d \quad s i z e \right) ,$ using the following formula: (max rd size) = ((cb size) + (rd offset) - (wr offset)) % (cb size) 5\. The requester can read up to (max rd size) DWORDs, over multiple UMAP read packets, from the Circular Buffer before it needs to read again CB_WRITE_OFFSET. The requester must not read more than CB_MAX_BURST_SIZE DWORDs with each individual UMAP read packet and the end offset of the data read must not extend beyond the (cb size). Note that the UCIe management fabric might impose further restrictions on the maximum UMAP packet size (see the available DWORD sizes for the CMPS field in Table 8-11). The UMAP requester shall decide on a read size (rd size) for each UMAP read packet and the end offset of the data read must not extend beyond the (cb size). After reading the last valid offset of the buffer, the next read offset (next rd offset) shall wrap around 0, computing (next rd offset) can be achieve using the following formula: (next rd offset) = ((rd offset) + (rd size)) % (cb size) Note that reading above the Circular Buffer size with one single UMAP read packet (where the read offset starts within the Circular Buffer area and the last read offset would be beyond the Circular Buffer size) will be reported as a programming violation error. 6\. The UMAP requester may update CB_REQUESTER_READ_OFFSET to deallocate entries from the Circular Buffer once the UMAP packet reading the entry has completed. The UMAP requester can incrementally update CB_REQUESTER_READ_OFFSET as reads complete or can wait until all reads have completed before updating CB_REQUESTER_READ_OFFSET. If the requester follows all the rules defined in this section, the UMAP requester does not need to check the error status between read transactions. #### 8.1.5.1.10 UMAP Requester Coordination If there are multiple UMAP requesters for the same Circular Buffer, coordination of the requests to the Circular Buffer is the responsibility of the UMAP requesters and beyond the scope of this specification. #### 8.1.5.1.11 How to Use Circular Buffer The capability structures which use the Circular Buffer must use the Circular Buffer control structure as shown in Figure 8-29 or Figure 8-30 and with all the fields described in Table 8-28 and either Table 8-29 or Table 8-30 depending if the Circular Buffer is a sink or a source respectively. The Circular Buffer control structure can appear at any DWORD-aligned UMAP address within the capability structure which exposes a Circular Buffer structure. The capability structure shall define the following mandatory requirement: · Security asset class for the Circular Buffer control structure. The capability structure can define the following optional requirement: · Initialization sequence if initialization is necessary. ##### 8.1.6 Open Drain Configuration Structure Open Drain signals can be used to notify other chiplets using a low-latency event. The Open Drain is a bidirectional event. The electrical specifications for Open Drain are described in Section 5.14. Each Open Drain instance will have an associated capability structure. There is no limit on the number of Open Drain signals on a chiplet. <table> <caption>Figure 8-31. Open Drain Detection Capability Structure</caption> <tr> <th rowspan="2"></th> <th colspan="8">+3</th> <th colspan="8">+2</th> <th></th> <th colspan="7">+1</th> <th colspan="7">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </table> DWORD 0 DWORD 1 DWORD 2 <table> <caption>Table 8-31. Open Drain Detection Capability Structure Fields</caption> <tr> <th>Rsvd</th> <th>Management Capability ID</th> <th>Reserved Version</th> </tr> <tr> <td>Sampling Rate Units</td> <td>Reserved</td> <td>Sampling Rate Value</td> </tr> <tr> <td colspan="2">Vendor-defined</td> <td>Valid Sample Count</td> </tr> </table> <table> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Version</td> <td>0 [7:0]</td> <td>17</td> <td>RO</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>Management Capability ID</td> <td>0 [29:16]</td> <td>17</td> <td>RO</td> <td>Management Capability ID This field specifies the Capability ID of this Management Capability structure. The Open Drain Configuration structure has a Management Capability ID of 005h.</td> </tr> <tr> <td>Sampling Rate Value</td> <td>1 [15:0]</td> <td>17</td> <td>$R O$</td> <td>This field reports the chiplet's sampling rate of the input to the Open Drain signal. This value is combined with the Sampling Rate Units to determine the sampling rate. The Sampling Rate Value is equal to this field plus 1 (e.g., a value of 0000h in this field indicates a sample rate value equal to 0001h): Rate Value * Sampling $\text { Sampling rate } \left( n z \right) = 1 1 }<br>{ \left. \text { Rate Units } \right) .$ The sampling rate tolerance must be ±25% value.</td> </tr> <tr> <td>Sampling Rate Units</td> <td>$1 \left[ 3 1 : 2 9 \right]$</td> <td>17</td> <td>RO</td> <td>Sampling Rate Value Units 000b: ps 001b: ns 010b: us 011b: ms Others: Reserved</td> </tr> <tr> <td>Valid Sample Count</td> <td>2 [15:0]</td> <td>16</td> <td>RW</td> <td>Number of consecutive matching samples of Open Drain input required before detecting the event. The Valid Sample Count is equal to the value of this field plus 1 (e.g., a value of 0000h in this field indicates a Valid Sample Count equal to 0001h). It is expected that this value is programmed once at initialization. This value must be &lt;= Maximum Sample Count.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. ###### 8.1.6.1 Example Usage In the example shown in Figure 8-32: · Raw Open-Drain: Value of shared signal as seen at the input of the chiplets Open Drain ball · Valid Open-Drain: Value of the Open Drain ball after qualification by Valid Sample Count An example of the Valid Sample Count usage is shown in Figure 8-32. In this example: 1\. The Valid Sample Count is set to 6 (seven consecutive matching samples required). 2\. Raw Open-Drain is detected as asserted for four clocks, then detected as de-asserted. 3\. The Valid Sample Count threshold is not met; the sampled Open Drain is not asserted. 4\. Raw Open-Drain is again detected as asserted for seven consecutive clocks. 5\. Valid Sample Count threshold is satisfied and the valid Open Drain is asserted. Figure 8-32. Valid Sample Count Example <figure> sample clk raw open-drain a sample count 0 1 2 3 0 1 2 3 4 5 6 valid sample count=6 valid open-drain b </figure> ## IMPLEMENTATION NOTE ### Re-arming of Open Drain The assertion of an Open-Drain signal is governed by the event's Trigger Control fields, which specify a minimum assertion duration. When any chiplet de-asserts the signal, it will be perceived as "high" by other chiplets in less than 2 us. It is vendor- defined implementation to prevent false detection during this time. ### 8.2 Management Transport Packet (MTP) Encapsulation #### 8.2.1 MTP Encapsulation Architecture Overview Management Transport Packet (MTP) is the message used for management-related functionality on a management network in UCIe-based chiplets (see Section 8.1.1 for details). This section deals with how MTPs are sent/received over UCIe Sideband and Mainband links through the process of Encapsulation. All Management Ports (as defined in Section 8.1.2) in a chiplet must support Encapsulation. Chiplet support for Management Port on a UCIe sideband link or a UCIe mainband link are independently optional, subject to rules stated in Section 8.1.2. When Management Port is supported on a UCIe link (sideband or mainband) the management path on the link is setup as described in Section 8.2.3.1 for sideband and Section 8.2.3.2 for mainband. After the management path is set up on a link, the Encapsulated MTPs can be sent and received. Throughout this document the term Management Port Messages (MPM) is used to refer to all Sideband and Mainband messages that relate to Encapsulation. For the Sideband interface, these messages are defined in Table 7-1. For the mainband, these messages are defined in Table 8-32 and a "Management Flit" is defined (see Table 3-4 and Table 3-5) to carry these messages. See Figure 8-33 and Figure 8-34 for a high-level view of the MTP transport path over UCIe sideband and mainband respectively. In this architecture, MTPs are transported between Management Port Gateways (MPGs) on each end of the UCIe link using either the sideband or the mainband path. In this context, an MPG is an entity that provides the bridging functionality when transporting an MTP from/to a local SoC management fabric (which is an SoC-specific implementation) to/from a UCIe link. The MPG has credited buffers for receiving MTPs (called RxQ) from the link and their sizes are exchanged during initial link training. These credited buffers are separately maintained for Sideband and Mainband paths when management transport is supported on both. Up to eight VCs can be supported on a Management Port. Dedicated buffering is required for each VC negotiated. Support for VC0 is mandatory when management transport is negotiated, and all other VCs are optional. <figure> <figcaption>Figure 8-33. UCIe Sideband Management Path Architectureª b</figcaption> Die A D2D Adapter Separate credits per Sideband/VC/Req/Resp $\mathrm { C f g } ^ { 1 }$ MTP Rx/Tx Queues MPG Mux Management Port Gateway RDI · Separate credits for Link Management packets/messages vs. Management Transport messages $\mathrm { C f g } ^ { 2 }$ PHY · Credit per UCIe Sideband Any, some, or all the Sideband links in multi- module config can be used for Management Transport Module C Module Module \- Module 3 Die B PHY Cfg2 RDI MTP Rx/Tx Queues MPG Mux Management Port Gateway Cfg1 D2D Adapter </figure> a. Configuration interface (i.e., pl_cfg _* and lp_cfg _* signals) described in Table 10-1. b. Configuration interface (i.e., pl_cfg _* and 1p_cfg _* signals) described in Table 10-1 plus extensions described in Table 10-3. <figure> <figcaption>Figure 8-34. UCIe Mainband Management Path Architecture</figcaption> Protocol (CXL.io, PCIe, Streaming) Die A FDI MTP $\mathrm { R x } / \mathrm { T x }$ Queues MPG Mux Management Port Gateway Separate credits per Stack/VC/Req/Rsp $F D I -$ D2D Adapter RDI- PHY Module 0 · Module 1 \- Module 2 -- \- Module 3- Die $B$ PHY RDI- Separate credits per Stack/VC/Req/Rsp D2D Adapter FDI- MTP Rx/Tx Queues MPG Mux Management Port Gateway FDI Protocol (CXL.io, PCIe, Streaming) </figure> In multi-module or multi-sideband-only link configurations, any, some or all of up to four sideband links can be used for transporting MTPs. Unless stated otherwise, any references to sideband management port behavior/requirements/rules for a multi-module configuration also apply to a multi- sideband-only link configuration. In multi-stack mainband configurations, any or both stacks can be used for transporting MTPs. Ordering is still maintained when transporting packets on multiple sideband links/multiple stacks and this is described in Section 8.2.4.3. Because MTPs can be large (up to 2K payload) and can block the sideband link for regular link management traffic (as described in Table 7-1 except opcodes 10111b and 11000b), there is a mechanism provided to periodically arbitrate the link between link management packets/messages and MPMs over the sideband link. Additionally, to allow management path over sideband (when supported) to operate independent of mainband link status (which is required for certain management use cases such as FW download), UCIe link state machine supports sending/receiving management packets over sideband in all link states including RESET (see Chapter 4.0 for details). In Figure 8-33 and Figure 8-34, the location of the Management Port Gateway mux is shown for reference purposes only. Implementations can choose to locate the mux elsewhere (e.g., above FDI for sideband path) and details of such implementations are beyond the scope of this specification. Interface definitions for this architecture, seen in Chapter 10.0, and other details discussed around Management Port Gateway integration are with respect to this reference Management Port Gateway mux placement. The Management Port Gateway interfaces to the D2D Adapter by way of the FDI for mainband transport as shown in Figure 8-34, and FDI is described in Chapter 10.0. The Management Port Gateway can also connect directly to D2D by way of the FDI. Supported configurations of Management Port Gateway connectivity to D2D are shown in Figure 8-35. The terminology used throughout this chapter will be in reference to the concepts shown in Figure 8-33 and Figure 8-34. In case of CXL protocol, the Management Port Gateway mux is on the CXL.io FDI. Figure 8-35. Supported Configurations for Management Port Gateway Connectivity to D2D Adapter on Mainband Stack X Protocol (PCIe or Streaming) $S t a c k \quad X \quad P r o t o c o l$ (PCIe or Streaming) Stack Y Protocol (PCIe or Streaming) Management Port Gateway Management Port Gateway MTP Rx/Tx Queues MTP $R x / T x$ Queues MPG Mux MPG Mux MPG Mux Stack > Stack Stack -FDI -FDI- D2D Adapter D2D Adapter Config a Config b $x \text { Protocol CXL.io } ^ { 1 }$ Stack X Protocol CXL.io Stack Y Protocol CXL.io Stack Y Protocol CXL.cachemem $\text { Stack } \times \text { Protoco } }<br>{ \text { CXL. cachemem } } Management Port Gateway Stack X Protocol CXL.cachemem Management Port Gateway MTP Rx/Tx MTP $R x / T x$ Queues Queues Stack 0 MPG Mux Stack X MPG Mux MPG Mux Stack $- F D I -$ Stac -FDI Stac Stack ARB/MUX $D 2 D$ Adapter ARB/MUX D2D Adapter ARB/MUX $C o n f i g \quad c$ Config d $\mathrm { S t a c k } \times \mathrm { P r o t o c o l }$ (PCIe or Streaming) Stack X Protocol CXL.io Stack X Protocol CXL.cachemem $M a n a g e m e n t \quad P o r t \quad G a t e w a y$ MTP $R x / T x$ Queues Stack Y Protocol (CXL or PCIe or Streaming) Management Port Gateway MTP Rx/Tx Queues Stack Y Protocol (CXL or PCIe or Streaming) Stack X MPG Mux MPG Mux Stack Stack ) Stack > Stack -FDI -FDI- D2D Adapter ARB/MUX D2D Adapter Config e Config f Management Port Gateway Management Port Gateway MTP Rx/Tx Queues MTP Rx/Tx Queues $\left( C X L \quad o r \quad P C I e \quad o r \quad S t r e a m i n g \right)$ : 0 Stack X Stack X Stack ) -FDI -FDI- D2D Adapter D2D Adapter Config g Config h #### 8.2.2 Management Port Messages ##### 8.2.2.1 Sideband There are currently two MPM opcodes defined as shown in Table 7-1, "Sideband Packet Opcode Encodings Mapped to Sideband Packet Types". See Section 7.1.2.4 for more information. ##### 8.2.2.2 Mainband All MPMs on mainband carry a 2-DWORD header referred to as "MPM Header" (see Figure 8-36 and Figure 8-39). In that Header, bits [4:0] in the first DWORD carry the MPM opcode and are defined in Table 8-32. The remainder of this section discusses the format of these opcode messages. See Section 8.2.5.2.3 for details of how these messages are packed in the Management Flit when transmitting over the mainband. <table> <caption>Table 8-32. MPM Opcodes on Mainband</caption> <tr> <th>Opcode</th> <th>Message</th> </tr> <tr> <td>10111b</td> <td>MPM without Data</td> </tr> <tr> <td>11000b</td> <td>MPM with Data</td> </tr> <tr> <td>Others</td> <td>Reserved</td> </tr> </table> ##### 8.2.2.2.1 MPMs with Data Bits [21:14] in the first DWORD of the MPM header (see Figure 8-36) of an MPM with Data message form an 8b msgcode that denotes a specific MPM with Data message. Supported MPM with data messages on the mainband are shown in Table 8-33. <table> <caption>Table 8-33. Supported MPM with Data Messages on Mainband</caption> <tr> <th>msgcode</th> <th>Message</th> </tr> <tr> <td>01h</td> <td>Encapsulated MTP Message</td> </tr> <tr> <td>FFh</td> <td>Vendor-defined Management Port Gateway Message</td> </tr> <tr> <td>Others</td> <td>Reserved</td> </tr> </table> The term "MPM payload" is used in the remainder of this section to refer to the payload in the MPM with Data messages. ##### 8.2.2.2.1.1 Common Fields in MPM Header of MPM with Data Messages on Mainband Figure 8-36 shows and Table 8-34 describes the common fields in the MPM header of MPM with data messages on the mainband. <table> <caption>Figure 8-36. Common Fields in MPM Header of all MPM with Data Messages on Mainband</caption> <tr> <th colspan="6">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th colspan="8">0</th> </tr> <tr> <th>31 30</th> <th>29 28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th>8</th> <th>7</th> <th>6</th> <th></th> <th>54</th> <th>3</th> <th></th> <th></th> <th>210</th> </tr> <tr> <td colspan="3">rsvd</td> <td></td> <td>re sp</td> <td></td> <td>VC</td> <td></td> <td></td> <td></td> <td colspan="4">msgcode</td> <td></td> <td></td> <td></td> <td></td> <td colspan="4">length</td> <td colspan="2"></td> <td>rs vd</td> <td colspan="5">$o p c o d e = 1 1 0 0 0 b$</td> </tr> <tr> <td colspan="6">rsvd</td> <td></td> <td></td> <td colspan="10">msgcode-specific</td> <td colspan="4"></td> <td colspan="2">rsvd</td> <td colspan="2">msgcode- specific</td> <td colspan="3">rsvd</td> <td>rxq id</td> </tr> </table> <table> <caption>Table 8-34. Common Fields in MPM Header of all MPM with Data Messages on Mainband (Sheet 1 of 2)</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>opcode</td> <td>11000b: MPM with Data.</td> </tr> <tr> <td>length</td> <td>MPM Payload length (i.e., 0h for 1 QWORD, 1h for 2 QWORDs, 2h for 3 QWORDs, etc.).</td> </tr> <tr> <td>msgcode</td> <td>Message code as defined in Table 8-33.</td> </tr> </table> <table> <caption>Table 8-34. Common Fields in MPM Header of all MPM with Data Messages on Mainband (Sheet 2 of 2)</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>VC</td> <td>Virtual Channel ID.</td> </tr> <tr> <td>resp</td> <td>0: Request MPM. 1: Response MPM. For a Vendor-defined Management Port Gateway Message with Data, this bit is always 0 (see Section 8.2.2.2.1.3).</td> </tr> <tr> <td>rxqid</td> <td>RxQ-ID to which this packet is destined. See Section 8.2.3.2.2 for RxQ details. rxqid=0 corresponds to Stack 0. rxqid=1 corresponds to Stack 1.</td> </tr> </table> ##### 8.2.2.2.1.2 Encapsulated MTP Message Encapsulated MTP on the mainband is an MPM with Data with a msgcode of 01h. <table> <caption>Figure 8-37. Encapsulated MTP on Mainband</caption> <tr> <th rowspan="2"></th> <th colspan="7">3</th> <th colspan="7">2</th> <th colspan="4">1</th> <th colspan="6">0</th> <th rowspan="2"></th> <th rowspan="3"></th> </tr> <tr> <th>31 30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20 19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13 12 11</th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> <tr> <th rowspan="2">a</th> <th colspan="4">rsvd</th> <th></th> <th>re sp</th> <th></th> <th colspan="2">VC</th> <th></th> <th colspan="6">$m s g c o d e = 0 1 h$</th> <th colspan="3">length</th> <th>rs vd</th> <th colspan="2">opcode =</th> <th colspan="2">11000b</th> <th></th> </tr> <tr> <th colspan="2"></th> <th colspan="2"></th> <th></th> <th></th> <th></th> <th></th> <th colspan="4">rsvd</th> <th colspan="5"></th> <th colspan="2">rsvd</th> <th>s</th> <th>p</th> <th colspan="2">rsvd</th> <th>rxq id</th> <th></th> <th></th> </tr> <tr> <td></td> <td colspan="4">...</td> <td colspan="3"></td> <td colspan="7">...</td> <td colspan="4">DWORD 0: Byte 1</td> <td colspan="6">DWORD 0: Byte 0</td> <td></td> <td></td> </tr> <tr> <td></td> <td colspan="3"></td> <td>...</td> <td colspan="3"></td> <td colspan="4">...</td> <td colspan="3"></td> <td colspan="4">DWORD 1: Byte 1</td> <td colspan="6">DWORD 1: Byte 0</td> <td></td> <td></td> </tr> <tr> <td>b</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td colspan="3">...</td> <td></td> <td colspan="4"></td> <td></td> <td></td> <td>c</td> <td>d</td> </tr> <tr> <td></td> <td></td> <td colspan="3"></td> <td colspan="13">1 DWORD padding of all 0s (if required)</td> <td></td> <td colspan="4"></td> <td colspan="2"></td> <td>e</td> <td></td> </tr> </table> <figure> </figure> a. MPM Header. b. MPM Payload. c. Management Transport Packet (MTP). d. Length in MPM Header. e. DWORD padding. <table> <caption>Table 8-35. Encapsulated MTP on Mainband Fields</caption> <tr> <th>Location</th> <th>Bit</th> <th>Description</th> </tr> <tr> <td rowspan="2">$M P M \quad H e a d e r$</td> <td>s</td> <td>Segmented MTP (see Section 8.2.4.2). The first and middle segments in a segmented MTP have this bit set to 1. The last segment in a segmented MTP will have this bit cleared to 0. An unsegmented MTP also has this bit cleared to 0.</td> </tr> <tr> <td>p</td> <td>1-DWORD padding of all 0s added at the end of the packet, if required to align to a QWORD boundary.</td> </tr> <tr> <td>MPM Payload</td> <td>—</td> <td>See Section 8.1.3.1 for details. Note that DWORDx: Bytey in Figure 8-37 refers to the corresponding DWORD, Byte defined in the Management Transport Packet in Figure 8-5.</td> </tr> </table> a. See Section 8.2.2.2.1.1 for details of header fields common to all MPMs with data on the mainband. ##### 8.2.2.2.1.3 Vendor-defined Management Port Gateway Message The Vendor-defined Management Port Gateway message with data is defined for custom communication between MPGs on the two ends of a UCIe mainband link. These messages are not part of the Management transport protocol, and these messages start at an MPG and terminate at the MPG on the other end of the UCIe mainband link. These messages share the same rxqid buffers as encapsulated MTP messages. If an MPG does not support these messages or does not support vendor-defined messages from a given vendor (identified by the UCIe Vendor ID in the header), the MPG silently drops those messages. Ordering of these messages sent over multiple mainband stacks is subject to the same rules presented in Section 8.2.4.3 for encapsulated MTPs. <table> <caption>Figure 8-38. Vendor-defined Management Port Gateway Message with Data on Mainband</caption> <tr> <th colspan="7">3</th> <th colspan="8">2</th> <th colspan="7">1</th> <th colspan="8">0</th> </tr> <tr> <th>31 30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12 11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> </tr> <tr> <td colspan="3">rsvd</td> <td></td> <td></td> <td>$r e$ sp = 0</td> <td></td> <td>VC</td> <td></td> <td></td> <td></td> <td></td> <td colspan="3">msgcode = FFh</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>length</td> <td></td> <td></td> <td></td> <td>rs vd</td> <td></td> <td>opcode</td> <td>=</td> <td colspan="2">11000b</td> </tr> <tr> <td colspan="4">rsvd</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="9">UCIe Vendor ID</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="5">rsvd</td> <td>$r x q$</td> </tr> <tr> <td colspan="30">Vendor-defined payload</td> </tr> <tr> <td colspan="30"></td> </tr> </table> <figure> a b c </figure> a. MPM Header. b. MPM Payload. c. Length in MPM Header. <table> <caption>Table 8-36. Vendor-defined Management Port Gateway Message with Data on Mainband Fields</caption> <tr> <th>Location</th> <th>Field</th> <th>Description</th> </tr> <tr> <td>MPM Headerª</td> <td>UCIe Vendor ID</td> <td>UCIe Consortium-assigned unique ID for each vendor.</td> </tr> <tr> <td>MPM Payload</td> <td>—</td> <td>Vendor-defined.</td> </tr> </table> a. See Section 8.2.2.2.1.1 for details of header fields common to all MPMs with data on the mainband. #### 8.2.2.2.2 MPMs without Data Bits [21:14] in the first DWORD of the MPM header of an MPM without Data message form an 8b msgcode that denotes a specific MPM without Data message. Table 8-37 lists the supported msgcodes. <table> <caption>Table 8-37. Supported MPM without Data Messages on Mainband</caption> <tr> <th>msgcode</th> <th>Message</th> </tr> <tr> <td>01h</td> <td>Management Port Gateway Capabilities Message</td> </tr> <tr> <td>03h</td> <td>Init Done Message</td> </tr> <tr> <td>FFh</td> <td>Vendor-defined Management Port Gateway Message</td> </tr> <tr> <td>Others</td> <td>Reserved</td> </tr> </table> #### 8.2.2.2.2.1 Common Header Fields of MPM without Data Messages on Mainband Figure 8-39 shows and Table 8-38 describes the common fields in the MPM header of MPM without data messages on the mainband. <table> <caption>Figure 8-39. Common Fields in MPM Header of all MPM without Data Messages on Mainband</caption> <tr> <th colspan="6">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th colspan="7">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29 28</th> <th>27</th> <th>26</th> <th>25 24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> </tr> <tr> <td colspan="4">rsvd</td> <td></td> <td colspan="3">msgcode- specific</td> <td></td> <td></td> <td colspan="4">msgcode</td> <td></td> <td></td> <td></td> <td colspan="7">msgcode-specific</td> <td>rs vd</td> <td></td> <td colspan="3">opcode = 10111b</td> </tr> <tr> <td colspan="4">rsvd</td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td colspan="13">msgcode-specific</td> <td></td> <td></td> <td colspan="4">rsvd</td> <td>msgc ode- specif ic</td> </tr> </table> <table> <caption>Table 8-38. Common Fields in MPM Header of all MPM without Data Messages on Mainband</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>opcode</td> <td>10111b: MPM without Data.</td> </tr> <tr> <td>msgcode</td> <td>Message code as defined in Table 8-37.</td> </tr> </table> #### 8.2.2.2.2.2 Management Port Gateway Capabilities Message See Section 8.2.3.2.2 for details of how this message is used during mainband management path initialization. Figure 8-40 shows and Table 8-39 describes the Management Port Gateway Capabilities message format on the mainband. <table> <caption>Figure 8-40. Management Port Gateway Capabilities MPM on Mainband</caption> <tr> <th colspan="8">3</th> <th colspan="8">2</th> <th></th> <th colspan="7">1</th> <th></th> <th colspan="7">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </table> <table> <tr> <th rowspan="2">a</th> <th>rsvd</th> <th>$m s g c o d e = 0 1 h$</th> <th>NumVC rsvd</th> <th>$\mathrm { o p c o d e } = 1 0 1 1 1 b$</th> </tr> <tr> <td>rsvd</td> <td>$\mathrm { P o r t } I D \left[ 1 5 : 0 \right]$</td> <td></td> <td>rsvd</td> </tr> </table> a. MPM Header. <table> <caption>Table 8-39. Management Port Gateway Capabilities MPM Header Fields on Mainbanda</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>NumVC</td> <td>Number of VCs supported by the Management Port Gateway that is transmitting the message.</td> </tr> <tr> <td>Port ID</td> <td>Port ID number value of the Management port associated with the Management Port Gateway that is issuing the message (see Section 8.1.3.6.2.1).</td> </tr> </table> a. See Section 8.2.2.2.2.1 for details of header fields common to all MPMs without data on the mainband. #### 8.2.2.2.2.3 Init Done Message See Section 8.2.3.2.2 for details of how this message is used during mainband management path initialization. Figure 8-41 shows and Table 8-40 describes the Init Done message format on the mainband. <table> <caption>Figure 8-41. Init Done MPM on Mainband</caption> <tr> <th colspan="8">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th></th> <th colspan="7">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th>8</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th></th> <th></th> <th></th> <th>3210</th> </tr> <tr> <td></td> <td></td> <td></td> <td colspan="3">rsvd</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="5">msgcode = 03h</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>rsvd</td> <td></td> <td></td> <td></td> <td></td> <td colspan="5">$o p c o d e = 1 0 1 1 1 b$</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="3">rsvd</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td colspan="2"></td> <td>rxqi d</td> </tr> </table> a a. MPM Header. <table> <caption>Table 8-40. Init Done MPM Header Fields on Mainbanda</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>rxqid</td> <td>RxQ-ID associated with the message. See Section 8.2.3.2.2 for RxQ details.</td> </tr> </table> a. See Section 8.2.2.2.2.1 for details of header fields common to all MPMs without data on the mainband. #### 8.2.2.2.2.4 Vendor-defined Management Port Gateway Message The Vendor-defined Management Port Gateway message without data is defined for custom communication between the MPGs on both ends of a UCIe mainband link. These messages are not part of the management transport protocol, and these messages start at an MPG and terminate at the MPG on the other end of the UCIe mainband link. These messages share the same rxqid buffers as encapsulated MTP messages. If an MPG does not support these messages or does not support these messages from a given vendor (identified by the UCIe Vendor ID in the header), the MPG silently drops those messages. The Vendor-defined Management Port Gateway message without data on the mainband has the format shown in Figure 8-41. <table> <caption>Figure 8-42. Vendor-defined Management Port Gateway Message without Data on Mainband</caption> <tr> <th colspan="8">3</th> <th colspan="7">2</th> <th colspan="7">1</th> <th colspan="8">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17 16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> <tr> <td colspan="4">rsvd</td> <td></td> <td></td> <td>re sp = 0</td> <td></td> <td>VC</td> <td></td> <td></td> <td></td> <td colspan="3">msgcode = FFh</td> <td></td> <td></td> <td></td> <td colspan="5">Vendor-defined</td> <td></td> <td>rs vd</td> <td></td> <td>opcode</td> <td colspan="3">= 10111b</td> </tr> <tr> <td colspan="8">rsvd</td> <td></td> <td></td> <td colspan="12">UCIe Vendor ID</td> <td></td> <td></td> <td colspan="3">rsvd</td> <td colspan="2"></td> <td>$r \times q$ id</td> </tr> </table> a a. MPM Header. <table> <caption>Table 8-41. MPM Header Vendor-defined Management Port Gateway Message without Data on Mainbanda</caption> <tr> <th>Field</th> <th>Description</th> </tr> <tr> <td>$V C$</td> <td>Virtual Channel ID.</td> </tr> <tr> <td>resp</td> <td>Vendor-defined Management Port Gateway message without data always uses the Request channel.</td> </tr> <tr> <td>UCIe Vendor ID</td> <td>UCIe Consortium-assigned unique ID for each vendor.</td> </tr> <tr> <td>rxqid</td> <td>RxQ-ID to which this packet is destined. See Section 8.2.3.2.2 for RxQ details.</td> </tr> </table> a. See Section 8.2.2.2.2.1 for details of header fields common to all MPMs without data on the mainband. ### 8.2.3 Management Transport Path Setup Management transport path setup occurs in two distinct phases: · Negotiation phase - In this phase, support for management transport, and when supported, the number of RxQs present in the partner chiplet, are negotiated. This is required for backward compatibility. This negotiation is done separately for sideband and mainband. · Initialization phase - In this phase, the number of VCs supported is negotiated, and the RxQs in the Management Port Gateways on both ends of the link are initialized through credit exchanges for each supported VC. Port IDs are also exchanged. Section 8.2.3.1 describes the setup process for the sideband. Section 8.2.3.2 describes the setup process for the mainband. #### 8.2.3.1 Sideband Sideband Management Transport path setup occurs after a Management Reset or when Software writes 1 to the 'Retrain Link' bit in the Sideband Management Port Structure register (see Section 8.1.3.6.2.1). After setup is complete, management transport path over sideband remains active until the next Management Reset or until a 'Heartbeat timeout' is detected (as described in Section 8.2.5.1.3). #### 8.2.3.1.1 Negotiation Phase Steps Negotiation occurs in the MBINIT.PARAM state. See Section 4.5.3.3.1.1 for details. #### 8.2.3.1.2 Initialization Phase Steps If the Negotiation phase indicates support for Management transport and the SB_MGMT_UP flag (see Section 4.5) is cleared, Initialization phase steps are performed as indicated in this section. A few general rules for RxQs that are initialized in this phase: · Management Port Gateway maintains separate Rx queues for each sideband link over which it can receive MPMs. The Management Port Gateway can limit the number of Rx queues to be the same or smaller than the number of modules in the design. For example, in a design with four modules, a Management Port Gateway can choose to limit Rx queues to three or two or one. . Each Rx queue in the Management Port Gateway is assigned a separate RxQ-ID and it is relevant for maintaining ordering when interleaving MTPs across multiple sideband links. See Section 8.2.4.3. . See Section 8.2.4.1 for details of credit buffers that are required in each Rx queue. · Number of RxQs finalized for transmitting and receiving MPMs is 0 to MIN{RxQ-Local, RxQ- Remote}, where RxQ-Local and RxQ-Remote are defined in Section 4.5.3.3.1.1. . Transmission of MPMs with a given RxQ-ID is always associated with a specific local module that is design-specific. For example, an MPM with an RxQ-ID of 0 can be sent on any Module's sideband and that choice is design-specific. However, the choice is static and cannot change after the first MPM with that RxQ-ID is sent. · Credits associated with each RxQ-ID are exchanged with a remote link partner by way of Credit Return messages as discussed below. Initialization phase steps: After pm_param_done is asserted and there is >0 module count negotiated for management transport for the local and remote sides, the Management Port Gateway begins the initialization process to the remote MPG for each RxQ-ID that the MPG needs to enable. 1\. The initialization phase starts (shown in Figure 8-43, Figure 8-44, and Figure 8-45) with each Management Port Gateway sending the Management Port Gateway Capabilities message (see Figure 7-9 for message format). \- Message can be sent on any RxQ-ID path, but sent only once per initialization phase from a chiplet to the partner chiplet. \- Port ID value in the transmitted message is the value in Port ID field (see Table 8-12). \- Port ID value in the received message is recorded in the "Remote Port ID" field (see Table 8-12). \- NumVC field is the number of VCs supported by the transmitting Management Port Gateway. The number of VCs supported is the value in the NumVC field + 1. For example, if only one VC (VC0) is supported, NumVC is 0h. If two VCs are supported (VC0, VC1), then NumVC is 1h, etc. \- MIN{Transmitted NumVC, Received NumVC}+1 number of VCs is enabled by each Management Port Gateway in the subsequent steps. The value of the enabled VCs starts from 0 and increments by 1 for each enabled VC up to MIN{Transmitted NumVC, Received NumVC}. 2\. Management Port Gateway then sends credit Return messages for each enabled VC for each type (requests and responses), across all enabled RxQ-IDs. The Management Port Gateway is permitted to send this message. Figure 8-43 shows an example flow for the case of only a single RxQ (RxQ-ID=0) and single VC (VC0) negotiated during the negotiation phase. Figure 8-44 shows an example flow for the case of two RxQs (RxQ-ID=0, 1) and single VC (VC0) negotiated during the negotiation phase. Figure 8-45 shows an example flow for the case of only a single RxQ (RxQ- ID=0) and two VCs (VC0, VC1) negotiated during the negotiation phase. \- Credit Return message (see Figure 7-10) contains an "RxQ-ID" field. The field must be assigned starting from 0 to MIN{RxQ-Local, RxQ-Remote}-1. \- Infinite credits are permitted to be advertised. This is performed by sending a value of 3FFh in the "Rx Credit return in QWORDs" field for that VC and Type before the "Init Done". \- There is no ordering requirement for credit return messages across VCs, types, nor RxQ-IDs. Multiple credit return messages are permitted for a given VC, type, and RxQ-ID. <figure> <figcaption>Figure 8-43. Sideband Management Transport Initialization Phase Example with $R x Q - I D = 0$ and One VC (VCO)</figcaption> Management Port Gateway Capability -- Management Port Gateway Capabilities Credit Return [RxQ-ID=0: VCO-Request; VCO-Response] Credit Return [RxQ-ID=0: VCO-Request; VCO-Response] Init Done [RxQ-ID=0] Init Done [RxQ-ID=0] Chiplet 1 can transmit Management Transport Packets to $\mathrm { c h i p l e t } 0$ $C h i p l e t \quad 0 \quad c a n \quad t r a n s m i t$ Management Transport Packets to Chiplet 1 Chiplet 0- Chiplet 1- </figure> <figure> <figcaption>Figure 8-44. Sideband Management Transport Initialization Phase Example with $R x Q - I D = 0 ,$ 1 and One VC (VCO)</figcaption> Management Port Gateway Capability- Management Port Gateway Capabilities Credit Return [RxQ-ID=0: VCO-Request; VCO-Response] -Credit Return [RxQ-ID=1: VCO-Request; VCO-Response] Credit Return [RxQ-ID=0: VCO-Request; VCO-Response] Credit Return [RxQ-ID=1: VCO-Request; VCO-Response] Init Done $\left[ R \times Q - I D = 0 \right] -$ Legend Init Done $R \times Q - I D = 1$ Link A Link B Init Done [RxQ-ID=0] -Init Done RxQ-ID=1] Chiplet 0 can transmit Management Transport Packets to Chiplet 1 Chiplet 0- Chiplet 1- Chiplet $1 \quad c a n \quad t r a n s m i t$ Management Transport Packets to Chiplet 0 </figure> <figure> <figcaption>Figure 8-45. Sideband Management Transport Initialization Phase Example with $R x Q - I D = 0$ and Two VCs (VCO, VC1)</figcaption> Management Port Gateway Capabilitic. Management Port Gateway Capabilities Credit Return [RxQ-ID=0: VCO-Request; VC1-Request]- Credit Return [RxQ-ID=0: VCO-Response; VC1-Response] Credit Return [RxQ-ID=0: $\int _ { C O - R e q u e s t }$ VCO-Response] Credit Return [RxQ-ID=0: VC1-Request; VC1-Response] Init Done [RxQ-ID=0]- -Init Done [RxQ-ID=0]- Chiplet 0 can transmit Management Transport Packets to Chiplet 1 Chiplet 0- Chiplet 1- Chiplet 1 can transmit Management Transport Packets to Chiplet 0 </figure> 3\. After the last Credit Return message for a given RxQ-ID, the Management Port Gateway must send an "Init Done" message (see Figure 7-11) for the corresponding RxQ-ID. This informs the remote Link partner that a receiver has finished advertising credits for enabled VCs for the given RxQ-ID. \- After "Init Done" has been transmitted and received by a Management Port Gateway for all available RxQ-ID paths, the MPG is ready for sending Management Transport packets. o Sideband should be able to send/receive management transport packets at this point without any dependency on the mainband link status. o Management Port Gateway asserts the mp_mgmt_up and mp_mgmt_init_done signals to PHY to indicate that the Management Transport Path was successfully initialized. PHY sets the SB_MGMT_UP flag when both mp_mgmt_up and mp_mgmt_init_done are asserted. The flag remains set until the management path goes down. In case of any fatal error (e.g., credit return messages were received for an RxQ-ID that is not expected, a timeout occurred while waiting for the Init Done message, etc.) during RxQ credit exchange, the mp_mgmt_up signal will remain de-asserted with the mp_mgmt_init_done signal asserted. o Note that the Management Port Gateway is unaware of PHY states and thus, after the mp_mgmt_up signal is asserted, the Management Port Gateway assumes that the management path through the sideband is available unless there is a Management Reset or the MPG detects an error through the mechanism described in Section 8.2.5.1.3. o After the SB_MGMT_UP flag is set, sideband link is available for sideband packet (MPMs or any other sideband packets) transmission/reception in all state machine states including RESET/SBINIT. \- After the Management Port Gateway receives the "Init Done" message for a given RxQ-ID, the MPG must be ready to receive MTPs with that RxQ-ID. The PHY Layer routes a message with a given RxQ-ID (specified by the mp_rxqid signal) to a specific module's sideband link and that association is design-specific. Note that because RxQ-ID association to a module sideband is design-specific, on the same sideband link, messages with different RxQ-IDs in each direction are possible. #### 8.2.3.1.3 Other Sideband Management Transport Path Rules · Sideband interfaces successfully initialized for management transport are available for management transport regardless of the associated mainband module's state. \- Note that when management transport is NOT supported and Module 0's mainband is disabled at runtime, the sideband interface on that module is also disabled and D2D messages are routed to the sideband interface of the next-available lowest-numbered module that is enabled. When management transport is supported and enabled on the sideband link, the sideband link remains active for both management and non-management packets even if the corresponding mainband module is disabled. . If SW writes 1 to the 'Retrain Link' bit in the Management Port Structure register associated with a sideband link when the Management Path is already up on that port, the Management Port Gateway must follow the 'Heartbeat timeout' flow (see Section 8.2.5.1.3) to bring the management path down before instructing the PHY to restart link negotiation (by the sb_mgmt_init_start signal). #### 8.2.3.2 Mainband Mainband Management Transport path setup occurs when a link trains up. After the setup is complete, the management transport path remains active until a Domain Reset or until the link or the associated stack(s) goes down. #### 8.2.3.2.1 Negotiation Phase Steps Mainband Management Transport path negotiation occurs on every mainband link training, thereby leveraging the existing D2D adapter protocol negotiation messages/flows. Support for Management Transport protocol within a stack is explicitly indicated with a new bit in the negotiation flow (see Table 3-1). Section 3.1 and Section 3.2 provide Management Transport protocol negotiation details. At the end of protocol negotiation, the D2D adapter indicates the number of D2D stacks that negotiated Management Transport protocol by signals discussed in Table 10-3. #### 8.2.3.2.2 Initialization Phase Steps A few general rules for the RxQs that are initialized in this phase: · Management Port Gateway maintains separate Rx queues for receiving MTPs over each negotiated stack. · Each Rx queue within the Management Port Gateway is assigned a separate RxQ-ID, which is necessary for maintaining ordering when interleaving packets across multiple stacks. See Section 8.2.4.3. . See Section 8.2.4.1 for details of credit buffers that are required in each Rx queue. · RxQ-ID values are either 0 or 1. A value of 0 is used if only one stack is negotiated for management transport (regardless of the stack-id value negotiated) and values of 0 and 1 are used if two stacks are negotiated for management transport. In the latter case, an RxQ-ID value of 0 is used for Stack 0, and an RxQ-ID of 1 is used for Stack 1. When FDI transitions to active state (pl_state_sts=Active) from reset state (pl_state_sts=Reset) and Management transport was negotiated, the Management Port Gateway starts the Initialization phase. In a multi-stack implementation where management transport is present on both stacks, the D2D adapter flit negotiation, and protocol negotiation across both stacks must have completed (as indicated by the dm_param_exchange_done signal) before the Management Port Gateway starts its initialization sequence. The initialization flow follows the similar sequence as sideband and some example flows are illustrated below. The credit exchange is not by way of an explicit message as in sideband, but rather by way of a dedicated DWORD, 'CRD', in management flits whose format is shown in Figure 8-53 and further explained in Chapter 3.0. Management Port Gateway Capabilities and Init Done Message formats for the mainband can be seen in Section 8.2.2.2.2. Note that during initialization, the transmitter can return valid credits in the same Management Flit that carries the Init Done message. All protocol layer bytes in the management flit (minus the CRD and Rsvd bytes) carrying the 'Init Done' MPM are driven with NOPs after the 'Init Done' MPM. In Figure 8-46, Figure 8-47, and Figure 8-48, the labeling Mgmt_Flit {<MPM>, CRD[<credits returned>]} refers to a Management Flit that carries the specified MPM along with credit returns for the indicated credit types. For example: Mgmt_Flit {Init Done, CRD[RxQ-ID=0: VC0-Request, VC0-Response]} indicates a Management Flit that carries the Init Done message along with credit returns for the VC0 request and response credit types for RxQ-ID=0. <figure> <figcaption>Figure 8-46. Mainband Management Transport Initialization Phase Example with $R x Q - I D = 0$ and One VC (VCO)</figcaption> Mgmt_Flit {Management Port Gateway Can-bilities Mgmt_Flit {Management Port Gateway Capabilities} Mgmt_Flit {Init Done, CRD[RxQ-ID=0: VCO-Request, VCO-Response] } Mgmt_Flit {Init Done, CRD[RxQ-ID=0: VCO-Request, VCO-Response]} Chiplet 1 can transmit Management Transport Packets to Chiplet 0 Chiplet 0 can transmit Management Transport Packets to Chiplet 1 Chiplet 0- Chiplet 1- </figure> <figure> <figcaption>Figure 8-47. Mainband Management Transport Initialization Phase Example with $R x Q - I D = 0 ,$ 1 and One VC (VCO)</figcaption> Mgmt_Flit {Management Port Gateway Can-bilities} Mgmt_Flit $M a n a g e m e n t$ Port Gateway Capabilities} Mgmt_Flit {Init Done, CRD[RxQ-ID=0: VCO-Request, VCO-Response] } -Mgmt_Flit {Init Done, CRD[RxQ-ID=1: VCO-Request, VCO-Response] } Legend $\mathrm { S t a c k } A$ Stack B Mgmt_Flit {Init Done, CRD[RxQ-ID=0: VCO-Request, VCO-Response]} Mgmt_Flit {Init Done, CRD[RxQ-ID=1: VCO-Request, VCO-Response]} Chiplet 1 can transmit Management Transport Packets to Chiplet 0 Chiplet 0 can transmit Management Transport Packets to Chiplet 1 Chiplet 0- Chiplet 1- </figure> <figure> <figcaption>Figure 8-48. Mainband Management Transport Initialization Phase Example with $R x Q - I D = 0$ and Two VCs (VCO, VC1)</figcaption> Mgmt_Flit {Management Port Gateway Canabilities} Mgmt_Flit {Management Port Gateway Capabilities} Mgmt_Flit {CRD[RxQ-ID=0: VCO-Request, VCO-Response]} -Mgmt_Flit {Init Done, CRD[RxQ-ID=0: VC1-Request, VC1-Response] } Mgmt_Flit {CRD[RxQ-ID=0: VCO-Request, VC1-Request]} Mgmt_Flit {Init Done, CRD[RxQ-ID=0: VCO-Response, VC1-Response]} Chiplet 1 can transmit Chiplet 0 can transmit Management Transport Packets to Chiplet 1 Chiplet 1- $P a c k e t s \quad t o \quad C h i p l e t \quad 0$ Chiplet 0- </figure> #### 8.2.3.2.3 Other Mainband Management Transport Path Rules The following rules relate to Management Port Gateways and mainband Management Transport: . During runtime, if the FDI status on any stack that has management traffic negotiated moves to a Link Status=down state, the Management Port Gateway behaves the same as in the 'Init Done' timeout scenario (see Section 8.2.4.4) across both stacks, if more than one stack had management transport negotiated. · Arbitration between Management Flits and regular Protocol Layer Flits is implementation-specific. . When management Software writes 1 to the 'Retrain link' bit in the Management Port Structure register that corresponds to the mainband link, the mainband is retrained, similar to when SW writes 1 to the 'Start UCIe Link Training' bit in the UCIe Link Control register in the UCIe link DVSEC. Note that this retraining of the mainband does not affect the management path on the sideband (if that path had been negotiated), if the path was already set up and active. ### 8.2.4 Common Rules for Management Transport over Sideband and Mainband #### 8.2.4.1 Management Packet Flow Control The rules for management transport flow control are as follows: · Forward progress and Flow Control are managed by the Management Port Gateways. · Flow control credits are independent for sideband and mainband paths, if both are implemented in a given UCIe port. · Encapsulated MTPs are credited, and the credits cover both the header and payload portions of the encapsulated MTP. · Management Port Gateway Capability message, Credit return messages, Init Done messages, and PM-related messages must sink unconditionally at the destination. . Although the number of VCs supported in both directions is the same, TC-to-VC mapping can be different in each direction. See the Route Entry description in Section 8.1.3.6.2.2 for how SW controls mapping of TC to VC. · For each RxQ-ID in the Management Port Gateway: \- Independent credit management is required for each resp type (Requests vs. Responses), and each supported VC. \- Credits are in QWORD (64-bit) granularity (i.e., one credit corresponds to one QWORD of storage space at the receiver buffer). \- Minimum three credits are required for each credit type when nonzero credits are advertised. \- Header and Data portions of an Encapsulated Management Transport packet and Vendor- defined Management Port Gateway Messages use the same type of credit. \- Receiver implements separate buffers for Requests and Responses per supported VC and advertises the corresponding credits to the remote Management Port Gateway during initialization. Credits are returned when space is freed up in the receiver buffers. \- Up to eight VCs are permitted - different VC counts are permitted on sideband vs. mainband. o Support for VC0 is mandatory for all implementations. o For every VC supported, it is mandatory to initialize credits for Request types and Response types. o Credits advertised for a VC:Resp credit type during the initialization phase can be either 0 across all RxQ-IDs or nonzero across all RxQ-IDs. o If a VC is initialized, credits for that VC must be advertised on all enabled RxQ-IDs and Resp types. For example, it is NOT permitted to have a configuration where VC1 is supported on RxQ-ID 0 but not on RxQ-ID 1. However, it is not required to advertise the same number of credits on all enabled Paths. This rule is important to simplify Transmitter/Receiver implementations at Management Port Gateways for interleaving MTPs across multiple Links while maintaining ordering across them (see 1.4.3 for concept of interleaving). \- During management transport initialization and before the Init Done message is received, if multiple credit returns are received for the same VC: Resp credit type, the value from the latest credit return overwrites the previous value. · Number of RxQs (in the partner chiplet's Management Port Gateway) to which a Management Port Gateway can transmit management messages is always same as the number of RxQs to which the MPG can receive these messages (from the partner chiplet's Management Port Gateway). For example, if two RxQs were negotiated, both send and receive of management traffic must be on two RxQs. . If the initial credit advertised was infinite for a credit type, there cannot be any credits returned for that type at run time (i.e., after the Init Done message has been sent), with one exception for the "VCO request infinite credit" scenario for which a runtime credit return of 0 is permitted. · Credits advertised during the initialization phase are the maximum number of credits that can be outstanding at the transmitter at any point during runtime. . See Section 8.2.4.3 for the rules for maintaining ordering when interleaving MTPs/MTP Segments across different RxQ-IDs. . Chiplets can optionally check for the following error conditions during management path initialization flow, and abort the flow when these conditions are detected: \- Receiving credit returns for more RxQ-IDs than what was negotiated in the Negotiation Phase. \- Receiving credit returns for more VCs than what was implicitly negotiated by the Management Port Gateway Capabilities message. \- Not receiving credit returns or receiving incomplete credit returns for any of the negotiated RxQ-IDs prior to receiving the 'Init Done' message for the RxQ-ID. #### 8.2.4.2 Segmentation The Management Port Gateway is permitted to break up (i.e., segment) one large MTP and send the individual segments across multiple RxQ-IDs (i.e., interleave; see Figure 8-49 for an example). This is useful for cases in which the MTP message sizes are asymmetric. When segmenting: · Management Port Gateway sets the s bit in the Encapsulated MTP message header within each individual segment except the last segment that completes the MTP transfer. If an MTP is not segmented, the s bit is 0. Segments with the s bit set to 1 must not also have the p bit set to 1. · Transmitter must ensure that no other Encapsulated MTP OR no other credited MPM packet (e.g., Vendor-defined Management Port Gateway messages), from the same VC: Resp credit type is interleaved until the segmented management packet completes. Note that segmentation is visible only from Management Port Gateway-to-Management Port Gateway and is not end-to-end on the UCIe Management Fabric. See Section 8.2.4.3 for the rules for reassembling the segments and maintaining ordering when interleaving Segments across different RxQ-IDs. <table> <caption>Figure 8-49. Example Illustration of a Large MTP Transmitted over Multiple RxQ-IDs on Sideband with Segmentationª</caption> <tr> <td colspan="2">Management Transport Packet (MTP)</td> </tr> <tr> <td>QWORD 0</td> <td>MTP Header</td> </tr> <tr> <td>QWORD 1</td> <td>MTP Data 0</td> </tr> <tr> <td>QWORD 2</td> <td>MTP Data 1</td> </tr> <tr> <td>QWORD 3</td> <td>MTP Data 2</td> </tr> <tr> <td>QWORD 4</td> <td>MTP Data 3</td> </tr> <tr> <td>QWORD 5</td> <td>MTP Data 4</td> </tr> <tr> <td>QWORD 6</td> <td>MTP Data 5</td> </tr> <tr> <td>QWORD 7</td> <td>MTP Data 6</td> </tr> <tr> <td>QWORD 8</td> <td>MTP Data 7</td> </tr> <tr> <td>QWORD 9</td> <td>MTP Data 8</td> </tr> <tr> <td>QWORD 10</td> <td>MTP Data 9</td> </tr> <tr> <td>QWORD 11</td> <td>MTP Data 10</td> </tr> <tr> <td>QWORD 12</td> <td>MTP Data 11</td> </tr> <tr> <td>QWORD 13</td> <td>MTP Data 12</td> </tr> <tr> <td>QWORD 14</td> <td>MTP Data 13</td> </tr> <tr> <td>QWORD 15</td> <td>MTP Data 14</td> </tr> </table> <table> <tr> <td colspan="2">1st Segmentb - This goes on $R \times Q - I D = x$</td> </tr> <tr> <td>QWORD 0</td> <td>MPM Header $\left( s = 1 , \right.$ $\left. l e n g t h = 6 h \right)$</td> </tr> <tr> <td>QWORD 1</td> <td>MTP Header</td> </tr> <tr> <td>QWORD 2</td> <td>MTP Data 0</td> </tr> <tr> <td>QWORD 3</td> <td>MTP Data 1</td> </tr> <tr> <td>QWORD 4</td> <td>MTP Data 2</td> </tr> <tr> <td>QWORD 5</td> <td>MTP Data 3</td> </tr> <tr> <td>QWORD 6</td> <td>MTP Data 4</td> </tr> <tr> <td>QWORD 7</td> <td>MTP Data 5</td> </tr> <tr> <td colspan="2"></td> </tr> <tr> <td colspan="2">2nd Segmentb - This goes on RxQ-ID=MOD((x+1)/N)</td> </tr> <tr> <td>QWORD 8</td> <td>MPM Header $\left( s = 1 , \right.$ $\left. l e n g t h = 6 h \right)$</td> </tr> <tr> <td>QWORD 9</td> <td>MTP Data 6</td> </tr> <tr> <td>QWORD 10</td> <td>MTP Data 7</td> </tr> <tr> <td>QWORD 11</td> <td>MTP Data 8</td> </tr> <tr> <td>QWORD 12</td> <td>MTP Data 9</td> </tr> <tr> <td>QWORD 13</td> <td>MTP Data 10</td> </tr> <tr> <td>QWORD 14</td> <td>MTP Data 11</td> </tr> <tr> <td>QWORD 15</td> <td>MTP Data 12</td> </tr> <tr> <td colspan="2"></td> </tr> <tr> <td colspan="2">3rd Segmentb - This goes on RxQ-ID=MOD((x+2)/N)</td> </tr> <tr> <td>QWORD 0</td> <td>MPM Header $\left( s = 0 , \right.$ $\left. l e n g t h = 1 h \right)$</td> </tr> <tr> <td>QWORD 1</td> <td>MTP Data 13</td> </tr> <tr> <td>QWORD 2</td> <td>MTP Data 14</td> </tr> </table> a. N = Number of RxQ-IDs negotiated. x = Start value of RxQ-ID for an MTP. b. A segment is an Encapsulated MTP with its s bit set to 1. #### 8.2.4.3 Interleaving and Multi-module Sideband and Multi-stack Mainband Ordering When multiple RxQ-IDs are negotiated, the Management Port Gateway must interleave different MTPs of a given VC: Resp credit type across the different RxQ-IDs. For example, when the transmitter does not support Segmentation (see Section 8.2.4.2), if there are two MTPs, Pkt 1 and Pkt 2, both on VC0 and of Resp=0 type and two RxQ-IDs were negotiated, these must be sent on two different RxQ-IDs. This is called interleaving. When the transmitter supports Segmentation, individual Segments are also interleaved. This section discusses transmitter and receiver rules when interleaving so that the original management packet ordering (see Section 8.1.3.1.1) is maintained when the MTPs eventually make it to the management network on the receiving partner chiplet. For the purposes of discussing these rules in this section, the nomenclature of RxQ-IDx: VCy: Respz is used to refer to the credit buffer of RxQ-ID=x (x=0 to 3), VCy (y=0-7) and Respz (z=0 for Request and 1 for Response) type. #### 8.2.4.3.1 Transmitter Rules · First Encapsulated MTP after Management path setup, of a given VCy: Respz credit type is transmitted to the RxQ-ID0:VCy:Respz credit buffers of the partner chiplet. \- When the MTP is not segmented, the MTP is fully transmitted to the associated credit buffers and this could take multiple Encapsulated MTPs. In that scenario, each Encapsulated MTP carries the same MPM header but with the length field adjusted for the data length in that message. cr_ret _* fields are also refreshed in every Encapsulated MTP (on the sideband) and indicate 0 if there is no new credit to return. On the mainband path, credits can be refreshed every management flit. \- RxQ-ID is incremented by 1 for transmitting the next MTP of the same VCy: Respz credit type (i.e., the next MTP of VCy: Respz credit type is sent to RxQ-ID1:VCy: Respz credit buffers). \- When the MTP is segmented, a single Encapsulated MTP belonging to the MTP is transmitted to the associated buffers with the "s" bit set to 1. RxQ-ID is incremented by 1 (with wraparound as indicated later in this section) for transmitting each subsequent segment of the same MTP until the MTP is fully sent. After the MTP is fully sent, the RxQ-ID is incremented by 1 again (with wraparound as indicated later in this section) for transmitting the next MTP of the same VCy: Respz credit type. · The above scheme is repeated independently for traffic within each VCy: Respz credit type. Transmission of packets on different VCy: Respz queues have no dependencies between them. · RxQ-ID value wraps around after the maximum-negotiated RxQ-ID. . Transmission to multiple RxQ-ID buffers can occur in parallel on sideband links or mainband stacks. #### 8.2.4.3.2 Receiver Rules · On the Rx side, after a Management path setup, the Management Port Gateway services a full MTP (or in the case of Segmentation, one Encapsulated MTP of a MTP) on RxQ-ID0:VCy:Respz queue for a given VCy: Respz credit type. Note that receiving a full MTP could take multiple Encapsulated MTPs. \- Gateway then services the next MTP (or in case on Segmentation, the next Encapsulated MTP of the management packet) on the RxQ-ID1:VCy: Respz queue, and then on the RxQ- ID2:VCy: Respz queue (if supported), etc. \- In case of segmentation, the receiver can look at the "s" bit being cleared to 0 (from being set to 1 in prior segments) to know the last segment of an MTP. \- RxQ-ID value wraps around after the maximum-negotiated RxQ-ID. · The above receiver scheme applies independently for each VCy: Respz credit type and there are no dependencies between them. · Messages that do not consume credits must not be allocated into the credited Rx queues (credit returns, PM wake/ack/sleep messages) - and are unconditionally consumed by the Receiver. Figure 8-50 illustrates the ordering mechanism for an example scenario with three RxQ-IDs, and $\mathrm { y }$ VCs (where $\left. y = 0 - 7 \right)$ on the sideband. For the purposes of this illustration - TCO management port traffic is mapped to VC0 on the sideband management path. TCy management port traffic is mapped to VCy on the sideband management path. Note that in the figure, TC0 Req Pkt 1 and TC0 Resp Pkt 2 are segmented to two segments, to show the impact of segmentation on interleaving and ordering. Other MTPs are not segmented. Similar ordering applies for packets that are interleaved over multiple stacks on the mainband. Vendor-defined Management Port Gateway messages also use the same credited buffers as MTPs. Transmitter and receiver interleaving rules for these messages are the same as discussed earlier for Encapsulated MTPs. <figure> <figcaption>Figure 8-50. Conceptual Illustration of Sideband Multi-module Ordering with Three RxQs</figcaption> TCy Resp { \text { TC } }<br>{ \text { Da } } Req Represents the traffic ordering after RxQ arbitration { \text { TC0 } }<br>{ \text { Resp } } TC0 Req TCy MTP Resp Pkt 1 TCy MTP Req Pkt 1 t 2 TCy MTP Req Pkt 2 t 3 TCy MTP Req Pkt 3 t 4 TCO MTP Resp Pkt 1 Pkt 4 TCO MTP Req Pkt 1 t 2 TCO MTP Req Pkt 2 t 3 TCO MTP Req Pkt 3 t 4 TC0 MTP Req Pkt 4 The receiving Management Port Gateway starts processing from RxQ-ID=0, RxQ-ID=1, RxQ-ID=2, and then rolls back to RxQ-ID=0. The Management Port Gateway performs this process independently for each credit path (i.e., Request and Response for each VC). To management network in Management Port Gateway Management Port Gateway VCy Response buffers TCy eMTP Resp Pkt 1 TCy eMTP Resp Pkt 2 TCy eMTP Resp Pkt 3 VCy Request buffers TCy eMTP Req Pkt 1 4 TCy eMTP Req Pkt 2 TCy eMTP Req Pkt 3 TCy eMTP Req Pkt 4 VC0 Response buffers TC0 eMTP Resp Pkt 1 TC0 eMTP Resp Pkt 2 (1st Segment) ** TCO eMTP Req Pkt 1 4 (2nd Segment) * TCO eMTP Resp Pkt 2 and Segment) ** TCy eMTP Req Pkt 2 TCO eMTP Req Pkt 1 (1st Segment)* : 3 $\mathrm { e M T P } = \mathrm { E n c a p s u l a t e d } \mathrm { M T P }$ VC0 Request buffers TC0 eMTP Req Pkt 3 TC0 eMTP Req Pkt 4 \* TC0 MTP Req Pkt 1 is segmented into two Segments ** TC0 MTP Req Pkt 2 is segmented into two Segments RxQ-ID=0 $R \times Q - I D = 1$ RxQ-ID=2 +SB | Link 0- $\frac { 4 } { 6 }$ 1- +SB Link 2- Management Port Gateway VCy Response buffers TCy MTP Resp Pkt 1 VCy Request buffers TCy MTP Req Pkt 1 t 2 TCy MTP Req Pkt 2 t 3 TCy MTP Req Pkt 3 t 4 VC0 Response buffers TCO MTP Resp Pkt 1 Pkt 4 VC0 Request buffers TCO MTP Req Pkt 1 t 2 TCO MTP Req Pkt 2 t 3 TCO MTP Req Pkt 3 t 4 TC0 MTP Req Pkt 4 From management network in Management Port Gateway TC0 TC0 TCy TCy Req Resp Req Resp </figure> x #### 8.2.4.4 `Init Done' Timeout Flow During the Management Transport Initialization Phase, a 16-ms timeout (also referred to as 'Init Done' timeout) is applied for receiving an "Init Done" MPM from the start of initialization, across all available RxQ-IDs. If an 'Init Done' timeout occurs: · Management Port Gateway cannot schedule any new MPMs across any RxQ-ID and the MPG silently discards any MPMs received, and resets all the RxQ-ID credit counters and pointers. . Management Port Gateway indicates this status to management FW by way of the management port capability structure (see Section 8.1.3.6.2.1) and waits for SW to retrigger management path retraining. ### 8.2.5 Other Management Transport Details #### 8.2.5.1 Sideband #### 8.2.5.1.1 Management Port Gateway Flow Control over RDI See Section 7.1.3.1 for details. #### 8.2.5.1.2 MPMs with Data Length Rules When supporting MPMs with Data (see Section 7.1.2.4) over the sideband, to prevent these messages from occupying the sideband interface for extended periods of time (and thus blocking its usage for mainband link management packets), the following rules must be observed: · An MPM with Data (e.g., Encapsulated MTP) can have a maximum length field value of seven QWORDS . Receivers must not check for violation of this transmit rule. . If the original MTP was larger than seven QWORDs, multiple Encapsulated MTPs are sent until the full MTP is transmitted. It is also permitted to send Encapsulated MTPs smaller than seven QWORDs even when the original MTP is larger than seven QWORDs. This can occur because of credit availability for transmitting the Encapsulated MTP. . The above rules allow for the link to be arbitrated for any pending Link management packet OR any pending higher priority MEM packet of a different VC:Resp credit type (waiting behind an MPM with Data that is in transmission) with an upper bound on the delay to transmit them. An example of a higher-priority MPM packet that needs to be serviced in a time-bound fashion is a TC1 MTP (see Section 8.1.3.1.1). · Segmentation, when performed, must follow the rules described above for each individual Segment of the MTP. See Section 8.2.4.2 for description of segmentation. Figure 8-51 provides a pictorial representation of splitting a large MTP into multiple smaller Encapsulated MTPs (based on the length rules stated above) and how the Encapsulated MTPs are sent on the sideband link. If the MTP is also segmented, then each Encapsulated MTP is sent on a different RxQ-ID. See Section 8.2.4.2 and Section 8.2.4.3. See Section 4.8 for how the PHY arbitrates between MPMs and Link Management packets. <table> <caption>Figure 8-51. Example Illustration of a Large MTP Split into Multiple Smaller Encapsulated-MTPs for Transport over Sideband, without Segmentationª</caption> <tr> <td colspan="2">Management Transport Packet (MTP)</td> </tr> <tr> <td>QWORD 0</td> <td>MTP Header</td> </tr> <tr> <td>QWORD 1</td> <td>MTP Data 0</td> </tr> <tr> <td>QWORD 2</td> <td>MTP Data 1</td> </tr> <tr> <td>QWORD 3</td> <td>MTP Data 2</td> </tr> <tr> <td>QWORD 4</td> <td>MTP Data 3</td> </tr> <tr> <td>QWORD 5</td> <td>MTP Data 4</td> </tr> <tr> <td>QWORD 6</td> <td>MTP Data 5</td> </tr> <tr> <td>QWORD 7</td> <td>MTP Data 6</td> </tr> <tr> <td>QWORD 8</td> <td>MTP Data 7</td> </tr> <tr> <td>QWORD 9</td> <td>MTP Data 8</td> </tr> <tr> <td>QWORD 10</td> <td>MTP Data 9</td> </tr> <tr> <td>QWORD 11</td> <td>MTP Data 10</td> </tr> <tr> <td>QWORD 12</td> <td>MTP Data 11</td> </tr> <tr> <td>QWORD 13</td> <td>MTP Data 12</td> </tr> <tr> <td>QWORD 14</td> <td>MTP Data 13</td> </tr> <tr> <td>QWORD 15</td> <td>MTP Data 14</td> </tr> </table> <table> <tr> <td colspan="2">SB Encapsulated MTP 0 - This goes on RxQ-ID=x</td> </tr> <tr> <td>QWORD 0</td> <td>MPM Header $\left( s = 1 , \right.$ $\left. l e n g t h = 6 h \right)$</td> </tr> <tr> <td>QWORD 1</td> <td>MTP Header</td> </tr> <tr> <td>QWORD 2</td> <td>MTP Data 0</td> </tr> <tr> <td>QWORD 3</td> <td>MTP Data 1</td> </tr> <tr> <td>QWORD 4</td> <td>MTP Data 2</td> </tr> <tr> <td>QWORD 5</td> <td>MTP Data 3</td> </tr> <tr> <td>QWORD 6</td> <td>MTP Data 4</td> </tr> <tr> <td>QWORD 7</td> <td>MTP Data 5</td> </tr> <tr> <td colspan="2"></td> </tr> <tr> <td colspan="2">SB Encapsulated MTP 1 - This goes on RxQ-ID=x</td> </tr> <tr> <td>QWORD 8</td> <td>MPM Header $\left( s = 1 , \right.$ $\left. l e n g t h = 6 h \right)$</td> </tr> <tr> <td>QWORD 9</td> <td>MTP Data 6</td> </tr> <tr> <td>QWORD 10</td> <td>MTP Data 7</td> </tr> <tr> <td>QWORD 11</td> <td>MTP Data 8</td> </tr> <tr> <td>QWORD 12</td> <td>MTP Data 9</td> </tr> <tr> <td>QWORD 13</td> <td>MTP Data 10</td> </tr> <tr> <td>QWORD 14</td> <td>MTP Data 11</td> </tr> <tr> <td>QWORD 15</td> <td>MTP Data 12</td> </tr> <tr> <td colspan="2"></td> </tr> <tr> <td colspan="2">SB Encapsulated MTP 2 - This goes on $R \times Q - I D = x$</td> </tr> <tr> <td>QWORD 0</td> <td>MPM Header $\left( s = 0 , \right.$ $\left. l e n g t h = 1 h \right)$</td> </tr> <tr> <td>QWORD 1</td> <td>MTP Data 13</td> </tr> <tr> <td>QWORD 2</td> <td>MTP Data 14</td> </tr> </table> a. N = Number of RxQ-IDs negotiated. x = Start value of RxQ-ID for an MTP. #### 8.2.5.1.3 Sideband Runtime Management Transport Path Monitoring - Heartbeat Mechanism After the management transport path Initialization Phase completes, receiver starts an 8-ms `Heartbeat' timer that restarts whenever an MPM (i.e., opcode 10111b or 11000b) is received. Implementations are permitted to implement this timer as a global timer across all RxQ-IDs or as a timer per RxQ-ID. If the timer times out, the Management Port Gateway de-asserts the mp_mgmt_up signal after 16 ms which in turn clears the SB_MGMT_UP flag in the PHY and de-asserts the mp_mgmt_port_gateway_ready signal. After a Heartbeat timeout, Management Port Gateway functions similar to what occurs during a 'Init Done timeout' (see Section 8.2.4.4 for details). The Heartbeat timer stops after L1/L2 entry negotiation on the sideband path successfully completes, and restarts when L1/L2 exit negotiation starts. See Section 8.2.5.1.4 for details of Management path PM entry/exit flows. After the 'Init Done' message is been transmitted on an RxQ-ID path during the initialization Phase, the Management Port Gateway (MPG) must guarantee an MPM transmission of no more than 4 ms apart on the RxQ-ID path. If there are no scheduled messages to send on an RxQ-ID path, the MPG must send a credit return message (unless there was a Heartbeat timeout on the receiver side as stated in the previous paragraph) with VC value set to VC0, Resp value set to 0 and cr_ret value set to 0h. Note that the latter applies even if the MPG takes longer than 8 ms to exit L1/L2 before the MPG sends the associated PM exit message. If a control parity error is detected on any received MPM, the Management Port Gateway invokes the `Heartbeat timeout' flow. #### 8.2.5.1.4 Sideband Management Path Power Management Rules On the sideband interface, it is expected that there is higher-level firmware/software managing the deeper power states of Management Port Gateways on both sides. The sleep and wake req/ack/nak messages (see Figure 7-12) are provided to negotiate shutdown/wake of the management transport path for deep power states in which the Management Port Gateway logic can be clock gated or powered down (as coordinated by the higher-level firmware). It is especially useful for a low-power chiplet and/or SiP states flows to take advantage of these handshakes and coordinate entry and wake up of the Management Transport Path. These messages and negotiation must occur independently for each RxQ-ID path, and each direction. While not in a PM state, the Management Port Gateway must keep the mp_wake_req signal asserted and this informs the Physical Layer adapter to keep the logic up and running. ##### 8.2.5.1.4.1 Sideband PM Entry Rules · Management Port Gateway Transmitter that initiates the PM entry ensures that no other packets will be transmitted (other than credit returns and PM messages) on any of the enabled RxQ-ID paths. · Following the above, the Transmitter sends a "Sleep req" message on each of the RxQ-ID paths. After a "Sleep req" message is sent on an RxQ-ID path, only credit return messages can be transmitted on the path until a "Sleep ack" message is received on the path or a Sleep ack timeout occurs (see last bullet in this section below). If the former scenario, additional message transmissions are not permitted until the subsequent PM exit. In the latter scenario, message transmission can resume soon after the timeout. . After receiving a "Sleep req" message, the receiving Management Port Gateway must ensure that the corresponding Rx buffer is empty, and that all pending credit returns have been sent to the remote Link partner. After these conditions are met, a "Sleep ack" message is scheduled. . If a chiplet responded with a "Sleep ack" message, the chiplet must send a "Sleep req" message (if not already sent) within 16 ms of sending the "Sleep ack" and receive a response to complete the flow; otherwise, sleep entry is aborted. . After a Management Port Gateway has sent and received a "Sleep Ack" message on all paths, the MPG is permitted to clock gate or power down, etc. The Management Port Gateway must de- assert the mp_wake_req signal before entering the clock gated or power down state. · If Sleep Nak was sent or received, the sleep entry is aborted. · Transmitter of a "Sleep req" message can wait for an implementation-dependent timeout to receive a "Sleep ack" before aborting the flow. In multi-module implementations, the "Sleep ack" message must be received across all negotiated RxQ-ID paths before the timeout. ###### 8.2.5.1.4.2 Sideband PM Exit Rules · Management Port Gateway Transmitter that initiates the exit performs the mp_wake_req/ack handshake with its Physical Layer and schedules the "Wake req" message on each RxQ-ID path. · Partner chiplet's Physical Layer that receives the "Wake req" message over the sideband wakes up its Management Port Gateway by performing the pm_clk_req/ack handshake before transmitting the "Wake req" message in response. . After the partner chiplet's Management Port Gateway receives the "Wake Req" message, that Management Port Gateway must respond with a "Wake ack" message when the MPG is ready to receive credited packets into its Rx buffer. Moreover, the Management Port Gateway must initiate its own "Wake req" message to the remote Link partner if the MPG has not already done so. · After a "Wake ack" message is sent and received on all negotiated RxQ-IDs, the PM exit flow is complete and regular packet transfer can begin as soon as the last "Wake ack" message is transmitted. #### 8.2.5.1.5 Management Port Gateway Mux Arbitration There is no prescribed arbitration mechanism for the Management Port Gateway mux on the Sideband. Additionally, the size of Management Port Gateway Flow control buffers over RDI (see Section 8.2.5.1.1) is not specified for Management Port Gateway-initiated traffic. Implementations should take care to ensure that the PHY arbitration rules specified in Section 4.8 are not violated. #### 8.2.5.2 Mainband #### 8.2.5.2.1 NOP Message The Management Port Gateway inserts NOP messages whose format is shown in Figure 8-52, in all QWORD locations in a Management flit in which there is no MPM to send. NOP messages can start only at MPM boundaries within a flit. <table> <caption>Figure 8-52. Management Flit NOP Message on Mainband</caption> <tr> <th colspan="7">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th></th> <th colspan="7">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29 28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11 1</th> <th>10</th> <th>9</th> <th>8</th> <th>7</th> <th>6</th> <th>5</th> <th></th> <th></th> <th></th> <th>43210</th> <th></th> </tr> <tr> <td colspan="31">0000_0000h</td> </tr> <tr> <td colspan="18">0000_0000h</td> <td colspan="13"></td> </tr> </table> #### 8.2.5.2.2 Credit Return DWORD Format <table> <caption>Figure 8-53. Management Transport Credit Return DWORD (CRD) Format on Mainband</caption> <tr> <th></th> <th colspan="7">3</th> <th colspan="8">2</th> <th colspan="8">1</th> <th></th> <th colspan="7">0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> <tr> <td>cr_ret_resp_a</td> <td colspan="3">cr_ret vc_a</td> <td colspan="2"></td> <td colspan="5">cr_ret_a</td> <td></td> <td colspan="2"></td> <td colspan="2">rsvd</td> <td>cr_ret_resp_b</td> <td colspan="3">cr_ret vc_b</td> <td colspan="2"></td> <td colspan="5">cr_ret_b</td> <td></td> <td colspan="2"></td> <td>rsvd</td> <td>rxqid</td> </tr> </table> See Section 3.3.3 and Section 3.3.4 for details on where this DWORD is sent in a Management Flit for various Flit formats. The following rules apply: · rxqid field in the DWORD applies to both credit returns a and b shown in Figure 8-53 . During VC initialization, on the Management Flit that carries the Management Port Gateway Capability message, all credit return fields must be set to 0 · If there is no credit to return in credit return slots a or b (as shown in Figure 8-53), a value of 0 is used for all associated credit return fields . If credit returns a and b carry the same vc:resp fields, then the total credit returned for that rxqid: vc:resp credit type is the sum of cr_ret_a and cr_ret_b #### 8.2.5.2.3 Management Flit Formats On the mainband, MPMs are supported only over Flit Format 3 through Format 6. See Section 3.3.3 and Section 3.3.4 for a D2D view of the Management Protocol mapping over Flit Format 3 through Format 6. If Flit Format 1 and Format 2 are negotiated, the Management Protocol on that stack is disabled (if supported). Management flits have bits [7:6] of Byte 1 set to 10b. See Section 8.2.2.2 for packet format of MPMs over the mainband. Mapping of these MPMs over Flit Format 3 through Format 6 is as follows: · MPM header and each QWORD of MPM payload (when applicable) can be placed only at specified byte locations in the Management flit, and can start at the 1st byte in the Management flit in which "all bits are populated by protocol layer" (see Figure 2-1 for reference), and at subsequent 8B increments within the flit. While incrementing, only bytes in which "all bits are populated by the Protocol Layer" are considered, excluding CRD byte locations and bytes marked as rsvd for Protocol Layer (e.g., Flit Format 3, Bytes 40 through 43). This is pictorially shown in Figure 8-54. For the other colors, see Figure 2-1 for color mapping. b. B = Byte, C = CRC, CRD = Credit Return DWORD, FH = Flit Header, Rsvd = Reserved. All are numbered, as appropriate, a. Yellow cells indicate a Valid Management Port Message (MPM) header or Payload QWORD start location. … FH B0 0 FH B1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 … … … … 40 41 42 43 44 45 46 47 48 49 50 51 Rsvd 52 Rsvd 53 Rsvd 54 Rsvd 55 Rsvd 56 Rsvd 57 CRD B0 58 CRD B1 59 CRD B2 60 CRD B3 61 C1 B0 C0 B0 62 C1 B1 C0 B1 63 <table> <tr> <th></th> <th></th> <th></th> <th></th> <th>FH B0</th> <th>0</th> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>$F H \quad B 1$</td> <td>1</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>2</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>3</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>4</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>5</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>6</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>7</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>8</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>9</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>10</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>11</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>12</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>13</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>14</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>15</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>16</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>17</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>18</td> </tr> <tr> <td>…</td> <td>…</td> <td></td> <td>…</td> <td>…</td> <td>…</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>40</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>41</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>42</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>43</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>44</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>45</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>46</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td>47</td> </tr> <tr> <td>CRD B0</td> <td></td> <td></td> <td></td> <td></td> <td>48</td> </tr> <tr> <td>CRD B1</td> <td></td> <td></td> <td></td> <td></td> <td>49</td> </tr> <tr> <td>CRD B2</td> <td></td> <td></td> <td></td> <td></td> <td>50</td> </tr> <tr> <td>CRD B3</td> <td></td> <td></td> <td></td> <td></td> <td>51</td> </tr> <tr> <td rowspan="10">Reserved 10B</td> <td></td> <td></td> <td></td> <td></td> <td>52</td> </tr> <tr> <td colspan="2"></td> <td></td> <td></td> <td>53</td> </tr> <tr> <td colspan="2"></td> <td></td> <td></td> <td>54</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>55</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>56</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>57</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>58</td> </tr> <tr> <td></td> <td></td> <td rowspan="3">Reserved 4B</td> <td></td> <td>59</td> </tr> <tr> <td></td> <td></td> <td></td> <td>60</td> </tr> <tr> <td></td> <td></td> <td></td> <td>61</td> </tr> <tr> <td>C1 B0</td> <td></td> <td></td> <td>C0 B0</td> <td></td> <td>62</td> </tr> <tr> <td>C1 B1</td> <td colspan="2"></td> <td>C0 B1</td> <td></td> <td>63</td> </tr> </table> Format 5 <table> <tr> <th></th> <th></th> <th></th> <th></th> <th>0</th> </tr> <tr> <td></td> <td></td> <td></td> <td>$F H \quad B 1$</td> <td>1</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>2</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>3</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>4</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>5</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>6</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>7</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>8</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>9</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>10</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>11</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>12</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>13</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>14</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>15</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>16</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>17</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>18</td> </tr> <tr> <td>…</td> <td>…</td> <td>…</td> <td>…</td> <td>…</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>40</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>41</td> </tr> <tr> <td>Rsvd</td> <td></td> <td></td> <td></td> <td>42</td> </tr> <tr> <td>Rsvd</td> <td></td> <td></td> <td></td> <td>43</td> </tr> <tr> <td>Rsvd</td> <td></td> <td></td> <td></td> <td>44</td> </tr> <tr> <td>Rsvd</td> <td></td> <td></td> <td></td> <td>45</td> </tr> <tr> <td>CRD B0</td> <td></td> <td></td> <td></td> <td>46</td> </tr> <tr> <td>CRD B1</td> <td></td> <td></td> <td></td> <td>47</td> </tr> <tr> <td>CRD B2</td> <td></td> <td></td> <td></td> <td>48</td> </tr> <tr> <td>CRD B3</td> <td></td> <td></td> <td></td> <td>49</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>50</td> </tr> <tr> <td rowspan="4">Reserved 10B</td> <td></td> <td></td> <td></td> <td>51</td> </tr> <tr> <td></td> <td></td> <td></td> <td>52</td> </tr> <tr> <td></td> <td></td> <td></td> <td>53</td> </tr> <tr> <td></td> <td></td> <td></td> <td>54</td> </tr> <tr> <td rowspan="5"></td> <td></td> <td></td> <td></td> <td>55</td> </tr> <tr> <td></td> <td></td> <td></td> <td>56</td> </tr> <tr> <td></td> <td></td> <td></td> <td>57</td> </tr> <tr> <td></td> <td></td> <td></td> <td>58</td> </tr> <tr> <td></td> <td></td> <td></td> <td>59</td> </tr> <tr> <td>C0 B0</td> <td></td> <td></td> <td></td> <td>60</td> </tr> <tr> <td>C0 B1</td> <td></td> <td></td> <td></td> <td>61</td> </tr> <tr> <td colspan="2">C1 B0</td> <td></td> <td></td> <td>62</td> </tr> <tr> <td>C1 B1</td> <td></td> <td></td> <td></td> <td>63</td> </tr> </table> Format 4 0 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 1 Format 3 Figure 8-54. Valid MPM Header Start Locations for Various Flit Formatsa b … <table> <tr> <th></th> <th rowspan="2"></th> <th></th> <th></th> </tr> <tr> <th></th> <th></th> <th></th> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td rowspan="2"></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>Rsvd</td> <td></td> <td></td> <td></td> </tr> <tr> <td>Rsvd</td> <td></td> <td></td> <td></td> </tr> <tr> <td>Rsvd</td> <td></td> <td></td> <td></td> </tr> <tr> <td>Rsvd</td> <td></td> <td></td> <td></td> </tr> <tr> <td>FH B0</td> <td></td> <td></td> <td></td> </tr> <tr> <td>FH B1</td> <td></td> <td></td> <td></td> </tr> <tr> <td>CRD B0</td> <td></td> <td></td> <td></td> </tr> <tr> <td>CRD B1</td> <td></td> <td></td> <td></td> </tr> <tr> <td>CRD B2</td> <td></td> <td></td> <td></td> </tr> <tr> <td>CRD B3</td> <td></td> <td></td> <td></td> </tr> <tr> <td rowspan="9">Reserved 10B</td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> </tr> <tr> <td>C0 B0</td> <td></td> <td></td> <td></td> </tr> <tr> <td>C0 B1</td> <td></td> <td></td> <td></td> </tr> <tr> <td>C1 B0</td> <td></td> <td></td> <td></td> </tr> <tr> <td>C1 B1</td> <td></td> <td></td> <td></td> </tr> </table> Format 6 except for Rsvd. Starting at a valid MPM header byte location (as discussed above), Byte 0 of the first DWORD of the MPM header is sent at that byte, followed by Byte 1 of the first DWORD of the header at starting byte location+1 until Byte 3 of the 2nd DWORD of the header. This is followed by Byte 0 of the 1st DWORD of the MPM payload (if one exists), followed by Byte 1, Byte 2, Byte 3, etc., placed at incrementing byte locations. Non-CRD bytes, bytes that are not marked as reserved and those that are driven by the protocol layer are contiguously packed with MPM bytes after an MPM transmission starts and until the transmission ends. If an MPM cannot be fully transmitted within a Management Flit, the MPM continues in the subsequent Management Flit of the same stack. NOP message(s) (see Section 8.2.5.2.1) can be inserted between MPMs within a Management Flit. It is also valid to send a Management Flit with all NOP messages in the protocol layer-driven non-CRD bytes and non-reserved byte locations. CRD bytes in a Management Flit always carry the credit return information per the rules stated in Section 8.2.5.2.2. Figure 8-55 and Figure 8-56 show example mappings of three MPMs inside Flits of Format 3 and Format 5, respectively. The 1st MPM is of an MPM with Data type with a payload size of 15 QWORDs. The 2nd MPM is also of an MPM with Data type with a payload size of 6 QWORDs. The 3rd MPM is an MPM with a payload of size of 1 QWORD. NOPs are inserted after the end of the 3rd MPM until the end of the flit. ## Figure 8-55. Example Mapping of MPMs and NOPs in Flit of Format 3ª b 16 <table> <caption>Figure 8-56. Example Mapping of MPMs and NOPs in Flit of Format 5 ª b</caption> <tr> <th>MP D0B0</th> <th>MH D0B0</th> <th>MP D14B0</th> <th>MH D0B0</th> <th>0</th> </tr> <tr> <td>MP D0B1</td> <td>MH D0B1</td> <td>MP D14B1</td> <td>MH D0B1</td> <td>1</td> </tr> <tr> <td>MP D0B2</td> <td>MH D0B2</td> <td rowspan="32">…</td> <td>MH D0B2</td> <td>2</td> </tr> <tr> <td>MP D0B3</td> <td>MH D0B3</td> <td>MH D0B3</td> <td>3</td> </tr> <tr> <td>MP D1B0</td> <td>$M H \quad D 1 B 0$</td> <td>$M H \quad D 1 B 0$</td> <td>4</td> </tr> <tr> <td>MP D1B1</td> <td>$M H \quad D 1 B 1$</td> <td>$M H \quad D 1 B 1$</td> <td>5</td> </tr> <tr> <td>MP D1B2</td> <td>MH D1B2</td> <td>MH D1B2</td> <td>6</td> </tr> <tr> <td>MP D1B3</td> <td>$M H \quad D 1 B 3$</td> <td>MH D1B3</td> <td>7</td> </tr> <tr> <td>NOP</td> <td>MP D0B0</td> <td>MP D0B0</td> <td>8</td> </tr> <tr> <td>NOP</td> <td>MP D0B1</td> <td>MP D0B1</td> <td>9</td> </tr> <tr> <td>NOP</td> <td>MP D0B2</td> <td>MP D0B2</td> <td>10</td> </tr> <tr> <td>NOP</td> <td>MP D0B3</td> <td>MP D0B3</td> <td>11</td> </tr> <tr> <td>NOP</td> <td>MP D1B0</td> <td>MP D1B0</td> <td>12</td> </tr> <tr> <td>NOP</td> <td>MP D1B1</td> <td>$\mathrm { M P D 1 B 1 }$</td> <td>13</td> </tr> <tr> <td>NOP</td> <td>MP D1B2</td> <td>MP D1B2</td> <td>14</td> </tr> <tr> <td>NOP</td> <td>MP D1B3</td> <td>MP D1B3</td> <td>15</td> </tr> <tr> <td>…</td> <td rowspan="12">…</td> <td rowspan="18">…</td> <td rowspan="2">17 18 ...</td> </tr> <tr> <td>NOP</td> </tr> <tr> <td>Rsvd</td> <td>40</td> </tr> <tr> <td>Rsvd</td> <td>41</td> </tr> <tr> <td>Rsvd</td> <td>42</td> </tr> <tr> <td>Rsvd</td> <td>43</td> </tr> <tr> <td>FH B0</td> <td>44</td> </tr> <tr> <td>FH B1</td> <td rowspan="9">45 46 47 48 49 50 51 52 53 54 55 56 57</td> </tr> <tr> <td>CRD B0</td> </tr> <tr> <td>CRD B1</td> </tr> <tr> <td>CRD B2</td> </tr> <tr> <td rowspan="6">CRD B3 Reserved 10B</td> </tr> <tr> <td>MP D11B3</td> </tr> <tr> <td>MH D0B0</td> </tr> <tr> <td>MH D0B1</td> </tr> <tr> <td>MH D0B2</td> </tr> <tr> <td>MH D0B3</td> <td></td> </tr> <tr> <td>C0 B0</td> <td>MH D1B0</td> <td>60</td> </tr> <tr> <td>C0 B1</td> <td>$M H \quad D 1 B 1$</td> <td>MP D30B1</td> <td>MP D13B1</td> <td>61</td> </tr> <tr> <td>C1 B0</td> <td>MH D1B2</td> <td>MP D30B2</td> <td>MP D13B2</td> <td>62</td> </tr> <tr> <td>C1 B1</td> <td>MH D1B3</td> <td>MP D30B3</td> <td>MP D13B3</td> <td>63</td> </tr> </table> b. B = Byte, C = CRC, CRD = Credit Return DWORD, D = DWORD, FH = Flit Header, MH = MPM Header, MP = MPM Payload, NOP = No Operation, Rsvd = Reserved. a. See Figure 2-1 for color mapping. 63 NOP = No Operation. a. See Figure 2-1 for color mapping. <table> <tr> <th>MH D0B0</th> <th>MP D28B0</th> <th>MP D13B2</th> <th>FH B0</th> <th>0</th> </tr> <tr> <td>MH D0B1</td> <td>MP D28B1</td> <td>D13B3 $M P$</td> <td>$F H \quad B 1$</td> <td>1</td> </tr> <tr> <td>MH D0B2</td> <td>MP D28B2</td> <td rowspan="23">…</td> <td>MH D0B0</td> <td>2</td> </tr> <tr> <td>MH D0B3</td> <td>MP D28B3</td> <td>MH D0B1</td> <td>3</td> </tr> <tr> <td>$M H \quad D 1 B 0$</td> <td>MP D29B0</td> <td>MH D0B2</td> <td>4</td> </tr> <tr> <td>MH D1B1</td> <td>MP D29B1</td> <td>MH D0B3</td> <td>5</td> </tr> <tr> <td>MH D1B2</td> <td>MP D29B2</td> <td>$M H$ D1B0</td> <td>6</td> </tr> <tr> <td>MH D1B3</td> <td>MP D29B3</td> <td>MH D1B1</td> <td>7</td> </tr> <tr> <td>MP D0B0</td> <td>MH D0B0</td> <td>MH D1B2</td> <td>8</td> </tr> <tr> <td>MP D0B1</td> <td>MH D0B1</td> <td>$M H \quad D 1 B 3$</td> <td>9</td> </tr> <tr> <td>MP D0B2</td> <td>MH D0B2</td> <td>$M P$ DOBO</td> <td>10</td> </tr> <tr> <td>MP D0B3</td> <td>MH D0B3</td> <td>MP D0B1</td> <td>11</td> </tr> <tr> <td>MP D1B0</td> <td>$M H \quad D 1 B 0$</td> <td>$M P$ DOB2</td> <td>12</td> </tr> <tr> <td>MP D1B1</td> <td>$M H \quad D 1 B 1$</td> <td>$M P$ DOB3</td> <td>13</td> </tr> <tr> <td>MP D1B2</td> <td>$M H \quad D 1 B 2$</td> <td>MP D1B0</td> <td>14</td> </tr> <tr> <td>MP D1B3</td> <td>MH D1B3</td> <td>MP D1B1</td> <td>15</td> </tr> <tr> <td>NOP</td> <td>$M P$ DOBO</td> <td>MP D1B2</td> <td>16</td> </tr> <tr> <td>NOP</td> <td>MP D0B1</td> <td>MP D1B3</td> <td>17</td> </tr> <tr> <td>NOP</td> <td>MP D0B2</td> <td>MP D2B0</td> <td>18</td> </tr> <tr> <td>NOP …</td> <td rowspan="10">MP D0B3 …</td> <td rowspan="8">MP D2B1 …</td> <td>... 40 41 42 43 44</td> </tr> <tr> <td>NOP</td> <td rowspan="4">46 47 48 49 50</td> </tr> <tr> <td>CRD B0</td> </tr> <tr> <td>CRD B1</td> </tr> <tr> <td>CRD B2</td> </tr> <tr> <td rowspan="4">CRD B3 Reserved 10B</td> <td>51 52 53</td> </tr> <tr> <td>MP D27B3</td> <td rowspan="2">56 57 59</td> </tr> <tr> <td rowspan="2">Reserved 4B</td> </tr> <tr> <td>MP D12B3</td> <td>61</td> </tr> <tr> <td>C1 B0</td> <td>C0 B0</td> <td>MP D13B0</td> <td>62</td> </tr> <tr> <td>C1 B1</td> <td>MP D11B3</td> <td>C0 B1</td> <td>MP D13B1</td> <td></td> </tr> </table> 60 b. B = Byte, C = CRC, CRD = Credit Return DWORD, D = DWORD, FH = Flit Header, MH = MPM Header, MP = MPM Payload, 45 54 55 58 58 59 Figure 8-57 shows an example mapping of four MPMs inside a Format 3 flit. The 3rd MPM rolls over into the 2nd flit. The 1st MPM in this example is of an MPM with Data type with a payload size of 15 QWORDs. The 2nd MPM is also of an MPM with Data type with a payload size of 6 QWORDs. The 3rd MPM is an MPM with payload size of 6 QWORDs, where the 6th QWORD is sent in the 2nd Flit. The 4th MPM in this example is a 1-QWORD Vendor-defined Management Port Gateway message without data. The remainder of the 2nd flit is all NOPs. ## Figure 8-57. Example MPM Mapping to Management Flit for Format 3 with MPM Rollover to Next Flita b 14 15 16 17 18 40 41 42 43 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 $\frac { 7 } { 8 }$ <table> <tr> <th>MP D0B0</th> <th>MH D0B0</th> <th>MP D14B0</th> <th>$M H$ DOBO</th> <th>0</th> </tr> <tr> <td>MP D0B1</td> <td>$M H \quad D O B 1$</td> <td>MP D14B1</td> <td>MH D0B1</td> <td>1</td> </tr> <tr> <td>MP D0B2</td> <td>$M H \quad D O B 2$</td> <td rowspan="33">…</td> <td>MH D0B2</td> <td>2</td> </tr> <tr> <td>MP D0B3</td> <td>MH D0B3</td> <td>MH D0B3</td> <td>3</td> </tr> <tr> <td>MP D1B0</td> <td>$M H \quad D 1 B 0$</td> <td>MH D1B0</td> <td>4</td> </tr> <tr> <td>MP D1B1</td> <td>$M H \quad D 1 B 1$</td> <td>$M H \quad D 1 B 1$</td> <td>5</td> </tr> <tr> <td>MP D1B2</td> <td>MH D1B2</td> <td>MH D1B2</td> <td>6</td> </tr> <tr> <td>$M P \quad D 1 B 3$</td> <td>MH D1B3</td> <td>MH D1B3</td> <td>7</td> </tr> <tr> <td>MP D2B0</td> <td>MP D0B0</td> <td>MP D0B0</td> <td>8</td> </tr> <tr> <td>MP D2B1</td> <td>$M P$ DOB1</td> <td>MP D0B1</td> <td>9</td> </tr> <tr> <td>MP D2B2</td> <td>MP D0B2</td> <td>MP D0B2</td> <td>10</td> </tr> <tr> <td>MP D2B3</td> <td>MP D0B3</td> <td>MP D0B3</td> <td>11</td> </tr> <tr> <td>MP D3B0</td> <td>MP D1B0</td> <td>MP D1B0</td> <td>12</td> </tr> <tr> <td>MP D3B1</td> <td>MP D1B1</td> <td>MP D1B1</td> <td>13</td> </tr> <tr> <td></td> <td></td> <td>MP D1B2</td> <td></td> </tr> <tr> <td></td> <td>$\frac { N P D 3 B 2 } { M P D 3 B 3 } \quad M P D 1 B 3$</td> <td>MP D1B3</td> <td></td> </tr> <tr> <td>…</td> <td rowspan="7"></td> <td rowspan="19">…</td> <td rowspan="3">...</td> </tr> <tr> <td>MP D9B3</td> </tr> <tr> <td>Rsvd</td> </tr> <tr> <td>Rsvd</td> <td rowspan="2"></td> </tr> <tr> <td>Rsvd</td> </tr> <tr> <td>Rsvd</td> <td></td> </tr> <tr> <td>FH B0</td> <td>44</td> </tr> <tr> <td>FH B1</td> <td rowspan="6">…</td> <td rowspan="5"></td> </tr> <tr> <td>CRD B0</td> </tr> <tr> <td>CRD B1</td> </tr> <tr> <td>CRD B2</td> </tr> <tr> <td>CRD B3</td> </tr> <tr> <td rowspan="6">Reserved 10B</td> <td></td> </tr> <tr> <td>MP D11B3</td> <td rowspan="5"></td> </tr> <tr> <td>MH D0B0</td> </tr> <tr> <td>MH D0B1</td> </tr> <tr> <td>MH D0B2</td> </tr> <tr> <td>MH D0B3</td> </tr> <tr> <td>C0 B0</td> <td>MH D1B0</td> <td></td> </tr> <tr> <td>C0 B1</td> <td>MH D1B1</td> <td>MP D30B1</td> <td>MP D13B1</td> <td></td> </tr> <tr> <td>C1 B0</td> <td>MH D1B2</td> <td>MP D30B2</td> <td>MP D13B2</td> <td></td> </tr> <tr> <td>C1 B1</td> <td>MH D1B3</td> <td>MP D30B3</td> <td>MP D13B3</td> <td></td> </tr> </table> $\frac { 7 } { 8 }$ <table> <tr> <th>NOP</th> <th>NOP</th> <th>NOP</th> <th>MP D10B0</th> <th>0</th> </tr> <tr> <td rowspan="18">...</td> <td rowspan="41">…</td> <td rowspan="41">…</td> <td>MP D10B1</td> <td>1</td> </tr> <tr> <td>MP D10B2</td> <td>2</td> </tr> <tr> <td>MP D10B3</td> <td>3</td> </tr> <tr> <td>MP D11B0</td> <td>4</td> </tr> <tr> <td>MP D11B1</td> <td>5</td> </tr> <tr> <td>MP D11B2</td> <td>6</td> </tr> <tr> <td>MP D11B3</td> <td>7</td> </tr> <tr> <td>MH D0B0</td> <td>8</td> </tr> <tr> <td>MH D0B1</td> <td>9</td> </tr> <tr> <td>MH D0B2</td> <td>10</td> </tr> <tr> <td>MH D0B3</td> <td>11</td> </tr> <tr> <td>MH D1B0</td> <td>12</td> </tr> <tr> <td>MH D1B1</td> <td>13</td> </tr> <tr> <td>MH D1B2</td> <td>14</td> </tr> <tr> <td>MH D1B3</td> <td>15</td> </tr> <tr> <td>NOP</td> <td>16</td> </tr> <tr> <td rowspan="25">…</td> <td>17</td> </tr> <tr> <td>18</td> </tr> <tr> <td>NOP</td> <td>...</td> </tr> <tr> <td>Rsvd</td> <td>40</td> </tr> <tr> <td>Rsvd</td> <td>41</td> </tr> <tr> <td>Rsvd</td> <td>42</td> </tr> <tr> <td>Rsvd</td> <td>43</td> </tr> <tr> <td>FH B0</td> <td>44</td> </tr> <tr> <td>FH B1</td> <td>45</td> </tr> <tr> <td>CRD B0</td> <td>46</td> </tr> <tr> <td>CRD B1</td> <td>47</td> </tr> <tr> <td>CRD B2</td> <td>48</td> </tr> <tr> <td>CRD B3</td> <td>49</td> </tr> <tr> <td rowspan="9">Reserved 10B</td> <td>50</td> </tr> <tr> <td>51</td> </tr> <tr> <td>52</td> </tr> <tr> <td>53</td> </tr> <tr> <td>54</td> </tr> <tr> <td>55</td> </tr> <tr> <td>56</td> </tr> <tr> <td>57</td> </tr> <tr> <td>58 59</td> </tr> <tr> <td>C0 B0</td> <td>60</td> </tr> <tr> <td>C0 B1</td> <td>61</td> </tr> <tr> <td>C1 B0</td> <td>62</td> </tr> <tr> <td>C1 B1</td> <td>NOP</td> <td>NOP</td> <td>NOP</td> <td>63</td> </tr> </table> 8.2.5.2.4 L1/L2 Link States and Management Transport 8.2.5.2.5 See Section 3.6 for details. # Link Reset/Link Disable and Management Transport For Management Transport on the mainband that has a Management Port Gateway mux, it should be noted that if the associated protocol stack resets or disables the link, the Management Transport path is also reset/disabled. If this is not desired, it is recommended that protocol stacks in such configurations have a way to disable sending link reset and link disable requests on the FDI so that the Management Transport path is not affected. a. See Figure 2-1 for color mapping. NOP = No Operation, Rsvd = Reserved. b. B = Byte, C = CRC, CRD = Credit Return DWORD, D = DWORD, FH = Flit Header, MH = MPM Header, MP = MPM Payload, ## 8.2.6 Retimers and Management Transport On the sideband, retimers can support management transport if the retimers need to be part of the UCIe management network. This support is optional. If supporting management transport, the retimers must abide by all the requirements stated earlier in this chapter for a generic chiplet implementation. When retimers are part of the management network, the retimers can be fully managed and be able to forward management packets between their UCIe interface and the retimed interface. On the mainband, retimers can optionally support management transport. ## 8.3 UCIe Debug and Test Architecture (UDA) ### 8.3.1 Overview UCIe Debug and Test (DFx) Architecture (UDA) provides a standardized test and debug infrastructure for UCIe-based chiplets and SiPs to enable standard test and debug methods in a UCIe-based open chiplet ecosystem. UDA is architected on top of UCIe Manageability Infrastructure and uses the architectural elements of that infrastructure for Chiplet-level and SiP-level testing and debug (see Section 8.1 for details of UCIe Manageability Architecture). UDA requires functional UCIe links (Sideband and/or Mainband) and a functional management network for test and debug purposes. Debug and bring-up of UCIe links and elements that comprise the UDA (see Section 8.3.1.1 through Section 8.3.1.4) can be performed by any sideband interface of choice (e.g., JTAG, GPIO, Sideband-only UCIe, etc.) of the chiplet vendor, and are beyond the scope of this specification. Within each chiplet, UDA is architected in a Hub-Spoke model. In this model, DFx Management Hub (DMH) is the Management Element that implements the Debug and Test Protocol(s). UDA allows for SW/FW to discover debug capabilities present in a chiplet, and provides for global security control/ status for test/debug functionality present in the chiplet. Chiplet test/debug functionality is implemented in DFx Management Spoke (DMS). Some examples of test/debug functionality are Scan controller, Memory BIST, SoC fabric debug, Core debug, trace protocol engine, etc. $I n \quad F i g u r e \quad 8 - 5 8 ,$ there is one DMH with a Management Network ID of 1040h and 4 DMSs connected to it with DMS-IDs (also referred to as Spoke-IDs) from 1 to 4. Management Network ID is used to route DFx and other relevant manageability packets to DMH in the manageability fabric. See Section 8.1.3.2 for how to interpret this ID. DMS-ID is used to route ID-routed Test and Debug packets to the correct Spoke within DMH. <figure> <figcaption>Figure 8-58. UDA Overview in Each Chiplet - Illustration</figcaption> Chiplet $\mathrm { U C I e }$ DMS MEMBIST DMS $D M S - I D = 2$ $D M S - I D = 3$ $D M H$ { \text { Management } }<br>{ \text { Metwork ID } = 1 0 4 0 1 } $= 1 0 4 0 h$ Scan Chain DMS Debug Protocol Engine DMS DMS-ID = 1 DMS-ID = 4 </figure> ### 8.3.1.1 DFx Management Hub (DMH) #### Key points about DMH: · DMH implements a set of registers that allow Management Firmware to: \- Enumerate test/debug capabilities within the chiplet \- Globally access control to/from debug functionality of DMS \- Reliably report status of test/debug functionality usage within the chiplet · DMH provides appropriate routing of Manageability packets that target various Spokes under it . There can be multiple DMHs within a chiplet · DMH can coexist with other protocol entities under the same Management Network ID · DMH registers are accessed by the UMAP protocol (see Section 8.1.4 for details) ### 8.3.1.2 DFx Management Spoke (DMS) #### Key points about DMS: · Spokes provide the required test/debug functionality in a chiplet. \- Some examples of test/debug functionality that can be implemented in a Spoke are MEMBIST, Scan controller, Core debug, SoC internal debug/test, PCIe link debug, UCIe link debug, Trace protocol, etc. \- Spoke definition is left to the chiplet vendor to decide based on the chiplet's test/debug requirements. · Spokes support the UMAP protocol and are discovered by SW as discussed in Section 8.3.5. · Spokes can optionally support Vendor-defined Test and Debug messages, and these messages are routed to the destination Spoke within a DMH using a DMS-ID. · Valid DMS-IDs for Spokes are from 1 to 254. A value of Oh is assigned for DMH. A value of FFh is reserved. · DMS-ID is unique within a given DMH. · DMH provides a pointer to the first DMS in a linked list of DMSs present within the DMH. · Each Spoke identifies itself as one of these types (see Section 8.3.5.3.2.8 for more details): \- UCIe.Physical_Layer \- UCIe.Adapter \- UCIe.Adapter_Physical_Layer \- Vendor-defined . Each Spoke implements a simple standard register set that helps to uniquely enumerate each Spoke and to allow custom SW to be loaded to interact with the Spoke. \- All Spokes minimally support DWORD Register Rd/Wr accesses. Support for sizes beyond that are optional. · Vendor-defined sections of the register space can be used for a vendor to implement any Spoke functionality such as triggering BIST, reading internal debug registers, array dump, etc. ### 8.3.1.3 Supported Protocols ### 8.3.1.3.1 UCIe Memory Access Protocol (UMAP) Used to access registers in DMH/DMS. See Section 8.1.4 for details of this protocol. ### 8.3.1.3.2 Vendor-defined Test and Debug Protocol Used for test as discussed in Section 8.3.2 and Section 8.3.3 and for any other vendor-defined functionality. Format of DWORDS 2 to M of Vendor-defined Test and Debug UCIe DFx Messages (or Vendor-defined UDM, for short) is shown below. DWORDs 0 to 1 of these messages follow the standard format of Management Transport packet described in Section 8.1.3, with the Management Protocol field set to 'Test and Debug Protocol'. Packet Integrity Protection DWORDs (that appear after DWORD M) are as defined in Section 8.1. . These messages are routed to the correct Spoke within a DMH, using the Destination DMS-ID field in Byte 8 of the message. . UCIe Vendor-ID field is the UCIe Consortium-assigned Vendor ID for the Spoke's IP Vendor In Figure 8-59, UCIe Vendor ID[15:8] is sent on Byte 0[7:0] of DWORD 3, and UCIe Vendor ID[7:0] is sent on Byte 1[7:0] of DWORD 3. <table> <caption>Figure 8-59. Vendor-defined Test and Debug UDM</caption> <tr> <th colspan="7">+0</th> <th colspan="7">+1</th> <th colspan="8">+2</th> <th colspan="8">+3</th> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>76543210765432107654321076543210</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </table> <figure> DWORD 2 Destination DMS-ID Source DMS-ID Sub Protocol = FFh (Vendor-defined) Reserved DWORD 3 UCIe Vendor ID • • • Vendor-defined Payload (Protocol-specific) DWORD M </figure> ## IMPLEMENTATION NOTE A Spoke's support for Vendor-defined UDM is negotiated/discovered using vendor- defined mechanisms. The Spoke Vendor ID and Spoke Device ID can be used to determine a specific Spoke implementation from a specific Vendor. Vendor-defined registers in the Spoke can be used to negotiate/discover the Vendor-defined Payload format of Vendor-defined UDM. ### 8.3.1.4 UDM and UCIe Memory Access Protocol Message Encapsulation over UCIe See Section 8.2 for details of how manageability messages (of which UCIe Memory Access Protocol and UDM are two subtypes) are negotiated, encapsulated, and transported over the UCIe sideband and Main band. ### 8.3.1.5 UCIe Test Port Options and Other Considerations See Chapter 5.0 for different port options for testing. #### 8.3.1.5.1 Determinism Considerations Testing with low-cost ATE typically requires cycle-accurate determinism. When using UCIe as a test port, how the determinism is achieved end-to-end is implementation-specific and beyond the scope of this specification. #### 8.3.1.6 DFx Security See Section 8.1.3.5 for details. #### 8.3.2 Sort/Pre-bond Chiplet Testing with UDA This section covers an overview of chiplet-level testing at Sort/Pre-bond using UCIe as the test port. Support for this testing scheme is optional. Figure 8-60 captures this scenario. <figure> <figcaption>Figure 8-60. UCIe-based Chiplet Testing/Debugging at Sort</figcaption> UCIe Chiplet UDM over UCIe Sideband/Mainband SoC Spoke MEMBIST DMS ATE UCIe Management Network UCIe-SB/MB $D M H$ at Standard Bump Pitch 100 to 130 um Scan Chain DMS PCIe DMS </figure> · UCIe sideband and/or mainband can be used for this testing if they have a bump pitch of 100 um to 130 um. · For sending/receiving scan test patterns, Vendor-defined UDMs (see Figure 8-59) are used over UCIe Sideband or mainband. These messages can target the appropriate Spoke (using the DMS- ID field) in the design that implements the scan functionality. · For general-purpose testing/debugging using register reads and writes, UCIe UMAP messages can be used (e.g., for triggering in-build self-test mechanisms in a chiplet, a UCIe register read/write mechanism can be used to trigger a test and then read the test results). In Figure 8-60, a UCIe Management port embedded in the UCIe controller provides access from the tester to the chiplet's manageability/test/debug fabric. The access control mechanism for ATE to acquire access to the UCIe Management network is implementation-specific. While the ATE interfaces covered above are UCIe sideband and mainband, other interfaces such as JTAG, GPIO, and PCIe are also possible. Vendors can implement a bridge from these interfaces, with appropriate security control, to the UCIe Management network. #### 8.3.3 SiP-level Chiplet Testing with UDA This section covers chiplet-level testing in a package that uses UCIe. Figure 8-61 provides an overview of this. Support for this testing scheme is optional. <figure> <figcaption>Figure 8-61. UCIe-based Testing of Chiplets in an SiP</figcaption> ATE JTAG/GPIO/PCIe/ .. Chiplet 0 DMH Chiplet 1 DMH Chiplet 2 DMH Chiplet 3 DMH Chiplet 4 DMH Chiplet 5 DMH Package UDM over UCIe Sideband or Mainband </figure> · There is at least one test/debug port pinned out in the package for SiP-level testing/debugging. \- The port could be any of JTAG, GPIO, PCIe, USB, SMBus, and/or I2(3)C. · More than one package port can be used for speeding up package-level test/debug. · Vendors can implement bridges, with appropriate security control, from these interfaces to the UCIe Management network. \- On the UCIe Management network, bridged packets follow the UCIe Management Transport Packet format. . Accesses from package ports are forwarded over UCIe sideband or mainband if they target other chiplets. See Section 8.1.3.2 for details of how the target chiplet of a Manageability packet is determined. . See Section 8.2.1 for details of how UDMs are encapsulated on the UCIe sideband and mainband. · Similar to sort testing, \- For sending/receiving scan test patterns, Vendor-defined UCIe DFx Messages (UDM) are used over UCIe. These messages can target the appropriate Spoke in the design that implements the scan control functionality. \- For general-purpose testing/debugging using register reads and writes, UMAP messages can be used, as defined in Section 8.1.4. ##### 8.3.4 System Debug with UDA For system-level debug, various interfaces can be used for Controllability/Observability. In Figure 8-62, an I3C interface running a debug protocol is the connection between the debugger and the DFx hooks on each chiplet. A x16 PCIe interface is used to send debug data to a logic analyzer. PCIe debug VDM packets can be used to carry debug information on this interface. Similarly, a remote debugger could access debug data over USB using an appropriate protocol. Note that per the UCIe Management Network Architecture requirements, a management bridge is required at the USB interface in Chiplet 5, or I3C interface in Chiplet 0, or x16 PCIe interface in Chiplet 2. <figure> <figcaption>Figure 8-62. UCIe-based System Testing/Debug</figcaption> Debugger Logic Analyzer Debug over I3C I3C PCIe Chiplet 0 Chiplet 1 DMH Chiplet 2 DMH DMH Chiplet 3 DMH Chiplet 4 DMH Chiplet 5 DMH Package USB Debug over USB Remote Debug Console </figure> ###### 8.3.5 DMH/DMS Registers ####### 8.3.5.1 DMH/DMS Register Address Space and Access Mechanism DMH and DMS registers are located within the memory space of the Management Element in which they reside. UMAP is used to access these registers. DMH and DMSs all share the same memory address space of the associated management element, and they each occupy specific address ranges within the address space. DMH and DMSs are discovered using a linked list with pointers in DMH and DMS register space, respectively. In Figure 8-63, DMH has two Spokes connected to it. The pointer in DMH points to the first DMS which then points to the next DMS. The pointer in the second DMS indicates the end of Spokes in the DMH with a value of all 0s in its Next pointer. All spec-defined registers in DMH and DMS are accessed in DWORD size only. The DMH base address in Figure 8-63 is from the Capability Directory of Management Element that hosts a DMH (see Section 8.1.3.6.1 for details). <figure> <figcaption>Figure 8-63. DMH/DMS Address Mapping</figcaption> FFFFFFFF_FFFFFFFFh DMS DMS_Next = 0h DMS DMS_Next DMH DMS_Start DMH Base Address </figure> ####### 8.3.5.2 DMH Registers DMH registers are defined in the DMH Capability shown in Figure 8-64. DBG_STS falls within the "Chiplet Status" Asset Class. All other spec-defined registers fall within the "Chiplet Configuration" asset class. Figure 8-64. DMH Capability Register Map 31 29 16 15 8 7 0 0B <table> <tr> <th>Rsvd</th> <th>Capability ID</th> <th>Reserved</th> <th>Ver</th> </tr> <tr> <td colspan="4">DBG_CAP</td> </tr> <tr> <td colspan="4">DBG_CTL</td> </tr> <tr> <td colspan="4">DBG_STS</td> </tr> <tr> <td colspan="4">DMH_Length_Low</td> </tr> <tr> <td colspan="4">DMH_Length_High</td> </tr> <tr> <td colspan="4">$D M H \_ E x t \_ C a p \_ L o w$</td> </tr> <tr> <td colspan="4">DMH_Ext_Cap_High</td> </tr> <tr> <td colspan="4">DMS_Start_Low</td> </tr> <tr> <td colspan="4">DMS_Start_High</td> </tr> <tr> <td colspan="3">Reserved</td> <td></td> </tr> <tr> <td colspan="3">Vendor-defined</td> <td></td> </tr> </table> 40B • • • 128B • • • $N$ <table> <caption>$8 . 3 . 5 . 2 . 1$ Ver (Offset 00h) Table 8-42. Version</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>7:0</td> <td>RO</td> <td>{ \text { Version } }<br>{ \text { Set to } 0 0 t }</td> </tr> </table> ####### 8.3.5.2.2 Capability ID (Offset 02h) <table> <caption>Table 8-43. Capability ID, Ver</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>13:0</td> <td>RO</td> <td>Capability ID Set to 2h to indicate DMH.</td> </tr> </table> ####### 8.3.5.2.3 DBG_CAP - Debug Capabilities (Offset 04h) <table> <caption>Table 8-44. Debug Capability</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$3 : 0$</td> <td>$R O$</td> <td>Version Set to 0h.</td> </tr> <tr> <td>$3 1 : 4$</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> <table> <caption>$8 . 3 . 5 . 2 . 4$ DBG_CTL - Debug Control (Offset 08h) Table 8-45. Debug Control</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RWL</td> <td>Disable Accesses to/from DMS 1: Disables UMAP and Test/Debug Vendor-defined UDM accesses to/from DMSs connected to the DMH from/to the UCIe Management network. 0: Enables accesses to DMSs connected to the DMH. Default is 1b. This bit is locked for writes if bit 1 in this register is set to 1.</td> </tr> <tr> <td>1</td> <td>$R O$</td> <td>Lock 'Disable Accesses to DMS' Default value is 0. After SW writes 1 to this bit, this bit cannot be modified further until the next Management Reset.</td> </tr> <tr> <td>31:2</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ####### 8.3.5.2.5 DBG_STS - Debug Status (Offset Ah) <table> <caption>Table 8-46. Debug Status</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>$R O$</td> <td>DMS Accessed At least one DMS was accessed from the management network since the last Management Reset. This bit is cleared on each Management Reset.</td> </tr> <tr> <td>31:1</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ####### 8.3.5.2.6 DMH_Length_Low - DMH Register Space Length Low (Offset 10h) <table> <caption>Table 8-47. DMH_Length_Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$3 1 : 1 2$</td> <td>$R O$</td> <td>Lower 20 bits of the length of the DMH register space in multiples of 4K. Bits [11:0] in this register are reserved to ensure 4k multiples of length. A value of 1000h for {DMH_Length_High :: DMH_Length_Low} indicates a length of 4K. A value 2000h indicates a length of 8K, etc.</td> </tr> <tr> <td>11:0</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ####### 8.3.5.2.7 DMH_Length_High - DMH Register Space Length High (Offset 14h) <table> <caption>Table 8-48. DMH_Length_High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$3 1 : 0$</td> <td>RO</td> <td>Upper 32 bits of the length of the DMH register space in multiples of 4K. A value of 1000h for {DMH_Length_High :: DMH_Length_Low} indicates a length of 4K. A value 2000h indicates a length of 8K, etc.</td> </tr> </table> --- # 8.3.5.2.8 DMH_Ext_Cap_Low - DMH Extended Capability Pointer Low (Offset 18h) <table> <caption>Table 8-49. DMH Extended Capability Pointer Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:2</td> <td>$R O$</td> <td>Lower 30 bits of the DWORD-aligned offset from the DMH starting address, where any extended capabilities start, when present in the DMH. Set to all 0s for this revision of the spec.</td> </tr> <tr> <td>1:0</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> <table> <caption>$8 . 3 . 5 . 2 . 9$ DMH_Ext_Cap_High - DMH Extended Capability Pointer High (Offset 1Ch) Table 8-50. DMH Extended Capability Pointer High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RO</td> <td>Upper 32 bits of the DWORD-aligned offset from the DMH starting address, where any extended capabilities start, when present in the DMH. Set to all 0s for this revision of the spec.</td> </tr> </table> # 8.3.5.2.10 DMS_Start_Low - DMS Starting Address Low (Offset 20h) <table> <caption>Table 8-51. DMS_Starting_Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$3 1 : 1 2$</td> <td>RO</td> <td>Lower 20 bits of the 4K-aligned starting address (in the UMAP address space of the management element that hosts the DMH) of the first DMS connected to the DMH.</td> </tr> <tr> <td>$1 1 : 0$</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 8.3.5.2.11 DMS_Start_High - DMS Starting Address High (Offset 24h) <table> <caption>Table 8-52. DMS_Starting_High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RO</td> <td>Upper 32 bits of the 4K-aligned starting address (in the UMAP address space of the management element that hosts the DMH) of the first DMS connected to the DMH.</td> </tr> </table> ## 8.3.5.3 DMS Registers Architected DMS registers are detailed in this section. The UCIe Consortium-assigned Vendor ID at Offset 00h of the DMS register map uniquely identifies each UCIe Vendor. A value of 0h for the Vendor ID indicates that the Spoke is an "empty" Spoke and the register map for such a Spoke is shown in Figure 8-65. For Spokes with a nonzero Vendor ID (also referred to as nonempty Spokes), a 'Spoke Type' value is defined that indicates whether the Spoke is associated with a UCIe link or if the Spoke is vendor-defined (see Section 8.3.5.3.2.8 for 'Spoke Type' definition): · If a Spoke is associated with a UCIe link, its 'Spoke Type' value is either 0, 1, or 2 (see Figure 8-67 for the register map) . If the Spoke is a vendor-defined Spoke, the 'Spoke type' value is assigned by the vendor within the range of 128 to 255 and some of the architected registers are not applicable (see Figure 8-68 for the register map) Figure 8-66 shows registers that are common for all Spoke types. For security, DMS registers are classified as follows. See Section 8.1.3.5.1 for the details of each class. · Spoke STS register falls within the 'Chiplet Status' asset class. · When applicable, UCIe Link Status in UCIe Link DVSEC, UCIe link-related status/log registers in the Adapter_Physical_Layer register block (e.g., Correctable/Uncorrectable Error Status), Compliance and Test-related status registers in the Compliance_Test register block (e.g., Physical Layer Compliance 1 and 2 Status registers), fall within the 'SiP Status' asset class. \- All standard UCIe link registers other than the ones noted above fall within the 'SiP Configuration' asset class. · All other spec-defined registers in DMS fall within the 'Chiplet Configuration' asset class. ### 8.3.5.3.1 "Empty" Spoke Registers Figure 8-65 shows the register map for "empty" Spokes. Designs can use this Spoke register structure to indicate that the Spoke does not have any Spoke functionality. 31 Figure 8-65. Empty Spoke Register Map <figure> 16 15 0 </figure> <table> <tr> <th>Reserved</th> <th>Spoke VID = 0hª</th> <th>0B</th> </tr> <tr> <td colspan="2">DMS_Next_Low</td> <td>4B</td> </tr> <tr> <td colspan="2">DMS_Next_High</td> <td>8B</td> </tr> </table> #### a. See Section 8.3.5.3.2.1. ##### 8.3.5.3.1.1 DMS_Next_Low - DMS Next Low Address (Offset 04h) <table> <caption>Table 8-53. DMS_Next_Low Address</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:12</td> <td>RO</td> <td>Lower 20 bits of the 4K-aligned starting address (in the UMAP address space of the management element that hosts the DMH) of the next DMS connected to the DMH. If this is the last Spoke in the Spoke chain, this field needs to be set to all 0s.</td> </tr> <tr> <td>11:0</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> <table> <caption>8.3.5.3.1.2 DMS_Next_High - DMS Next High Address (Offset 08h) Table 8-54. DMS_Next_High Address</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RO</td> <td>Upper 32 bits of the 4K-aligned starting address (in the UMAP address space of the management element that hosts the DMH) of the next DMS connected to the DMH. If this is the last Spoke in the Spoke chain, this field needs to be set to all 0s.</td> </tr> </table> ### 8.3.5.3.2 Common DMS Registers for All Non-empty Spokes Figure 8-66 shows the registers that are present in all non-empty Spokes. Locations marked as "Type-Specific" in Figure 8-66 carry registers that are specific to the 'Spoke Type' and are discussed in Section 8.3.5.3.3 and Section 8.3.5.3.4. Figure 8-66. Common DMS Registers for All Non-empty Spokes Register Map <figure> 31 24 23 16 15 8 7 0 Spoke DevID Spoke VID 0B DMS_Next_Low DMS_Next_High 48B • • • 80B • • • 128B • • • $N$ </figure> <table> <caption>8.3.5.3.2.1 Spoke VID - Spoke Vendor ID (Offset 00h) Table 8-55. Spoke Vendor ID</caption> <tr> <th colspan="2">Type-Specific</th> <th>Reserved</th> <th>Spoke RID</th> </tr> <tr> <td>Associated DMS-ID2</td> <td>Associated DMS-ID1</td> <td>Associated DMS-ID0</td> <td>DMS-ID</td> </tr> <tr> <td colspan="4">Spoke CAP</td> </tr> <tr> <td colspan="4">Spoke CTL</td> </tr> <tr> <td colspan="4">Spoke STS</td> </tr> <tr> <td colspan="4">DMS_Length_Low</td> </tr> <tr> <td></td> <td colspan="3">DMS_Length_High</td> </tr> <tr> <td colspan="4">DMS_Ext_Cap_Low</td> </tr> <tr> <td colspan="4">DMS_Ext_Cap_High</td> </tr> <tr> <td colspan="4">Type-Specific</td> </tr> <tr> <td colspan="4">Reserved</td> </tr> <tr> <td colspan="4">Type-Specific</td> </tr> </table> <table> <caption>8.3.5.3.2.2 Spoke DevID - Spoke Device ID (Offset 02h) Table 8-56. Spoke Device ID</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>15:0</td> <td>RO</td> <td>Spoke Vendor ID Uniquely identifies a Spoke Vendor to Software. This ID is assigned by UCIe Consortium.</td> </tr> </table> <table> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>15:0</td> <td>RO</td> <td>Spoke Device ID Uniquely identifies a device from the Vendor identified by the Vendor ID. This ID is assigned by the vendor.</td> </tr> </table> # 8.3.5.3.2.3 DMS_Next_Low - DMS Next Low Address (Offset 04h) <table> <caption>Table 8-57. DMS_Next_Low Address</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$3 1 : 1 2$</td> <td>$R O$</td> <td>Lower 20 bits of the 4K-aligned starting address (in the UMAP address space of the management element that hosts the DMH) of the next DMS connected to the DMH. If this is the last Spoke in the Spoke chain, this field needs to be set to all 0s.</td> </tr> <tr> <td>$1 1 : 0$</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> # 8.3.5.3.2.4 DMS_Next_High - DMS Next High Address (Offset 08h) <table> <caption>Table 8-58. DMS_Next_High Address</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RO</td> <td>Upper 32 bits of the 4K-aligned starting address (in the UMAP address space of the management element that hosts the DMH) of the next DMS connected to the DMH. If this is the last Spoke in the Spoke chain, this field needs to be set to all 0s.</td> </tr> </table> <table> <caption>8.3.5.3.2.5 Spoke RID - Spoke Revision ID (Offset 0Ch) Table 8-59. Spoke Revision ID</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>7:0</td> <td>RO</td> <td>Spoke Revision ID Uniquely identifies a Spoke Vendor to Software. This ID is assigned by UCIe Consortium.</td> </tr> </table> <table> <caption>8.3.5.3.2.6 DMS-ID - Spoke DMS-ID (Offset 10h) Table 8-60. DMS-ID</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>7:0</td> <td>RO</td> <td>DFx Management Spoke-ID Statically assigned Spoke-ID value for this Spoke. Spoke-ID is used for ID- routed UDMs.</td> </tr> </table> <table> <caption>8.3.5.3.2.7 Associated DMS-ID[0, 1, 2] (Offsets 11h, 12h, 13h) Table 8-61. Associated DMS-ID[0, 1, 2]</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>7:0</td> <td>RO</td> <td>Associated DMS-ID Spoke-ID associated with other Spokes that constitute the same UCIe link. For example, if there are separate Spokes for some or all of the IPs that constitute a full UCIe stack - Adapter, Physical Layer, Protocol Stack0, Protocol Stack1 - these registers within each Spoke provide the DMS-IDs of the related partner Spokes. If there are no related Spokes, this register reads as FFh. If there are multiple protocol stacks, the lower value DMS-ID belongs to Stack 0 and higher value belongs to Stack 1. These registers are used by SW to identify all the Spokes that constitute a single UCIe link.</td> </tr> </table> # 8.3.5.3.2.8 Spoke CAP - Spoke Capability (Offset 14h) <table> <caption>Table 8-62. Spoke Capability</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>3:0</td> <td>RO</td> <td>Version Set to 0h for this version of the capability.</td> </tr> <tr> <td>7:4</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td>15:8</td> <td>RO</td> <td>Spoke Type 0: UCIe.Adapter. Indicates a Spoke associated with UCIe Adapter. 1: UCIe.Physical_Layer. Indicates a Spoke associated with UCIe Physical Layer. 2: UCIe.Adapter_Physical_Layer. Indicates a common Spoke across both UCIe Adapter and Physical Layer. 3 to 127: Reserved. 128 to 255: Vendor-defined.</td> </tr> <tr> <td>31:16</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> # 8.3.5.3.2.9 Spoke CTL - Spoke Control (Offset 18h) <table> <caption>Table 8-63. Spoke Control</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW</td> <td>Enable Test and Debug Vendor-defined UDM as Initiator 0: Spoke cannot initiate Vendor-defined UDM. 1: Spoke can initiate Vendor-defined UDM. Spokes that do not implement Vendor-defined UDM as initiator can hardwire this bit to 0.</td> </tr> <tr> <td>31:1</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> # 8.3.5.3.2.10 Spoke STS - Spoke Status (Offset 1Ch) <table> <caption>Table 8-64. Spoke Status</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RO</td> <td>Spoke Used Indicates that the Spoke has been accessed at least once since the last Management Reset. Access implies sending or receiving UMAP packets or UDMs. Bit is cleared on the next Management Reset.</td> </tr> <tr> <td>31:1</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> # 8.3.5.3.2.11 DMS_Length_Low - DMS Register Space Length Low (Offset 20h) <table> <caption>Table 8-65. DMS Register Space Length Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$3 1 : 1 2$</td> <td>RO</td> <td>Lower 20 bits of length of the DMS register space from Offset 0h of DMS, in multiples of 4K. Value of 1000h for {DMS_Length_High :: DMS_Length_Low} indicates 4K length, 2000h indicates 8K length, etc. Bits [11:0] in this register are reserved to ensure 4k multiples of length. UCIe Spoke Types 0, 1, and 2 implemented to this revision of the spec must have a value in this register such that the DMS register space is not larger than 4 MB.</td> </tr> <tr> <td>11:0</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 8.3.5.3.2.12 DMS_Length_High - DMS Register Space Length High (Offset 24h) <table> <caption>Table 8-66. DMS Register Space Length High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RO</td> <td>Upper 32 bits of length of the DMS register space from Offset 0h of DMS, in multiples of 4K. Value of 1000h for {DMS_Length_High :: DMS_Length_Low} indicates 4K length, 2000h indicates 8K length, etc. UCIe Spoke Types 0, 1, and 2 implemented to this revision of the spec must set this value to all 0s.</td> </tr> </table> <table> <caption>8.3.5.3.2.13 DMS_Ext_Cap_Low - DMS Extended Capability Pointer Low (Offset 28h) Table 8-67. DMS Extended Capability Pointer Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:2</td> <td>RO</td> <td>Lower 30 bits of the DWORD-aligned offset from the DMS starting address, where any extended capabilities start, when present in the DMS. Value of all Os indicates that there are no extended capabilities (default).</td> </tr> <tr> <td>1:0</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> <table> <caption>8.3.5.3.2.14 DMS_Ext_Cap_High - DMS Extended Capability Pointer High (Offset 2Ch) Table 8-68. DMS Extended Capability Pointer High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RO</td> <td>Upper 32 bits of the DWORD-aligned offset from the DMS starting address, where any extended capabilities start, when present in the DMS. Value of all Os indicates that there are no extended capabilities (default).</td> </tr> </table> ### 8.3.5.3.3 DMS Registers of UCIe Spoke Types ('Spoke Type' = 0 through 2) Figure 8-67 shows the DMS register map for the UCIe Spoke types. Figure 8-66 and Section 8.3.5.3.2 detail registers that are common to all Spoke types. This section details the remaining registers, which are unique to the UCIe Spoke types. Figure 8-67. DMS Register Map for UCIe Spoke Types <figure> 31 24 23 16 15 8 7 0 0B 48B 80B • • • 128B • • • $N$ </figure> <table> <tr> <th colspan="2">Spoke DevID</th> <th colspan="2">Spoke VID</th> </tr> <tr> <th colspan="4">DMS_Next_Low</th> </tr> <tr> <td colspan="4">DMS_Next_High</td> </tr> <tr> <td colspan="2">Port ID</td> <td>Reserved</td> <td>Spoke RID</td> </tr> <tr> <td>Associated DMS-ID2</td> <td>Associated DMS-ID1</td> <td>Associated DMS-ID0</td> <td>DMS-ID</td> </tr> <tr> <td colspan="4">Spoke CAP</td> </tr> <tr> <td colspan="4">Spoke CTL</td> </tr> <tr> <td></td> <td colspan="3">Spoke STS</td> </tr> <tr> <td></td> <td colspan="3">DMS_Length_Low</td> </tr> <tr> <td></td> <td colspan="3">DMS_Length_High</td> </tr> <tr> <td></td> <td colspan="2">DMS_Ext_Cap_Low</td> <td></td> </tr> <tr> <td></td> <td colspan="3">DMS_Ext_Cap_High</td> </tr> <tr> <td></td> <td colspan="3">Adapter_Physical_Layer_Ptr_Low</td> </tr> <tr> <td colspan="4">Adapter_Physical_Layer_Ptr_High</td> </tr> <tr> <td></td> <td colspan="3">Compliance_Test_Ptr_Low</td> </tr> <tr> <td></td> <td colspan="3">Compliance_Test_Ptr_High</td> </tr> <tr> <td></td> <td colspan="3">Impl_Spec_Adapter_Ptr_Low</td> </tr> <tr> <td></td> <td colspan="3">Impl_Spec_Adapter_Ptr_High</td> </tr> <tr> <td></td> <td colspan="3">Impl_Spec_Physical_Layer_Ptr_Low</td> </tr> <tr> <td colspan="4">Impl_Spec_Physical_Layer_Ptr_High</td> </tr> <tr> <td></td> <td colspan="3">Reserved</td> </tr> <tr> <td></td> <td colspan="3">UCIe Link DVSEC</td> </tr> <tr> <td></td> <td colspan="2">Vendor-defined</td> <td></td> </tr> <tr> <td></td> <td colspan="3">UCIe Link Register Blocks</td> </tr> <tr> <td></td> <td colspan="3">Vendor-defined</td> </tr> </table> # 8.3.5.3.3.1 Port ID - Management Port ID (Offset 1Eh) <table> <caption>Table 8-69. Port ID</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>15:0</td> <td>RO</td> <td>Port ID For Spoke Types 0, 1, and 2, this register indicates the Port ID of the UCIe link that is associated with the Spoke, if a Port ID exists for the link. A UCIe link has a Port ID assigned to it if the link is a Management Port. If the link does not have an assigned Port ID, this register reads as FFFFh.</td> </tr> </table> <table> <caption>8.3.5.3.3.2 Adapter_Physical_Layer_Ptr_Low - Adapter/Physical Layer Register Block Pointer Low (Offset 30h) Table 8-70. Adapter_Physical_Layer_Ptr_Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="3">31:12</td> <td rowspan="3">RO</td> <td>Lower 20 bits of the 4K-aligned offset (from the starting address of the Spoke) of the UCIe Adapter/Physical Layer register block that is associated with the UCIe link.</td> </tr> <tr> <td>Accesses to registers that are referenced by Adapter_Physical_Layer_Ptr_Low/High pointers in a UCIe.Adapter Spoke are limited to the 4k block(s) that contain the Adapter registers and the register block header itself, and the 4k block(s) that contain Physical Layer registers are treated as reserved.</td> </tr> <tr> <td>Accesses to registers that are referenced by Adapter_Physical_Layer_Ptr_Low/High pointers in a UCIe.Physical_Layer Spoke are limited to the 4k block(s) that contain the PHY registers and the register block header itself, and Adapter registers are treated as reserved.</td> </tr> <tr> <td>11:0</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> # 8.3.5.3.3.3 Adapter_Physical_Layer_Ptr_High - Adapter/PHY Register Block Pointer High (Offset 34h) <table> <caption>Table 8-71. Adapter_Physical_Layer_Ptr_High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RO</td> <td>Upper 32 bits of the 4K-aligned offset (from the starting address of the Spoke) of the UCIe Adapter/PHY register block that is associated with the UCIe link. Accesses to registers that are referenced by Adapter_Physical_Layer_Ptr_Low/High pointers in a UCIe.Adapter Spoke are limited to the 4k block(s) that contain the Adapter registers and the register block header itself, and the 4k block(s) that contain PHY registers are treated as reserved. Accesses to registers that are referenced by Adapter_Physical_Layer_Ptr_Low/High pointers in a UCIe.Physical_Layer Spoke are limited to the 4k block(s) that contain the PHY registers and the register block header itself, and Adapter registers are treated as reserved.</td> </tr> </table> # 8.3.5.3.3.4 Compliance_Test_Ptr_Low - Compliance and Test Register Block Pointer Low (Offset 38h) <table> <caption>Table 8-72. Compliance_Test_Ptr_Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="2">$3 1 : 1 2$</td> <td rowspan="2">RO</td> <td>Lower 20 bits of the 4K-aligned offset (from the starting address of the Spoke) of the UCIe Test/Compliance register block that is associated with the UCIe link.</td> </tr> <tr> <td>Accesses to registers that are referenced by Compliance_Test_Ptr_Low/High pointers in a UCIe.Adapter Spoke are limited to the 4k block(s) that contain the Adapter registers and the register block header itself, and the 4k block(s) that contain PHY registers are treated as reserved. Accesses to registers that are referenced by Compliance_Test_Ptr_Low/High pointers in a UCIe.Physical_Layer Spoke are limited to the 4k block(s) that contain the PHY registers and the register block header itself, and the Adapter registers are treated as reserved. Accesses to registers that are referenced by Compliance_Test_Ptr_Low/High pointers in a UCIe.Adapter_Physical_Layer Spoke have no access restrictions. Set to all 0s if this register block is not implemented.</td> </tr> <tr> <td>11:0</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 8.3.5.3.3.5 Compliance_Test_Ptr_High - Compliance and Test Register Block Pointer High (Offset 3Ch) <table> <caption>Table 8-73. Compliance_Test_Ptr_High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RO</td> <td>Upper 32 bits of the 4K-aligned offset (from the starting address of the Spoke) of the UCIe Test/Compliance register block that is associated with the UCIe link. Accesses to registers that are referenced by Compliance_Test_Ptr_Low/High pointers in a UCIe.Adapter Spoke are limited to the 4k block(s) that contain the Adapter registers and the register block header itself, and the 4k block(s) that contain PHY registers are treated as reserved. Accesses to registers that are referenced by Compliance_Test_Ptr_Low/High pointers in a UCIe.Physical_Layer Spoke are limited to the 4k block(s) that contain the PHY registers and the register block header itself, and the Adapter registers are treated as reserved. Accesses to registers that are referenced by Compliance_Test_Ptr_Low/High pointers in a UCIe.Adapter_Physical_Layer Spoke have no access restrictions. Set to all 0s if this register block is not implemented.</td> </tr> </table> ## 8.3.5.3.3.6 Impl_Spec_Adapter_Ptr_Low - Implementation-specific Adapter Register Block Pointer Low (Offset 40h) <table> <caption>Table 8-74. Impl_Spec_Adapter_Ptr_Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$3 1 : 1 2$</td> <td>RO</td> <td>Lower 20 bits of the 4K-aligned offset (from the starting address of the Spoke) of the Adapter Implementation-specific register block. In a UCIe.Physical_Layer Spoke type, this pointer must be set to all 0s. Also set to all Os if the register block is not implemented in the design.</td> </tr> <tr> <td>11:0</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> <table> <caption>8.3.5.3.3.7 Impl_Spec_Adapter_Ptr_High - Implementation-specific Adapter Register Block Pointer High (Offset 44h) Table 8-75. Impl_Spec_Adapter_Ptr_High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$3 1 : 0$</td> <td>RO</td> <td>Upper 32 bits of the 4K-aligned offset (from the starting address of the Spoke) of the Adapter Implementation-specific register block. In a UCIe.Physical_Layer Spoke type, this pointer must be set to all 0s. Also set to all Os if the register block is not implemented in the design.</td> </tr> </table> <table> <caption>8.3.5.3.3.8 Impl_Spec_Physical_Layer_Ptr_Low - Implementation-specific Physical Layer Register Block Low (Offset 48h) Table 8-76. Impl_Spec_Physical_Layer_Ptr_Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:12</td> <td>RO</td> <td>Lower 20 bits of the 4K-aligned offset (from the starting address of the Spoke) of the Physical Layer Implementation-specific register block. In a UCIe.Adapter Spoke type, this pointer must be set to all 0s. Also set to all Os if the register block is not implemented in the design.</td> </tr> <tr> <td>11:0</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> <table> <caption>8.3.5.3.3.9 Impl_Spec_Physical_Layer_Ptr_High - Implementation-specific Physical Layer Register Block High (Offset 4Ch) Table 8-77. Impl_Spec_Physical_Layer_Ptr_High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RO</td> <td>Upper 32 bits of the 4K-aligned offset (from the starting address of the Spoke) of the Physical Layer Implementation-specific register block. In a UCIe.Adapter Spoke type, this pointer must be set to all 0s. Also set to all Os if the register block is not implemented in the design.</td> </tr> </table> ### 8.3.5.3.3.10 UCIe Link DVSEC - UCIe Link DVSEC (Offset 80h) UCIe Link DVSEC (see Section 9.5.1) is mirrored starting at this location. Accesses to the DVSEC by the UCIe.Physical_Layer Spoke type are treated as reserved. #### IMPLEMENTATION NOTE Spokes can restrict access to UCIe link registers based on access control considerations (see Section 8.1.3.5 for details). ### 8.3.5.3.3.11 UCIe Link Register Blocks (Offset Is Implementation-dependent) UCIe link memory register blocks - Adapter_Physical_Layer, Compliance_Test (if supported), Impl_Spec_Adapter (if supported), and Impl_Spec_Physical_Layer (if supported) - are mirrored at vendor-defined offsets in the Spoke's memory space. ### 8.3.5.3.4 DMS Registers of Vendor-defined Spoke Types ('Spoke Type' = 128 through 255) Figure 8-68 shows the DMS register map for the Vendor-defined Spoke types. Figure 8-66 and Section 8.3.5.3.2 detail registers that are common to all Spoke types. Section 8.3.5.3.3.1 details the Port ID register. Vendor-defined Spokes do not have any additional architected registers. <table> <caption>Figure 8-68. DMS Register Map for Vendor-defined Spoke Types</caption> <tr> <th colspan="2">Spoke DevID</th> <th colspan="2">Spoke VID</th> <th>0B</th> </tr> <tr> <th colspan="4">DMS_Next_Low</th> <th></th> </tr> <tr> <td colspan="4">DMS_Next_High</td> <td></td> </tr> <tr> <td colspan="2">Port ID</td> <td>Reserved</td> <td>Spoke RID</td> <td></td> </tr> <tr> <td>Associated DMS-ID2</td> <td>Associated DMS-ID1</td> <td>Associated DMS-ID0</td> <td>DMS-ID</td> <td></td> </tr> <tr> <td colspan="4">Spoke CAP</td> <td></td> </tr> <tr> <td colspan="4">Spoke CTL</td> <td></td> </tr> <tr> <td colspan="4">Spoke STS</td> <td></td> </tr> <tr> <td colspan="4">DMS_Length_Low</td> <td></td> </tr> <tr> <td></td> <td colspan="3">DMS_Length_High</td> <td></td> </tr> <tr> <td></td> <td colspan="3">DMS_Ext_Cap_Low</td> <td></td> </tr> <tr> <td colspan="4">DMS_Ext_Cap_High</td> <td></td> </tr> <tr> <td></td> <td colspan="2">Reserved</td> <td></td> <td>48B • • •</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>128B</td> </tr> <tr> <td></td> <td colspan="2"></td> <td></td> <td>•</td> </tr> <tr> <td></td> <td colspan="2">Vendor-defined</td> <td></td> <td>•</td> </tr> <tr> <td></td> <td colspan="2"></td> <td></td> <td>•</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td>$N$</td> </tr> </table> <figure> 31 24 23 16 15 8 7 0 </figure> ### 8.3.5.3.5 DMS Register Implementation in UCIe Adapter and in UCIe Physical Layer #### IMPLEMENTATION NOTE For Spoke Type 0, the DMS registers are implemented in the Adapter. For Spoke Type 1, the DMS registers are implemented in the Physical Layer. For Spoke Type 2, all but the register blocks associated with the Physical Layer are implemented in the Adapter. These registers are accessed over the FDI config bus $\left( 1 p - c f g * / p 1 _ { - } c f g ^ { * } \right)$ DMS Register read/write opcodes (see Table 7-1, Mapped to Sideband Packet Types"). SoC logic that interfaces with management fabric (which is implementation-specific) is required to $p e r f o r m \quad t h e$ conversion from Management Transport protocol UMAP packets to FDI config bus packets. The FDI config bus is defined in Section 10.2. ##### 8.4 Management Capabilities Management features described in this section are optional unless otherwise specified within the feature's description. ###### 8.4.1 Early Firmware Download ####### 8.4.1.1 Early Firmware Download Guidelines The Early Firmware Download capability enables a Management Element to load firmware to another Management Element. It is not mandatory to use this feature (i.e., some vendors may not require downloadable firmware). For Early Firmware Download capability, the management element that loads firmware into another management element is called the initiator. The management element into which a firmware is loaded is called the target. Those terms are only used within the description of the Early Firmware Download capability (Section 8.4.1 and all its subsections). The firmware downloaded to the target management element can be used by any hardware block that requires firmware within the chiplet. The target management element can have one or more Early Firmware Download capabilities structures for one or more hardware blocks. An Early Firmware Download capability can be used to download multiple distinct firmwares. Each firmware must be downloaded one after the other. #### IMPLEMENTATION NOTE If a chiplet needs to allow for concurrent firmware download of multiple firmwares then it should expose multiple distinct firmware download capabilities in its management capability directory (see Section 8.1.3.6.1). Each distinct Early Firmware Download capability shall have a distinct Early Firmware Download capability Identifier Value (see Table 8-78). Implementers are responsible for properly handling concurrent utilization of multiple distinct firmware download capabilities. Implementers can leverage the Early Firmware Download capability state (as reported by the EFD_STATE field) of each of the multiple Early Firmware Download capabilities to enforce proper ordering and synchronization across distinct Early Firmware Download capabilities. To uniquely identify which firmware the initiator should download, the initiator should use the three following identifiers: · UCIe vendor identifier (see Section 8.1.3.6) · Early Firmware Download capability Identifier (DWORD 1 in Figure 8-69) · Firmware identifier (DWORD 2 in Figure 8-69) ### 8.4.1.2 Early Firmware Download Capability <table> <caption>Figure 8-69. Early Firmware Download Capability Structure</caption> <tr> <th rowspan="2"></th> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th></th> <th>876</th> <th></th> <th></th> <th>543210</th> <th></th> <th></th> <th></th> <th></th> </tr> </table> <figure> DWORD 0 Rsvd Management Capability ID Reserved Version (RO) DWORD 1 EFD_CAPABILITY_ID (RO) DWORD 2 EFD_FIRMWARE_ID (RO) DWORD 3 Reserved EFD_Sª DWORD 4 EFD_Vb ☒ Reserved EFD_EC DWORD 5 EFD_PAYLOAD_SIZE (RW) DWORD 7 Reserved EFD_COd Reserved EFD_CAe DWORD 7 Reserved DWORD 8 Sink Circular Buffer Data Structure … DWORD 23 </figure> a. EFD_S is the shorthand for the EFD_STATE field which is read only (RO). b. EFD_V is the shorthand for the VENDOR_DEFINED_ERROR_STATUS field which is read only (RO). c. EFD_E is the shorthand for the EFD_ERROR field which is read only (RO). d. EFD_CO is the shorthand for the EFD_CONTROL field which is read and write (RW). e. EFD_CA is the shorthand for the EFD_CAPABILITIES field which is read only (RO). <table> <caption>Table 8-78. Early Firmware Download Capability Structure Fields</caption> <tr> <th>Register/Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Ver</td> <td>$0 \left[ 7 : 0 \right]$</td> <td>RO</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>{ \text { Management } }<br>{ \text { Capability ID } }</td> <td>0 [29:16]</td> <td>RO</td> <td>Management Capability ID This field specifies the Capability ID of this Management Capability structure. { \text { The Early Firmware Down load Capablity structure has } }<br>{ \text { Management Capability ID of 006h. } } a</td> </tr> <tr> <td>EFD_CAPABILITY_ID</td> <td>$1 \left[ 3 1 : 0 \right]$</td> <td>$R O$</td> <td>Early Firmware Download Capability Identifier Unique identifier for this Early Firmware Download Capability structure. { \text { This register is only useful if there are are multiple distinct early } }<br>{ \text { firmware capability in such cases this register can be used tc } } uniquely identify each distinct early firmware capability.</td> </tr> <tr> <td>EFD_FIRMWARE_ID</td> <td>$2 \left[ 3 1 : 0 \right]$</td> <td>$R O$</td> <td>Firmware Identifier The firmware identifier of the requested firmware payload (see Section 8.4.1.8). If there are multiple firmware blocks to download with this EFD capability, this value will change after each is downloaded. Note a value of FFFF_FFFFh means that the hardware does not need any more firmware to be downloaded.</td> </tr> <tr> <td>EFD_STATE</td> <td>$3 \left[ 2 : 0 \right]$</td> <td>$R O$</td> <td>$T h e \quad c u r r e n t \quad s t a t e \quad o f \quad t h e \quad E a r l y \quad F i r m w a r e \quad D o w n l o a d \left( s e e \right.$</td> </tr> <tr> <td>EFD_ERROR</td> <td>$4 \left[ 4 : 0 \right]$</td> <td>$R O$</td> <td>Error Current error code if any (see Table 8-80 for definitions).</td> </tr> <tr> <td>EFD_VENDOR_DEFINED ERROR_STATUS</td> <td>$4 \left[ 3 1 : 1 6 \right]$</td> <td>$R O$</td> <td>Vendor Defined Error Status $V e n d o r \quad d e f i n e d \quad e r r o r \quad s t a t u s \quad f o r \quad a n \quad e r r o r \quad r e p o r t e d \quad i n \quad E F D \_ E R R O R .$</td> </tr> <tr> <td>EFD_PAYLOAD_SIZE</td> <td>$5 \left[ 3 1 : 0 \right]$</td> <td>RW</td> <td>Firmware Payload Size The size, in DWORDs, of the firmware payload that is downloading.</td> </tr> <tr> <td>EFD_CAPABILITIES</td> <td>$6 \left[ 3 : 0 \right]$</td> <td>RO</td> <td>$S e e \quad S e c t i o n \quad 8 . 4 . 1 . 6 .$</td> </tr> <tr> <td>EFD_CONTROL</td> <td>$6 \left[ 1 9 : 1 6 \right]$</td> <td>RW</td> <td>$S e e \quad S e c t i o n \quad 8 . 4 . 1 . 7 .$</td> </tr> <tr> <td>Sink Circular Buffer Data Structure</td> <td>8 to 23</td> <td>-</td> <td>Sink Circular Buffer Data Structure See Section 8.4.1.9. For descriptions of registers and fields, see Section 8.1.5.1.</td> </tr> </table> ### 8.4.1.3 Early Firmware Download Asset Class ID The security asset class associated with the Early Firmware Download capability is specified by the management element function capability structure that instantiates it. It is recommended to use standard Asset Class ID 0, which is for SiP security configuration (see Table 8-7 in Section 8.1.3.5.1). A management element can expose multiple distinct Early Firmware Download capabilities and each can have a different Asset Class ID. This can be useful if different firmware downloads are needed with different asset classes. # 8.4.1.4 Early Firmware Download Initialization There is no specific initialization sequence needed for Early Firmware Download capability other than Circular Buffer Initialization as described in Section 8.1.5.1.3. ## 8.4.1.5 Early Firmware Download States and Error The values of the EFD_STATE field are defined in Table 8-79. Early Firmware Download capability shall start in the NOT_READY state while the chiplet is initializing and transition to the READY state when the Early Firmware Download capability is ready for use (which includes the Circular Buffer being ready for use); otherwise, if the initialization fails, it goes to ERROR state. The state machine is shown in Figure 8-70. <table> <caption>Table 8-79. EFD_STATE Field Values Definition</caption> <tr> <th>Field Values</th> <th>Description</th> </tr> <tr> <td>0</td> <td>NOT_READY Early Firmware Download capability is not ready.</td> </tr> <tr> <td>1</td> <td>ERROR Early Firmware Download detected an error. See the error code and Table 8-80 for details.</td> </tr> <tr> <td>2</td> <td>READY Early Firmware Download capability is ready. Before downloading firmware the initiator must verify that the Circular Buffer is in READY state.</td> </tr> <tr> <td>3</td> <td>DOWNLOADING Firmware payload size has been written to allow the download to start and the download has not finished.</td> </tr> <tr> <td>4</td> <td>PROCESSING The firmware is being loaded and executed.</td> </tr> <tr> <td>Other values</td> <td>Reserved</td> </tr> </table> <figure> <figcaption>Figure 8-70. Early Firmware Download State Machine</figcaption> NOT READY READY DOWNLOADING PROCESSING Reset ERROR </figure> When an error happens the EFD_ERROR field shall reflect the first error condition that was observed by the hardware. See Table 8-80 for the definitions of EFD_ERROR field values. <table> <caption>Table 8-80. EFD_ERROR Field Value Definitions</caption> <tr> <th>Error Code</th> <th>Error</th> </tr> <tr> <td>0</td> <td>No errors.</td> </tr> <tr> <td>1</td> <td>Internal Internal error is for vendor-defined errors.</td> </tr> <tr> <td>2</td> <td>Initialization Failed The initialization failed (i.e., going from NOT_READY to READY state failed). Must use the Reset bit of EFD_CONTROL (if supported) or a full chiplet reset to clear the error.</td> </tr> <tr> <td>3</td> <td>Downloading Failed An error did occur while downloading the firmware. The initiator should check the Circular Buffer structure for Circular Buffer error that might explain this error. Must use the Reset bit of EFD_CONTROL (if supported) or a full chiplet reset to clear the error.</td> </tr> <tr> <td>4</td> <td>Processing Failed The processing step (which is optional; see Section 8.4.1.8 for details) failed. This is vendor defined and can include verifying firmware image signature or other vendor defined reasons for firmware download failing to be successful. Must use the Reset bit of EFD_CONTROL (if supported) or a full chiplet reset to clear the error.</td> </tr> <tr> <td>Other values</td> <td>Reserved</td> </tr> </table> The EFD_VENDOR_DEFINED_ERROR_STATUS field defined in Table 8-81 is for vendor-defined error status. It is for providing additional details related to the error reported in EFD_ERROR (i.e., an initiator does not need to use the EFD_VENDOR_DEFINED_ERROR_STATUS when handling errors). If there is no vendor-defined status when the Early Firmware Download is in ERROR state, then this field shall return 0 (see Table 8-81). Note that if EFD_VENDOR_DEFINED_ERROR_STATUS returns 0, it does not mean that there are no errors. When an error occurs, EFD_ERROR is set to a nonzero value (see Table 8-80) and EFD_STATE reports ERROR state. <table> <caption>Table 8-81. EFD_VENDOR_DEFINED_ERROR_STATUS Value Definitions</caption> <tr> <th>Field Values</th> <th>Description</th> </tr> <tr> <td>0</td> <td>No vendor-defined error status. The reported error, if any, does not require any vendor-defined error status.</td> </tr> <tr> <td>Other values</td> <td>Reserved for vendors. Vendors are free to define meaning for each of those values.</td> </tr> </table> ## 8.4.1.6 Early Firmware Download Capabilities Table 8-82 defines each bit of the EFD_CAPABILITIES field. <table> <caption>Table 8-82. EFD_CAPABILITIES Bit Definition</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RO</td> <td>Reset Supported If 1, then reset is supported (i.e., initiator can reset the Early Firmware Download using reset bit of EFD_CONTROL). See Section 8.4.1.7 for details. If 0, then reset is not supported and if an error occurs, then the initiator may perform a full chiplet reset to recover from error. { \text { Note that this } b }<br>{ \text { Section } 8 . 4 . 1 . 8 } may change value when EFD_STATE becomes READY (see</td> </tr> <tr> <td>3:1</td> <td>RO</td> <td>Reserved</td> </tr> </table> ## 8.4.1.7 Early Firmware Download Control Table 8-83 defines each bit of the Early Firmware Download capability control register (EFD_CONTROL). <table> <caption>Table 8-83. EFD_CONTROL - Early Firmware Download Capability Control Bit Definition</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW</td> <td>Reset If reset is supported, writing 1 to this bit will cause a reset of the Early Firmware Download capability. Note that writing 1 to this bit will also reset the Circular Buffer part of this Early Firmware Download capability (as if 1 was written to the reset bit of the CB_CONTROL reset bit see Section 8.1.5.1.6). It is illegal to write 1 to the reset bit while the Early Firmware Download is in the NOT_READY state. The Early Firmware Download shall ignore such reset requests and continue with its initialization. Resetting the Early Firmware Download capability shall clear error conditions and transition the Early Firmware Download to the NOT_READY state while it is re- initializing itself. After reset completes (check for READY state in EFD_STATE) the initiator must check EFD_FIRMWARE_ID field to determine which image to download next, as it may be different than the image that was being downloaded prior to the reset.</td> </tr> <tr> <td>3:1</td> <td>RW</td> <td>Reserved</td> </tr> </table> Read of EFD_CONTROL shall return 0. ## IMPLEMENTATION NOTE If the Circular Buffer of an Early Firmware Download capability is reset (using CB_CONTROL) without resetting the Early Firmware Download capability (see EFD_CONTROL), then the behavior is implementation-specific and potentially unpredictable. The initiator should use EFD_CONTROL reset (if supported) to concurrently reset Early Firmware Download and its Circular Buffer. ### 8.4.1.8 Early Firmware Download Flow The initiator must wait for the Early Firmware Download capability to be in READY state (see EFD_STATE field definition). If the Early Firmware Download capability fails to initialize then it shall go to ERROR state. If Early Firmware Download capability goes to ERROR state, the initiator may try to reset the Early Firmware Download capability (see Section 8.4.1.7) if supported (see Section 8.4.1.6). If the Early Firmware Download capability goes to ERROR state again, it is not operational and full chiplet or chip reset may be necessary. After the Early Firmware Download capability reports READY state, the initiator may read the EFD_FIRMWARE_ID register and find the corresponding firmware payload. The initiator shall write the firmware payload size into the EFD_PAYLOAD_SIZE register. The target may start processing firmware data as soon as the EFD_PAYLOAD_SIZE register is updated by the initiator and data is available in the Circular Buffer. The initiator can start writing the firmware payload into the Circular Buffer as soon as the Early Firmware Download capability reports the READY state. The initiator should start writing the firmware payload only if the initiator knows the firmware identifier that will be requested as reported in the firmware identifier register after firmware download state field reports READY. A firmware image is done downloading once firmware payload size DWORDs (as programmed in the EFD_PAYLOAD_SIZE register) have been consumed from the Circular Buffer. The initiator can then monitor the EFD_STATE field and observe either PROCESSING, READY, or ERROR state. If the PROCESSING state completes with no errors the state field will transition back to the READY state. The PROCESSING state may require little or no time and may not be observed by the initiator. If the PROCESSING state fails then the state field transitions to ERROR state and the EFD_ERROR register will be updated with the corresponding error value. When the EFD_STATE field transitions to READY state the EFD_FIRMWARE_ID register changes to the next requested firmware image. A value of FFFF_FFFFh in EFD_FIRMWARE_ID indicates that no additional firmware images are being requested, and the firmware download flow is complete. When the Circular Buffer becomes READY and a new Firmware Identifier (new value in EFD_FIRMWARE_ID) is requested (and value is not FFFF_FFFFh), the above process repeats. An Early Firmware Download capability can be used to download multiple distinct firmwares. Each firmware must be downloaded one after the other. #### IMPLEMENTATION NOTE The PROCESSING state is a vendor-defined state during which the vendor can perform various operations on the firmware payload. For example, a vendor might implement security checks on the firmware payload, such as verifying the integrity and origin of the firmware. If any of those vendor-defined operations fails the vendor shall report it by transitioning the Early Firmware Download capability state (EFD_STATE) from the PROCESSING state to ERROR state. # 8.4.1.9 Circular Buffer Requirements for Early Firmware Download The Reset Supported bit of the CB_CAPABILITIES field (described in Section 8.1.5.1.4) shall contain the same value as the Reset Supported bit of the EFD_CAPABILITIES field (described in Section 8.4.1.6). If the Reset Supported bit of the EFD_CAPABILITIES field changes, the Reset Supported bit of the CB_CAPABILITIES field must also change. # 8.4.2 Power Management This section describes the optional Power Management capabilities that may be implemented by the chiplets of a UCIe-based SiP. ## 8.4.2.1 Fast Throttle ### 8.4.2.1.1 Fast Throttle Overview Fast Throttle is an optional feature that can be used to communicate the need for an immediate throttle response from chiplets in an SiP. This response is needed when a threshold for the configured function (such as power or thermal) is exceeded. Fast Throttle Threshold is defined in the operational range of the chiplet, typically close to but not at or exceeding the maximum limit of operation (such as temperature or power). The purpose of the Fast Throttle is to take corrective action and to prevent escalation to and beyond the maximum limits. As an example, one of the trigger-enabled Power Management Elements detects temperature at or exceeding the Fast Throttle temperature threshold. All Power Management Elements with Fast Throttle response enabled respond to the temperature throttle trigger. Figure 8-71 shows an example of an SiP with Fast Throttle support. <figure> <figcaption>Figure 8-71. Example Use of Fast Throttle</figcaption> Platform throttle indication SIP PM Director P PM Element P PM Element Chiplet -1 Bi-directional Fast Throttle (Open drain signal) Chiplet -2 PM Element PM Element Chiplet -N-1 Chiplet -N </figure> Figure 8-71 shows an SiP with multiple chiplets. Each chiplet is shown to have one or more Power Management Elements. One chiplet has the Power Management (PM) Director which is part of one of its Power Management Elements. The Fast Throttle Trigger is communicated to all these chiplets using a bidirectional Fast Throttle signal. The platform can also indicate a need to trigger Fast Throttle which the Power Management Director may pass along to the bidirectional Fast Throttle signal. Some chiplets on an SiP may not have a Power Management Element and/or capability for Fast Throttle. UCIe Management Director will discover the Power Management Elements during the initialization process. Fast Throttle communication is recommended to be low latency and bidirectional in nature. When Fast Throttle is triggered by a chiplet it must be communicated to all the chiplets with Fast Throttle response enabled. All Power Management Elements with Fast Throttle response enabled should take configured throttle action in a timely manner, to prevent escalation to or beyond the maximum limit of operation. Open Drain signaling as described in Section 5.14 may be used for this communication. Vendor-defined implementation of this signal may also be used. Open Drain is the UCIe-preferred connection for interoperability between chiplets. A Power Management Element can have either, both, or neither of Fast Throttle Trigger and Fast Throttle Response capabilities. Based on the supported capabilities, respective data structures and controls to configure these capabilities should be supported. Any Power Management Element with Fast Throttle Trigger capability supported and enabled can trigger Fast Throttle. Any Power Management Element with Fast Throttle Response capability supported and enabled must respond to a Fast Throttle Trigger by taking the respective action. Throttle Trigger generation is independent of Throttle Response handling. If both capabilities are enabled, a Power Management Element may trigger Fast Throttle assertion from its end even if Fast Throttle is already asserted by some other chiplet in the SiP. Trigger capable elements: · Advertises Trigger capability in its capability structure · Supports Fast Throttle Trigger Control structure to configure Fast Throttle Trigger behavior · (Optionally) Supports logging to record trigger history · Generates and communicates Fast Throttle when the trigger conditions are met Response capable elements: · Advertises Fast Throttle Response Capability · Supports Fast Throttle Response Control structure to configure response on Fast Throttle assertion · (Optionally) Supports logging to record response history · Responds to Fast Throttle by taking the configured action Power Management Director: · Enumerates the capabilities of power management entities including Fast Throttle · Configures trigger and response controls · Optionally configures trigger and response logging · Optionally samples Fast Throttle Trigger and response history during runtime by reading the logging structures . Optionally sets up and monitors platform throttle requests based on the SiP and platform requirements. Shown as the SiP input "Platform Throttle Indication" in Figure 8-71. Power-on Default Behavior: · Fast Throttle feature is disabled on power-on. It is enabled, typically by the Power Management Director, after the discovery and initialization process. The following data structures are defined for Fast Throttle: . Fast Throttle Trigger Capability Structure · Fast Throttle Response Capability Structure · Fast Throttle Logging Capability Structure . Fast Throttle Trigger Control Structure · Fast Throttle Response Control Structure · Fast Throttle Logging Control Structure · Fast Throttle Logging Structure <figure> <figcaption>Figure 8-72. Overview of the Fast Throttle Data Structures</figcaption> FFFF_FFFF_FFFF_FFFFh Fast Throttle Logging Strucure Fast Throttle Open Drain Signal Capability Fast Throttle Trigger Capability and Control Capability Directory Fast Throttle Trigger Capability Fast Throttle Logging Capability Fast Throttle Responsa Capability Fast Throttle Response Capability and Control Fast Throttle Logging Capability and Control 0000_0000 0000_0000h </figure> ## 8.4.2.1.2 Fast Throttle Capability Structures ### 8.4.2.1.2.1 Fast Throttle Trigger Capability Structure This section defines throttle trigger conditions supported by the Power Management Element (see Figure 8-73 and Table 8-84). Figure 8-73. Fast Throttle Trigger Capability Structure <table> <tr> <th rowspan="2"></th> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>110</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>9876543210</th> <th></th> <th></th> <th></th> </tr> </table> <figure> DWORD 0 Rsvd Management Capability ID Reserved Version DWORD 1 Fast Throttle Signal Capability Address Low DWORD 2 Fast Throttle Signal Capability Address High Number of Fast Throttle Trigger Capabilities (N) DWORD 3 Reserved DWORD 4 Fast Throttle Trigger Capability (0) DWORD 5 Fast Throttle Trigger Capability (1) ... ... DWORD (N-1)+4 Fast Throttle Trigger Capability (N-1) </figure> <table> <caption>Figure 8-74. Fast Throttle Trigger Capability Format</caption> <tr> <th></th> <th colspan="7">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th></th> <th colspan="7">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </table> DWORD Vendor-defined Fast Throttle Trigger Attributes Reserved Fast Throttle Trigger Type <table> <caption>Table 8-84. Fast Throttle Trigger Capability Structure Fieldsª</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDb</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Version</td> <td>0 [7:0]</td> <td>17</td> <td>RO</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>Management Capability ID</td> <td>0 [29:16]</td> <td>17</td> <td>RO</td> <td>Management Capability ID This field specifies the Capability ID of this Management Capability structure. The Fast Throttle Trigger Capability structure has a Management Capability ID of 007h.</td> </tr> <tr> <td>Fast Throttle Signal Capability Address Low</td> <td>1</td> <td>17</td> <td>RO</td> <td>Fast Throttle Signal Capability Address Low { \text { Lower } 3 2 \text { bits of the pointer to the base address of the } }<br>{ \text { signal capability structure. } } This points to a signal capability structure that can be either Open Drain or Vendor-defined type. The UCIe Standard is to use Open Drain type. Because capability structures must be DWORD-aligned, bits [1:0] must be 00b.</td> </tr> <tr> <td>Fast Throttle Signal Capability Address High</td> <td>2</td> <td>17</td> <td>RO</td> <td>Fast Throttle Signal Capability Address High Upper 32 bits of the pointer to the base address of the signal capability structure. This points to a signal capability structure that can be either Open Drain or Vendor-defined type. The UCIe Standard is to use Open Drain type.</td> </tr> <tr> <td>Number of Fast Throttle Trigger Capabilities (N)</td> <td>3 [4:0]</td> <td>17</td> <td>RO</td> <td>Number of Fast Throttle Trigger Capabilities (N) This field identifies the number of Fast Throttle Trigger capabilities that this management endpoint supports to trigger Fast Throttle. 0h: No Fast Throttle Trigger capabilities are supported. 1h - 1Fh: Up to 31 Fast Throttle Trigger capabilities are supported.</td> </tr> <tr> <td>{ \text { Fast Inrottie } }<br>{ \text { Trigger Capability } }</td> <td></td> <td>17</td> <td>RO</td> <td>Fast Throttle Trigger Capability One Fast Throttle Trigger Capability entry is added per Fast Throttle Trigger supported. A Fast Throttle Trigger capability is described by a combination of Fast Throttle Trigger Type and the associated attributes. Figure 8-74 and Table 8-85 specify the field definitions and format.</td> </tr> </table> a. If a Power Management Element supports both Fast Throttle Trigger and Response capabilities using a bidirectional signal, then the address to the Fast Throttle signal capability structure in the Fast Throttle Trigger and Response Capability structures must be identical. b. See Table 8-7 for a description of Standard Security Asset Class IDs. <table> <caption>Table 8-85. Fast Throttle Trigger Capability Format</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>{ \text { Standard } }<br>{ \text { Security } }<br>{ \text { Asset } } $\mathrm { c l a s s } \mathrm { I D } ^ { \mathrm { a } }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Fast Throttle Trigger Type</td> <td>$0 \left[ 4 : 0 \right]$</td> <td>17</td> <td>RO</td> <td>Fast Throttle Trigger Type Defines the Fast Throttle Trigger type. See Table 8-86 for Fast Throttle Trigger Type encoding.</td> </tr> <tr> <td>Vendor-defined Fast Throttle Trigger Attributes</td> <td>$0 \left[ 3 1 : 1 6 \right]$</td> <td>17</td> <td>RO</td> <td>Vendor-defined Fast Throttle Trigger Attributes Defines attributes for the Fast Throttle Trigger. Fast Throttle Trigger Type plus its attributes define a unique Fast Throttle Trigger.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. The following are examples of how a Fast Throttle Trigger can be defined: · Fast Throttle Trigger Type=1, Vendor-defined Fast Throttle Trigger Type = Average power, Sampling period = 1 ms · Fast Throttle Trigger Type=0, Vendor-defined Fast Throttle Trigger Attributes = Maximum temperature, Temperature zone = Chiplet <table> <caption>Table 8-86. Fast Throttle Trigger Type Encoding</caption> <tr> <th>Fast Throttle Trigger Type</th> <th>Encoding Definition</th> </tr> <tr> <td>00h</td> <td>Temperature</td> </tr> <tr> <td>01h</td> <td>Power</td> </tr> <tr> <td>02h</td> <td>Current</td> </tr> <tr> <td>03h - 17h</td> <td>Reserved</td> </tr> <tr> <td>18h - 1Fh</td> <td>Vendor-defined Types</td> </tr> </table> ## 8.4.2.1.2.2 Fast Throttle Response Capability Structure This section defines the actions that could be taken in response to Fast Throttle assertion and de- assertion. During initialization, the Power Management Director will select the action to be taken by this Power Management Element when Fast Throttle assertion or de-assertion occurs (see Figure 8-75 and Table 8-87). <table> <caption>Figure 8-75. Fast Throttle Response Capability Structure</caption> <tr> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="7">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>211</th> <th>10</th> <th>9</th> <th></th> <th>87</th> <th>6</th> <th>543210</th> <th></th> <th></th> <th></th> <th></th> </tr> </table> <figure> DWORD 0 DWORD 1 DWORD 2 DWORD 3 DWORD 4 DWORD 5 DWORD 6 DWORD 7 ... ... DWORD $2 \left( M - 1 \right) + 4$ DWORD 2(M-1)+5 </figure> <table> <caption>Figure 8-76. Fast Throttle Response State Format</caption> <tr> <th>Rsvd</th> <th>Management Capability ID Reserved</th> <th>Version</th> </tr> <tr> <td colspan="3">Fast Throttle Signal Capability Address Low</td> </tr> <tr> <td colspan="3">Fast Throttle Signal Capability Address High</td> </tr> <tr> <th></th> <th>Reserved</th> <th>Number of Fast Throttle Response States (M)</th> </tr> <tr> <td colspan="3">Fast Throttle Response State (0)</td> </tr> <tr> <td></td> <td>Fast Throttle Response State (1)</td> <td></td> </tr> <tr> <td></td> <td>…</td> <td></td> </tr> <tr> <td colspan="3">Fast Throttle Response State (M-1)</td> </tr> <tr> <td></td> <td></td> <td></td> </tr> </table> <table> <tr> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>1109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </table> DWORD 0 Reserved { \text { Fast Throuue } }<br>{ \text { Response State } }<br>{ \text { ID } } DWORD 1 Vendor-defined Fast Throttle Response State Attributes <table> <caption>Table 8-87. Fast Throttle Response Capability Structure Fieldsª (Sheet 1 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDb</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Version</td> <td>0 [7:0]</td> <td>17</td> <td>RO</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>Management Capability ID</td> <td>0 [29:16]</td> <td>17</td> <td>RO</td> <td>{ \text { This field specifies the Capability ID of this Managemen } }<br>{ \text { Capability structure. } } The Fast Throttle Response Capability structure has a Management Capability ID of 008h.</td> </tr> <tr> <td>Fast Throttle Signal Capability Address Low</td> <td>1</td> <td>17</td> <td>$R O$</td> <td>Fast Throttle Signal Capability Address { \text { Lower } 3 2 \text { bits of the pointer to the base address of the } }<br>{ \text { signal capability structure. } } This points to a signal capability structure that can be either Open Drain or Vendor-defined type. The UCIe Standard is to use Open { \text { Because capability structures must be DWORD-aligned } }<br>{ \text { bits } \left[ 1 : 0 \right] \text { must be O0b ,$</td> </tr> </table> <table> <caption>Table 8-87. Fast Throttle Response Capability Structure Fieldsa (Sheet 2 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>$\text { Standard } }<br>{ \text { Securitiy } } $I D ^ { b }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Fast Throttle Signal Capability Address High</td> <td>2</td> <td>17</td> <td>RO</td> <td>Fast Throttle Signal Capability Address High { \text { Upper } 3 2 \text { bits of the pointer to the base address of the } }<br>{ \text { signal capability structure. } } be { \text { This points to a signal capandy sunuucuue ucue vacue } }<br>{ \text { either open Drain or vendor-defined type. The UCIe } }<br>{ \text { Standard is to use Open Drain type. } }</td> </tr> <tr> <td>Number of Fast Throttle Response States (M)</td> <td>$3 \left[ 4 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Number of Fast Throttle Response States (M) { \text { This field id entifies the numb } }<br>{ \text { States that this management } } of Fast Throttle Response element supports to respond to Fast Throttle. $O h : N o \quad F a s t \quad T h r o t t l e \quad R e s p o n s e \quad S t a t e s \quad a r e \quad s u p p o r t e d .$ supported.</td> </tr> <tr> <td>Fast Throttle Response State &lt;0:M-1&gt;</td> <td>4 to 2(M-1)+5</td> <td>17</td> <td>RO</td> <td>Fast Throttle Response State { \text { One Fast Throttle Response State entry \left(each of whict } }<br>{ \left. \text { consists of two } D W O R D s \right) \text { is defined for each response } } state supported. \text { The Power Management Director canr use any criteria }<br>\text { including the attributes to select which Fast } \text { Throttle }<br>\text { Response State to select at initialization . If the Number } of Fast Throttle Response States is 0, then none of these structures need to be specified. A Fast Throttle Response State is described by a combination of Fast Throttle Response State ID and the associated attributes. See Figure 8-76 and Table 8-88 for Fast Throttle Response State field definitions and format.</td> </tr> </table> a. If a Power Management Element supports both Fast Throttle Trigger and Response capabilities using a bidirectional signal, then the address to the Fast Throttle signal capability structure in the Fast Throttle Trigger and Response Capability structures must be identical. b. See Table 8-7 for a description of Standard Security Asset Class IDs. <table> <caption>Table 8-88. Fast Throttle Response State Format</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security $\mathrm { c l a s s } I D ^ { \varepsilon }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Fast Throttle Response State ID</td> <td>0 [4:0]</td> <td>17</td> <td>RO</td> <td>Fast Throttle Response State ID This is an enumeration of the Fast Throttle Response States that are supported by the Power Management Element. The Power Management Director will select one of these response states and update the Response Control structure.</td> </tr> <tr> <td>Vendor-defined Fast Throttle Response State Attributes</td> <td>1 [31:0]</td> <td>17</td> <td>RO</td> <td>Vendor-defined Fast Throttle Response State Attributes These attributes can be used to specify characteristics of the response state.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. The following are examples of how a Fast Throttle Response State can be defined and selected: . Fast Throttle Response State ID=1, Vendor-defined Fast Throttle Response State Attributes = Lowest operational state for all clocks, Entry latency = 100 us, Exit Latency = 1 ms, Exit slow ramp enabled · Fast Throttle Response State ID=2, Vendor-defined Fast Throttle Response State Attributes = Lowest operational state for low-priority compute entity, Entry $l a t e n c y = 5 0 \quad u s ,$ Exit latency = 1 ms, Exit slow ramp enabled ## 8.4.2.1.2.3 Fast Throttle Logging Capability Structure This section defines a Power Management Element's capability to log the throttle events triggered or received (see Figure 8-77 and Table 8-89). <table> <caption>Figure 8-77. Fast Throttle Logging Capability Structure</caption> <tr> <th colspan="6">+3</th> <th colspan="2"></th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th>8</th> <th></th> <th></th> <th></th> <th></th> <th>76543210</th> <th></th> <th></th> <th></th> </tr> <tr> <td colspan="2">Rsvd</td> <td></td> <td></td> <td></td> <td colspan="3">Management</td> <td></td> <td></td> <td>Capability</td> <td></td> <td>ID</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="3">Reserved</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>Version</td> <td></td> <td></td> <td></td> </tr> </table> <figure> DWORD 0 Number of Fast Throttle Logging Capabilities $\left( L \right)$ DWORD 1 Reserved DWORD 2 Fast Throttle Logging Structure Address Low DWORD 3 Fast Throttle Logging Structure Address High DWORD 4 Fast Throttle Logging Capability (0) DWORD 5 Fast Throttle Logging Capability (1) ... ... DWORD L+3 Fast Throttle Logging Capability (L-1) </figure> <table> <caption>Figure 8-78. Fast Throttle Logging Capability Format</caption> <tr> <th></th> <th colspan="7">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </table> DWORD Fast Throttle Logging Capability Attributes Reserved Fast Throttle Logging Capability Type <table> <caption>Table 8-89. Fast Throttle Logging Capability Fields (Sheet 1 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>{ \text { Standard } }<br>{ \text { Security } }<br>{ \text { Asset } } Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Version</td> <td>0 [7:0]</td> <td>17</td> <td>RO</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>Management Capability ID</td> <td>0 [29:16]</td> <td>17</td> <td>RO</td> <td>Management Capability ID This field specifies the Capability ID of this Management Capability structure. The Fast Throttle Logging Capability structure has a Management Capability ID of 009h.</td> </tr> <tr> <td>Number of Fast Throttle Logging $\mathrm { C a p a b i l i t i e s } \left( \mathrm { L } \right)$</td> <td>$1 \left[ 4 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Number of Fast Throttle Logging Capabilities (L) { \text { Number of Fast Throttle logging capabilities that are } }<br>{ \text { supported by the Power Managemement Element. } } 00h: No Fast Throttle logging capabilities are supported. 01h - 1Fh: Up to 31 Fast Throttle logging capabilities are supported.</td> </tr> </table> <table> <caption>Table 8-89. Fast Throttle Logging Capability Fields (Sheet 2 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>{ \text { Standard } }<br>{ \text { Security } }<br>{ \text { Asset } }</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Fast Throttle Logging Structure Address Low</td> <td>2</td> <td>17</td> <td>RO</td> <td>Fast Throttle Logging Structure Address Low Lower 32 bits of the pointer to the base address of the Fast Throttle Logging structure defined in Section 8.4.2.1.4. Because capability structures must be DWORD-aligned, bits [1:0] must be 00b.</td> </tr> <tr> <td>Fast Throttle Logging Structure Address High</td> <td>3</td> <td>17</td> <td>$R O$</td> <td>Fast Throttle Logging Structure Address High Upper 32 bits of the pointer to the base address of the Fast Throttle Logging structure defined in Section 8.4.2.1.4.</td> </tr> <tr> <td>Fast Throttle Logging Capability &lt;0:L-1&gt;</td> <td>$4 \quad t o \quad L + 3$</td> <td>17</td> <td>$R O$</td> <td>Fast Throttle Logging Capability { \text { One Fast Throttle logging capability entry is defined for } }<br>{ \text { each Fast Throttle loaqing capability suported. } } A logging capability is described by a combination of Fast Throttle Logging Capability Type and the associated attributes. Figure 8-78 and Table 8-90 specify the field definitions and format.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. <table> <caption>Table 8-90. Fast Throttle Logging Capability Format</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>{ \text { Standard } }<br>{ \text { Security } }<br>{ \text { Asset } } Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$F a s t \quad T h r o t t l e$ Logging Capability Type</td> <td>0 [4:0]</td> <td>17</td> <td>RO</td> <td>Fast Throttle Logging Capability Type This field defines type of the Fast Throttle Logging capability. See Table 8-91 for Fast Throttle Logging Capability types.</td> </tr> <tr> <td>Fast Throttle Logging Capability Attributes</td> <td>$0 \left[ 3 1 : 1 6 \right]$</td> <td>17</td> <td>RO</td> <td>Fast Throttle Logging Capability Attributes This field defines attributes for the Fast Throttle Logging Capability type. See Table 8-91 for a list of Fast Throttle Logging Capability types and the associated attributes.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. <table> <caption>Table 8-91. Fast Throttle Logging Capability Types</caption> <tr> <th>Logging Capability Type</th> <th>Logging Capability</th> <th>Description</th> <th>Attributes</th> </tr> <tr> <td>000h</td> <td>Trigger Count Logging Capability</td> <td>The number of times Fast Throttle Trigger was asserted by this Power Management Element. Free-running counter, saturates at maximum value.</td> <td rowspan="2"></td> </tr> <tr> <td>001h</td> <td>{ \text { Trigger Duration } }<br>{ \text { Logging Capability } }</td> <td>The cumulative duration for which Fast Throttle Trigger was asserted by this Power Management Element. Defined in microseconds. Free-running counter, saturates at maximum value.</td> </tr> <tr> <td>$0 0 2 h$</td> <td>{ \text { Trigger Vector } }<br>{ \text { Logging Capabilit } }</td> <td>Vector of which Fast Throttle Trigger capabilities caused assertion of the Trigger from this Power Management Element. { \text { Defined as a sticky \left(until explicitly cleared\right) bit vector with one bit allocate } }<br>{ \text { to each Fast Throttle Trigger Typer supported by the Power Mangemement } } Element in the Fast Throttle Trigger 0. { \text { Up to 31 possible Fast Throttle Triggers can be logged. } }<br>{ \text { Bits } \left[ 6 3 : 3 1 \right] \text { of the corresponding logging register arererved. .$</td> <td>RW</td> </tr> <tr> <td>003h</td> <td>Response Count Logging Capability</td> <td>The number of times this Power Management Element responded to Fast Throttle. The Fast Throttle may have been generated by this Power Management Element itself or a different Power Management Element on the SiP. Free-running counter, saturates at maximum value.</td> <td></td> </tr> <tr> <td>004h</td> <td>Response Duration $L o g g i n g \quad C a p a b i l i t y$</td> <td>The cumulative duration for which this Power Management Element responded to Fast Throttle. The Fast Throttle may have been generated by this Power Management Element itself or a different Power Management Element on the SiP. $\text { Derined in microseconds. } }<br>{ \text { Free-running counter, saturates at maximum value. .$</td> <td></td> </tr> <tr> <td>005h - 017h</td> <td>Reserved</td> <td></td> <td>RO</td> </tr> <tr> <td>018h - 01Fh</td> <td>Vendor-defined</td> <td></td> <td>Vendor- defined</td> </tr> </table> ## $8 . 4 . 2 . 1 . 3$ Fast Throttle Control Structures ### 8.4.2.1.3.1 Fast Throttle Trigger Control Structure Figure 8-79 and Table 8-92 define the trigger controls per Power Management Element. Power Management Director will program this to enable zero or more Throttle triggers advertised by the element in the capability structure. For each of the throttle triggers, the Power Management Director should program the entry and exit threshold for the trigger to assert. <table> <caption>Figure 8-79. Fast Throttle Trigger Control Structure</caption> <tr> <th rowspan="2"></th> <th colspan="6"></th> <th colspan="7"></th> <th colspan="4"></th> <th colspan="2"></th> <th colspan="7"></th> </tr> <tr> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>$1 0 9 8 7 6 5 4 3 2 1 0$</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> <tr> <td>DWORD 0</td> <td colspan="4"></td> <td></td> <td></td> <td></td> <td colspan="9">Fast Throttle Min Assertion Time</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 1</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 2</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 3</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="8">Fast Throttle Trigger Control 0</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>....</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 8</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 9</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 10</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>...</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="8">Fast Throttle Trigger Control 1</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 15</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 16</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="3"></td> <td colspan="2"></td> <td colspan="3">...</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD $8 \left( N - 1 \right) + 1$</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD $8 \left( N - 1 \right) + 2$</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>...</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="6">Fast Throttle Trigger Control N-1</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td rowspan="2">DWORD $8 \left( N - 1 \right) + 7$</td> <td rowspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td rowspan="2"></td> <td></td> <td colspan="2" rowspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>$8 \left( N - 1 \right) + 8$</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </table> <figure> </figure> Figure 8-80 shows the Fast Throttle Trigger Control format. <table> <caption>Figure 8-80. Fast Throttle Trigger Control Format</caption> <tr> <th></th> <th colspan="6">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29 28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>9876543210</th> <th></th> </tr> </table> <figure> DWORD 0 En Reserved Threshold Encoding ID DWORD 1 Entry Threshold DWORD 2 Exit Threshold DWORD 3 DWORD 4 Reserved DWORD 5 DWORD 6 Vendor-defined Fast Throttle Trigger Controls DWORD 7 </figure> <table> <caption>Table 8-92. Fast Throttle Trigger Control Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security $\mathrm { c l a s s } \mathrm { I D } ^ { \bar { s } }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Fast Throttle Min Assertion Time</td> <td>0</td> <td>16</td> <td>RW</td> <td>Fast Throttle Min Assertion Time (us) Defines the minimum time for which the Fast Throttle should be asserted. If any enabled trigger condition is met then the Fast Throttle is asserted and the minimum assertion time begins. When all enabled trigger conditions are de-asserted and the minimum assertion time has been met, then the Fast Throttle will de-assert. Fast Throttle assertion time from the chiplet should be greater than OR equal to the minimum assertion time. Figure 8-82 shows an example of this.</td> </tr> <tr> <td>Fast Throttle Trigger Control &lt;0:N-1&gt;</td> <td>$1 \text { to } }<br>{ 8 \left( N - 1 \right) + 8 }</td> <td>16</td> <td>RW</td> <td>Fast Throttle Trigger Control &lt;0:N-1&gt; Defines the enable and other controllable fields for a Fast Throttle Trigger capability.b N:0-Up to 30; for each Fast Throttle Trigger capability supported. Each Fast Throttle Trigger Control structure consists of eight DWORDs. Figure 8-80 and Table 8-93 specify the field definitions and format.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. The Power Management Director can enable zero or more of the Fast Throttle Trigger controls in the Power Management Element. <table> <caption>Table 8-93. Fast Throttle Trigger Control Format</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>{ \text { Threshold } }<br>{ \text { Encoding ID } }</td> <td>$0 \left[ 4 : 0 \right]$</td> <td>16</td> <td>RW</td> <td>Threshold Encoding ID See Table 8-94 for Fast Throttle Trigger Threshold encodings. These units apply to the Entry and Exit Thresholds specified in this structure.</td> </tr> <tr> <td>$E n$</td> <td>0 [31]</td> <td>16</td> <td>RW</td> <td>Enable Enables the Fast Throttle Trigger Type.</td> </tr> <tr> <td>Entry Threshold</td> <td>$1 \left[ 3 1 : 0 \right]$</td> <td>16</td> <td>RW</td> <td>Entry Thresholdb c Defines the Entry threshold for Fast Throttle Trigger assertion.</td> </tr> <tr> <td>Exit Threshold</td> <td>$2 \left[ 3 1 : 0 \right]$</td> <td>16</td> <td>RW</td> <td>Exit Thresholdb c Defines the Exit threshold for Fast Throttle Trigger de- assertion.</td> </tr> <tr> <td>Vendor-defined Fast Throttle Trigger Controls</td> <td>5, 6, 7</td> <td>16</td> <td>RW</td> <td>Vendor-defined Fast Throttle Trigger Controls Vendor-defined Fast Throttle Trigger controls.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. The Power Management Director should configure the Entry and Exit Thresholds. If the throttle condition is enabled, a Power Management Element would assert this Fast Throttle Trigger when the Entry Threshold is exceeded; the Power Management Element would de-assert this Fast Throttle Trigger when the minimum assertion time has been met, and the condition drops back to below the Exit Threshold. c. References to Entry Threshold or Exit Threshold in this document (when discussing Fast Throttle) assume that Fast Throttle is asserted when one or more trigger values exceed (>) the respective Entry Threshold(s) and is de-asserted when all the Fast Throttle Triggers are below (<) their respective Exit Threshold(s). Vendor implementations may choose to use other definitions of comparison against Entry/Exit Thresholds for Fast Throttle assertion/de-assertion and use vendor-defined attribute bits in the Fast Throttle Trigger Capability structure to specify the same. <table> <caption>Table 8-94. Fast Throttle Threshold Encoding ID</caption> <tr> <th>Threshold Encoding ID</th> <th>Encoding Definition</th> </tr> <tr> <td>00h - 1Fh</td> <td>Vendor-defined encoding</td> </tr> </table> <figure> <figcaption>Figure 8-81. Fast Throttle Trigger Assertion and De-assertionª</figcaption> Trigger 0 > Entry_Threshold_0 Set RS Flip Flop Trigger 0 < Exit_Threshold_0 Clr Trigger 1 > Entry_Threshold_1 Set RS Flip Flop Clr Trigger 1 < Exit_Threshold_1 Set RS Flip Flop Chiplet Fast Throttle Trigger n > Entry_Threshold_n Set RS Flip Flop Clr Clr Throttle Min Assertion Time Met Trigger n < Exit_Threshold_n </figure> a. Entry/ Exit triggers could be generated across more than one Power Management Elements within a chiplet. However, they may be combined to generate one final Fast Throttle output from the chiplet as per the logic shown. <figure> <figcaption>Figure 8-82. Chiplet Fast Throttle Assertion and De-assertion Timing</figcaption> Chiplet A Throttle Trigger 1 Throttle Trigger 0 Chiplet A ... .. ... ... .. ... ... ... ... ... ... Chiplet A Throttle Trigger N Chiplet A Fast Throttle Output Minimum Assertion Time Minimum Assertion Time Any trigger meeting the assertion criteria results in Throttle Trigger assertion All triggers must meet de- assertion criteria for Throttle Triggerto de-assert </figure> ## 8.4.2.1.3.2 Fast Throttle Response Control Structure This structure defines the Fast Throttle response controls per Power Management Element. Power management will respond to the Fast Throttle assertion based on these controls (see Figure 8-83 and Table 8-95). <table> <caption>Figure 8-83. Fast Throttle Response Control Structure</caption> <tr> <th colspan="8">+3</th> <th colspan="8">+2</th> <th></th> <th colspan="7">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th></th> <th></th> <th>09876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </table> <figure> DWORD 0 Fast Throttle Response State ID En Reserved DWORD 1 Vendor-defined Fast Throttle Response State Controls </figure> <table> <caption>Table 8-95. Fast Throttle Response Control Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security $\mathrm { c l a s s } \mathrm { I D } ^ { \bar { s } }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Fast Throttle Response State ID</td> <td>$0 \left[ 4 : 0 \right]$</td> <td>16</td> <td>RW</td> <td>Fast Throttle Response State IDb This field sets the selected Fast Throttle Response State ID that the Power Management Element should go to in response to the Fast Throttle Trigger.</td> </tr> <tr> <td>$E n$</td> <td>0 [31]</td> <td>16</td> <td>RW</td> <td>Enable Set to enable this Fast Throttle Response State ID.</td> </tr> <tr> <td>Vendor-defined Fast Throttle Response State Controls</td> <td>1</td> <td>16</td> <td>$R W$</td> <td>Vendor-defined Fast Throttle Response State Controlsc This field specifies control options necessary for the Fast Throttle response.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. The Power Management Director-selected Fast Throttle Response State ID should be one of the State IDs advertised in the Fast Throttle Response Capability structure. c. Vendor-defined Fast Throttle Response State controls can be used to provide additional controllability (such as exit ramp rate) for the response state. ## 8.4.2.1.3.3 Fast Throttle Logging Control Structure This section defines the control structure for configuring Fast Throttle logging in a Power Management Element (see Figure 8-84 and Table 8-96). The number of logging capabilities in this structure (L) matches the number of logging capabilities in the Fast Throttle Logging Capability structure in Section 8.4.2.1.2.3. There is an in-order mapping of each entry in the Fast Throttle Logging Control structure to each entry in the Fast Throttle Logging Capability structure. <table> <caption>Figure 8-84. Fast Throttle Logging Control Structure</caption> <tr> <th rowspan="2"></th> <th colspan="7">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="4">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25 24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>11109876543210</th> <th></th> <th></th> </tr> <tr> <td>DWORD0</td> <td colspan="2"></td> <td colspan="25">Fast Throttle Logging Enable</td> </tr> <tr> <td>DWORD1</td> <td colspan="2"></td> <td colspan="18">Fast Throttle Logging Clear</td> <td colspan="7"></td> </tr> <tr> <td>DWORD 2</td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td colspan="10">Fast Throttle Logging Control (0)</td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD 3</td> <td colspan="2"></td> <td colspan="23">Fast Throttle Logging Control (1)</td> <td></td> <td></td> </tr> <tr> <td>...</td> <td colspan="2"></td> <td></td> <td></td> <td colspan="3"></td> <td colspan="2"></td> <td colspan="4"></td> <td colspan="7">...</td> <td></td> <td colspan="3"></td> <td></td> <td></td> <td></td> </tr> <tr> <td>DWORD L+1</td> <td colspan="2"></td> <td></td> <td></td> <td colspan="2"></td> <td colspan="3"></td> <td colspan="11">Fast Throttle Logging Control (L-1)</td> <td colspan="4"></td> <td></td> <td></td> <td></td> </tr> </table> <figure> </figure> <table> <caption>Figure 8-85. Fast Throttle Logging Control Format</caption> <tr> <th rowspan="2"></th> <th colspan="8">+3</th> <th colspan="7">+2</th> <th colspan="8">+1</th> <th colspan="7">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23 22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> </tr> <tr> <td>DWORD</td> <td></td> <td></td> <td colspan="9">Vendor-defined Fast Throttle Logging</td> <td colspan="4">Controls</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="4">Reserved</td> <td></td> <td></td> <td></td> <td colspan="2"></td> </tr> </table> <table> <caption>Table 8-96. Fast Throttle Logging Control Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security $\mathrm { c l a s s } \mathrm { I D } ^ { \bar { s } }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Fast Throttle Logging Enable</td> <td>0</td> <td>16</td> <td>$R W$</td> <td>Fast Throttle Logging Enable Enable bit vector for Fast Throttle logging capabilitiesb. When a bit is set, the corresponding logging capability is enabled. When a bit is cleared, the corresponding logging capability is disabled. One bit per logging capability as described in the Fast Throttle Logging Capability structure. [L-1:0]: Enable control for the L logging capabilities defined. [30:L]: Unused. [31]: Reserved.</td> </tr> <tr> <td>Fast Throttle Logging Clear</td> <td>1</td> <td>16</td> <td>RW</td> <td>Fast Throttle Logging Clear Clear vector for Fast Throttle logging capabilities. One bit per logging capability as described in the Fast Throttle Logging Capability structure. [L-1:0]: Clear control for the L logging capabilities defined. Writing 1 to a bit in this vector clears the corresponding logging register. Reads return 0s. [30:L]: Unused. [31]: Reserved.</td> </tr> <tr> <td>Fast Throttle Logging Control &lt;0:L-1&gt;</td> <td>2 to L+1</td> <td>16</td> <td>RW</td> <td>Fast Throttle Logging Control Control for each Fast Throttle logging capability. Figure 8-85 and Table 8-96 provide details of the Fast Throttle logging control format.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. The Power Management Director can enable zero or more of the Fast Throttle logging capabilities. <table> <caption>Table 8-97. Fast Throttle Logging Control Format</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Vendor-defined Fast Throttle Logging Controls</td> <td>0 [31:16]</td> <td>16</td> <td>RW</td> <td>Vendor-defined Fast Throttle Logging Controls Vendor-defined controls that are used to control the behavior of the Fast Throttle Logging capability.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. ## 8.4.2.1.4 Fast Throttle Logging Structures This section describes the logging structures that are used to maintain Fast Throttle logs based on the logging capabilities and controls as defined in Section 8.4.2.1.2.3 and Section 8.4.2.1.3.3, respectively. The number of logging capabilities in this structure (L) matches the number of logging capabilities in the Fast Throttle Logging Capability structure in Section 8.4.2.1.2.3. There is an in-order mapping of each entry in the Fast Throttle Logging Control structure to each entry in the Fast Throttle Logging Capability structure. ## 8.4.2.1.4.1 Fast Throttle Logging Structure Fast Throttle logging registers should be reset to 0 on a chiplet reset. <table> <caption>Figure 8-86. Fast Throttle Logging Structure</caption> <tr> <th></th> <th colspan="7">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>9876543210</th> <th></th> </tr> </table> <figure> DWORD 0 DWORD 1 Fast Throttle Log 0 DWORD 2 DWORD 3 Fast Throttle Log 1 ... … DWORD 2L-2 { \text { DWORD } }<br>{ 2 L - 1 } Fast Throttle Log L-1 </figure> <table> <caption>Table 8-98. Fast Throttle Logging Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Fast Throttle Log&lt;0:L-1&gt;</td> <td>0 to 2L-1</td> <td>17</td> <td>RO</td> <td>Fast Throttle Log Fast Throttle Log entryb as defined by the Fast Throttle Logging Capability structure“. Each Fast Throttle Log is a 64-bit counterd. The first DWORD of the entry is the lower 32 bits of the 64- bit counter. The second DWORD of the entry is the upper 32 bits of the 64-bit counter. Controlled by Fast Throttle logging controls.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. For log entries associated with a Fast Throttle Logging Capability Type of 002h (Trigger Vector Logging Capability), if the log register is cleared by software while the respective Fast Throttle Trigger is still asserted, the log bit should be set again. c. The Power Management Director can enable one or more logging capabilities in the Fast Throttle Logging Control structure to control these logs. d. The Power Management Director can read these logs and take an action based on the recorded values as appropriate. For example, as a response, the Power Management Director can choose to adjust the Fast Throttle Trigger controls. ## 8.4.2.1.5 Fast Throttle Address Map This section describes the address map of all the structures related to Fast Throttle. Figure 8-87. Fast Throttle Address Map <figure> FFFF_FFFF_FFFF_FFFFh Fast Throttle Logging Structure DW 2 (L-1), 2(L-1)+1 DW 2.3 DW 0. 1 For up to L Fast Throttle Logs Fast Throttle Open Drain Capability Open drain signal capability (FT) Fast Throttle Trigger Capability and Control $D W \quad 8 \left( N - 1 \right) + 1 + O f f s e t$ to 8 (N-1)+8+Offset For up to N Fast Throttle Trigger Control DW 1-8 + Offset Fast Throttle Trigger Control Offset (N+4) DWO+Offset DW N+3 DW4 DW3 DWZ high) DW1 (OD Pointer low) DWO For Up to N Fast Throttle Trigger Capabilities Fast Throttle Open Drain Capability Pointer Capability Directory Fast Throttle Trigger Capability Fast Throttle Logging Capability Fast Throttle Response Capability Fast Throttle Response Capability and Control Fast Throttle Response Control Offset (2M+4) $D W \quad 0 - 1 + O f f s e t$ $D W \quad 2 \left( M - 1 \right) + 4 , 2 \left( M - 1 \right) + 5$ 7 Fast Throttle Response Control DW 4, 5 DW3 DW2 (OD Pointer high) DW1 low) DWO For up to M Fast Throttle Response States Fast Throttle Open Drain Capability Pointer Fast Throttle Logging Capability and Control $D W \quad L + 1 + O f f s e t$ DW 2 + Offset 1 + DW 0 + Offset DW (L-1)+4 DW For up to L Fast Throttle Logging Controls Fast Throttle Logging Control Offset (L+4) For up to L Fast Throttle Logging Capabilities DW3 (FT logging Pointer high) DW2 (FT Logging Pointer low) DWT DWO DW4 Fast Throttle Logging Structure Pointer 0000_0000_0000_0000h </figure> ## 8.4.2.2 Emergency Shutdown ### 8.4.2.2.1 Emergency Shutdown Overview Emergency Shutdown is an optional feature that can be used to communicate the need for an immediate shutdown response across chiplets in an SiP. This response is needed when a specified shutdown threshold for the configured power management function (such as power or thermal) is exceeded. Emergency Shutdown Threshold is defined as near or exceeding the maximum limit of operation (such as temperature or power). The purpose of the Emergency Shutdown is to take immediate action to prevent physical damage due to exceeding the maximum limits. Emergency Shutdown is a fatal condition that requires immediate shutdown of the SiP and can only be exited on reset. An example is when one or more chiplets of the SiP exceed the maximum operating temperature, thereby requiring them to be powered off to prevent physical damage to those chiplets or other chiplets in the SiP. A chiplet may respond to Emergency Shutdown by quickly entering a low- power state and/or taking actions needed to more-cleanly shut down operation before power down. The platform may respond to the Emergency Shutdown Indication by having the power supply power down one or more power domains. Powering down these power domains may impact more of the platform than just the SiP that signaled Emergency Shutdown. Figure 8-88 shows an example of an SiP with Emergency Shutdown support. <figure> <figcaption>Figure 8-88. Example Use of Emergency Shutdown</figcaption> Power Supply Off SiP Shutdown SİP PM Director P PM Element P PM Element Chiplet -1 Bi-directional Emergency Shutdown (Open Drain) Chiplet -2 PM Element PM Element Chiplet -N-1 Chiplet -N </figure> Figure 8-88 shows an SiP with multiple chiplets. Each of these chiplets have one or more Power Management Elements. It is permissible to have additional chiplets in the SiP without Power Management Elements. One chiplet has the Power Management Director which is part of one of its Power Management Elements. The Emergency Shutdown is communicated to all these chiplets using a bidirectional Emergency Shutdown. The Emergency Shutdown is also communicated to the platform by the Power Management Director. The platform can also indicate a need for Emergency Shutdown to the SiP which the Power Management Director must pass along to the bidirectional Emergency Shutdown. Emergency Shutdown communication is recommended to be low latency and bidirectional in nature. When Emergency Shutdown is triggered by a chiplet, the shutdown must be broadcast to all chiplets with Emergency Shutdown response enabled. If platform notification is enabled, the shutdown may also be sent to the platform for platform-level actions. All responding elements with Emergency Shutdown enabled should take their configured Emergency Shutdown action in a timely manner to prevent damage. A low-latency communication mechanism to all chiplets with Emergency Shutdown response enabled must be provided. Open Drain signaling as described in Section 5.14 may be used for this communication. Vendor-defined implementation of this signal may also be used. Open Drain is UCIe preferred connection for interoperability between chiplets. A Power Management Element may have either, both, or neither of Emergency Shutdown Trigger capabilities and Emergency Shutdown Response capabilities. Based on the supported capabilities, respective data structures and controls to configure these capabilities should be supported. Any Power Management Element with Emergency Shutdown Trigger capability supported and enabled can trigger Emergency Shutdown. Any Power Management Element with Emergency Shutdown Response capability supported and enabled must respond to an incoming Emergency Shutdown trigger by taking the configured action. Emergency Shutdown Trigger generation is independent of Emergency Shutdown Response handling. If both capabilities are enabled, a Power Management Element may trigger Emergency Shutdown assertion from its end even if Emergency Shutdown is already asserted by some other chiplet in the SiP. However, given that an Emergency Shutdown event requires reset of the SiP to be resolved, once Emergency Shutdown is asserted by one or more Chiplets, assertion by any other Chiplets in the SiP may not have any effect. An Emergency Shutdown Trigger capable element: · Advertises Trigger capability in its capability structure · Supports Emergency Shutdown Trigger Control data structure to configure Emergency Shutdown trigger behavior · (Optionally) Supports logging to record trigger history · Generates and communicates Emergency Shutdown when one or more trigger conditions are met An Emergency Shutdown Response capable element: · Advertises Emergency Shutdown Response Capability · Supports response data structure to configure response on Emergency Shutdown assertion · Responds to Emergency Shutdown by taking the configured action Power Management Director: · Enumerates the capabilities of power management entities discovered during SiP initialization · Configures trigger and response controls Power-on Defaults: · The power-on default response to an Emergency Shutdown event is mapped to a specific Response State (see Section 8.4.2.2.3.2). Every Power Management Element that supports Emergency Shutdown Response Capability is required to support this state. This state may also be defined to enable a platform notification functionality if a given chiplet supports it (typically a chiplet which implements Power Management Director functionality). There is provision for an implementation-specific Emergency Shutdown Trigger Override that can be driven by the Chiplet before the full set of Emergency Shutdown Trigger Capabilities are discovered and enabled (see Section 8.4.2.2.3.1). The following data structures are defined for Emergency Shutdown: · Emergency Shutdown Trigger Capability Structure · Emergency Shutdown Response Capability Structure · Emergency Shutdown Logging Capability Structure · Emergency Shutdown Trigger Control Structure · Emergency Shutdown Response Control Structure · Emergency Shutdown Logging Control Structure · Emergency Shutdown Logging Structure <figure> <figcaption>Figure 8-89. Overview of Emergency Shutdown Data Structures</figcaption> FFFF_FFFF_FFFF_FFFFh Emergency Shutdown Logging Structure Emergency Shutdown Open Drain Signal Capability Emergency Shutdown Trigger Capability and Control Capability Directory Emergency Shutdown Trigger Capability Emergency Shutdown Logging Capability Emergency Shutdown Response Capability Emergency Shutdown Response Capability and Control Emergency Shutdown Logging Capability and Control 0000_0000_0000_0000h </figure> ## 8.4.2.2.2 Emergency Shutdown Capability Structures ### 8.4.2.2.2.1 Emergency Shutdown Trigger Capability Structure This section defines Emergency Shutdown Trigger capabilities supported by the Power Management Element (see Figure 8-90 and Table 8-99). <table> <caption>Figure 8-90. Emergency Shutdown Trigger Capability Structure</caption> <tr> <th rowspan="2"></th> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> </tr> </table> <figure> DWORD 0 Rsvd Management Capability ID Reserved Version DWORD 1 Emergency Shutdown Signal Capability Address Low DWORD 2 Emergency Shutdown Signal Capability Address High Number of Emergency Shutdown Trigger Capabilities (N) DWORD 3 Reserved DWORD 4 Emergency Shutdown Trigger Capability (0) DWORD 5 Emergency Shutdown Trigger Capability (1) ... ... DWORD (N-1)+4 Emergency Shutdown Trigger Capability (N-1) </figure> <table> <caption>Figure 8-91. Emergency Shutdown Trigger Capability Format</caption> <tr> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </table> DWORD Vendor-defined Emergency Shutdown Trigger Attributes Reserved Emergency Shutdown Trigger Type <table> <caption>Table 8-99. Emergency Shutdown Trigger Capability Structure Fields (Sheet 1 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Version</td> <td>$0 \left[ 7 : 0 \right]$</td> <td>17</td> <td>RO</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>Management Capability ID</td> <td>0 [29:16]</td> <td>17</td> <td>RO</td> <td>Management Capability ID This field specifies the Capability ID of this Management Capability structure. The Emergency Shutdown Trigger Capability structure has a Management Capability ID of 00Ah.</td> </tr> <tr> <td>Emergency Shutdown Signal Capability Address Low</td> <td>1</td> <td>17</td> <td>RO</td> <td>Emergency Shutdown Signal Capability Address Low Lower 32 bits of the pointer to the base address of the Emergency Shutdown Signal Capability structure. This points to a signal capability structure that can be either Open Drain or Vendor-defined type. The UCIe Standard is to use Open Drain type. Because capability structures must be DWORD-aligned, bits [1:0] must be 00b.</td> </tr> </table> <table> <caption>Table 8-99. Emergency Shutdown Trigger Capability Structure Fields (Sheet 2 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Emergency Shutdown Signal Capability Address High</td> <td>2</td> <td>17</td> <td>RO</td> <td>Emergency Shutdown Signal Capability Address High Upper 32 bits of the pointer to the base address of the Emergency Shutdown Signal Capability structure. This points to a signal capability structure that can be either Open Drain or Vendor-defined type. The UCIe Standard is to use Open Drain type.b</td> </tr> <tr> <td>Number Of Emergency Shutdown Trigger Capabilities (N)</td> <td>$3 \left[ 4 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Number of Emergency Shutdown Trigger Capabilities (N) This field identifies the number of Emergency Shutdown Trigger capabilities that this management endpoint supports to trigger Emergency Shutdown. 0h: No Emergency Shutdown Trigger capabilities are supported. 1h - 1Fh: Up to 31 Emergency Shutdown Trigger capabilities are supported.</td> </tr> <tr> <td>Emergency Shutdown Trigger Capability &lt;0:N-1&gt;</td> <td>4 to $\left( N - 1 \right) + 4$</td> <td>17</td> <td>RO</td> <td>Emergency Shutdown Trigger Capability One Emergency Shutdown Trigger Capability entry is added per Emergency Shutdown Trigger supported. Figure 8-91 and Table 8-100 specify the field definitions and format.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. If a Power Management Element supports both Emergency Shutdown Trigger and Response capabilities using a bidirectional signal, then the address to the Emergency Shutdown Signal Capability structure in the Emergency Shutdown Trigger and Response Capability structures must be identical. <table> <caption>Table 8-100. Emergency Shutdown Trigger Capability Format</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Emergency Shutdown Trigger Type</td> <td>0 [4:0]</td> <td>17</td> <td>RO</td> <td>Emergency Shutdown Trigger Type Defines the Emergency Shutdown Trigger type. See Table 8-101 for Emergency Shutdown Trigger Type encoding.</td> </tr> <tr> <td>Vendor-defined Emergency Shutdown Trigger Attributes</td> <td>0 [31:16]</td> <td>17</td> <td>RO</td> <td>Vendor-defined Emergency Shutdown Trigger Attributes Defines attributes for the Emergency Shutdown Trigger. Emergency Shutdown Trigger type plus its attributes define a unique Emergency Shutdown Trigger.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. The following are examples of how an Emergency Shutdown Trigger can be defined: · Emergency Shutdown Trigger Type=0, Vendor-defined Emergency Shutdown Trigger Attributes = Maximum Temperature, Temperature Zone = Chiplet · Emergency Shutdown Trigger Type=2, Vendor-defined Emergency Shutdown Trigger Attributes = Peak Current, Sampling Rate = 1 us <table> <caption>Table 8-101. Emergency Shutdown Trigger Type Encoding</caption> <tr> <th>Emergency Shutdown Trigger Type</th> <th>Encoding Definition</th> </tr> <tr> <td>00h</td> <td>Temperature</td> </tr> <tr> <td>01h</td> <td>Power</td> </tr> <tr> <td>02h</td> <td>Current</td> </tr> <tr> <td>$0 3 h \quad - \quad 1 7 h$</td> <td>Reserved</td> </tr> <tr> <td>$1 8 h \quad - \quad 1 F h$</td> <td>Vendor-defined Types</td> </tr> </table> ## 8.4.2.2.2.2 Emergency Shutdown Response Capability Structure This section defines the actions that could be taken in response to Emergency Shutdown. During initialization, the Power Management Director will select which of these actions will be taken by this Power Management Element when Emergency Shutdown occurs (see Figure 8-92 and Table 8-102). Note: Responses to Emergency Shutdown are aimed at the following purposes: · Take a faster local-level action while a more-global action (e.g., power rail shutdown) can be taken by a higher-level entity such as the platform. · Prepare the hardware for an impending power down cleanly. There could be different steps specified that trade off what can be done to prepare the hardware vs. the amount of time that takes. <table> <caption>Figure 8-92. Emergency Shutdown Response Capability Structure</caption> <tr> <th rowspan="2"></th> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th>8</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>76543210</th> <th></th> </tr> </table> <figure> DWORD 0 Rsvd Management Capability ID Reserved Version DWORD 1 Emergency Shutdown Signal Capability Address Low DWORD 2 Emergency Shutdown Signal Capability Address High Number of Shutdown Response States (M) DWORD 3 Reserved DWORD 4 DWORD 5 Emergency Shutdown Response State (0) DWORD 6 DWORD 7 Emergency Shutdown Response State (1) ... ... DWORD $2 \left( M - 1 \right) + 4$ DWORD $2 \left( M - 1 \right) + 5$ Emergency Shutdown Response State (M-1) </figure> <table> <caption>Figure 8-93. Emergency Shutdown Response State Format</caption> <tr> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>876543210</th> <th></th> </tr> </table> DWORD 0 PN Reserved Emergency Shutdown Response State ID DWORD 1 Vendor-defined Emergency Shutdown Response State Attributes <table> <caption>Table 8-102. Emergency Shutdown Response Capability Structure Fieldsª (Sheet 1 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDb</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Version</td> <td>0 [7:0]</td> <td>17</td> <td>RO</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>Management Capability ID</td> <td>0 [29:16]</td> <td>17</td> <td>RO</td> <td>Management Capability ID This field specifies the Capability ID of this Management Capability structure. The Emergency Shutdown Response Capability structure has a Management Capability ID of 00Bh.</td> </tr> <tr> <td>Emergency Shutdown Signal Capability Address Low</td> <td>1</td> <td>17</td> <td>$R O$</td> <td>Emergency Shutdown Signal Capability Address Low Lower 32 bits of the pointer to the base address of the Emergency Shutdown Signal Capability structure. This points to a signal capability structure that can be either Open Drain or Vendor-defined type. The UCIe Standard is to { \text { Because capability structures must be DWORD-aligned, bits } }<br>{ \left[ 1 : 0 \right] \text { must be } 0 0 b }</td> </tr> <tr> <td>Emergency Shutdown Signal Capability Address High</td> <td>2</td> <td>17</td> <td>$R O$</td> <td>$E m e r g e n c y \quad S h u t d o w n \quad S i g n a l \quad C a p a b i l i t y \quad A d d r e s s \quad H i g h$ { \text { Upper } 3 2 \text { bits of the pointer to the base address of the } }<br>{ \text { Emergency Shutdown Signal Capability structure. } } { \text { This points to a signal capability structure that can be eithel } }<br>{ \text { Open Drain or Vendor-defined type. The Ucle Standard is tc } } use Open Drain type.</td> </tr> </table> <table> <caption>Table 8-102. Emergency Shutdown Response Capability Structure Fieldsª (Sheet 2 of 2)</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDb</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Number Of Emergency Shutdown { \text { Response States } }<br>{ \left( M \right) }</td> <td>$3 \left[ 4 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Number of Emergency Shutdown Response States (M) This field identifies the number of Emergency Shutdown response states that this Management Element supports. If Emergency Shutdown Override is supported, at least one Emergency Shutdown Response State must be supported. 0h: No Emergency Shutdown Response States are supported. 1h - 1Fh: Up to 31 Emergency Shutdown Response States are supported.</td> </tr> <tr> <td>$\mathrm { E m e r q e n c y }$ Shutdown Response State &lt;0:M-1&gt;</td> <td>4 to $2 \left( M - 1 \right) + 5$</td> <td>17</td> <td>RO</td> <td>Emergency Shutdown Response State One Emergency Shutdown Response State entry (each of of two DWORDs) is defined for each \left. \text { Wnicn cons }<br>\text { Emergenc } \right) Shutdown Response State supported. The Power Management Director can use any criteria including the attributes to select which Emergency Shutdown Response State to select at initialization. If the Number of Emergency Shutdown Response States is 0, then none of these structures needs to be specified. An Emergency Shutdown Response State is described by a combination of Emergency Shutdown Response State ID and the associated attributes. See Figure 8-93 and Table 8-103 for Emergency Shutdown Response State field definitions and format.</td> </tr> </table> a. If a Power Management Element supports both Emergency Shutdown Trigger and Response capabilities using a bidirectional signal, then the address to the Emergency Shutdown Signal Capability structure in the Emergency Shutdown Trigger and Response Capability structures must be identical. b. See Table 8-7 for a description of Standard Security Asset Class IDs. <table> <caption>Table 8-103. Emergency Shutdown Response State Format</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security $\mathrm { A s s e t }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Emergency Shutdown Response State ID</td> <td>$0 \left[ 4 : 0 \right]$</td> <td>17</td> <td>RO</td> <td>Emergency Shutdown Response State ID This is an enumeration of the Emergency Shutdown Response States that are supported by the Power { \text { Management Element as a response ro riner yeluer perer } }<br>{ \text { Shutdown. The Power Managemement Director will select } } one of these response states and update the Emergency Shutdown Response Control structure.b</td> </tr> <tr> <td>Platform Notification (PN)</td> <td>0 [31]</td> <td>17</td> <td>RO</td> <td>Platform Notification (PN) This attribute bit indicates whether the given response state notifies the platform of an Emergency Shutdown event. If the Chiplet supports this functionality, it is recommended that this functionality be enabled for at least Emergency Shutdown Response State ID 0 (default Response State for Emergency Shutdown events at power-up reset).b</td> </tr> <tr> <td>Vendor-defined Emergency Shutdown Response State Attributes</td> <td>$1 \left[ 3 1 : 0 \right]$</td> <td>17</td> <td>RO</td> <td>Vendor-defined Emergency Shutdown Response State Attributes These attributes can be used to specify vendor-defined characteristics of the response state.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. If a Power Management Element supports Emergency Shutdown Response Capability, Emergency Shutdown Response State ID 0 must be defined and implemented because that is defined as the default Response State for Emergency Shutdown events at power-up reset (see Section 8.4.2.2.3.2). \- If the chiplet (typically a Power Management Director) also supports the functionality to notify the platform of an Emergency Shutdown, it is recommended to enable this functionality for at least Emergency Shutdown Response State ID 0 so that platform notification is enabled at power-up/reset by default. The Platform Notification (PN) attribute bit should reflect the behavior in the associated Emergency Shutdown Response State entry in the Emergency Shutdown Response Capability structure. \- The implementation of platform notification functionality is beyond the scope of this specification. ## 8.4.2.2.2.3 Emergency Shutdown Logging Capability Structure This section defines a Power Management Element's capability to log the shutdown events for debug and other purposes (see Figure 8-94 and Table 8-104). Emergency Shutdown logging registers should preserve their state across chiplet power cycling and reset events. Note that because an Emergency Shutdown may result in power down of the main power rails, any logging capabilities advertised and supported for Emergency Shutdown are recommended to be implemented on an auxiliary or always-on power domain. <table> <caption>Figure 8-94. Emergency Shutdown Logging Capability Structure</caption> <tr> <th colspan="6">+3</th> <th colspan="2"></th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> </tr> <tr> <td colspan="2">Rsvd</td> <td></td> <td></td> <td></td> <td colspan="3">Management</td> <td></td> <td></td> <td>Capability</td> <td></td> <td>ID</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="3">Reserved</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2">Version</td> <td></td> <td></td> <td></td> </tr> </table> <figure> DWORD 0 Number of Emergency Shutdown Logging Capabilities (L) DWORD 1 Reserved DWORD 2 Emergency Shutdown Logging Structure Address Low DWORD 3 Emergency Shutdown Logging Structure Address High DWORD 4 Emergency Shutdown Logging Capability (0) DWORD 5 Emergency Shutdown Logging Capability (1) ... ... DWORD L+3 Emergency Shutdown Logging Capability (L-1) </figure> <table> <caption>Figure 8-95. Emergency Shutdown Logging Capability Format</caption> <tr> <th></th> <th colspan="7">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th></th> <th colspan="7">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>211</th> <th>10</th> <th>9</th> <th></th> <th></th> <th>876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </table> DWORD Emergency Shutdown Logging Capability Attributes Reserved Emergency Shutdown Logging Capability Type <table> <caption>Table 8-104. Emergency Shutdown Logging Capability Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Version</td> <td>$0 \left[ 7 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Capability Structure Version This field indicates the version of this capability structure. This field has a value of 00h in this specification.</td> </tr> <tr> <td>Management Capability ID</td> <td>$0 \left[ 2 9 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Management Capability ID This field specifies the Capability ID of this Management Capability structure. The Emergency Shutdown Logging Capability structure has a Management Capability ID of 00Ch.</td> </tr> <tr> <td>Number of $\mathrm { E m e r g e n c y }$ Shutdown Logging Capabilities (L)</td> <td>$1 \left[ 4 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Number of Emergency Shutdown Logging Capabilities (L) { \text { Number of Emergency Shutdown Logging capabilities that are } }<br>{ \text { supported by the Power Managent Element } } 00h: No Emergency Shutdown Logging capabilities are supported. 01h - 1Fh: Up to 31 Emergency Shutdown Logging capabilities are supported.</td> </tr> <tr> <td>$\mathrm { E m e r g e n c y }$ Shutdown $\mathrm { L o g g i n g }$ Structure Address Low</td> <td>2</td> <td>17</td> <td>$R O$</td> <td>Emergency Shutdown Logging Structure Address Low Lower 32 bits of the pointer to the base address of the Emergency Shutdown Logging structure defined in Section 8.4.2.2.4. structures must be DWORD-aligned, bits $\left[ 1 : 0 \right] m u s t \quad b e \quad 0 0 b .$</td> </tr> <tr> <td>Emergency Shutdown Logging Structure Address High</td> <td>3</td> <td>17</td> <td>$R O$</td> <td>Emergency Shutdown Logging Structure Address High Upper 32 bits of the pointer to the base address of the Emergency Shutdown Logging structure defined in Section 8.4.2.2.4.</td> </tr> <tr> <td>Emergency Shutdown Logging Capability &lt;0:L-1&gt;</td> <td>4 to $L + 3$</td> <td>17</td> <td>$R O$</td> <td>Emergency Shutdown Logging Capability { \text { One Emergency Shutdown Logging capability entry is added pel } }<br>{ \text { Emergency Shutdown Logging capability supported. } } { \text { An Emergency Shutdown Logging capability is described by a } }<br>{ \text { combination of Emergency Shutdown Logging Capability Type } } { \text { Figure } 8 }<br>{ \text { format. } } 8-102 and Table 8-105 specify the field definitions and</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. <table> <caption>Table 8-105. Emergency Shutdown Logging Capability Format</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>{ \text { Standalu } }<br>{ \text { Security } } $\mathrm { C l a s s } I D ^ { c }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Emergency Shutdown \text { Logging }<br>\text { Capability } T y p \epsilon</td> <td>$0 \left[ 4 : 0 \right]$</td> <td>17</td> <td>$R O$</td> <td>Emergency Shutdown Logging Capability Type This field defines the Emergency Shutdown Logging Capability type (see Table 8-106 for the list of types).</td> </tr> <tr> <td>Emergency Shutdown { \text { Logging } }<br>{ \text { capability } } Attributes</td> <td>$0 \left[ 3 1 : 1 6 \right]$</td> <td>17</td> <td>$R O$</td> <td>Emergency Shutdown Logging Capability Attributes This field defines attributes for the Emergency Shutdown Logging Capability type.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. <table> <caption>Table 8-106. Emergency Shutdown Logging Capability Types</caption> <tr> <th>Logging Capability Type</th> <th>Logging Capability</th> <th>Description</th> <th>Attributes</th> </tr> <tr> <td>000h - 001h</td> <td>Reserved</td> <td></td> <td>RO</td> </tr> <tr> <td>002h</td> <td>$T r i g g e r \quad V e c t o r \quad L o g g i n g$</td> <td>Vector of which Emergency Shutdown Trigger Capability(s) caused assertion of the Emergency Shutdown Trigger from this Power Management Element. Defined as a sticky (until explicitly cleared) bit vector with one bit allocated to each Emergency Shutdown Trigger Capability supported by the Power Management Element in the Emergency Shutdown Trigger Capability structure, starting from bit 0. Up to 31 possible Emergency Shutdown Triggers can be logged. Bits [63:31] of the corresponding logging register are reserved.</td> <td>RW</td> </tr> <tr> <td>$0 0 5 h \quad - \quad 0 1 7 h$</td> <td>Reserved</td> <td></td> <td>RO</td> </tr> <tr> <td>018h - 01Fh</td> <td>$\mathrm { v a n d o r - d e f i n e d }$</td> <td></td> <td>Vendor-defined</td> </tr> </table> ## 8.4.2.2.3 Emergency Shutdown Control Structures ### 8.4.2.2.3.1 Emergency Shutdown Trigger Control Structure This structure defines the Emergency Shutdown Trigger Controls per Power Management Element. Power Management Director should configure this to enable one or more Emergency Shutdown Triggers advertised by the element in the capability structure (see Figure 8-96 and Table 8-107). For each of the Emergency Shutdown Triggers, the Power Management Director should program the threshold for the trigger to assert. Note that because Emergency Shutdown is defined as an event that requires a reset for the SiP to recover, there are no controls defined for the trigger to de-assert. Once asserted, Emergency Shutdown must remain asserted until it is reset through a reset of the chiplet. The number of capabilities in this structure (N) matches the number of Emergency Shutdown Trigger capabilities declared by the Power Management Element in Section 8.4.2.2.2.1. There is an in-order mapping of each entry in the Emergency Shutdown Trigger Control structure to each entry in the Emergency Shutdown Trigger Capability structure. There is provision for an implementation-specific Emergency Shutdown Trigger Override that can be used to control Emergency Shutdown, especially at power-up/reset before the other Trigger capabilities have been discovered and set up. This is controlled by Override Enable (OE) bit in the Emergency Shutdown Trigger Control structure below. See Figure 8-98 for additional details on the behavior of Emergency Shutdown Trigger Override. Figure 8-96. Emergency Shutdown Trigger Control Structure <table> <tr> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th></th> <th></th> <th>876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </table> <figure> DWORD 0 Reserved OE DWORD 1 DWORD 2 DWORD 3 Emergency Shutdown Trigger Control 0 .... DWORD 8 DWORD 9 DWORD 10 Emergency Shutdown Trigger Control 1 ... DWORD 15 DWORD 16 ... ... DWORD $8 \left( N - 1 \right) + 1$ DWORD $8 \left( N - 1 \right) + 2$ Emergency Shutdown Trigger Control N-1 ... DWORD $8 \left( N - 1 \right) + 7$ DWORD $8 \left( N - 1 \right) + 8$ </figure> Figure 8-97 shows the format of the Emergency Shutdown Trigger Control. Figure 8-97. Emergency Shutdown Trigger Control Format <figure> +3 +2 +1 +0 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 876543210 DWORD 0 En Reserved Threshold Encoding ID DWORD 1 Entry Threshold DWORD 2 DWORD 3 Reserved DWORD 4 DWORD 5 DWORD 6 Vendor-defined Emergency Shutdown Trigger Controls DWORD 7 </figure> <table> <caption>Table 8-107. Emergency Shutdown Trigger Control Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security $\mathrm { c l a s s } \mathrm { I D } ^ { \bar { s } }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Override Enable (OE)</td> <td>0 [0]</td> <td>16</td> <td>RW</td> <td>Emergency Shutdown Override Enable Controls the Chiplet Emergency Shutdown Override as shown in Figure 8-98. Reset Default: 1. Emergency Shutdown Override is defined to be default enabled to allow a chiplet to drive a vendor- defined implementation of the Emergency Shutdown Override Trigger at power-up/reset before other Emergency Shutdown Trigger capabilities have been discovered and initialized. The Power Management Director may disable the override by clearing this bit to 0 after other Emergency Shutdown Trigger capabilities have been configured and enabled.</td> </tr> <tr> <td>Emergency Shutdown Trigger Control &lt;0:N-1&gt;</td> <td>{ 1 \text { to } }<br>{ 8 \left( N - 1 \right) + 8 }</td> <td>16</td> <td>RW</td> <td>Emergency Shutdown Trigger Control &lt;0:N-1&gt; Defines the enable and other controllable fields for an Emergency Shutdown Trigger Type N:0-30, for each Emergency Shutdown Trigger capability supported.b Each Emergency Shutdown Trigger Control structure consists of eight DWORDs. Figure 8-97 and Table 8-108 specify the format description.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. The Power Management Director can enable zero or more of the Emergency Shutdown Trigger controls in the Power Management Element. <table> <caption>Table 8-108. Emergency Shutdown Trigger Control Formata</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard { \text { Security } }<br>{ \text { Asset } } Class IDb</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Threshold Encoding ID</td> <td>0 [4:0]</td> <td>16</td> <td>RW</td> <td>Threshold Encoding ID See Table 8-109 for Emergency Shutdown Threshold encodings. These units apply to the Entry Threshold specified in this structure.</td> </tr> <tr> <td>En</td> <td>0 [31]</td> <td>16</td> <td>RW</td> <td>Enable Enables the Emergency Shutdown Trigger type.</td> </tr> <tr> <td>Entry Threshold</td> <td>1 [31:0]</td> <td>16</td> <td>RW</td> <td>Entry Thresholdc d Defines the Entry threshold for Emergency Shutdown Trigger assertion.</td> </tr> <tr> <td>Vendor-defined Emergency Shutdown Trigger Controls</td> <td>5, 6, 7</td> <td>16</td> <td>RW</td> <td>Vendor-defined Emergency Shutdown Trigger Controlse Vendor-defined Emergency Shutdown Trigger controls.</td> </tr> </table> a. A Power Management Element should assert Emergency Shutdown if any of the enabled shutdown conditions are met (see Figure 8-98 and Figure 8-99 for additional details). b. See Table 8-7 for a description of Standard Security Asset Class IDs. c. If an Emergency Shutdown Trigger control is enabled, the Power Management Director must define a corresponding Entry Threshold. d. References to Entry Threshold in this document (when discussing Emergency Shutdown) assume that Emergency Shutdown is asserted when one or more trigger values exceed (>) the respective Entry Threshold(s). Vendor implementations may choose to use other definitions of comparison against the Entry Threshold for Emergency Shutdown assertion and use vendor-defined attribute bits in the Emergency Shutdown Trigger Capability structure to specify the same. e. Because Emergency Shutdown is defined as an event that requires a reset for the SiP to recover, there are no controls defined for the trigger to de-assert. Once asserted, Emergency Shutdown must remain asserted until it is reset through a reset of the chiplet. <table> <caption>Table 8-109. Emergency Shutdown Threshold Encoding ID</caption> <tr> <th>Threshold Encoding ID</th> <th>Encoding Definition</th> </tr> <tr> <td>00h - 1Fh</td> <td>Vendor-defined encoding</td> </tr> </table> <figure> <figcaption>Figure 8-98. Emergency Shutdown Assertionª</figcaption> Trigger 0 > Entry_Threshold_0 Trigger 1 > Entry_Threshold_1 Chiplet Emergency Shutdown V Trigger n> Entry_Threshold_n Flop ES_Ovrd_Trigger ES_Ovrd_Enable </figure> a. Entry triggers could be generated across more than one Power Management Element within a chiplet. However, they should be combined to generate one final Emergency Shutdown output from the chiplet as per the logic shown. <figure> <figcaption>Figure 8-99. Emergency Shutdown Timing Diagram</figcaption> Chiplet A Emergency Shutdown Trigger 0 Chiplet A Emergency Shutdown Trigger 1 Power Cycling/Reset ... ... ... ... ... ... ... ... ... Chiplet A Emergency Shutdown Trigger N Chiplet A Emergency Shutdown Output Any trigger meeting the assertion criteria results in Shutdown Trigger assertion Trigger stays asserted till a power-cycling/reset event </figure> ## 8.4.2.2.3.2 Emergency Shutdown Response Control Structure This structure defines the Emergency Shutdown response controls per Power Management Element. Power management will respond to the assertion based on these controls (see Figure 8-100 and Table 8-110). <table> <caption>Figure 8-100. Emergency Shutdown Response Control Structure</caption> <tr> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th>10</th> <th>9</th> <th>8</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>76543210</th> <th></th> </tr> </table> <figure> Emergency Shutdown Response State ID DWORD 0 En Reserved DWORD 1 Vendor-defined Emergency Shutdown Response State Controls </figure> <table> <caption>Table 8-110. Emergency Shutdown Response Control Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Emergency Shutdown Response State ID</td> <td>0 [4:0]</td> <td>16</td> <td>RW</td> <td>Emergency Shutdown Response State IDb This field sets the selected Emergency Shutdown Response State ID that the Power Management Element should go to in response to the Emergency Shutdown Trigger. Reset Default: 0. Default response at power-on/reset is set to Emergency Shutdown Response State ID 0. The Power Management Director can configure the Emergency Shutdown Response State ID to a different response state as part of the initialization sequence or later.</td> </tr> <tr> <td>En</td> <td>0 [31]</td> <td>16</td> <td>RW</td> <td>Enable Set to enable this Emergency Shutdown Response State ID. Reset Default: 1. If Emergency Shutdown Override is supported, the Power Management Director can choose to disable a response to the Emergency Shutdown Trigger as part of the initialization sequence or later.</td> </tr> <tr> <td>Vendor-defined Emergency Shutdown Response State Controls</td> <td>1</td> <td>16</td> <td>RW</td> <td>Vendor-defined Emergency Shutdown Response State Controlsc This field specifies other controls necessary for the Emergency Shutdown response.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. Emergency Shutdown Response State ID should be one of the Response Types of which the Power Management Element is capable and advertises in the Emergency Shutdown Response Capability structure. c. Vendor-defined response state controls can be used to provide additional controllability for the response state. ### IMPLEMENTATION NOTE When the Power Management Director is writing to the Emergency Shutdown Response Control structure, the Power Management Director cannot write both DWORDs at the same time. The Emergency Shutdown Override may be enabled and trigger between the two writes that update the Emergency Shutdown Response Control structure. If this will cause an incorrect response to Emergency Shutdown, the implementation should take steps to ensure that the updated Emergency Shutdown Response will not take effect until both DWORDs have been updated. ## 8.4.2.2.3.3 Emergency Shutdown Logging Control Structure This section defines the control structure for the Power Management Director to configure the Emergency Shutdown logging capabilities of a Power Management Element (see Figure 8-101 and Table 8-111). The number of logging capabilities in this structure (L) matches the number of Emergency Shutdown logging capabilities declared by the Power Management Element in Section 8.4.2.2.2.3. There is an in-order mapping of each entry in the Emergency Shutdown Logging Control structure to each entry in the Emergency Shutdown Logging Capability structure. <table> <caption>Figure 8-101. Emergency Shutdown Logging Control Structure</caption> <tr> <th colspan="4">+3</th> <th colspan="2"></th> <th colspan="6">+2</th> <th colspan="2"></th> <th colspan="6">+1</th> <th colspan="2"></th> <th colspan="8">+0</th> </tr> <tr> <td>31 30</td> <td>29 28</td> <td>27</td> <td>26</td> <td>25</td> <td>24</td> <td>23</td> <td>22</td> <td>21</td> <td>20</td> <td>19</td> <td>18</td> <td>17</td> <td>16</td> <td>15</td> <td>14</td> <td>13</td> <td>12</td> <td>11</td> <td>10</td> <td>9</td> <td></td> <td></td> <td></td> <td></td> <td>876543210</td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td colspan="30">Emergency Shutdown Logging Enable</td> </tr> <tr> <td colspan="30">Emergency Shutdown Logging Clear</td> </tr> <tr> <td colspan="4"></td> <td colspan="23">Emergency Shutdown Logging Control (0)</td> <td></td> <td></td> <td></td> </tr> <tr> <td colspan="4"></td> <td colspan="24">Emergency Shutdown Logging Control (1)</td> <td></td> <td></td> </tr> <tr> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> <td></td> <td></td> <td></td> <td></td> <td>...</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td colspan="4"></td> <td colspan="19">Emergency Shutdown Logging Control (L-1)</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </table> <figure> DWORD0 DWORD1 DWORD 2 DWORD 3 ... DWORD L+1 </figure> <table> <caption>Figure 8-102. Emergency Shutdown Logging Control Format</caption> <tr> <th></th> <th colspan="6">+3</th> <th colspan="8">2+</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25 24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> <tr> <td colspan="7">Vendor-defined Emergency</td> <td colspan="3">Shutdown</td> <td></td> <td>Logging</td> <td colspan="3">Controls</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td colspan="4">Reserved</td> <td></td> <td></td> <td></td> <td></td> <td colspan="2"></td> </tr> </table> DWORD <table> <caption>Table 8-111. Emergency Shutdown Logging Control Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security $\mathrm { c l a s s } I D ^ { a }$</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Emergency Shutdown Logging Enable</td> <td>0</td> <td>16</td> <td>RW</td> <td>Emergency Shutdown Logging Enable Enable bit vector for Emergency Shutdown logging capabilitiesb. One bit per logging capability as described in the Emergency Shutdown Logging Capability structure. [L-1:0]: Enable control for the L logging capabilities defined. [30:L]: Unused. [31]: Reserved.</td> </tr> <tr> <td>Emergency Shutdown Logging Clear</td> <td>1</td> <td>16</td> <td>RW</td> <td>Emergency Shutdown Logging Clear Clear vector for Emergency Shutdown logging capabilities. One bit per logging capability as described in the Emergency Shutdown Logging Capability structure. [L-1:0]: Clear control for the L logging capabilities defined. Writing 1 to a bit in this vector clears the corresponding logging register. Reads return 0s. [30:L]: Unused. [31]: Reserved.</td> </tr> <tr> <td>Emergency Shutdown Logging Control &lt;0:L-1&gt;</td> <td>2 to L+1</td> <td>16</td> <td>RW</td> <td>Emergency Shutdown Logging Control Control for each Emergency Shutdown logging capability. Figure 8-102 and Table 8-112 provide details of the logging control format.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. The Power Management Director can enable zero or more of the Emergency Shutdown logging capabilities. <table> <caption>Table 8-112. Emergency Shutdown Logging Control Format</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Vendor-defined Emergency Shutdown Logging Controls</td> <td>0 [31:16]</td> <td>16</td> <td>RW</td> <td>Vendor-defined Emergency Shutdown Logging Controls Vendor-defined controls that are used to control the behavior of the Emergency Shutdown Logging capability.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. ## 8.4.2.2.4 Emergency Shutdown Logging Structures This section describes the logging structures that are used to maintain Emergency Shutdown logs based on the Emergency Shutdown logging capabilities and controls as defined in Section 8.4.2.2.2.3 and Section 8.4.2.2.3.3, respectively. The number of logging capabilities in this structure (L) matches the number of Emergency Shutdown logging capabilities declared by the Power Management Element in Section 8.4.2.2.2.3. There is an in-order mapping of each entry in the Emergency Shutdown Logging Control structure to each entry in the Emergency Shutdown Logging Capability structure. Emergency Shutdown logging registers should preserve their state across chiplet power cycling and reset events. Note that because an Emergency Shutdown may result in power down of the main power rails, any logging capabilities advertised and supported for Emergency Shutdown are recommended to be implemented on an auxiliary or always-on power domain. ## 8.4.2.2.4.1 Emergency Shutdown Logging Structure Figure 8-103 and Table 8-113 describe the Emergency Shutdown Logging structure. <table> <caption>Figure 8-103. Emergency Shutdown Logging Structure</caption> <tr> <th colspan="8">+3</th> <th colspan="8">+2</th> <th colspan="8">+1</th> <th colspan="8">+0</th> </tr> <tr> <th>31</th> <th>30</th> <th>29</th> <th>28</th> <th>27</th> <th>26</th> <th>25</th> <th>24</th> <th>23</th> <th>22</th> <th>21</th> <th>20</th> <th>19</th> <th>18</th> <th>17</th> <th>16</th> <th>15</th> <th>14</th> <th>13</th> <th>12</th> <th>11</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th>109876543210</th> <th></th> <th></th> <th></th> <th></th> </tr> </table> <figure> DWORD 0 DWORD 1 Emergency Shutdown Log 0 DWORD 2 DWORD 3 Emergency Shutdown Log 1 ... ... DWORD 2L-2 { \text { DWORD } }<br>{ 2 L - 1 } Emergency Shutdown Log L-1 </figure> <table> <caption>Table 8-113. Emergency Shutdown Logging Fields</caption> <tr> <th>Field Name</th> <th>DWORD &amp; Bit Location</th> <th>Standard Security Asset Class IDª</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>Emergency Shutdown Log&lt;0:L-1&gt;</td> <td>0 to 2L-1</td> <td>17</td> <td>RO</td> <td>Emergency Shutdown Log Emergency Shutdown Log entryb as defined by the Emergency Shutdown Logging Capability structure“. Each Emergency Shutdown Log is a 64-bit registerd. The lower address DWORD contains the lower 32 bits of the 64-bit register and the upper address DWORD contains the upper 32 bits of the 64-bit register. Controlled by Emergency Shutdown Logging controls.</td> </tr> </table> a. See Table 8-7 for a description of Standard Security Asset Class IDs. b. For log entries associated with an Emergency Shutdown Logging Capability Type of 002h (Trigger Vector Logging Capability), if the log register is cleared by software while the respective Emergency Shutdown Trigger is still asserted, the log bit should be set again. c. The Power Management Director can enable one or more logging capabilities in the Emergency Shutdown Logging Control structure to control these logs. d. The Power Management Director can read these logs and take an action based on the recorded values as appropriate. ## 8.4.2.2.5 Emergency Shutdown Address Map This section describes the address map of all the structures related to Emergency Shutdown. Figure 8-104. Emergency Shutdown Address Map <figure> FFFF FFFF FFFF FFFFh Emergency Shutdown Logging Structure DW 2 (L-1), 2(L-1)+1 DW 2.3 DW 0. 1 For up to L Emergency Shutdown Logs Emergency Shutdown Open Drain Capability Open drain signal capability (ES) Emergency Shutdown Trigger Capability and Control DW 8 (N-1)+1+Offset to 8 (N-1)+B+Offset For up to N Emergency Shutdown Trigger Control DW 1-8 + Offset Emergency Shutdown Trigger Control Offset (N+4) DW0+Offset DW N+3 For Up to N Emergency Shutdown Trigger Capabilities Emergency Shutdown Open Drain Capability Pointer DW4 DW3 DW2 high) DW1 (OD Pointer low) DWO Capability Directory Emergency Shutdown Trigger Capability Emergency Shutdown Logging Capability Emergency Shutdown Response Capability Emergency Shutdown Response Capability and Control Emergency Shutdown Response Control Offset (2M4+4) DW 0-1 + Offset $D W \quad 2 \left( M - 1 \right) + 4 , 2 \left( M - 1 \right) + 5$ Emergency Shutdown Response Control DW 4, 5 DW3 DWZ high) DW1 (OD Pointer low) DWO For up to M Emergency Shutdown Response States Emergency Shutdown Open Drain Capability Pointer Emergency Shutdown Logging Capability and Control DW L+1 + Offset Emergency Shutdown Logging Control Offset (L+4) 2 + Offset DW 1 + Ultset DW 0 + Offset For up to L Emergency Shutdown Logging Controls DW DW (L-1)+4 For up to L Emergency Shutdown Logging Capabilities DW4 DW3 (ES logging Pointer high) DW2 (ES Logging Pointer low) DWI DWO Emergency Shutdown Logging Structure Pointer 0000 0000 0000 0000h </figure> § § ### 9.0 Configuration and Parameters #### 9.1 High-level Software View of UCIe A key goal of UCIe is to leverage all the software investments made for PCIe and CXL while still defining the interface in an extensible way for future innovative solutions. To that end, UCIe SW view of the protocol layer is consistent with the associated protocol. For example, the host Downstream Port for UCIe that is capable of supporting CXL protocols will appear to software as a Root Port with CXL DVSEC capability and relevant PCIe capabilities. Similarly, a host downstream port for UCIe that is capable of supporting PCIe protocol only, will appear to software as a Root Port with relevant PCIe capabilities only. Host side or device side view of software for Streaming protocol is implementation- specific since the protocol itself is implementation-specific. It is though strongly recommended that ecosystem implementations define streaming solutions leveraging the SW hooks already in place for supporting CXL and PCIe. The Upstream Ports that connect to a UCIe Root Port can be a PCIe endpoint, PCIe Switch, a CXL endpoint-device, or a CXL Switch. This allows for UCIe solution to be fully backward compatible to pre-UCIe software. The remainder of this chapter talks about SW view of UCIe when paired with PCIe or CXL protocol layers. UCIe specification allows for a single UCIe Link to be shared by multiple protocol stacks. In this version of the spec, this sharing is limited to at most 2 protocol stacks. Shared Link layer is a new concept from Software perspective and requires new discovery/control mechanisms. The mechanism by which UCIe-aware SW discovers UCIe capability is described in the next section. Table 9-1 shows the legal/illegal combinations of Upstream and Downstream devices/ports at a given UCIe interface, from a SW viewpoint. <table> <caption>Table 9-1. Software view of Upstream and Downstream Device at UCIe interface</caption> <tr> <th rowspan="2">Downstream Component: SW View</th> <th colspan="4">Upstream Component: SW View</th> </tr> <tr> <th>PCIe RP, PCIe Switch DSpa</th> <th>CXL-RP, CXL Switch DSpb</th> <th>CXL Downstream Port RCRBC</th> <th>Streaming Device</th> </tr> <tr> <td>PCIe EP, PCIe Switch USP</td> <td>Valid</td> <td>Valid</td> <td>Illegal</td> <td rowspan="3">Vendor defined</td> </tr> <tr> <td>CXL Upstream Port RCRBd</td> <td>Illegal</td> <td>Illegal</td> <td>Illegal</td> </tr> <tr> <td>CXL EP</td> <td>Valid</td> <td>Valid</td> <td>Illegal</td> </tr> <tr> <td>Streaming Device</td> <td>Vendor defined</td> <td></td> <td colspan="2"></td> </tr> </table> a. PCIe RP = As defined in PCIe Base Specification b. CXL RP/Switch DSP = Standard PCIe RP/Switch-DSP with additional CXL Flexbus Port DVSEC capability c. CXL Downstream Port RCRB = CXL Link at host or at Switch DSP that is enumerated via CXL defined Downstream Port RCRB (instead of via a Root Port) d. CXL Upstream Port RCRB = CXL upstream port that is enumerated via CXL defined RCRB with CXL Upstream Port RCRB and that has a RCIEP below it. All the CXL/PCIe legacy/advanced capabilities/registers defined in the respective specifications apply to UCIe host and devices as well. Some Link and PHY layer specific registers in PCIe Base Specification do not apply in UCIe context and these are listed in the appendix. In addition, two new DVSEC capabilities and four other MMIO mapped register blocks are defined to deal with UCIe-specific Adapter and Physical Layer capabilities. #### 9.2 SW Discovery of UCIe Links UCIe-aware Firmware/Software may discover the presence and capabilities of UCIe Links in the system per Table 9-2. <table> <caption>Table 9-2. SW discovery of UCIe Links</caption> <tr> <th>UCIe Links</th> <th>How discovered?</th> <th>Salient Points</th> </tr> <tr> <td>In Host</td> <td>Host specific Register Block called UiRB, containing UCIe Link DVSEC Capability</td> <td>· UiRB is at a host defined static location. · Each UCIe Link has a separate URB Base address and these are enumerated to OS via UCIe Early discovery table (UEDT)ª · Association of a UCIe Link to 1 or more Root ports is described in UEDT, allowing for UCIe-aware SW to understand the potential shared nature of the UCIe Link.</td> </tr> <tr> <td>In Endpoints</td> <td>Dev0/Fn0 of the device carries a UCIe Link DVSEC Capability.</td> <td>. In multi-stack implementations, Dev0/Fn0 of the endpoint in only one of the stacks carries the UCIe Link DVSEC Capability.</td> </tr> <tr> <td>In Switch USP</td> <td>Dev0/Fn0 of the USP carrying a UCIe Link DVSEC Capability</td> <td>. In multi-stack implementations, Dev0/Fn0 of the USP in only one of the stacks carries the UCIe Link DVSEC Capability.</td> </tr> <tr> <td>In Switch DSP</td> <td>Dev0/Fn0 of the Switch USP carrying one ore more UiSRB DVSEC Capability</td> <td>. UCIe Links below the switch are described in UiSRB whose base address is provided in the UiSRB DVSEC Capability · A UCIe Link DVSEC capability per downstream UCIe Link is present in the UiSRB · Association of a UCIe Link to 1 or more Switch DSPs is described as part of the UCIe Link DVSEC Capability, allowing for UCIe-aware SW to understand the potential shared nature of the UCIe interface Note: It is legal for a Switch USP to carry the UiSRB DVSEC capability but not a UCIe Link DVSEC Capability</td> </tr> </table> a. UEDT structure is standardized as part of the ACPI specification. #### 9.3 Register Location Details and Access Mechanism · 2 UCIe DVSEC capabilities (UCIe Link DVSEC, UiSRB DVSEC) and four other MMIO-mapped register blocks are defined in this version of the Specification. . UCIe Link DVSEC capability is located in UiRB for host root ports and in UiSRB for Switch downstream ports. · UiRB region is defined at a static location on the host side and its size is enumerated in the UEDT structure. Only UCIe Link related registers are permitted in this region and designs must not implement non-UCIe related functionality in this region. . There is a unique UiRB base address for each UCIe Link, in the host · UiSRB region base address is provided in the UiSRB DVSEC capability. This region is part of a BAR region of Switch Dev0/Fn0 USP. . For scalability/flexibility reasons, multiple UiSRB DVSEC capabilities can exist in a Switch USP function. In case of multiple UiSRB DVSEC capabilities in the USP. a given DSP UCIe Link can only be described in one of the UiSRB structures. · Configuration space registers are accessed using configuration reads and configuration writes. Register Blocks are in memory mapped regions and are accessed using standard memory reads and memory writes. . UCIe Retimer registers are not directly accessible from host SW. They can be accessed only by way of a Mailbox mechanism over the sideband interface (hence the terms SB-MMIO and SB- Config in Table 9-3). The Mailbox mechanism is available via RP/DSP UCIe Link DVSEC Capability to access the UCIe Retimer registers on the Retimer closest to the host. For accessing UCIe Retimer registers on the far end Retimer, the same Mailbox mechanism is also available in the UCIe Link DVSEC capability of EP/USP. See Section 9.5.1.11 and Section 9.5.1.12 for details of the Mailbox mechanism. · For debug and runtime Link health monitoring reasons, host SW can also access the UCIe related registers in any partner die on the sideband interface, using the same Mailbox mechanism. For brevity purposes, that is not shown in Table 9-3. Note that register accesses over sideband are limited to only the UCIe-related Capability registers (the two DVSECs currently defined in the spec) and the four defined UCIe Register Blocks. Nothing else on the remote die are accessible via the sideband mechanism. Table 9-3 summarizes the location of various register blocks in each native UCIe port/device. Henceforth a "UCIe port/device/EP/Switch" is used to refer to a standard PCIe or CXL port/device/EP/ Switch with UCIe Link DVSEC Capability. <table> <caption>Table 9-3. Summary of location of various UCIe Link related registers</caption> <tr> <th rowspan="2">Register</th> <th colspan="5">Where the Register Resides</th> <th rowspan="2">Comments</th> </tr> <tr> <th>RP</th> <th>Switch USP</th> <th>Switch DSP</th> <th>EP</th> <th>UCIe Retimer</th> </tr> <tr> <td>UCIe Link DVSEC</td> <td>UİRB</td> <td>Config space</td> <td>UİSRB</td> <td>Config Space</td> <td>Sideband Config Space</td> <td>Registers that define the basic UCIe interface related details</td> </tr> <tr> <td>UCIe D2D/PHY Register Block</td> <td>UİRB</td> <td>Switch USP-BAR Region</td> <td>UİSRB</td> <td>EP-BAR Region</td> <td>SB-MMIO Space</td> <td>Registers that define lower- level functionality for the D2D/ PHY interface of a typical UCIe implementation</td> </tr> <tr> <td>UCIe Test/ Compliance Register Block</td> <td>UİRB</td> <td>Switch USP-BAR Region</td> <td>UİSRB</td> <td>EP-BAR Region</td> <td>SB-MMIO Space</td> <td>Registers for Test/Compliance of UCIe interface</td> </tr> <tr> <td>UCIe Implementation Specific Register Block</td> <td>UİRB</td> <td>Switch USP-BAR Region</td> <td>UİSRB</td> <td>{ E P - B A R }<br>{ R e q i o n }</td> <td>SB-MMIO Space</td> <td>Registers for vendor specific implementation</td> </tr> </table> #### 9.4 Software view Examples Figure 9-1 summarizes all the details of UCIe related DVSEC Capabilities and SW discovery, for an implementation consisting of Root Ports and Endpoints. This example has a host with 2 UCIe downstream Links that each carry traffic from 2 Root Ports. <figure> <figcaption>Figure 9-1. Software view Example with Root Ports and Endpoints</figcaption> Host Bridge Host Bridge UČIeO PHY Implementation Specific Header UCie1 PHY Implementation Specific Header UCIc0 D2D Implementation Specific Header UCle1 D20 Implementation Specific Header Reserved Reserved UCleO Comp/Test UCle1 Comp/Test Header Header Reserved Recurved UCle Link DVSEC UCIeO PHY/D2D UCle1 PHY/D2D Header Reminded Header Reserved UCle Link DVSEC MSI capability MSI capability Pirstorvikİ Réservedi Host defined UiRB Base Address 0 KUCle LinkO DEVSEC Reg Locator Next Cap UCle Link 1 DEVSFC Reg Locator Next Cap Host defined UIRB Base Address 1 UCle0 Root Port Root Port UCle1 Root Port Root Port Type 1 Header DevN, FnD Type 1 Header DevM, FriD Type 1 Header DevX, Fn0 Type 1 Header DevY, FnO UCle0 UGe1 Logical link Logical link Logical link Logical link UDe Udle Type 0 Header Devo, Fn0 Type D Header Devo, Fn0 Type O Header Devo, Fn0 Type O Header Dev0, Fr0 EP EP EP EP UCle Link DVSEC </figure> Example in Figure 9-2 has a Switch with 2 UCIe Links on its downstream side and each UCIe Link carries traffic from 2 Switch DSPs. <figure> <figcaption>Figure 9-2. Software view Example with Switch and Endpoints</figcaption> UiSRB in Switch USP BAR region Reserved UCIe1 PHY Implementation Specific Header Reserved UCIe1 D2D Implementation Specific Header UCIe1 Comp/Test Header UCIe1 PHY/D2D Header UCIe Link DVSEC LICle Link1 DEVSFC Reg Locator $\mathrm { N e x t } \mathrm { C a p } = 0 h$ UCIe0 PHY Implementation Specific Header UCIe0 D2D Implementation Specific Header UCIe0 Comp/Test Header UCIe0 PHY/D2D Header UCle Link0 DEVSFC Reg Locator Next Cap From UiSRB DVSEC UCIe0 Switch DSP Switch DSP UCIe1 Switch DSP Switch DSP Type 1 Header DevN, Fn0 Type 1 Header $\mathrm { D e v N } , F n O$ Type 1 Header DevN, Fn0 Type 1 Header DevN, Fn0 UCIe0 UCIe1 $\log _ { 1 } \left( \frac { \ln k } { k } \right.$ Logical link Logical link Logical link UCIe UCIe Type 0 Header Dev0, Fn0 Type 0 Header Dev0, Fn0 Type 0 Header Dev0, Fn0 Type 0 Header Dev0, Fn0 EP EP EP EP UCIe Link DVSEC </figure> Example in Figure 9-3 shows details UCIe registers in an implementation where two EPs are sharing a common UCIe Link. <figure> <figcaption>Figure 9-3. Software view Example of UCIe Endpoint</figcaption> UCle PHY Implementation Specific Header From <BIR-BAR + Reg-offset of UCle PHY Implementation Specific Reg Locator> UCle D2D Implementation Specific Header From <BIR-BAR + Reg-offset of UCle D2D Implementation Specific Reg Locator> UCle Comp/Test Header From <BIR-BAR + Reg-offset of UCle Comp/Test Reg Locator> UCle PHY/D2D Header From <BIR-BAR + Reg-offset of UCle PHY/D2D Reg Locator> UCle Type 0 Header Dau Cnn LIClo Link DEVSEC Reg Locator Type 0 Header Dev0, Fn0 Next Cap UCle Link DVSEC EP EP </figure> #### 9.5 UCIe Registers Table 9-4 summarizes the attributes for the register bits defined in this chapter. Unless otherwise specified, the definition of these attributes is consistent with PCIe Base Specification and CXL Specification. <table> <caption>Table 9-4. Register Attributes</caption> <tr> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$R O$</td> <td>Read Only</td> </tr> <tr> <td>ROS</td> <td>Read Only Stickyª</td> </tr> <tr> <td>$R W$</td> <td>Read-Write</td> </tr> <tr> <td>RWL</td> <td>Read Write Lock Follow RW behavior until locked. When locked, the bit value cannot be altered by software. The locking condition associated with each RWL field is specified as part of the field definition.</td> </tr> <tr> <td>RWO</td> <td>$R e a d - W r i t e - O n e - T o - L o c k$ Field becomes RO after writing 1 to it. Cleared by management reset.</td> </tr> <tr> <td>RWS</td> <td>Read Write Stickyª</td> </tr> <tr> <td>RW1C</td> <td>Read-Write-One-To-Clear</td> </tr> <tr> <td>RW1CS</td> <td>Read-Write-One-To-Clear-Stickyª</td> </tr> <tr> <td>HWInit</td> <td>Hardware Initializedb</td> </tr> <tr> <td>RsvdP</td> <td>Reserved and Preserved</td> </tr> <tr> <td>RsvdZ</td> <td>Reserved and Zero</td> </tr> </table> a. Definition of 'sticky' follows the underlying protocol definition if any of the Protocol stacks are PCIe or CXL. For Streaming, the sticky registers are recommended to preserve their value even if the Link is down. In all scenarios, Domain Reset must initialize these to their default values. b. Typically, this register attribute is used for functionality/capability that can vary with package integration. For example, a chiplet that is capable of 32 GT/s maximum speed might be routed to achieve a maximum speed of 16 GT/s in a given package implementation. To account for such scenarios, the Max link speed field in the UCIe Link Capability register has the HWInit attribute and its value could be configured by a package-level strap or device/system firmware to reflect the maximum speed of that implementation. All numeric values in various data structures, individual registers and register fields defined in this chapter are always encoded in little endian format, unless stated otherwise. ##### 9.5.1 UCIe Link DVSEC This is the basic capability register set that is required to operate a UCIe Link. And this is one of two DVSEC capabilities defined for UCIe in the first generation. Not all the registers in the capability are applicable to all device/port types. The applicable registers for each device/port type are indicated in the right side of Figure 9-4. Software may use the presence of this DVSEC to differentiate between a UCIe device vs. a standard PCIe or CXL device. Software may use this DVSEC to differentiate between a UCIe Root Port and a standard PCIe or CXL Root Port. <table> <caption>Figure 9-4. UCIe Link DVSEC</caption> <tr> <th colspan="3">PCI Express Extended Capability Header</th> </tr> <tr> <th colspan="3">Designated Vendor Specific Header 1</th> </tr> <tr> <th>Capability Descriptor</th> <th colspan="2">Designated Vendor Specific Header 2</th> </tr> <tr> <td>UCIe Link</td> <td colspan="2">Capability</td> </tr> <tr> <td>UCIe</td> <td>Link Controle</td> <td></td> </tr> <tr> <td>UCIe</td> <td colspan="2">Link Status</td> </tr> <tr> <td>Error Notification Control</td> <td colspan="2">Link Event Notification Control</td> </tr> <tr> <td colspan="3">Register Locator 0 Low</td> </tr> <tr> <td>Register</td> <td>Locator 0 High</td> <td></td> </tr> <tr> <td></td> <td>...</td> <td></td> </tr> <tr> <td></td> <td>...</td> <td></td> </tr> <tr> <td></td> <td>Reserved</td> <td></td> </tr> <tr> <td>Sideband</td> <td>Mailbox Index Low</td> <td></td> </tr> <tr> <td colspan="3">Sideband Mailbox Index High</td> </tr> <tr> <td>Sideband</td> <td>Mailbox Data Low</td> <td></td> </tr> <tr> <td>Sideband</td> <td>Mailbox Data High</td> <td></td> </tr> <tr> <td>Reserved</td> <td>Sideband Mailbox Status</td> <td>Sideband Mailbox Control</td> </tr> <tr> <td colspan="3">Requester ID/Reserved</td> </tr> <tr> <td></td> <td colspan="2">Reserved</td> </tr> <tr> <td>Associated</td> <td colspan="2">Port Numbers (1-N)</td> </tr> <tr> <td></td> <td colspan="2">...</td> </tr> </table> <figure> a b c </figure> d a. Applies to UCIe-EP, UCIe-USP, UCIe-Retimer. b. Applies to UCIe-EP, UCIe-USP when paired with a retimer. c. Applies to UCIe-RP. d. Applies to UCIe-DSP. e. Software writes to this register need to be broadcast to both D2D Adapter and PHY blocks because some registers could be implemented in either block or both blocks. ###### 9.5.1.1 PCI Express Extended Capability Header (Offset 0h) Set as follows for UCIe Link DVSEC. All bits in this register are RO. <table> <caption>Table 9-5. UCIe Link DVSEC - PCI Express Extended Capability Header</caption> <tr> <th>Field</th> <th>Bit Location</th> <th>Value</th> <th>Comments</th> </tr> <tr> <td>Capability ID</td> <td>15:0</td> <td>0023h</td> <td>Value for PCI Express DVSEC capability</td> </tr> <tr> <td>Revision ID</td> <td>19:16</td> <td>1h</td> <td>Latest revision of the DVSEC capability</td> </tr> <tr> <td>Next Capability Offset</td> <td>31:20</td> <td>Design Dependent</td> <td>For UCIe Link DVSEC in UiRB: Set to point to the next capability associated with this UCIe Link. In this revision of the spec, this $T h e \quad o f f s e t \quad i s \quad i n \quad g r a n u l a r i t y \quad o f \quad B y t e s \quad f r o m \quad t h e$ is set to 100h, the next capability is located at offset of 100h from the base of UiRB. UCIe Link DVSEC in UiSRB: Set to point to the UCIe Link DVSEC capability of the next UCIe Link associated with a downstream port of the switch. The last UCIe Link DVSEC capability will set this offset to 0h indicating there are no more UCIe Links on downstream ports. The offset is in granularity of Bytes from the base address of UiSRB. For example, if this is set to 100h, the next DVSEC capability for the next Link is located at offset of 100h from the base of UiSRB. Retimer: Set to 0h Others: design dependent</td> </tr> </table> ##### 9.5.1.2 Designated Vendor Specific Header 1, 2 (Offsets 4h and 8h) A few things to note on the various fields described in Table 9-6. DVSEC Revision ID field represents the version of the DVSEC structure. The DVSEC Revision ID is incremented whenever the structure is extended to add more functionality. Backward compatibility shall be maintained during this process. For all values of n, DVSEC Revision ID n+1 structure may extend Revision ID n by replacing fields that are marked as reserved in Revision ID n, but must not redefine the meaning of existing fields. Software that was written for a lower Revision ID may continue to operate on UCIe DVSEC structures with a higher Revision ID, but will not be able to take advantage of new functionality. All bits in this register are RO. <table> <caption>Table 9-6. UCIe Link DVSEC - Designated Vendor Specific Header 1, 2</caption> <tr> <th>Register</th> <th>Field</th> <th>Bit Location</th> <th>Value</th> </tr> <tr> <td rowspan="3">Designated Vendor-Specific Header 1 (offset 04h)</td> <td>DVSEC Vendor ID</td> <td>15:0</td> <td>D2DEh</td> </tr> <tr> <td>DVSEC Revision</td> <td>19:16</td> <td>0h</td> </tr> <tr> <td>Length</td> <td>31:20</td> <td>Device dependent. See Section 9.5.1.19 for some examples.</td> </tr> <tr> <td>Designated Vendor-Specific Header 2 (offset 08h)</td> <td>DVSEC ID</td> <td>15:0</td> <td>0h</td> </tr> </table> ## 9.5.1.3 Capability Descriptor (Offset Ah) Provides a way for SW to discover which optional capabilities are implemented by the UCIe Port/ Device. <table> <caption>Table 9-7. UCIe Link DVSEC - Capability Descriptor</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="3">$2 : 0$</td> <td rowspan="3">RO</td> <td>Number of Register locators 0h: 2 Register Locators 1h: 3 Register Locators 2h: 4 Register Locators</td> </tr> <tr> <td>... 6h: 8 Register locators 7h: 1 Register Locator</td> </tr> <tr> <td>For this revision of UCIe, only values 0h, 1h, 2h and 7h are valid.</td> </tr> <tr> <td rowspan="2">3</td> <td rowspan="2">RO(RP/DSP), HWInit(EP/USP), RsvdP(Retimer)</td> <td>Sideband mailbox Registers Present 0h: No sideband mailbox register set present in this capability 1h: Sideband mailbox register set present in this capability For RP/DSP, default value of this is 1.</td> </tr> <tr> <td>EP/USP must set this bit when they are paired with a retimer and must clear this bit in all other scenarios.</td> </tr> <tr> <td rowspan="5">7:4</td> <td rowspan="5">RO(DSP), RsvdP (Others)</td> <td>Number of Switch DSPs associated with this UCIe Link Applies only to UCIe Link DVSEC in UiSRB.</td> </tr> <tr> <td>The specific 'port number' values of each Switch downstream port associated with this UCIe Link is called out in the Associated Port Number register(s) in this capability.</td> </tr> <tr> <td>0h: 1 Port 1h: 2 ports ... Fh: 16 ports</td> </tr> <tr> <td>'Port Number' is bits 31:24 of the PCIe Link capabilities register of the downstream port.</td> </tr> <tr> <td>For first generation of UCIe, only values 0h and 1h are legal.</td> </tr> <tr> <td>15:8</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ### 9.5.1.4 UCIe Link DVSEC - UCIe Link Capability (Offset Ch) Basic characteristics of the UCIe Link are discovered by SW using this register. <table> <caption>Table 9-8. UCIe Link DVSEC - UCIe Link Capability (Sheet 1 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RO</td> <td>Raw Format If set, indicates the Link can support Raw Format.</td> </tr> <tr> <td>3:1</td> <td>HWInit</td> <td>Max Link Width 0h: x16 4h: x256 1h: x32 7h: x8 2h: x64 Others: Reserved 3h: x128</td> </tr> <tr> <td>7:4</td> <td>HWInit</td> <td>Max Link Speeds $O h : 4 \quad G T / s$ $5 h : 3 2 \quad G T / s$ { 1 h : 8 G 1 / 5 }<br>{ 2 h \cdot 1 2 G T / s } 6h: 48 GT/s 7h: 64 GT/s $3 h : 1 6 \quad G T / s$ Others: Reserved</td> </tr> <tr> <td>8</td> <td>$R O \left( R e t i m e r \right) _ { r } ,$</td> <td>Retimer - Set by retimer to indicate it to SW</td> </tr> <tr> <td>9</td> <td>{ \text { RsvdP \left(Retimer } }<br>{ \text { RO \left(others\right) ,$</td> <td>Multi-protocol capableª $0 - \mathrm { s i n g l e } \sec k$ Only 2 stacks max is possible</td> </tr> <tr> <td>10</td> <td>RO</td> <td>Advanced Packaging $0 = S t a n d a r d \quad p a c k a g e$ mode for UCIe Link 1 package mode for UCIe Link</td> </tr> <tr> <td>11</td> <td>RO</td> <td>68B Flit Format for Streaming Protocol Format is supported for Streaming protocol. This</td> </tr> <tr> <td rowspan="2">12</td> <td rowspan="2">$R O$</td> <td>$S t a n d a r d \quad 2 5 6 B \quad E n d \quad H e a d e r \quad F l i t \quad F o r m a t \quad f o r \quad S t r e a m i n g \quad P r o t o c o l$</td> </tr> <tr> <td>If set, indicates Standard 256B End Header Flit Format is supported Streaming protocol. This is only set if at least one of the Protocol Layers is Streaming protocol.</td> </tr> <tr> <td>13</td> <td>$R O$</td> <td>Standard 256B Start Header Flit Format for Streaming Protocol If set, indicates Standard 256B Start Header Flit Format is supported for Streaming protocol. This is only set if at least one of the Protocol Layers is Streaming protocol.</td> </tr> <tr> <td rowspan="2">14</td> <td rowspan="2">RO</td> <td>Latency-Optimized 256B Flit Format without Optional Bytes for Streaming Protocol</td> </tr> <tr> <td>If set, indicates Latency-Optimized 256B without Optional Bytes Flit Format is supported for Streaming protocol. This is only set if at least one of the Protocol Layers is Streaming protocol.</td> </tr> <tr> <td rowspan="2">15</td> <td rowspan="2">RO</td> <td>Latency-Optimized 256B Flit Format with Optional Bytes for Streaming Protocol</td> </tr> <tr> <td>If set, indicates Latency-Optimized 256B with Optional Bytes Flit Format is supported for Streaming protocol. This is only set if at least one of the Protocol Layers is Streaming protocol.</td> </tr> <tr> <td>16</td> <td>RO</td> <td>Enhanced Multi-protocol Capable 0 = Not capable of multi-protocol with different protocols $1 = C a p a b l e$ of multi-protocol with different protocols</td> </tr> </table> <table> <caption>Table 9-8. UCIe Link DVSEC - UCIe Link Capability (Sheet 2 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>17</td> <td>RO</td> <td>Standard Start Header Flit for PCIe Protocol If set, indicates Standard Start Header 256B Flit Format is supported for PCIe protocol. This is only set if at least one of the Protocol Layers is PCIe protocol.</td> </tr> <tr> <td>18</td> <td>RO</td> <td>Latency-Optimized Flit with Optional Bytes for PCIe Protocol If set, indicates that the Latency-Optimized Flit Format with Optional Bytes is supported for PCIe. This is only set if at least one of the Protocol Layers is PCIe protocol.</td> </tr> <tr> <td>19</td> <td>$R O$</td> <td>`Runtime Link Testing Parity' Feature Error Signaling If set, design supports signaling errors detected during Runtime link testing with parity as Correctable errors. If cleared, this error signaling mechanism is not supported.</td> </tr> <tr> <td>$2 0$</td> <td>HWInit</td> <td>APMW (Advanced Package Module Width) If set, indicates the Advanced Package Module size is x32 or a x64 module operating in x32 mode (decided at integration time). If reset, indicates x64 Advanced Package Module.</td> </tr> <tr> <td>21</td> <td>RO/RsvdP</td> <td>x32 Width Support in x64 Module If set, indicates that a x64 Advanced Package Module can operate in x32 mode; otherwise, it cannot operate in x32 mode. For x32 Advanced Package Module, this bit is reserved.</td> </tr> <tr> <td>$2 2$</td> <td>HWInit</td> <td>SPMW (Standard Package Module Width) If 1, indicates the Standard Package Module size is a x8 module, or a x16 module operating in x8 mode (decided at integration time). If 0, indicates x16 Standard Package Module.</td> </tr> <tr> <td>23</td> <td>$R O$</td> <td>Sideband Performant Mode Operation (PMO) When set, indicates that the sideband supports performant mode operation. When cleared, performant mode operation is not supported.</td> </tr> <tr> <td>24</td> <td>$R O$</td> <td>Priority Sideband Packet Transfer (PSPT) When set, indicates that the sideband supports priority sideband packet transfers as defined in Section 4.1.5.2. When cleared, priority sideband packet transfers are not supported.</td> </tr> <tr> <td>25</td> <td>RO</td> <td>L2 Sideband Power Down (L2SPD) When set, indicates that L2SPD is supported as defined in Section 4.5.3.9.1. When cleared, L2SPD is not supported.</td> </tr> <tr> <td>$3 1 : 2 6$</td> <td>$R s v d P$</td> <td>Reserved</td> </tr> </table> a. This bit was named and referred to as "Multi-stack" in r1.1 and prior revisions of the spec. ## 9.5.1.5 UCIe Link DVSEC - UCIe Link Control (Offset 10h) Basic UCIe Link control bits are in this register. <table> <caption>Table 9-9. UCIe Link DVSEC - UCIe Link Control (Sheet 1 of 3)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="3">0</td> <td rowspan="3">RW (RP/DSP), HWInit (Others)</td> <td>Raw Format Enable: If set, enables the Link to negotiate Raw Format during Link training.</td> </tr> <tr> <td>Default value of this is 0b for RP and firmware/SW sets this bit based on system usage scenario.</td> </tr> <tr> <td>Switch DSP can set the default via implementation-specific mechanisms such as straps/FW/etc., to account of system usage scenario (like UCIe retimer). This allows for the DSP Link to train up without Software intervention and be UCIe-unaware-OS compatible.</td> </tr> <tr> <td rowspan="2">1</td> <td rowspan="2">RW (RP/DSP), RO (EP/DSP), RsvdP (Retimer)</td> <td>Multi-protocol enableª: When set, multi-protocol training is enabled else not.</td> </tr> <tr> <td>Default is same as 'Multi-protocol Capable' bit in UCIe Link Capability register.</td> </tr> <tr> <td rowspan="6">$5 : 2$</td> <td rowspan="6">RW (RP/DSP), RsvdP (Others)</td> <td>Target Link Width</td> </tr> <tr> <td>0h: Reserved 4h: $x 6 4$</td> </tr> <tr> <td>1h: x8 5h: x128</td> </tr> <tr> <td>2h: x16 6h: $\times 2 5 6$</td> </tr> <tr> <td>3h: x32 Others: Reserved</td> </tr> <tr> <td>Default is same as 'Max Link Width' field in UCIe Link Capability register.</td> </tr> <tr> <td rowspan="7">9:6</td> <td rowspan="7">$\text { RW \left(RP/DSP\right) } }<br>{ \text { RSVdP \left(Others\right) ,$</td> <td>Target Link Speed</td> </tr> <tr> <td>0h: 4 GT/s 5h: 32 GT/s</td> </tr> <tr> <td>1h: 8 GT/s 6h: 48 GT/s</td> </tr> <tr> <td>$2 h : 1 2 \quad G T / s$ 7h: 64 GT/s</td> </tr> <tr> <td>3h: 16 GT/s Others: Reserved</td> </tr> <tr> <td>4h: 24 GT/s</td> </tr> <tr> <td>Default is same as 'Max Link speed' field in UCIe Link Capability register.</td> </tr> <tr> <td rowspan="3">10</td> <td rowspan="3">RW, with auto $\text { clear \left(RP/DSP\right) } }<br>{ \text { RsvdP \left(Others\right) ,$</td> <td>$\text { Start UCIe Link training } - \text { Whet to t to 1, Link traing starts with } }<br>{ \text { Control bits orocnram th this this reaister and with the Drotocol laveol lave } } capabilities. Bit is automatically cleared when Link training completes with either success or error. The status register captures the final status of the Link training. Note that if the Link is up when this bit is set to 1 from 0, the Link will go through full training through Link Down state thus resetting everything beneath the Link. If Link Status (in UCIe Link Status register) is Ob and the link is already in training (i.e., the link training state machine is in between RESET and ACTIVE states), when this bit transitions from 0 to 1, link does not restart the training and this bit's transition from 0 to 1 is ignored.</td> </tr> <tr> <td>Primary usage intended for this bit is for initial Link training out of reset on the host side.</td> </tr> <tr> <td>Note: For downstream ports of a switch with UCIe, local HW/FW has to autonomously initiate Link training after a conventional reset, without waiting for higher level SW to start the training via this bit, to ensure backward compatibility. Default is 0.</td> </tr> </table> <table> <caption>Table 9-9. UCIe Link DVSEC - UCIe Link Control (Sheet 2 of 3)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>11</td> <td>RW with auto clear (RP/DSP), RsvdP (Others)</td> <td>Retrain UCIe Link - When set to 1, Link that is already up (Link_status=up) will be retrained without going through Link Down state. SW can use this bit to potentially recover from Link errors. If the Link is down (Link_status=down) when this bit is set, there is no effect from this bit being set. SW should use the 'Start UCIe Link training' bit in case the Link is down. The Link_status bit in the status register can be read by software to determine whether to use this bit or not. Note that when retrain happens, the Link speed or width can change because of reliability reasons, and it will be captured through the appropriate status bit in the Link Status register. $B i t \quad i s \quad a u t o m a t i c a l l y \quad c l e a r e d \quad w h e n \quad L i n k \quad r e t r a i n i n g \quad c o m p l e t e s \quad w i t h \quad e i t h e r$ Status register) or if the Link retrain did not happen at all for the reason $D e f a u l t \quad i s \quad 0 .$</td> </tr> <tr> <td>12</td> <td>RW/RO</td> <td>Unused - Implementations are encouraged to implement this as an RO bit with a default value of 0. However, for backward compatibility, implementations are permitted to implement this as an RW bit with a default value of 1. Writes to this bit have no effect on link functionality.</td> </tr> <tr> <td>13</td> <td>RW</td> <td>68B Flit Format for Streaming Protocol If set, enables 68B Flit Format advertisement if the corresponding capability is supported. Default is same as the '68B Flit Format for Streaming Protocol' bit in the UCIe Link Capability register.</td> </tr> <tr> <td>14</td> <td>RW</td> <td>Standard 256B End Header Flit Format for Streaming Protocol If set, enables Standard 256B End Header Flit Format advertisement if the corresponding capability is supported. Default is same as the 'Standard 256B End Header Flit Format for Streaming Protocol' bit in the UCIe Link Capability register.</td> </tr> <tr> <td>15</td> <td>RW</td> <td>Standard 256B Start Header Flit Format for Streaming Protocol If set, enables Standard 256B Start Header Flit Format advertisement if the corresponding capability is supported. { \text { Default is same as th } }<br>{ \text { Streamina Protocol^{\prime } b } } 'Standard 256B Start Header Flit Format for bit in the UCIe Link Capability register.</td> </tr> <tr> <td>16</td> <td>RW</td> <td>Latency -Optimized 256B Flit Format without Optional Bytes for $I f \quad s e t , e n a b l e s \quad L a t e n c y - O p t i m i z e d \quad 2 5 6 B \quad F l i t \quad F o r m a t \quad w i t h o u t \quad O p t i o n a l$ bytes Default is same as the 'Latency-Optimized 256B Flit Format without for Streaming Protocol' bit in the UCIe Link Capability register.</td> </tr> <tr> <td>17</td> <td>RW</td> <td>Latency-Optimized 256B Flit Format with Optional Bytes for Streaming Protocol If set, enables Latency-Optimized 256B Flit Format with Optional bytes advertisement if the corresponding capability is supported. Default is same as the 'Latency-Optimized 256B Flit Format for Streaming Protocol' bit in the UCIe Link Capability register.</td> </tr> <tr> <td>18</td> <td>RW (RP/DSP), RO (EP/USP), RsvdP (Retimer)</td> <td>Enhanced Multi-Protocol Enable When set, enhanced multi-protocol training is enabled else not. Enhanced Multi-Protocol permits 2 stacks with the same or different protocols. Default is same as 'Enhanced Multi-Protocol Capable' bit in UCIe Link Capability register.</td> </tr> <tr> <td>19</td> <td>RW</td> <td>Standard Start Header Flit for PCIe Protocol If set, enables Standard Start Header 256B Flit Format for PCIe protocol. Default is same as 'Standard Start Header Flit for PCIe Protocol' bit in UCIe Link Capability register.</td> </tr> </table> <table> <caption>Table 9-9. UCIe Link DVSEC - UCIe Link Control (Sheet 3 of 3)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>20</td> <td>RW</td> <td>Latency-Optimized Flit with Optional Bytes for PCIe Protocol If set, enables the Latency-Optimized Flit Format with Optional Byte for PCIe. Default is same as 'Latency-Optimized Flit with Optional Bytes for PCIe Protocol' bit in UCIe Link Capability register.</td> </tr> <tr> <td>21</td> <td>RW</td> <td>Sideband Performant Mode Operation (PMO) When set, Sideband Performant Mode Operation is enabled for negotiation; otherwise, it is not. Default is the same as the corresponding Capability bit.</td> </tr> <tr> <td>22</td> <td>RW</td> <td>Priority Sideband Packet Transfer (PSPT) When set, PSPT is enabled for negotiation; otherwise, it is not. Default is the same as the corresponding Capability bit.</td> </tr> <tr> <td>23</td> <td>RW</td> <td>L2 Sideband Power Down (L2SPD) When set, L2SPD is enabled for negotiation; otherwise, it is not. Default is the same as the corresponding Capability bit.</td> </tr> <tr> <td>31:24</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> a. This bit was named and referred to as "Multi-stack" in r1.1 and prior revisions of the spec. ## 9.5.1.6 UCIe Link DVSEC - UCIe Link Status (Offset 14h) Basic UCIe Link status bits are in this register. <table> <caption>Table 9-10. UCIe Link DVSEC - UCIe Link Status (Sheet 1 of 3)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RO</td> <td>Raw Format Enabled: If set, indicates the Adapter negotiated Raw Format operation with remote Link partner. This bit is only valid when Link Status bit in this register indicates 'Link Up'.</td> </tr> <tr> <td>1</td> <td>RsvdZ (Retimer), RO (Others)</td> <td>Multi-protocol enabledª: When set, multi-protocol training has been enabled with remote training partner. This bit is only valid when Link Status bit in this register indicates 'Link Up'.</td> </tr> <tr> <td>2</td> <td>{ \text { Rsvdz \left(Retimer\right) } }<br>{ \text { RO \left(Others\right) ,$</td> <td>Enhanced Multi-protocol Enabled When set, multi-protocol training has been enabled with remote training partner. This bit is only valid when Link Status bit in this register indicates 'Link Up'.</td> </tr> <tr> <td>3</td> <td>$R O$</td> <td>x32 Advanced Package Module Enabled $\text { When set } }<br>{ \times 3 2 ,$ indicates that the Advanced Package operating module size is</td> </tr> <tr> <td>$6 : 4$</td> <td>RsvdZ</td> <td>Reserved</td> </tr> <tr> <td rowspan="3">10:7</td> <td rowspan="3">RO</td> <td>Link Width enabled 0h: $x 4$ 4h: x64 $1 h : \times 8 }<br>{ 2 h : x 1 } 5h: x128 6h: x256</td> </tr> <tr> <td>$3 h : x 3 2$</td> </tr> <tr> <td>This has meaning only when Link status bit shows Link is up.</td> </tr> <tr> <td rowspan="2">$1 4 : 1 1$</td> <td rowspan="2">RO</td> <td>Link Speed enabled 0h: 4 GT/s $5 h : 3 2 \quad G T / s$ $2 h : 1 2 \quad G T / s$ 6h: 48 GT/s 3h: 16 GT/s 7h: 64 GT/s $4 h : 2 4 \quad G T / s$ Others: Reserved</td> </tr> <tr> <td>This field has meaning only when Link status field shows Link is up.</td> </tr> </table> <table> <caption>Table 9-10. UCIe Link DVSEC - UCIe Link Status (Sheet 2 of 3)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>15</td> <td>RO</td> <td>Link Status 0 - Link is down. 1 - Link is up This bit indicates the status of the mainband. Transitioning a Link from down to up requires a full Link training, which can be achieved using one of these methods: . Start Link training via the bits in the UCIe Link Control register of the upstream device . Using the protocol layer reset bit associated with the Link, like the SBR bit in the BCTL register of the RP P2P space . Using the protocol layer Link Disable bit associated with the Link, like the Link Disable bit in the Link CTL register of the PCIe capability register in the RP P2P space, and then releasing the disable. Notes: If the Link is actively retraining, this bit reflects a value of 1. This bit is a consolidated status of the RDI and FDI (i.e., if both the RDI and FDI are up, then this bit is set to 1; otherwise, this bit is cleared to 0). In multi-stack implementations, this bit is a consolidated status of the RDI and any of the FDIs (i.e., if RDI is up and any of the to 0). FDIs is up, then this bit is set to 1; otherwise, this bit is cleared</td> </tr> <tr> <td>16</td> <td>RO</td> <td>Link Training/Retraining 1b - Currently Link is training or retraining 0b - Link is not training or retraining</td> </tr> <tr> <td>17</td> <td>RW1C (RP/DSP), RsvdZ (Others)</td> <td>Link Status changed 1b - Link either transitioned from up to down or down to up. $O b \quad - \quad N o \quad L i n k \quad s t a t u s \quad c h a n g e \quad s i n c e \quad t h e \quad l a s t \quad t i m e \quad S W \quad c l e a r e d \quad t h i s \quad b i t$</td> </tr> <tr> <td>18</td> <td>RW1C (RP/DSP), RsvdZ (Others)</td> <td>UCIe autonomously changed the Link width or speed to correct $\mathrm { L i n k }$ reliability related issues.</td> </tr> <tr> <td>19</td> <td>RW1CS</td> <td>Detected UCIe Link correctable error Further details of specific type of correctable error is found in Table 9-30 register.</td> </tr> <tr> <td>20</td> <td>RW1CS</td> <td>Detected UCIe Link Uncorrectable Non-fatal error Further details of specific type of Uncorrectable error is found in Table 9-27 register.</td> </tr> <tr> <td>21</td> <td>RW1CS</td> <td>Detected UCIe Link Uncorrectable Fatal error Further details of specific type of Uncorrectable error is found in Table 9-27 register.</td> </tr> <tr> <td>$2 5 : 2 2$</td> <td>$R O$</td> <td>Flit Format Status This field and the Flit Format field in the Header Log 2 register in the D2D/PHY register block (see Section 9.5.3.8) are mirror copies. This field indicates the negotiated Flit Format. This field is only valid when Link Status bit in this register indicates 'Link Up'.</td> </tr> <tr> <td>26</td> <td>$R O$</td> <td>Sideband Performant Mode Operation (PMO) When set, Sideband Performant Mode Operation was successfully negotiated and is operational. When cleared, legacy mode sideband operation is active. Sideband Performant Mode is not operational. This bit has meaning only when either Link status indicates link is up (in UCIe Link Status register of UCIe Link DVSEC capability) or Table 8-12). management port capability indicates Port Status as 'Link Not Up' (see</td> </tr> </table> <table> <caption>Table 9-10. UCIe Link DVSEC - UCIe Link Status (Sheet 3 of 3)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>27</td> <td>RO</td> <td>Priority Sideband Packet Transfer (PSPT) When set, PSPT was successfully negotiated and is operational. When cleared, PSPT is not operational.</td> </tr> <tr> <td>28</td> <td>RO</td> <td>L2 Sideband Power Down (L2SPD) When set, L2SPD was successfully negotiated and is applicable for L2 entry and L2 exit. When cleared, L2SPD is not applicable.</td> </tr> <tr> <td>31:29</td> <td>RsvdZ</td> <td>Reserved</td> </tr> </table> a. This bit was named and referred to as "Multi-stack" in r1.1 and prior revisions of the spec. ## 9.5.1.7 UCIe Link DVSEC - Link Event Notification Control (Offset 18h) Link event notification related controls are in this register. <table> <caption>Table 9-11. UCIe Link DVSEC - Link Event Notification Control</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW(RP/DSP), RsvdP (Others)</td> <td>`Link Status changed' UCIe Link Event Interrupt enable 0: Reporting of this event via interrupt is not enabled 1: Reporting of this event via interrupt is enabled. Default is 0</td> </tr> <tr> <td>1</td> <td>$R W \left( R P / D S P \right) ,$ RsvdP (Others)</td> <td>`HW autonomous BW changed' UCIe Link Event Interrupt enable 0: Reporting of this event via interrupt is not enabled 1: Reporting of this event via interrupt is enabled Default is 0</td> </tr> <tr> <td>10:2</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td rowspan="3">$1 5 : 1 1$</td> <td rowspan="3">RO(RP/DSP), RsvdP(Others)</td> <td>Link Event Notification Interrupt number This field indicates which MSI vector (for host UCIe Links), or MSI/MSI-X vector (for switch DSP UCIe Links) is used for the interrupt message generated in association with the events that are controlled via this register. For MSI, the value in this field indicates the offset between the base Message Data and the interrupt message that is generated. Hardware is required to update this field so that it is correct if the number of MSI Messages assigned to the Function changes when software writes to the Multiple Message Enable field in the Message Control Register for MSI. For first generation of UCIe, maximum 2 interrupt vectors could be requested for UCIe related functionality and the 'Link event' is one of them.</td> </tr> <tr> <td>For MSI-X (applicable only for interrupts from Switch DSPs with UCIe Links), the value in this field indicates which MSI-X Table entry is used to generate the interrupt message. The entry must be one of the first 32 entries even if the Function implements more than 32 entries. For a given MSI-X implementation, the entry must remain constant.</td> </tr> <tr> <td>For UCIe related interrupts, a switch should request its interrupt requirements from either MSI or MSI-X capability but not both.</td> </tr> </table> ## 9.5.1.8 UCIe Link DVSEC - Error Notification Control (Offset 1Ah) Link error notification related controls are in this register. Note: This register only controls the propagation of the error condition and it has no impact on the setting of the appropriate status bits in the Link Status register, when the relevant error happens. <table> <caption>Table 9-12. UCIe Link DVSEC - Error Notification Control (Sheet 1 of 3)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="5">0</td> <td rowspan="5">$R W \left( R P / D S P \right) ,$ RsvdP (Others)</td> <td>`Correctable error detected' protocol layer based reporting enable</td> </tr> <tr> <td>0: Reporting of this error via protocol layer mechanism is not enabled 1: Reporting of this error via protocol layer mechanism is enabled</td> </tr> <tr> <td>Default is 0</td> </tr> <tr> <td>When enabled, the reported PCIe/CXL protocol layer correctable error type is 'Correctable internal error'.</td> </tr> <tr> <td>This bit is applicable for only RP/DSP.</td> </tr> <tr> <td rowspan="11">1</td> <td rowspan="11">RW</td> <td>`Correctable error detected' UCIe Link Error Interrupt enable RP/DSP</td> </tr> <tr> <td>0: Reporting of this error via UCIe Link Error interrupt is not enabled 1: Reporting of this error via UCIe Link Error interrupt is enabled</td> </tr> <tr> <td>EP/USP</td> </tr> <tr> <td>0: Reporting of this error via sideband error message is not enabled 1: Reporting of this error via sideband error message is enabled</td> </tr> <tr> <td>Note that in the case of EP/USP connected to a retimer, their sideband error message targets the retimer and how the retimer sends it across to the partner retimer is vendor specific.</td> </tr> <tr> <td>Retimer connected to RP/DSP</td> </tr> <tr> <td>0: Reporting of this error via sideband error message to RP/DSP is not enabled</td> </tr> <tr> <td>1: Reporting of this error via sideband error message to RP/DSP is enabled</td> </tr> <tr> <td>Retimer connected to EP/USP</td> </tr> <tr> <td>0: Reporting of this error to the partner retimer is disabled. 1: Reporting of this error to the partner retimer is enabled. The specific mechanism for reporting the error to the partner retimer is vendor- specific.</td> </tr> <tr> <td>Default is 0</td> </tr> <tr> <td rowspan="3">2</td> <td rowspan="3">RW(RP/DSP), RsvdP (Others)</td> <td>`Uncorrectable non-fatal error detected' protocol layer based reporting enable</td> </tr> <tr> <td>0: Reporting of this error via protocol layer mechanism is not enabled 1: Reporting of this error via protocol layer mechanism is enabled Default is 0</td> </tr> <tr> <td>This bit is applicable for only RP/DSP.</td> </tr> </table> <table> <caption>Table 9-12. UCIe Link DVSEC - Error Notification Control (Sheet 2 of 3)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="12">3</td> <td rowspan="12">RW</td> <td>'Uncorrectable non-fatal error detected' UCIe Link Error Interrupt enable</td> </tr> <tr> <td>RP/DSP</td> </tr> <tr> <td>0: Reporting of this error via UCIe Link Error interrupt is not enabled 1: Reporting of this error via UCIe Link Error interrupt is enabled</td> </tr> <tr> <td>EP/USP</td> </tr> <tr> <td>0: Reporting of this error via sideband error message is not enabled 1: Reporting of this error via sideband error message is enabled</td> </tr> <tr> <td>Note that in the case of EP/USP connected to a retimer, their sideband error message targets the retimer and how the retimer sends it across to the partner retimer is vendor specific.</td> </tr> <tr> <td>Retimer connected to RP/DSP</td> </tr> <tr> <td>0: Reporting of this error via sideband error message to RP/DSP is not enabled</td> </tr> <tr> <td>1: Reporting of this error via sideband error message to RP/DSP is enabled</td> </tr> <tr> <td>Retimer connected to EP/USP</td> </tr> <tr> <td>0: Reporting of this error to the partner retimer is disabled.</td> </tr> <tr> <td>1: Reporting of this error to the partner retimer is enabled. The specific mechanism for reporting the error to the partner retimer is vendor specific. Default is 0</td> </tr> <tr> <td rowspan="3">4</td> <td rowspan="3">RW (RP/DSP), RsvdP (Others)</td> <td>'Uncorrectable fatal error detected' protocol layer based reporting enable</td> </tr> <tr> <td>0: Reporting of this error via protocol layer mechanism is not enabled 1: Reporting of this error via protocol layer mechanism is enabled Default is 0</td> </tr> <tr> <td>When enabled, the reported PCIe/CXL protocol layer uncorrectable error type is 'Uncorrectable internal error' This bit is applicable for only RP/DSP.</td> </tr> </table> <table> <caption>Table 9-12. UCIe Link DVSEC - Error Notification Control (Sheet 3 of 3)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="10">5</td> <td rowspan="10">RW</td> <td>'Uncorrectable fatal error detected' UCIe Link Error Interrupt enable RP/DSP 0: Reporting of this error via UCIe Link Error interrupt is not enabled 1: Reporting of this error via UCIe Link Error interrupt is enabled</td> </tr> <tr> <td>EP/USP</td> </tr> <tr> <td>0: Reporting of this error via sideband error message is not enabled 1: Reporting of this error via sideband error message is enabled</td> </tr> <tr> <td>Note that in the case of EP/USP connected to a retimer, their sideband error message targets the retimer and how the retimer sends it across to the partner retimer is vendor specific.</td> </tr> <tr> <td>Retimer connected to RP/DSP</td> </tr> <tr> <td>0: Reporting of this error via sideband error message to RP/DSP is not enabled</td> </tr> <tr> <td>1: Reporting of this error via sideband error message to RP/DSP is enabled</td> </tr> <tr> <td>Retimer connected to EP/USP</td> </tr> <tr> <td>0: Reporting of this error to the partner retimer is disabled. 1: Reporting of this error to the partner retimer is enabled. The specific mechanism for reporting the error to the partner retimer is vendor specific.</td> </tr> <tr> <td>Default is 0</td> </tr> <tr> <td>$1 0 : 6$</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td rowspan="6">$1 5 : 1 1$</td> <td rowspan="6">RW/RO</td> <td>Link Error Notification Interrupt number</td> </tr> <tr> <td>This field indicates which MSI vector (for host UCIe Links), or MSI/MSI-X vector (for switch DSP UCIe Links) is used for the interrupt message generated in association with the events that are controlled via this register.</td> </tr> <tr> <td>For MSI, the value in this field indicates the offset between the base Message Data and the interrupt message that is generated. Hardware is required to update this field so that it is correct if the number of MSI Messages assigned to the Function changes when software writes to the Multiple Message Enable field in the Message Control Register for MSI. For first generation of UCIe, maximum 2 interrupt vectors could be requested for UCIe related functionality and the 'Error' is one of them.</td> </tr> <tr> <td>For MSI-X (applicable only for interrupts from Switch DSPs with UCIe Links), the value in this field indicates which MSI-X Table entry is used to generate the interrupt message. The entry must be one of the first 32 entries even if the Function implements more than 32 entries. For a given MSI-X implementation, the entry must remain constant.</td> </tr> <tr> <td>${ \text { For UCIe related interrupts, a switch should request its interupt } }<br>{ \text { requirements from either MSI or } M S I \text { or MSI- } x \text { capability but bot bot both. } }$</td> </tr> <tr> <td>It is strongly recommended that this field be implemented as RO but for backward compatibility reasons, it is also permitted to be implemented as RW. This field has no meaning for Switch USP and EP.</td> </tr> </table> ### 9.5.1.9 UCIe Link DVSEC - Register Locator 0, 1, 2, 3 Low (Offset 1Ch and when Register Locators 1, 2, 3 are present Offsets 24h, 2Ch, and 34h respectively) The starting address of the MMIO-mapped register blocks for D2D/PHY, Compliance/Test and Implementation-specifics are located by SW via these registers. Note: All register blocks start with a header section that indicates the size of the block in multiples of 4 KB. <table> <caption>Table 9-13. UCIe Link DVSEC - Register Locator 0, 1, 2, 3 Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="5">2:0</td> <td rowspan="5">RO</td> <td>Register BIR For UCIe DVSEC capability in host URB, Switch UiSRB and in UCIe Retimer, this field is reserved. For others, its defined as follows: Indicates which one of a Dev0/Fn0 Base Address Registers, located beginning at 10h in Configuration Space, or entry in the Enhanced Allocation capability with a matching BAR Equivalent Indicator (BEI), is used to map the UCIe Register blocks into Memory Space. Defined encodings are:</td> </tr> <tr> <td>· 0 Base Address Register 10h</td> </tr> <tr> <td>· 1 Base Address Register 14h</td> </tr> <tr> <td>· $2 \quad B a s e \quad A d d r e s s \quad R e g i s t e r \quad 1 8 h$</td> </tr> <tr> <td>· 3 · { 4 \text { Base Address Register } 2 0 h }<br>{ 5 \text { Base Address Register } 2 4 h } • All other Reserved. The Registers block must be wholly contained within the specified BAR. For a 64-bit Base Address Register, the Register BIR indicates the lower DWORD.</td> </tr> <tr> <td rowspan="6">6:3</td> <td rowspan="6">RO</td> <td>Register Block Identifier · Identifies the type of UCIe register blocks. Defined encodings are: 0h UCIe D2D/PHY Register Block</td> </tr> <tr> <td>· 1h UCIe Test/Compliance Register Block</td> </tr> <tr> <td>· 2h D2D Adapter Implementation specific register block</td> </tr> <tr> <td>· 3h PHY Implementation specific register block</td> </tr> <tr> <td>. All other encodings are reserved</td> </tr> <tr> <td>The same register block identifier value cannot be repeated in multiple Register Locator entries.</td> </tr> <tr> <td>$1 1 : 7$</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td>31:12</td> <td>RO</td> <td>Register Block Offset Addr[31:12] of the 4-KB aligned offset from the starting address of the Dev0/Fn0 BAR pointed to by the Register BIR field (for EP, Switch USP) or from the start of UiRB/UiSRB region (for hosts/Switch). This field is reserved for retimers.</td> </tr> </table> ### 9.5.1.10 UCIe Link DVSEC - Register Locator 0, 1, 2, 3 High (Offset 20h and when Register Locators 1, 2, 3 Are Present Offsets 28h, 30h, and 38h respectively) Addr[63:32] of the starting address of the MMIO-mapped register blocks for D2D/PHY, Compliance/ Test and Implementation-specifics are located by SW via these registers. Note: All register blocks start with a header section that indicates the size of the block in multiples of 4 KB. <table> <caption>Table 9-14. UCIe Link DVSEC - Register Locator 0, 1, 2, 3 High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:32</td> <td>RO</td> <td>Register Block Offset Addr[63:32] of the 4-KB aligned offset from the starting address of the Dev0/Fn0 BAR pointed to by the Register BIR field (for EP, Switch USP) or from the start of UiRB/UiSRB region (for hosts/Switch). This field is reserved for retimers.</td> </tr> </table> ### 9.5.1.11 UCIe Link DVSEC - Sideband Mailbox Index Low (Offset is design dependent) Mailbox registers are to be implemented by all hosts with UCIe Links. Switches with downstream UCIe Links and EP/USP, when paired with UCIe Retimer, should also implement this register. Note that accesses to mailbox are inherently non-atomic in nature and hence it is up to higher-level software to coordinate access to any mailbox-related register so that one agent does not step on another agent using the mailbox mechanism. Those mechanisms for software coordination are beyond the scope of this specification. <table> <caption>Table 9-15. UCIe Link DVSEC - Sideband Mailbox Index Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="2">$4 : 0$</td> <td rowspan="2">RW</td> <td>Opcode 00000b 32b Memory Read 00001b 32b Memory Write 00100b 32b Configuration Read 00101b 32b Configuration Write 01000b 64b Memory Read 01001b 64b Memory Write 01100b 64b Configuration Read 01101b 64b Configuration Write</td> </tr> <tr> <td>OthersReserved Default 00100</td> </tr> <tr> <td>$1 2 : 5$</td> <td>RW</td> <td>$B E \left[ 7 : 0 \right]$ Default Fh</td> </tr> <tr> <td rowspan="2">$3 1 : 1 3$</td> <td rowspan="2">RW</td> <td>Addr[18:0] of Sideband Accesses Format for this field is as defined in the sideband interface definition in Chapter 7.0.</td> </tr> <tr> <td>Note: The address offset defined as part of this address field is DWORD aligned for 32bit accesses and QWORD aligned for 64bit accesses. Default is 0.</td> </tr> </table> ## 9.5.1.12 UCIe Link DVSEC - Sideband Mailbox Index High (Offset is design dependent) Mailbox registers are to be implemented by all hosts with UCIe Links. Switches with downstream UCIe Links and EP/USP, when paired with UCIe Retimer, should also implement this register. Note that accesses to mailbox are inherently non-atomic in nature and hence it is up to higher-level software to coordinate access to any mailbox-related register so that one agent does not step on another agent using the mailbox mechanism. Those mechanisms for software coordination are beyond the scope of this specification. <table> <caption>Table 9-16. UCIe Link DVSEC - Sideband Mailbox Index High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>4:0</td> <td>RW</td> <td>Addr[23:19] of Sideband Accesses Format for this field is as defined in the sideband interface definition in Chapter 7.0. Default is 0.</td> </tr> <tr> <td>31:5</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> <table> <caption>9.5.1.13 UCIe Link DVSEC - Sideband Mailbox Data Low (Offset is design dependent) Table 9-17. UCIe Link DVSEC - Sideband Mailbox Data Low</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RW</td> <td>For sideband write opcodes, this carries the write data [31:0] to the destination. For sideband read opcodes, this carries the data read from the destination when the Write/Read Trigger bit in the Mailbox Control register is cleared, after it was initially set. This field's value is undefined until the Write/Read trigger bit is cleared on reads.</td> </tr> </table> <table> <caption>9.5.1.14 UCIe Link DVSEC - Sideband Mailbox Data High (Offset is design dependent) Table 9-18. UCIe Link DVSEC - Sideband Mailbox Data High</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>31:0</td> <td>RW</td> <td>For sideband write opcodes, this carries the write data [63:32] to the destination. For sideband read opcodes, this carries the data read from the destination when the Write/Read Trigger bit in the Mailbox Control register is cleared, after it was initially set. This field's value is undefined until the Write/Read trigger bit is cleared on reads. $F o r \quad 3 2 b$ Writes/Reads, this register does not carry valid data.</td> </tr> </table> ## 9.5.1.15 UCIe Link DVSEC - Sideband Mailbox Control (Offset is design dependent) <table> <caption>Table 9-19. UCIe Link DVSEC - Sideband Mailbox Control</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW, with auto clear</td> <td>Write/Read trigger: When this bit is written to a 1 from a value of 0, the mailbox generates traffic on the sideband interface, using the contents of the Mailbox Header and Data registers. This bit automatically clears when the write or read access triggered by this bit being set, is complete on the sideband bus. SW can poll this bit to know when the write/read has actually completed at the destination. It can then go read the Mailbox data register for the read data.</td> </tr> <tr> <td>7:1</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> <table> <caption>9.5.1.16 UCIe Link DVSEC - Sideband Mailbox Status (Offset is design dependent) Table 9-20. UCIe Link DVSEC - Sideband Mailbox Status</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>1:0</td> <td>RW1C(RP/DSP), RW1C(EP/USP), when implemented</td> <td>Write/Read status 00b: CA received 01b: UR received 10b: Reserved 11b: Success This bit has valid value only when the Write/Read Trigger bit is cleared from being a 1 prior to it.</td> </tr> <tr> <td>7:2</td> <td>RsvdZ</td> <td>Reserved</td> </tr> </table> ## 9.5.1.17 UCIe Link DVSEC - Requester ID (Offset is design dependent) <table> <caption>Table 9-21. UCIe Link DVSEC - Requester ID</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>23:0</td> <td>RW(RP)/RsvdP (Others)</td> <td>Applicable only for host side UCIe Links. Segment No: Bus No: Dev No: Fn No for MSIs triggered on behalf of the associated UCIe Link Note: For MSIs issued on behalf of UCIe Links on downstream ports of switches, the Switch USP BDF is used. UCIe Link DVSEC capabilities in UiSRB implement this as RO 0.</td> </tr> <tr> <td>31:24</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.1.18 UCIe Link DVSEC - Associated Port Numbers (Offset is design dependent) These registers apply only to UCIe Link DVSEC capabilities present in UiSRB. <table> <caption>Table 9-22. UCIe Link DVSEC - Associated Port Numbers</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>7:0</td> <td>RO</td> <td>Port Number 1 - 'Port number' of the 1st switch DSP associated with this UCIe. This value is from the Link Capabilities register of that switch DSP.</td> </tr> <tr> <td>15:8</td> <td>RO</td> <td>Port Number 2 - 'Port number' of the 2nd switch DSP associated with this UCIe, if any. If there is no 2nd switch DSP associated with this UCIe Link, this field is treated as reserved and should not be included as part of the "length" field of the 'Designated Vendor specific Header 1' register and SW should not consider this as part of the DVSEC capability. Note: Only a maximum of two Port numbers can be associated with a UCIe Link in the current revision of the specification.</td> </tr> </table> ## 9.5.1.19 Examples of setting the Length field in DVSEC for various Scenarios Example#1: UCIe EP supporting 2 Register Locators and not associated with a UCIe-Retimer, would set the length field in DVSEC capability to indicate 48B. Example#2: Host UiRB supporting 3 register locators would set the length to indicate 84B. Example#3: Switch UiSRB supporting 3 register locators and associated with just 1 DSP port to a UCIe Link, would set the length to indicate 85B. ## 9.5.2 UCIe Switch Register Block (UiSRB) DVSEC Capability This capability can only be present in the config space of the upstream port of a Switch. There can be multiple of these in the same USP config space. ### 9.5.2.1 PCI Express Extended Capability Header (Offset 0h) Set as follows for UCIe Switch Register Block DVSEC. All bits in this register are RO. <table> <caption>Table 9-23. UiSRB DVSEC - PCI Express Extended Capability Header</caption> <tr> <th>Field</th> <th>Bit Location</th> <th>Value</th> <th>Comments</th> </tr> <tr> <td>Capability ID</td> <td>15:0</td> <td>0023h</td> <td>Value for PCI Express DVSEC capability</td> </tr> <tr> <td>Revision ID</td> <td>19:16</td> <td>1h</td> <td>Latest revision of the DVSEC capability</td> </tr> <tr> <td>Next Capability Offset</td> <td>31:20</td> <td>Design Dependent</td> <td></td> </tr> </table> ### 9.5.2.2 Designated Vendor Specific Header 1, 2 (Offsets 4h and 8h) A few things to note on the various fields described in Table 9-6. DVSEC Revision ID field represents the version of the DVSEC structure. The DVSEC Revision ID is incremented whenever the structure is extended to add more functionality. Backward compatibility shall be maintained during this process. For all values of n, DVSEC Revision ID n+1 structure may extend Revision ID n by replacing fields that are marked as reserved in Revision ID n, but must not redefine the meaning of existing fields. Software that was written for a lower Revision ID may continue to operate on UCIe DVSEC structures with a higher Revision ID, but will not be able to take advantage of new functionality. All bits in this register are RO. <table> <caption>Table 9-24. UiSRB DVSEC - Designated Vendor Specific Header 1, 2</caption> <tr> <th>Register</th> <th>Field</th> <th>Bit Location</th> <th>Value</th> </tr> <tr> <td rowspan="3">Designated Vendor-Specific Header 1 (offset 04h)</td> <td>DVSEC Vendor ID</td> <td>15:0</td> <td>D2DEh</td> </tr> <tr> <td>DVSEC Revision</td> <td>19:16</td> <td>0h</td> </tr> <tr> <td>Length</td> <td>31:20</td> <td>14h</td> </tr> <tr> <td>Designated Vendor-Specific Header 2 (offset 08h)</td> <td>DVSEC ID</td> <td>$1 5 : 0$</td> <td>1h</td> </tr> </table> ## 9.5.2.3 UCIe Switch Register Block (UiSRB) Base Address (Offset Ch) All bits in this register are RO. <table> <caption>Table 9-25. UiSRB DVSEC - UiSRB Base Address</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RO</td> <td>Register BIR Indicates which one of a Switch USP Function's Base Address Registers, located beginning at 10h in Configuration Space, or entry in the Enhanced Allocation capability with a matching BAR Equivalent Indicator (BEI), is used to locate the UCIe Switch Register Block. Defined encodings are: · 0 Base Address Register 10h · 1 Base Address Register 14h · All other Reserved. The Registers block must be wholly contained within the specified BAR. For a 64-bit Base Address Register, the Register BIR indicates the lower DWORD.</td> </tr> <tr> <td>11:1</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td rowspan="2">$6 3 : 1 2$</td> <td rowspan="2">$R O$</td> <td>Register Block Offset A 4-KB-aligned offset from the starting address of the Switch USP BAR indicated by the Register BIR field.</td> </tr> <tr> <td>The BAR value + Offset indicated in this register is where the UCIe Switch Register Block (UiSRB) starts. Ex: If this register is 100, UiSRB starts at the &lt;64-bit BAR value + 100000h&gt;</td> </tr> </table> ## 9.5.3 D2D/PHY Register Block These registers occupy 8 KB of register space. The first 4 KB are for the D2D Adapter, and the next 4 KB are for the Physical Layer. In the PHY register block, extended capabilities start at Offset 200h. If an implementation does not support any extended capabilities, it must implement a NULL capability at Offset 200h (which implements 0h for the DWORD at that offset). The D2D Adapter registers are enumerated below. The location of these registers in the system MMIO region is as described in Section 9.3. ## 9.5.3.1 UCIe Register Block Header <table> <caption>Table 9-26. D2D/PHY Register Block - UCIe Register Block Header (Offset 0h)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>15:0</td> <td>RO</td> <td>Vendor ID Default is set to Vendor ID assigned for UCIe Consortium - D2DEh</td> </tr> <tr> <td>$3 1 : 1 6$</td> <td>RO</td> <td>Vendor ID Register Block Set to 0h to indicate D2D/PHY register block</td> </tr> <tr> <td>$3 5 : 3 2$</td> <td>RO</td> <td>Vendor Register Block Version Set to 0h</td> </tr> <tr> <td>63:36</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td>95:64</td> <td>RO</td> <td>Vendor Register Block Length - The number of bytes in the register block including the UCIe Register block header. Default is 2000h.</td> </tr> <tr> <td>127:96</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.2 Uncorrectable Error Status Register (Offset 10h) <table> <caption>Table 9-27. Uncorrectable Error Status Register (Sheet 1 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW1CS</td> <td>Adapter Timeout: Set to 1b by hardware if greater than 8ms has $H e a d e r \quad L o g \quad 2 \quad r e g i s t e r \quad c a p t u r e s \quad t h e \quad r e a s o n \quad f o r \quad a \quad t i m e o u t . T h i s \quad e r r o r$ Default Value is 0b.</td> </tr> <tr> <td>1</td> <td>RW1CS</td> <td>Receiver Overflow: Set to 1b by hardware if Receiver overflow errors are detected. The Header Log 2 register captures the encoding to indicate the type of Receiver overflow. This error will bring the Link Down. Default Value is 0b.</td> </tr> <tr> <td>2</td> <td>RW1CS</td> <td>Internal Error: Set to 1b by hardware if an internal Data path error is detected or if LinkError state was detected on the RDI. Examples of such errors include (but not limited to) uncorrectable error correcting code (ECC) error in the Retry buffer, sideband parity errors etc. This error will bring the Link Down. It includes fatal error indicated by the Physical Layer that brought the Link Down. Default Value is 0b.</td> </tr> <tr> <td>3</td> <td>RW1CS (RP/DSP/ { \left. \text { Ketmer } \right) }<br>{ \text { Rsvdz \left(Others\right) } }</td> <td>Sideband Fatal Error Message received: Set to 1b by hardware if the Adapter received a Fatal {ErrMsg} sideband message. Default Value is 0b.</td> </tr> </table> <table> <caption>Table 9-27. Uncorrectable Error Status Register (Sheet 2 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>4</td> <td>RW1CS(RP/DSP/ \left. \mathrm { R e t i m e r } \right) _ { \prime }<br>\mathrm { R s v d } Z \left( \mathrm { O t h e r s } \right)</td> <td>Sideband Non-Fatal Error Message received: Set to 1b by hardware if the Adapter received a Non-Fatal {ErrMsg} sideband message. Default Value is 0b.</td> </tr> <tr> <td>5</td> <td>RW1CS</td> <td>Invalid Parameter Exchange: Set to 1b if the Adapter was not able to determine a valid protocol or Flit Format for operation.</td> </tr> <tr> <td>31:6</td> <td>RsvdZ</td> <td>Reserved</td> </tr> </table> ## 9.5.3.3 Uncorrectable Error Mask Register (Offset 14h) The Uncorrectable Error Mask Register controls reporting of individual errors. When a bit is 1b in this register, the corresponding error status bit in the Uncorrectable Error Status register is not forwarded to the Protocol Layer for escalation/signaling but it does not impact error logging in the "First Fatal Error Indicator" field in the Header Log 2 register. <table> <caption>Table 9-28. Uncorrectable Error Mask Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RWS</td> <td>Adapter Timeout Mask Default Value is 1b.</td> </tr> <tr> <td>1</td> <td>RWS</td> <td>Receiver Overflow Mask Default Value is 1b.</td> </tr> <tr> <td>2</td> <td>RWS</td> <td>Internal Error Mask Default Value is 1b.</td> </tr> <tr> <td>3</td> <td>RWS</td> <td>Fatal Error Message received Mask $D e f a u l t \quad V a l u e \quad i s \quad 1 b .$</td> </tr> <tr> <td>4</td> <td>RWS</td> <td>Non-Fatal Error Message received Mask $D e f a u l t \quad V a l u e \quad i s \quad 1 b .$</td> </tr> <tr> <td>5</td> <td>RWS</td> <td>Invalid Parameter Exchange Mask Default Value is 1b.</td> </tr> <tr> <td>31:6</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.4 Uncorrectable Error Severity Register (Offset 18h) The Uncorrectable Error Severity register controls whether an individual error is reported as a Non- fatal or Fatal error. An error is reported as a fatal uncorrectable error when the corresponding bit in the severity register is 1b. If the bit is 0b, the corresponding error is reported as a non-fatal uncorrectable error. <table> <caption>Table 9-29. Uncorrectable Error Severity Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RWS</td> <td>Adapter Timeout Severity Default Value is 1b.</td> </tr> <tr> <td>1</td> <td>RWS</td> <td>Receiver Overflow Severity Default Value is 1b.</td> </tr> <tr> <td>2</td> <td>RWS</td> <td>Internal Error Severity Default Value is 1b.</td> </tr> <tr> <td>3</td> <td>RWS</td> <td>Sideband Fatal Error Message received Severity Default Value is 1b.</td> </tr> <tr> <td>4</td> <td>RWS</td> <td>Sideband Non-Fatal Error Message received Severity Default Value is 0b.</td> </tr> <tr> <td>5</td> <td>RWS</td> <td>Invalid Parameter Exchange Severity Default Value is 1b</td> </tr> <tr> <td>31:6</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ### 9.5.3.5 Correctable Error Status Register (Offset 1Ch) <table> <caption>Table 9-30. Correctable Error Status Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW1CS</td> <td>CRC Error Detected: Set to 1b by hardware if the Adapter detected a CRC Error when Adapter Retry was negotiated with remote Link partner. Default Value is 0b.</td> </tr> <tr> <td>1</td> <td>RW1CS</td> <td>Adapter LSM transition to Retrain: Set to 1b by hardware if the Adapter LSM transitioned to Retrain state. Default Value is 0b.</td> </tr> <tr> <td>2</td> <td>RW1CS</td> <td>Correctable Internal Error: Set to 1b by hardware if an internal correctable Data path error is detected. Examples of such errors include (but are not limited to) correctable error correcting code (ECC) error in the Retry buffer, Physical Layer indicated correctable error on RDI, etc. Default Value is 0b.</td> </tr> <tr> <td>3</td> <td>RW1CS (RP/DSP/ { \left. \text { Retimer } \right) }<br>{ \text { Revdz \left(Others\right) } }</td> <td>Set to 1b by { \text { Sideband Correctable Error iersed a Correctable \left\{Errime sideband } }<br>{ \text { hardware if the Adapter received a Corred in the message information. } }<br>{ \text { messaqe with Device origin encoding the message information. } } Default Value is 0b.</td> </tr> <tr> <td>4</td> <td>RW1CS</td> <td>`Runtime Link Testing Parity' Error</td> </tr> <tr> <td>31:5</td> <td>RsvdZ</td> <td>Reserved</td> </tr> </table> ### 9.5.3.6 Correctable Error Mask Register (Offset 20h) The Correctable Error Mask Register controls the reporting of individual errors. When a bit is 1b in this register, setting of the corresponding error status bit is not forwarded to the Protocol Layer for escalation/signaling. <table> <caption>Table 9-31. Correctable Error Mask Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RWS</td> <td>CRC Error Detected Mask Default Value is 1b.</td> </tr> <tr> <td>1</td> <td>RWS</td> <td>Adapter LSM transition to Retrain Mask Default Value is 1b.</td> </tr> <tr> <td>2</td> <td>RWS</td> <td>Correctable Internal Error Mask Default Value is 1b.</td> </tr> <tr> <td>3</td> <td>RWS</td> <td>Device Correctable Error Message received Mask Default Value is 1b.</td> </tr> <tr> <td>4</td> <td>RWS</td> <td>`Runtime Link Testing Parity' Error Mask Default Value is 1b.</td> </tr> <tr> <td>31:5</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.7 Header Log 1 Register (Offset 24h) This register is used to log the header on sideband register accesses that receive UR/CA error status. <table> <caption>Table 9-32. Header Log 1 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="3">$6 3 : 0$</td> <td rowspan="3">ROS</td> <td>Header Log 1: This logs the header for the sideband mailbox register access that received a completion with Completer Abort status or received a completion with Unsupported Request status. Note that register accesses that time out are not required to be</td> </tr> <tr> <td>{ \text { Iogged at the requester. } }<br>{ \text { If the Write/Read Status field in the the band Mailbox status } ^ { \prime } } register indicates 'Success' or the Write/Read Sideband Mailbox Control register is set to 1, this field's value is undefined.</td> </tr> <tr> <td>{ \text { This register is rearmed for logging newrors every time the } }<br>{ \text { Write/Read Trigger bit in the Maibox Control register sees a O-to- } } transition. Default Value is 0.</td> </tr> </table> ## 9.5.3.8 Header Log 2 Register (Offset 2Ch) This register is used to log syndrome of various sideband and mainband errors and specific status logging on link training. <table> <caption>Table 9-33. Header Log 2 Register (Sheet 1 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>3:0</td> <td>ROS</td> <td>Adapter Timeout encoding: Captures the reason for the first Adapter Timeout that was logged in Uncorrectable Error Status. Default Value is 0000b. The encodings are interpreted as follows: 0001b: Parameter Exchange flow timed out $0 0 1 0 b : A d a p t e r \quad L S M \quad r e q u e s t \quad t o \quad r e m o t e \quad L i n k \quad p a r t n e r \quad d i d \quad n o t \quad r e c e i v e$ that did not receive a response. Bit 10 of this register captures which Adapter LSM timed out. 0011b: Adapter LSM transition to Active timeout. This is recorded in case the Adapter never received Active Request from remote Link partner for 8 ms after sending an Active Request on sideband even though it received an Active Response. Bit 10 of this register captures which Adapter LSM timed out. 0100b: Retry Timeout - no Ack or Nak { \text { Retry was enabled. Timeout counter is only incrented wher RDI } }<br>{ \text { is in Active and Adapter } s \text { Retry buffer is not empty. } } 0101b: Local sideband access timeout { \text { O110b: Retimer credit return timeout- no Retimer credit received } }<br>{ \text { for greater than } 8 \text { ms if one or more Retimer credits have been } } consumed by the Adapter. This timer is only counting during Active this timer must be Reset since the { \text { state. If RDI moves to Retrain } }<br>{ \text { Retimer credits are also Reset .$ $\text { O111b: Remote Register Access timeout. This is triggered when if } }<br>{ \text { the Adapter has observed Ntimeout for Register Accesses where } }<br>{ \text { is } > = \text { register access timeout threshold. } } other encodings are reserved. If the Adapter Timeout status bit is cleared in the 'Uncorrectable Error Status' register, this field's value is undefined.</td> </tr> <tr> <td>6:4</td> <td>ROS</td> <td>Receiver Overflow encoding: Captures the encoding for the first Receiver overflow error that occurred. interpreted as follows: $0 0 1 b : T r a n s m i t t e r \quad R e t r y \quad B u f f e r \quad o v e r f l o w$ 010b: Retimer Receiver Buffer overflow overflow $1 0 0 b : R D I \quad s i d e b a n d \quad b u f f e r \quad o v e r f l o w$ other encodings are reserved. If the Receiver overflow status bit is cleared in the 'Uncorrectable Error Status' register, this field's value is undefined.</td> </tr> <tr> <td>9:7</td> <td>$R O S$</td> <td>Adapter LSM response type 001b: Active 100b: LinkReset $0 1 0 b : L 1$ { \text { 101b: Disable } }<br>{ \text { Other encodings are reserved } } If the Adapter Timeout status bit is cleared in the 'Uncorrectable Error Status' register, this field's value is undefined.</td> </tr> <tr> <td>10</td> <td>$R O S$</td> <td>Adapter LSM id $1 b : A d a p t e r \quad L S M \quad 1 \quad t i m e d \quad o u t$</td> </tr> <tr> <td>$1 2 : 1 1$</td> <td>RsvdZ</td> <td></td> </tr> <tr> <td>13</td> <td>$R O$</td> <td>Parameter Successful: Hardware updates this bit to { \text { 1b after successfulp } }<br>{ \text { on every link traininc } } Parameter exchange with remote Link partner,</td> </tr> </table> <table> <caption>Table 9-33. Header Log 2 Register (Sheet 2 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="5">$1 7 : 1 4$</td> <td rowspan="5">ROS</td> <td>Flit Format: This field logs the negotiated Flit Format, it is the current snapshot of the format the Adapter is informing to the Protocol Layer. See Chapter 3.0 for the definitions of these formats. The encodings are:</td> </tr> <tr> <td>0001b - Format 1 0101b - Format 5</td> </tr> <tr> <td>0010b - Format 2 0110b - Format 6</td> </tr> <tr> <td>$0 0 1 1 b \quad - \quad F o r m a t$ 3 Other encodings are Reserved</td> </tr> <tr> <td>0100b - Format 4</td> </tr> <tr> <td rowspan="4">$2 2 : 1 8$</td> <td rowspan="4">$R O S$</td> <td>bit { \text { First Fatal Error Indicator: } 5 \text { -bit encoding that indicat whe value of } }<br>{ \text { of Uncorrectable Error Stratus errors warrs waged first } \text { first vatue value of } }<br>{ \text { this field has no meaning if thresporonding status bit is cleare } } The encoding of this field is as follows: { \text { OOh if the error corresponding to Uncorrectable Error Status } }<br>{ \text { reaister } 0 1 \text { is the first fatal error. } }</td> </tr> <tr> <td>{ \text { O1h if the error corresponding to Uncorrectable Error Status } }<br>{ \text { reaister } 1 1 \text { is the first fatal error } }</td> </tr> <tr> <td>... Because reserved bits may be repurposed in future versions of the \text { specitication, sortiware mignte obserive that the the the points to a }<br>\text { reserved bit } \text { \left(from its perspective\right) in the Uncorrectable Etrors tatus }<br>\text { register. This can happen when older version of softuware is ritware is } on newer hardware. Software must be aware that it still needs to { \text { clear the Status register bit it destres to allow for continued error } }<br>{ \text { logging. How swhar har error status bits it oot not underand is } } Once set, the value of this field does not change until SW clears the corresponding Uncorrectable Status register bit. When SW { \text { clears the corres } }<br>{ \text { subseauent first } } $\log ,$ HW is rearmed to capture fatal</td> </tr> <tr> <td>Note that because of an inherent race condition between HW setting a new status bit and SW clearing an older status bit, SW must be aware that this field might not always indicate the first error amongst all the errors logged in the Uncorrectable Error Status register. For example, if the Uncorrectable Error Status bit 0 was set first by HW and in the time SW reads the status and cleared it, bit 1 { \text { corresponding to bit } 0 \text { recurs, it will be captured as the next first } }<br>{ \text { error even though the errorcorresponding to bit } 1 \text { occurred ear earlit } } If multiple errors are encountered simultaneously, which error is logged as the First Fatal Error is implementation-dependent.</td> </tr> <tr> <td>31:23</td> <td>RsvdZ</td> <td>Reserved</td> </tr> </table> ## 9.5.3.9 Error and Link Testing Control Register (0ffset 30h) <table> <caption>Table 9-34. Error and Link Testing Control Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>3:0</td> <td>RW</td> <td>Remote Register Access Threshold: Indicates the number of consecutive timeouts for remote register accesses that must occur before the Register Access timeout is logged and the error escalated to a Link_Status=Down condition. Default Value is 0100b.</td> </tr> <tr> <td>4</td> <td>RW</td> <td>Runtime Link Testing Tx Enable: Software writes to this bit to enable Parity byte injections in the data stream as described in Section 3.9. Runtime Link Rx Enable must be set to 1b for remote Link Partner for successful enabling of this mode. Default Value is 0b.</td> </tr> <tr> <td>5</td> <td>RW</td> <td>Runtime Link Testing Rx Enable: Software writes to this bit to enable Parity byte checking in the data stream as described in Section 3.9. Runtime Link Tx Enable must be set to 1b for remote Link Partner for successful enabling of this mode. Default Value is 0b.</td> </tr> <tr> <td>8:6</td> <td>RW</td> <td>Number of 64 Byte Inserts: Software writes to this to indicate the number 64 Byte inserts are done at a time for Runtime Link Testing. The encodings are: 000b: one 64B insert (for debug purposes only) $0 0 1 b : t w o \quad 6 4 B \quad i n s e r t s \left( f o r \quad d e b u g \quad p u r p o s e s \quad o n l y \right)$ Other encodings are reserved. Default value is 000b. See Section 3.9 for guidance on how Software should set this field.</td> </tr> <tr> <td>9</td> <td>RW1C</td> <td>Parity Feature Nak received: Hardware updates this bit if it receives a Nak from remote Link partner when attempting to enable Runtime Link Testing.</td> </tr> <tr> <td>$1 2 : 1 0$</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td>$1 4 : 1 3$</td> <td>RW</td> <td>CRC Injection Enable: Software writes to this bit to trigger CRC error injections, The error is injected by inverting 1, 2 or 3 bits in the CRC bytes. The specific bits inverted are implementation specific. The CRC injection must not happen for Flits that are already inverting CRC bits for Viral handling. The encodings are interpreted as: { \text { OOb: CRC Injection is Disabled } }<br>{ 0 1 b : 1 \text { bit is inverted .$ 10b: 2 bits are inverted 11b: 3 bits are inverted. Default Value is 00b.</td> </tr> <tr> <td>$1 6 : 1 5$</td> <td>RW</td> <td>CRC Injection Count: Software writes to this bit to program the number of CRC injections. It only takes effect if CRC injection Enable is not Disabled. 00b: Single Flit is corrupted. CRC Injection Busy is reset to 0b after single Flit corruption. $\text { O1b: A CRC error is injected every } 8 \text { Flits. Hardware continues to inject a CRC } }<br>{ \text { error every 8 Flits until CRC Injection Enable is OOb. CRC Injection Busy is } } reset to Ob only after CRC Injection Enable is 00b. { 1 0 b : A \text { CRC error is injected every } 1 6 \text { Filte } }<br>{ \text { CRC error every } 1 6 \text { Flits until CRC Injection Enable is OOb. } }<br>{ \text { is reset to 0b only after CRC Injection Enable is OOb } } $1 1 b : A \quad C R C \quad e r r o r \quad i s \quad i n j e c t e d \quad e v e r y \quad 6 4 \quad F l i t s . H a r d w a r e \quad c o n t i n u e s \quad t o \quad i n j e c t \quad a$ CRC error every 64 Flits until CRC Injection Enable is 00b. CRC Injection Busy is reset to Ob only after CRC Injection Enable is 00b.</td> </tr> <tr> <td>17</td> <td>$R O$</td> <td>CRC Injection Busy: Hardware loads a 1b to this bit once it has begun CRC Injection. Software is permitted to poll on this bit. See CRC Injection Count description to see how this bit returns to 0b.</td> </tr> <tr> <td>$3 1 : 1 8$</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.10 Runtime Link Testing Parity Log 0 (Offset 34h) <table> <caption>Table 9-35. Runtime Link Testing Parity Log 0 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Parity Log for UCIe-S or (UCIe-A Module 0): Hardware updates the bit corresponding to the parity error byte with error over the period when Runtime Link Testing was enabled at the Rx. The Adapter sets the bit corresponding to the RDI byte number with an error modulo the number of Lanes in the Link as indicated by pl_Ink_cfg. For example, if RDI Byte 18 has an error of a x16 Link, bit [2] of this register would be set to 1. Because UCIe-S configurations cannot exceed a maximum of 64 Lanes, this register is used for all configurations of UCIe-S. For UCIe-A, the Adapter sets the corresponding bit if the result of the modulo operation was less than 64. Default Value is 0.</td> </tr> </table> ## 9.5.3.11 Runtime Link Testing Parity Log 1 (Offset 3Ch) <table> <caption>Table 9-36. Runtime Link Testing Parity Log 1 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Parity Log for UCIe-A Module 1: Hardware updates the bit corresponding to the parity error byte with error over the period when Runtime Link Testing was enabled at the Rx. Default Value is 0. This is register is only applicable if the Adapter is designed for handling two or more Physical Layer modules for UCIe-A. It is reserved otherwise. The Adapter sets the bit corresponding to the RDI byte number with an error modulo the number of Lanes in the Link as indicated by pl_lnk_cfg, if the result of the modulo operation is greater than 63 but less than 128.</td> </tr> </table> ## 9.5.3.12 Runtime Link Testing Parity Log 2 (Offset 44h) <table> <caption>Table 9-37. Runtime Link Testing Parity Log 2 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Parity Log for UCIe-A Module 2: Hardware updates the bit corresponding to the parity error byte with error over the period when Runtime Link Testing was enabled at the Rx. Default Value is 0. This is register is only applicable if the Adapter is designed for handling four Physical Layer modules for UCIe-A. It is reserved otherwise. The Adapter sets the bit corresponding to the RDI byte number with an error modulo the number of Lanes in the Link as indicated by pl_Ink_cfg, if the result of the modulo operation is greater than 127 but less than 192.</td> </tr> </table> ## 9.5.3.13 Runtime Link Testing Parity Log 3 (Offset 4Ch) <table> <caption>Table 9-38. Runtime Link Testing Parity Log 3 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Parity Log for UCIe-A Module 3: Hardware updates the bit corresponding to the parity error byte with error over the period when Runtime Link Testing was enabled at the Rx. Default Value is 0. This is register is only applicable if the Adapter is designed for handling four Physical Layer modules for UCIe-A. It is reserved otherwise. The Adapter sets the bit corresponding to the RDI byte number with an error modulo the number of Lanes in the Link as indicated by pl_Ink_cfg, if the result of the modulo operation is greater than 191 but less than 256.</td> </tr> </table> ## 9.5.3.14 Advertised Adapter Capability Log (Offset 54h) <table> <caption>Table 9-39. Advertised Adapter Capability Log Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Advertised Adapter Capability: Hardware updates the bits corresponding to the data bits it sent in the {AdvCap.Adapter} sideband message. Default Value is 0.</td> </tr> </table> ## 9.5.3.15 Finalized Adapter Capability Log (Offset 5Ch) <table> <caption>Table 9-40. Finalized Adapter Capability Log Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Finalized Adapter Capability: Hardware updates the bits corresponding to the data bits it sent (DP) or received (UP) in the {FinCap.Adapter} sideband message. Default Value is 0.</td> </tr> </table> ## 9.5.3.16 Advertised CXL Capability Log (Offset 64h) <table> <caption>Table 9-41. Advertised CXL Capability Log Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Advertised CXL Capability: Hardware updates the bits corresponding to the data bits it sent in the {AdvCap.CXL} sideband message, when it is sent with MsgInfo=0000h. Default Value is 0.</td> </tr> </table> ## 9.5.3.17 Finalized CXL Capability Log (Offset 6Ch) <table> <caption>Table 9-42. Finalized CXL Capability Log Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Finalized CXL Capability: Hardware updates the bits corresponding to the data bits it sent (DP) or received (UP) in the {FinCap.CXL} sideband message, when it is sent with MsgInfo=0000h. Default Value is 0.</td> </tr> </table> ## 9.5.3.18 Advertised Multi-Protocol Capability Log Register (Offset 78h) This register is reserved for designs that do not implement the Enhanced Multi-protocol capability. <table> <caption>Table 9-43. Advertised Multi-Protocol Capability Log Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Advertised Multi-Protocol Capability: Hardware updates the bits corresponding to the data bits it sent in the { MultiProtAdvCap.Adapter} sideband message. Default value is 0.</td> </tr> </table> ## 9.5.3.19 Finalized Multi-Protocol Capability Log Register (Offset 80h) This register is reserved for designs that do not implement the Enhanced Multi-protocol capability. <table> <caption>Table 9-44. Finalized Multi-Protocol Capability Log Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Finalized Multi-Protocol Capability: Hardware updates the bits corresponding to the data bits it sent in the { MultiProtFinCap.Adapter} sideband message. Default value is 0.</td> </tr> </table> ## 9.5.3.20 Advertised CXL Capability Log Register for Stack 1 (Offset 88h) This register is reserved for designs that do not implement the Enhanced Multi-protocol capability. <table> <caption>Table 9-45. Advertised CXL Capability Log Register for Stack 1</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Advertised CXL Capability: Hardware updates the bits corresponding to the data bits it sent in the {AdvCap.CXL} sideband message when it is sent with MsgInfo=0001h. Default value is 0.</td> </tr> </table> ## 9.5.3.21 Finalized CXL Capability Log Register for Stack 1 (Offset 90h) This register is reserved for designs not implementing the Enhanced multi-protocol capability. <table> <caption>Table 9-46. Finalized CXL Capability Log Register for Stack 1</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW1C</td> <td>Finalized CXL Capability: Hardware updates the bits corresponding to the data bits it sent in the {FinCap.CXL} sideband message when it is sent with MsgInfo=0001h. Default value is 0.</td> </tr> </table> ## 9.5.3.22 PHY Capability (Offset 1000h) This register is global, and not per module. <table> <caption>Table 9-47. Physical Layer Capability Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$2 : 0$</td> <td>$R O$</td> <td>Reserved</td> </tr> <tr> <td>3</td> <td>$R O$</td> <td>Terminated Link If set to 1, the Receiver supports termination. See Section 5.4.2 for additional information and the termination requirements for different maximum supported data rate and channel length combinations.</td> </tr> <tr> <td>4</td> <td>$R O$</td> <td>TX Equalization support 0: TXEQ not supported 1: TXEQ supported</td> </tr> <tr> <td>$9 : 5$</td> <td>RO</td> <td>Supported Tx Vswing encodings 01h: 0.4 V 07h: 0.7 V 0Dh: 1.0 V 02h: 0.45 V 08h: 0.75 V 0Eh: 1.05 V $0 3 h : 0 . 5 \quad V$ 09h: 0.8 V 0Fh: 1.1 V 0.55 V $O A h : 0 . 8 5 \quad V$ 10h: 1.15 V $0 5 h : 0 . 6 \quad V$ 06h: 0.65 V $0 C h : 0 . 9 5 \quad V$ All other encodings are reserved. This field matches the value advertised by the UCIe Module in the 'Voltage swing' field during MBINIT.PARAM.</td> </tr> <tr> <td>10</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td>$1 2 : 1 1$</td> <td>$R O$</td> <td>Rx Clock Mode Support for &lt;= 32 GT/s { \text { 00b: Supports both free running and strobe modes } }<br>{ 1 0 b : \text { Free running mode only } } All other encodings are reserved. This reflects the local UCIe Module's capability when the operating speed is $< = 3 2$ GT/s (including the situation where &gt; 32 GT/s was negotiated but the Link went { \text { through a speed degrade and is operating } }<br>{ \text { Rx Clock Phase Support for } < = 3 2 \text { GT/ } } at a speed &lt;= 32 GT/s).</td> </tr> <tr> <td>14:13</td> <td>$R O$</td> <td>00b: Differential clock only (all data rates) 01b: { \text { Quadrature clock } \left( 2 4 / 3 2 \text { GT/s\right) } \right. }<br>{ \text { Differential clock } \left( 1 6 G T / s \text { and lower\right) } \right. } 10b: Same as 01b (for backward compatibility) This reflects the local UCIe Module's capability when the operating speed is &lt;= 32 GT/s (including the situation where &gt; 32 GT/s was negotiated but the Link went through a speed degrade and is operating at a speed &lt;= 32 GT/s).</td> </tr> <tr> <td>15</td> <td>$R O$</td> <td>Package type 0b: Advanced Package 1b: Standard Package</td> </tr> <tr> <td>16</td> <td>$R O$</td> <td>Tightly coupled mode (TCM) support 0b: TCM not supported 1b: TCM supported This corresponds to the local UCIe Module's capability.</td> </tr> <tr> <td>17</td> <td>RO</td> <td>Tx Adjustment for Runtime Recalibration (TARR) { \text { O: TARR is not supportea } }<br>{ 1 : \text { TARR is supported \left(see Section 4.6 for details\right) } }</td> </tr> <tr> <td>$3 1 : 1 8$</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.23 PHY Control (Offset 1004h) This register is global, and not per module. <table> <caption>Table 9-48. Physical Layer Control Register (Sheet 1 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$2 : 0$</td> <td>$R W / R O$</td> <td>Reserved. Implementations are encouraged to implement this as an RO bit with a default value of 000b. However, for backward compatibility, implementations are permitted to implement this as an RW bit with a default value of 000b.</td> </tr> <tr> <td>3</td> <td>RW</td> <td>$R x \quad T e r m i n a t e d \quad C o n t r o l$ 0: Rx Termination disabled 1: Rx Termination enabled Default is same as 'Terminated Link' bit in PHY capability register. { \text { Note that this bit is always cle } }<br>{ \text { rate supported is } < = 3 2 \text { GT/s } } to 0 for Advanced Packages if the maximum data This control is provided for debug purposes only.</td> </tr> <tr> <td>4</td> <td>$R W$</td> <td>Tx Eq Enable 0: Eq Disabled { 1 : \text { Eq Enabled } }<br>{ \text { Default is } 0 } Note that this field only affects hardware behavior while the operating data rate is &lt;= 32 GT/s. When the operating data rate is &gt; 32 GT/s, Tx equalization will be enabled regardless of the setting of this bit.</td> </tr> <tr> <td>5</td> <td>RW</td> <td>Rx Clock Mode Select 0: Strobe Mode 1: Free running mode Default is 0 if the Rx of the local UCIe Module supports Strobe Mode; otherwise, the bit is set to 1. This control is provided for debug purposes only. This bit is sent as the 'Clock Mode' bit in the {MBINIT.PARAM configuration req} sideband message. Note that this field only affects hardware behavior while the operating data rate is &lt;= 32 GT/s. When the operating data rate is &gt; 32 GT/s, the Rx Clock will use free running mode regardless of the setting of this bit.</td> </tr> <tr> <td>6</td> <td>RW</td> <td>Rx Clock phase support select 0: Differential clock only (all data rates &lt;= 32 GT/s) { \text { 1: Quadrature clock } \left( 2 4 / 3 2 \text { GT/s\right) } \right. }<br>{ \text { Differential clock } \left( 1 6 G T / s \text { and lower\right) } \right. } $T h i s \quad c o n t r o l \quad i s \quad p r o v i d e d \quad f o r \quad d e b u g \quad p u r p o s e s \quad o n l y . T h i s \quad b i t \quad i s \quad s e n t \quad a s \quad t h e C l o c k \quad P h a s e$ Note that this field only affects hardware behavior while the operating data rate is &lt;= 32 GT/s. When the operating data rate is &gt; 32 GT/s, the Rx Clock will use the Quadrature clock regardless of the setting of this bit.</td> </tr> <tr> <td>7</td> <td>$R W / R s v d P$</td> <td>Force x32 Width Mode in x64 Module \text { This bit is used only for }<br>\text { should be reset to } 0 . test and debug purposes. In normal operation, this bit When set, this bit will force the x64 module to present "UCIe-A x32 bit =1" during the MBINIT.PARAM exchange phase independent of the value of bit 20, APMW, in the $T h i s \quad b i t \quad a p p l i e s \quad t o \quad a l l \quad m o d u l e s \quad i n \quad a \quad m u l t i - m o d u l e \quad l i n k .$ For x32 Advanced Package modules, this bit is reserved.</td> </tr> <tr> <td>8</td> <td>RW/RsvdP</td> <td>Force x8 Width Mode in a UCIe-S x16 Module This bit is used only for test and debug purposes. In normal operation, this bit should be reset to 0. When set, this bit will force the x16 module to present "UCIe-S x8" bit =1 during the MBINIT.PARAM exchange phase independent of the value of bit 22, SPMW, in the UCIe Link Capability register. This feature can be used only when there is no lane reversal on the UCIe-S x16 link. This bit applies only to Module 0 in a multi-module link. When set in a multi-module link, it trains only Module 0. For a x8 Standard Package Module, this bit is reserved.</td> </tr> </table> <table> <caption>Table 9-48. Physical Layer Control Register (Sheet 2 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>9</td> <td>RW</td> <td>$F o r c e \quad I / Q \quad C o r r e c t i o n \quad E n a b l e$ 0: Software override is disabled 1: Software override is enabled This bit is used only for compliance and debug purposes, and is provided to permit software to force I/Q correction during MBTRAIN.RXCLKCAL when the operating speed is &gt; 32 GT/s. When not in a compliance mode, software must trigger Link Retrain or Link Initialization for "Force I/Q Correction" to take effect. It is also permitted to use this bit in @PHY-Compliance mode. Note that this field only affects hardware behavior while the operating data rate is &gt; 32 GT/s. When the operating data rate is &lt;= 32 GT/s, I/Q correction is not supported.</td> </tr> <tr> <td>$1 5 : 1 0$</td> <td>RW</td> <td>Force I/Q Correction Parameter Corresponds to bits [5:0] in the Message Info field of the {MBTRAIN.RXCLKCAL TCKN_L shift req} sideband message (see Table 7-9). If "Force I/Q Correction Enable" is set to 1, hardware only sends the value from "Force I/Q Correction Parameter" (this field) in the {MBTRAIN.RXCLKCAL TCKN_L shift req} sideband message. It is permitted to use this field in @PHY-Compliance mode. Note that this field only affects hardware behavior while the operating data rate is &gt; 32 GT/s. When the operating data rate is &lt;= 32 GT/s, I/Q correction is not supported.</td> </tr> <tr> <td>16</td> <td>RW</td> <td>Force Tx EQ Preset 0: Software override is disabled 1: Software override is enabled This bit permits software to force an EQ preset value during MBTRAIN.RXDESKEW. When not in a compliance mode, software must trigger Link Retrain or Link Initialization for this bit to take effect. It is also permitted to use this bit in @PHY-Compliance mode. Note that this field only affects hardware behavior while the operating data rate is &gt; 32 GT/s. When the operating data rate is &lt;= 32 GT/s, the forcing of Tx EQ Preset is not supported.</td> </tr> <tr> <td>$2 0 : 1 7$</td> <td>RW</td> <td>Force Tx EQ Preset Setting Corresponds to bits [4:0] in the Message Info field of the {MBTRAIN.RXDESKEW EQ Preset req} sideband message (see Table 7-9). If "Force TX EQ Preset" is set to 1, hardware only sends the value from "Force Tx EQ Preset Setting" (this field) in the {MBTRAIN.RXDESKEW EQ Preset req} sideband message. It is permitted to use this field in @PHY-Compliance mode. Note that this field only affects hardware behavior while the operating data rate is &gt; 32 GT/s. When the operating data rate is &lt;= 32 GT/s, the forcing of Tx EQ Preset is not supported.</td> </tr> <tr> <td>21</td> <td>$R W$</td> <td>Tx Adjustment for Runtime Recalibration (TARR) 0: TARR is not enabled for negotiation 1: TARR is enabled for negotiation</td> </tr> <tr> <td>31:22</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.24 PHY Status (Offset 1008h) This register is global and not per module. <table> <caption>Table 9-49. Physical Layer Status Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$2 : 0$</td> <td>$R O$</td> <td>Reserved</td> </tr> <tr> <td>3</td> <td>$R O$</td> <td>Rx $0 : R \times \text { Termination disable }$ 1: Rx Termination enabled Default is same as 'Terminated Link' bit in PHY capability register. This is the current status of the local UCIe Module. Note that this is always 0 for Advanced Packages. For Standard packages, whether the Rx decides to terminate the Link could depend on several factors (including channel length in the Package, etc.), and that decision is implementation-specific. For Transmitter of a remote Link partner, it needs this information in order to know whether to Hi-Z the Data and Track Lanes during clock gating and when not performing Runtime Recalibration, respectively. It is expected that this information is known a priori at Package integration time, and the Transmitter is informed of this in an implementation- specific manner.</td> </tr> <tr> <td>4</td> <td>$R O$</td> <td>Tx Eq Status 0: Eq Disabled 1: Eq Enabled Default is 0</td> </tr> <tr> <td>5</td> <td>$R O$</td> <td>Clock Mode Status 0: Strobe Mode 1: Free running mode Default is 0. This is remote partner's advertised value during MBINIT.PARAM.</td> </tr> <tr> <td>6</td> <td>$R O$</td> <td>Clock phase Status 0: Differential clock only (all data rates) 1: Quadrature clock (24/32 GT/s); Differential clock (16 GT/s and lower)</td> </tr> <tr> <td>7</td> <td>$R O$</td> <td>{ \text { This is remote partner^{\prime } s \text { advertised value during Naing NANIT.PARAM. } } }<br>{ \text { Lane Reversal within Module: Indicates if Lanes within a module areversed } } 0: Lanes within module not reversed 1: Lanes within module are reversed</td> </tr> <tr> <td>$1 3 : 8$</td> <td>$R O$</td> <td>I/Q Correction Parameter Default is 0. Contains the most-recently received values in bits [5:0] in the Message Info field of the {MBTRAIN.RXCLKCAL TCKN_L shift req} sideband message from the remote UCIe Module Partner. Note that this field is only updated by hardware while the operating data rate is &gt; 32 GT/s.</td> </tr> <tr> <td>17:14</td> <td>$R O$</td> <td>EQ Preset Setting Default is 0. Contains the most-recently received value in bits [4:0] in the Message Info field of Module partner. {MBTRAIN.RXDESKEW EQ Preset req} sideband message from the remote UCIe Note that this field is only updated by hardware while the operating data rate is &gt; 32 GT/s.</td> </tr> <tr> <td>18</td> <td>RO</td> <td>Tx Adjustment for Runtime Recalibration (TARR) 0: TARR is not supported 1: TARR was successfully negotiated and is operational</td> </tr> <tr> <td>31:19</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.25 PHY Initialization and Debug (Offset 100Ch) This register is global, and not per module. <table> <caption>Table 9-50. Phy Init and Debug Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="3">2:0</td> <td></td> <td>Initialization control 000b: Initialize to Active. This is the regular Link bring up. { \text { OO1b: Initialize to MBINIT } \left( \text { Debug mode\right) } \left( \text { i.e. pause training after } \right. \right. }<br>{ \text { completing step-2 of MBINIT.PARAM\right). } } 010b: Initialize to MBTRAIN (Debug/compliance mode) (i.e., pause training after entering MBTRAIN after completing step-1 of MBTRAIN.VALVREF). { \text { O11b = Pause after completing step-1 of MBTRAIN.RXDESKEW } }<br>{ \text { regardless of entering for intial bring up or from Retrain. } } { 1 0 0 b = \text { Pause after completing } \mathrm { s t e p - 1 } o f }<br>{ \text { MBTRAIN.DATATRAINCENTERTERI } ; \text { regardiess of enterring for inttial } }</td> </tr> <tr> <td rowspan="2">$R W$</td> <td>\text { bring up or trom Retrain. }<br>\text { All other encodings are reserved } . .$</td> </tr> <tr> <td>When training has paused, the corresponding state timeouts must be disabled, and hardware resumes training on any of the following triggers: · A Ob-to-1b transition on 'Resume Training' bit in this register · Sideband message for the corresponding state is received from remote link partner (e.g., if paused in MBINIT, receiving {MBINIT.CAL Done req} from remote link partner is also a trigger to move forward) A device that does not support the UCIe Test and Compliance register block is permitted to only implement encodings 000b through 010b. Default is 000b.</td> </tr> <tr> <td>$4 : 3$</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td>5</td> <td>$R W$</td> <td>$A \quad O b - t o - 1 b \quad t r a n s i t i o n \quad o n \quad t h i s \quad b i t \quad t r i g g e r s \quad h a r d w a r e \quad t o \quad r e s u m e$ Control' field in this register until ACTIVE. A device that does not support the UCIe Test and Compliance $\text { register bloc } }<br>{ \text { Default is 0b } } is permitted to hardwire this bit to 0b.</td> </tr> <tr> <td>$3 1 : 6$</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.26 Training Setup 1 (Offset 1010h) This register is replicated per module. Offsets 1010h to 101Ch are used in 4B increments for multi- module scenarios <table> <caption>Table 9-51. Training Setup 1 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="2">$2 : 0$</td> <td rowspan="2">RW</td> <td>Data pattern used during training 000b: Per-Lane LFSR pattern 001b: Per-Lane ID pattern 010b: If @PHY-Compliance {Per-Lane Clock pattern AA pattern} Else Reserved</td> </tr> <tr> <td>011b: If @PHY-Compliance {Per-Lane all 0 pattern} Else Reserved 100b: If @PHY-Compliance {Per-Lane all 1 pattern} Else Reserved 101b: If {@PHY-Compliance Per-Lane inverted Clock pattern} Else Reserved All other encodings are reserved Default is 000b.</td> </tr> <tr> <td>$5 : 3$</td> <td>RW</td> <td>Valid Pattern used during training 000b: Functional valid pattern (1111 0000 (lsb first)) All other encodings are reserved Default is 000b.</td> </tr> <tr> <td>$9 : 6$</td> <td>RW</td> <td>Clock Phase control 0h: Clock PI center found by Transmitter 1h: Left edge found through Data to clock training 2h: Right edge found through Data to clock training { \text { All other encodings are reservec } }<br>{ \text { Default } = 0 }</td> </tr> <tr> <td>10</td> <td>RW</td> <td>Training mode 0b: Continuous mode 1b: Burst Mode $D e f a u l t = 0$</td> </tr> <tr> <td>$2 6 : 1 1$</td> <td>$R W$</td> <td>Count: Indicates the duration of selected pattern (UI count) $D e f a u l t = 4 h$</td> </tr> <tr> <td>31:27</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.27 Training Setup 2 (Offset 1020h) This register is replicated per module. Offsets 1020h to 102Ch are used in 4B offset increments for multi-module scenarios. <table> <caption>Table 9-52. Training Setup 2 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>15:0</td> <td>RW</td> <td>Idle count: Indicates the duration of low following the burst (UI count) $D e f a u l t = 4 h$</td> </tr> <tr> <td>$3 1 : 1 6$</td> <td>$R W$</td> <td>Iterations: Indicates the iteration count of bursts followed by idle (UI count) $D e f a u l t = 4 h$</td> </tr> </table> ## 9.5.3.28 Training Setup 3 (Offset 1030h) This register is replicated per module. Offsets 1030h to 1048h are used in 8B offset increments for multi-module scenarios. <table> <caption>Table 9-53. Training Setup 3 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW</td> <td>Lane mask: Indicated the Lanes to mask during Rx comparison. Example 1h = Lane 0 is masked during comparison. Default = 0 (no mask).</td> </tr> </table> ## 9.5.3.29 Training Setup 4 (Offset 1050h) This register is replicated per module. Offsets 1050h to 105Ch are used in 4B offset increments for multi-module scenarios. <table> <caption>Table 9-54. Training Setup 4 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$3 : 0$</td> <td>$R W$</td> <td>Repair Lane mask: Indicated the Redundant Lanes to mask during Rx comparison. Example 1h =RDO is masked during comparison 2h: RD1 mask. Default = 0 (no mask).</td> </tr> <tr> <td>$1 5 : 4$</td> <td>RW</td> <td>Max error Threshold in per Lane comparison: Indicates threshold for error counting to start. values are sent in the corresponding $S t a r t \quad T x \quad I n i t \quad D \quad t o \quad C \quad p o i n t$ test req} and {Start Tx Init D to C eye sweep req} sideband messages. The remote Link partner must use these values for checking errors against the threshold. For Rx-initiated tests, these values are sent in the corresponding {Start Rx Init D to C point test req} and {Start Rx Init D to C eye sweep req} sideband messages as an inform. The receiver uses against the threshold. $D e f a u l t = 0 \left( a l l \quad e r r o r s \quad a r e \quad c o u n t e d \right) .$</td> </tr> <tr> <td>$3 1 : 1 6$</td> <td>RW</td> <td>Max error Threshold in aggregate comparison: Indicates threshold for error counting to start. For Tx-initiated tests, these values are sent in the corresponding {Start Tx Init D to C point test req} and {Start Tx Init D to $\mathrm { C } \mathrm { e y e }$ sweep req} sideband messages. The remote Link partner must use these values for checking errors against the threshold. { \text { For } R x \text { -initiated tests, these values ares are sent in the corresponalng } }<br>{ \left. \text { fstart } R x \text { Init } D \text { to C point test req } \right\} \text { and } \left\{ \text { Start } R x \text { Init } D \text { to to eyt } \right. } sweep req} sideband messages as an inform. The receiver uses these values for checking errors against the threshold. Default = 0 (all errors are counted).</td> </tr> </table> ## 9.5.3.30 Current Lane Map Module 0 (Offset 1060h) <table> <caption>Table 9-55. Current Lane Map Module 0 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$6 3 : 0$</td> <td>RW</td> <td>Current Rx Lane map (CLM) for Module-0: If a bit is 1 it indicates the corresponding physical Lane is operational. For Standard package modules, bits 63:16 of this register are not applicable. For UCIe-A x32 implementations (i.e., APMW bit in UCIe Link Capability register is set), bits 63:32 of this register are not applicable. Default Value is all 0s.</td> </tr> </table> ## 9.5.3.31 Current Lane Map Module 1 (Offset 1068h) <table> <caption>Table 9-56. Current Lane Map Module 1 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$6 3 : 0$</td> <td>RW</td> <td>Current Rx Lane map (CLM) for Module-1: If a bit is 1 it indicates the corresponding physical Lane is operational. For Standard package modules, bits 63:16 of this register are not applicable. For UCIe-A x32 implementations (i.e., APMW bit in UCIe Link Capability register is set), bits 63:32 of this register are not applicable. Default Value is all Os. This register is reserved if Module 1 is not present</td> </tr> </table> ## 9.5.3.32 Current Lane Map Module 2 (Offset 1070h) <table> <caption>Table 9-57. Current Lane Map Module 2 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$6 3 : 0$</td> <td>RW/RsvdP</td> <td>Current Rx Lane map (CLM) for Module-2: If a bit is 1 it indicates the corresponding physical Lane is operational. For Standard package modules, bits 63:16 of this register are not applicable. For UCIe-A x32 implementations (i.e., APMW bit in UCIe Link Capability register is set), bits 63:32 of this register are not applicable. Default Value is all 0s. This register is reserved if Module 2 is not present</td> </tr> </table> ## 9.5.3.33 Current Lane Map Module 3 (Offset 1078h) <table> <caption>Table 9-58. Current Lane Map Module 3 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>63:0</td> <td>RW/RsvdP</td> <td>Current Rx Lane map (CLM) for Module-3: If a bit is 1 it indicates the corresponding physical Lane is operational. For Standard package modules, bits 63:16 of this register are not applicable. For UCIe-A x32 implementations (i.e., APMW bit in UCIe Link Capability register is set), bits 63:32 of this register are not applicable. Default Value is all 0s. This register is reserved if Module 3 is not present</td> </tr> </table> ## 9.5.3.34 Error Log 0 (Offset 1080h) This register is replicated per module. Offsets 1080h to 108Ch are used in 4B offset increments for multi-module scenarios. <table> <caption>Table 9-59. Error Log 0 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="2">7:0</td> <td rowspan="2">ROS</td> <td>State N: Captures the current Link training state machine status. State Encodings are given by:</td> </tr> <tr> <td>00h RESET 0Eh MBTRAIN.VALTRAINVREF 01h SBINIT 0Fh MBTRAIN.DATATRAINCENTER1 02h MBINIT.PARAM 10h MBTRAIN.DATATRAINVREF 11h MBTRAIN.RXDESKEW { \text { O3h MBINIT.CAL } }<br>{ \text { O4h MBINIT.REPAIRCLK } } 12h MBTRAIN.DATATRAINCENTER2 05h MBINIT.REPAIRVAL 13h MBTRAIN.LINKSPEED 06h MBINIT.REVERSALMB 14h MBTRAIN.REPAIR 07h MBINIT.REPAIRMB 15h PHYRETRAIN 08h MBTRAIN.VALVREF 16h LINKINIT $1 7 h \quad A C T I V E$ \text { O9h MBTRAIN.DATAVREF }<br>\text { OAh MBTRAIN.SPEEDIDL } 18h TRAINERROR { \text { OBh MBTRAIN.TXSELFCAL } }<br>{ \text { OCh MBTRAIN.RXSELFCAL } } { \text { 19n L1/L2 } }<br>{ \text { All other encodings are reservec } } 0Dh MBTRAIN.VALTRAINCENTER Default is 0</td> </tr> <tr> <td>8</td> <td>ROS</td> <td>Lane Reversal: 1b indicates Lane Reversal within the module. Default is 0</td> </tr> <tr> <td>9</td> <td>ROS</td> <td>Width Degrade: 1b indicates Module width Degrade. Applicable to Standard package only. Default is 0.</td> </tr> <tr> <td>$1 5 : 1 0$</td> <td>$R s v d Z$</td> <td>Reserved</td> </tr> <tr> <td>$2 3 : 1 6$</td> <td>ROS</td> <td>State (N-1): Captures the state before State N was entered for Link training state machine. State encodings are the same as State N field. Default is 0</td> </tr> <tr> <td>$3 1 : 2 4$</td> <td>$R O S$</td> <td>State (N-2): Captures the state before State (N-1) was entered for Link training state machine. State encodings are the same as State N field. Default is 0</td> </tr> </table> --- # 9.5.3.35 Error Log 1 (Offset 1090h) This register is replicated per module. Offsets 1090h to 109Ch are used $\mathrm { i n }$ 4B offset increments for multi-module scenarios. <table> <caption>Table 9-60. Error Log 1 Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$7 : 0$</td> <td>ROS</td> <td>$S t a t e \left( N - 3 \right) :$ Captures the state status before State (N-2) was entered. encodings are the same as State N field. Default is 0</td> </tr> <tr> <td>8</td> <td>RW1CS</td> <td>State Timeout Occurred: Hardware sets this to 1b if a Link Training State machine state or sub-state timed out and it was escalated as a fatal error. Default value is 0b.</td> </tr> <tr> <td>9</td> <td>RW1CS</td> <td>Sideband Timeout Occurred: Hardware sets this to 1b if a sideband handshake timed out, for example, if a RDI request did not get a response for 8ms. Sideband handshakes related to Link Training messages are not included here. Default value is 0b.</td> </tr> <tr> <td>10</td> <td>RW1CS</td> <td>Remote LinkError received: Hardware sets this to 1b if remote Link partner requested LinkError transition through RDI sideband. Default value is 0b.</td> </tr> <tr> <td>11</td> <td>RW1CS</td> <td>Internal Error: Hardware sets this to 1b if any implementation specific internal error occurred in the Physical Layer. Default value is 0b.</td> </tr> <tr> <td>$3 1 : 1 2$</td> <td>RsvdZ</td> <td>Reserved</td> </tr> </table> # 9.5.3.36 Runtime Link Test Control (Offset 1100h) <table> <caption>Table 9-61. Runtime Link Test Control (Sheet 1 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW/RO</td> <td>Implementations are encouraged to implement this as an RO bit with a of 0. However, for backward compatibility, implementations are $\mathrm { p e r m i t t e d } t$ to implement this as an RW bit with a default value of 0.</td> </tr> <tr> <td>1</td> <td>RW/RO</td> <td>Implementations are encouraged to implement this as an RO bit with a default value of 0. However, for backward compatibility, implementations are permitted to implement this as an RW bit with a default value of 0.</td> </tr> <tr> <td>2</td> <td>RW</td> <td>Apply Module 0 Lane Repair: For Advanced Package, software programs this bit to inform Physical Layer hardware to apply Lane repair for this logical if this Module is operational. For Standard { \text { module id at the next Retrain cycle, } }<br>{ \text { Package, this bit will trigger a width } } degrade for logical Module 0, if possible Default value is 0.</td> </tr> <tr> <td>3</td> <td>RW</td> <td>Apply Module 1 Lane Repair: For Advanced Package, software programs this bit to inform Physical Layer hardware to apply Lane repair for this logical module id at the next Retrain cycle, if this Module is operational. For Standard Package, this bit will trigger a width degrade for logical Module 1, if possible and relevant. { \text { Default value is } 0 . }<br>{ \text { These bits are reserved if Module 1 is not present .$</td> </tr> <tr> <td>4</td> <td>RW</td> <td>Apply Module 2 Lane Repair: For Advanced Package, software programs this bit to inform Physical Layer hardware to apply Lane repair for this logical module id at the next Retrain cycle, if this Module is operational. For Standard Package, this bit will trigger a width degrade for logical Module 2, if possible and relevant. Default value is 0. These bits are reserved if Module 2 is not present.</td> </tr> </table> <table> <caption>Table 9-61. Runtime Link Test Control (Sheet 2 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>5</td> <td>RW</td> <td>Apply Module 3 Lane Repair: For Advanced Package, software programs this bit to inform Physical Layer hardware to apply Lane repair for this logical module id at the next Retrain cycle, if this Module is operational. For Standard Package, this bit will trigger a width degrade for logical Module 3, if possible and relevant. Default value is 0. These bits are reserved if Module 3 is not present.</td> </tr> <tr> <td>6</td> <td>RW</td> <td>Start: Software writes to this bit before setting Link Retrain bit to inform hardware that the contents of this register are valid. HW clears this bit to 0 after the Busy bit in the Runtime Link Test Status register is set to 1.</td> </tr> <tr> <td>7</td> <td>RW</td> <td>$I n j e c t \quad S t u c k - a t \quad f a u l t : S o f t w a r e \quad w r i t e s \quad 1 b \quad t o \quad t h i s \quad b i t \quad t o \quad i n d i c a t e \quad h a r d w a r e$ specific Module's lane(s) in which the fault is injected is indicated by the `Apply Module x Lane Repair' bits) for the corresponding field. Injecting the fault at Tx or Rx is implementation specific. This bit takes effect during the next link retraining (see Section 4.5.3.7 for further details). Default value is 0b.</td> </tr> <tr> <td>$1 4 : 8$</td> <td>RW</td> <td>Module 0 Lane repair id: For Advanced Package, software programs this bit to inform Physical Layer hardware to apply Lane repair for this logical transmit Lane id in logical Module 0 at the next Retrain cycle, if this Module is operational. For Standard Package, this bit will trigger a width degrade for logical Module 0, if possible and relevant. Default is 0. These bits are reserved if Module 0 is not present.</td> </tr> <tr> <td>21:15</td> <td>RW</td> <td>Module 1 Lane repair id: For Advanced Package, software programs this bit to inform Physical Layer hardware to apply Lane repair for this logical transmit Lane id in logical Module 1 at the next Retrain cycle, if this Module is operational. For Standard Package, this bit will trigger a width degrade for logical Module 1, if possible and relevant. Default is 0. These bits are reserved if Module 1 is not present.</td> </tr> <tr> <td>$2 8 : 2 2$</td> <td>RW</td> <td>Module 2 Lane repair id: For Advanced Package, software programs this bit to inform Physical Layer hardware to apply Lane repair for this logical transmit Lane id in logical Module 2 at the next Retrain cycle, if this Module is operational. For Standard Package, this bit will trigger a width degrade for logical Module 2, if possible and relevant. Default is 0. These bits are reserved if Module 2 is not present.</td> </tr> <tr> <td>$3 5 : 2 9$</td> <td>RW</td> <td>Module 3 Lane repair id: For Advanced Package, software programs this bit to inform Physical Layer hardware to apply Lane repair for this logical transmit Lane id in logical Module 3 at the next Retrain cycle, if this Module is operational. For Standard Package, this bit will trigger a width degrade for logical Module 3, if possible and relevant. Default is 0. These bits are reserved if Module 3 is not present.</td> </tr> <tr> <td>63:36</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.37 Runtime Link Test Status (Offset 1108h) <table> <caption>Table 9-62. Runtime Link Test Status Register</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RO</td> <td>Busy: Hardware loads 1b to this bit once Start bit is written by software. Hardware loads Ob to this bit once it has attempted to complete the actions requested in Runtime Link Test Control register. Default is 0</td> </tr> <tr> <td>31:1</td> <td>RsvdZ</td> <td>Reserved</td> </tr> </table> ## 9.5.3.38 Mainband Data Repair (Offset 110Ch) This register is replicated per advanced module. For Standard package, this register is not applicable. Offsets 110Ch to 1124h are used in 8B offset increments for multi-module scenarios. <table> <caption>Table 9-63. Mainband Data Repair Register (Sheet 1 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="2">7:0</td> <td rowspan="2">RO</td> <td>Repair Address for TRD_P[0]: Indicates the physical Lane repaired when TRD_P[0] is used in remapping scheme</td> </tr> <tr> <td>00h: TD_P[0] Repaired 1Eh: TD_P[30] Repaired 01h: TD_P[1] Repaired 1Fh: TD_P[31] Repaired 02h: TD_P[2] Repaired F0h: Repair attempt failed FFh: No Repair ...</td> </tr> <tr> <td rowspan="2">15:8</td> <td rowspan="2">RO</td> <td>Repair Address for TRD_P[1]: Indicates the physical Lane repaired when TRD_P[1] is used in remapping scheme</td> </tr> <tr> <td>00h: Invalid 1Eh: TD_P[30] Repaired 01h: TD_P[1] Repaired 1Fh: TD_P[31] Repaired 02h: TD_P[2] Repaired F0h: Repair attempt failed FFh: No Repair ...</td> </tr> <tr> <td rowspan="3">$2 3 : 1 6$</td> <td rowspan="3">$R O$</td> <td>Repair Address for TRD_P[2]: Indicates the physical Lane repaired when TRD_P[2] is used in remapping scheme</td> </tr> <tr> <td>20h: TD_P[32] Repaired $\text { 3Eh: TD-P\left[62\right] Repairec } }<br>{ 3 \text { Fh: } T D \text { PI } 6 3 1 \text { Repairec } } 21h: TD_P[33] Repaired 22h: TD_P[34] Repaired F0h: Repair attempt failed FFh: No Repair ...</td> </tr> <tr> <td>This field is reserved for UCIe-A x32 module implementations.</td> </tr> <tr> <td rowspan="3">$3 1 : 2 4$</td> <td rowspan="3">$R O$</td> <td>Repair Address for TRD_P[3]: Indicates the physical Lane repaired when TRD_P[3] is used in remapping scheme</td> </tr> <tr> <td>20h: Invalid 3Eh: TD_P[62] Repaired { 2 1 h : \text { TD } - P \left[ 3 3 \right] \text { Repairec } }<br>{ 2 2 h : \text { TD } P \left[ 3 4 \right] \text { Repairec } } $3 F h : T D _ { - } P \left[ 6 3 \right]$ FFh: No Repair ...</td> </tr> <tr> <td>This field is reserved for UCIe-A x32 module implementations.</td> </tr> <tr> <td rowspan="2">$3 9 : 3 2$</td> <td rowspan="2">$R O$</td> <td>Repair Address for RRD_P[0]: Indicates the physical Lane repaired when RRD_P[0] is used in remapping scheme</td> </tr> <tr> <td>00h: RD_P[0] Repaired 1Eh: RD_P[30] Repaired 01h: RD_P[1] Repaired 02h: RD_P[2] Repaired { \text { 1Fh: RD_PIJ Repaired } }<br>{ \text { FOh: Repair attempt failed } } FFh: No Repair ...</td> </tr> </table> <table> <caption>Table 9-63. Mainband Data Repair Register (Sheet 2 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th colspan="2">Description</th> </tr> <tr> <td rowspan="2">$4 7 : 4 0$</td> <td rowspan="2">$R O$</td> <td colspan="2">Repair Address for RRD_P[1]: Indicates the physical Lane repaired when RRD_P[1] is used in remapping scheme</td> </tr> <tr> <td>00h: RD_P[0] Repaired 01h: RD_P[1] Repaired 02h: RD_P[2] Repaired ...</td> <td>1Eh: RD_P[30] Repaired 1Fh: RD_P[31] Repaired F0h: Repair attempt failed FFh: No Repair</td> </tr> <tr> <td rowspan="3">$5 5 : 4 8$</td> <td rowspan="3">$R O$</td> <td colspan="2">Repair Address for RRD_P[2]: Indicates the physical Lane repaired when RRD_P[2] is used in remapping scheme</td> </tr> <tr> <td>20h: RD_P[32] Repaired 21h: RD_P[33] Repaired 22h: RD_P[34] Repaired ...</td> <td>$R D _ { - }$ 3Fh: RD_P[63] Repaired F0h: Repair attempt failed FFh: No Repair</td> </tr> <tr> <td colspan="2">This field is reserved for UCIe-A x32 implementations.</td> </tr> <tr> <td rowspan="3">$6 3 : 5 6$</td> <td rowspan="3">$R O$</td> <td colspan="2">Repair Address for RRD_P[3]: Indicates the physical Lane repaired when RRD_P[3] is used in remapping scheme</td> </tr> <tr> <td colspan="2">20h: RD_P[32] Repaired 3Eh: RD_P[62] Repaired 21h: RD_P[33] Repaired 3Fh: RD_P[63] Repaired 22h: RD_P[34] Repaired F0h: Repair attempt failed FFh: No Repair ...</td> </tr> <tr> <td colspan="2">This field is reserved for UCIe-A x32 module implementations.</td> </tr> </table> ## 9.5.3.39 Clock, Track, Valid and Sideband Repair (Offset 1134h) This register is replicated per module. Offsets 1134h to 1140h are used in 4B offset increments for multi-module scenarios. <table> <caption>Table 9-64. Clock, Track, Valid and Sideband Repair Register (Sheet 1 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td rowspan="2">$3 : 0$</td> <td rowspan="2">$R O$</td> <td>Repair Address for TRDCK_P: Indicates the physical Lane repaired when TRDCK_P is used in remapping scheme</td> </tr> <tr> <td>0h: TCKP _ P Repaired 7h: Repair attempt failed 1h: TCKN_P Repaired Fh: No Repair 2h: TTRK_P Repaired All other encodings are reserved.</td> </tr> <tr> <td rowspan="2">$7 : 4$</td> <td rowspan="2">RO</td> <td>Repair Address for RRDCK_P: Indicates the physical Lane repaired when RRDCK_P is used in remapping scheme</td> </tr> <tr> <td>0h: RCKP _ P Repaired 7h: Repair attempt failed $1 h : R C K N _ { - } P$ Fh: No Repair All other encodings are reserved. _</td> </tr> <tr> <td rowspan="3">9:8</td> <td rowspan="3">$R O$</td> <td>Repair Address for TRDVLD_P: Indicates the physical Lane repaired when TRDVLD_P is used in remapping scheme</td> </tr> <tr> <td>00b: TVLD_P Repaired 10b: Reserved</td> </tr> <tr> <td>01b: Repair attempt failed 11b: No Repair</td> </tr> <tr> <td rowspan="3">$1 1 : 1 0$</td> <td rowspan="3">$R O$</td> <td>Repair Address for RRDVLD_P: Indicates the physical Lane repaired when RRDVLD_P is used in remapping scheme</td> </tr> <tr> <td>00b: RVLD_P Repaired 10b: Reserved</td> </tr> <tr> <td>01b: Repair attempt failed 11b: No Repair</td> </tr> </table> <table> <caption>Table 9-64. Clock, Track, Valid and Sideband Repair Register (Sheet 2 of 2)</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>$1 5 : 1 2$</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td>$1 9 : 1 6$</td> <td>RO</td> <td>Repair Address for Sideband Transmitter: Indicates sideband repair result for the Transmitter Result[3:0]</td> </tr> <tr> <td>$2 3 : 2 0$</td> <td>RO</td> <td>Repair Address for Sideband Receiver: Indicates sideband repair result for the Transmitter Result[3:0]</td> </tr> <tr> <td>$3 1 : 2 4$</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ## 9.5.3.40 UCIe Link Health Monitor (UHM) DVSEC This DVSEC is an extended Capability. It is required for all devices that support Compliance testing (as indicated by the presence of Compliance/Test Register Locator) and optional otherwise. This DVSEC contains the required registers for SW to read eye margin values per lane. SW Flow for Eye Margining is as follows: · SW ensures that the Eye Margin Valid (EMV) bit in UHM_STS register is cleared · SW triggers a retrain of the link \- When the retrain completes (as indicated by bit 16 in the UCIe Link Status register) and the EMV bit is set in the UHM_STS register, SW can read the EM *_ Ln \*_ Mod\* registers in UHM DVSEC to know the margins. Receive margins are logged in the Tx UHM registers. Note that HW may also measure Eye Margins during HW-autonomous retraining and/or initial training and if measured, is permitted to report it in the Eye Margin registers whenever the EMV bit is cleared. For x32 Advanced Packaging implementations, EML* and EMR* registers for Lanes 63:32 are RsvdP. <table> <caption>Figure 9-5. UCIe Link Health Monitor (UHM) DVSEC</caption> <tr> <th colspan="4">PCI Express Extended Capability Header</th> </tr> <tr> <th colspan="4">Designated Vendor Specific Header 1</th> </tr> <tr> <th colspan="2">Reserved</th> <th colspan="2">Designated Vendor Specific Header 2</th> </tr> <tr> <td colspan="2">UHM_STS</td> <td colspan="2">Reserved</td> </tr> <tr> <td colspan="4">Reserved</td> </tr> <tr> <td colspan="4">Reserved</td> </tr> <tr> <td>EMR_Ln1_Mod0</td> <td>EML_Ln1_Mod0</td> <td>EMR_Ln0_Mod0</td> <td>EML_Ln0_Mod0</td> </tr> <tr> <td>EMR_Ln3_Mod0</td> <td>EML_Ln3_Mod0</td> <td>EMR_Ln2_Mod0</td> <td>EML_Ln2_Mod0</td> </tr> <tr> <td colspan="2"></td> <td colspan="2">...</td> </tr> <tr> <td colspan="2"></td> <td colspan="2">...</td> </tr> <tr> <td>EMR_Ln1_Mod1</td> <td>EML_Ln1_Mod1</td> <td>EMR_Ln0_Mod1</td> <td>EML_Ln0_Mod1</td> </tr> <tr> <td>EMR_Ln3_Mod1</td> <td>EML_Ln3_Mod1</td> <td>EMR_Ln2_Mod1</td> <td>EML_Ln2_Mod1</td> </tr> <tr> <td colspan="4">...</td> </tr> <tr> <td colspan="4">...</td> </tr> </table> <table> <caption>Table 9-65. UHM DVSEC - Designated Vendor Specific Header 1, 2 (Offsets 04h and 08h)</caption> <tr> <th>Register</th> <th>Field</th> <th>Bit Location</th> <th>Value</th> </tr> <tr> <td rowspan="3">Designated Vendor-Specific Header 1 (offset 04h)</td> <td>DVSEC Vendor ID</td> <td>15:0</td> <td>D2DEh</td> </tr> <tr> <td>DVSEC Revision</td> <td>19:16</td> <td>0h</td> </tr> <tr> <td>Length</td> <td>31:20</td> <td>Design dependent</td> </tr> <tr> <td>Designated Vendor-Specific Header 2 (offset 08h)</td> <td>DVSEC ID</td> <td>15:0</td> <td>1h</td> </tr> </table> # 9.5.3.40.1 UHM Status (Offset Eh) <table> <caption>Table 9-66. UHM Status</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>7:0</td> <td>RO</td> <td>Step Count Step count used in the reporting of margin information. A value of 0 indicates 256. For example, a value of 32 indicates that the UI is equally divided into 32 steps and Eye Margin registers provide the left and right margins in multiples of UI/32.</td> </tr> <tr> <td>8</td> <td>RW1C</td> <td>Eye Margin Valid (EMV) This bit, when set, indicates that margin registers carry valid information from the last retrain. SW must clear this bit before initiating link retrain, if it intends to measure eye margins during the retrain. On a SW- initiated link retrain, if after retrain, this bit is cleared, then SW should infer that there was some error in margin measurement. Note that HW logs any new Eye Margin measurements (whether it is measured during SW-initiated retrain, during HW-autonomous retraining, or during initial training) in the Eye Margin registers only when this bit is cleared.</td> </tr> <tr> <td>15:9</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> # 9.5.3.40.2 Eye Margin (Starting Offset 18h) <table> <caption>Table 9-67. EML_Lnx_Mody</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>7:0</td> <td>RO</td> <td>Eye Margin Left for Lane x and Module y Provides the left eye margin relative to the PI center, in units of $\mathrm { U I / S t e p }$ Count.</td> </tr> </table> <table> <caption>Table 9-68. EMR_Lnx_Mody</caption> <tr> <th>Bit</th> <th>Attribute</th> <th>Description</th> </tr> <tr> <td>7:0</td> <td>RO</td> <td>Eye Margin Right for Lane x and Module y Provides the right eye margin relative to the PI center, in units of UI/ Step Count.</td> </tr> </table> ## 9.5.4 Test/Compliance Register Block The Test/Compliance register block is 8 KB in size with first 4 KB from base address (as enumerated via register locator with Register Block Identifier of 1h) used for D2D Adapter-related Test/Compliance registers and the second 4 KB used for PHY-related Test/Compliance registers. For future extensibility, these offsets are enumerable via the associated Register Block Offset registers, as shown in Figure 9-6. <figure> <figcaption>Figure 9-6. UCIe Test/Compliance Register Block</figcaption> PHY Test/Compliance Register Block Mod 3 8K PHY Test/Compliance Register Block Mod 2 PHY Test/Compliance Register Block Mod 1 PHY Test/Compliance Register Block Mod 0 4K D2D Adapter Test/ Compliance Register Block Base address as indicated in "Test/Compliance" Register Locator Rsvd PHY Test/Compliance Register Block Offset D2D Adapter Test/Compliance Register Block Offset 32 UCle Register Block Header </figure> ### 9.5.4.1 UCIe Register Block Header <table> <caption>Table 9-69. UCIe Register Block Header (Offset 0h)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>15:0</td> <td>RO</td> <td>Vendor ID Default is set to Vendor ID assigned for UCIe Consortium - D2DEh.</td> </tr> <tr> <td>$3 1 \cdot 1 6$</td> <td>RO</td> <td>Vendor ID Register Block Set to 1h to indicate Test Compliance register block.</td> </tr> <tr> <td>35:32</td> <td>RO</td> <td>Vendor Register Block Version Set to 0h.</td> </tr> <tr> <td>$6 3 : 3 6$</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td>$9 5 : 6 4$</td> <td>$R O$</td> <td>Vendor Register Block Length The number of bytes in the register block including the UCIe register block header. Default is 2000h.</td> </tr> <tr> <td>127:96</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ### 9.5.4.2 D2D Adapter Test/Compliance Register Block Offset <table> <caption>Table 9-70. D2D Adapter Test/Compliance Register Block Offset (Offset 10h)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>7:0</td> <td>RO</td> <td>D2D Adapter Test/Compliance Register Block Offset (D2DOFF) 4-KB granular offset from Test/Compliance Register Block base address for D2D Adapter Test/Compliance registers. This field should be set to 0. However, SW must read this field to know the actual offset, for future compatibility reasons.</td> </tr> <tr> <td>15:8</td> <td>RO</td> <td>D2D Adapter Test/Compliance Register Block Length 4-KB granular length of the D2D Adapter Test/Compliance registers. This field should be set to 1 to indicate 4-KB length. However, SW must read this field to know the actual length, for future compatibility reasons.</td> </tr> <tr> <td>31:16</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ### 9.5.4.3 PHY Test/Compliance Register Block Offset <table> <caption>Table 9-71. PHY Test/Compliance Register Block Offset (Offset 14h)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>7:0</td> <td>RO</td> <td>PHY Test/Compliance Register Block Offset (PHYOFF) 4-KB granular offset from Test/Compliance Register Block base address for PHY Adapter Test/Compliance registers. This field should be set to 1, indicating that the registers start at 4 KB from the base address. However, SW must read this field to know the actual offset, for future compatibility reasons.</td> </tr> <tr> <td>15:8</td> <td>RO</td> <td>PHY Test/Compliance Register Block Length 4-KB granular length of the PHY Test/Compliance registers. This field should be set to 1 to indicate 4-KB length. However, SW must read this field to know the actual length, for future compatibility reasons.</td> </tr> <tr> <td>$3 1 : 1 6$</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ### 9.5.4.4 D2D Adapter Test/Compliance Register Block #### 9.5.4.4.1 Adapter Compliance Control <table> <caption>Table 9-72. Adapter Compliance Control (Offset 20h from D2DOFF)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td rowspan="2">1:0</td> <td rowspan="2">RW</td> <td>Compliance Mode Any write to this register takes effect after the next entry of RDI state status to Retrain. · 00b = Normal mode of operation . 01b = PHY only Link Training or Retraining - Adapter performs the necessary RDI handshakes to bring RDI to Active but does not perform Parameter exchanges or Adapter vLSM handshakes and keeps FDI in Reset to prevent mainband traffic. - Adapter must still trigger RDI to Retrain if software programmed the Retrain bit in Link Control. - Sideband Register Access requests and completions are operational in this mode.</td> </tr> <tr> <td>· 10b = Adapter Compliance - Adapter performs the necessary RDI handshakes to bring RDI to Active but does not perform Parameter exchanges or Adapter vLSM handshakes (unless triggered by software) and keeps FDI in Reset. - Adapter only performs actions based on the triggers and setup according to the registers defined in Section 9.5.4.4.2 to Section 9.5.4.4.6. - Adapter must still trigger RDI to Retrain if software programmed the Retrain bit in Link Control. - Sideband Register Access requests and completions are operational in this mode. · 11b = Reserved { \text { Any RDI transition to LINKE } }<br>{ \text { Anse not reset any registers } } when this field is either 01b or 10b Default is 00b.</td> </tr> <tr> <td>2</td> <td>RW</td> <td>Force Link Reset If set to 1b, Adapter transitions RDI to LinkError state. This bit is used by Compliance software to re-initialize the DUT anytime during Compliance testing. If SW expectation is that the DUT reinitializes to normal mode at the end of link reset, the Compliance Mode field in this register must be 00b and the Compliance Enable for PHY bit in the PHY Compliance Control Register must be 0b.</td> </tr> <tr> <td>31:3</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ### 9.5.4.4.2 Flit $T x$ Injection Control <table> <caption>Table 9-73. Flit Tx Injection Control (Offset 28h from D2DOFF) (Sheet 1 of 2)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW</td> <td>Flit Tx Injection Enable Setting this bit to 1b starts Flit injection from the Adapter to the PHY at the Transmitter. Clearing this bit to Ob stops Flit injection on the Link. Default is 0b.</td> </tr> <tr> <td>$3 : 1$</td> <td>RW</td> <td>Flit Type Type of Flit injected. . 000b = Adapter NOP Flits. These bypass TX retry buffer. · 001b = Test Flits. · 010b = Alternate between NOP Flits and Test Flits. . All other encodings are reserved. Default is 000b.</td> </tr> </table> <table> <caption>Table 9-73. Flit Tx Injection Control (Offset 28h from D2DOFF) (Sheet 2 of 2)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td rowspan="2">5:4</td> <td rowspan="2">RW</td> <td>Injection mode . 00b = Continuous injection of Flits as specified by Flit Type field. · 01b = Inject 'Flit Inject Number' of Flits contiguously without any intervening Protocol Flits.</td> </tr> <tr> <td>· 10b = Inject 'Flit Inject Number' of Flits while interleaving with Protocol Flits. are available, alternate between Protocol Flits and Injected $F l i t s . I f \quad n o \quad P r o t o c o l$ Flits are available then, inject consecutively. · $1 1 b = R e s e r v e d .$ Default</td> </tr> <tr> <td>$1 3 : 6$</td> <td>RW</td> <td>Flit Inject Number If the Injection mode is not 00b, this field indicates the number of Flits injected. Default is 00h.</td> </tr> <tr> <td>$1 7 : 1 4$</td> <td>RW</td> <td>Payload Type This field determines the payload type used if Test Flits are injected. Payload includes all bits in the Flit with the exception of Flit Header, CRC, and Reserved bits. . { \text { Oh } = \text { Fixed } 4 B \text { pattern picked up from Payload Fixed Pattern } ^ { \prime } \text { field of this } }<br>{ \text { register, inserted so as to cover all the Payload bytes \left(with the same patter\right) } } replicated in incrementing 4B chunks) · 1h = Random 4B pattern picked up from a 32b LFSR (linear feedback shift register used for pseudo random pattern generation), inserted so as to cover all the Payload bytes (with the same pattern replicated in incrementing 4B · { \text { CnunKS\right) } }<br>{ 2 h = \text { Fixed } 4 \text { byte pattern picked up from from Payload Fixed Pattern field of the } }<br>{ \text { reaister inser tnsed once at the Flit Byte offset^{\prime } \text { location within thin tht } } · 3h = Random 4B pattern picked up from a 32b LFSR, inserted once at the 'Flit Byte Offset' location within the Flit and the rest of the payload is assigned 0b · $4 h = S a m e \quad a s \quad 2 h ,$ except the 4B pattern is injected every 'Pattern Repetition' with 'Flit Byte Offset' . 5h = Same as 3h, except the 4B pattern is injected every 'Pattern Repetition' bytes starting with 'Flit Byte Offset' and the rest of the payload is assigned 0b · All other encodings are reserved Default is 0h. LFSR seed and primitive polynomial choice is implementation specific. Note: While in mission mode, because scrambling is always enabled, changing the Payload Type may have no benefit. This may, however, be useful during compliance testing with scrambling disabled.</td> </tr> <tr> <td>$2 5 : 1 8$</td> <td>$R W$</td> <td>Flit Byte Offset See 'Payload Type'. Default is 00h.</td> </tr> <tr> <td>$3 1 : 2 6$</td> <td>RW</td> <td>Pattern Repetition See 'Payload Type'. A value of 00h or 01h must be interpreted as a single pattern occurrence. Default is 00h.</td> </tr> <tr> <td>63:32</td> <td>RW</td> <td>Payload Fixed Pattern See 'Payload Type'. Default is 0000 0000h.</td> </tr> </table> ### 9.5.4.4.3 Adapter Test Status (Offset 30h from D2DOFF) <table> <caption>Table 9-74. Adapter Test Status</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>0</td> <td>$R O$</td> <td>Compliance Status If Adapter is in 'PHY only Link Training or Retraining' or 'Adapter Compliance' mode, it is set to 1b; otherwise, it is 0b.</td> </tr> <tr> <td>$2 : 1$</td> <td>$R O$</td> <td>Flit Tx Injection Status · 00b = No Flits injected. · 01b = At least one Flit was injected, but not completed. For Continuous from 1b to 0b. Injection mode, this will be the status until Flit Injection Enable transitions · 10b = Completed Flit Injection, for cases in which a finite number of Flit injections was set up. . 11b = Flit Injection Enable transitioned from 1b to Ob before Flit injections were complete. This field is cleared to 00b on a 0b-to-1b transition of Flit Injection Enable bit. Default is 00b.</td> </tr> <tr> <td>$4 : 3$</td> <td>RW1C</td> <td>Flit Rx Status . 00b = No Test Flits received . 01b = Received at least one Test Flit without CRC error . All other encodings are reserved Default is 00b.</td> </tr> <tr> <td>5</td> <td>$R O$</td> <td>Link State Request Injection Status for Stack 0 · Ob = No request injected · 1b = Completed Request Injection This bit is cleared to Ob on a Ob-to-1b transition of 'Link State Request or Response Injection Enable'.</td> </tr> <tr> <td>6</td> <td>$R O$</td> <td>Link State Response Injection Status for Stack 0 · Ob = No response injected · 1b = Completed Response Injection This bit is cleared to Ob on a Ob-to-1b transition of 'Link State Request or Response Injection Enable'.</td> </tr> <tr> <td>7</td> <td>$R O$</td> <td>Link State Request Injection Status for Stack 1 · Ob = No request injected · 1b = Completed Request Injection This bit is cleared to Ob on a Ob-to-1b transition of 'Link State Request or Response Injection Enable'.</td> </tr> <tr> <td>8</td> <td>$R O$</td> <td>Link State Response Injection Status for Stack 1 · 0b = No response injected · 1b = Completed Response Injection This bit is cleared to Ob on a Ob-to-1b transition of 'Link State Request or Response Injection Enable'.</td> </tr> <tr> <td>$1 0 : 9$</td> <td>$R O$</td> <td>Retry Injection Status . 00b = No errors injected on Transmitted Flits · 01b = Injected error on at least one transmitted Flit · 10b = Finished error injection sequence on transmitted Flits · 11b = Reserved This field is cleared to 00b on a Ob-to-1b transition of 'Retry Injection Enable'.</td> </tr> <tr> <td>11</td> <td>$R O$</td> <td>Number of Retries Exceeded Threshold Set to 1b if the number of independent retry events exceed the threshold defined in 'Tx Retry Error Threshold'. This bit is cleared to Ob on a Ob-to-1b transition of 'Retry Injection Enable'.</td> </tr> <tr> <td>$3 1 : 1 2$</td> <td>RsvdZ</td> <td>Reserved</td> </tr> </table> ### 9.5.4.4.4 Link State Injection Control Stack 0 (Offset 34h from D2DOFF) As mentioned in Section 11.2, this register only takes effect when the Adapter is in Adapter Compliance Mode. With respect to this register, the Adapter must trigger the corresponding RDI handshakes if the required conditions are met. Also, if Link State Injection Control is enabled, then unexpected responses are discarded and could lead to timeouts if the expected response is not received within the 8-ms timeout window. <table> <caption>Table 9-75. Link State Injection Control Stack 0</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW</td> <td>Link State Request or Response Injection Enable at Tx . Ob = Link State Request or Response Injection not enabled at Tx · 1b = Link State Request or Response Injection enabled at Tx</td> </tr> <tr> <td>1</td> <td>RW</td> <td>Injection Type · Ob = Inject a request packet with the request matching "Link Request" field · 1b = Inject a response packet with the response matching "Link Response" field when a request matching "Link Request" field is received</td> </tr> <tr> <td>5:2</td> <td>RW</td> <td>Link Request The encodings match the State request encodings of FDI.</td> </tr> <tr> <td>9:6</td> <td>RW</td> <td>Link Response The encodings match the State response encodings of FDI.</td> </tr> <tr> <td>31:10</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ### 9.5.4.4.5 Link State Injection Control Stack 1 (Offset 38h from D2DOFF) As mentioned in Section 11.2, this register only takes effect when the Adapter is in Adapter Compliance Mode. With respect to this register, the Adapter must trigger the corresponding RDI handshakes if the required conditions are met. Also, if Link State Injection Control is enabled, then unexpected responses are discarded and could lead to timeouts if the expected response is not received within the 8-ms timeout window. <table> <caption>Table 9-76. Link State Injection Control Stack 1</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW</td> <td>Link State Request or Response Injection Enable at Tx · Ob = Link State Request or Response Injection not enabled at Tx · 1b = Link State Request or Response Injection enabled at Tx</td> </tr> <tr> <td>1</td> <td>RW</td> <td>Injection Type · Ob = Inject a request packet with the request matching "Link Request" field · 1b = Inject a response packet with the response matching "Link Response" field when a request matching "Link Request" field is received</td> </tr> <tr> <td>5:2</td> <td>RW</td> <td>Link Request The encodings match the State request encodings of FDI.</td> </tr> <tr> <td>$9 : 6$</td> <td>RW</td> <td>Link Response The encodings match the State response encodings of FDI.</td> </tr> <tr> <td>$3 1 : 1 0$</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ### 9.5.4.4.6 Retry Injection Control (Offset 40h from D2DOFF) <table> <caption>Table 9-77. Retry Injection Control</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW</td> <td>Retry Injection Enable Setting this bit to 1b enables and starts error injections at Tx to force Retry on the UCIe Link. Clearing this bit to 0b stops Flit injection on the Link. Default is 0b.</td> </tr> <tr> <td>$3 : 1$</td> <td>RW</td> <td>Error Injection Type on Transmitted Flits . 000b = No errors injected on Transmitted Flits · 001b = 1-bit error injected in 'Byte Offset' of the Flit, it is permitted to invert any bit in the corresponding byte position · 010b = 2-bit error injected in 'Byte Offset' of the Flit, it is permitted to invert any two bits in the corresponding byte position · $0 1 1 b =$ 3-bit error injected in 'Byte Offset' of the Flit, it is permitted to invert any three bits in the corresponding byte position . All other encodings are reserved Default is 000b.</td> </tr> <tr> <td>$1 1 : 4$</td> <td>RW</td> <td>Byte Offset See 'Error Injection Type on Transmitted Flits'. $0 0 h \quad m e a n s$ error is injected on Byte 0, 01h means error is injected in Byte 1, and Default is 00h.</td> </tr> <tr> <td>$1 9 : 1 2$</td> <td>RW</td> <td>Number of Flits between Injected Errors A nonzero value indicates the exact number of Flits after which a subsequent error is injected. A value of 0 will inject errors after a pseudo-random number of Flits 31, chosen from a 32b LFSR output. $D e f a u l t \quad i s \quad 0 0 h .$</td> </tr> <tr> <td>27:20</td> <td>RW</td> <td>Number of Errors Injected Represents the number of errors injected on the Transmitted Flits. A value of 0 indicates that the error injection continues until the Retry Injection Enable is disabled. Default is 00h.</td> </tr> <tr> <td>30:28</td> <td>RW</td> <td>Flit Type for Error Injection . 000b = Inject errors on any Flit type. · 001b = Only inject errors on NOP Flits. · 010b = Only inject errors on Payload Flits (Protocol Flits or Test Flits). · 011b = Only inject errors on Test Flits. . 100b = Only inject errors on Payload Flits. Subsequent errors injected on the for this case). same sequence number (`Number of Flits between Injected Errors' is ignored Note: The 100b value can be used to test Replay number Rollover rules. . All other encodings are reserved Default value is 000b.</td> </tr> <tr> <td>31</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td>$3 5 : 3 2$</td> <td>RW</td> <td>Tx Retry Error Threshold If the number of independent retry events exceeds this threshold, Adapter must log this in 'Number of Retries Exceeded Threshold' and trigger Retrain on RDI. RDI state status going to Retrain also clears the internal count of independent retry events. Default value is 0h.</td> </tr> <tr> <td>63:36</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ### 9.5.4.5 PHY Test/Compliance Register Block Certain register bits described in this section take effect only when the PHY enters "PHY Compliance" mode. This mode is entered when bit 0 of 'Physical Layer Compliance Control 1' register is written and PHY subsequently enters PHYRETRAIN state. The latter happens when SW retrains the link. These register bits are tagged with @PHY-Compliance for easy readability and intuitive understanding. Transition to TRAINERROR @PHY-Compliance does not reset any of the registers defined in this section. SW is required to place the Adapter in one of the Compliance modes (defined in the Adapter Compliance Control register) before enabling @PHY-Compliance. All modules of a Link must be in @PHY-Compliance at the same time. The Link behavior is undefined if a subset of modules of a Link are in @PHY-Compliance and others are not. All registers in this section are replicated, one per module, as follows: · Module 0 registers start at Offset 000h from PHYOFF · Module 1 registers start at Offset 400h from PHYOFF · Module 2 registers start at Offset 800h from PHYOFF · Module 3 registers start at Offset COOh from PHYOFF If certain modules are not implemented, those registers become reserved (as shown with gray boxes in Figure 9-6). ### 9.5.4.5.1 Physical Layer Compliance Control 1 (Offsets 000h, 400h, 800h, and C00h from PHYOFF) <table> <caption>Table 9-78. Physical Layer Compliance Control 1 (Sheet 1 of 2)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW</td> <td>Compliance Enable for Physical Layer Setting this bit to 1b puts the Physical Layer in "PHY Compliance" on the next entry into PHYRETRAIN state. Even if RDI status moves to Active, it does not assert pl_trdy to the Adapter in this mode. Default is 0b.</td> </tr> <tr> <td>1</td> <td>RW</td> <td>Scrambling Disabled @PHY-Compliance, when set to 1b, Physical Layer disables scrambling. Default is 0b.</td> </tr> <tr> <td>2</td> <td>RW</td> <td>PHY Compliance Operation Trigger @PHY-Compliance, transitioning this bit from 0b-to-1b starts one iteration of the Link training basic operations set by `PHY Compliance Operation Type'. `PHY Compliance Operation Type' field identifies which of the Link training basic operations is performed. 'Training Setup 1', 'Training Setup 2', 'Training Setup 3', and 'Training Setup 4' registers determine the parameters to be used for this. Default is 0b.</td> </tr> </table> <table> <caption>Table 9-78. Physical Layer Compliance Control 1 (Sheet 2 of 2)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td rowspan="3">5:3</td> <td rowspan="3">RW</td> <td>PHY Compliance Operation Type @PHY-Compliance, where the Link training basic operation (see Section 4.5.1) is performed when `PHY Compliance Operation Trigger' transitions from 0b to 1b · 000b = No operation · 001b = Transmitter initiated Data-to-Clock point test (see Section 4.5.1.1) · 010b = Transmitter initiated Data-to-Clock eye width sweep (see Section 4.5.1.2)</td> </tr> <tr> <td>· 011b = Receiver initiated Data-to-Clock point training (see Section 4.5.1.3) · 100b = Receiver initiated Data-to-Clock width sweep training (see Section 4.5.1.4)</td> </tr> <tr> <td>· 101b = If the current state is MBTRAIN.RXDESKEW and the operating data rate is &gt; 32 GT/s, perform the relevant sideband handshakes to transition the state to MBTRAIN.DATACENTER1 and continue the Link training steps. Note that the "Initialization Control" settings of the PHY Initialization and Debug register apply to pause Link training at a subsequent state. Typical usage of this encoding is for software to step through the Link state machine to permit for Tx adjustments as software sweeps through the different EQ settings. · All other encodings are reserved</td> </tr> <tr> <td>$7 : 6$</td> <td>RsvdP</td> <td>Reserved</td> </tr> <tr> <td rowspan="4">9:8</td> <td rowspan="4">RW</td> <td>Rx Vref Offset Enable @PHY-Compliance: . 00b = No change to trained Rx Vref value</td> </tr> <tr> <td>· 01b = Add Rx Vref offset to trained Rx Vref value (up to maximum permitted Vref value)</td> </tr> <tr> <td>· 10b = Subtract Rx Vref offset to trained Rx Vref value (down to minimum permitted Rx Vref, any negative value to be terminated at 0)</td> </tr> <tr> <td>· 11b = Reserved</td> </tr> <tr> <td>$1 7 : 1 0$</td> <td>RW</td> <td>Rx Vref Offset @PHY-Compliance, when 'Rx Vref Offset Enable' is set to 01b or 10b, this is the value that needs to be added or subtracted as defined in 'Rx Vref Offset Enable'. The Rx Vref value, after applying the Rx Vref offset, is expected to be monotonically $o f f s e t \quad r e l a t i v e \quad t o \quad t h e \quad t r a i n e d \quad v a l u e \quad a n d \quad m u s t \quad h a v e \quad s u f f i c i e n t \quad r a n g e \quad t o \quad c o v e r \quad t h e$ { \text { Rx Vref Offset will be applied during } T x \text { or Ror Rx Data to Point Traint Trand the } }<br>{ \text { Physical Layer must compare the per Lane errors with with error threshoid in per } } Lane comparison', and aggregate Lane errors with 'Max Error Threshold in Aggregate Comparison' in the 'Training Setup 4' register. If the errors measured are greater than the corresponding threshold, then the device must set the Rx Vref offset status register to "failed". Software must increase or decrease the Rx Vref Offset by one from the previous value. Default is 00h.</td> </tr> <tr> <td>$6 3 : 1 8$</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> ### 9.5.4.5.2 Physical Layer Compliance Control 2 (Offsets 008h, 408h, 808h, and C08h from PHYOFF) <table> <caption>Table 9-79. Physical Layer Compliance Control 2 (Sheet 1 of 2)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>0</td> <td>RW</td> <td>Even UI Compare Mask @PHY-Compliance, if this bit is set, any compare results for even UIs are masked (i.e., not counted toward error in per Lane or aggregate comparison (see Section 4.4)), where Even UI refers as to a Unit Interval data eye, the first data UI and · $O b = N o \quad e v e n \quad U I \quad c o m p a r e \quad r e s u l t \quad m a s k i n g$ • Default is 0b.</td> </tr> <tr> <td>1</td> <td>RW</td> <td>Odd UI Compare Mask @PHY-Compliance, if this bit is set, any compare results for odd UIs are masked (i.e., not counted toward error in per Lane or aggregate comparison (see Section 4.4)), where Odd UI refers as to a Unit Interval data eye, the second data UI and every subsequent alternate UI). · Ob = No odd UI compare result masking compare results masked $D e f a u l t \quad i s \quad 0 b .$</td> </tr> <tr> <td>2</td> <td>RW</td> <td>Track Enable If @PHY-Compliance { If this bit is set, Track Transmission is enabled during one of the operations set by Section 5.5.1. `PHY compliance operation type'. Track transmission complies with descriptions in } Else { The appropriate sideband handshakes as described in Section 4.6 needs to be followed irrespective of the value of this bit }</td> </tr> <tr> <td>3</td> <td>RW</td> <td>Compare Setup · Ob = Aggregate comparison · 1b = Per Lane comparison Default is 0b. See Section 4.4 for more details.</td> </tr> <tr> <td>4</td> <td>RW</td> <td>Group A UI Compare Mask This field is applicable if @PHY-Compliance and for an operating data rate &gt; 32 GT/s only. If this bit is set to 1, any compare results for Group A UIs are masked (i.e., not counted toward error in per-Lane nor aggregate comparison (see Section 4.4)), where Group A UI refers to a Unit Interval data $\mathrm { e y e } ,$ the 1st data UI and every subsequent 4th UI. · 0 = No Group A UI compare result masking · 1 = Group A UI compare result is masked Default is 0.</td> </tr> <tr> <td>5</td> <td>RW</td> <td>Group B UI Compare Mask This field is applicable if @PHY-Compliance and for an operating data rate &gt; 32 GT/s only. If this bit is set to 1, any compare results for Group B UIs are masked (i.e., not counted toward error in per-Lane nor aggregate comparison (see Section 4.4)), where Group B UI refers to a Unit Interval data eye, the 2nd data UI and every subsequent 4th UI. · 0 = No Group B UI compare result masking · 1 = Group B UI compare result is masked Default is 0.</td> </tr> </table> <table> <caption>Table 9-79. Physical Layer Compliance Control 2 (Sheet 2 of 2)</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>6</td> <td>RW</td> <td>Group C UI Compare Mask This field is applicable if @PHY-Compliance and for an operating data rate &gt; 32 GT/s only. If this bit is set to 1, any compare results for Group C UIs are masked (i.e., not counted toward error in per-Lane nor aggregate comparison (see Section 4.4)), where Group C UI refers to a Unit Interval data eye, the 3rd data UI and every subsequent 4th UI. · 0 = No Group C UI compare result masking · 1 = Group C UI compare result is masked Default is 0.</td> </tr> <tr> <td>7</td> <td>RW</td> <td>Group D UI Compare Mask This field is applicable if @PHY-Compliance and for an operating data rate &gt; 32 GT/s only. If this bit is set to 1, any compare results for Group D UIs are masked (i.e., not counted toward error in per-Lane nor aggregate comparison (see Section 4.4)), where Group D UI refers to a Unit Interval data eye, the 4th data UI and every subsequent 4th UI. · 0 = No Group D UI compare result masking · 1 = Group D UI compare result is masked Default is 0.</td> </tr> <tr> <td>31:8</td> <td>RsvdP</td> <td>Reserved</td> </tr> </table> <table> <caption>$9 . 5 . 4 . 5 . 3$ Physical Layer Compliance Status 1 (Offsets 010h, 410h, 810h, and C10h from PHYOFF) Table 9-80. Physical Layer Compliance Status 1</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>0</td> <td>$R O$</td> <td>PHY in Compliance mode If (@PHY-Compliance) 1b. Else 0b.</td> </tr> <tr> <td>1</td> <td>RO</td> <td>PHY Compliance operation status If (@PHY-Compliance) { This bit is set to 1b if 'PHY compliance operation type' in 'Physical Layer Compliance Control 1' register is 001b, 010b, 011b, or 100b and hardware has performed the required operation. Else the bit is cleared to 0b. }</td> </tr> <tr> <td>$3 : 2$</td> <td>RW1C</td> <td>Rx Vref Offset Operation Status @PHY-Compliance: · 00b = Device does not support applying any Rx Vref Offset value · 01b = 'Rx Vref Offset' has not been applied · 10b = Rx Vref Offset has been successfully applied . 11b = When any of the following conditions are met: - Did not apply 'Rx Vref Offset' as the resulting value exceeds the value supported by hardware - Applied the requested setting and the test failed (i.e., Link training failed) Default is 00b.</td> </tr> <tr> <td>31:4</td> <td>RsvdZ</td> <td>Reserved</td> </tr> </table> #### $9 . 5 . 4 . 5 . 4$ Physical Layer Compliance Status 2 (Offsets 018h, 418h, 818h, and C18h from PHYOFF) <table> <caption>Table 9-81. Physical Layer Compliance Status 2</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>$3 1 : 0$</td> <td>RW1C</td> <td>Aggregate Error Count @PHY-Compliance, this is the Error count of aggregate error comparison when 'PHY Compliance Operation Type' is 001b or 011b (performing point tests). Default is 0000 0000h.</td> </tr> <tr> <td>39:32</td> <td>$R O$</td> <td>Supported Rx Vref Range Up Max step count supported up from the trained Rx Vref value for Vref margining.</td> </tr> <tr> <td>47:40</td> <td>RO</td> <td>Supported Rx Vref Range Down Max step count supported down from the trained Rx Vref value for Vref margining.</td> </tr> <tr> <td>$5 5 : 4 8$</td> <td>RO</td> <td>{ \text { Trained Value for Rx Vref } }<br>{ \text { Rx Vref as trained, in resolution counts .$</td> </tr> <tr> <td>$6 3 : 5 6$</td> <td>$R O$</td> <td>Vref Step Count Resolution Increase in Vref value in mV between two consecutive encodings in ascending order.</td> </tr> </table> ### $9 . 5 . 4 . 5 . 5$ Physical Layer Compliance Status 3 (Offsets 020h, 420h, 820h, and C20h from PHYOFF) <table> <caption>Table 9-82. Physical Layer Compliance Status 3</caption> <tr> <th>Bit</th> <th>Attributes</th> <th>Description</th> </tr> <tr> <td>$6 3 : 0$</td> <td>RO</td> <td>Per Lane Comparison Result Per Lane comparison result in PHY Compliance when 'PHY Compliance Operation Type' is 001b or 011b (performing point tests) and `Comparison Setup' is 1b (Per Lane comparison). [63:0]: Compare Results of all Logical Data Lanes (0h $\text { Fail \left(Errors> Max Error Threshold\right), }<br>\mathrm { P a s s } \left( \mathrm { E r r o r s } < = \mathrm { M a x } \mathrm { E r r o r } \mathrm { T h r e s h o l d } \right) UCIe-A {RD_L [63], RD_L [62], ... , RD_L [1], RD_L [0]} UCIe-A x32 {32'h0, RD_L [31], RD_L [30], ... , RD_L [1], RD_L [0]} UCIe-S {48'h0, RD_L [15], RD_L [14], ... , RD_L [1], RD_L [0]} Default is all 0s.</td> </tr> </table> ### 9.5.5 Implementation Specific Register Blocks These are left to be vendor defined. There is a separate implementation specific register Block for D2D Adapter and PHY. These register blocks should carry the same header as defined in Table 9-26, at offset Oh of the register block. And the VendorID should be set to the specific vendor's ID and the 'VendorID register block' field set to 2h or 3h to indicate that it is a vendor specific register block. The other fields in that header are set by the vendor to track their revision number and the block length. Max length cannot exceed 1MB in size and length is always in multiples of 4KB. Implementations are highly encouraged to pack registers and reduce length of the region as much as possible. #### 9.6 UCIe Link Registers in Streaming Mode and System SW/ FW Implications ##### IMPLEMENTATION NOTE While the SW view of Protocol Layer for streaming protocols is implementation- specific, it is strongly recommended that UCIe link-related registers defined in this chapter be implemented as-is for streaming mode solutions as well. If a streaming mode solution chooses to support the industry-standard PCIe hierarchical tree model for enumeration/control, it must be compliant with the enumeration model and registers defined in this chapter. A UCIe port in such an implementation would expose UCIe link registers consistent with the RP/DSP or EP/USP functionality it represents. In some streaming mode solutions, it might be desirable to implement UCIe link as a fully symmetric link, such as in a Symmetric Multi-Processing system that uses UCIe as a D2D interconnect. In such solutions, there is no notion of Upstream Port or Downstream Port on a UCIe link and also typically system firmware knows the D2D link connections a priori and it is able to configure them without requiring any "link discovery" mechanisms. It is recommended that both ends of the link implement UCIe registers defined for a Root Port, in such streaming mode solutions. Note that in this model, several link-related features become fully symmetric as well. For example, link training, mailbox trigger, and direct link-event/error reporting to Software are now possible from either end of the link. Whether such symmetric UCIe links are exposed to OS for native management, or system FW fully manages these links, is a system-architecture choice. Exposing such links natively to the OS could be in the form of exposing each side as an ACPI device or in the form of an FW intermediary that emulates a traditional PCIe hierarchical tree model for the symmetric link. Such choices are implementation-specific and could depend on the extent of OS support for symmetric topology. ###### 9.7 MSI and MSI-X Capability in Hosts/Switches for UCIe Interrupt Follow the base spec for details, but MSI/MSI-X capability implemented in host and switch must request 2 vectors for UCIe usage - 1 for Link status events and 1 for Link error events. Note that in MSI scenario, OS might not always allot both the requested vectors and in that case both the Link Status and Link error events use the same MSI vector number. The MSI designs must also support the Pending and Mask bits. MSI capability in UiRB must always set the 'Next Capability Pointer' field to 0h. SW must check for a value of 0005h in Bytes 0 and 1 of a capability to infer that it is an MSI capability. SW must terminate the capability linked list in UiRB when it sees the MSI Capability. ####### 9.8 UCIe Early Discovery Table (UEDT) <table> <caption>Table 9-83. UEDT Header</caption> <tr> <th>Field</th> <th>Byte Offset</th> <th>$L e n g t h$</th> <th>Description</th> </tr> <tr> <td>Signature</td> <td>00h</td> <td>4</td> <td>Signature for the UCIe Early Discovery Table (UEDT).</td> </tr> <tr> <td>Length</td> <td>04h</td> <td>4</td> <td>Length, in bytes, of the entire UEDT.</td> </tr> <tr> <td>Revision</td> <td>08h</td> <td>1</td> <td>Value is 1h for the first UCIe instance.</td> </tr> <tr> <td>Checksum</td> <td>09h</td> <td>1</td> <td>Entire table must sum to 0.</td> </tr> <tr> <td>OEM ID</td> <td>0Ah</td> <td>6</td> <td>OEM ID</td> </tr> <tr> <td>OEM Table ID</td> <td>10h</td> <td>8</td> <td>Manufacturer Model ID</td> </tr> <tr> <td>OEM Revision</td> <td>18h</td> <td>4</td> <td>OEM Revision</td> </tr> <tr> <td>Creator ID</td> <td>1Ch</td> <td>4</td> <td>Vendor ID of the utility that created this table.</td> </tr> <tr> <td>Creator Revision</td> <td>20h</td> <td>4</td> <td>Revision of the utility that created this table.</td> </tr> <tr> <td>UEDT Structure[n]</td> <td>24h</td> <td>Varies</td> <td>A list of UEDT structures for this implementation. · 0h = UCIe Link structure (UCLS) . All other encodings are reserved</td> </tr> </table> <table> <caption>Table 9-84. UCIe Link Structure (UCLS)</caption> <tr> <th>Field</th> <th>Byte Offset</th> <th>Length in Bytes</th> <th>Description</th> </tr> <tr> <td>Type</td> <td>00h</td> <td>1</td> <td>Signature for the UCIe Early Discovery Table (UEDT).</td> </tr> <tr> <td>Revision</td> <td>01h</td> <td>1</td> <td>Value is 1h for the first UCLS definition.</td> </tr> <tr> <td>Record Length</td> <td>02h</td> <td>2</td> <td>Length of this record, in bytes.</td> </tr> <tr> <td>UID</td> <td>04h</td> <td>4</td> <td>Host Bridge Unique ID. Used to associate a UCLS instance with a Host Bridge instance. The value of this field shall match the output of UID under the associated Host Bridge in ACPI namespace.</td> </tr> <tr> <td>UCIe Stack Size</td> <td>08h</td> <td>4</td> <td>· $1 h = O n e \quad R P$ · 2h = Two RPs</td> </tr> <tr> <td>Reserved</td> <td>0Ch</td> <td>4</td> <td>Reserved</td> </tr> <tr> <td>Base</td> <td>10h</td> <td>8</td> <td>Base address of UiRB, aligned to a 4-KB boundary.</td> </tr> <tr> <td>Length</td> <td>18h</td> <td>8</td> <td>$\tan$ anywhere from 12 KB to 2 MB, in multiples</td> </tr> <tr> <td>$D F 1$</td> <td>$2 0 h$</td> <td>1</td> <td>Device Function of the PCIe/CXL RP 1 associated with the UCLS.</td> </tr> <tr> <td>DF2</td> <td>21h</td> <td>1</td> <td>Device Function of the PCIe/CXL RP 2 (if multi-stack implementation) associated with the UCLS.</td> </tr> </table> ####### 10.0 Interface Definitions This chapter will cover the details of interface operation and signal definitions for the Raw Die-to-Die Interface (RDI), as well as the Flit-Aware Die-to-Die Interface (FDI). Common rules across RDI and FDI are covered as a separate section. The convention used in this chapter is that "assertion" of a signal is for Ob to 1b transition, and "de-assertion" of a signal is for 1b to Ob transition. A "pulse" of "n" cycles for a signal is defined as an event where the signal transitions from 0b to 1b, stays 1b for "n" clock cycles, and subsequently returns to Ob. A receiver sampling this signal on the same clock as the transmitter will see it being asserted for "n" clock cycles. If a value of "n" is not specified, it is interpreted as a value of one. In the context of error signals defined as pulses, the receiving logic for error logging must treat the rising edge as a new event indication and not rely on the length of the pulse. In this chapter, interface reset/domain reset also applies to all forms of Conventional Reset defined in PCIe Base Specification, if the Protocol is PCIe or CXL. In the sections that follow, "UCIe Flit mode" refers to scenarios in which the Link is not operating in Raw Format, and "UCIe Raw Format" or "Raw Format" refers to scenarios in which the Link is operating in Raw Format. ######## 10.1 Raw Die-to-Die Interface (RDI) This section defines the signal descriptions and functionality associated with a single instance of Raw Die-to-Die Interface (RDI). A single instance could be used for a configuration associated with a single Die-to-Die module (i.e., one Die-to-Die Adapter for one module), or a single instance is also applicable for configurations where multiple modules are grouped together for a single logical Die-to- Die Link (i.e., one Die-to-Die Adapter for multiple modules). Figure 10-1 shows example configurations using RDI. <figure> <figcaption>Figure 10-1. Example configurations using RDI</figcaption> Die-to-Die Adapter $D i e - t o - D i e$ Adapter $R D I$ $R D I$ Physical Layer (single module) Multi-module PHY Logic (two modules) $A F E$ Module 0 AFE/PHY Logic Module 1 AFE/PHY Logic (a) (b) Die-to-Die Adapter $R D I$ Multi-module PHY Logic (four modules) Module 0 AFE/PHY Logic Module 1 AFE/PHY Logic Module 2 AFE/PHY Logic Module 3 AFE/PHY Logic (c) </figure> Table 10-1 lists the RDI signals and their descriptions. In Table 10-1: . $p l \_ *$ indicates that the signal is driven away from the Physical Layer to the Die-to-Die Adapter. . lp * indicates that the signal is driven away from the Die-to-Die Adapter to the Physical Layer. <table> <caption>Table 10-1. RDI signal list (Sheet 1 of 5)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>$l c l k$</td> <td>The clock at which RDI operates.</td> </tr> <tr> <td>$l p \_ i r d y$</td> <td>Adapter to Physical Layer signal indication that the Adapter has data to send. This must be asserted if lp_valid is asserted and the Adapter wants the Physical Layer to sample the data. lp_irdy must not be presented by the Adapter when pl_state_sts is Reset except when the status transitions from LinkError to Reset. On a LinkError to Reset transition, it is permitted for lp_irdy to be asserted for a few clocks but it must be de-asserted eventually. Physical Layer must ignore lp_irdy when status is Reset.</td> </tr> <tr> <td>lp_valid</td> <td>Adapter to Physical Layer indication that data is valid on the corresponding lp_data bytes.</td> </tr> <tr> <td>$l p \_ d a t a \left[ N B Y T E S - 1 : 0 \right] \left[ 7 : 0 \right]$</td> <td>Layer data, where 'NBYTES' equals number of bytes determined by the</td> </tr> <tr> <td>lp_retimer_crd</td> <td>$W h e n \quad a s s e r t e d \quad a t \quad a \quad r i s i n g \quad c l o c k \quad e d g e , i t \quad i n d i c a t e s \quad a \quad s i n g l e \quad c r e d i t \quad r e t u r n \quad f r o m \quad t h e \quad A d a p t e r \quad t o$ the mainband data. This signal must NOT assert for dies that are not UCIe Retimers.</td> </tr> <tr> <td>$p l \_ t r d y$</td> <td>The Physical Layer is ready to accept data. Data is accepted by the Physical Layer when pl_trdy, lp_valid, and lp_irdy are asserted at the rising edge of lclk. This signal must only be asserted if pl_state_sts is Active or when performing the pl_stallreq/lp_stallack handshake when the pl_state_sts is LinkError (see Section 10.3.3.7).</td> </tr> <tr> <td>pl_valid</td> <td>Physical Layer to Adapter indication that data is valid on pl_data.</td> </tr> <tr> <td>pl_data [NBYTES-1 : 0] [7: 0]</td> <td>Physical Layer to Adapter data, where NBYTES equals the number of bytes determined by the data width for the RDI instance.</td> </tr> </table> <table> <caption>Table 10-1. RDI signal list (Sheet 2 of 5)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>pl_retimer_crd</td> <td>When asserted at a rising clock edge, it indicates a single credit return from the Retimer to the Adapter. Each credit corresponds to 256B of mainband data. This signal must NOT assert if the remote Link partner is not a Retimer.</td> </tr> <tr> <td rowspan="3">lp_state_req [3: 0]</td> <td>Adapter request to Physical Layer to request state change. Encodings as follows:</td> </tr> <tr> <td>{ 0 0 0 0 b : N O P }<br>{ 0 0 0 1 b : A c t i v e } 1001b: LinkReset</td> </tr> <tr> <td>1011b: Retrain 0100b: L1 1100b: Disabled 1000b: L2 All other encodings are reserved.</td> </tr> <tr> <td>lp_linkerror</td> <td>Adapter to Physical Layer indication that an error has occurred which requires the Link to go down. Physical Layer must move to LinkError state and stay there as long as The reason for having this be an indication decoupled from regular { \text { 1p 1 inkerror=1 } }<br>{ \text { state transitions is t } } allow immediate action on part of the Adapter and Physical Layer in order to provide the quickest path for error containment when applicable (for example, a viral error escalation must map to the LinkError state). The Adapter must OR internal error conditions with lp_linkerror received from Protocol Layer on FDI.</td> </tr> <tr> <td rowspan="4">pl_state_sts [3: 0]</td> <td>Physical Layer to Adapter Status indication of the Interface. Encodings as follows:</td> </tr> <tr> <td>0000b: Reset 1001b: LinkReset</td> </tr> <tr> <td>0001b: Active 1010b: LinkError</td> </tr> <tr> <td>0011b: Active.PMNAK 1011b: Retrain 0100b: L1 1100b: Disabled 1000b: L2 All other encodings are reserved. The status signal is permitted to transition from Physical Layer autonomously when applicable. For example the Physical Layer asserts the Retrain status when it decides to enter retraining either autonomously or when requested by remote agent.</td> </tr> <tr> <td>pl_inband_pres</td> <td>Physical Layer to the Adapter indication that the Die-to-Die Link has finished training and is ready for RDI transition to Active and Stage 3 of bring up. Once it transitions to 1b, this must stay 1b until Physical Layer determines the Link is down (i.e., the Link Training State Machine transitions to TrainError or Reset).</td> </tr> </table> <table> <caption>Table 10-1. RDI signal list (Sheet 3 of 5)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>pl_error</td> <td>Physical Layer to the Adapter indication that it has detected a framing related error which is recoverable through Link Retrain. An example is where the Physical Layer received an invalid encoding on the Valid Lane. It is a pulse of one or more cycles that must occur only when RDI is in Active state. It is permitted to de-assert at the same clock edge where the state transitions away from Active state. It is pipelined with the receive data path such that the error indication reaches the Adapter before or at the same time as the corrupted data. Physical Layer is expected to go through Retrain flow after this signal has been asserted and it must not send valid data to Adapter until the Link has retrained. It is permitted for the Physical Layer to squash the pl_valid internally for the corrupted data. Once pl_error is asserted, pl_valid should not be asserted (without pl_error assertion in the same cycle) until the state status has transitioned to Active after Retrain entry and exit. { \text { If } p 1 \text { error=1 and } p 1 \text { val id } = 1 \text { in the same clock clorle, the Adater must dist dite } }<br>{ \text { correspondina Filt \left(even if it it only partially recived whed wror asser assrerted\right). } } In UCIe Flit mode, when retry is enabled, it is the responsibility of the Adapter to ensure data integrity for Flits forwarded to FDI, and that they are canceled following the rules of pl_flit_cancel if they are suspected of corruption (see Section 10.2). A couple of examples are given below: . For 68B Flit Format, the Adapter could discard partially received Flits, but in 256B Latency optimized modes, it could have processed one half correctly, and the error the other half, and so it has to track that and process future • { \text { mavaccordingly. } }<br>{ \text { Another example is is not doined berored receiving the remaing 64B of the 128B half, } }<br>{ \text { Another exrors happerd berore reciving the der dor dor dis ,$ it $\text { needs to send dumm } }<br>{ \text { half of the Flit. } } data $I n \quad U C I e \quad F l i t$ mode with Retry enabled for the Adapter, Retrain exit would naturally result in any partially received Flits eventually (see Section 3.8). $\mathrm { I n } \mathrm { U C I e } \mathrm { F l i t } \mathrm { m o d e r }$ with Retry disabled, the Adapter must map pl_error assertion to an Error and escalate it accordingly. If the Link is operating in Raw Format, the Adapter forwards pl_error to the Protocol Layer such that it is pipeline matched to the data bus, and Protocol Layer handles it in an implementation-specific manner.</td> </tr> <tr> <td>pl_cerror</td> <td>not { \text { Physical Layer to the Aabpter indication that a that a corrector elctable erracte detered the doetr } }<br>{ \text { enabled, the Adapter must oR the ple prinde and pl } }<br>{ \text { rnabled, the Adapter muust oR the errond sl } } $I n \quad U C I e \quad F l i t \quad m o d e \quad w i t h \quad R e t r y \quad d i s a b l e d \quad o r \quad w h e n \quad t h e \quad L i n k \quad i s \quad o p e r a t i n g \quad i n \quad R a w \quad F o r m a t , t h e$ cycles which can occur in any RDI state. If it is a state in which { \text { It is a pulse of one or more c } }<br>{ \text { clock gating is permited, it } } is the responsibility of the Physical Layer to perform the clock gating exit handshake with the Adapter before asserting this signal. Clock gating can resume once pl_cerror de-asserts and all other conditions permitting clock gating are satisfied.</td> </tr> <tr> <td>pl_nferror</td> <td>Physical Layer to the Adapter indication that a non-fatal error was detected. There is no architecturally defined error condition for the Physical Layer currently asserting this signal; however, the signal is provided on the interface for any implementation-specific non-fatal errors. The Adapter treats this in the same manner as when it received a Sideband Non- Fatal Error Message from the remote Link partner. It is a pulse of one or more cycles that can occur in any RDI state. If it is a state where clock gating is permitted, it is the responsibility of the Physical Layer to perform the clock gating exit handshake with the Adapter before asserting this signal. Clock gating can resume after pl_nferror is de-asserted and all other conditions permitting clock gating have been met.</td> </tr> <tr> <td>pl_trainerror</td> <td>Indicates a fatal error from the Physical Layer. Physical Layer must transition pl_state_sts to LinkError if not already in LinkError state. This must be escalated to upper Protocol Layers based on the mask and severity programming of Uncorrectable Internal Error in the Adapter. Implementations are permitted to map any fatal error to this signal that require upper layer escalation (or interrupt generation) depending on system-level requirements. It is a level signal that can assert in any RDI state but remains asserted until RDI exits the LinkError state to Reset state.</td> </tr> </table> <table> <caption>Table 10-1. RDI signal list (Sheet 4 of 5)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>pl_phyinrecenter</td> <td>Physical Layer indication to Adapter that the Physical Layer is training or retraining. If this is asserted during a state where clock gating is permitted, the pl_clk_req/lp_clk_ack handshake must be performed with the upper layer. The upper layers are permitted to use this to update the "Link Training/Retraining" bit in the UCIe Link Status register.</td> </tr> <tr> <td>pl_stallreq</td> <td>Physical Layer request to Adapter to align Transmitter at Flit boundary and not send any new Flits to prepare for state transition. See Section 10.3.2.</td> </tr> <tr> <td>lp_stallack</td> <td>Adapter to Physical Layer indication that the Flits are aligned and stalled (if pl_stallreq was asserted). It is strongly recommended that this response logic be on a global free running clock, so the Adapter can respond to pl_stallreq with lp_stallack even if other significant portions of the Adapter are clock gated. See Section 10.3.2.</td> </tr> <tr> <td rowspan="2">pl_speedmode $\left[ 2 : 0 \right]$</td> <td>Current Link speed. The following encodings are used:</td> </tr> <tr> <td>000b: 4 GT/s 100b: 24 GT/s 001b: 8 GT/s 101b: 32 GT/s 010b: 12 GT/s $1 1 0 b : 4 8 \quad G T / s$ 011b: 16 GT/s The Adapter must only consider this signal to be relevant when the RDI state is Active or Retrain. For multi-module configurations, all modules must operate at the same speed.</td> </tr> <tr> <td>pl_max_speedmode</td> <td>Negotiated Maximum Data Rate. The following encodings are used: 0: &lt;= 32 GT/s 1: &gt; 32 GT/s The Adapter must only consider this signal to be relevant when the RDI state transitions from Reset to Active. It indicates the negotiated maximum data rate by the Physical Layer during MBINIT.PARAM; thus, this signal can only change while RDI is in Reset state. The Adapter uses this signal to determine the negotiated maximum data rate before the Protocol Parameter exchange handshakes.</td> </tr> <tr> <td>pl_lnk_cfg[2:0]</td> <td>Current Link Configuration. Indicates the current operating width of a module. $0 0 0 b : x 4$ 100b: x64 x8 { 1 0 1 b : \times 1 2 8 }<br>{ 1 1 0 b : \times 2 5 6 } $0 1 0 b : x 1 6$ 011b: x32 other encodings are reserved. $m o d u l e s . F o r \quad U C I e - S \quad t h e \quad m a x i m u m \quad e n c o d i n g \quad w o u l d \quad b e \quad x 6 4 , f o r \quad U C I e - A \quad t h e \quad m a x i m u m$ The Adapter must only consider this signal to be relevant when the RDI state is Active or Retrain. This signal indicates the total width across all Active Modules corresponding to the RDI instance.</td> </tr> <tr> <td>$p l _ { - } c l k _ { - } r e q$</td> <td>Request from the Physical Layer to remove clock gating from the internal logic of the Adapter. This is an asynchronous signal relative to 1clk from the Adapter's perspective since it is not tied to 1clk being available in the Adapter. Together with 1p_clk_ack, it forms a four-way handshake to enable dynamic clock gating in the Adapter. When dynamic clock gating is supported, the Adapter must use this signal to exit clock gating before responding with lp_clk_ack. signal to 1b. If dynamic clock gating is not supported, it is permitted for the Physical Layer to tie this</td> </tr> <tr> <td>$1 p _ { - } c l k _ { - } a c k$</td> <td>Response from the Adapter to the Physical Layer acknowledging that its clocks have been ungated in response to pl_clk_req. This signal is only asserted when pl_clk_req is asserted, and de-asserted after pl_clk_req has de-asserted. When dynamic clock gating is not supported by the Adapter, it must stage pl_clk_req internally for one or more clock cycles and turn it around as 1p_clk_ack. This way it will still participate in the handshake even though it does not support dynamic clock gating.</td> </tr> <tr> <td>lp_wake_req</td> <td>Request from the Adapter to remove clock gating from the internal logic of the Physical Layer. This is an asynchronous signal from the Physical Layer's perspective since it is not tied to 1clk being available in the Physical Layer. Together with pl_wake_ack, it forms a four-way handshake to enable dynamic clock gating in the Physical Layer. When dynamic clock gating is supported, the Physical Layer must use this signal to exit clock gating before responding with pl_wake_ack. { \text { If dynami } }<br>{ \text { to } 1 h } clock gating is not supported, it is permitted for the Adapter to tie this signal</td> </tr> </table> <table> <caption>Table 10-1. RDI signal list (Sheet 5 of 5)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>pl_wake_ack</td> <td>Response from the Physical Layer to the Adapter acknowledging that its clocks have been ungated in response to lp_wake_req. This signal is only asserted after lp_wake_req has asserted, and is de-asserted after 1p_wake_req has de-asserted. When dynamic clock gating is not supported by the Physical Layer, it must stage lp_wake_req internally for one or more clock cycles and turn it around as pl_wake_ack. This way it will still participate in the handshake even though it does not support dynamic clock gating.</td> </tr> <tr> <td>$p l _ { n } c f g \left[ N C - 1 : 0 \right]$</td> <td>This is the sideband interface from the Physical Layer to the Adapter. See Chapter 7.0 for packet format details. NC is the width of the interface. Supported values are 8, 16, and 32. Register accesses must be implemented by hardware to be atomic regardless of the width of the interface (i.e., all 32 bits of a register must be updated in the same cycle for a 32-bit register write, and similarly all 64 bits of a register must be updated in the same cycle for a 64-bit register write).</td> </tr> <tr> <td>$p l _ { - } c f g _ { - } v l d$</td> <td>the Adapter. When asserted, indicates that pl_cfg has valid information that should be consumed by</td> </tr> <tr> <td>pl_cfg_crd</td> <td>Credit return for sideband packets from the Physical Layer to the Adapter for sideband data. Even transactions $t h a t \quad d o \quad n o t \quad c a r r y \quad d a t a \quad o r \quad c a r r y \quad 3 2 \quad b i t s \quad o f \quad d a t a \quad c o n s u m e \quad t h e \quad s a m e \quad c r e d i t \quad a n d \quad t h e \quad P h y s i c a l$ Layer returns the deallocated from its internal buffers. See Section 7.1.3.1 for additional flow control rules. A value of 1 sampled at a rising clock edge indicates a single credit return. Because the advertised credits are design parameters, the Adapter transmitter updates the credit counters with initial credits on domain reset exit, and no initialization credits are returned over the interface. Credit returns must follow the same rules of clock gating exit handshakes as the sideband packets to ensure that no credit returns are dropped by the receiver of the credit returns.</td> </tr> <tr> <td>$1 p _ { - } c f g \left[ N C - 1 : 0 \right]$</td> <td>This is the sideband interface from Adapter to the Physical Layer. See Chapter 7.0 for details. NC is the width of the interface. Supported values are 8, 16, and 32. Register accesses must be implemented by hardware to be atomic regardless of the width of the interface (i.e., all 32 bits of a register must be updated in the same cycle for a 32-bit register write, and similarly all 64 bits of a register must be updated in the same cycle for a 64-bit register write).</td> </tr> <tr> <td>$1 p _ { - } c f g _ { - } v l d$</td> <td>When asserted, indicates that lp_cfg has valid information that should be consumed by the Physical Layer.</td> </tr> <tr> <td>lp_cfg_crd</td> <td>Credit return for sideband packets from the Adapter to the Physical Layer for sideband packets. Each credit corresponds to 64 bits of header and 64 bits of data. Even transactions that do not carry data or carry 32 bits of data consume the same credit and the Adapter returns the credit once the corresponding transaction has been processed or deallocated from its internal buffers. See Section 7.1.3.1 for additional flow control rules. A value of 1 sampled at a rising clock edge indicates a single credit return. Because the advertised credits are design parameters, the Physical Layer transmitter updates the credit counters with initial credits on domain reset exit, and no initialization $C r e d i t \quad r e t u r n s \quad m u s t \quad f o l l o w \quad t h e \quad s a m e \quad r u l e s \quad o f \quad c l o c k \quad g a t i n g \quad e x i t \quad h a n d s h a k e s \quad a s \quad t h e \quad s i d e b a n d$</td> </tr> <tr> <td>pl_vendor_defined [VS-1 : 0]</td> <td>Optional Vendor Defined signals. See Section 10.3.4 for an example usage of these signals. If these signals are instantiated, but the UCIe stack is not operating in a mode that utilizes them, these signals should not assert.</td> </tr> <tr> <td>$1 p _ { - }$</td> <td>Optional Vendor Defined signals. See Section 10.3.4 for an example usage of these signals. If these signals are instantiated, but the UCIe stack is not operating in a mode that utilizes them, these signals should not assert.</td> </tr> </table> Signals in Table 10-2 apply only when supporting MPM over sideband. The choice for whether these signals run on the lclk or the Mgmt_Clk is implementation-specific. <table> <caption>Table 10-2. RDI Config interface extensions for Management Transport (Sheet 1 of 3)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>pm_param_done</td> <td>Management transport negotiation phase completed. Signal de-asserts after being asserted for two clocks. This signal asserts when MBINIT.PARAM management transport negotiation phase completes. Note that this signal is asserted even if MBINIT.PARAM Configuration or SBFE exchanges indicate no support for management transport in the partner chiplet.</td> </tr> <tr> <td>pm_param_local_count [N-1 : 0]</td> <td>Number of modules that successfully negotiated Management transport on transmit side. This field is sampled only when pm_param_done signal is asserted. $0 0 0 b : 0 \quad m o d u l e s$ 011b: 3 modules 001b: 1 module $1 0 0 b : 4 \quad m o d u l e s$ 010b: 2 modules Others: Reserved N=2 for 1, 2, or 3 modules scenarios, and N=3 for 4 modules scenario.</td> </tr> <tr> <td>pm_param_remote_count [N- 1:0]</td> <td>Number of modules that successfully negotiated Management transport on receive side. This field is sampled only when pm_param_done signal is asserted. 000b: 0 modules 011b: 3 modules 001b: 1 module 100b: 4 modules 010b: 2 modules Others: Reserved $N = 2 \text { for } 1 , 2 ,$</td> </tr> <tr> <td>mp_mgmt_init_done</td> <td>$I n d i c a t i o n \quad f r o m \quad M a n a g e m e n t \quad P o r t \quad G a t e w a y \quad t h a t \quad i n i t i a l i z a t i o n \quad p h a s e \quad c o m p l e t e d$ (successfully or unsuccessfully). machine state beyond MBINIT.PARAM, if other conditions allow. Signal de-asserts after being asserted for two clocks. The PHY should not depend on this signal for advancing the state machine when the management path is already up or when the partner chiplet indicated no support for management transport.</td> </tr> <tr> <td>mp_mgmt_init_start</td> <td>A two-clock trigger pulse from Management Port Gateway to PHY to start negotiation on the sideband links. Management Port Gateway must ensure that the mp_mgmt_up de-asserted when this signal is pulsed. This signal forces the link state machine $t o \quad R E S E T$ state (if it is not already there) and hence can bring the mainband link down $\lim k .$ The standard TRAINERROR flow applies here as well for transitioning signal is pulsed. to RESET if the state machine is not already in that state when this</td> </tr> <tr> <td>mp_mgmt_up</td> <td>Indication from Management Port Gateway that is signaled along with mp_mgmt_init_done, that Management Transport Initialization Phase completed successfully (mp_mgmt_up=1) or unsuccessfully (mp_mgmt_up=0). This is used by PHY to set the SB_MGMT_UP flag.</td> </tr> <tr> <td>mp_mgmt_port_gateway_ready</td> <td>Indication to PHY that Management Port Gateway is ready for management transport path initialization. The PHY uses this as one of the conditions to trigger or respond to a trigger for Management Transport path initialization. This asserts after the Management Port Gateway is ready for management path setup after Management Reset. Once asserted, this signal de-asserts on a Management Port Gateway reset (either because of management domain reset or after a heartbeat timeout or an 'Init Done' Timeout or any fatal error on sideband) condition.</td> </tr> <tr> <td>mp_stall_after_mbinit_param</td> <td>Management Port Gateway asserts this signal concurrent with asserting mp_mgmt_port_gateway_ready to indicate to the PHY that it must stall the training on the receive side using an {MBINIT.PARAM SBFE resp} sideband message stall encoding as described in Section 4.5.3.3.1.2. This signal remains asserted until the MPG determines that stalling is no longer necessary (i.e., that it is okay for link initialization to proceed). When de-asserted, the receive side training does not cause a "stall". When a sideband-only link is negotiated, this signal is not used by the PHY to determine the Link training state machine progress.</td> </tr> </table> <table> <caption>Table 10-2. RDI Config interface extensions for Management Transport (Sheet 2 of 3)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>pm_cfg_credit [N-1: 0]</td> <td>This is credit return for the Flow control buffers over RDI (see Section 8.2.5.1.1) used by the Management Port Gateway to transmit management packets to the remote Management Port Gateway. Each credit corresponds to 64 bits of buffer space. Physical Layer returns the credit once the corresponding transaction has been deallocated from its internal buffers. See Section 8.2.5.1.1 for additional flow control rules. Because the advertised credits are design parameters, the Management Port Gateway transmitter updates the credit counters with initial credits on Management reset exit or on 'Heartbeat timeout', and no initialization credits are returned over the interface for these conditions. Credit returns must follow the same rules of clock gating exit handshakes as the sideband packets to are dropped by the receiver of the credit returns. $\text { There is a signal per } R \times Q - I D$ in the design and hence N can be 1, 2, 3, or 4.</td> </tr> <tr> <td>mp_rxqid [N-1 : 0]</td> <td>{ \text { RxQ-ID associated with the message. Has meaning when men men men rignal is } }<br>{ \text { asserted on a RDI transfer. Used by PHY to steer the packt to the corret SB link. } } On encapsulated MTPs and PM Req messages, this carries the far-end Rx queue's RxQ- ID. On Credit return, Init Done and PM Ack messages this carries the RxQ-ID of the local $N \quad i s \quad e i t h e r \quad 2 \left( f o r \quad 4 \quad m o d u l e s \quad l i n k s \quad s c e n a r i o s \right) o r \quad 1 \left( 1 \quad o r \quad 2 \quad m o d u l e s \quad l i n k s \quad s c e n a r i o s \right) . T h e r e$ is a fixed mapping in the negotiation on the { \text { transmit side. The chosen SB link a given Ror a ginen the must be onf the sine that } }<br>{ \text { successfully trained for managent transport on the transmit side } }</td> </tr> <tr> <td>$p m \_ r x q i d \left[ N - 1 : 0 \right]$</td> <td>RxQ-ID associated with the message. Has meaning when pm_mgmt_pkt signal is asserted on a RDI transfer. Used by Management Port Gateway to internally steer the packet to the correct RxQ. N is either 2 (for 4 modules/sideband-only links scenarios) or 1 (1 or 2 modules/ sideband-only links scenarios). Valid for all MPM config bus transmissions. PHY uses the link to drive $t h e s e \quad s i g n a l s \quad o n \quad c o n f i g \quad i n t e r f a c e . T h e s e \quad s i g n a l s \quad a r e \quad u n d e f i n e d \quad f o r \quad S o C \quad C a p a b i l i t i e s$</td> </tr> <tr> <td>mp_wake_req</td> <td>Request from the Management Port Gateway to remove clock gating from the internal logic of the Physical Layer that handles management transport traffic. This is an asynchronous signal from the Physical Layer's perspective since it is not tied to Iclk being available in the Physical Layer. Together with pm_wake_ack, it forms a four-way handshake to enable dynamic clock gating in the Physical Layer for logic that handles management transport traffic. This handshake is independent of any RDI state-related clock gating rules. When dynamic clock gating is supported, the Physical Layer must use this signal to exit clock gating before responding with pm_wake_ack. If dynamic clock gating is not supported, Management Port Gateway must tie this signal to 1.</td> </tr> <tr> <td>pm_wake_ack</td> <td>Response from the Physical Layer to the Management Port Gateway acknowledging that its clocks have been ungated in response to mp_wake_req. This signal is only asserted asserted. after mp_wake_req has asserted, and is de-asserted after mp_wake_req has de- When dynamic clock gating is not supported by the Physical Layer, it must stage mp_wake_req internally for one or more clock cycles and turn it around as pm_wake_ack. This way it will still participate in the handshake even though it does not support dynamic clock gating.</td> </tr> <tr> <td>$\mathrm { p m } _ { - } \mathrm { c l k } _ { - } \mathrm { r e q }$</td> <td>Request from the Physical Layer to remove clock gating from the internal logic of the Management Port Gateway. This is an asynchronous signal relative to lclk/Mgmt_clk from the Management Port Gateway perspective because it is not tied to 1clk/ Mgmt_clk being available in the Management Port Gateway. This handshake is independent of any RDI state-related clock gating rules. Together with mp_clk_ack, it forms a four-way handshake to enable dynamic clock gating in the Management Port Gateway. When dynamic clock gating is supported, the Management Port Gateway must use this signal to exit clock gating before responding { \text { with mp } - c 1 k }<br>{ \text { siqnal to } 1 .$ If dynamic clock gating is not supported, Physical Layer must tie this</td> </tr> </table> <table> <caption>Table 10-2. RDI Config interface extensions for Management Transport (Sheet 3 of 3)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>mp_clk_ack</td> <td>Response from the Management Port Gateway to the PHY acknowledging that its clocks have been ungated in response to pm_clk_req. This signal is asserted only when pm_clk_req is asserted, and de-asserted after pm_clk_req has de-asserted. When dynamic clock gating is not supported by the Management Port Gateway, it must stage pm_clk_req internally for one or more clock cycles and turn it around as mp_clk_ack. This way it will still participate in the handshake even though it does not support dynamic clock gating. When supporting dynamic clock gating of the Management Port Gateway, PHY must ensure that pulsed signals (e.g., pm_param_done), are delivered only after the mp_clk_ack is set to ensure that the Management Port Gateway saw those pulses.</td> </tr> <tr> <td>mp_mgmt_pkt</td> <td>During a valid RDI data transfer to PHY, this signal indicates whether the transfer is for an MPM. 0: Link management packet. 1: MPM. Used by PHY to steer the packet to the correct RDI credit buffer.</td> </tr> <tr> <td>pm_mgmt_pkt</td> <td>During a valid RDI data transfer from PHY, this signal indicates whether the transfer is for an MPM. 0: Link management packet. D2D Adapter. 1: MPM. Used by the Management Port Gateway to steer the packet to RxQ buffers or to</td> </tr> <tr> <td>pm_so</td> <td>When asserted, indicates to Management Port Gateway that SO mode was negotiated. On ports that have sideband-only link physically present, this can be tied off to 1.</td> </tr> <tr> <td>Mgmt_clk</td> <td>Optional clock used for the Configuration interface on the RDI for implementations in which the main RDI clock is not available for Management Transport path initialization.</td> </tr> <tr> <td>pm_fatal_error</td> <td>Set by any sideband link fatal error indication, such as parity error on a sideband packet. Cleared by a Management Reset.</td> </tr> <tr> <td>mp_fatal_error</td> <td>Used by Management Port Gateway to instruct the PHY to transition to TRAINERROR state. This is a two-clock pulse.</td> </tr> </table> ### 10.1.1 Interface reset requirements RDI does not define a separate interface signal for reset; however, it is required that the logic entities on both sides of RDI are in the same reset domain and the reset for each side is derived from the same source. Because reset may be staggered due to SoC routing, all signals coming out of reset must be driven to 0, unless otherwise specified. ### 10.1.2 Interface clocking requirements RDI requires both sides of the interface to be on the same clock domain. The sideband interface includes the pl_cfg, pl_cfg_vld, pl_cfg_crd, lp_cfg, lp_cfg_vld, and lp_cfg_crd signals. If Management Transport is not supported over sideband, all signals are synchronous to lclk. When Management Transport is supported, the sideband interface as well as the signals in Table 10-2 are permitted to be on a separate Mgmt_clk domain. For example, this Mgmt_clk can be the auxiliary clock so that the management transport is available over the sideband even if the clocks required for the mainband and for lclk are unavailable. Each side is permitted to internally instantiate clock-crossing FIFOs if needed, as long as it does not violate the requirements at the interface itself. It is important to note that back pressure is not possible from the Adapter to the Physical Layer on the main data path. So any clock-crossing-related logic internal to the Adapter must take this into consideration. For example, for a 64-Lane module with a maximum speed of 16 $\mathrm { G T } / \mathrm { s } ,$ the RDI could be 64B wide running at 2 GHz to be exactly bandwidth matched. ### 10.1.3 Dynamic clock gating Dynamic coarse clock gating is permitted in the Adapter and Physical Layer when pl_state_sts is Reset, LinkReset, Disabled, or PM. This section defines the rules around entry and exit of clock gating. Note that clock gating is not permitted in LinkError state; it is expected that for UCIe usages, error handlers will be enabled to make sure the Link is not stuck in LinkError state if the intent is save power for Links in error state. ### 10.1.3.1 Rules and description for lp_wake_req/pl_wake_ack handshake Adapter can request removal of clock gating of the Physical Layer by asserting lp_wake_req (asynchronous to lclk availability in the Physical Layer). All Physical Layer implementations must respond with a pl_wake_ack (synchronous to lclk). The extent of internal clock ungating when pl_wake_ack is asserted is implementation-specific, but lclk must be available by this time to enable RDI signal transitions from the Adapters. The Wake Req/Ack is a full handshake and it must be used for state transition requests (on lp_state_req or lp_linkerror) when moving away from a state in which clock gating is permitted. It must also be used for sending packets on the sideband interface. Rules for this handshake: 1\. Adapter asserts lp_wake_req to request ungating of clocks by the Physical Layer. 2\. The Physical Layer asserts pl_wake_ack to indicate that clock gating has been removed. There must be at least one clock cycle bubble between lp_wake_req assertion and pl_wake_ack assertion. 3\. lp_wake_req must de-assert before pl_wake_ack de-asserts. It is the responsibility of the Adapter to control the specific scenario of de-assertion. As an example, when performing the handshake for a state request, it is permitted to keep lp_wake_req asserted until it observes the desired state status. Adapter is also permitted to keep lp_wake_req asserted through states where clock gating is not permitted in the Physical Layer (i.e., Active, LinkError, or Retrain). 4\. lp_wake_req should not be the only consideration for Physical Layer to perform clock gating, it must take into account pl_state_sts and other internal or Link requirements before performing global and/or local clock gating. 5\. When performing lp_wake_req/pl_wake_ack handshake for lp_state_req transitions or lp_linkerror transition, the Adapter is permitted to not wait for pl_wake_ack before changing lp_state_req or lp_linkerror. 6\. When performing lp_wake_req/pl_wake_ack handshake for lp_cfg transitions, Adapter must wait for pl_wake_ack before changing lp_cfg or lp_cfg_vld. Because lp_cfg can have multiple transitions for a single packet transfer, it is necessary to make sure that the Physical Layer clocks are up before transfer begins. ### 10.1.3.2 Rules and description for pl_clk_req/lp_clk_ack handshake Physical Layer is permitted to initiate pl_clk_req/lp_clk_ack handshake at any time and the Adapter must respond. Rules for this handshake: 1\. Physical Layer asserts pl_clk_req to request removal of clock gating by the Adapter. This can be done anytime, and independent of current RDI state. 2\. The Adapter asserts lp_clk_ack to indicate that clock gating has been removed. There must be at least one clock cycle bubble between pl_clk_req assertion and lp_clk_ack assertion. 3\. pl_clk_req must de-assert before lp_clk_ack. It is the responsibility of the Physical Layer to control the specific scenario of de-assertion, after the required actions for this handshake are completed. 4\. pl_clk_req should not be the only consideration for the Adapter to perform clock gating, it must take into account pl_state_sts and other protocol-specific requirements before performing trunk and/or local clock gating. 5\. The Physical Layer must use this handshake to ensure transitions of pl_inband_pres have been observed by the Adapter. Because pl_inband_pres is a level-oriented signal (once asserted, pl_inband_pres remains asserted during the lifetime of Link operation), the Physical Layer is permitted to let pl_inband pres transition without waiting for 1p_clk_ack. When this is done during initial Link bring up, it is strongly recommended for the Physical Layer to keep pl_clk_req asserted until the state status transitions away from Reset to a state where clock gating is not permitted. It is permitted for pl_inband_pres to assert before OR after pl_clk_req asserts; however, pl_inband_pres assertion is not guaranteed to be observed by the Adapter until the pl_clk_req/lp_clk_ack handshake is complete. <figure> <figcaption>Figure 10-2. Example Waveform Showing Handling of Level Transition</figcaption> 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 lclk pl_clk_req lp_clk_ack 11 pl_inband_pres </figure> 6\. The Physical Layer must also perform this handshake before transition to LinkError state from Reset or PM state (when the LinkError transition occurs by the Physical Layer without being directed by the Adapter). It is permitted to assert pl_clk_req before the state change, in which case it must stay asserted until the state status transitions. It is also permitted to assert pl_clk_req after the state status transition, but in this case Physical Layer must wait for lp_clk_ack before performing another state transition. 7\. The Physical Layer must also perform this handshake when the status is PM and remote Link partner is requesting PM exit. For exit from Reset or PM states to a state that is not LinkError, it is required to assert pl_clk_req before the status change, and in this case it must stay asserted until the state status transitions away from Reset or PM. 8\. When clock-gated in RESET states, Adapters that rely on dynamic clock gating to save power must wait in clock gated state for pl_inband_pres=1. The Physical Layer will request clock gating exit when it transitions pl_inband_pres, and the Adapter must wait for pl_inband_pres assertion before requesting lp_state_req = ACTIVE. If pl_inband_pres de-asserts while pl_state_sts = RESET, then the Adapter is permitted to return to clock-gated state after moving lp_state_req to NOP. 9\. Physical Layer must also perform this handshake for sideband traffic to Adapter. When performing the handshake for pl_cfg transitions, Physical Layer must wait for lp_clk_ack before changing pl_cfg or pl_cfg_vld. Because pl_cfg can have multiple transitions for a single packet transfer, it is necessary to make sure that the Adapter clocks are up before transfer begins. # 10.1.4 Data Transfer As indicated in the signal list descriptions, when Adapter is sending data to the Physical Layer, data is transferred when lp_irdy, pl_trdy, and lp_valid are asserted. Figure 10-3 shows an example waveform for data transfer from the Adapter to the Physical Layer. Data is transmitted on clock cycles 1, 2, and 5. No assumption should be made by Adapter about when pl_trdy can de-assert or for how many cycles it remains de-asserted before it is asserted again, unless explicitly guaranteed by the Physical Layer. If a Flit transfer takes multiple clock cycles, the Adapter is not permitted to insert bubbles in the middle of a Flit transfer. This means that lp_valid and lp_irdy must be asserted continuously until the Flit transfer is complete. Of course, data transfer can stall because of pl_trdy de-assertion. <figure> <figcaption>Figure 10-3. Data Transfer from Adapter to Physical Layer</figcaption> 0 1 2 3 4 5 6 clk $\mathrm { l p } _ { - } \mathrm { i r d y }$ lp_data Dat0 Dat1 Dat2 lp_valid pl_trdy </figure> As indicated in the signal list descriptions, when the Physical Layer is sending data to the Adapter, there is no backpressure mechanism, and data is transferred whenever pl_valid is asserted. The Physical Layer is permitted to insert bubbles in the middle of a Flit transfer and the Adapter must be able to handle that. ## IMPLEMENTATION NOTE For the transmit side of the Physical Layer for data sent over the UCIe Link, it must ensure that if the Adapter has a continuous stream of packets to transmit (lp_irdy and lp_valid do not de-assert), it does not insert bubbles in valid frames on the Physical Link. For the Runtime Link Testing feature with parity insertion, the Adapter as a receiver of parity bytes is permitted to issue a {ParityFeature.Nak} if software sets up a number of parity byte insertions ("Number of 64 Byte Inserts" field in the "Error and Link Testing Control" register) that does not amount to 256B or a multiple of the RDI width (to save the implementation cost of barrel shifting the parity bytes). For example, if the RDI width is 64B then either 64B, 128B, or 256B of inserted parity bytes are okay, but if the RDI width is 256B or larger, then it is better to always have 256B of inserted parity bytes so that it matches the data transfer granularity of Flits. # IMPLEMENTATION NOTE It is permitted to use lp_irdy as an early indication that the valid data will be resuming imminently, and the Physical Layer needs to ungate clocks and assert pl_trdy when it is ready to receive data. A couple of examples are shown in Figure 10-4 and Figure 10-5. Note that pl_trdy could have asserted as early as Clock Cycle 1 in Figure 10-4. <figure> <figcaption>Figure 10-4. lp_irdy asserting two cycles before lp_valid</figcaption> 0 1 2 3 4 5 6 clk Ip_irdy Ip_data Dat0 Dat1 Ip_valid pl_trdy </figure> <figure> <figcaption>Figure 10-5. lp_irdy asserting at the same cycle as lp_valid</figcaption> 0 1 2 3 4 5 6 clk Ip_irdy Ip_data Dat0 Dat1 Ip_valid pl_trdy </figure> ## 10.1.5 RDI State Machine <figure> <figcaption>Figure 10-6 shows the RDI state machine. Figure 10-6. RDI State Machine</figcaption> Domain Reset Exit Link Error From Any State Reset Disabled From Any State (except LinkError) L2 LinkReset Active From Any State (except Disabled and LinkError) PMNAK L1 Retrain </figure> ## 10.1.6 RDI bring up flow Figure 10-7 shows an example flow for Stage 2 of the Link bring up highlighting the transitions on RDI. This stage requires sequencing on RDI that coordinates the state transition from Reset to Active. 1\. Once Physical Layer has completed Link training, it must do the pl_clk_req handshake with the Adapter and reflect pl_inband_pres=1 on RDI. Note that the pl_clk_req handshake is not shown in the example flow in Figure 10-7 2\. Observing pl_inband_pres=1 is the trigger for Adapter to request Active state. It must perform the lp_wake_req handshake as described in Section 10.1.3. Note that the lp_wake_req handshake is not shown in the example flow in Figure 10-7. 3\. Only after sampling 1p_state_req $\mathrm { r e q } = \mathrm { A c t i v e } ,$ the Physical Layer must send the {LinkMgmt.RDI.Req.Active} sideband message to remote Link partner's Physical Layer. 4\. The Physical Layer must respond to the {LinkMgmt.RDI.Req.Active} sideband message with a {LinkMgmt.RDI.Rsp.Active} sideband message. The {LinkMgmt.RDI.Rsp.Active} sideband message must only be sent after the Physical Layer has sampled lp_state_req = Active from its local RDI. 5\. Once the Physical Layer has sent and received the {LinkMgmt.RDI.Rsp.Active} sideband message, it must transition pl_state_sts to Active. 6\. This opens up the Adapter to transition to Stage 3 of the bring up flow. Steps 3 to 5 are referred to as the "Active Entry handshake" and must be performed for every entry to Active state. Active.PMNAK to Active transition is not considered here because Active.PMNAK is only a sub-state of Active. <figure> <figcaption>Figure 10-7. Example flow of Link bring up on RDI</figcaption> Adapter Die 0 Physical Layer $D i e \quad 0$ CHANNEL Physical Layer $D i e \quad 1$ Adapter Die 1 Reset flow for Die 0 (independent of Die 1) Stage 0 Reset flow for Die 1 (independent of Die 0) Stage 0 $p l \_ s t a t e \_ s t s = R e s e t$ pl_state_sts = Reset Sideband initialization Stage 1 Training parameter exchanges on sideband and Mainband (Repair and) Training Stage 2 Start Adapter exits clock gating, gives Active request once it is ready to receive and send protocol parameter exchanges $p l \_ i n b a n d \_ p r e s = 0 - > 1$ pl_inband_pres = 0->1 Adapter exits clock gating, gives Active request once it is ready to receive and send protocol parameter exchanges Ip_state_req=Active lp_state_req=Active SB MSG {LinkMgmt.RDI.Req.Active} SB MSG {LinkMgmt.RDI.Rsp.Active} I SB MSG {LinkMgmt.RDI.Req.Active} $- S B \quad M S G L i n k M g m t . R D I . R s p . A c t i v e$ pl_state_sts $= A c t i v e$ $p l \_ s t a t e \_ s t s = A c t i v e$ Either side can start the SB exchange Physical Layer returns pl_state_sts = Active once it $h a s \quad s e n t \quad a n d \quad r e c e i v e d \quad a n$ "Active Status" SB MSG Physical Layer returns $p l \_ s t a t e \_ s t s = A c t i v e \quad o n c e$ it has sent and received an "Active Status" SB MSG Stage 2 Complete </figure> ### 10.1.7 RDI PM flow This section defines the rules for PM entry, exit and abort flows as they apply to handshakes on the RDI. The rules for L1 and L2 are the same, except that exit from L2 is to Reset state, whereas exit from L1 is to Retrain state. This section uses PM to denote L1 or L2. A "PM Request" sideband message is {LinkMgmt.RDI.Req.L1} or {LinkMgmt.RDI.Req.L2}. A "PM Response" sideband message is {LinkMgmt.RDI.Rsp.L1} or {LinkMgmt.RDI.Rsp.L2}. . Regardless of protocol, the PM entry or exit flow is symmetric on RDI. Both Physical Layer must issue PM entry request through a sideband message once the conditions of PM entry have been satisfied. PM entry is considered successful and complete once both sides have received a valid "PM Response" sideband message. Figure 10-8 shows an example flow for L1. Once the RDI status is PM, the Physical Layer can transition itself to a power savings state (turning off the PLL for example). Note that the sideband logic and corresponding PLL needs to stay on even during L1 state. . All the Adapter state machines (Adapter LSMs) in the Adapter must have moved to the corresponding PM state before the Adapter requests PM entry from remote Link partner. Adapter LSM in PM implies the retry buffer of the Adapter must be empty, and it must not have any new Flits (or Ack/Nak) pending to be scheduled. Essentially there should be no traffic on mainband when PM entry is requested by the Adapter to the Physical Layer. The Adapter is permitted to clock gate its sideband logic once RDI status is PM and there are no outstanding transactions or responses on sideband. Physical Layer must do pl_clk_req handshake (if pl_clk_req is not already asserted or status is not Active) before forwarding sideband requests from the Link to the Adapter. · Adapter requests PM entry by transitioning 1p_state_req to the corresponding PM encoding. Once requested, the Adapter cannot change this request until it observes PM, Active. PMNAK, Retrain, or LinkError state on pl_state_sts. While requesting PM state, if the Adapter receives Active request from the Protocol Layer, or a PM exit request for the Adapter LSM on sideband, it must sink the message but delay processing it until pl_state_sts has resolved. Once the RDI state is resolved, the Adapter must first bring it back to Active before processing the other requests. \- If the resolution is PM (upon successful PM entry) and the Protocol Layer needs to exit PM (or there is a pending Protocol Layer Active request from remote Link partner), then the Adapter must initiate PM exit flow on RDI by requesting lp_state_req = Active. All PM entry-related handshakes must have finished prior to this (this is when the Physical Layer on both sides of the Link have received a valid "PM Response" sideband message). \- If the resolution is Active. PMNAK, the Adapter must initiate a request of Active on RDI. Once the status moves to Active, the Adapter is permitted to re-request PM entry (if all conditions of PM entry are still met). Figure 10-9 shows an example of PM abort flow. The PM request could have been from either side. \- If the resolution is LinkError, then the Adapter must propagate this to Protocol Layers. This also resets any outstanding PM handshakes. · Physical Layer initiates a "PM Request" sideband message once it samples the corresponding PM encoding on lp_state_req and has completed the StallReq/Ack handshake with its Adapter. . Once a Physical Layer receives a "PM request" sideband message, it must respond to it within 2 us: \- If its local Adapter is requesting the corresponding PM state, it must respond with the corresponding "PM Response" sideband message. If the current status is not PM, it must transition pl_state_sts to PM after responding to the sideband message. \- If the current pl_state_sts = PM, it must respond with "PM Response" sideband message. \- If pl_state_sts = Active and 1p_state_req = Active and it remains this way for 1us after receiving the "PM Request" sideband message, it must respond with {LinkMgmt.RDI.Rsp.PMNAK} sideband message. · If a Physical Layer receives a "PM Response" sideband message in response to a "PM Request" sideband message, it must transition pl_state_sts on its local RDI to PM (if it is currently in Active state). If the current state is not Active, no action needs to be taken. · If a Physical Layer receives a {LinkMgmt.RDI.Rsp.PMNAK} sideband message in response to a "PM Request" sideband message, it must transition pl_state_sts on its local RDI to Active.PMNAK state if it is currently in Active state. If it is not in Active state, no action needs to be taken. The Physical Layer is permitted to retry PM entry handshake (if all conditions of PM entry are satisfied) at least 2 us after receiving the {LinkMgmt.RDI.Rsp.PMNAK} sideband message OR if it received a corresponding "PM Request" sideband message from the remote Link partner. · PM exit is initiated by the Adapter requesting Active on RDI. This triggers the Physical Layer to initiate PM exit by sending a {LinkMgmt.RDI.Req.Active} sideband message. Physical Layer must make sure it has finished any Link retraining steps before it responds with the {LinkMgmt.RDI.Rsp.Active} sideband message. Figure 10-10 shows an example flow of PM exit on RDI. \- PM exit handshake completion requires both Physical Layers to send as well as receive a {LinkMgmt.RDI.Rsp.Active} sideband message. Once this has completed, the Physical Layer is permitted to transition pl_state_sts to Active on RDI. \- If pl_state_sts = PM and a {LinkMgmt.RDI.Req.Active} sideband message is received, the Physical Layer must initiate pl_clk_req handshake with the Adapter, and transition pl_state_sts to Retrain. This must trigger the Adapter to request Active on lp_state_req (if not already doing so), and this in turn triggers the Physical Layer to send {LinkMgmt.RDI.Req.Active} sideband message to the remote Link partner. Figure 10-11 shows an example of the L1 exit flow on RDI and its interaction with the LTSM in the Physical Layer. It is permitted for the LTSM to begin the Link PM exit and retraining flow when a {LinkMgmt.RDI.Req.Active} sideband message is received or when the Adapter requests Active on RDI. The timeout counters for the Active Request sideband message handshake must begin only after LTSM is in the LINKINIT state. L2 exit follows a similar flow for cases in which graceful exit is required without domain reset; however, the L2 exit is via Reset state on RDI, and not Retrain. Exit conditions from Reset state apply for L2 exit (i.e., a NOP -> Active transition is required on lp_state_req for the Physical Layer to exit Reset state on RDI). Note that the following figures are examples for L1, and do not show the lp_wake_req, pl_clk_req handshakes. Implementations must follow the rules outlined for these handshakes in previous sections. <figure> <figcaption>Figure 10-8. Successful PM entry flow</figcaption> Adapter $\mathrm { D i e } 0$ Physical layer Die 0 CHANNEL Physical layer Die 1 Adapter Die 1 $p l \_ s t a t e \_ s t s = A c t i v e$ $p l \_ s t a t e \_ s t s = A c t i v e$ Adapter ensures all Adapter LSMs have moved to PM state before requesting PM $\mathrm { l p } \_ \mathrm { s t a t e } \_ \mathrm { r e q } = \mathrm { L }$ Adapter ensures all Adapter LSMs have moved to PM state before requesting PM SB MSG {LinkMgmt.RDI.Req.L1} Physical Layer must wait for 1us to see if Adapter requests PM lp_state_req=L1 SB MSG {LinkMgmt.RDI.Req.L1} SB MSG {LinkMgmt.RDI.Rsp.L1} pl_state_sts = PM- SB MSG {LinkMgmt.RDI.Rsp.L1} $\mathrm { s t a t e } _ { - } s t s$ = PM- </figure> <figure> <figcaption>Figure 10-9. PM Abort flow</figcaption> Adapter Die 0 $\text { Physical layer } }<br>{ \text { Die } 0 } CHANNEL Physical layer Die 1 Adapter Die 1 pl_state_sts $= A c t i v e$ pl_state_sts $= A c t i v e$ lp_state_req=Active lp_state_req=L1 SB MSG {LinkMgmt.RDI.Req.L1} Physical Layer must wait for 1us to see if Adapter requests PM Adapter must continue to receive (but not process) sideband packets that may request PM exit for Adapter LSM. SB MSG {LinkMgmt.RDI.Rs p.PM NAK}- pl_state_sts = Active. PM NAK $l p \_ s t a t e \_ r e q = A c t i v e$ $p l \_ s t a t e \_ s t s = A c t i v e$ Adapter can retry PM entry 2us after receiving PMNAK, if all conditions of PM entry are still met. This is also the $p o i n t \quad a f t e r \quad w h i c h \quad a n y$ pending sideband requests for PM exit of protocol layer can be processed. </figure> <figure> <figcaption>Figure 10-10. PM Exit flow</figcaption> Adapter Die 0 Physical layer $D i e \quad 0$ CHANNEL Physical layer Die 1 Adapter Die 1 $p l \_ s t a t e \_ s t s = L 1$ pl_state_sts =L1 $\mathrm { l p } _ { - } \mathrm { s t a t e } _ { - } \mathrm { r e q } = \mathrm { A } \mathrm { c t i v e }$ SB MSG {LinkMgmt. RDI.Req.Active}- SB MSG {LinkMgmt.RDI.Rsp.Active} pl_state_sts = Retrain lp_state_req=Active SB MSG {LinkMgmt.RDI.Req.Active} $p l \_ s t a t e \_ s t s = R e t r a i n$ SB MSG $\left. \mathrm { R s p } . \mathrm { A c t i v e } \right\}$ pl_state_sts = Active $p | _ { - } s \text { tate } _ { - } s t s = A c t i v e$ </figure> <figure> <figcaption>Figure 10-11. RDI PM Exit Example Showing Interactions with LTSM</figcaption> Adapter Die 0 Physical Layer Die 0 CHANNEL Physical Layer Die 1 Adapter Die 1 pl_state_sts = L1 pl_state_sts =L1 $1 p _ { - } s \text { tate } _ { - } r e q = A c t i v e$ SB MSG {LinkMgmt.RDI.Req.Active} $p l \_ s t a t e \_ s t s = R e t r a i n$ lp_state_req=Active SB MSG {LinkMgmt.RDI.Req.Active} $p l \_ s t a t e \_ s t s = R e t r a i n$ LTSM is in LINKINIT LTSM is in LINKINIT RDI. Rs p.Active } SB MSG {LinkMgmt.RDI.Rsp.Active} LTSM is in Active LTSM is in Active pl_state_sts = Active pl_state_sts = Active ☐ LTSM performs L1 exit-related Link Training </figure> ## 10.2 Flit-Aware Die-to-Die Interface (FDI) This section defines the signal descriptions and functionality associated with a single instance of Flit- Aware Die-to-Die Interface (FDI). A single instance is used for a Protocol Layer to Adapter { \text { er connection } }<br>{ \text { FDI .$ However, a single Adapter can host multiple protocol stacks using multiple instances of Figure 10-12 shows example configurations using multiple instances of FDI. <figure> <figcaption>Figure 10-12. Example configurations using FDI</figcaption> Protocol Layer $P r o t o c o l \quad L a y e r$ $\left( \alpha _ { L . i o } \right)$ Protocol Layer (CXL.cachemem) FDI $F D I$ Arb/Mux Die-to-Die Adapter Die-to-Die Adapter RDI RDI (a) Single Protocol (b) Single CXL stack Protocol Layer Protocol Layer Protocol Layer $\left( \alpha _ { L . i o } \right)$ Protocol Layer $\left( \mathrm { c u l } . . \mathrm { c a c h e m e m } \right)$ Protocol Layer $\left( C \alpha L i o \right)$ Protocol Layer $\left( \mathrm { c x L } . \mathrm { c a c h e m e m } \right)$ $F D I$ FDI Stack Mux Die-to-Die Adapter $\mathrm { A r b / M u x }$ Arb/Mux Stack Mux RDI Die-to-Die Adapter RDI (c) Two Protocol Stacks (d) Two CXL stacks multiplexed inside the adapter </figure> Table 10-3 lists the FDI signals and their descriptions. In Table 10-3: . pl _* indicates that the signal is driven away from the Die-to-Die Adapter to the Protocol Layer. · lp _* indicates that the signal is driven away from the Protocol Layer to the Die-to-Die Adapter. Note: The same signal-naming convention as RDI is used to highlight that RDI signal list is a proper subset of FDI signal list. Signal encodings pertaining to 'Management Transport protocol' are applicable only when Management Transport protocol was successfully negotiated on the mainband. Otherwise, those encodings are reserved. Also, dm * signals in Table 10-3 are applicable only when supporting Management Transport path over the mainband ("dm" is an abbreviation for "d2d_adapter-to- management_port_gateway"). <table> <caption>Table 10-3. FDI signal list (Sheet 1 of 7)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>lclk</td> <td>$T h e \quad c l o c k \quad a t \quad w h i c h \quad F D I \quad o p e r a t e s .$</td> </tr> <tr> <td>$l p \_ i r d y$</td> <td>Signal indicating that the Protocol Layer potentially has data to send. This must be asserted if lp_valid is asserted and the Protocol Layer wants the Adapter to sample the data. $l p \_ i r d y \quad m u s t \quad n o t \quad b e$ presented by the Protocol Layer when pl_state_sts is Reset status transitions from LinkError to Reset. On a LinkError to Reset transition, it is permitted for lp_irdy to be asserted for a few clocks but it must be de- asserted eventually. Physical Layer must ignore 1p_irdy when status is Reset.</td> </tr> <tr> <td>lp_valid</td> <td>Protocol Layer to Adapter indication that data is valid on the corresponding lp_data bytes.</td> </tr> <tr> <td>$l p \_ d a t a \left[ N B Y T E S - 1 : 0 \right] \left[ 7 : 0 \right]$</td> <td>$\text { Protocol Layer to Adapter data, where } }<br>{ \text { the data width for the FDI instance. } } 'NBYTES' equals number of bytes determined by</td> </tr> <tr> <td>lp_retimer_crd</td> <td>When asserted at a rising clock edge, it indicates a single credit return for the Retimer Receiver buffer. Each credit corresponds to 256B of mainband data (including Flit header and CRC, etc.). This signal must NOT assert if a Retimer is not present. On FDI, this is an optional signal. It is permitted to have the Receiver buffers in the Protocol Layer for Raw Format only. If this is not exposed to Protocol Layer, Adapter must track credit at 256B granularity even for Raw Format and return credits to Physical Layer on RDI. When this is exposed on FDI, the Adapter must have the initial credits knowledge through other implementation specific means in order to advertise this to the remote Link partner during parameter exchanges.</td> </tr> <tr> <td>lp_corrupt_crc</td> <td>{ \left. \text { This signal is only applicable for CXL.crhemem in UCIe Flit Mode \left(i.e., the Adapter doingter } \right) }<br>{ \text { Retry\right) for } C M L 2 5 6 B \text { Fit Mode. Tis Isment as a latenchornons thorhothors } } detection and containment for viral or poison using the Adapter to corrupt CRC of outgoing Flit. It is recommended to corrupt CRC by performing a bitwise XOR of the computed CRC with the syndrome 138Eh. The syndrome was computed such that no 1- bit or 2-bit errors alias to this syndrome, and it has the least probability of aliasing with 3-bit errors. For Standard 256B Flits, Protocol Layer asserts this along with lp_valid for the last chunk of the Flit that needs containment. Adapter corrupts CRC for both of the 128B halves of the Flit which had this set. It also must make sure to overwrite this flit (with the next flit sent by the Protocol Layer) in the Tx Retry buffer. { \text { For Latency-Optimized } 2 5 6 B \text { Flits } }<br>{ \text { the last chunk of the } 1 2 8 B \text { Flit } h ,$ Protocol Layer asserts this along with lp_valid for that needs containment. If 1p_corrupt_crc is asserted on the first 128B half of the Flit, Protocol Layer must assert it on the second 128B half of the Flit as well. The very next Flit from the Protocol Layer after this signal must carry the information relevant for viral, as defined in the CXL $s p e c i f i c a t i o n . I f \quad t h i s$ was asserted on the second 128B half of the Flit only, it is the Protocol Layer to send the first 128B half exactly as before, and $\text { insert the viral information in the se } }<br>{ 1 2 8 B \text { half of the Flit which had this } } second half of the Flit. Adapter corrupts CRC for the set. It also must make sure to overwrite this flit (with Layer) in the Tx Retry buffer.</td> </tr> <tr> <td>$1 p _ { - } d 1 1 p \left[ \text { NDLLP-1 } : 0 \right]$</td> <td>Protocol Layer to Adapter transfer of DLLP bytes. This is not used for 68B Flit Mode, CXL.cachemem or Streaming protocols. For a 64B data path on Ip_data, it is recommended to assign NDLLP &gt;= 8, so that 1 DLLP per Flit can be transferred from the Protocol Layer to the Adapter on average. The Adapter is responsible for inserting DLLP into DLP bytes 2:5 if the Flit packing rules permit it. See Section 10.2.4.1 for additional rules.</td> </tr> <tr> <td>$1 p _ { - } d 1 1 p _ { - } v a l i d$</td> <td>{ \text { Indicates valid DLLP transfer on } 1 p \text { d11p. DLLP. transfers art subt subject to } }<br>{ \text { oackpressure by p1 trady the Adapter must have storage for different types of DLLP } } and this can be overwritten so that the latest DLLPs are sent to remote Link partner). DLLP transfers are subject to backpressure by pl_stallreq - Protocol Layer must stop DLLP transfers at DLLP Flit aligned boundary before giving p_stallack or requesting PM.</td> </tr> <tr> <td>$1 p _ { - } d 1 1 p _ { - } o f c$</td> <td>Indicates that the corresponding DLLP bytes on lp_dllp follow the Optimized_Update_FC format. It must stay asserted for the entire duration of the DLLP transfer on lp_dllp.</td> </tr> </table> <table> <caption>Table 10-3. FDI signal list (Sheet 2 of 7)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td rowspan="2">$l p \_ s t r e a m \left[ 7 : 0 \right]$</td> <td>Protocol Layer to Adapter signal that indicates the stream ID to use with data. Each stream ID maps to a unique protocol and stack. It is relevant only when 1p_valid is 1. 00h: Reserved 11h: Stack 1: PCIe</td> </tr> <tr> <td>01h: Stack 0: PCIe 12h: Stack 1: CXL.io 02h: $S t a c k \quad 0 :$ CXL.io 13h: Stack 1: CXL.cachemem 03h: Stack 0: CXL.cachemem 14h: Stack 1: Streaming protocol 04h: Stack 0: Streaming protocol 15h: Stack 1: Management Transport 05h: Stack 0: Management Transport protocol protocol Other encodings are Reserved.</td> </tr> <tr> <td>pl_trdy</td> <td>The Adapter is ready to accept data. Data is accepted by the Adapter when pl_trdy, lp_valid, and lp_irdy are asserted at the rising edge of lclk. This signal must be asserted only if pl_state_sts is Active or when performing the $\frac { p 1 } { \left. \text { Section } 1 0 . 3 . 3 . 7 \right) }$ handshake when the pl_state_sts is LinkError (see</td> </tr> <tr> <td>$p l _ { - }$</td> <td>Adapter to Protocol Layer indication that data is valid on pl_data.</td> </tr> <tr> <td>pl_data [NBYTES-1 : 0] [ 7: 0]</td> <td>Adapter to Protocol Layer data, where NBYTES equals the number of bytes determined by the data width for the FDI instance.</td> </tr> <tr> <td>pl_retimer_crd</td> <td>$\text { When asserted at rising clock edge, it indicates a sindiched rinding Fithe and cher and } C R C _ { \prime } .$ This signal must NOT assert if a Retimer is not present. On FDI, this is an optional signal. It is permitted to expose these credits to Protocol Layer for Raw Format only. If this is not exposed to Protocol Layer, Adapter must track credit at 256B granularity even for Raw Format and back-pressure the Protocol Layer using pl_trdy. When this is exposed on FDI, the Adapter converts the initial credits received from the Retimer over sideband to credit returns to the Protocol Layer on this bit after Adapter LSM has moved to Active state.</td> </tr> <tr> <td>$p l _ { - } d l l p \left[ N D L l l p - 1 : 0 \right]$</td> <td>Adapter to Protocol Layer transfer of DLLP bytes. This is not used for 68B Flit mode, CXL.cachemem or Streaming protocols. For a 64B data path on pl_data, it is recommended to assign NDLLP &gt;= 8, so that 1 DLLP per Flit can be transferred from the Adapter to the Protocol Layer, on average. The Adapter is responsible for extracting DLLP $f r o m \quad D L P \quad B y t e s \quad 2 : 5 \quad i f \quad a \quad F l i t \quad M a r k e r \quad i s \quad n o t \quad p r e s e n t . T h e \quad A d a p t e r \quad i s \quad a l s o \quad r e s p o n s i b l e \quad f o r$ corresponding transfer on FDI.</td> </tr> <tr> <td>pl_dllp_valid</td> <td>Indicates valid DLLP transfer on pl_dllp. DLLPs can be transferred to the Protocol Layer whenever valid Flits can be transferred on pl_data. There is no backpressure and the Protocol Layer must always sink DLLPs.</td> </tr> <tr> <td>pl_dllp_ofc</td> <td>Indicates that the corresponding DLLP bytes on pl_dllp follow the Optimized_Update_FC format. It must stay asserted for the entire duration of the DLLP transfer on pl_dllp.</td> </tr> <tr> <td rowspan="2">$p l _ { - } \text { stream } \left[ 7 : 0 \right]$</td> <td>Adapter to Protocol Layer signal that indicates the stream ID to use with data. Each stream ID maps to a unique protocol. It is relevant only when pl_valid is 1.</td> </tr> <tr> <td>$0 0 h : R e s e r v e d$ 11h: Stack 1: PCIe 01h: PCIe 12h: Stack 1: CXL.io 02h: Stack 0: CXL.io 13h: Stack 1: CXL.cachemem 03h: Stack 0: CXL.cachemem 14h: Stack 1: Streaming protocol 04h: Stack 0: Streaming protocol 15h: Stack 1: Management Transport 05h: Stack 0: Management Transport protocol protocol Other encodings are Reserved.</td> </tr> </table> <table> <caption>Table 10-3. FDI signal list (Sheet 3 of 7)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>pl_flit_cancel</td> <td>Adapter to Protocol Layer indication to dump a Flit. This enables latency optimizations on the Receiver data path when CRC checking is enabled in the Adapter. It is not applicable for Raw Format or 68B Flit Format. For Standard 256B Flit, it is required to have a fixed number of clock cycle delay between the last chunk of a Flit transfer and the assertion of pl_flit_cancel. This delay is fixed to be 1 cycle (i.e., the cycle after the last chunk transfer of a Flit). When this signal is asserted, Protocol Layer must not consume the associated Flit. For Latency-Optimized 256B Flits, it is required to have a fixed number of clock cycle delay between the last chunk of a 128B half Flit transfer and the assertion of pl_flit_cancel. This delay is fixed to be 1 cycle (i.e., the cycle after the last transfer of the corresponding 128B chunk). When this signal is asserted, Protocol Layer must not consume the associated Flit half. When this mode is supported, Protocol Layer must support it for all applicable Flit Formats associated with the corresponding protocol. Adapter must guarantee this to be a single cycle pulse when dumping a Flit or Flit half. It is the responsibility of the Adapter to ensure that the canceled Flits or Flit halves are eventually replayed on the interface without cancellation in the correct order once they pass CRC after Retry etc. See Section 10.2.5 for examples. When operating in UCIe Flit mode, it is permitted to use this signal to also cancel valid NOP Flits for the Protocol Layer to prevent forwarding these to the Protocol Layer. However for interoperability, if a Protocol Layer receives a NOP Flit without a corresponding pl_flit_cancel, it must discard these Flits.</td> </tr> <tr> <td>lp_state_req [3: 0]</td> <td>Protocol Layer request to Adapter to request state change. Encodings as follows: $0 0 0 0 b : N O P$ 1001b: LinkReset 1011b: Retrain 0100b: L1 1100b: Disabled 1000b: L2 All other encodings are reserved.</td> </tr> <tr> <td>lp_linkerror</td> <td>Protocol Layer to Adapter indication that an error has occurred which requires the Link to go down. Adapter must propagate this request to RDI, and move the Adapter LSMs (and CXL vLSMs if applicable) to LinkError state once RDI is in LinkError state. It must stay there as long as { \text { 1p 1 inkerror } = 1 . \text { The reason for having this } }<br>{ \text { eqular state transitions is to allow immediate } a } be an indication decoupled from action on part of the Protocol Layer and Adapter in order to provide the quickest path for error containment when applicable (e.g., a viral error escalation could map to the LinkError state).</td> </tr> <tr> <td rowspan="4">$p l _ { - } \text { state } _ { - } \text { sts } \left[ 3 : 0 \right]$</td> <td>Adapter to Protocol Layer Status indication of the Interface. Encodings as follows:</td> </tr> <tr> <td>0000b: Reset 1001b: LinkReset</td> </tr> <tr> <td>0001b: Active 1010b: LinkError 0011b: Active.PMNAK 1011b: Retrain L1 1100b: Disabled $1 0 0 0 b : L 2$ All other encodings are reserved.</td> </tr> <tr> <td>The status signal is permitted to transition from Adapter autonomously when applicable. For example the Adapter asserts the Retrain status when it decides to enter retraining either autonomously or when requested by remote agent. For PCIe/Streaming protocols, the Adapter LSM is exposed as pl_state_sts to the Protocol Layer. For CXL protocol, the ARB/MUX vLSM is exposed as pl_state_sts to the Protocol Layer. The Link Status is considered to be Up from Protocol Layer perspective when FDI status is Active, Active.PMNAK, Retrain, L1, or L2. The Link Status is considered Down for other states of FDI.</td> </tr> <tr> <td>pl_inband_pres</td> <td>Adapter to the Protocol Layer indication that the Die-to-Die Link has finished negotiation with remote Link partner and is ready for transitioning the FDI Link State $M a c h i n e \left( L S M \right)$ to Active. Once it transitions to 1b, this must stay 1b until FDI moves to Active or LinkError. It stays asserted while FDI is in Retrain, Active, Active. PMNAK, L1, or L2. It must de-assert during Reset, LinkReset, Disabled or LinkError states.</td> </tr> </table> <table> <caption>Table 10-3. FDI signal list (Sheet 4 of 7)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>$p l _ { n } e r r o r$</td> <td>Adapter to the Protocol Layer indication that it has detected a framing related error. It is pipeline matched with the receive data path. In UCIe Raw mode, it must also assert if pl_error was asserted on RDI by the Physical Layer for a Flit which the Adapter is forwarding to the Protocol Layer. In UCIe Flit Mode, it is permitted for Protocol Layer to use pl_error indication to log correctable errors when Retry is enabled from the Adapter. The Adapter must finish any partial Flits sent to the Protocol Layer and assert pl_flit_cancel in order to prevent consumption of that Flit by the Protocol Layer. Adapter must initiate Link Retrain on RDI following this, if it was a framing error detected by the Adapter. In UCIe Flit Mode, if Retry is disabled, the Adapter is responsible for mapping internally detected framing errors or Physical Layer received pl_error to an Uncorrectable Internal Error and escalate it as pl_trainerror if the mask and severity registers permit the escalation. If the Link is operating in Raw Format, the Adapter has no internal detection of framing errors, it just forwards any pl_error indication received from the Physical Layer on FDI such that it is pipeline matched to the data path. It is a pulse indication that can occur only when FDI receiver is Active (i.e.</td> </tr> <tr> <td>pl_cerror</td> <td>$\frac { p 1 } { - 1 }$ not affect the data path. In UCIe Raw mode, the Protocol Layer must and pl_cerror signals for Correctable Error Logging. In UCIe Raw mode, pl_cerror is used for Correctable Error Logging, whereas pl_error mapping to correctable or uncorrectable error is implementation specific depending on the requirements of the underlying protocol. Errors logged in the Correctable Error Status register are mapped to this signal if the corresponding mask bit in the Correctable Error Mask register is cleared to 0. It is a pulse of one or more cycles that can occur in any FDI state. If it is a state in which clock gating is permitted, it is the responsibility of the Adapter to perform the clock gating exit handshake with the Protocol Layer before asserting this signal. Clock gating can resume after pl_cerror is de-asserted and all other conditions permitting clock gating have been met.</td> </tr> <tr> <td>pl_nferror</td> <td>Adapter to the Protocol Layer indication that a non-fatal error was detected. This is used by Protocol Layer for error logging and corresponding escalation to software. The Adapter must OR any internally detected errors with pl_nferror on RDI and forward the result on FDI. Errors logged in Uncorrectable Error Status Register are mapped to this signal if the corresponding Severity and Mask bits are cleared to 0. It is a pulse of one or more cycles that can occur in any FDI state. If it is a state in which to perform the clock $g a t i n g \quad e x i t \quad h a n d s h a k e \quad w i t h \quad t h e \quad P r o t o c o l \quad L a y e r \quad b e f o r e \quad a s s e r t i n g \quad t h i s \quad s i g n a l . C l o c k \quad g a t i n g$ $p$</td> </tr> <tr> <td>pl_trainerror</td> <td>Indicates a fatal error from the Adapter. Adapter must transition pl_state_sts to LinkError if not already in LinkError state. (Note that the Adapter first takes RDI to LinkError, and that LinkError is eventually propagated to all the FDI states). $I m p l e m e n t a t i o n s \quad a r e \quad p e r m i t t e d \quad t o \quad m a p \quad a n y \quad f a t a l \quad e r r o r \quad t o \quad t h i s \quad s i g n a l \quad t h a t \quad r e q u i r e \quad u p p e r$ { \text { Errors loged in Uncorrectable Error Status Reqister are mapped this signal if the } }<br>{ \text { corresponding Severity is set to to to thac corresponding Mask bit is cleared to } 0 . } $I t \quad i s \quad a \quad l e v e l \quad s i g n a l$ that can assert in any FDI state but stays asserted until FDI exits the to Reset state.</td> </tr> <tr> <td>pl_rx_active_req</td> <td>Adapter asserts this signal to request the Protocol Layer to open its Receiver's data path and get ready for receiving protocol data or Flits. The rising edge of this signal must be when pl_state_sts is Reset, Retrain or Active. Together with lp_rx_active_sts, it forms a four way handshake. See Section 10.2.7 for rules related to this handshake.</td> </tr> <tr> <td>lp_rx_active_sts</td> <td>Protocol Layer responds to pl_rx_active_req after it is ready to receive and parse protocol data or Flits. Together with pl_rx_active_req, it forms a four way handshake. See Section 10.2.7 for rules related to this handshake.</td> </tr> </table> <table> <caption>Table 10-3. FDI signal list (Sheet 5 of 7)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>pl_protocol [3: 0]</td> <td>Adapter indication to Protocol Layer of the protocol that was negotiated during training. 0000b: PCIe without Management Transport 0011b: CXL.1 [Single protocol, i.e., CXL.io] without Management Transport 0100b: CXL.2 [Multi-protocol, Type 1 device] without Management Transport 0101b: CXL.3 [Multi-protocol, Type 2 device] without Management Transport 0110b: CXL.4 [Multi-protocol, Type 3 device] without Management Transport 0111b: Streaming protocol without Management Transport 1000b: PCIe with Management Transport 1001b: Management Transport 1011b: CXL.1 [Single protocol, i.e., CXL.io] with Management Transport 1100b: CXL.2 [Multi-protocol, $\left. T y p e \quad 2 \quad d e v i c e \right] w i t h \quad M a n a g e m e n t \quad T r a n s p o r t$ { 1 1 0 1 0 : C X L . 3 \left[ \text { MUIt } - p r C \right. }<br>{ 1 1 1 0 b : C X L . 4 \left[ M u l t i - p r c \right. ,$ Type 3 device] with Management Transport 1111b: Streaming protocol with Management Transport Other encodings are Reserved</td> </tr> <tr> <td>pl_protocol_flitfmt [3: 0]</td> <td>This indicates the negotiated Format. See Chapter 3.0 for the definitions of these formats. 0001b: Format 1: Raw Format 0010b: Format 2: 68B Flit Format $0 0 1 1 b : \text { Format } 3 : \text { Standard } 2 5 6 B \text { Endrint Filt Furt Furt } }<br>{ 0 1 0 0 b : \text { Format } 4 : \text { Standard } 2 5 6 B \text { Start Header Flit Forma } } 5: Latency-Optimized 256B without Optional Bytes Flit Format $0 1 1 0 b : F o r m a t \quad 6 :$ Latency-Optimized 256B with Optional Bytes Flit Format Other encodings are Reserved</td> </tr> <tr> <td>pl_protocol_vld</td> <td>Indication that pl_protocol, and pl_protocol_flitfmt have valid information. This is a level signal, asserted when the Adapter has determined the appropriate protocol, but must only de-assert again after subsequent transitions to LinkError or Reset state depending on the Link state machine transitions. $w h e n \quad p l \_ p r o t o c o l \_ v l d = 1 \quad a n d \quad p l \_ s t a t e \_ s t s = R e s e t \quad a n d \quad p l \_ i n b a n d \_ p r e s =$ 1. The Adapter must ensure that if pl_inband_pres = 1, pl_protocol_vld = 1 and pl_state_sts = Reset, then pl_protocol and pl_protocol_flitfmt are the correct values that can be sampled by the Protocol Layer.</td> </tr> <tr> <td>pl_stallreq</td> <td>Adapter request to Protocol Layer to flush all Flits for state transition and not prepare any new Flits.</td> </tr> <tr> <td>lp_stallack</td> <td>$P r o t o c o l \quad L a y e r \quad t o \quad A d a p t e r \quad i n d i c a t i o n \quad t h a t \quad t h e \quad F l i t s \quad a r e \quad a l i g n e d \quad a n d \quad s t a l l e d \left( i f \right.$ pl_stallreq was asserted). It is strongly a global free running clock, so the Protocol Layer can respond to pl_stallreq with lp_stallack even if other significant portions of the Protocol Layer are clock gated.</td> </tr> <tr> <td>pl_phyinrecenter</td> <td>Adapter indication to Protocol Layer that the Link is doing training or retraining (i.e., RDI has pl_phyinrecenter asserted or the Adapter LSM has not moved to Active yet). If this is asserted during a state where clock gating is permitted, the pl_clk_req/ lp_clk_ack handshake must be performed with the upper layer. The upper layers are permitted to use this to update the "Link Training/Retraining" bit in the UCIe Link Status register.</td> </tr> <tr> <td>pl_phyinl1</td> <td>Adapter indication to Protocol Layer that the Physical Layer is in L1 power management state (i.e., RDI is in L1 state).</td> </tr> <tr> <td>pl_phyinl2</td> <td>Adapter indication to Protocol Layer that the Physical Layer is in L2 power management state (i.e., RDI is in L2 state).</td> </tr> </table> <table> <caption>Table 10-3. FDI signal list (Sheet 6 of 7)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>pl_speedmode $\mathrm { d e } \left[ 2 : 0 \right]$</td> <td>Current Link speed. The following encodings are used: 000b: 4 GT/s 100b: 24 GT/s 001b: 8 GT/s 101b: 32 GT/s 010b: 12 GT/s 110b: 48 GT/s 011b: 16 GT/s 111b: 64 GT/s The Protocol Layer must only consider this signal to be relevant when the FDI state is Active or Retrain. For multi-module configurations, all modules must operate at the same speed.</td> </tr> <tr> <td>pl_max_speedmode</td> <td>Maximum Data Rate. The following encodings are used: $0 : < = 3 2 \quad G T / s$ 1: &gt; 32 GT/s The Protocol Layer must only consider this signal to be relevant when the FDI state transitions from Reset to Active. It indicates the negotiated maximum data rate by the Physical Layer during MBINIT.PARAM; thus, this signal can only change while FDI is in Reset state.</td> </tr> <tr> <td>pl_lnk_cfg[2:0]</td> <td>Current Link Configuration. Indicates the current operating width of a module. 000b: x4 100b: x64 001b: x8 101b: x128 010b: x16 110b: x256 $0 1 1 b : \times 3 2$ other encodings are reserved. The Protocol Layer must only consider this signal to be relevant when the FDI state is Active or Retrain. This is the total width across all Active modules for the corresponding FDI instance.</td> </tr> <tr> <td>pl_clk_req</td> <td>Request from the Adapter to remove clock gating from the internal logic of the Protocol Layer. This is an asynchronous signal from the Protocol Layer's perspective since it is not tied to 1clk being available in the Protocol Layer. Together with lp_clk_ack, it forms a four-way handshake to enable dynamic clock gating in the Protocol Layer. When dynamic clock gating is supported, the Protocol Layer must use this signal to exit clock gating before responding with lp_clk_ack. If dynamic clock gating is not supported, it is permitted for the Adapter to tie this signal to 1b.</td> </tr> <tr> <td>$l p \_ c l k \_ a c k$</td> <td>Response from the Protocol Layer to the Adapter acknowledging that its clocks have been ungated in response to pl_clk_req. This signal is only asserted when pl_clk_req is asserted, and de-asserted after pl_clk_req has de-asserted. When dynamic clock gating is not supported by the Protocol Layer, it must stage pl_clk_req internally for one or more clock cycles and turn it around as 1p_clk_ack. clock gating. This way it will still participate in the handshake even though it does not support dynamic</td> </tr> <tr> <td>lp_wake_req</td> <td>Request from the Protocol Layer to remove clock gating from the internal logic of the Adapter. This is an asynchronous signal relative to 1clk from the Adapter's perspective since it is not tied to 1clk being available in the Adapter. Together with pl_wake_ack, it forms a four-way handshake to enable dynamic clock gating in the Adapter. $S ^ { 1 }$ signal to 1b.</td> </tr> <tr> <td>pl_wake_ack</td> <td>Response from the Adapter to the Protocol Layer acknowledging that its clocks have been ungated in response to lp_wake_req. This signal is only asserted after lp_wake_req has asserted, and is de-asserted after 1p_wake_req has de-asserted. When dynamic clock gating is not supported by the Adapter, it must stage p_wake_req internally for one or more clock cycles and turn it around as pl_wake_ack. This way it will still participate in the handshake even though it does not support dynamic clock gating.</td> </tr> </table> <table> <caption>Table 10-3. FDI signal list (Sheet 7 of 7)</caption> <tr> <th>Signal Name</th> <th>Signal Description</th> </tr> <tr> <td>$p l _ { - } c f g \left[ N C - 1 : 0 \right.$</td> <td>This is the sideband interface from the Adapter to the Protocol Layer. See Chapter 7.0 for details. NC is the width of the interface. Supported values are 8, 16, and 32. must be implemented by hardware to be atomic regardless of the width $o f \quad t h e \quad i n t e r f a c e \left( i . e . , \right.$ all 32 bits of a register must be updated in the same cycle for a 32- bit register write, and similarly all 64 bits of a register must be updated in the same cycle</td> </tr> <tr> <td>pl_cfg_vld</td> <td>$W h e n \quad a s s e r t e d , i n d i c a t e s \quad t h a t \quad p l \_ c f g \quad h a s \quad v a l i d$ information that should be consumed by</td> </tr> <tr> <td>pl_cfg_crd</td> <td>Credit return for sideband packets from the Adapter to the Protocol Layer for sideband corresponds to 64 bits of header and 64 bits of data. Even $t r a n s a c t i o n s \quad t h a t \quad d o \quad n o t \quad c a r r y$ data or carry 32 bits of data consume the same credit and the Receiver returns the credit once the corresponding transaction has been processed or de-allocated from its internal buffers. See Section 7.1.3.1 for additional flow control rules. A value of 1 sampled at a rising clock edge indicates a single credit return. Because the advertised credits are design parameters, the Protocol Layer transmitter updates the credit counters with initial credits on domain reset exit, and no initialization credits are returned over the interface. Credit returns must follow the same rules of clock gating exit handshakes as the sideband packets to ensure that no credit returns are dropped by the receiver of the credit returns.</td> </tr> <tr> <td>$1 p _ { - } \text { cfg } \left[ N C - 1 : 0 \right]$</td> <td>This is the sideband interface from Protocol Layer to the Adapter. See Chapter 7.0 for details. NC is the width of the interface. Supported values are 8, 16, and 32. Register accesses must be implemented by hardware to be atomic regardless of the width of the interface (i.e., all 32 bits of a register must be updated in the same cycle for a 32- bit register write, and similarly all 64 bits of a register must be updated in the same cycle for a 64-bit register write).</td> </tr> <tr> <td>$l p \_ c f g \_ v l d$</td> <td>the Adapter. When asserted, indicates that lp_cfg has valid information that should be consumed by</td> </tr> <tr> <td>lp_cfg_crd</td> <td>Credit return for sideband packets from the Protocol Layer to the Adapter for sideband packets. Each credit corresponds to 64 bits of header and 64 bits of data. Even transactions that do not carry data or carry 32 bits of data consume the same credit and the Receiver returns the credit once the corresponding transaction has been processed or de-allocated from its internal buffers. See Section 7.1.3.1 for additional flow control rules. A value of 1 sampled at a rising clock edge indicates a single credit return. Because the advertised credits are design parameters, the Adapter transmitter updates the credit counters with initial credits on domain reset exit, and no initialization credits are returned over the interface. Credit returns must follow the same rules of clock gating exit handshakes as the sideband packets to ensure that no credit returns are dropped by the receiver of the credit returns.</td> </tr> <tr> <td>dm_param_exchange_done</td> <td>Signal resets to 0 on a Domain Reset. In single stack management transport implementations, this signal is asserted when $a d a p t e r \quad p a r a m e t e r \quad e x c h a n g e \quad h a s \quad c o m p l e t e d \quad b e t w e e n \quad b o t h \quad s i d e s \quad a n d \quad f l i t \quad f o r m a t / p r o t o c o l$ { \text { In multi-stack managent transport implement inations, this signal is anser onter ontrationer } }<br>{ \text { both stacks have completed their individual adapter pararter exthanges and protocol } } { \text { has been fi } }<br>{ \text { of the activ } } finalized (successfully or unsuccessfully) across both stacks. If at run time one stacks enters link status=down condition, this signal de-asserts and asserts again only when the above condition is again met.</td> </tr> <tr> <td>dm_param_stack_count [N-1: 0]</td> <td>Number of stacks that successfully negotiated Management Transport protocol. This field is sampled only when dm_param_exchange_done signal is asserted. If 68B Flit format was finalized, this field must be cleared to 00b. $0 0 b : 0 \quad s t a c k$ 10b: 2 stacks 01b: 1 stack Others: reserved N=1 for single stack and 2 for 2 stacks.</td> </tr> <tr> <td>pl_vendor_defined [VS-1 : 0]</td> <td>Optional Vendor Defined signals. See Section 10.3.4 for an example usage of these signals. If these signals are instantiated, but the UCIe stack is not operating in a mode that utilizes them, these signals should not assert.</td> </tr> <tr> <td>lp_vendor_defined [VS-1 : 0]</td> <td>Optional Vendor Defined signals. See Section 10.3.4 for an example usage of these signals. If these signals are instantiated, but the UCIe stack is not operating in a mode that utilizes them, these signals should not assert.</td> </tr> </table> ### 10.2.1 Interface reset requirements FDI does not define a separate interface signal for reset; however, it is required that the logic entities on both sides of FDI are in the same reset domain and the reset for each side is derived from the same source. Because reset may be staggered due to SoC routing, all signals coming out of reset must be driven to 0, unless otherwise specified. lp_stream and pl_stream are exceptions to this rule if they are tied off to their expected values at the time of integration. If lp_stream and pl_stream are not tied off, they must be driven to 0 when coming out of reset. ### 10.2.2 Interface clocking requirements FDI requires both sides of the interface to be on the same clock domain. Moreover, the clock domain for sideband interface $\left( * _ { \mathrm { C } } \mathrm { f } \mathrm { g } ^ { * } \right)$ is the same as the mainband signals. The sideband interface includes the pl_cfg, pl_cfg_vld, pl_cfg_crd, lp_cfg, lp_cfg_vld, and lp_cfg_crd signals. If Management Transport is not supported over sideband, all signals are synchronous to lclk. When Management Transport is supported over the sideband and exposed to the FDI interface, the sideband interface as well as the signals in Table 10-2 are permitted to be on a separate Mgmt_clk domain. For example, this Mgmt_clk can be the auxiliary clock so that the management transport is available over the sideband even if the clocks required for the mainband and for lclk are unavailable. Each side is permitted to instantiate clock crossing FIFOs internally if needed, as long as it does not violate the requirements at the interface itself. It is important to note that there is no back pressure possible from the Protocol Layer to the Adapter on the main data path. So any clock crossing related logic internal to the Protocol Layer must take this into consideration. ### 10.2.3 Dynamic clock gating Dynamic coarse clock gating is permitted in the Adapter and Protocol Layer when pl_state_sts is Reset, LinkReset, Disabled or PM states. This section defines the rules around entry and exit of clock gating. Note that clock gating is not permitted in LinkError states - it is expected that the UCIe usages will enable error handlers to make sure the Link is not stuck in a LinkError state, if the intent is to save power when a Link is in an error state. #### 10.2.3.1 Rules and description for Ip_wake_req/pl_wake_ack handshake Protocol Layer can request removal of clock gating of the Adapter by asserting lp_wake_req (asynchronous to lclk availability in the Adapter). All Adapter implementations must respond with a pl_wake_ack (synchronous to lclk). The extent of internal clock ungating when pl_wake_ack is asserted is implementation-specific, but Iclk must be available by this time to enable FDI transitions from the Protocol Layers. The Wake Req/Ack is a full handshake and it must be used for state transition requests (on lp_state_req or lp_linkerror) when moving away from a state in which clock gating is permitted. It must also be used for sending packets on the sideband interface. Rules for this handshake: 1\. Protocol Layer asserts lp_wake_req to request ungating of clocks by the Adapter. 2\. The Adapter asserts pl_wake_ack to indicate that clock gating has been removed. There must be at least one clock cycle bubble between lp_wake_req assertion and pl_wake_ack assertion. 3\. lp_wake_req must de-assert before pl_wake_ack de-asserts. It is the responsibility of the Protocol Layer to control the specific scenario of de-assertion. As an example, when performing the handshake for a state request, it is permitted to keep lp_wake_req asserted until it observes the desired state status. Protocol Layer is also permitted to keep lp_wake_req asserted through states where clock gating is not permitted in the Adapter (i.e., Active, LinkError or Retrain). 4\. lp_wake_req should not be the only consideration for Adapter to perform clock gating, it must take into account pl_state_sts and other internal or Link requirements before performing global and/or local clock gating. 5\. When performing lp_wake_req/pl_wake_ack handshake for lp_state_req transitions or lp_linkerror transition, the Protocol Layer is permitted to not wait for pl_wake_ack before changing lp_state_req or lp_linkerror. 6\. When performing lp_wake_req/pl_wake_ack handshake for lp_cfg transitions, Protocol Layer must wait for pl_wake_ack before changing lp_cfg or lp_cfg_vld. Because lp_cfg can have multiple transitions for a single packet transfer, it is necessary to make sure that the Adapter clocks are up before transfer begins. #### 10.2.3.2 Rules and description for pl_clk_req/lp_clk_ack handshake Adapter is allowed to initiate pl_clk_req/lp_clk_ack handshake at any time and the Protocol Layer must respond. Rules for this handshake: 1\. Adapter asserts pl_clk_req to request removal of clock gating by the Protocol Layer. This can be done anytime, and independent of current FDI state. 2\. The Protocol Layer asserts lp_clk_ack to indicate that clock gating has been removed. There must be at least one clock cycle bubble between pl_clk_req assertion and lp_clk_ack assertion. 3\. pl_clk_req must de-assert before lp_clk_ack. It is the responsibility of the Adapter to control the specific scenario of de-assertion, after the required actions for this handshake are completed. 4\. pl_clk_req should not be the only consideration for the Protocol Layer to perform clock gating, it must take into account pl_state_sts and other protocol-specific requirements before performing trunk and/or local clock gating. 5\. The Adapter must use this handshake to ensure transitions of pl_inband_pres, pl_phyinl1, pl_phyinl2, pl_phyinrecenter, and pl_rx_active_req have been observed by the Protocol Layer. Because these are level-oriented signals, the Adapter is permitted to let the signals transition without waiting for lp_clk_ack. When this is done during initial Link bring up, it is strongly recommended for the Adapter to keep pl_clk_req asserted until the state status transitions away from Reset to a state where clock gating is not permitted or until the state status is Reset and pl_inband_pres de-asserts. It is permitted for any of pl_inband_pres, pl_phyinl1, pl_phyinl2, and/or pl_phyinrecenter to assert before OR after pl_clk_req asserts; however, their assertion is not guaranteed to be observed by the Adapter until the pl_clk_req/lp_clk_ack handshake is complete. Figure 10-13. Example Waveform Showing Handling of Level Transition <figure> 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $\mathrm { l c l k }$ pl_clk_req lp_clk_ack pl_inband_pres </figure> 6\. The Adapter must also perform this handshake before transition to LinkError state from Reset, LinkReset, Disabled or PM state (especially when the LinkError transition occurs by the Adapter without being directed by the Protocol Layer). It is permitted to assert pl_clk_req before the state change, in which case it must stay asserted until the state status transitions. It is also permitted to assert pl_clk_req after the state status transition, but in this case Adapter must wait for lp_clk_ack before performing another state transition. 7\. The Adapter must also perform this handshake when the status is PM and remote Link partner is requesting PM exit. For exit from Reset, LinkReset, Disabled or PM states to a state that is not LinkError, it is required to assert pl_clk_req before the status change, and in this case it must stay asserted until the state status transitions away from Reset or PM. 8\. The Adapter must also perform this handshake for sideband transfers from the Adapter to the Protocol Layer. When performing the handshake for pl_cfg transitions, Adapter must wait for lp_clk_ack before changing pl_cfg or pl_cfg_vld. Because pl_cfg can have multiple transitions for a single packet transfer, it is necessary to make sure that the Protocol Layer clocks are up before transfer begins. When clock-gated in Reset states, Protocol Layers that rely on dynamic clock gating to save power must wait in clock gated state for pl_inband_pres=1. The Adapter will request clock gating exit when it transitions pl_inband_pres, and the Protocol Layer must wait for pl_inband_pres assertion before requesting lp_state_req = ACTIVE. If pl_inband_pres de-asserts while pl_state_sts = Reset, then the Protocol Layer is permitted to return to clock-gated state after moving lp_state_req to NOP. ### 10.2.4 Data Transfer As indicated in the signal list descriptions, when Protocol Layer is sending data to the Adapter, data is transferred when lp_irdy, pl_trdy and lp_valid are asserted. Figure 10-14 shows an example waveform for data transfer from the Protocol Layer to the Adapter. Data is transmitted on clock cycles 1, 2, and 5. No assumption should be made by Protocol Layer about when pl_trdy can de-assert or for how many cycles it remains de-asserted before it is asserted again, unless explicitly guaranteed by the Adapter. If a Flit transfer takes multiple clock cycles, the Protocol Layer is not permitted to insert bubbles in the middle of a Flit transfer (i.e., lp_valid and lp_irdy must be asserted continuously until the Flit transfer is complete. Of course, data transfer can stall because of pl_trdy de- assertion). <figure> <figcaption>Figure 10-14. Data Transfer from Protocol Layer to Adapter</figcaption> 0 1 2 3 4 5 6 $\mathrm { c l k }$ $\mathrm { l p } \_ \mathrm { i r d y }$ lp_data Dat0 Dat1 Dat2 lp_valid pl_trdy </figure> As indicated in the signal list descriptions, when Adapter is sending data to the Protocol layer, there is no back-pressure mechanism, and data is transferred whenever pl_valid is asserted. The Adapter is permitted to insert bubbles in the middle of a Flit transfer and the Protocol Layer must be able to handle that. ### 10.2.4.1 DLLP transfer rules for 256B Flit Mode For PCIe and CXL.io 256B Flits (both Standard and Latency-Optimized), FDI provides a separate signal for DLLP transfers from the Protocol Layer to the Adapter and vice-versa. Since the DLLPs have to bypass the Retry buffer, the separate signal enables the Adapter to insert DLLPs into the Flits from the Protocol Layer or the Retry buffer, if it is permitted to do so per the Flit packing rules of the corresponding Flit Format. Rules relevant for FDI operation (per FDI instance) are outlined below: For the Transmitting side: · Protocol Layer is responsible for sending the relevant DLLPs at the rate defined by the underlying Protocol to prevent timeouts of DLLP exchanges. If the Protocol Layer has no TLPs to send, it must insert NOP Flits to ensure that the Adapter gets an opportunity to insert the DLLP bytes. · When transferring DLLP or Optimized_Update_FC, the least significant byte is sent over Byte 0 of the FDI bus, the next byte over Byte 1 and so on. When the transfer is over multiple chunks across FDI, Byte 0 is transferred on the first chunk LSB, Byte 1 following it and so on. · The Adapter must have storage for at least 1 DLLP of every unique DLLP encoding (including Optimized_Update_FC) per supported VC that is possible for transfer to remote Link partner. The Adapter tracks pending DLLPs and schedules them on the next available opportunity for the relevant Flits. Credit update DLLPs must not be reordered for a VC by the Adapter. It is however permitted to discard a pending credit DLLP if the Protocol Layer presented a new credit DLLP of the same FC and VC. This extends to Optimized_Update_FC packets; i.e., it is permitted to discard any pending NP or P Update FC DLLPs, if the Protocol Layer transferred an Optimized_Update_FC for the corresponding VC. On the Receiving side: . The Adapter must extract DLLPs from received Flits of the corresponding protocol and forward them to the Protocol Layer. The FDI signal width of pl_dllp must be wide enough to keep up with the maximum rate of DLLPs that could be received from the Link. . When transferring DLLP over multiple chunks across FDI, Byte 0 is transferred on the first chunk LSB, Byte 1 following it and so on. . The Protocol Identifier corresponding to D2D Adapter in the Flit Header overlaps with the $\mathrm { F l i t }$ usage of NOP Flits defined in PCIe and CXL specifications. The Adapter must check for available DLLPs in these Flits as well. All 0 bits in the DLLP byte positions indicate a NOP DLLP, and must not be forwarded to the Protocol Layer. ### 10.2.5 Examples of pl_flit_cancel Timing Relationships In all the examples shown in this section, a 64B datapath on FDI is shown, and "FOBytes" in the figures correspond to "Flit 0 Bytes". Figure 10-15 shows an example timing relationship for pl_flit_cancel and pl_data for Latency- Optimized Flits when the first Flit half fails CRC check. Both Flit halves are canceled by the Adapter in this example by asserting pl_flit_cancel one clock after the last chunk transfer of the corresponding Flit half. It is permitted for the Adapter to de-assert pl_valid on clock cycles 5 and 6 instead of canceling that Flit half; however, this might have implications to meeting physical design timing margins in the Adapter. The use of pl_flit_cancel allows the Adapter to perform the CRC check on the side without putting the CRC logic in the critical timing path of the data flow and thus permitting higher frequency operation for implementations. In the example shown, after replay flow the entire Flit is transferred to the Protocol Layer without canceling as CRC checks pass. <figure> <figcaption>Figure 10-15. Example for pl_flit_cancel for Latency-Optimized Flits and CRC Error on First Flit Half</figcaption> 2 J 4 5 a 1 n Icik pl_data(63:0][7.0] FOBytes(83.0] FOBytes(127.64] FOBytes(191:128] FOBytes(255:192] F0Bytes(63.0] F0Bytes(127.64] FOBytes[191:128] FOBytes[255.192] p_valid pl_fit_cancel </figure> Figure 10-16 and Figure 10-17 show examples of two possible implementations of timing relationship for pl_flit_cancel and pl_data for Latency-Optimized Flits when the second Flit half fails CRC check. In both cases, the first half of the Flit is consumed by the Protocol Layer because it is not canceled by the Adapter (the data transferred on clock cycles 3 and 4). In the first case (shown in Figure 10-16), after the replay flow, CRC passes, and the Adapter ensures that the Protocol Layer does not re-consume the first half again by asserting pl_flit_cancel for it. In this case, pl_valid asserts for the entire Flit, but only the second half is consumed because the first half was canceled on clock cycle (n+2). In the second case (shown in Figure 10-17), after the replay flow, CRC passes, and the Adapter ensures that the Protocol Layer does not re-consume the first half again by not asserting pl_valid for it. Figure 10-16. Example for pl_flit_cancel for Latency-Optimized Flits and CRC Error on Second Flit Half <figure> <figcaption>Figure 10-17. Example for pl_flit_cancel for Latency-Optimized Flits and CRC Error on Second Flit Half, Alternate Implementation Example</figcaption> 2 2 5 6 7 n Icik pl_data[63:0|17:0] FOBytes(63.0) FOBytes(127.64] FOBytes[191:128 FOBytes(255:192] FOBytes(63:0) FOBytes(127:64) FOBytes|191:128 (FOBytes(256:192) p_valid pl __ cancel </figure> <figure> 2 9 1 5 0 n TH DJ 3 ICK pl data[63.0|70] FOBytes[63-0] FOBytes|127.64] FOBytes 191:128] FOBytes[255:192] FOBytes(63:0] FOBytes[127:64] FOBytes[191:128] FOBytes[255.192] pl_ valid pl_fit_cancel </figure> Figure 10-18 shows an example for a Standard 256B Flit. In this case, the CRC bytes are packed toward the end of the Flit and thus a CRC error on either of the two halves cancels the entire Flit. After replay flow, CRC passes, and the entire Flit is sent to the Protocol Layer without canceling it. <figure> <figcaption>Figure 10-18. Example for pl_flit_cancel for Standard 256B Flits</figcaption> 1 a 3 \- 5 6 7 n+P pl_data(63 0][7 0] FOBytes(63.01 FOBytes(127.64] FOBytes(191:128] FOBytes[255. 192] FÜBytes(83.0] FOBytes[127.84] FOBytes(191. 128) FOBytes(255.1921 pl_valid pl_Ilrt_cancel </figure> ## 10.2.6 FDI State Machine <figure> <figcaption>Figure 10-19 shows the FDI state machine. Figure 10-19. FDI State Machine</figcaption> Domain Reset Exit Link Error From Any State Reset Disabled From Any State (except LinkError) L2 Active LinkReset From Any State (except Disabled and LinkError) PMNAK L1 Retrain </figure> ### 10.2.7 Rx_active_req/Sts Handshake The Adapter negotiates Active state transitions on FDI using sideband messages when the Adapter LSM is exposed to the Protocol Layer. Since the sideband Link is running slower than the mainband Link, the Adapter needs to make sure that the Protocol Layer's Receiver is already in Active state (even though pl_state_sts might not have moved to Active yet) before responding to the Active request sideband message from remote Link partner. Rx_active_req/Sts handshake facilitates this. When CXL is sent over UCIe, ARB/MUX functionality is performed by the Adapter and CXL vLSMs are exposed on FDI. Although ALMPs are transmitted over mainband, the interface to the Protocol Layer is FDI and it follows the rules of Rx_active_req/Sts Handshake as well. Rules for this handshake: 1\. The Adapter (or ARB/MUX) asserts pl_rx_active_req to trigger the Protocol Layer to open its Receiver's data path for receiving protocol data or Flits. This signal does not affect the Transmitter data path (it must wait for pl_state_sts to move to Active and follow the rules of pl_trdy). pl_rx_active_req should have a rising edge only when lp_rx_active_sts = 0 and pl_state_sts is Reset, Retrain or Active. 2\. The Protocol Layer asserts lp_rx_active_sts after pl_rx_active_req has asserted and when it is ready to receive protocol data or Flits. There must be at least one clock cycle delay between pl_rx_active_req assertion and lp_rx_active_sts assertion to prevent a combinatorial loop. 3\. When pl_rx_active_req = 1 and lp_rx_active_sts = 1, the Receiver is in Active state if pl_state_sts is Reset, Retrain, or Active. 4\. pl_rx_active_req should have a falling edge only when lp_rx_active_sts = 1. This must trigger Protocol Layer to de-assert lp_rx_active_sts, and this completes the transition of the Receiver away from Active state. 5\. For graceful exit from Active state (i.e., a transition to PM, Retrain, LinkReset or Disabled states), both pl_rx_active_req and lp_rx_active_sts must de-assert before pl_state_sts transitions away from Active. 6\. If pl_rx_active_req = 0 while pl_state_sts = Active, the Adapter must guarantee no Flits would be sent to the Protocol Layer (for example, this can happen if the Adapter LSM or RDI is in Retrain, but the vLSM exposed to Protocol Layer is still in Active). Thus, it is permitted to perform this handshake even when the state status on FDI remains Active throughout. 7\. For Active to LinkError transition, it is permitted for pl_state_sts to transition to LinkError before pl_rx_active_req de-asserts, but both pl_rx_active_req and lp_rx_active_sts must de-assert before pl_state_sts transitions away from LinkError. #### 10.2.8 FDI Bring up flow Figure 10-20 shows an example flow for Stage 3 of the Link bring up highlighting the transitions on FDI. This stage requires sequencing on FDI that coordinates the state transition from Reset to Active. If multiple stacks of protocol or ARB/MUX is present, the same sequence happens independently for each Protocol Layer stack. The flows on FDI are illustrated for Adapter 0 LSM in the sideband message encodings, however Adapter 1 LSM must send the sideband message encodings corresponding to Adapter 1 to its remote Link partner. 1\. Once Adapter has completed transition to Active on RDI and successful parameter negotiation with the remote Link partner, it must do the pl_clk_req handshake with the Protocol Layer and reflect pl_inband_pres=1 on FDI. Note that the pl_clk_req handshake is not shown in the example flow in Figure 10-20 2\. This is the trigger for Protocol Layer to request Active state. It is permitted for the Protocol Layer to wait unlit pl_protocol_vld = 1 before requesting Active. It must perform the lp_wake_req handshake as described in Section 10.2.3.1. Note that the lp_wake_req handshake is not shown in the example flow in Figure 10-20. 3\. On sampling lp_state_req = Active, the Adapter must send the {LinkMgmt.Adapter0.Req.Active} sideband message to remote Link partner. 4\. The Adapter must respond to the {LinkMgmt.Adapter.Req.Active} sideband message with a {LinkMgmt.Adapter.Rsp.Active} sideband message after making sure that the Protocol Layer's Receiver is ready. The {LinkMgmt.Adapter0.Rsp.Active} must only be sent after the Adapter has sampled pl_rx_active_req = lp_rx_active_sts = 1. As mentioned previously, the pl_clk_req handshake applies to pl_rx_active_req as well; it is permitted for the Adapter to keep pl_clk_req asserted continuously (once it has been asserted for pl_inband_pres) while doing the bring up flow. Note once the Adapter has sent the {LinkMgmt.Adapter0.Rsp.Active} sideband message, if it receives Flits from the remote Link partner, it must process them as applicable (i.e. for UCIe Flit mode, the Adapter must respond to the Sequence Number Handshake initiated by the remote Link or respond with Ack/Nak for Payload Flits. The Adapter will have to insert NOPs in case the pl_state_sts signal has not yet transitioned to Active). 5\. If no ARB/MUX is present, once the Adapter has sent and received the {LinkMgmt.Adapter0.Rsp.Active} sideband message, it must transition pl_state_sts to Active for the Protocol Layer, and Flit transfer can begin (i.e., new Flits can be accepted from the Protocol Layer, and in UCIe Flit mode, the Adapter is permitted to initiate the Sequence Number Handshake Phase if it has not already done so as a result of Step 4). 6\. If ARB/MUX is present, the sending and receipt of {LinkMgmt.Adapter0.Rsp.Active} sideband message opens up the ARB/MUX to perform ALMP exchanges over mainband and eventually transition the vLSMs to Active state. Step 3 through Step 6 constitute the "Active Entry Handshake" on FDI and must be performed for every entry to Active state. The Active.PMNAK to Active transition is not considered here because Active.PMNAK is only a sub-state of Active. When Adapter 0 as well as Adapter 1 LSMs are proceeding with the Retrain to Active transition, then in addition to the above rules, the Adapter must have received both the {LinkMgmt.Adapter0.Rsp.Active} and {LinkMgmt.Adapter1.Rsp.Active} sideband messages before the Sequence Number Handshake can be initiated. This is because the Retry buffer is shared between both the Protocol Layer stacks, and thus both stacks must be ready to receive Flits before initiating the Sequence Number Handshake. <figure> <figcaption>Figure 10-20. FDI Bring up flow</figcaption> Protocol Layer $D i e \quad 0$ Adapter Die 0 Physical layer Die 0 CHANNEL Physical layer Die 1 Adapter Die 1 Protocol Layer Die 1 Stage 2 Complete Protocol para meter exchanges on sideband Stage 3 Start -pl_inband_pres = 0->1 pl_inband_pres = 0->1- Protocol layer exits clock gating, gives Active request Protocol layer exits clock gating, gives Active request -lp_state_req=Active $t p l \_ r x \_ a c t i v e \_ r e q = 0 - > 1$ lp_rx_active_sts=0->1- SB MSG {LinkMgmt.Adapter0.Req.Active} SB MSG {LinkMgmt.Adapter0.Rsp.Active}- $- 1 p _ { - }$ SB MSG {LinkMgmt.Adapter0.Req.Active} pl_rx_active_req=0->1- Mlp_rx_active_sts = 0->1 SB MSG {LinkMgmt.AdapterO.Rsp.Active} pl_state_sts =Active pl_state_sts =Active- Adapter opens TX and moves to Active status once it has sent and received an Active Status Adapter opens TX and moves to Active status once it has sent and received an Active Status If ARB/MUX exists, it performs the ALMP exchanges with remote ARB/MUX before moving pl_state_sts to Active for the Protocol Layer Stage 3 Complete. Flit transfer can begin </figure> ##### 10.2.9 FDI PM Flow This section describes the sequencing and rules for PM entry and exit on FDI. The rules are the same for L1 or L2 entry. L1 exit transitions the state machine through Retrain to Active, whereas L2 exit transitions the state machine through Reset to Active. The flow illustrations in the section use L1 as an example. A "PM request" sideband message is {LinkMgmt.Adapter *. Req.L1} or {LinkMgmt.Adapter *. Req.L2}. A "PM Response" sideband message is {LinkMgmt.Adapter *. Rsp.L1} or {LinkMgmt.Adapter *. Rsp.L2}. The flows on FDI are illustrated for Adapter 0 LSM in the sideband message encodings; however, Adapter 1 LSM must send the sideband message encodings corresponding to Adapter 1 to its remote Link partner. . The Protocol Layer requests PM entry on FDI after idle time criteria has been met. The criteria for idle time is implementation specific and could be dependent on the protocol. For PCIe and CXL.io protocols, PM DLLPs are not used to negotiate PM entry/exit when using D2D Adapter's Retry buffer (i.e., UCIe Flit mode). . If operating in UCIe Flit mode, ARB/MUX is present within the D2D Adapter, and it follows the rules of CXL Specification (for 256B Flit mode) to take the vLSMs to the corresponding PM state. Note that even for CXL 68B Flit mode, the same ALMP rules as 256B Flit mode are used. This is a simplification on UCIe, because ALMPs always go through the retry buffer. Once vLSMs are in the PM state, ARB/MUX requests the Adapter Link State Machine to enter the corresponding PM state. The Adapter Link State Machine transition to PM follows the same rules as outlined for Protocol Layer and Adapter below. · If CXL or PCIe protocol has been negotiated, only the upstream port (UP) can initiate PM entry. This is done using a sideband message from the UP Adapter to the downstream port (DP) Adapter. DP Adapter must not initiate entry into PM. PM support is required for CXL and PCIe protocols. PM entry is considered successful and complete once UP receives a valid "PM Response" sideband message. Figure 10-21 shows an example flow for CXL or PCIe protocol PM Entry on FDI and Adapter. Once the FDI status is PM for all Protocol Layers, the Adapter can request PM transition on RDI. . If Streaming protocol has been negotiated, OR UCIe is in Raw Format, OR Management Transport protocol was negotiated over the mainband without CXL or PCIe, then both side Adapters must issue a PM entry request through a sideband message once the conditions of PM entry have been satisfied. PM entry is considered successful and complete once both sides have received a valid "PM Response" sideband message. Figure 10-22 shows an example flow for symmetric protocols. Once the FDI status is PM for all Protocol Layers, the Adapter can request PM transition on the RDI. · Protocol Layer requests PM entry once it has blocked transmission of any new Protocol Layer Flits, by transitioning p_state_req to L1 or L2 encoding. Once requested, the Protocol Layer cannot change this request until it observes the corresponding PM state, Retrain, Active.PMNAK or LinkError state on pl_state_sts; unless it is a DP Protocol Layer for PCIe or CXL. Once the FDI state is resolved, the Adapter must first bring it back to Active before processing any new PM requests from the Protocol Layer. \- If the resolution is PM (upon successful PM entry) and the Protocol Layer needs to exit PM (or there is a pending Protocol Layer Active request from remote Link partner) then the Protocol Layer must initiate PM exit flow on FDI by requesting lp_state_req = Active. All PM entry related handshakes must have finished prior to this (for CXL/PCIe protocols, this is when UP has received a valid "PM Response" sideband message. For symmetric protocols, this is when both sides Adapter have received a valid "PM Response" sideband message). \- If the resolution is Active. PMNAK, the Protocol Layer must initiate a request of Active on FDI. Once the status moves to Active, the Protocol Layer is permitted to re-request PM entry (if all conditions of PM entry are still met). Figure 10-23 shows an example of PM abort flow. The PM request could have been from either side depending on the configuration. Protocol Layer must continue receiving protocol data or Flits while the status is Active or Active. PMNAK. \- DP Protocol Layer for PCIe or CXL is permitted to change request from PM to Active without waiting for PM or Active. PMNAK (the DP FDI will never have pl_state_sts =Active.PMNAK since it does not send "PM Request" sideband messages); however, it is still possible for the Adapter to initiate a stallreq/ack and complete PM entry if it was in the process of committing to PM entry when the Protocol Layer changed its request. In this scenario, the Protocol Layer will see pl_state_sts transition to PM and it is permitted to continue asking for the new state request. \- If the resolution is LinkError, then the Link is down and it resets any outstanding PM handshakes. · Adapter (UP port only if CXL or PCIe protocol), initiates a "PM request" sideband message once it samples a PM request on lp_state_req and has completed the StallReq/Ack handshake with the corresponding Protocol Layer and its Retry buffer is empty of Flits from the Protocol Layer that is requesting PM (all pending Acks have been received). . If the Adapter LSM moves to Retrain while waiting for a "PM Response" sideband message, it must wait for the response. Once the response is received, it must transition back to Active before requesting a new PM entry. Note that the transition to Active requires Active Entry handshake with the remote Link partner, and that will cause the remote partner to exit PM. If the Adapter LSM receives a "PM Request" sideband message after it has transitioned to Retrain, it must immediately respond with {LinkMgmt.Adapter0.Rsp.PMNAK}. Note: The precise timing of the remote Link partner that is observing Link Retrain is unknown; thus, the safer thing to do is to go to Active and redo the PM handshake when necessary for this scenario. There is a small probability that there might be an exit from PM and re-entry back in PM under certain scenarios. . Once the Adapter receives a "PM request" sideband message, it must respond to it within 2 us (the time is only counted during the Adapter LSM being in Active state): \- if its local Protocol Layer is requesting PM, it must respond with the corresponding "PM Response" sideband message after finishing the StallReq/Ack handshake with its Protocol Layer and its Retry buffer being empty. If the current status is not PM, it must transition pl_state_sts to PM after responding to the sideband message. \- If the current pl_state_sts = PM, it must respond with "PM Response" sideband message. \- If pl_state_sts = Active and 1p_state_req = Active and it remains this way for 1us after receiving the "PM Request" sideband message, it must respond with {LinkMgmt.Adapter0.Rsp.PMNAK} sideband message. The time is only counted during all the relevant state machines being in Active state. . If the Adapter receives a "PM Response" sideband message in response to a "PM Request" sideband message, it must transition pl_state_sts on its local FDI to PM (if it is currently in Active state). · If the Adapter receives a {LinkMgmt.Adapter0.Rsp.PMNAK} sideband message in response to a "PM Request" sideband message, it must transition pl_state_sts on its local FDI to Active.PMNAK state if it is currently in Active state. If it is not in Active state, no action needs to be taken. It is permitted to retry PM entry handshake (if all conditions of PM entry are satisfied) at least 2us after receiving the {LinkMgmt.Adapter0.Rsp.PMNAK} sideband message OR if it received a corresponding "PM Request" sideband message from the remote Link partner. · PM exit is initiated by the Protocol Layer requesting Active on FDI. After RDI is in Active, triggers the Adapter to initiate PM exit by performing the Active Entry handshakes on sideband. Figure 10-24 shows an example flow of PM exit on FDI when Adapter LSM is exposed. \- PM exit handshake completion requires both Adapters to send as well as receive a {LinkMgmt.Adapter0.Rsp.Active} sideband message. Once this has completed, the Adapter is permitted to transition Adapter LSM to Active. \- If pl_state_sts = PM and a {LinkMgmt.Adapter0.Req.Active} sideband message is received, the Adapter must initiate pl_clk_req handshake with the Protocol Layer, and transition Adapter LSM to Retrain (For L2 exit, the transition is to Reset). This must trigger the Protocol Layer to request Active on lp_state_req (if not already doing so), and this in turn triggers the Adapter to send {LinkMgmt.Adapter0.Req.Active} sideband message to the remote Link partner. Note that the following figures are examples and do not show the lp_wake_req, pl_clk_req, and/ or pl_rx_active_req handshakes. Implementations must follow the rules outlined for these handshakes in previous sections. <figure> <figcaption>Figure 10-21. PM Entry example for CXL or PCIe protocols</figcaption> DP Protocol Layer Die 0 DP Adapter Die 0 DP Physical layer Die 0 CHANNEL UP Physical layer Die 1 UP Adapter Die 1 UP Protocol Layer Die 1 pl_state_sts = Active pl_state_sts = Active lp_state_req=L1 Adapter must wait for 1us to see if Protocol Layer requests PM SB MSG {LinkMgmt.Adapter0.Req.L1}- Adapter must finish the pl_stallreq/lp_stallack handshake before sending side band message lp_state_req=L1 pl state_sts = L1 SB MSG {LinkMgmt.AdapterO.Rsp.L1}- Adapter must finish the pl_stallreq/lp_stallack handshake before sending sideband message pl_state_sts=L1 </figure> <figure> <figcaption>Figure 10-22. PM Entry example for symmetric protocol</figcaption> Protocol Layer Die 0 Adapter $D i e \quad 0$ Physical layer $D i e \quad 0$ CHANNEL Physical layer Die 1 Adapter $D i e \quad 1$ { \text { Protocol Layel } }<br>{ \text { Die } 1 } $p l \_ s t a t e \_ s t s = A c t i v e$ pl_state_sts =Active $\log = L$ Adapter must wait for 1us to see if Protocol Layer requests PM SB MSG {LinkMgmt.Adapter0.Req.L1 Adapter must finish the $p ! s \tan / l p _ { - } s t a l l a c k$ handshake before sending side band message $p _ { - } \text { state } _ { - } r e q = L 1$ SB MSG {LinkMgmt.Adapter0.Req.L1} SB MSG {LinkMgmt.Adapter0.Rsp.L1 $p l \_ s t a t e \_ s t s = L 1$ Adapter must pl_stallreq/lp_stallack handshake before sending side band message SB MSG {LinkMgmt.Adapter0.Rsp.L1} $p l \_ s t a t e \_ s t s = L 1$ </figure> <figure> <figcaption>Figure 10-23. PM Abort Example</figcaption> DP Protocol Layer Die 0 DP Adapter $D i e \quad 0$ DP Physical layer Die 0 CHANNEL UP Physical layer Die 1 UP Adapter $D i e \quad 1$ UP Protocol Layer Die 1 $p l \_ s t a t e \_ s t s = A c t i v e$ pl_state_sts = Active lp_state_req=Active $l p \_ s t a t e \_ r e q = L 1 -$ Adapter must wait for 1us to see if Protocol Layer requests PM SB MSG {LinkMgmt.Adapter0.Req.L1}. Adapter must finish the pl_stallreq/lp_stallack handshake before sending side band message SB MSG {LinkMgmt.Adapter0.Rsp.PMNAK} pl_state_sts = Active. PM NAK lp_state_req=Active pl_state_sts $= A c t i v e$ </figure> <figure> <figcaption>Figure 10-24. PM Exit Example</figcaption> Protocol Layer Die 0 Adapter Die 0 Physical layer Die 0 CHANNEL Physical layer Die 1 Adapter Die 1 Protocol Layer $D i e \quad 1$ pl_state_sts = L1 pl_state_sts =L1 $l p \_ s t a t e \_ r e q = A c t i v e$ SB MSG {LinkMgmt.Adapter0.Req.Active} -pl_state_sts = Retrain $p l _ { - } r x _ { - } \text { active } _ { - } r e q = 0 - > 1 -$ $P _ { - } r x _ { - } a c t i v e _ { - } s t s = 0 - > 1$ SB MSG {LinkMgmt.AdapterO.Rsp.Active} lp_state_req=Active SB MSG {LinkMgmt.Adapter0.Req.Active} $p l \_ s t a t e \_ s t s = R e t r a i n -$ pl_rx_active_req=0->1- lp_rx_active_sts $= 0 - > 1$ SB MSG {LinkMgmt.Adapter0.Rsp.Active} $p l \_ s t a t e \_ s t s = A c t i v e -$ pl_state sts = Active Adapter opens TX and moves to Active status once it has sent and received an Active Status Adapter opens TX and moves to Active status once it has sent and received an Active Status If ARB/MUX exits, it performs the ALMP exchanges with remote ARB/MUX before moving pl_state_sts to Active for the Protocol Layer </figure> # 10.3 Common rules for FDI and RDI This section covers common set of rules applicable to FDI and RDI and cross-interactions between them. Any applicable differences are called out as well. To have common terminology for the common set of rules, Upper Layer is used to refer to Adapter for RDI, and Protocol Layer for FDI. Lower Layer is used to refer to Physical Layer for RDI and Adapter for FDI. Because Active.PMNAK is a sub-state of Active, all rules that apply for Active are also applicable for Active.PMNAK; however the state status cannot move from Active. PMNAK directly to L1 or L2 due to the rules requiring the Upper Layer to request a transition to Active before requesting PM again. ## 10.3.1 Byte Mapping for FDI and RDI The Flit Format figures in Chapter 3.0 show examples of how a Flit is laid out on a 64B datapath when sent over FDI or RDI. Figure 10-25 shows an example of a CXL.io Standard 256B Start Header Flit for reference. Each Flit takes four data transfers across FDI or RDI when the data width is 64 Bytes. Each data transfer is referred to a Flit Chunk, numbered in increasing order within an entire Flit transfer. For every data transfer, the Least Significant Byte from the corresponding Flit Chunk is mapped to Byte 0 on FDI (or RDI), the next Byte from the Flit is mapped to Byte 1 on FDI (or RDI), and so on. Within each Byte, bit 0 of the Byte from the Flit maps to bit 0 of the corresponding Byte on FDI (or RDI), and so on. The same mapping applies for both transmit and receive directions. For example, in Transfer 0, Byte 0 of the Flit is mapped to Byte 0 of FDI (or RDI), Byte 1 of the Flit is mapped to Byte 1, and so on. In transfer 1, Byte 64 of the Flit is mapped to Byte 0 of FDI (or RDI), Byte 65 of the Flit is mapped to Byte 1 of FDI (or RDI) and so on. This example is illustrated in Figure 10-26. Data transfers follow the rules outlined in Section 10.1.4 for RDI and Section 10.2.4 for FDI and hence do not necessarily correspond to consecutive clock cycles. <figure> <figcaption>Figure 10-25. CXL.io Standard 256B Start Header Flit Format Exampleª</figcaption> +0 +1 +2 +45 +46 +49 +50 +59 $\frac { 8 } { 4 }$ $+ 6 3$ Byte 0 FH B0b FH B1b 62B of Flit Chunk 0 (from Protocol Layer) Byte 64 Flit Chunk 1 64B (from Protocol Layer) Byte 128 Flit Chunk 2 64B (from Protocol Layer) Byte 192 46B of Flit Chunk 3 (from Protocol Layer) DLP B2C DLP B3c DLP B4c DLP B5c 10B Reserved C0 B0d C0 B1d C1 B0d C1 B1d </figure> a. See Figure 2-1 for color mapping. b. Flit Header Byte 0 and Byte 1, respectively. c. DLP Byte 2, Byte 3, Byte 4, and Byte 5, respectively. d. CRC0 Byte 0, CRC0 Byte 1, CRC1 Byte 0, and CRC1 Byte 1, respectively. <table> <caption>Figure 10-26. FDI (or RDI) Byte Mapping for 64B Datapath to 256B Flits</caption> <tr> <th rowspan="2">Transfer (Rows)</th> <th colspan="8">$F D I \left( o r \quad R D I \right) B y t e s$</th> </tr> <tr> <th>0</th> <th>1</th> <th>2</th> <th>...</th> <th>60</th> <th>61</th> <th>62</th> <th>63</th> </tr> <tr> <td>0</td> <td>Flit Byte 0</td> <td>Flit Byte 1</td> <td>Flit Byte 2</td> <td>...</td> <td>Flit Byte 60</td> <td>Flit Byte 61</td> <td>Flit Byte 62</td> <td>Flit Byte 63</td> </tr> <tr> <td>1</td> <td>Flit Byte 64</td> <td>Flit Byte 65</td> <td>Flit Byte 66</td> <td>...</td> <td>Flit Byte 124</td> <td>Flit Byte 125</td> <td>Flit Byte 126</td> <td>Flit Byte 127</td> </tr> <tr> <td>2</td> <td>Flit Byte 128</td> <td>Flit Byte 129</td> <td>Flit Byte 130</td> <td>...</td> <td>Flit Byte 188</td> <td>Flit Byte 189</td> <td>Flit Byte 190</td> <td>Flit Byte 191</td> </tr> <tr> <td>3</td> <td>Flit Byte 192</td> <td>Flit Byte 193</td> <td>Flit Byte 194</td> <td>...</td> <td>Flit Byte 252</td> <td>Flit Byte 253</td> <td>$F l i t \quad B y t e \quad 2 5 4$</td> <td>Flit Byte 255</td> </tr> </table> If the FDI or RDI datapath width is increased (or decreased), the Byte mapping follows the same convention of increasing order of Flit bytes mapped to increasing order of FDI (or RDI) bytes. Figure 10-27 shows an illustration of a 128B data path. <table> <caption>Figure 10-27. FDI (or RDI) Byte Mapping for 128B Datapath to 256B Flits</caption> <tr> <th rowspan="2">Transfer (Rows)</th> <th colspan="12">FDI (or RDI) Bytes (Columns)</th> </tr> <tr> <th>0</th> <th>1</th> <th>2</th> <th>...</th> <th>62</th> <th>63</th> <th>64</th> <th>65</th> <th>...</th> <th>125</th> <th>126</th> <th>127</th> </tr> <tr> <td>0</td> <td>$\mathrm { F l i t B y t e }$ 0</td> <td>Flit Byte 1</td> <td>Flit Byte 2</td> <td>...</td> <td>Flit Byte 62</td> <td>Flit Byte 63</td> <td>Flit Byte 64</td> <td>Flit Byte 65</td> <td>...</td> <td>Flit Byte 125</td> <td>Flit Byte 126</td> <td>Flit Byte 127</td> </tr> <tr> <td>1</td> <td>$\mathrm { F l i t B y t e }$ 128</td> <td>$\mathrm { F l i t B y t e }$ 129</td> <td>$\mathrm { F I i t B y t e }$ 130</td> <td>...</td> <td>Flit Byte 190</td> <td>Flit Byte 191</td> <td>Flit Byte 192</td> <td>Flit Byte 193</td> <td>...</td> <td>Flit Byte 253</td> <td>Flit Byte 254</td> <td>Flit Byte 255</td> </tr> </table> For 68B Flit Formats, the Protocol Layer transfers only 64B of payload information from the Flit over FDI (the Flit Header and CRC are inserted by the Adapter). Thus, if the datapath is 128B wide, two such transfers will happen at a given clock cycle as shown in Figure 10-28. The numbering in the figure still uses the Byte positions relative to the overall Flit, hence Byte 0 corresponds to Flit 0 Byte 2, etc. On the Transmit path, the Protocol Layer inserts empty slots (i.e., bytes with a value of 00h) to populate the entire width of the bus if the interface width is greater than 64B and there is insufficient payload information to transmit. The Adapter does the same on the Receive path. <table> <caption>Figure 10-28. FDI Byte Mapping for 128B Datapath for 68B Flit Format</caption> <tr> <th rowspan="2">Transfer (Rows)</th> <th colspan="12">FDI Bytes (Columns)</th> </tr> <tr> <th>0</th> <th>1</th> <th>2</th> <th>...</th> <th>62</th> <th>63</th> <th>64</th> <th>65</th> <th>…</th> <th>125</th> <th>126</th> <th>127</th> </tr> <tr> <td>0</td> <td>Flit 0 Byte 2</td> <td>Flit 0 Byte 3</td> <td>Flit 0 Byte 4</td> <td>...</td> <td>Flit 0 Byte 64</td> <td>Flit 0 Byte 65</td> <td>Flit 1 Byte 2</td> <td>Flit 1 Byte 3</td> <td>...</td> <td>Flit 1 Byte 63</td> <td>Flit 1 Byte 64</td> <td>Flit 1 Byte 65</td> </tr> </table> For 68B Flit Formats, Adapter inserts the Flit Header and CRC bytes, and performs the necessary shifting before transferring the bytes over RDI. Thus, if the data path is 128B wide, the byte mapping will follow as shown in Figure 10-29. The remainder of Flit 1 continues on the next transfer, etc. Given that the Adapter must insert PDS bytes before pausing the data stream, which makes the transfer a multiple of 256B, the transfer naturally aligns when the width of RDI is 64B, 128B, or 256B on both the Transmit and Receive directions. For wider than 256B interfaces, see the Implementation Note below. <table> <caption>Figure 10-29. RDI Byte Mapping for 128B Datapath for 68B Flit Format</caption> <tr> <th rowspan="2">Transfer (Rows)</th> <th colspan="12">RDI Bytes (Columns)</th> </tr> <tr> <th>0</th> <th>1</th> <th>2</th> <th>...</th> <th>65</th> <th>66</th> <th>67</th> <th>68</th> <th>...</th> <th>125</th> <th>126</th> <th>127</th> </tr> <tr> <td>0</td> <td>Flit 0 Byte 0</td> <td>$F l i t \quad 0$ Byte 1</td> <td>$F l i t \quad 0$ Byte 2</td> <td>...</td> <td>Flit 0 $B y t e \quad 6 5$</td> <td>Flit 0 Byte 66</td> <td>Flit 0 Byte 67</td> <td>Flit 1 Byte 0</td> <td>...</td> <td>Flit 1 $B y t e \quad 5 7$</td> <td>Flit 1 Byte 58</td> <td>Flit 1 Byte 59</td> </tr> <tr> <td>1</td> <td>Flit 1 Byte 60</td> <td>Flit 1 Byte 61</td> <td>Flit 1 Byte 62</td> <td></td> <td></td> <td>...</td> <td>...</td> <td></td> <td>...</td> <td>...</td> <td></td> <td></td> </tr> </table> The frequency of operation of the interfaces along with the data width determines the maximum bandwidth that can be sustained across the FDI (or RDI) interface. For example, a 64B datapath at 2 GHz of clock frequency is required to sustain a 16 GT/s Link for an Advanced Package configuration with a single module. Similarly, to scale to 32 GT/s of Link speed operation for Advanced Package configuration with a single module, a 128B datapath running at 2 GHz would be required to support the maximum Link bandwidth. The FDI (or RDI) byte mapping for the transmit or receive direction does not change for multi-module configurations. The MMPL logic within the Physical Layer is responsible for ensuring that the bytes are transmitted in the correct order to the correct module. Any byte swizzling or rearrangement to resolve module naming conventions, etc., is thus the responsibility of the MMPL logic. Note that for PCIe and CXL protocols, the 8b/10b or 128b/130b encodings defined in the PCIe Base Specification are not used when transporting over UCIe. ### IMPLEMENTATION NOTE #### NBYTES For Raw Format, the value of NBYTES is vendor-defined. This Implementation Note is for UCIe Flit mode. It is strongly recommended that when operating in UCIe Flit mode, NBYTES is chosen to be one of 64, 128, 256, or 512 and is selected to get the best KPI (e.g., latency, area, etc.) for the desired bandwidth from the UCIe Link. If NBYTES is chosen to be larger than or equal to 512, it is strongly recommended that it is a multiple of 256 and is only done for the case of a four module Advanced Package Link designed for 16 GT/s or higher. Data transfer over the Link for all Flit formats defined in UCIe Flit mode are in a granularity of 256B, so aligning to a multiple of that avoids unnecessary shifting and corresponding tracking. For situations in which the RDI or FDI data path is wider than 256B, the following considerations apply for interoperability: . On the Transmit side, it is required to send valid data corresponding to the full width of the interface. For FDI, this would mean the Protocol Layer might need to pack a Protocol Flit with empty slots. For RDI, this would mean the Adapter might need to insert NOP Flits (for 68B Flit Format, PDS bytes are also included as valid data for this purpose). · On the Receive side, for RDI: It is possible that the Physical Layer has to wait to accumulate sufficient bytes before transmitting over RDI. The Physical Layer must accumulate data in multiples of 256B and if the accumulated data is less than the RDI width, it must wait for a sufficient gap in valid data transfer on the Physical Link (at least 16 UI for differential clock and 32 UI for quadrature clock) before transmitting this data on RDI. In this scenario, the accumulated data is sent on the lower significant bytes of the RDI, and any remaining bytes on the interface are assigned to all 0s. For 256B Flit Formats, a Flit Header which is 0000h with a CRC of 0000h is silently discarded by the Adapter. It is also not included for the purposes of Runtime Link Testing. For 68B Flit Formats, the Adapter is expected to keep track of the PDS bytes (because these are included in Runtime Link Testing). Any extra padding beyond that is silently discarded and not included for the purposes of Runtime Link Testing. · On the Receive side, for FDI: The Adapter must accumulate data in multiples of 256B before forwarding to the Protocol Layer. If the accumulated data is less than the FDI width, it gets sent on the lower significant bytes of the FDI, and any remaining bytes on the interface are assigned to 0b. For 256B Flit Formats, a Flit Header of 0000h is a NOP for the Protocol Layer and is discarded. For 68B Flit Formats, 00h are IDLE symbols for PCIe/CXL.io or Empty slots for CXL.cachemem, both of which get discarded by the Protocol Layer. For Streaming protocols that use 68B Flit Formats, it is recommended to use the same approach. · lp_corrupt_crc, pl_flit_cancel, and pl_error apply to all the Flits that are transferred at the corresponding clock cycle. If applicable, it is recommended to set NDLLP to 32 for these applications and limit the DLLP throughput to be 1 per clock cycle on FDI. ## 10.3.2 Stallreq/Ack Mechanism The Stallreq/Ack mechanism is used by the Lower Layer to interrupt the Flit transfers by the Upper Layer at a Flit boundary. On RDI, the Stallreq/Ack mechanism must be used when exiting Active state to Retrain, PM, LinkReset or Disabled states. On FDI, for UCIe Raw Format, the Stallreq/Ack mechanism must be used when exiting Active state to Retrain, PM, LinkReset or Disabled states. On FDI, for UCIe Flit Mode, the Stallreq/Ack mechanism must only be used when exiting Active State to a PM state. For other scenarios that exit Active state for UCIe Flit mode, the Adapter must simply de- assert pl_trdy at a Flit boundary before state transition. The Stallreq/Ack mechanism is mandatory for all FDI and RDI implementations. lp_stallack assertion implies that Upper Layer has stalled its pipeline at a Flit aligned boundary. The pl_stallreq/lp_stallack handshake is a four-phase sequence that follows the rules below: 1\. The pl_stallreq and lp_stallack must be de-asserted before domain reset exit. 2\. A rising edge on pl_stallreq must only occur when lp_stallack is de-asserted. 3\. A falling edge on pl_stallreq must only occur when lp_stallack is asserted or when the domain is in reset. 4\. A rising edge on lp_stallack must only occur when pl_stallreq is asserted. lp_stallack must only be asserted after the data stream reaches a clean boundary. For the case of the Adapter asserting lp_stallack to the Physical Layer for 68B Flit Formats, this requires that PDS, as well as the corresponding padding of Os and any parity bytes injected, has been transmitted. For 256B Flit Formats, the clean boundary aligns with a Flit boundary. 5\. A falling edge on lp_stallack must only occur when pl_stallreq is de-asserted or when domain is in reset. 6\. When lp_stallack is asserted lp_valid and lp_irdy must both be de-asserted. 7\. While pl_stallreq is asserted, any data presented on the interface must be accepted by the physical layer until the rising edge of lp_stallack. pl_trdy is not required to be asserted consecutively. 8\. The logic path between pl_stallreq and lp_stallack must contain at least one flip-flop to prevent a combinatorial loop. 9\. A complete stallreq/stallack handshake is defined as the completion of all four phases: Rising edge on pl_stallreq, rising edge on lp_stallack, falling edge on pl_stallreq, falling edge on lp_stallack. 10\. It is strongly recommended that Upper Layer implements providing lp_stallack on a global free running clock so that it can finish the handshake even if the rest of its logic is clock gated. To avoid performance penalties, it is recommended that this handshake be completed as quickly as possible while satisfying the above rules. ### IMPLEMENTATION NOTE In multiple places within this specification, for state transitions, it is referring to completing the Stallreq/Ack handshake before the state transition. In the context of state transitions, there are two acceptable ways to implement this from the lower layer: · One implementation from the lower layer would follow the sequence: i. Assert pl_stallreq. ii. After lp_stallack is asserted, perform the necessary actions for state transition (including deassertion of pl_trdy and the update of pl_state_sts). iii. De-assert pl_stallreq. Once lp_stallack de-asserts, the state transition is considered complete. · The alternate implementation from the lower layer would follow the sequence: i. Assert pl_stallreq. ii. After lp_stallack is asserted, de-assert pl_trdy. iii. De-assert pl_stallreq and subsequently perform the necessary actions for state transition and the update of pl_state_sts. State transition is considered complete after pl_state_sts update and lp_stallack de-assertion. ## 10.3.3 State Request and Status Table 10-4 describes the Requests considered by the Lower layer in each of the interface states. The Upper layer must take into account the interface state status and make the necessary request modifications. The requests are listed on the Row and the state status is listed in the Column. The entries in Table 10-4 denote the following: . Yes: Indicates that the request is considered for next state transition by the lower layer. · N/A: Not Applicable . Ignore: Indicates that the request is ignored and has no effect on the next state transition. <table> <caption>Table 10-4. Requests Considered in Each State by Lower Layer</caption> <tr> <th>Request (Row) Versus Status (Column)</th> <th>Reset</th> <th>Active</th> <th>L1</th> <th>LinkReset</th> <th>Retrain</th> <th>Disable</th> <th>L2</th> <th>LinkError</th> </tr> <tr> <td>NOP</td> <td>Yes</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> </tr> <tr> <td>Active</td> <td>$\mathrm { Y e s } ^ { \mathrm { a } }$</td> <td>Ignoreb</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> </tr> <tr> <td>L1</td> <td>Ignore</td> <td>Yes</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> </tr> <tr> <td>LinkReset</td> <td>Yesª</td> <td>Yes</td> <td>Yes</td> <td>Ignore</td> <td>Yes</td> <td>Ignore</td> <td>Yes</td> <td>Ignore</td> </tr> <tr> <td>Retrain</td> <td>Ignore</td> <td>Yes</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> </tr> <tr> <td>Disable</td> <td>Yesª</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> <td>Ignore</td> <td>Yes</td> <td>Ignore</td> </tr> <tr> <td>L2</td> <td>Ignore</td> <td>Yes</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> <td>Ignore</td> </tr> <tr> <td>{ \text { LinkError } }<br>{ \text { \left(sideband wire\right) } }</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> <td>Yes</td> </tr> </table> a. Requires request transition from NOP b. If the Status is Active. PMNAK, then the Lower Layer transitions to Active upon sampling the Active Request. ### 10.3.3.1 Reset State rules The Reset State can be entered on de-assertion of interface reset signal or from LinkReset/Disable/ LinkError/L2 states. In Reset state, the physical layer is permitted to begin its initialization/training process. The pl_state_sts is not permitted to exit Reset state until requested by the upper layer. The exit from Reset state is requested by the upper layer by changing the Ip_state_req signal from NOP encoding value to the permitted next state encoding value. The rules for Reset state transition are as follows: 1\. Reset->Active: The lower layer triggers transitions to the Active state upon observing lp_state_req == Reset (NOP) for at least one clock while pl_state_sts is indicating Reset followed by observing lp_state_req == Active. The transition to Active is only completed once the corresponding Active Entry handshakes have completed on the Link. For RDI, it is when the Physical Layer has sent and received an Active Response sideband message to and from the remote Physical Layer respectively. For the Adapter LSM, it is when the Adapter has sent and received an Active Status sideband message to and from the remote Adapter respectively. For the ARB/MUX vLSM, it is when the ARB/MUX has sent and received an Active Status ALMP to and from the remote ARB/MUX respectively. 2\. Reset->LinkReset: The lower layer transitions to the LinkReset state upon observing lp_state_req == Reset (NOP) for at least one clock while pl_state_sts is indicating Reset followed by observing lp_state_req = = LinkReset OR when requested by remote Link partner through the relevant sideband message. The lower layer is permitted to transition through Active State, and when it does, Active state exit conditions apply. 3\. Reset->Disabled: The lower layer transitions to the Disabled state upon observing 1p_state_req == Reset (NOP) for at least one clock while pl_state_sts is indicating Reset followed by observing lp_state_req == Disabled OR when requested by the remote Link partner through the relevant sideband message. The lower layer is permitted to transition through Active State, and when it does, Active state exit conditions apply. 4\. Reset->LinkError: The lower layer transitions to LinkError based on observing an internal request to move to the LinkError or lp_linkerror assertion. For RDI, this transition is permitted if requested by the remote Link partner through the relevant sideband message. ### 10.3.3.2 Active State rules The Active state to next state transitions are described below. The rules for Active State transition are as follows: 1\. Active->Retrain: The Lower layer transitions to the Retrain state upon observing 1p_state_req == Retrain or due to an internal request to retrain the Link while pl_state_sts == Active. This arc is not applicable for CXL vLSMs exposed on FDI (CXL Flit Mode with Retry in the Adapter). 2\. Active->L1: The physical layer transitions to L1 based on observing 1p_state_req == L1 while in the Active state, if other conditions of PM entry have also been satisfied. 3\. Active->L2: The physical layer transitions to L2 based on observing 1p_state_req == L2 while in the Active state, if other conditions of PM entry have also been satisfied. It is permitted to have an Active.PMNAK to Retrain/LinkReset/Disable/LinkError transition for cases where Lower Layer is waiting for the Upper Layer to change the request to Active and the corresponding Link event triggers it. There is no scenario where there is a transition from Active. PMNAK to L1 or L2. Section 10.3.3.8 describes the transition from Active or Active.PMNAK to LinkReset, Disable, or LinkError states. ### 10.3.3.3 PM Entry/Exit Rules See the PM entry and exit sequences in the RDI and FDI sections. ### 10.3.3.4 Retrain State Rules Adapter requests Retrain on RDI if any of the following events occur: · Software writes to the Retrain bit and the Link is in Active state. · Number of CRC or parity errors detected crosses a threshold. The specific algorithm for determining this is implementation specific. · Protocol Layer requests Retrain (only applicable for UCIe Raw Format). · any other implementation specific condition (if applicable). Physical Layer triggers a Retrain transition on RDI if: · Valid framing errors are observed · Remote Physical Layer requests Retrain entry · Adapter requests Retrain Protocol Layer must not request Retrain on FDI, unless UCIe is operating in UCIe Raw Format. A Retrain transition on RDI must always be propagated to Adapter LSMs that are in Active. Retrain transitions of the UCIe Link are not propagated to CXL vLSMs. Upon Retrain entry, the credit counter for UCIe Retimer (if present) must be reset to the value advertised during initial Link bring up (the value is given by the "Retimer_Credits" Parameter in the {AdvCap.Adapter} sideband message during initial Link bring up). The Retimer must drain or dump any Flits in flight or its internal transport buffers upon entry to Retrain. Additionally, the Retimer must trigger Retrain of the remote UCIe Link (across the Off-Package Interconnect). Entry into Retrain state resets power management state for the corresponding state machine, and power management entry if required must be re-initiated after the interface enters Active state. If there was an outstanding PM request that returns PM Response, the corresponding state machine must perform Active Entry handshakes to bring that state machine back to Active. The rules for Retrain state transition are as follows: 1\. Retrain->Active: If Retrain was entered from L1, the lower layer begins Active Entry handshakes upon observing lp_state_req == Active while the pl_state_sts == Retrain or L1. If Retrain was entered from Active, the lower layer begins Active Entry handshakes only after observing a NOP-> Active transition on lp_state_req. Lower layer transitions to Active once the corresponding Active Entry handshakes have completed. Exit from Retrain on RDI requires the Active Entry handshakes to have completed between Physical Layers. Exit from Retrain on FDI must ensure that RDI has moved back to Active, and Active Entry handshakes have successfully completed between Adapters (for the Adapter LSM). 2\. Transitional state: The lower layer is permitted to transition to the Active state upon observing lp_state_req == LinkReset or Disabled while the pl_state_sts == Retrain. Following the entry into Active the lower layer is permitted to make a transition to the requested state. Section 10.3.3.8 describes Retrain exit to LinkReset, Disable, or LinkError states. Note: The requirement to wait for NOP->Active transition ensures that the Upper Layer has a way to delay Active transition in case it is waiting for any relevant sideband handshakes to complete (for example the Parity Feature handshake). ## 10.3.3.5 LinkReset State Rules LinkReset is used for reset flows (HotReset equivalent in PCIe, Protocol Layer must use this to propagate SBR to the device as well) to convey device and/or Link Reset across the UCIe Link. Adapter triggers LinkReset transition upon observing a LinkReset request from the Protocol Layer, OR on receiving a sideband message requesting LinkReset entry from the remote Link partner OR an implementation specific internal condition (if applicable). Implementations must make best efforts to gracefully drain the Retry buffers when transitioning to LinkReset, however, entry to LinkReset must not timeout on waiting for the Retry buffer to drain. The Protocol Layer and Adapter must drain/flush their pipelines and retry buffer of the Flits for the corresponding Protocol Stack once the FDI state machines have entered LinkReset. If all the FDI state machines and Adapter LSMs are in LinkReset, the Adapter triggers RDI to enter LinkReset as well. The rules for LinkReset State transitions are as follows: 1\. LinkReset->Reset: The lower layer transitions to the Reset state due to an internal request to move to Reset (example reset pin trigger) or lp_state_req == Active while pl_state_sts == LinkReset and all necessary actions with respect to LinkReset have been completed. 2\. LinkReset->Disabled: The lower layer transitions to Disabled based on observing 1p_state_req == Disabled or due to an internal request to move to Disabled while pl_state_sts == LinkReset. 3\. Transitional State: The PHY is permitted to transition through Reset State, and when it does, Reset state exit conditions apply. 4\. LinkReset->LinkError: The lower layer transitions to LinkError due to an internal request to move to LinkError or lp_linkerror assertion while pl_state_sts == LinkReset. ## 10.3.3.6 Disabled State Rules Adapter triggers Disabled entry when any of the following events occur: · Protocol Layer requests entry to Disabled state · Software writes to the Link Disable bit corresponding to the underlying Protocol (e.g., the Link Disable bit in the Link Control register in PCIe) · Remote Link partner requests entry to Disabled state through the relevant sideband message · An implementation specific internal condition (if applicable) Implementations must make best efforts to gracefully drain the Retry buffers when transitioning to Disabled, however, entry to Disabled must not timeout on waiting for the Retry buffer to drain. The Protocol Layer and Adapter must drain/flush their pipelines and retry buffer of the Flits for the corresponding Protocol Stack once the FDI state machines have entered Disabled. If all the FDI state machines and Adapter LSMs are in Disabled, the Adapter triggers RDI to enter Disabled as well. The rules for Disabled State are as follows: · Disabled->Reset: The lower layer transitions to the Reset state due to an internal request to move to Reset (example reset pin trigger) or lp_state_req == Active while pl_state_sts == Disabled and all necessary actions with respect to Disabled transition have completed. · Disabled->LinkError: The lower layer transitions to LinkError due to an internal request to move to LinkError or lp_linkerror assertion while pl_state_sts == Disabled. ## 10.3.3.7 LinkError State Rules The lower layer enters LinkError state when directed by an lp_linkerror signal or due to Internal LinkError conditions. For RDI, the entry is also triggered if the remote Link partner requested LinkError entry through the relevant sideband message. It is not required to complete the stallreq/ack handshake before entering this state. However, for implementations where LinkError state is not a terminal state (terminal implies SoC needs to go through reset flow after reaching LinkError state), it is expected that software can come and retrain the Link after clearing error status registers, etc., and the following rules should be followed: . If the lower layer decides to perform a pl_stallreq/lp_stallack handshake, it must provide pl_trdy to the upper layer to drain the packets. In cases where there is an uncorrectable internal error in the lower layer, these packets could be dropped and not transmitted on the Link. . It is required for the upper layer to internally clean up the data path, even if pl_trdy is not asserted and it has sampled LinkError on pl_state_sts for at least one clock cycle. The lower layer may enter LinkError state due to Internal LinkError requests such as when: · Encountering uncorrectable errors due to hardware failure or directed by Upper Layer · Remote Link partner requests entry into LinkError (RDI only) The rules for LinkError state are as follows: · LinkError->Reset: The lower layer transitions to Reset due to an internal request to move to Reset (e.g., reset pin assertion, or software clearing the error status bits that triggered the error) OR (lp_state_req == Active and lp_linkerror = 0, while pl_state_sts == LinkError AND minimum residency requirements are met AND no internal condition such as an error state requires the lower layer to remain in LinkError). Lower Layer must implement a minimum residency time in LinkError of 16 ms to ensure that the remote Link partner will be forced to enter LinkError due to timeouts (to cover for cases where the LinkError transition happened and sideband was not functional). ## 10.3.3.8 Common State Rules This section covers some of the common conditions for exit from Active, Retrain, L1, and L2 to LinkReset, Disable and LinkError states. For RDI, PM encoding and rules correspond to L1 in the text below. The rules are as follows: · [Active, Retrain, L1, L2]->LinkReset: The lower layer transitions to LinkReset based on observing lp_state_req == LinkReset or due to an internal request to move to LinkReset or the remote Link partner requesting LinkReset over sideband. · [Active, Retrain, L1, L2]->Disabled: The lower layer transitions to Disabled based on observing lp_state_req == Disabled or due to an internal request to move to Disabled while pl_state_sts == Active, or the remote Link partner requesting Disabled over sideband. · [Active, Retrain, L1, L2]->LinkError: The lower layer transitions to LinkError based on observing an internal request to move to the LinkError or lp_linkerror assertion, or the remote Link partner requesting LinkError over sideband. RDI must move to LinkError before propagating LinkError to all Adapter LSMs. From a state machine hierarchy perspective, it is required for Adapter LSM to move to LinkReset, Disabled or LinkError before propagating this to CXL vLSMs. This ensures CXL rules are followed where these states are "non-virtual" from the perspective of CXL vLSMs. Adapter LSM can transition to LinkReset or Disabled without RDI transitioning to these states. In the case of multi-protocol stacks over the same Physical Link/Adapter, each Protocol can independently enter these states without affecting the other protocol stack on the RDI. If all the Adapter LSMs have moved to a common state of LinkReset/Disabled or LinkError, then RDI is taken to the corresponding state. If however, the Adapter LSMs are in different state combinations of LinkError, Disabled or LinkReset, the RDI is moved to the highest priority state. The priority order from highest to lowest is LinkError, Disabled, LinkReset. For a LinkError/LinkReset/Disabled transition on RDI, Physical Layer must initiate the corresponding sideband handshake to transition remote Link partner to the required state. If no response is received from remote Link partner for this message after 8ms, RDI transitions to LinkError. If RDI moves to a state that is of a higher priority order than the current Adapter LSM, it is required for the Adapter to propagate that to the Adapter LSM using sideband handshakes to ensure the transition with the remote Link partner. After transition from LinkError/LinkReset/Disable to Reset on RDI, the Physical Layer must not begin training unless the Physical Layer observes a NOP->Active transition on lp_state_req from the Adapter or observes one of the Link Training triggers defined in Chapter 4.0. The Adapter should not trigger NOP->Active unless it receives this transition from the Protocol Layer or has internally decided to bring the Link Up. The Adapter must trigger this on RDI if the Protocol Layer has triggered this even if pl_inband_pres = 0. Thus, if the Protocol Layer is waiting for software intervention and wants to hold back the Link from training, it can delay the NOP->Active trigger on FDI. Upper Layers are permitted to transition lp_state_req back to NOP after giving the NOP->Active trigger in order to clock gate while waiting for pl_inband pres to assert. If RDI transitions to L2, the exit is through Reset, and complete Link Initialization and Training flow will occur (including a fresh Parameter Exchange for the Adapter). After transition from L2 to Reset on RDI, the LTSM will begin the Link PM exit and retraining flow when a {LinkMgmt.RDI.Req.Active} sideband message is received or when the Adapter requests Active on RDI or it observes one of the Link Training triggers defined in Chapter 4.0. If the Adapter LSM transitions to L2, but RDI does not go to a Link down state (i.e. Reset, LinkReset, Disabled, LinkError), then this is a "virtual" L2 state. The exit from L2 for the Adapter LSM in this case will go through Reset for the Adapter LSM, but it does not result in a fresh Parameter Exchange for the Adapter, and the protocol parameters and the Flit Formats remain the same as prior to L2 entry. An example of this is if there are multiple stacks on the same Adapter, and only one of the FDIs transitions to L2. # IMPLEMENTATION NOTE ## LinkReset/Disabled LinkReset and Disabled flows are primarily provided as a means to notify the remote Link partner that the corresponding Protocol Layer intends to trigger the set of actions defined for these by the underlying protocol (e.g., in the case of PCIe and CXL, both of these result in a Conventional Reset on the Upstream Port as defined in the PCIe Base Specification). These are typically controlled and co-ordinated through software/firmware. Note that regardless of protocol, there is no hardware mechanism from the UCIe Adapter or Physical Layer to guarantee quiescence or graceful draining of transactions for the LinkReset or Disabled transitions. If this is required by the underlying protocol, it must be handled through software/firmware or other implementation-specific mechanisms outside the UCIe Adapter and Physical Layer. If the RDI state is already in a Link down state (i.e., Reset, LinkReset, Disabled, LinkError) and the Link is not currently training (Adapter can infer this from pl_phyinrecenter), then there is no need to notify the remote Link partner. Adapter or Physical Layer can complete the state transitions locally for this case. If RDI is in RESET and the Link is training, it is recommended to wait for training to complete before triggering a state transition with the remote Link partner to LinkReset or Disabled. The following is written for Disabled state, but applies to both Disabled and LinkReset states. . For PCIe or CXL protocols, the Downstream Port initiates the transition to Disabled. Because the Upstream Port goes through a Conventional Reset after transitioning to Disabled, the Upstream Port waits for Downstream Port to re-initiate Link Training once the corresponding SoC reset flow has finished. · For Streaming protocols, \- The initiating Protocol Layer transitions lp_state_req to Disabled. If the necessary conditions are met from the Adapter perspective (for example, attempting to drain the Retry buffer etc.), it forwards the request using the corresponding sideband message to the remote Link partner's Adapter. \- On the remote Link partner, the Adapter transitions pl_state_sts to the requested state once the necessary conditions are met from the Adapter perspective (for example, attempting to drain the Retry buffer etc.). It also sends the corresponding sideband message response. If the Adapter needs to take the RDI to Disabled state, it is recommended to keep FDI pl_state_sts in Disabled state until that flow has completed. Otherwise, if the exit conditions for Disabled are met, it is permitted to transition to Reset state on FDI. Following this, the Protocol Layer on the remote Link partner in turn is permitted bring the FDI state back to Disabled if required by the underlying protocol. The Adapter must not trigger another sideband handshake for this scenario. \- The initiating Adapter transitions pl_state_sts to Disabled upon receiving the sideband message response. \- The Protocol Layers on either side of the Link can initiate an exit flow by requesting Active when pl_state_sts is Disabled, followed by a NOP->Active transition after the pl_state_sts is Reset. · For configurations in which the Adapter is servicing multiple Protocol Layers, the Disabled or LinkReset handshakes are independent per Protocol Layer. In case the Adapter LSM has transitioned to Reset from Disabled or LinkReset for a given Protocol Layer, the Adapter must keep track of the most-recent previous state to determine the correct resolution for RDI state request. ### 10.3.4 Vendor-defined Signals Optional Vendor-defined signals are provided for implementations. One use case for such signals is when protocols mapped to UCIe Raw Format would benefit from repurposing the Retimer credit encodings transmitted over the TXVLD/RXVLD pair of bumps on a UCIe Link to transmit an additional bit of vendor-defined information for every 8 UI of transfer per module. This information could be used for synchronization markers, ECC, etc .; the mapping of protocol- specific information to these encodings and when they are used is beyond the scope of this specification. Table 10-5 lists the TXVLD/RXVLD encodings and associated bit encodings. <table> <caption>Table 10-5. Mapping of Vendor-defined Bits that Use TXVLD/RXVLD Encodings</caption> <tr> <th>TXVLD/RXVLD Encoding</th> <th>lp_vendor_defined/ pl_vendor_defined Bit Encoding</th> <th>lp_valid/pl_valid Bit Encoding</th> </tr> <tr> <td>0000 0000b</td> <td>0</td> <td>0</td> </tr> <tr> <td>0000 1111b</td> <td>0</td> <td>1</td> </tr> <tr> <td>1111 1111b</td> <td>1</td> <td>1</td> </tr> </table> Similar to Retimer encodings, receivers are permitted to correct for single-bit errors on the received RXVLD encoding. To enable interoperability, implementations that target applications such as mapping protocols like JESD204E over UCIe Raw Format are strongly recommended to follow these rules: · The lp_vendor_defined and pl_vendor_defined signals are only relevant when 1p_valid and pl_valid are asserted, respectively (see Table 10-5 for the encodings and Figure 10-30 for an example). · The lp_vendor_defined and pl_vendor_defined signals are pipeline matched with lp_data and pl_data, respectively, such that they convey the encoding transmitted over TXVLD/RXVLD for the corresponding 8 UI of data. · In a multi-module Link, each module independently transmits or receives information using these encodings over its TXVLD/RXVLD pair of bumps. \- The lp_vendor_defined and pl_vendor_defined signals provide one bit for every 8 UI on the TXVLD and RXVLD bumps for every module that is part of the UCIe Link. Thus, the value of the "VS" parameter (i.e., the width of the 1p_vendor_defined or pl_vendor_defined signals) is a function of the number of modules in the Link as well as the width of the corresponding lp_data or pl_data signals, respectively (see Table 10-6 for examples of different configurations). . The lp_retimer_crd and pl_retimer_crd signals are not applicable in this mode of operation and will never assert for this application. <table> <caption>Table 10-6. Example Configurations and Widthsª</caption> <tr> <th>Number of Modules in Link and Per-module Width</th> <th>RDI or FDI Width</th> <th>"VS" Parameter</th> <th>Description</th> </tr> <tr> <td>$4 \times 1 6$</td> <td>$6 4 B$</td> <td>4 (num modules)</td> <td>· Bit 0 is for Module 0 · Bit 1 is for Module 1 · Bit 2 is for Module 2 · Bit 3 is for Module 3</td> </tr> <tr> <td>$4 \times 1 6$</td> <td>128B</td> <td>$8 \left( n u m \quad m o d u l e s * 2 \right)$</td> <td>· Bits 0, 4 are for Module 0 · Bits 1, 5 are for Module 1 · Bits 2, 6 are for Module 2 · $B i t s \quad 3 , 7 \quad a r e \quad f o r \quad M o d u l e \quad 3$ · For each module: - The lower index bit is for alternate valid frames starting from the first valid frame after reaching Active state - The higher index is for alternate valid frames starting from the second valid frame after reaching Active</td> </tr> </table> a. The examples provided in this table are for UCIe-S; however, UCIe-A configurations are also permitted. Figure 10-30 illustrates an example of byte transfer on the Rx for one Lane of a Module. The same can be extended to multiple Lanes for each Module, and in the case of multiple modules, each Module interprets the received encoding and drives that encoding on the corresponding pl_vendor_defined signal. In the figure, during UCIe Link Clock 0 through 7, Byte 0 (B0) and Byte 1 (B1) are received on UCIe Data Lane 0. The encodings received on RXVLD indicate that both of those bytes are valid. The encodings received on RXVLD also indicate that the vendor-defined data received has a value of 0 corresponding to B0, followed by a value of 1 for B1. As shown in Figure 10-30, the Physical Layer presents the de-serialized data bytes on pl_data_byte0 and the vendor-defined data on pl_vendor_defined[0] signals on RDI at the corresponding lclk cycles. The latency from data received until the data appears on the RDI interface, as well as the Iclk to UCIe Link clock ratio, might differ from the example shown in Figure 10-30, depending on implementation details. Figure 10-30. Example of Byte Transfer on the Rx for One Lane of a Module <figure> x 0 1 2 3 4 5 UCle Link Clock 6 7 8 x ☒ x ☒ x ☒ x ☒ x ☒ UCle RXVLD UCle Data Lane 0 BO[0] BO[1] BO[2] BO[3] BO[4] BO[5] BO[6] BO[7] B1[0] B1[1] B1[2] B1[3] B1[4] B1[5] B1[6] B1[7] 0 Iclk RDI pl_data byte0[7:0] 00h BO[7:0] 00h B1[7:0] $\mathrm { p l } \_ \mathrm { v a l i d }$ 00h pl_vendor_defined[0] </figure> #### 10.3.5 Example Flow Diagrams ##### 10.3.5.1 LinkReset Entry and Exit Figure 10-31 shows an example flow for LinkReset entry and exit. In the multi-protocol stack scenario, it is permitted for each protocol stack to independently transition to LinkReset. RDI is only transitioned to LinkReset if all the corresponding Adapter LSMs are in LinkReset. For the Link Down Event box, it is expected that SoC does not trigger the overall reset flow until the Physical Layer has completed all the relevant sideband handshakes with the remote Link partner that ensure the LTSM is also in Reset state. Figure 10-31 also shows the link reset flow for a PCIe/CXL.io protocol. If Management Transport protocol is supported and negotiated on the same stack as PCIe/CXL.io protocol, the Management Port Gateway must still follow the LinkReset flow and reset requirements that correspond to PCIe/ CXL.io. <figure> <figcaption>Figure 10-31. LinkReset Example</figcaption> DP Protocol Layer Die 0 DP Adapter Die 0 DP Physical layer Die 0 CHANNEL UP Physical layer UP Adapter Die 1 Die 1 UP Protocol Layer Die 1 pl_state_sts = Active $p l _ { - }$ = Active Software set SBR = 1 Ip_state_req=LinkReset- SB 3MSG {LinkMgmt.Adapter0.Req.LinkReset} SB MSG {LinkMgmt.Adapter0.Rsp.LinkReset} pl_state_sts = LinkReset- Link Down Event, Protocol $L a y e r \quad i s \quad p e r m i t t e d \quad t o \quad r e s e t$ upper layers $p l \_ s t a t e \_ s t s = L i n k \quad R e s e t$ Ip_state_req=LinkReset SB MSG {LinkMgmt.RDI.Req.LinkReset} pl_state_sts=LinkReset] $p l \_ s t a t e \_ s t s = L i n k R e s e t$ SB MSG {LinkMgmt.RDI.Rsp.LinkReset} Link Down Event, resets device pl_state_sts=Reset Software clear SBR = 1 Ip_state_req=Active lp_state_req=Active- Reset flow completed, Link Training State Machine is in Reset waiting for sideband init pattern from DP $p l \_ s t a t e \_ s t s = R e s e t -$ pl_state_sts = Reset- Ip_state_req=NOP->Active] lp_state_req=NOP->Activel Start Link Training </figure> ##### 10.3.5.2 LinkError Figure 10-32 shows an example of LinkError entry and exit when the Protocol Layer detected an uncorrectable internal error. <figure> <figcaption>Figure 10-32. LinkError example</figcaption> DP Protocol Layer Die 0 DP Adapter $D i e \quad 0$ DP Physical layer $\mathrm { D i e } 0$ CHANNEL UP Physical layer Die 1 UP Adapter Die 1 UP Protocol Layer Die 1 pl_state_sts = Active pl_state_sts = Active Protocol Layer detected UIE It keeps the Link in LinkError as long as required. For example, in the case of Downstream Port Containment (DPC), it is as long as the DPC Status is not cleared by software. Ip_linkerror=1 Ip_linkerror=1 SB MSG {LinkMgmt.RDI.Req.LinkError} SB MSG {LinkMgmt.RDI.Rsp.LinkError} pl_state_sts = LinkError] pl_state_sts = Linkerror pl_state_sts = Link Error pl_state_sts = LinkError Link Down Event, resets device pl_state_sts=Reset pl_state_sts=Reset Any transition from Link Disable to Link Enable or Link SBR asserted to deasserted should trigger Protocol Layer to perform Link bring up sequence. $I p \_ s t a t e \_ r e q = A c t i v e$ $I p \_ l i n k e r r o r = 0$ Reset flow completed, Link Training State Machine is in Reset waiting for sideband init pattern from DP $1 0$ Ip_state_req=Active- $p l \_ s t a t e \_ s t s = R e s e t$ pl_state_sts = Reset- Ip_state_req=NOP->Active Ip_state_req=NOP->Active Start Link Training </figure> ##### 10.3.5.3 Example of L2 Cross Product with Retrain on RDI Figure 10-33 shows an example of L2 entry cross product with Retrain transition on RDI (i.e., both flows happen to overlap in a meaningful way) and the corresponding events to resolve the state on either side of the Link. <figure> <figcaption>Figure 10-33. Example of L2 Cross Product with Retrain on RDI</figcaption> Protocol Layer Die 0 Adapter Die 0 Physical layer Die 0 CHANNEL Physical layer $D i e \quad 1$ Adapter Die 1 Protocol Layer $D i e \quad 1$ pl_state_sts = Active pl_state_sts = Active lp_state_req=L2 $l p \_ s t a t e \_ r e q = L 2 -$ SB MSG {LinkMgmt.Adapter0.Req.L2 pl_state_sts = Retrain Adapter LSM is L2 SB MSG {LinkMgmt.Adapter0.Rsp.L2} Adapter LSM is Retrain Adapter LSM is L2 pl_state_sts = Retrain SB MSG {LinkMgmt.Adapter0.Req.L2} SB MSG {LinkMgmt.Adapter0.Rsp.PMNAK} RDI Retrain exit flow pl_state_sts = Active pl_state_sts = Active lp_state_req=NOP->Active Adapter LSM is Retrain Adapter LSM is Reset SB MSG {LinkMgmt.Adapter0.Req.Active} $l p \_ s t a t e \_ r e q = N O P - > A c t i v e$ SB MSG {LinkMgmt.AdapterO.Rsp.Active} SB MSG {LinkMgmt.Adapter0.Req.Active} SB MSG {LinkMgmt.Adapter0.Rsp.Active} Adapter LSM is Active Adapter LSM is Active Regular L2 entry flow can begin if L2 entry conditions are met </figure> ##### 10.3.5.4 L2 Exit Example for RDI <figure> <figcaption>Figure 10-34. L2 Exit Example for RDI</figcaption> Adapter Die 0 Physical layer Die 0 CHANNEL Physical layer Die 1 Adapter Die 1 pl_state_sts = L2 $p l \_ s t a t e \_ s t s = L 2$ lp_state_req=Active SB MSG {LinkMgmt. RDI. Req.Active} $p ! \text { state } _ { - } s t s = \text { Reset }$ $p l _ { - }$ pl_inband_pres = 0b LTSM is in LinkInit LTSM is in LinkInit pl_inband_pres = 1b SB MSG {LinkMgmt. RDI.Req.Active} lp_state_req=NOP->Active $p l \_ s t a t e \_ s t s = R e s e t -$ $p l \_ i n b a n d \_ p r e s = 1 b$ Ip_state_req=NOP->Active SB MSG {LinkMi ~+ RDI. Rs p. Active } {LinkMgmt.RDI. $\left. . \mathrm { R s } \mathrm { p } . \mathrm { A c t i v e } \right\}$ Ti LTSM is in Active LTSM is in Active $p l \_ s t a t e \_ s t s = A c t i v e$ pl_state_sts = Active ☐ $| \begin{array}{} { - 1<br>1 |$

</figure>

§ §

# 11.0 Compliance

The goal of Compliance testing is to validate the mainband supported features of a Device Under Test
(DUT) against a known good reference UCIe implementation. Device support for Compliance Testing
is optional, however a device that does not support capabilities listed in this chapter may not be able
to participate in the Compliance program. Different layers of UCIe (Physical, Adapter, Protocol) will be
checked independently with a suite of tests for compliance testing.

The system setup for compliance testing is composed of the following:

· Reference UCIe design (Golden Die): This is a known good UCIe implementation across all layers
of the UCIe stack.

· DUT: One or more DUTs that will be tested with the reference design. It is required that these
have cleared the testing requirements of die sort/pre-bond before they are brought for
compliance testing.

. In the case of Advanced Package configuration, a known good silicon bridge or interposer that
connects the Golden Die with the DUT. In the case of Standard Package configuration, a known
good package for connecting the Golden Die to the DUT.

UCIe implementations that support compliance testing must implement the Compliance/Test Register
Block as outlined in Chapter 9.0 and adhere to the requirements outlined in this chapter.

The above components are integrated together in a test package (see Figure 11-1), which is then
used for running Compliance and Interoperability tests.

UCIe sideband plays a critical role for enabling compliance testing by allowing compliance software to
access registers from different UCIe components (e.g., Physical Layer, D2D Adapter, etc.) for setting
up tests as well as monitoring status. It is expected that UCIe sideband comes up without requiring
any FW initialization.

This specification defines the required hardware capabilities of the UCIe stack in the DUT. A separate
document will be published later to describe the following:

· Compliance test setup, including the channel model and package level details

· Test details

· Golden Die details including form factor and system-level behavior.

This chapter uses the terms 'software' and 'compliance software' interchangeably. Any use of the term
`software' in this chapter means compliance software that is either running on the Golden Die, or on
an external controller that is connected to the Golden Die via test/JTAG port.

Software, prior to testing compliance for any optional UCIe capability, must read the corresponding
Capability register (e.g., PHY Capability register described in Section 9.5.3.22) to ensure that the DUT
implements the capability.

<figure>
<figcaption>Figure 11-1. Examples of Standard and Advanced Package setups for DUT and Golden Die Compliance Testing</figcaption>

DUT Die

Golden Die

DUT Die

Golden Die

Inter poser (e.g., CoWoS)

Package Substrate

Package Substrate

Reference Known Good Package
(Standard Laminate)

Reference Known Good Package
(Si Interposer, Si Bridge, FO/RDL, etc .. )

UCle PHY Modules

Si interposer

DUT Die

Reference
channels
embedded

DUT Die

Golden Die

DUT logic

Golden Die
logic

Test Port/JTAG

DUT logic

Golden Die
logic

Golden Die
Test Port/JTAG

UCle PHY
Modules

Reference
channels
embedded

</figure>

## 11.1 Protocol Layer Compliance

Protocol Layer Compliance testing seeks to test the UCIe protocol stack for compliance to the
associated protocol layer specification.

For PCIe and CXL Protocol Layers, UCIe leverages the protocol compliance defined in those
specifications for the respective transaction layers. Implementations must follow the requirements
and capabilities outlined in PCIe Base Specification and CXL Specification, respectively.

For Streaming protocols, because Protocol Layer interoperability is specific to the protocol being
streamed, compliance testing of the Protocol Layer is beyond the scope of this specification.

## 11.2 Adapter Compliance

This Specification defines the hardware capabilities that are required in the DUT for exercising and
testing the different functionalities of the Adapter. The Golden Die Adapter must have all the
capabilities of the DUT, support all the Flit Formats from Chapter 3.0, and must have the capability to
inject both consistent and inconsistent sideband messages (for Parameter exchanges, Register
accesses and state transitions) to test DUT behavior for various error scenarios (e.g., timeouts, etc.).

The capabilities listed in this section must be supported by the Adapter in the DUT if the Adapter
supports any of the Flit Formats defined in Chapter 3.0. These capabilities are applicable to Adapters
of all UCIe device types (including Retimers). Each of the capabilities also have their respective

Control and Status registers, which are used to enable software to test various combinations of flows
and test criteria.

. Ability to Inject Test or NOP Flits: On the Transmitter, the injection behavior is defined by the Flit
Tx Injection Control register (see Table 9-73). For all injected Flits, CRC is computed, and if CRC
error injection is enabled, CRC errors are injected accordingly. It is allowed for the Adapter to be
set up to inject NOP Flits or Test Flits. NOP Flit follows the identical layout as defined in
Chapter 3.0. Test Flits carry a special encoding of 01b in bits [7:6] of Byte 1 of the Flit Header
that is applicable for all Flit Formats that the Adapter supports. Unlike NOP Flits, Test Flits go
through the Tx Retry buffer if Retry is enabled. One of the purposes of defining the Test Flits is to
test the Retry Flows independently, regardless of whether the Protocol Layer is enabled. The
Payload in these Flits carry specific patterns that are determined by the fields in the Flit Tx
Injection Control register. Software is permitted to enable flit injection in mission mode as well
while interleaving with regular Protocol Flits using the appropriate programming (see the register
fields in Table 9-73). At the Receiver, these Flits are not forwarded to the Protocol Layer. The
Receiver cancels these using the pl_flit_cancel signal on FDI or any other mechanism;
however, CRC must be checked the same as with regular Flits, and any errors must trigger the
Retry Flows as applicable.

· Injection of Link State Request or Response sideband messages. This is controlled using the Link
State Injection registers defined in the Link State Injection Control Stack 0 and Link State
Injection Control Stack 1 registers (see Table 9-75 and Table 9-76, respectively). Single Protocol
stack implementations use the Stack 0 register. Software must place the Adapter in Compliance
mode (by writing 10b to the 'Compliance Mode' field in the Adapter Compliance Control register).

· Retry injection control as defined in the Retry Injection Control register (see Table 9-77).

## 11.3 PHY Compliance

This specification defines the hardware capabilities that are required in the Device Under Test (DUT)
for exercising and testing the different functionalities of the Physical Layer. The Golden Die must
support capabilities to force timeouts on all applicable sideband messages as well as state residence
timers.

The registers and associated functionality defined in Section 9.5.4 and the UHM DVSEC Capability
defined in Section 9.5.3.36 are used for Compliance testing. These registers provide the following
functionality:

· Timing margining

· Voltage margining, when supported

· BER measurement

· Lane-to-Lane skew for a given module at both the Receiver and Transmitter

· TX Equalization (EQ) as defined in Section 5.3.3

§ §

# Appendix A CXL/PCIe Register applicability to UCIe

## A.1 CXL Registers applicability to UCIe

All CXL-defined DVSECs fully apply in the context of UCIe when operating in Raw Format. When
operating in non-Raw Format, a few register definitions need to be reinterpreted in the context of
UCIe. See below for details. Note that regardless of the Raw Format or non-Raw Format, device/port
configurations with CXL 1.1 compliance is not permitted as was discussed in Chapter 9.0.

<table>
<caption>Table A-1. CXL Registers for UCIe devices</caption>
<tr>
<th>Register Block</th>
<th>Register</th>
<th>Bits</th>
<th>Comments</th>
</tr>
<tr>
<td rowspan="4">DVSEC Capability</td>
<td>DVSEC Flex Bus Port Control</td>
<td>3,4</td>
<td>See next row for how these bits are handled</td>
</tr>
<tr>
<td rowspan="2">DVSEC Flex Bus Port Status</td>
<td>3, 4</td>
<td>This bit just mirrors bits 3, 4 in Flex bus port control register, to mimic legacy behavior.</td>
</tr>
<tr>
<td>11, 12</td>
<td>Hardwired to 0</td>
</tr>
<tr>
<td>$F r o m \quad 1 4 h - 1 F h$</td>
<td></td>
<td>N/A</td>
</tr>
</table>

## A.2 PCIe Register applicability to UCIe

All PCIe specifications defined DVSEC apply in the context of UCIe as well. There are a few Link and
PHY layer registers/bits though that are N/A or need to be reinterpreted in the context of UCIe. They
are listed below.

<table>
<caption>Table A-2. PCIe Registers for UCIe devices</caption>
<tr>
<th>Register Block</th>
<th>Register</th>
<th>Bits</th>
<th>Comments</th>
</tr>
<tr>
<td rowspan="18">$P C I e$ capability</td>
<td>PCI Express Capabilities Register</td>
<td>8</td>
<td>Slot implemented - set to 0. And hence follow rules for implementing other slot related registers/bits at various locations in the PCIe capability register set.</td>
</tr>
<tr>
<td>Device capabilities Register</td>
<td>8:6</td>
<td>N/A and can be set to any value</td>
</tr>
<tr>
<td rowspan="6">Link Capabilities Register</td>
<td>3:0</td>
<td>Max Link Speed: Set to 0011b indicating 8GT/s</td>
</tr>
<tr>
<td>9:4</td>
<td>Max Link Width: 01 0000b, indicating x16</td>
</tr>
<tr>
<td>11:10</td>
<td>ASPM support: 01b/11b encodings disallowed</td>
</tr>
<tr>
<td>14:12</td>
<td>N/A</td>
</tr>
<tr>
<td>17:15</td>
<td>L1 Exit Latency: Devices/Ports must set this bit based on whether they are connected to a retimer or not, and also the retimer based exit latency might not be known at design time as well. To assist with this, these bits need to be made HWInit from a device/port perspective so system FW can set this at boot time based on the specific retimer based latencies.</td>
</tr>
<tr>
<td>18</td>
<td>N/A and hardwired to 0</td>
</tr>
<tr>
<td rowspan="5">Link Control Register</td>
<td>6</td>
<td>HW ignores what is written here but follow any base spec rules for bit attributes.</td>
</tr>
<tr>
<td>7</td>
<td>HW ignores what is written here but follow any base spec rules for bit attributes.</td>
</tr>
<tr>
<td>8</td>
<td>$S e t \quad t o \quad R O \quad 0$</td>
</tr>
<tr>
<td>9</td>
<td>Set to RO 0</td>
</tr>
<tr>
<td>10, 11, 12</td>
<td>HW ignores what is written in these bits but follows any base spec rules for bit attributes.</td>
</tr>
<tr>
<td rowspan="3">Link Status Register</td>
<td>3:0</td>
<td>Current Link speed: Set to 0011b indicating 8GT/s</td>
</tr>
<tr>
<td>9:4</td>
<td>Negotiated Link width: x16</td>
</tr>
<tr>
<td>15</td>
<td>Hardwired to 0</td>
</tr>
<tr>
<td rowspan="2">Link Capabilities 2 Register</td>
<td>7:1</td>
<td>Set to 000 0111b</td>
</tr>
<tr>
<td>15:9</td>
<td>Set to 00h</td>
</tr>
<tr>
<td rowspan="7">PCIe Capability</td>
<td rowspan="2">Link Capabilities 2 Register</td>
<td>22:16</td>
<td>Set to 00h</td>
</tr>
<tr>
<td>24:23</td>
<td>Set to 00b just to appear compliant</td>
</tr>
<tr>
<td rowspan="4">Link Control 2 Register</td>
<td>3:0</td>
<td>Target Link speed: Writes to this register are ignored by UCIe hardware, but HW follows the base spec rules for bit attributes</td>
</tr>
<tr>
<td>4</td>
<td>HW ignores what is written in this bit but follows any base spec rules for bit attributes.</td>
</tr>
<tr>
<td>5</td>
<td>HW autonomous speed disable - Set to RO 0</td>
</tr>
<tr>
<td>15:6</td>
<td>N/A for UCIe. HW should follow base spec rules for register bit attributes.</td>
</tr>
<tr>
<td>Link Status 2 Register</td>
<td>9:0</td>
<td>Set to RO 0</td>
</tr>
<tr>
<td>PCIe Extended Capability</td>
<td>Secondary PCI Express Extended Capability</td>
<td>All</td>
<td>Implement per the base spec, but HW ignores all commands from SW and also sets all equalization control registry entries to 0.</td>
</tr>
</table>

## A.3 PCIe/CXL registers that need to be part of D2D

· PCIe Link Control Register

\- Bits 13, 5, 4, and 1:0 are relevant for D2D operation

· CXL DVSEC Flex Bus Port Received Modified TS Data Phase1 Register

· CXL DVSEC Flex Bus Port Control

· CXL DVSEC Flex Bus Port Status

· CXL ARB/MUX registers

§ §

# Appendix B AIB Interoperability

Implementations are permitted to design a superset stack to be interoperable with UCIe/AIB PHY.
This section details the UCIe interoperability criteria with AIB.

## B.1 AIB Signal Mapping

### B.1.1 Data path

Data path signal mapping for AIB 2.0 and AIB 1.0 are shown in Table B-1 and Table B-2 respectively.
AIB sideband is sent over an asynchronous path on UCIe main band.

### B.1.2 Always high Valid

Always high Valid is an optional feature that is only applicable to AIB interoperability applications. This
must be negotiated prior to main band Link training through parameter exchange. Raw mode must be
used in such applications.

### B.1.3 Sideband

AIB sideband is sent using UCIe main band signals. UCIe sideband is not required in AIB
interoperability mode and it is disabled (Transmitters are Hi-Z and Receivers are disabled).

<figure>
<figcaption>Figure B-1. AIB interoperability</figcaption>

Die-to-Die Adapter (Raw Mode)

Logic Clock

Raw D2D interface

PHY Logic (AIB)

Logic Clock

Sideband

Electrical/ AFE

IO Clock

Sideband
$\left( x 4 \right)$

FW-CLK

Data x64

$\mathrm { T r a c k } \left( \text { Not required } \right)$

Disabled

</figure>

### B.1.4 Raw Die-to-Die interface

AIB Phy logic block shown in Figure B-1 presents a subset of RDI to next layer up.

Note:
More details will be shown in a later revision of this specification

<table>
<caption>Table B-1. AIB 2.0 Datapath mapping for Advanced Package</caption>
<tr>
<th>UCIe Interface</th>
<th>AIB 2.0</th>
<th>Note</th>
</tr>
<tr>
<td>TXDATA [ 39 : 0]</td>
<td>$T X \left[ 3 9 : 0 \right]$</td>
<td></td>
</tr>
<tr>
<td>TXDATA [ 47: 40]</td>
<td>AIB Sideband Tx</td>
<td>Asynchronous path</td>
</tr>
<tr>
<td>TXDATA [63: 48]</td>
<td>N/A</td>
<td>Disabled (Hi-Z)</td>
</tr>
<tr>
<td>RXDATA [ 39 : 0]</td>
<td>RX [39 : 0]</td>
<td></td>
</tr>
<tr>
<td>RXDATA [ 47: 40]</td>
<td>$A I B \quad S i d e b a n d \quad R x$</td>
<td>Asynchronous path</td>
</tr>
<tr>
<td>RXDATA [ 63 : 48]</td>
<td>N/A</td>
<td></td>
</tr>
<tr>
<td>TXDATASB</td>
<td rowspan="6">N/A</td>
<td rowspan="6">Disabled (Hi-Z)</td>
</tr>
<tr>
<td>RXDATASB</td>
</tr>
<tr>
<td>TXCKSB</td>
</tr>
<tr>
<td>RXCKSB</td>
</tr>
<tr>
<td>TXDATASBRD</td>
</tr>
<tr>
<td>RXDATASBRD</td>
</tr>
</table>

<table>
<caption>Table B-2. AIB 1.0 Datapath mapping for Advanced Package</caption>
<tr>
<th>UCIe Interface</th>
<th>AIB 1.0</th>
<th>Note</th>
</tr>
<tr>
<td>TXDATA [ 19 : 0]</td>
<td>$T X \left[ 1 9 : 0 \right]$</td>
<td></td>
</tr>
<tr>
<td>TXDATA [ 42 : 20]</td>
<td>AIB Sideband Tx</td>
<td>Asynchronous path</td>
</tr>
<tr>
<td>TXDATA [63: 43]</td>
<td>N/A</td>
<td>Disabled $\left( H i - Z \right)$</td>
</tr>
<tr>
<td>RXDATA [19 : 0]</td>
<td>$2 \times \left[ 1 9 : 0 \right]$</td>
<td></td>
</tr>
<tr>
<td>RXDATA [ 42 : 20]</td>
<td>$\mathrm { A I B } \mathrm { S i d e b a n d } R x$</td>
<td>Asynchronous path</td>
</tr>
<tr>
<td>RXDATA [63: 43]</td>
<td>N/A</td>
<td></td>
</tr>
<tr>
<td>TXDATASB</td>
<td rowspan="6">$N / A$</td>
<td rowspan="6">Disabled (Hi-Z)</td>
</tr>
<tr>
<td>RXDATASB</td>
</tr>
<tr>
<td>TXCKSB</td>
</tr>
<tr>
<td>RXCKSB</td>
</tr>
<tr>
<td>TXDATASBRD</td>
</tr>
<tr>
<td>RXDATASBRD</td>
</tr>
</table>

## B.2 Initialization

AIB Phy logic block shown in Figure B-1 contains all the AIB Link logic and state machines. Please see
AIB specification (Section 2 and Section 3) for initialization flow.

<table>
<tr>
<td>B.3</td>
<td>Bump Map</td>
</tr>
<tr>
<td>Note:</td>
<td>More details will be shown in a future revision this specification</td>
</tr>
</table>

§ §

