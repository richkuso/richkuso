# Makefile for UCIe Sideband UVM Agent
# Core component compilation for multiple simulators

# Default simulator
SIM ?= vcs

# Core source files (no tests)
SOURCES = ucie_sb_inf.sv ucie_sb_pkg.sv

# Common UVM arguments
UVM_HOME ?= $(VCS_HOME)/etc/uvm-1.2
UVM_ARGS = +incdir+$(UVM_HOME)/src $(UVM_HOME)/src/uvm_pkg.sv

# Enable sideband assertions (optional)
ENABLE_ASSERTIONS ?= 1
ifeq ($(ENABLE_ASSERTIONS), 1)
    DEFINE_ARGS = +define+ENABLE_SIDEBAND_ASSERTIONS
else
    DEFINE_ARGS = 
endif

# VCS specific settings
VCS_ARGS = -sverilog -ntb_opts uvm-1.2 -debug_access+all -kdb -lca $(DEFINE_ARGS)

# Questa specific settings
QUESTA_ARGS = -sv -uvm +incdir+$(UVM_HOME)/src $(DEFINE_ARGS)

# Xcelium specific settings
XCELIUM_ARGS = -sv -uvm +incdir+$(UVM_HOME)/src $(DEFINE_ARGS)

# Default target
all: compile

# Compilation targets
compile: compile_$(SIM)

compile_vcs:
	vcs $(VCS_ARGS) $(UVM_ARGS) $(SOURCES) -o ucie_sb_agent

compile_questa:
	vlog $(QUESTA_ARGS) $(UVM_ARGS) $(SOURCES)

compile_xcelium:
	xmvlog $(XCELIUM_ARGS) $(UVM_ARGS) $(SOURCES)

# Syntax check targets
syntax: syntax_$(SIM)

syntax_vcs:
	vcs $(VCS_ARGS) $(UVM_ARGS) $(SOURCES) -check_syntax

syntax_questa:
	vlog $(QUESTA_ARGS) $(UVM_ARGS) $(SOURCES) -work work

syntax_xcelium:
	xmvlog $(XCELIUM_ARGS) $(UVM_ARGS) $(SOURCES) -elaborate

# Clean targets
clean:
	rm -rf simv* csrc* ucli* *.log *.vpd *.fsdb *.shm *.trn work* transcript *.wlf
	rm -rf DVEfiles inter.vpd *.daidir *.history .vlogansetup.env .vlogansetup.args
	rm -rf ucie_sb_agent ucie_sb_simv

# Help target
help:
	@echo "UCIe Sideband UVM Agent Makefile"
	@echo "================================="
	@echo "Available targets:"
	@echo "  compile       - Compile core UVM agent (default: VCS)"
	@echo "  syntax        - Check syntax only"
	@echo "  clean         - Clean build artifacts"
	@echo "  help          - Show this help"
	@echo ""
	@echo "Simulator selection:"
	@echo "  SIM=vcs       - Use Synopsys VCS (default)"
	@echo "  SIM=questa    - Use Mentor Questa/ModelSim"
	@echo "  SIM=xcelium   - Use Cadence Xcelium"
	@echo ""
	@echo "Options:"
	@echo "  ENABLE_ASSERTIONS=1  - Enable sideband assertions (default)"
	@echo "  ENABLE_ASSERTIONS=0  - Disable sideband assertions"
	@echo ""
	@echo "Example usage:"
	@echo "  make compile SIM=vcs"
	@echo "  make syntax SIM=questa"
	@echo "  make clean"

.PHONY: all compile syntax clean help compile_vcs compile_questa compile_xcelium syntax_vcs syntax_questa syntax_xcelium